import{a as Ar,b as bo}from"./B3MUEI4N.js";import{a as Eo}from"./7O552GAH.js";import{a as xo,c as gr,d as vo,e as yr,h as So}from"./4NAB6M5G.js";import{b as Kr}from"./R4DOVXS6.js";import{$ as co,Aa as ho,B as Qr,C as to,Eb as Co,Fa as go,Ga as yo,H as eo,P as jr,R as Ut,S as mr,T as no,U as oo,Y as hr,Z as io,_ as so,ab as dt,b as Qn,ba as dr,ca as fo,d as Gt,ea as po,hb as Fe,nb as bt,ob as rt,p as or,pb as st,q as Xn,r as Dt,s as Yn,t as jt,v as Zn}from"./VAZXMTWI.js";import{h as mo}from"./3ULVSIIZ.js";import{i as Kn}from"./GQJKJJWP.js";import{a as $r,c as ji}from"./BXGPN2X7.js";import{d as $n}from"./VMA5WMPP.js";import{a as pr,b as Qi}from"./SYZGD7UF.js";import{j as $i}from"./QZVUH6Z4.js";import{$ as lo,_ as uo,c as ro,ea as Ao,fa as To,q as ao}from"./TN74TYZV.js";import{c as fr,d as Hn,e as tr,r as zn}from"./JBQIPS5C.js";import{a as Jn}from"./CVYR3XXR.js";import{b as Gn,c as Bn,d as re,e as qn,g as er,i as rr,k as zr,l as Wn,n as Vn,p as nr}from"./DAZIVUKN.js";import{B as Un,E as ur,L as kn,M as lr,S as Vr,T as Fn,Z as Nn,a as nt,b as Ln,c as qr,e as Je,g as On,h as Ue,j as Wr,q as Dn,w as ke}from"./OKNPJCGL.js";import{c as jn}from"./QPPETRF6.js";import{d as ee,e as Rn}from"./OPO7MVAW.js";import{G as Pn,H as Gr,K as Br,S as cr,T as Mn,c as Sn,e as Ct,f as bn,g as In,k as _n,p as Ot,q as te,u as wn}from"./2XMGLZMD.js";import{a as Ht}from"./64D36THL.js";import{c as _t,f as ht,h as W}from"./PQ35KENF.js";var es=_t(Cr=>{"use strict";var Yi=Qi();Object.defineProperty(Cr,"__esModule",{value:!0});Cr.default=void 0;var Zi=Yi(ji()),Ji=$i(),ts=(0,Zi.default)((0,Ji.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");Cr.default=ts});var Zo=_t(vr=>{"use strict";vr.byteLength=cs;vr.toByteArray=ls;vr.fromByteArray=ms;var Bt=[],wt=[],as=typeof Uint8Array<"u"?Uint8Array:Array,nn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(ge=0,Xo=nn.length;ge<Xo;++ge)Bt[ge]=nn[ge],wt[nn.charCodeAt(ge)]=ge;var ge,Xo;wt["-".charCodeAt(0)]=62;wt["_".charCodeAt(0)]=63;function Yo(s){var r=s.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=s.indexOf("=");o===-1&&(o=r);var e=o===r?0:4-o%4;return[o,e]}function cs(s){var r=Yo(s),o=r[0],e=r[1];return(o+e)*3/4-e}function us(s,r,o){return(r+o)*3/4-o}function ls(s){var r,o=Yo(s),e=o[0],t=o[1],n=new as(us(s,e,t)),i=0,a=t>0?e-4:e,f;for(f=0;f<a;f+=4)r=wt[s.charCodeAt(f)]<<18|wt[s.charCodeAt(f+1)]<<12|wt[s.charCodeAt(f+2)]<<6|wt[s.charCodeAt(f+3)],n[i++]=r>>16&255,n[i++]=r>>8&255,n[i++]=r&255;return t===2&&(r=wt[s.charCodeAt(f)]<<2|wt[s.charCodeAt(f+1)]>>4,n[i++]=r&255),t===1&&(r=wt[s.charCodeAt(f)]<<10|wt[s.charCodeAt(f+1)]<<4|wt[s.charCodeAt(f+2)]>>2,n[i++]=r>>8&255,n[i++]=r&255),n}function fs(s){return Bt[s>>18&63]+Bt[s>>12&63]+Bt[s>>6&63]+Bt[s&63]}function ps(s,r,o){for(var e,t=[],n=r;n<o;n+=3)e=(s[n]<<16&16711680)+(s[n+1]<<8&65280)+(s[n+2]&255),t.push(fs(e));return t.join("")}function ms(s){for(var r,o=s.length,e=o%3,t=[],n=16383,i=0,a=o-e;i<a;i+=n)t.push(ps(s,i,i+n>a?a:i+n));return e===1?(r=s[o-1],t.push(Bt[r>>2]+Bt[r<<4&63]+"==")):e===2&&(r=(s[o-2]<<8)+s[o-1],t.push(Bt[r>>10]+Bt[r>>4&63]+Bt[r<<2&63]+"=")),t.join("")}});var ei=_t((Ql,ti)=>{function Pt(s,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(s)),this._timeouts=s,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}ti.exports=Pt;Pt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Pt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Pt.prototype.retry=function(s){if(this._timeout&&clearTimeout(this._timeout),!s)return!1;var r=new Date().getTime();if(s&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(s),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(s);var o=this._timeouts.shift();if(o===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),o=this._cachedTimeouts.slice(-1);else return!1;var e=this;return this._timer=setTimeout(function(){e._attempts++,e._operationTimeoutCb&&(e._timeout=setTimeout(function(){e._operationTimeoutCb(e._attempts)},e._operationTimeout),e._options.unref&&e._timeout.unref()),e._fn(e._attempts)},o),this._options.unref&&this._timer.unref(),!0};Pt.prototype.attempt=function(s,r){this._fn=s,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var o=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){o._operationTimeoutCb()},o._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Pt.prototype.try=function(s){this.attempt(s)};Pt.prototype.start=function(s){this.attempt(s)};Pt.prototype.start=Pt.prototype.try;Pt.prototype.errors=function(){return this._errors};Pt.prototype.attempts=function(){return this._attempts};Pt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var s={},r=null,o=0,e=0;e<this._errors.length;e++){var t=this._errors[e],n=t.message,i=(s[n]||0)+1;s[n]=i,i>=o&&(r=t,o=i)}return r}});var ri=_t(ye=>{var As=ei();ye.operation=function(s){var r=ye.timeouts(s);return new As(r,{forever:s&&(s.forever||s.retries===1/0),unref:s&&s.unref,maxRetryTime:s&&s.maxRetryTime})};ye.timeouts=function(s){if(s instanceof Array)return[].concat(s);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var o in s)r[o]=s[o];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],t=0;t<r.retries;t++)e.push(this.createTimeout(t,r));return s&&s.forever&&!e.length&&e.push(this.createTimeout(t,r)),e.sort(function(n,i){return n-i}),e};ye.createTimeout=function(s,r){var o=r.randomize?Math.random()+1:1,e=Math.round(o*Math.max(r.minTimeout,1)*Math.pow(r.factor,s));return e=Math.min(e,r.maxTimeout),e};ye.wrap=function(s,r,o){if(r instanceof Array&&(o=r,r=null),!o){o=[];for(var e in s)typeof s[e]=="function"&&o.push(e)}for(var t=0;t<o.length;t++){var n=o[t],i=s[n];s[n]=function(f){var m=ye.operation(r),c=Array.prototype.slice.call(arguments,1),u=c.pop();c.push(function(l){m.retry(l)||(l&&(arguments[0]=m.mainError()),u.apply(this,arguments))}),m.attempt(function(){f.apply(s,c)})}.bind(s,i),s[n].options=r}}});var oi=_t((Kl,ni)=>{ni.exports=ri()});var si=_t((Xl,br)=>{"use strict";var Ts=oi(),Cs=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Sr=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}},Es=(s,r,o)=>{let e=o.retries-(r-1);return s.attemptNumber=r,s.retriesLeft=e,s},xs=s=>Cs.includes(s),ii=(s,r)=>new Promise((o,e)=>{r={onFailedAttempt:()=>{},retries:10,...r};let t=Ts.operation(r);t.attempt(async n=>{try{o(await s(n))}catch(i){if(!(i instanceof Error)){e(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof Sr)t.stop(),e(i.originalError);else if(i instanceof TypeError&&!xs(i.message))t.stop(),e(i);else{Es(i,n,r);try{await r.onFailedAttempt(i)}catch(a){e(a);return}t.retry(i)||e(t.mainError())}}})});br.exports=ii;br.exports.default=ii;br.exports.AbortError=Sr});var ci=_t((Yl,an)=>{"use strict";var vs=Object.prototype.hasOwnProperty,Et="~";function ir(){}Object.create&&(ir.prototype=Object.create(null),new ir().__proto__||(Et=!1));function Ss(s,r,o){this.fn=s,this.context=r,this.once=o||!1}function ai(s,r,o,e,t){if(typeof o!="function")throw new TypeError("The listener must be a function");var n=new Ss(o,e||s,t),i=Et?Et+r:r;return s._events[i]?s._events[i].fn?s._events[i]=[s._events[i],n]:s._events[i].push(n):(s._events[i]=n,s._eventsCount++),s}function Ir(s,r){--s._eventsCount===0?s._events=new ir:delete s._events[r]}function yt(){this._events=new ir,this._eventsCount=0}yt.prototype.eventNames=function(){var r=[],o,e;if(this._eventsCount===0)return r;for(e in o=this._events)vs.call(o,e)&&r.push(Et?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(o)):r};yt.prototype.listeners=function(r){var o=Et?Et+r:r,e=this._events[o];if(!e)return[];if(e.fn)return[e.fn];for(var t=0,n=e.length,i=new Array(n);t<n;t++)i[t]=e[t].fn;return i};yt.prototype.listenerCount=function(r){var o=Et?Et+r:r,e=this._events[o];return e?e.fn?1:e.length:0};yt.prototype.emit=function(r,o,e,t,n,i){var a=Et?Et+r:r;if(!this._events[a])return!1;var f=this._events[a],m=arguments.length,c,u;if(f.fn){switch(f.once&&this.removeListener(r,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,o),!0;case 3:return f.fn.call(f.context,o,e),!0;case 4:return f.fn.call(f.context,o,e,t),!0;case 5:return f.fn.call(f.context,o,e,t,n),!0;case 6:return f.fn.call(f.context,o,e,t,n,i),!0}for(u=1,c=new Array(m-1);u<m;u++)c[u-1]=arguments[u];f.fn.apply(f.context,c)}else{var l=f.length,p;for(u=0;u<l;u++)switch(f[u].once&&this.removeListener(r,f[u].fn,void 0,!0),m){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,o);break;case 3:f[u].fn.call(f[u].context,o,e);break;case 4:f[u].fn.call(f[u].context,o,e,t);break;default:if(!c)for(p=1,c=new Array(m-1);p<m;p++)c[p-1]=arguments[p];f[u].fn.apply(f[u].context,c)}}return!0};yt.prototype.on=function(r,o,e){return ai(this,r,o,e,!1)};yt.prototype.once=function(r,o,e){return ai(this,r,o,e,!0)};yt.prototype.removeListener=function(r,o,e,t){var n=Et?Et+r:r;if(!this._events[n])return this;if(!o)return Ir(this,n),this;var i=this._events[n];if(i.fn)i.fn===o&&(!t||i.once)&&(!e||i.context===e)&&Ir(this,n);else{for(var a=0,f=[],m=i.length;a<m;a++)(i[a].fn!==o||t&&!i[a].once||e&&i[a].context!==e)&&f.push(i[a]);f.length?this._events[n]=f.length===1?f[0]:f:Ir(this,n)}return this};yt.prototype.removeAllListeners=function(r){var o;return r?(o=Et?Et+r:r,this._events[o]&&Ir(this,o)):(this._events=new ir,this._eventsCount=0),this};yt.prototype.off=yt.prototype.removeListener;yt.prototype.addListener=yt.prototype.on;yt.prefixed=Et;yt.EventEmitter=yt;typeof an<"u"&&(an.exports=yt)});var li=_t((Zl,ui)=>{"use strict";ui.exports=(s,r)=>(r=r||(()=>{}),s.then(o=>new Promise(e=>{e(r())}).then(()=>o),o=>new Promise(e=>{e(r())}).then(()=>{throw o})))});var pi=_t((Jl,wr)=>{"use strict";var bs=li(),_r=class extends Error{constructor(r){super(r),this.name="TimeoutError"}},fi=(s,r,o)=>new Promise((e,t)=>{if(typeof r!="number"||r<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(r===1/0){e(s);return}let n=setTimeout(()=>{if(typeof o=="function"){try{e(o())}catch(f){t(f)}return}let i=typeof o=="string"?o:`Promise timed out after ${r} milliseconds`,a=o instanceof Error?o:new _r(i);typeof s.cancel=="function"&&s.cancel(),t(a)},r);bs(s.then(e,t),()=>{clearTimeout(n)})});wr.exports=fi;wr.exports.default=fi;wr.exports.TimeoutError=_r});var mi=_t(cn=>{"use strict";Object.defineProperty(cn,"__esModule",{value:!0});function Is(s,r,o){let e=0,t=s.length;for(;t>0;){let n=t/2|0,i=e+n;o(s[i],r)<=0?(e=++i,t-=n+1):t=n}return e}cn.default=Is});var hi=_t(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});var _s=mi(),un=class{constructor(){this._queue=[]}enqueue(r,o){o=Object.assign({priority:0},o);let e={priority:o.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=o.priority){this._queue.push(e);return}let t=_s.default(this._queue,e,(n,i)=>i.priority-n.priority);this._queue.splice(t,0,e)}dequeue(){let r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(o=>o.priority===r.priority).map(o=>o.run)}get size(){return this._queue.length}};ln.default=un});var gi=_t(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});var ws=ci(),di=pi(),Ps=hi(),Pr=()=>{},Ms=new di.TimeoutError,fn=class extends ws{constructor(r){var o,e,t,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Pr,this._resolveIdle=Pr,r=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Ps.default},r),!(typeof r.intervalCap=="number"&&r.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(e=(o=r.intervalCap)===null||o===void 0?void 0:o.toString())!==null&&e!==void 0?e:""}\` (${typeof r.intervalCap})`);if(r.interval===void 0||!(Number.isFinite(r.interval)&&r.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(n=(t=r.interval)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof r.interval})`);this._carryoverConcurrencyCount=r.carryoverConcurrencyCount,this._isIntervalIgnored=r.intervalCap===1/0||r.interval===0,this._intervalCap=r.intervalCap,this._interval=r.interval,this._queue=new r.queueClass,this._queueClass=r.queueClass,this.concurrency=r.concurrency,this._timeout=r.timeout,this._throwOnTimeout=r.throwOnTimeout===!0,this._isPaused=r.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Pr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Pr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let r=Date.now();if(this._intervalId===void 0){let o=this._intervalEnd-r;if(o<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},o)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let r=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let o=this._queue.dequeue();return o?(this.emit("active"),o(),r&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(r){if(!(typeof r=="number"&&r>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${r}\` (${typeof r})`);this._concurrency=r,this._processQueue()}async add(r,o={}){return new Promise((e,t)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&o.timeout===void 0?r():di.default(Promise.resolve(r()),o.timeout===void 0?this._timeout:o.timeout,()=>{(o.throwOnTimeout===void 0?this._throwOnTimeout:o.throwOnTimeout)&&t(Ms)});e(await i)}catch(i){t(i)}this._next()};this._queue.enqueue(n,o),this._tryToStartAnother(),this.emit("add")})}async addAll(r,o){return Promise.all(r.map(async e=>this.add(e,o)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(r=>{let o=this._resolveEmpty;this._resolveEmpty=()=>{o(),r()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(r=>{let o=this._resolveIdle;this._resolveIdle=()=>{o(),r()}})}get size(){return this._queue.size}sizeBy(r){return this._queue.filter(r).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(r){this._timeout=r}};pn.default=fn});var Ke=ht(Ht());var Xr=class{constructor(r,o,e,t){this.id=r,this.type=o,this.status="idle",this.parameters=Object.assign({},e)||{},this.autoExecute=t}async execute(r,o){this.status="running",this.error="",this.output="",this.status="complete"}async pushMessageToChat(r,o){if(o&&o.getChartGPT()?.pushMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.pushMessage(r,e)}}async deleteMessageFromChat(r,o){if(o&&o.getChartGPT()?.deleteMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.deleteMessage(r,e)}}reset(){this.status="idle",this.error="",this.output=""}getCurrentConversationId(r){return r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||""}getCurrentSidebarType(r){return r.getChartGPT()?.getSidebarRef()?.currentSidebarSettingsRef?.current?.type||"Chat"}getNextAction(r){return r?.getShortCutsEngine()?.getNextAction()}getPrevAction(r){return r?.getShortCutsEngine()?.getPrevAction()}async getCurrentConversation(r){let o=r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||"";return o?await fo(o):null}async updateConversation(r,o){let e=this.getCurrentConversationId(r);await Yn(e,o)}},G=Xr;var Ne=(s,r)=>{try{return{data:s.replace(/\{\{(.+?)\}\}/g,(e,t)=>{let n=t.trim().split("."),i=r;for(;n.length;){let a=n.shift();if(Object.prototype.hasOwnProperty.call(i,a))i=i[a];else{i="";break}}return i}),error:""}}catch{return{data:"",error:"parse template error"}}};function Q(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;if(i.parameters?.template){let a=Ne(i.parameters?.template||"",n);a.error?(i.error=a.error,i.parameters.compliedTemplate=""):i.parameters.compliedTemplate=a.data}await e.apply(this,t)}}}function He(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;Xn(i.parameters,(a,f)=>{if(typeof f=="string"){let m=Ne(f,n).data;try{let c=JSON.parse(m);ke(i.parameters,a,c)}catch{ke(i.parameters,a,m)}}}),await e.apply(this,t)}}}function z({onlySuccess:s,onlyError:r}={onlySuccess:!1,onlyError:!1}){return function(o,e,t){let n=t.value;t.value=async function(...i){let[,a]=i,f=this,m=await n.apply(this,i),c=a.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;return f.error&&!s?a.getChartGPT()?.pushMessage({type:"system",text:f.error,messageId:nt(),extra:{status:"error"},conversationId:c}):f.output&&!r&&a.getChartGPT()?.pushMessage({type:"system",text:f.output,messageId:nt(),extra:{status:"success"}},c),m}}}function gt(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[,n]=t;n.getChartGPT()?.showLoading();let i=await e.apply(this,t);return n.getChartGPT()?.hideLoading(),i}}}function Tr(s=!0){return function(r,o,e){let t=e.value;e.value=async function(...n){let i=Fe(),a="chatBoxInputMediator";if(i&&(a="floatingMenuInputMediator"),s)return dt(a).updateInputValue(""),await t.apply(this,n);{let f=await t.apply(this,n);return dt(a).updateInputValue(""),f}}}}var ne=class extends G{static{this.type="GET_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=uo(`<html>${document?.documentElement?.innerHTML}</html>`).document,t=lo(e);t?t.success?this.output=t?.body||"":this.error=t?.body||"":this.error="No webpage contents",this.output||(this.output="",this.error="No webpage contents")}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],ne.prototype,"execute",1);var oe=class extends G{static{this.type="SET_VARIABLE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableName||this.parameters.Variable||"";if(!e){this.error="Action no variable name!";return}let t=o.getShortCutsEngine();t&&t.setVariable&&(t.setVariable(e,this.parameters?.WFFormValues?.Value||r.LAST_ACTION_OUTPUT||"",!0),this.output=r.LAST_ACTION_OUTPUT||"")}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],oe.prototype,"execute",1);var Ge=class extends G{static{this.type="OPERATION_ELEMENT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getBackgroundConversation(),t=this.parameters.OperationElementConfig||r.OperationElementConfig;if(!e||!t){this.error="Action cannot execute!";return}let n=this.parameters.OperationElementTabID||r.OperationElementTabID,a=(await e.postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:t,OperationElementTabID:n}})).data;a?.success?(t.successMessage&&await this.pushMessageToChat({type:"system",messageId:nt(),parentMessageId:"",text:t.successMessage,extra:{status:"info"}},o),t.actionType==="getText"?this.output=a.elementsInnerText:t.actionType==="getLink"&&(this.output=a.link)):t.errorMessage&&await this.pushMessageToChat({type:"system",messageId:nt(),parentMessageId:"",text:t.errorMessage,extra:{status:"error"}},o)}catch(e){this.error=e.toString()}}};var Be=class extends G{static{this.type="SCRIPTS_CONDITIONAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=!1,t=this.parameters.WFCondition||r.WFCondition||void 0,n=this.parameters.WFMatchTextCaseSensitive!==!1,i=this.parameters.WFFormValues?.Value||"",a=r.LAST_ACTION_OUTPUT||"",f=this.parameters.WFConditionalIfTrueActions||[],m=this.parameters.WFConditionalIfFalseActions||[];switch(Ln(i)?a=JSON.parse(a||"{}"):!n&&typeof i=="string"&&typeof a=="string"&&(i=i.toLocaleLowerCase(),a=a.toLocaleLowerCase()),t){case"Equals":e=Dn(i,a);break;case"Is Greater Than":e=Number(i)>Number(a);break;case"Is Less Than":e=Number(i)<Number(a);break;case"Contains":e=a.includes(String(i));break;case void 0:e=!a;break;default:break}if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(e?f:m,"after");else{this.error="no shortCutsEngine";return}}catch(e){this.error=e.toString()}}};var Yr=class{constructor(){this.pending=new Map}async send(r,o,e=5*1e3){let t=nt(),n={...o,uuid:t};return new Promise((i,a)=>{let f=setTimeout(()=>{this.pending.delete(t),a(new Error("Timeout Error"))},e);this.pending.set(t,m=>{clearTimeout(f),i(m)}),window.dispatchEvent(new CustomEvent(r,{detail:n}))})}receive(r,o){window.addEventListener(r,async e=>{if(e instanceof CustomEvent&&e.detail&&e.detail.uuid){let{uuid:t,...n}=e.detail,i,a=o(n);a instanceof Promise?i=await a:i=a;let f=this.pending.get(t);f&&(f(i),this.pending.delete(t))}})}},Io=new Yr;var wo=(s,r,o,e)=>new Promise(t=>{let n=!1,i=setTimeout(()=>{n=!0,t(void 0)},e),a=setInterval(()=>{if(!n){let f=s.querySelector(r);f&&(clearInterval(a),clearTimeout(i),t(f))}},o)}),_o=(s,r,o,e,t)=>new Promise(n=>{let i=!1,a=setTimeout(()=>{i=!0,n(void 0)},e),f=setInterval(()=>{if(!i){let m=Array.from(s.querySelectorAll(r));if(t){let c=t(m);c&&(clearInterval(f),clearTimeout(a),n(c))}else m.length>0&&(clearInterval(f),clearTimeout(a),n(m[0]))}},o)}),Ki=()=>new Promise(async s=>{let o=setTimeout(()=>{s({success:!1,error:"timeout"})},4e3),e=t=>{clearTimeout(o),s(t)};try{let t=document.getElementById(wn)?.shadowRoot;if(t){let n=await _o(t,".usechatgpt-ai__context-menu--handle-button",200,2e3,i=>i.find(a=>window.getComputedStyle(a).opacity!=="0"));if(n){setTimeout(()=>{n.click()},100);let i=await _o(t,".floating-context-menu-item",50,2e3,a=>a.find(f=>f.innerText.startsWith("Run this prompt")));if(i){i.click(),e({success:!0,error:""});return}}}e({success:!1,error:"no context menu"})}catch(t){e({success:!1,error:t?.toString()||""})}}),Oa=Ki;var Ro=ht(Ht());var Po=ht(Ht()),Xi=()=>{let{currentSidebarConversationMessages:s,currentSidebarConversationType:r}=jt(),o=Ct(Gt),e=Ct(go),t=[],n=e.lastAIMessageId;return(0,Po.useMemo)(()=>{if(r==="Chat"){if(n||s.filter(a=>a.type==="ai").length===1&&(n="root"),n)for(let a=s.length-1;a>=0;a--){let f=s[a];if(f.messageId===n)break;f.type==="ai"&&t.unshift(f)}return o.writingMessage&&o.writingMessage.type==="ai"&&t.push(o.writingMessage),t.map(a=>a.text).join(`

`).replace(/\n{2,}/,`

`)}return""},[n,o.writingMessage,s,r])},Mo=Xi;var Zr=()=>{let s=Ct(cr),{currentSelection:r}=yo(),{currentSidebarConversationMessages:o}=jt(),e=Mo(),t=Ct(Mn);return(0,Ro.useCallback)(()=>{let n="".replace(/<br\s*\/?>/gi,`
`).replace(/<\/?div[^>]*>/g,`
`).replace(/<[^>]+>/g,"").replace(/\u00ad/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/data:image\/(png|jpeg|gif);base64,\s?[A-Za-z0-9+/]+={0,2}/g,"").replace(/\n{3,}/g,`
`)||"",i=r?.selectionHTML||"",a=r?.selectionText||"",f=t.userSettings?.language||Gr;f===Pn&&(f=Gr);let m={GMAIL_EMAIL_CONTEXT:"",GMAIL_DRAFT_CONTEXT:n,SELECTED_HTML:i,SELECTED_TEXT:a,USER_INPUT:re()?.querySelector(`#${Ot}`)?.value||"",LAST_AI_OUTPUT:or(o,u=>u.type==="ai")?.text||"",AI_RESPONSE_LANGUAGE:f,AI_OUTPUT_LANGUAGE:f,CURRENT_WEBSITE_DOMAIN:typeof window<"u"?window.location.hostname:"",CURRENT_WEBPAGE_URL:typeof window<"u"?window.location.href:"",CURRENT_WEBPAGE_TITLE:typeof window<"u"?document.title:"",POPUP_DRAFT:e||""},c=[];return Object.keys(m).forEach(u=>{c.push({key:u,value:m[u],overwrite:!0})}),{builtInParameters:m,parameters:c,shortCutsParameters:Object.values(c)}},[s.env,r,t.userSettings,e])};var Lo=ht(Ht());var ie=class extends G{static{this.type="SET_VARIABLES_MODAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.SetVariablesModalConfig;if(!e){this.error="No config!";return}if(e.modelKey==="Sidebar"){let f=re();f&&await wo(f,"#max-ai__ai-provider-floating-button",100,5e3)}let t=o.getShortCutsEngine(),n=t.getVariables(),i=Je(e);i.variables.map(f=>(f.defaultValue&&typeof f.defaultValue=="string"&&(f.defaultValue=Ne(f.defaultValue,n).data||""),f)),i.template=e.template||this.parameters?.compliedTemplate||"";let a=await Io.send("SetVariablesModal",{task:"open",config:i},5*60*1e3);a.success?Object.keys(a.data).forEach(f=>{a.data[f]!==void 0&&t?.setVariable(f,a.data[f],!0)}):(this.error="User cancel!",t?.reset()),this.output=JSON.stringify(a.data)}catch(e){this.error=e.toString()}}};W([Q()],ie.prototype,"execute",1);var se=class extends G{static{this.type="SET_VARIABLE_MAP"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableMap||{},t=o.getShortCutsEngine();t&&t.setVariable&&(Object.keys(e).forEach(n=>{e[n]!==void 0&&t?.setVariable(n,e[n],!0)}),this.output=JSON.stringify(e))}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],se.prototype,"execute",1);var qe=class extends G{static{this.type="URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.output=this.parameters.URLActionURL||this.parameters.LAST_ACTION_OUTPUT,this.output||(this.output="",this.error="No input url")}catch(e){this.error=e.toString()}}};var ae=class extends G{static{this.type="GET_CONTENTS_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.URLActionURL||r.URLActionURL||r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(e&&t){await this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:nt(),extra:{status:"info"}},o);let n=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:e}});n.success?this.output=n?.data?.body||"":this.error=n?.data?.body||""}else this.error=`Could not fetch the page.
Make sure the URL is correct.`;this.output||(this.output="",this.error=`Could not fetch the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],ae.prototype,"execute",1);var ce=class extends G{static{this.type="GET_CONTENTS_OF_SEARCH_ENGINE"}constructor(r,o,e,t){super(r,"GET_CONTENTS_OF_SEARCH_ENGINE",e,t)}async execute(r,o){try{let e=r.compliedTemplate||this.parameters?.URLSearchEngineParams?.q||this.parameters?.URLSearchEngineParams?.query||r.LAST_ACTION_OUTPUT||"",t=o.getBackgroundConversation();if(e&&t){e=e.trim(),e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1));let n=this.parameters.URLSearchEngine||"yahoo",i=this.parameters.URLSearchEngineParams||{},a=this.getFullSearchURL(n,i,e),f=await t.postMessage({event:"ShortCuts_getContentOfSearchEngine",data:{URL:a}}),{status:m,html:c}=f.data||{};if(f.success&&m===200&&c){let u=Eo({html:c,searchEngine:n,limit:Number(i?.limit||3),fullSearchURL:a,query:e});if(u.length<=0){this.output="",this.error="No search results found. Please try again with a different search engine or search query.";return}else{this.output=JSON.stringify(u,null,2);return}}if(this.error="Failed to access the search page. Please try again.",m===301){this.output="",this.error=`<a href="${a}" target="_blank" style="color: inherit">Click here for ${n.replace(/^\w/,u=>u.toUpperCase())}</a>. Pass security checks and keep the tab open for stable web access.`;return}}this.output||(this.output="",this.error="No search results found. Please try again with a different search engine or search query.")}catch(e){this.error=e.toString()}}getFullSearchURL(r,o,e){let t=ns(r),n=rs(r,o,e);return`${t}?${n.toString()}`}};W([He(),z({onlyError:!0}),gt()],ce.prototype,"execute",1);function rs(s,r,o){let e={...r};delete e.limit;let t=o||e.query;switch(delete e.query,delete e.q,e.site&&(t=`site:${e.site} ${t}`),delete e.site,e.region&&e.region!=="wt-wt"&&(s==="google"?t=`location:${e.region} ${t}`:t=`${e.region} ${t}`,delete e.region),s){case"yahoo":{e.p=t;break}case"baidu":{e.wd=t;break}case"naver":case"sogou":{e.query=t;break}case"yandex":{e.text=t;break}case"bing":case"duckduckgo":case"brave":case"google":default:e.q=t}return new URLSearchParams({...e})}function ns(s){switch(s){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://search.yahoo.com/search"}}var We=class extends G{static{this.type="FETCH_ACTIONS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getShortCutsEngine(),t=await To(this.parameters.template||"");e.pushActions(t,"after"),this.output=r.LAST_AI_OUTPUT||""}catch(e){this.error=e.toString()}}};var ue=class extends G{static{this.type="GET_YOUTUBE_TRANSCRIPT_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=window.location.href.includes("youtube.com")?window.location.href:"",t=this.parameters.URLActionURL||e||"";if(!t){this.error="Youtube URL is empty.";return}let n=await Ut.fetchTranscript(t);if((n.length<=10?n.map(a=>a.text).join("").trim()==="":!1)&&t&&t.startsWith("https://")){let a=await to(t,{parse:"text"});a.success&&a.data&&(n=[{start:"",duration:"",text:await mr()}])}if(n.length>0){let a=await Ut.transcriptFormat(n),{getChartGPT:f,getShortCutsEngine:m}=o;if(m()?.getNextAction?.()?.type==="ASK_CHATGPT"){let c=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;await f()?.updateConversation({meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
\`\`\`
${a}
\`\`\``}},c)}this.output=a}}catch(e){this.error=e.toString()}}};W([Q(),z({onlyError:!0}),gt()],ue.prototype,"execute",1);var Ve=class extends G{static{this.type="OPEN_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",t=r.URLActionActiveTab||this.parameters.URLActionActiveTab;if(!e){this.error="No open url";return}e==="current_page"?this.output=await zr({key:"current_page"})||void 0:this.output=await zr({url:e,active:t})||void 0}catch(e){this.error=e.toString()}}};var ze=class extends G{static{this.type="CLOSE_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.OperationElementTabID||this.parameters.OperationElementTabID,t=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",n=await Wn({tabId:e,url:t});n?.success||(this.error=n?.message)}catch(e){this.error=e.toString()}}};var le=class extends G{static{this.type="GET_READABILITY_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=await hr()||await mr();this.output=e}catch(e){this.error=e.toString()}}};W([Q(),z({onlyError:!0}),gt()],le.prototype,"execute",1);var fe=class extends G{static{this.type="GET_EMAIL_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await hr()||await oo(e);this.output=t}catch(t){this.error=t.toString()}}};W([Q(),z({onlyError:!0}),gt()],fe.prototype,"execute",1);var pe=class extends G{static{this.type="GET_EMAIL_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";if(e){let t=await no(e);this.output=t}else this.output=""}catch(e){this.error=e.toString()}}};W([Q(),z({onlyError:!0}),gt()],pe.prototype,"execute",1);var os=s=>{if(s.length>0){let r=[];s.forEach((t,n)=>{let{content:i,author:a}=t;r.push({text:`[Comment ${n+1}]
**Author:** ${a}
**Comment:**
${i}`,data:t})});let o=r[r.length-1],e=r.slice(0,r.length-1);return{last:o,lastText:r[r.length-1].text,previous:e,previousText:e.map(t=>t.text).join(`

`),fullText:r.join(`

`)}}return null},K=class{constructor(r,o){this.commentList=[];let{postTitle:e="Post",postContentTagName:t="Post caption/description",meta:n={}}=o||{};this.config={postTitle:e,postContentTagName:t,meta:n},this.post=r}static get emptyData(){return{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",postText:""}}addCommentList(r){this.commentList.push(r)}get data(){let{content:r,author:o,title:e}=this.post,t=os(this.commentList?.[0]||[]),n="";return n+=`[${this.config.postTitle}]`,n+=`
**Post author:** ${o||"N/A"}`,n+=`
**Post title:** ${e||"N/A"}`,n+=`
**${this.config.postContentTagName}:**
${r||"N/A"}`,Object.keys(this.config.meta||{}).forEach(i=>{n+=`
**${i}:**
${this.config.meta?.[i]||"N/A"}`}),t?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.lastText,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.previousText?`${n}

${t.previousText}

${t.lastText}`:`${n}

${t.lastText}`,post:this.post,postText:n,replyCommentText:t.last.text,replyComment:t.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:t.previousText}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:n,post:this.post,postText:n,previousComments:this.commentList?.[0]||[],previousCommentsText:t?.previousText}}};var Oo=s=>{let r=s.querySelector('div[data-testid="User-Name"]'),[o,e]=Un(Array.from(r?.querySelectorAll("span")).map(i=>i.textContent||"").filter(i=>i&&i!=="\xB7")),t=s.querySelector("time")?.dateTime||"",n=s.querySelector('div[data-testid="tweetText"]').innerText;return{author:`${o}(${e})`,date:t,content:n,title:""}},Do=async s=>{let r=rt('article[data-testid="tweet"]',s);if(r){let o=[],e=st('div[data-testid="cellInnerDiv"]',r,5);for(;e;){if(e?.getAttribute("data-testid")==="cellInnerDiv"){let t=e.querySelector('article[data-testid="tweet"]');t&&o.splice(0,0,Oo(t))}e=e.previousElementSibling}if(o.length>0){let t=o.shift(),n=new K(t);return n.addCommentList(o),n.data}else return new K(Oo(r)).data}return K.emptyData},Uo=s=>rt("div.DraftEditor-editorContainer",s,30)?.innerText||"",Pu=s=>{let r=Array.from(document.querySelectorAll('div[role="progressbar"]')),o=null;for(let e=0;e<r.length;e++){let t=r[e];if(t.parentElement?.contains(s)){o=t.parentElement;break}}return o};var ko=async s=>{let r=(s.querySelector("span.comments-post-meta__name span:not(.visually-hidden)")?.innerText||"").split(`
`)[0],o=s.querySelector("time")?.innerText||"",e=s.querySelector("& > .comments-reply-item-content-body button.see-more");e&&(e.click(),await bt(100));let t=s.querySelector("& > div.comments-comment-item-content-body")?.innerText||s.querySelector("& > div.comments-reply-item-content-body")?.innerText;return{author:r||"",date:o||"",content:t||""}},Fo=async s=>{let r=rt(".comments-comment-box",s),o=rt(".social-details-social-activity",r);if(r&&o){let e=rt(".feed-shared-update-v2__description-wrapper",r);if(e){let t=e?.parentElement,n=t?.querySelector('button[role="button"].see-more');n&&(n.click(),await bt(100,s));let i=t?.querySelector(".update-components-actor__name span:not(.visually-hidden)")?.textContent||"",a=e?.innerText||"",f=(t?.querySelector("div.ml4.mt2.text-body-xsmall")?.innerText||"").split("\u2022")?.[0],m=new K({author:i,content:a,title:"",date:f});if(r.parentElement?.classList.contains("comments-comment-item__nested-items")){let c=[],u=st("article.comments-comment-item",s),p=u?.querySelector('div.editor-content div[contenteditable="true"]')?.innerText||"";if(c.push(await ko(u)),p){let g=Array.from(u.querySelectorAll("article"));for(let x=0;x<g.length;x++){let w=g[x],E=await ko(w);if(p.startsWith(E.author)){c.push(E);break}}}await bt(0,s),m.addCommentList(c)}return m.data}}return K.emptyData},No=s=>rt("div.ql-editor",s,30)?.innerText||"";var tn=async s=>{let r=s?.querySelector("a > span > span")?.innerText||"",o=s?.querySelector("span[lang][dir]")?.innerText||"",e=Array.from(s?.querySelectorAll("a > span")),t=e[e.length-1]?.innerText||"";return{content:o,author:r,date:t}},Ho=async s=>{let r=rt('form[role="presentation"]',s),o=rt('div[data-ad-preview="message"]',r,30),e=rt("span:has(h3 > span)",r,30),t=e||rt("span:has(h4 > div)",r,30),n=t?.innerText||"",i=e?t?.nextElementSibling?.querySelector("a")?.innerText:t?.parentElement?.nextElementSibling?.querySelectorAll("a")?.[1]?.innerText||"",a=o?.querySelector('div[dir] > div[role="button"]');a&&(a.click(),await bt(100,s));let f=o?.innerText||"",m=[],c=new K({author:n,date:i,content:f,title:""});if(r){let l=r.querySelector('div[contenteditable="true"][role="textbox"]')?.innerText||"",p=st("li",r,10);for(;p;){let g=p.childNodes[0];if(g){let x=await tn(g);if(m.length===0&&!l.startsWith(x.author)&&p&&l){let w=Array.from(p.querySelectorAll("& > div > ul li > div"));for(let E=0;E<w.length;E++){let U=w[E],M=await tn(U);if(l.startsWith(M.author)){m.push(M);break}}}if(m.splice(0,0,x),p?.parentElement){p=st("li",p.parentElement,10);continue}}break}if(l.replace(`
`,"")&&!m.length){let g=rt('div[role="article"]',r),x=await tn(g);l.startsWith(x.author)&&m.push(x)}c.addCommentList(m)}return c.data},Go=s=>rt('div[contenteditable="true"]',s,30)?.innerText||"";var en=async s=>{let r=s.querySelector("#header-author #author-text > span")?.innerText||"",o=s.querySelector("#header-author > yt-formatted-string")?.innerText||"",e=s?.querySelector("tp-yt-paper-button#expand");e&&(e.click(),await bt(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Bo=async s=>{try{let r=st("ytd-commentbox",s),o=Ut.retrieveVideoId(window.location.href),e=null;if(o){let t=await Ut.transcriptFormat(await Ut.fetchTranscript(window.location.href),2048),n=document.querySelector("ytd-watch-metadata"),i=n?.querySelector("#title > h1")?.innerText||document.title,a=document.querySelector("ytd-video-owner-renderer"),f=a?.querySelector("yt-formatted-string")?.textContent,m=n?.querySelector("tp-yt-paper-button#expand");m&&(m.click(),await bt(100,s));let c=a?.querySelector("a")?.getAttribute("href")?.includes("@")&&a?.querySelector("a")?.getAttribute("href")?.split("/")[1],u=n?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",l=n?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||"";e=new K({title:i,author:`${f}(${c})`,date:u,content:l},{postTitle:"Video post",meta:{"Post video transcript":t}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let n=st("ytd-reel-video-renderer",s,50)?.querySelector("ytd-reel-player-header-renderer");if(n){let i=n?.querySelector(".title > yt-formatted-string")?.innerText||"",a=n?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";e=new K({title:i,author:a,date:"",content:""},{postTitle:"Video post"})}}if(r&&e){if(!st("ytd-comment-simplebox-renderer",r,5)){let t=st("ytd-comment-thread-renderer",r)?.querySelector("& > ytd-comment-renderer");if(t){let n=st("ytd-comment-renderer",r);n&&(rt("ytd-comment-replies-renderer",n,5)?.contains(n)&&!n.isSameNode(t)?e.addCommentList([await en(t),await en(n)]):e.addCommentList([await en(t)]))}}return e.data}}catch{}return K.emptyData},qo=s=>rt('div#contenteditable-root[contenteditable="true"]',s,30)?.innerText||"";var rn=async s=>{let r=s.querySelector("#badge-name")?.innerText||s.querySelector("#name")?.innerText||"",o=s.querySelector("yt-formatted-string.published-time-text")?.innerText||"",e=s?.querySelector("ytcp-button#more");e&&(e.click(),await bt(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Wo=async s=>{try{let r=st("ytcp-commentbox",s);if(!r)return K.emptyData;let o=st("ytcp-comment-thread",r),e=o?.querySelector("ytcp-comment-button > a[href]"),t=Ut.retrieveVideoId(e?.href||""),n=null;if(t){let i=await Ut.transcriptFormat(await Ut.fetchTranscript(window.location.href),2048),a=o?.querySelector("#video-title > yt-formatted-string")?.innerText||"",f=document.querySelector("#entity-name")?.innerText,m="";n=new K({title:a,author:`${f}`,date:m,content:""},{postTitle:"Video post",meta:{"Post video transcript":i}})}if(r&&n){let i=st("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(i){let a=st("ytcp-comment",r);a&&(rt("ytcp-comment-replies",a,5)?.contains(a)&&!a.isSameNode(i)?n.addCommentList([await rn(i),await rn(a)]):n.addCommentList([await rn(i)]))}return n.data}}catch{}return K.emptyData},Vo=s=>rt("textarea#textarea",s,30)?.innerText||"";var Er=async s=>{let r=Array.from(s.querySelectorAll("a")).find(i=>i.innerText.trim()!=="")?.innerText||"",o=s.querySelector("time"),e="",t="",n=s.querySelector('div[role="button"][tabindex="0"]');return n&&n?.innerText==="more"&&(n.click(),await bt(500)),o&&(t=o?.dateTime||"",e=st("div",o)?.nextElementSibling?.innerText||""),e||(e=(s.querySelector("h3")||s.querySelector("h2"))?.nextElementSibling?.innerText||""),e||(e=s.querySelector("span[dir] > span[dir]")?.innerText||""),{content:e,author:r.startsWith("@")?r:`${r?`@${r}`:""}`,date:t}},zo=async s=>{let r=st("section",s),o=r?.querySelector("textarea")?.value||"",e=r?.parentElement?.parentElement;if(e){let t=e.querySelector("hr")?Array.from(e?.querySelectorAll("hr + div > div > div > div")):Array.from(e?.querySelectorAll("section + div > ul > *")),[n,...i]=t;if(!n){let m=e.querySelector("div:has( > span[dir] > span[dir])");if(m){let c=await Er(m);return new K({author:c.author,content:c.content,title:"",date:c.date}).data}else return K.emptyData}let a=await Er(n),f=new K({author:a.author,content:a.content,title:"",date:a.date});if(o.startsWith("@")){let m=o.split(" ")?.[0],c=[];for(let u=0;u<i.length;u++){let l=!1,p=await Er(i[u]);m.startsWith(p.author)&&(c.push(p),l=!0);let g=Array.from(i[u+1]?.querySelectorAll("ul > div"));if(g.length>0)for(let x=0;x<g.length;x++){let w=await Er(g[x]);if(m.startsWith(w.author)){c.push(p),c.push(w),l=!0;break}}if(l)break}f.addCommentList(c)}return f.data}return K.emptyData},$o=s=>{let r=rt('div[contenteditable="true"]',s,20);return r?r?.innerText||"":rt("form textarea",s,20)?.value};var Qo=async s=>{let r=document.querySelector(s);if(!r)return K.emptyData;let o=ee();return o==="twitter.com"?await Do(r):o==="linkedin.com"?await Fo(r):o==="facebook.com"?await Ho(r):o==="youtube.com"?await Bo(r):o==="studio.youtube.com"?await Wo(r):o==="instagram.com"?await zo(r):K.emptyData},jo=async s=>{let r=ee(),o=document.querySelector(s);return o?r==="twitter.com"?Uo(o):r==="linkedin.com"?No(o):r==="facebook.com"?Go(o):r==="youtube.com"?qo(o):r==="studio.youtube.com"?Vo(o):r==="instagram.com"?$o(o):"":""};var me=class extends G{static{this.type="GET_SOCIAL_MEDIA_POST_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await jo(e);this.output=t}catch(t){this.error=t.toString()}}};W([Q(),z({onlyError:!0}),gt()],me.prototype,"execute",1);var he=class extends G{static{this.type="GET_SOCIAL_MEDIA_POST_CONTENT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Qo(e),n=o.getShortCutsEngine();n&&n.pushActions([{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}}}],"after"),this.output=t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}catch(t){this.error=t.toString()}}};W([Q(),z({onlyError:!0}),gt()],he.prototype,"execute",1);var de=class extends G{static{this.type="WEBGPT_SEARCH_RESULTS_EXPAND"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(!e||!t){this.error="no search result";return}let n=this.parameters.SummarizeActionType||"NO_SUMMARIZE",i=JSON.parse(e),a="",f=[];for(let m=0;m<i.length;m++){let c=i[m];n==="NO_SUMMARIZE"&&(f.push({type:"RENDER_TEMPLATE",parameters:{template:c.body}}),f.push({type:"SET_VARIABLE",parameters:{VariableName:`SLICE_OF_TEXT_${m}`}}),a+=`NUMBER:${m+1}
URL: ${c.url}
TITLE: ${c.title}
CONTENT: {{SLICE_OF_TEXT_${m}}}

`)}if(f.push({type:"RENDER_TEMPLATE",parameters:{template:a}}),o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(f,"after");else{this.error="no shortCutsEngine";return}this.output=a}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],de.prototype,"execute",1);var xr=class{constructor(r){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=r.pageContent?r.pageContent.toString():this.pageContent,this.metadata=r.metadata??{}}};var is=Object.defineProperty,ss=(s,r,o)=>r in s?is(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,Ko=(s,r,o)=>(ss(s,typeof r!="symbol"?r+"":r,o),o);var Jo=ht(Zo(),1);function hs(s,r){let o=Array.from({length:s.length},(e,t)=>({start:t,end:t+1}));for(;o.length>1;){let e=null;for(let t=0;t<o.length-1;t++){let n=s.slice(o[t].start,o[t+1].end),i=r.get(n.join(","));i!=null&&(e==null||i<e[0])&&(e=[i,t])}if(e!=null){let t=e[1];o[t]={start:o[t].start,end:o[t+1].end},o.splice(t+1,1)}else break}return o}function ds(s,r){return s.length===1?[r.get(s.join(","))]:hs(s,r).map(o=>r.get(s.slice(o.start,o.end).join(","))).filter(o=>o!=null)}function gs(s){return s.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var on=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(s,r){this.patStr=s.pat_str;let o=s.bpe_ranks.split(`
`).filter(Boolean).reduce((e,t)=>{let[n,i,...a]=t.split(" "),f=Number.parseInt(i,10);return a.forEach((m,c)=>e[m]=f+c),e},{});for(let[e,t]of Object.entries(o)){let n=Jo.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...s.special_tokens,...r},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(s,r=[],o="all"){let e=new RegExp(this.patStr,"ug"),t=on.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(r==="all"?Object.keys(this.specialTokens):r),a=new Set(o==="all"?Object.keys(this.specialTokens).filter(m=>!i.has(m)):o);if(a.size>0){let m=on.specialTokenRegex([...a]),c=s.match(m);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let f=0;for(;;){let m=null,c=f;for(;t.lastIndex=c,m=t.exec(s),!(m==null||i.has(m[0]));)c=m.index+1;let u=m?.index??s.length;for(let p of s.substring(f,u).matchAll(e)){let g=this.textEncoder.encode(p[0]),x=this.rankMap.get(g.join(","));if(x!=null){n.push(x);continue}n.push(...ds(g,this.rankMap))}if(m==null)break;let l=this.specialTokens[m[0]];n.push(l),f=m.index+m[0].length}return n}decode(s){let r=[],o=0;for(let n=0;n<s.length;++n){let i=s[n],a=this.textMap.get(i)??this.inverseSpecialTokens[i];a!=null&&(r.push(a),o+=a.length)}let e=new Uint8Array(o),t=0;for(let n of r)e.set(n,t),t+=n.length;return this.textDecoder.decode(e)}},sn=on;Ko(sn,"specialTokenRegex",s=>new RegExp(s.map(r=>gs(r)).join("|"),"g"));var Rs=ht(si(),1),Ls=ht(gi(),1);var mn=class{constructor(r){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),this.chunkSize=r?.chunkSize??this.chunkSize,this.chunkOverlap=r?.chunkOverlap??this.chunkOverlap,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async createDocuments(r,o=[],e={}){let t=o.length>0?o:new Array(r.length).fill({}),{chunkHeader:n="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:a=!1}=e,f=new Array;for(let m=0;m<r.length;m+=1){let c=r[m],u=1,l=null;for(let p of await this.splitText(c)){let g=n,x=0;if(l){let M=c.indexOf(p),P=c.indexOf(l)+l.length;x=(c.slice(P,M).match(/\n/g)||[]).length,a&&(g+=i)}u+=x;let w=(p.match(/\n/g)||[]).length,E=t[m].loc&&typeof t[m].loc=="object"?{...t[m].loc}:{};E.lines={from:u,to:u+w};let U={...t[m],loc:E};g+=p,f.push(new xr({pageContent:g,metadata:U})),u+=w,l=p}}return f}async splitDocuments(r,o={}){let e=r.filter(i=>i.pageContent!==void 0),t=e.map(i=>i.pageContent),n=e.map(i=>i.metadata);return this.createDocuments(t,n,o)}joinDocs(r,o){let e=r.join(o).trim();return e===""?null:e}mergeSplits(r,o){let e=[],t=[],n=0;for(let a of r){let f=a.length;if(n+f+(t.length>0?o.length:0)>this.chunkSize&&(n>this.chunkSize,t.length>0)){let m=this.joinDocs(t,o);for(m!==null&&e.push(m);n>this.chunkOverlap||n+f>this.chunkSize&&n>0;)n-=t[0].length,t.shift()}t.push(a),n+=f}let i=this.joinDocs(t,o);return i!==null&&e.push(i),e}};var Mr=class extends mn{constructor(r){super(r),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=r?.separators??this.separators}async splitText(r){let o=[],e=this.separators[this.separators.length-1];for(let i of this.separators){if(i===""){e=i;break}if(r.includes(i)){e=i;break}}let t;e?t=r.split(e):t=r.split("");let n=[];for(let i of t)if(i.length<this.chunkSize)n.push(i);else{if(n.length){let f=this.mergeSplits(n,e);o.push(...f),n=[]}let a=await this.splitText(i);o.push(...a)}if(n.length){let i=this.mergeSplits(n,e);o.push(...i)}return o}};var yi=async(s,r=1e3)=>{try{let o=s;return{docs:await new Mr({chunkSize:r}).createDocuments([o])}}catch{return{docs:[]}}};var Os=6e3,Ds=async(s,r,o)=>{let e=nt(),t=[],{docs:n}=await yi(s,o);(r==="STUFF"||r==="REFINE")&&n.splice(1);let i="",a=Math.ceil(o/n.length);return n.length===1?t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${n[0].pageContent}
"""`}}):(n.forEach(({pageContent:f},m)=>{let c=f||"";c&&(t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${c}
"""`}}),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_PART_${m}_ID_${e}`}}),i+=`{{SUMMARIZE_TEXT_PART_${m}_ID_${e}}}
`)}),t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (probably an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${o} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${i}
"""`}})),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_ID_${e}`}}),{variableName:`SUMMARIZE_TEXT_ID_${e}`,actions:t}},Ae=class extends G{static{this.type="SUMMARIZE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"",t=this.parameters.SummarizeActionType||"STUFF";if(!e){this.error="No text to summarize";return}let{actions:n}=await Ds(e,t,this.parameters.SliceTextActionType==="TOKENS"?await Hn(e,this.parameters.SliceTextActionTokens):this.parameters.SliceTextActionLength||Os);if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(n.map(i=>({...i,parameters:{...i.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=""}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],Ae.prototype,"execute",1);var Us=6e3,Te=class extends G{static{this.type="SLICE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"";if(!e){this.output="";return}if(this.parameters.SliceTextActionType==="TOKENS"||this.parameters.SliceTextActionTokens)this.output=await tr(e,this.parameters.SliceTextActionTokens||4096);else{let t=this.parameters.SliceTextActionLength||Us;this.output=e.slice(0,t)}}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],Te.prototype,"execute",1);var Ai=new Ue,Ti=async s=>(await Ai.postMessage({event:"WebsiteContext_createWebsiteContext",data:{websiteContext:{url:window.location.href||location.href||document.location.href,host:ee(),html:document.documentElement.outerHTML,...s}}})).data;var Ci=async(s,r)=>s.id?(await Ai.postMessage({event:"WebsiteContext_updateWebsiteContext",data:{query:s,websiteContext:r}})).success:!1;function ks(s,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in s)){var t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(s,e,t.get?t:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(s)}function xi(s,r){return new Promise(function(o,e){let t;return Fs(s).then(function(n){try{return t=n,o(new Blob([r.slice(0,2),t,r.slice(2)],{type:"image/jpeg"}))}catch(i){return e(i)}},e)})}var Fs=s=>new Promise((r,o)=>{let e=new FileReader;e.addEventListener("load",({target:{result:t}})=>{let n=new DataView(t),i=0;if(n.getUint16(i)!==65496)return o("not a valid JPEG");for(i+=2;;){let a=n.getUint16(i);if(a===65498)break;let f=n.getUint16(i+2);if(a===65505&&n.getUint32(i+4)===1165519206){let m=i+10,c;switch(n.getUint16(m)){case 18761:c=!0;break;case 19789:c=!1;break;default:return o("TIFF header contains invalid endian")}if(n.getUint16(m+2,c)!==42)return o("TIFF header contains invalid version");let u=n.getUint32(m+4,c),l=m+u+2+12*n.getUint16(m+u,c);for(let p=m+u+2;p<l;p+=12)if(n.getUint16(p,c)==274){if(n.getUint16(p+2,c)!==3)return o("Orientation data type is invalid");if(n.getUint32(p+4,c)!==1)return o("Orientation data count is invalid");n.setUint16(p+8,1,c);break}return r(t.slice(i,i+2+f))}i+=2+f}return r(new Blob)}),e.readAsArrayBuffer(s)}),Lr={},Ns={get exports(){return Lr},set exports(s){Lr=s}};(function(s){var r,o,e={};Ns.exports=e,e.parse=function(t,n){for(var i=e.bin.readUshort,a=e.bin.readUint,f=0,m={},c=new Uint8Array(t),u=c.length-4;a(c,u)!=101010256;)u--;f=u,f+=4;var l=i(c,f+=4);i(c,f+=2);var p=a(c,f+=2),g=a(c,f+=4);f+=4,f=g;for(var x=0;x<l;x++){a(c,f),f+=4,f+=4,f+=4,a(c,f+=4),p=a(c,f+=4);var w=a(c,f+=4),E=i(c,f+=4),U=i(c,f+2),M=i(c,f+4);f+=6;var P=a(c,f+=8);f+=4,f+=E+U+M,e._readLocal(c,P,m,p,w,n)}return m},e._readLocal=function(t,n,i,a,f,m){var c=e.bin.readUshort,u=e.bin.readUint;u(t,n),c(t,n+=4),c(t,n+=2);var l=c(t,n+=2);u(t,n+=2),u(t,n+=4),n+=4;var p=c(t,n+=8),g=c(t,n+=2);n+=2;var x=e.bin.readUTF8(t,n,p);if(n+=p,n+=g,m)i[x]={size:f,csize:a};else{var w=new Uint8Array(t.buffer,n);if(l==0)i[x]=new Uint8Array(w.buffer.slice(n,n+a));else{if(l!=8)throw"unknown compression method: "+l;var E=new Uint8Array(f);e.inflateRaw(w,E),i[x]=E}}},e.inflateRaw=function(t,n){return e.F.inflate(t,n)},e.inflate=function(t,n){return t[0],t[1],e.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),n)},e.deflate=function(t,n){n==null&&(n={level:6});var i=0,a=new Uint8Array(50+Math.floor(1.1*t.length));a[i]=120,a[i+1]=156,i+=2,i=e.F.deflateRaw(t,a,i,n.level);var f=e.adler(t,0,t.length);return a[i+0]=f>>>24&255,a[i+1]=f>>>16&255,a[i+2]=f>>>8&255,a[i+3]=f>>>0&255,new Uint8Array(a.buffer,0,i+4)},e.deflateRaw=function(t,n){n==null&&(n={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),a=e.F.deflateRaw(t,i,a,n.level);return new Uint8Array(i.buffer,0,a)},e.encode=function(t,n){n==null&&(n=!1);var i=0,a=e.bin.writeUint,f=e.bin.writeUshort,m={};for(var c in t){var u=!e._noNeed(c)&&!n,l=t[c],p=e.crc.crc(l,0,l.length);m[c]={cpr:u,usize:l.length,crc:p,file:u?e.deflateRaw(l):l}}for(var c in m)i+=m[c].file.length+30+46+2*e.bin.sizeUTF8(c);i+=22;var g=new Uint8Array(i),x=0,w=[];for(var c in m){var E=m[c];w.push(x),x=e._writeHeader(g,x,c,E,0)}var U=0,M=x;for(var c in m)E=m[c],w.push(x),x=e._writeHeader(g,x,c,E,1,w[U++]);var P=x-M;return a(g,x,101010256),x+=4,f(g,x+=4,U),f(g,x+=2,U),a(g,x+=2,P),a(g,x+=4,M),x+=4,x+=2,g.buffer},e._noNeed=function(t){var n=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},e._writeHeader=function(t,n,i,a,f,m){var c=e.bin.writeUint,u=e.bin.writeUshort,l=a.file;return c(t,n,f==0?67324752:33639248),n+=4,f==1&&(n+=2),u(t,n,20),u(t,n+=2,0),u(t,n+=2,a.cpr?8:0),c(t,n+=2,0),c(t,n+=4,a.crc),c(t,n+=4,l.length),c(t,n+=4,a.usize),u(t,n+=4,e.bin.sizeUTF8(i)),u(t,n+=2,0),n+=2,f==1&&(n+=2,n+=2,c(t,n+=6,m),n+=4),n+=e.bin.writeUTF8(t,n,i),f==0&&(t.set(l,n),n+=l.length),n},e.crc={table:function(){for(var t=new Uint32Array(256),n=0;n<256;n++){for(var i=n,a=0;a<8;a++)1&i?i=3988292384^i>>>1:i>>>=1;t[n]=i}return t}(),update:function(t,n,i,a){for(var f=0;f<a;f++)t=e.crc.table[255&(t^n[i+f])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.adler=function(t,n,i){for(var a=1,f=0,m=n,c=n+i;m<c;){for(var u=Math.min(m+5552,c);m<u;)f+=a+=t[m++];a%=65521,f%=65521}return f<<16|a},e.bin={readUshort:function(t,n){return t[n]|t[n+1]<<8},writeUshort:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255},readUint:function(t,n){return 16777216*t[n+3]+(t[n+2]<<16|t[n+1]<<8|t[n])},writeUint:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255,t[n+2]=i>>16&255,t[n+3]=i>>24&255},readASCII:function(t,n,i){for(var a="",f=0;f<i;f++)a+=String.fromCharCode(t[n+f]);return a},writeASCII:function(t,n,i){for(var a=0;a<i.length;a++)t[n+a]=i.charCodeAt(a)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,n,i){for(var a,f="",m=0;m<i;m++)f+="%"+e.bin.pad(t[n+m].toString(16));try{a=decodeURIComponent(f)}catch{return e.bin.readASCII(t,n,i)}return a},writeUTF8:function(t,n,i){for(var a=i.length,f=0,m=0;m<a;m++){var c=i.charCodeAt(m);if(!(4294967168&c))t[n+f]=c,f++;else if(!(4294965248&c))t[n+f]=192|c>>6,t[n+f+1]=128|c>>0&63,f+=2;else if(!(4294901760&c))t[n+f]=224|c>>12,t[n+f+1]=128|c>>6&63,t[n+f+2]=128|c>>0&63,f+=3;else{if(4292870144&c)throw"e";t[n+f]=240|c>>18,t[n+f+1]=128|c>>12&63,t[n+f+2]=128|c>>6&63,t[n+f+3]=128|c>>0&63,f+=4}}return f},sizeUTF8:function(t){for(var n=t.length,i=0,a=0;a<n;a++){var f=t.charCodeAt(a);if(!(4294967168&f))i++;else if(!(4294965248&f))i+=2;else if(!(4294901760&f))i+=3;else{if(4292870144&f)throw"e";i+=4}}return i}},e.F={},e.F.deflateRaw=function(t,n,i,a){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],m=e.F.U,c=e.F._goodIndex;e.F._hash;var u=e.F._putsE,l=0,p=i<<3,g=0,x=t.length;if(a==0){for(;l<x;)u(n,p,l+(S=Math.min(65535,x-l))==x?1:0),p=e.F._copyExact(t,l,S,n,p+8),l+=S;return p>>>3}var w=m.lits,E=m.strt,U=m.prev,M=0,P=0,O=0,C=0,L=0,y=0;for(x>2&&(E[y=e.F._hash(t,0)]=0),l=0;l<x;l++){if(L=y,l+1<x-2){y=e.F._hash(t,l+1);var d=l+1&32767;U[d]=E[y],E[y]=d}if(g<=l){(M>14e3||P>26697)&&x-l>100&&(g<l&&(w[M]=l-g,M+=2,g=l),p=e.F._writeBlock(l==x-1||g==x?1:0,w,M,C,t,O,l-O,n,p),M=P=C=0,O=l);var v=0;l<x-2&&(v=e.F._bestMatch(t,l,U,L,Math.min(f[2],x-l),f[3]));var S=v>>>16,b=65535&v;if(v!=0){b=65535&v;var I=c(S=v>>>16,m.of0);m.lhst[257+I]++;var T=c(b,m.df0);m.dhst[T]++,C+=m.exb[I]+m.dxb[T],w[M]=S<<23|l-g,w[M+1]=b<<16|I<<8|T,M+=2,g=l+S}else m.lhst[t[l]]++;P++}}for(O==l&&t.length!=0||(g<l&&(w[M]=l-g,M+=2,g=l),p=e.F._writeBlock(1,w,M,C,t,O,l-O,n,p),M=0,P=0,M=P=C=0,O=l);7&p;)p++;return p>>>3},e.F._bestMatch=function(t,n,i,a,f,m){var c=32767&n,u=i[c],l=c-u+32768&32767;if(u==c||a!=e.F._hash(t,n-l))return 0;for(var p=0,g=0,x=Math.min(32767,n);l<=x&&--m!=0&&u!=c;){if(p==0||t[n+p]==t[n+p-l]){var w=e.F._howLong(t,n,l);if(w>p){if(g=l,(p=w)>=f)break;l+2<w&&(w=l+2);for(var E=0,U=0;U<w-2;U++){var M=n-l+U+32768&32767,P=M-i[M]+32768&32767;P>E&&(E=P,u=M)}}}l+=(c=u)-(u=i[c])+32768&32767}return p<<16|g},e.F._howLong=function(t,n,i){if(t[n]!=t[n-i]||t[n+1]!=t[n+1-i]||t[n+2]!=t[n+2-i])return 0;var a=n,f=Math.min(t.length,n+258);for(n+=3;n<f&&t[n]==t[n-i];)n++;return n-a},e.F._hash=function(t,n){return(t[n]<<8|t[n+1])+(t[n+2]<<4)&65535},e.saved=0,e.F._writeBlock=function(t,n,i,a,f,m,c,u,l){var p,g,x,w,E,U,M,P,O,C=e.F.U,L=e.F._putsF,y=e.F._putsE;C.lhst[256]++,g=(p=e.F.getTrees())[0],x=p[1],w=p[2],E=p[3],U=p[4],M=p[5],P=p[6],O=p[7];var d=32+(l+3&7?8-(l+3&7):0)+(c<<3),v=a+e.F.contSize(C.fltree,C.lhst)+e.F.contSize(C.fdtree,C.dhst),S=a+e.F.contSize(C.ltree,C.lhst)+e.F.contSize(C.dtree,C.dhst);S+=14+3*M+e.F.contSize(C.itree,C.ihst)+(2*C.ihst[16]+3*C.ihst[17]+7*C.ihst[18]);for(var b=0;b<286;b++)C.lhst[b]=0;for(b=0;b<30;b++)C.dhst[b]=0;for(b=0;b<19;b++)C.ihst[b]=0;var I=d<v&&d<S?0:v<S?1:2;if(L(u,l,t),L(u,l+1,I),l+=3,I==0){for(;7&l;)l++;l=e.F._copyExact(f,m,c,u,l)}else{var T,_;if(I==1&&(T=C.fltree,_=C.fdtree),I==2){e.F.makeCodes(C.ltree,g),e.F.revCodes(C.ltree,g),e.F.makeCodes(C.dtree,x),e.F.revCodes(C.dtree,x),e.F.makeCodes(C.itree,w),e.F.revCodes(C.itree,w),T=C.ltree,_=C.dtree,y(u,l,E-257),y(u,l+=5,U-1),y(u,l+=5,M-4),l+=4;for(var A=0;A<M;A++)y(u,l+3*A,C.itree[1+(C.ordr[A]<<1)]);l+=3*M,l=e.F._codeTiny(P,C.itree,u,l),l=e.F._codeTiny(O,C.itree,u,l)}for(var h=m,k=0;k<i;k+=2){for(var R=n[k],F=R>>>23,q=h+(8388607&R);h<q;)l=e.F._writeLit(f[h++],T,u,l);if(F!=0){var H=n[k+1],B=H>>16,N=H>>8&255,D=255&H;y(u,l=e.F._writeLit(257+N,T,u,l),F-C.of0[N]),l+=C.exb[N],L(u,l=e.F._writeLit(D,_,u,l),B-C.df0[D]),l+=C.dxb[D],h+=F}}l=e.F._writeLit(256,T,u,l)}return l},e.F._copyExact=function(t,n,i,a,f){var m=f>>>3;return a[m]=i,a[m+1]=i>>>8,a[m+2]=255-a[m],a[m+3]=255-a[m+1],m+=4,a.set(new Uint8Array(t.buffer,n,i),m),f+(i+4<<3)},e.F.getTrees=function(){for(var t=e.F.U,n=e.F._hufTree(t.lhst,t.ltree,15),i=e.F._hufTree(t.dhst,t.dtree,15),a=[],f=e.F._lenCodes(t.ltree,a),m=[],c=e.F._lenCodes(t.dtree,m),u=0;u<a.length;u+=2)t.ihst[a[u]]++;for(u=0;u<m.length;u+=2)t.ihst[m[u]]++;for(var l=e.F._hufTree(t.ihst,t.itree,7),p=19;p>4&&t.itree[1+(t.ordr[p-1]<<1)]==0;)p--;return[n,i,l,f,c,p,a,m]},e.F.getSecond=function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(t[i+1]);return n},e.F.nonZero=function(t){for(var n="",i=0;i<t.length;i+=2)t[i+1]!=0&&(n+=(i>>1)+",");return n},e.F.contSize=function(t,n){for(var i=0,a=0;a<n.length;a++)i+=n[a]*t[1+(a<<1)];return i},e.F._codeTiny=function(t,n,i,a){for(var f=0;f<t.length;f+=2){var m=t[f],c=t[f+1];a=e.F._writeLit(m,n,i,a);var u=m==16?2:m==17?3:7;m>15&&(e.F._putsE(i,a,c,u),a+=u)}return a},e.F._lenCodes=function(t,n){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var a=0;a<i;a+=2){var f=t[a+1],m=a+3<i?t[a+3]:-1,c=a+5<i?t[a+5]:-1,u=a==0?-1:t[a-1];if(f==0&&m==f&&c==f){for(var l=a+5;l+2<i&&t[l+2]==f;)l+=2;(p=Math.min(l+1-a>>>1,138))<11?n.push(17,p-3):n.push(18,p-11),a+=2*p-2}else if(f==u&&m==f&&c==f){for(l=a+5;l+2<i&&t[l+2]==f;)l+=2;var p=Math.min(l+1-a>>>1,6);n.push(16,p-3),a+=2*p-2}else n.push(f,0)}return i>>>1},e.F._hufTree=function(t,n,i){var a=[],f=t.length,m=n.length,c=0;for(c=0;c<m;c+=2)n[c]=0,n[c+1]=0;for(c=0;c<f;c++)t[c]!=0&&a.push({lit:c,f:t[c]});var u=a.length,l=a.slice(0);if(u==0)return 0;if(u==1){var p=a[0].lit;return l=p==0?1:0,n[1+(p<<1)]=1,n[1+(l<<1)]=1,1}a.sort(function(P,O){return P.f-O.f});var g=a[0],x=a[1],w=0,E=1,U=2;for(a[0]={lit:-1,f:g.f+x.f,l:g,r:x,d:0};E!=u-1;)g=w!=E&&(U==u||a[w].f<a[U].f)?a[w++]:a[U++],x=w!=E&&(U==u||a[w].f<a[U].f)?a[w++]:a[U++],a[E++]={lit:-1,f:g.f+x.f,l:g,r:x};var M=e.F.setDepth(a[E-1],0);for(M>i&&(e.F.restrictDepth(l,i,M),M=i),c=0;c<u;c++)n[1+(l[c].lit<<1)]=l[c].d;return M},e.F.setDepth=function(t,n){return t.lit!=-1?(t.d=n,n):Math.max(e.F.setDepth(t.l,n+1),e.F.setDepth(t.r,n+1))},e.F.restrictDepth=function(t,n,i){var a=0,f=1<<i-n,m=0;for(t.sort(function(u,l){return l.d==u.d?u.f-l.f:l.d-u.d}),a=0;a<t.length&&t[a].d>n;a++){var c=t[a].d;t[a].d=n,m+=f-(1<<i-c)}for(m>>>=i-n;m>0;)(c=t[a].d)<n?(t[a].d++,m-=1<<n-c-1):a++;for(;a>=0;a--)t[a].d==n&&m<0&&(t[a].d--,m++);m!=0},e.F._goodIndex=function(t,n){var i=0;return n[16|i]<=t&&(i|=16),n[8|i]<=t&&(i|=8),n[4|i]<=t&&(i|=4),n[2|i]<=t&&(i|=2),n[1|i]<=t&&(i|=1),i},e.F._writeLit=function(t,n,i,a){return e.F._putsF(i,a,n[t<<1]),a+n[1+(t<<1)]},e.F.inflate=function(t,n){var i=Uint8Array;if(t[0]==3&&t[1]==0)return n||new i(0);var a=e.F,f=a._bitsF,m=a._bitsE,c=a._decodeTiny,u=a.makeCodes,l=a.codes2map,p=a._get17,g=a.U,x=n==null;x&&(n=new i(t.length>>>2<<3));for(var w,E,U=0,M=0,P=0,O=0,C=0,L=0,y=0,d=0,v=0;U==0;)if(U=f(t,v,1),M=f(t,v+1,2),v+=3,M!=0){if(x&&(n=e.F._check(n,d+(1<<17))),M==1&&(w=g.flmap,E=g.fdmap,L=511,y=31),M==2){P=m(t,v,5)+257,O=m(t,v+5,5)+1,C=m(t,v+10,4)+4,v+=14;for(var S=0;S<38;S+=2)g.itree[S]=0,g.itree[S+1]=0;var b=1;for(S=0;S<C;S++){var I=m(t,v+3*S,3);g.itree[1+(g.ordr[S]<<1)]=I,I>b&&(b=I)}v+=3*C,u(g.itree,b),l(g.itree,b,g.imap),w=g.lmap,E=g.dmap,v=c(g.imap,(1<<b)-1,P+O,t,v,g.ttree);var T=a._copyOut(g.ttree,0,P,g.ltree);L=(1<<T)-1;var _=a._copyOut(g.ttree,P,O,g.dtree);y=(1<<_)-1,u(g.ltree,T),l(g.ltree,T,w),u(g.dtree,_),l(g.dtree,_,E)}for(;;){var A=w[p(t,v)&L];v+=15&A;var h=A>>>4;if(!(h>>>8))n[d++]=h;else{if(h==256)break;var k=d+h-254;if(h>264){var R=g.ldef[h-257];k=d+(R>>>3)+m(t,v,7&R),v+=7&R}var F=E[p(t,v)&y];v+=15&F;var q=F>>>4,H=g.ddef[q],B=(H>>>4)+f(t,v,15&H);for(v+=15&H,x&&(n=e.F._check(n,d+(1<<17)));d<k;)n[d]=n[d++-B],n[d]=n[d++-B],n[d]=n[d++-B],n[d]=n[d++-B];d=k}}}else{7&v&&(v+=8-(7&v));var N=4+(v>>>3),D=t[N-4]|t[N-3]<<8;x&&(n=e.F._check(n,d+D)),n.set(new i(t.buffer,t.byteOffset+N,D),d),v=N+D<<3,d+=D}return n.length==d?n:n.slice(0,d)},e.F._check=function(t,n){var i=t.length;if(n<=i)return t;var a=new Uint8Array(Math.max(i<<1,n));return a.set(t,0),a},e.F._decodeTiny=function(t,n,i,a,f,m){for(var c=e.F._bitsE,u=e.F._get17,l=0;l<i;){var p=t[u(a,f)&n];f+=15&p;var g=p>>>4;if(g<=15)m[l]=g,l++;else{var x=0,w=0;g==16?(w=3+c(a,f,2),f+=2,x=m[l-1]):g==17?(w=3+c(a,f,3),f+=3):g==18&&(w=11+c(a,f,7),f+=7);for(var E=l+w;l<E;)m[l]=x,l++}}return f},e.F._copyOut=function(t,n,i,a){for(var f=0,m=0,c=a.length>>>1;m<i;){var u=t[m+n];a[m<<1]=0,a[1+(m<<1)]=u,u>f&&(f=u),m++}for(;m<c;)a[m<<1]=0,a[1+(m<<1)]=0,m++;return f},e.F.makeCodes=function(t,n){for(var i,a,f,m,c=e.F.U,u=t.length,l=c.bl_count,p=0;p<=n;p++)l[p]=0;for(p=1;p<u;p+=2)l[t[p]]++;var g=c.next_code;for(i=0,l[0]=0,a=1;a<=n;a++)i=i+l[a-1]<<1,g[a]=i;for(f=0;f<u;f+=2)(m=t[f+1])!=0&&(t[f]=g[m],g[m]++)},e.F.codes2map=function(t,n,i){for(var a=t.length,f=e.F.U.rev15,m=0;m<a;m+=2)if(t[m+1]!=0)for(var c=m>>1,u=t[m+1],l=c<<4|u,p=n-u,g=t[m]<<p,x=g+(1<<p);g!=x;)i[f[g]>>>15-n]=l,g++},e.F.revCodes=function(t,n){for(var i=e.F.U.rev15,a=15-n,f=0;f<t.length;f+=2){var m=t[f]<<n-t[f+1];t[f]=i[m]>>>a}},e.F._putsE=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8},e.F._putsF=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8,t[a+2]|=i>>>16},e.F._bitsE=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8)>>>(7&n)&(1<<i)-1},e.F._bitsF=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)&(1<<i)-1},e.F._get17=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)},e.F._get25=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16|t[3+(n>>>3)]<<24)>>>(7&n)},e.F.U=(r=Uint16Array,o=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var t=e.F.U,n=0;n<32768;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[n]=(i>>>16|i<<16)>>>17}function a(f,m,c){for(;m--!=0;)f.push(0,c)}for(n=0;n<32;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];a(t.fltree,144,8),a(t.fltree,112,9),a(t.fltree,24,7),a(t.fltree,8,8),e.F.makeCodes(t.fltree,9),e.F.codes2map(t.fltree,9,t.flmap),e.F.revCodes(t.fltree,9),a(t.fdtree,32,5),e.F.makeCodes(t.fdtree,5),e.F.codes2map(t.fdtree,5,t.fdmap),e.F.revCodes(t.fdtree,5),a(t.itree,19,0),a(t.ltree,286,0),a(t.dtree,30,0),a(t.ttree,320,0)}()})();var Hs=ks({__proto__:null,default:Lr},[Lr]),kt=function(){var s={nextZero(c,u){for(;c[u]!=0;)u++;return u},readUshort:(c,u)=>c[u]<<8|c[u+1],writeUshort(c,u,l){c[u]=l>>8&255,c[u+1]=255&l},readUint:(c,u)=>16777216*c[u]+(c[u+1]<<16|c[u+2]<<8|c[u+3]),writeUint(c,u,l){c[u]=l>>24&255,c[u+1]=l>>16&255,c[u+2]=l>>8&255,c[u+3]=255&l},readASCII(c,u,l){let p="";for(let g=0;g<l;g++)p+=String.fromCharCode(c[u+g]);return p},writeASCII(c,u,l){for(let p=0;p<l.length;p++)c[u+p]=l.charCodeAt(p)},readBytes(c,u,l){let p=[];for(let g=0;g<l;g++)p.push(c[u+g]);return p},pad:c=>c.length<2?`0${c}`:c,readUTF8(c,u,l){let p,g="";for(let x=0;x<l;x++)g+=`%${s.pad(c[u+x].toString(16))}`;try{p=decodeURIComponent(g)}catch{return s.readASCII(c,u,l)}return p}};function r(c,u,l,p){let g=u*l,x=n(p),w=Math.ceil(u*x/8),E=new Uint8Array(4*g),U=new Uint32Array(E.buffer),{ctype:M}=p,{depth:P}=p,O=s.readUshort;if(M==6){let R=g<<2;if(P==8)for(var C=0;C<R;C+=4)E[C]=c[C],E[C+1]=c[C+1],E[C+2]=c[C+2],E[C+3]=c[C+3];if(P==16)for(C=0;C<R;C++)E[C]=c[C<<1]}else if(M==2){let R=p.tabs.tRNS;if(R==null){if(P==8)for(C=0;C<g;C++){var L=3*C;U[C]=255<<24|c[L+2]<<16|c[L+1]<<8|c[L]}if(P==16)for(C=0;C<g;C++)L=6*C,U[C]=255<<24|c[L+4]<<16|c[L+2]<<8|c[L]}else{var y=R[0];let F=R[1],q=R[2];if(P==8)for(C=0;C<g;C++){var d=C<<2;L=3*C,U[C]=255<<24|c[L+2]<<16|c[L+1]<<8|c[L],c[L]==y&&c[L+1]==F&&c[L+2]==q&&(E[d+3]=0)}if(P==16)for(C=0;C<g;C++)d=C<<2,L=6*C,U[C]=255<<24|c[L+4]<<16|c[L+2]<<8|c[L],O(c,L)==y&&O(c,L+2)==F&&O(c,L+4)==q&&(E[d+3]=0)}}else if(M==3){let R=p.tabs.PLTE,F=p.tabs.tRNS,q=F?F.length:0;if(P==1)for(var v=0;v<l;v++){var S=v*w,b=v*u;for(C=0;C<u;C++){d=b+C<<2;var I=3*(T=c[S+(C>>3)]>>7-((7&C)<<0)&1);E[d]=R[I],E[d+1]=R[I+1],E[d+2]=R[I+2],E[d+3]=T<q?F[T]:255}}if(P==2)for(v=0;v<l;v++)for(S=v*w,b=v*u,C=0;C<u;C++)d=b+C<<2,I=3*(T=c[S+(C>>2)]>>6-((3&C)<<1)&3),E[d]=R[I],E[d+1]=R[I+1],E[d+2]=R[I+2],E[d+3]=T<q?F[T]:255;if(P==4)for(v=0;v<l;v++)for(S=v*w,b=v*u,C=0;C<u;C++)d=b+C<<2,I=3*(T=c[S+(C>>1)]>>4-((1&C)<<2)&15),E[d]=R[I],E[d+1]=R[I+1],E[d+2]=R[I+2],E[d+3]=T<q?F[T]:255;if(P==8)for(C=0;C<g;C++){var T;d=C<<2,I=3*(T=c[C]),E[d]=R[I],E[d+1]=R[I+1],E[d+2]=R[I+2],E[d+3]=T<q?F[T]:255}}else if(M==4){if(P==8)for(C=0;C<g;C++){d=C<<2;var _=c[A=C<<1];E[d]=_,E[d+1]=_,E[d+2]=_,E[d+3]=c[A+1]}if(P==16)for(C=0;C<g;C++){var A;d=C<<2,_=c[A=C<<2],E[d]=_,E[d+1]=_,E[d+2]=_,E[d+3]=c[A+2]}}else if(M==0)for(y=p.tabs.tRNS?p.tabs.tRNS:-1,v=0;v<l;v++){let R=v*w,F=v*u;if(P==1)for(var h=0;h<u;h++){var k=(_=255*(c[R+(h>>>3)]>>>7-(7&h)&1))==255*y?0:255;U[F+h]=k<<24|_<<16|_<<8|_}else if(P==2)for(h=0;h<u;h++)k=(_=85*(c[R+(h>>>2)]>>>6-((3&h)<<1)&3))==85*y?0:255,U[F+h]=k<<24|_<<16|_<<8|_;else if(P==4)for(h=0;h<u;h++)k=(_=17*(c[R+(h>>>1)]>>>4-((1&h)<<2)&15))==17*y?0:255,U[F+h]=k<<24|_<<16|_<<8|_;else if(P==8)for(h=0;h<u;h++)k=(_=c[R+h])==y?0:255,U[F+h]=k<<24|_<<16|_<<8|_;else if(P==16)for(h=0;h<u;h++)_=c[R+(h<<1)],k=O(c,R+(h<<1))==y?0:255,U[F+h]=k<<24|_<<16|_<<8|_}return E}function o(c,u,l,p){let g=n(c),x=Math.ceil(l*g/8),w=new Uint8Array((x+1+c.interlace)*p);return u=c.tabs.CgBI?t(u,w):e(u,w),c.interlace==0?u=i(u,c,0,l,p):c.interlace==1&&(u=function(U,M){let P=M.width,O=M.height,C=n(M),L=C>>3,y=Math.ceil(P*C/8),d=new Uint8Array(O*y),v=0,S=[0,0,4,0,2,0,1],b=[0,4,0,2,0,1,0],I=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1],_=0;for(;_<7;){let h=I[_],k=T[_],R=0,F=0,q=S[_];for(;q<O;)q+=h,F++;let H=b[_];for(;H<P;)H+=k,R++;let B=Math.ceil(R*C/8);i(U,M,v,R,F);let N=0,D=S[_];for(;D<O;){let V=b[_],tt=v+N*B<<3;for(;V<P;){var A;if(C==1&&(A=(A=U[tt>>3])>>7-(7&tt)&1,d[D*y+(V>>3)]|=A<<7-((7&V)<<0)),C==2&&(A=(A=U[tt>>3])>>6-(7&tt)&3,d[D*y+(V>>2)]|=A<<6-((3&V)<<1)),C==4&&(A=(A=U[tt>>3])>>4-(7&tt)&15,d[D*y+(V>>1)]|=A<<4-((1&V)<<2)),C>=8){let X=D*y+V*L;for(let $=0;$<L;$++)d[X+$]=U[(tt>>3)+$]}tt+=C,V+=k}N++,D+=h}R*F!=0&&(v+=F*(1+B)),_+=1}return d}(u,c)),u}function e(c,u){return t(new Uint8Array(c.buffer,2,c.length-6),u)}var t=function(){let c={H:{}};return c.H.N=function(u,l){let p=Uint8Array,g,x,w=0,E=0,U=0,M=0,P=0,O=0,C=0,L=0,y=0;if(u[0]==3&&u[1]==0)return l||new p(0);let d=c.H,v=d.b,S=d.e,b=d.R,I=d.n,T=d.A,_=d.Z,A=d.m,h=l==null;for(h&&(l=new p(u.length>>>2<<5));w==0;)if(w=v(u,y,1),E=v(u,y+1,2),y+=3,E!=0){if(h&&(l=c.H.W(l,L+(1<<17))),E==1&&(g=A.J,x=A.h,O=511,C=31),E==2){U=S(u,y,5)+257,M=S(u,y+5,5)+1,P=S(u,y+10,4)+4,y+=14;let R=1;for(var k=0;k<38;k+=2)A.Q[k]=0,A.Q[k+1]=0;for(k=0;k<P;k++){let H=S(u,y+3*k,3);A.Q[1+(A.X[k]<<1)]=H,H>R&&(R=H)}y+=3*P,I(A.Q,R),T(A.Q,R,A.u),g=A.w,x=A.d,y=b(A.u,(1<<R)-1,U+M,u,y,A.v);let F=d.V(A.v,0,U,A.C);O=(1<<F)-1;let q=d.V(A.v,U,M,A.D);C=(1<<q)-1,I(A.C,F),T(A.C,F,g),I(A.D,q),T(A.D,q,x)}for(;;){let R=g[_(u,y)&O];y+=15&R;let F=R>>>4;if(!(F>>>8))l[L++]=F;else{if(F==256)break;{let q=L+F-254;if(F>264){let V=A.q[F-257];q=L+(V>>>3)+S(u,y,7&V),y+=7&V}let H=x[_(u,y)&C];y+=15&H;let B=H>>>4,N=A.c[B],D=(N>>>4)+v(u,y,15&N);for(y+=15&N;L<q;)l[L]=l[L++-D],l[L]=l[L++-D],l[L]=l[L++-D],l[L]=l[L++-D];L=q}}}}else{7&y&&(y+=8-(7&y));let R=4+(y>>>3),F=u[R-4]|u[R-3]<<8;h&&(l=c.H.W(l,L+F)),l.set(new p(u.buffer,u.byteOffset+R,F),L),y=R+F<<3,L+=F}return l.length==L?l:l.slice(0,L)},c.H.W=function(u,l){let p=u.length;if(l<=p)return u;let g=new Uint8Array(p<<1);return g.set(u,0),g},c.H.R=function(u,l,p,g,x,w){let E=c.H.e,U=c.H.Z,M=0;for(;M<p;){let P=u[U(g,x)&l];x+=15&P;let O=P>>>4;if(O<=15)w[M]=O,M++;else{let C=0,L=0;O==16?(L=3+E(g,x,2),x+=2,C=w[M-1]):O==17?(L=3+E(g,x,3),x+=3):O==18&&(L=11+E(g,x,7),x+=7);let y=M+L;for(;M<y;)w[M]=C,M++}}return x},c.H.V=function(u,l,p,g){let x=0,w=0,E=g.length>>>1;for(;w<p;){let U=u[w+l];g[w<<1]=0,g[1+(w<<1)]=U,U>x&&(x=U),w++}for(;w<E;)g[w<<1]=0,g[1+(w<<1)]=0,w++;return x},c.H.n=function(u,l){let p=c.H.m,g=u.length,x,w,E,U,M=p.j;for(var P=0;P<=l;P++)M[P]=0;for(P=1;P<g;P+=2)M[u[P]]++;let O=p.K;for(x=0,M[0]=0,w=1;w<=l;w++)x=x+M[w-1]<<1,O[w]=x;for(E=0;E<g;E+=2)U=u[E+1],U!=0&&(u[E]=O[U],O[U]++)},c.H.A=function(u,l,p){let g=u.length,x=c.H.m.r;for(let w=0;w<g;w+=2)if(u[w+1]!=0){let E=w>>1,U=u[w+1],M=E<<4|U,P=l-U,O=u[w]<<P,C=O+(1<<P);for(;O!=C;)p[x[O]>>>15-l]=M,O++}},c.H.l=function(u,l){let p=c.H.m.r,g=15-l;for(let x=0;x<u.length;x+=2){let w=u[x]<<l-u[x+1];u[x]=p[w]>>>g}},c.H.M=function(u,l,p){p<<=7&l;let g=l>>>3;u[g]|=p,u[g+1]|=p>>>8},c.H.I=function(u,l,p){p<<=7&l;let g=l>>>3;u[g]|=p,u[g+1]|=p>>>8,u[g+2]|=p>>>16},c.H.e=function(u,l,p){return(u[l>>>3]|u[1+(l>>>3)]<<8)>>>(7&l)&(1<<p)-1},c.H.b=function(u,l,p){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16)>>>(7&l)&(1<<p)-1},c.H.Z=function(u,l){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16)>>>(7&l)},c.H.i=function(u,l){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16|u[3+(l>>>3)]<<24)>>>(7&l)},c.H.m=function(){let u=Uint16Array,l=Uint32Array;return{K:new u(16),j:new u(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new u(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new l(32),J:new u(512),_:[],h:new u(32),$:[],w:new u(32768),C:[],v:[],d:new u(32768),D:[],u:new u(512),Q:[],r:new u(32768),s:new l(286),Y:new l(30),a:new l(19),t:new l(15e3),k:new u(65536),g:new u(32768)}}(),function(){let u=c.H.m;for(var l=0;l<32768;l++){let g=l;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,u.r[l]=(g>>>16|g<<16)>>>17}function p(g,x,w){for(;x--!=0;)g.push(0,w)}for(l=0;l<32;l++)u.q[l]=u.S[l]<<3|u.T[l],u.c[l]=u.p[l]<<4|u.z[l];p(u._,144,8),p(u._,112,9),p(u._,24,7),p(u._,8,8),c.H.n(u._,9),c.H.A(u._,9,u.J),c.H.l(u._,9),p(u.$,32,5),c.H.n(u.$,5),c.H.A(u.$,5,u.h),c.H.l(u.$,5),p(u.Q,19,0),p(u.C,286,0),p(u.D,30,0),p(u.v,320,0)}(),c.H.N}();function n(c){return[1,null,3,1,2,null,4][c.ctype]*c.depth}function i(c,u,l,p,g){let x=n(u),w=Math.ceil(p*x/8),E,U;x=Math.ceil(x/8);let M=c[l],P=0;if(M>1&&(c[l]=[0,0,1][M-2]),M==3)for(P=x;P<w;P++)c[P+1]=c[P+1]+(c[P+1-x]>>>1)&255;for(let O=0;O<g;O++)if(E=l+O*w,U=E+O+1,M=c[U-1],P=0,M==0)for(;P<w;P++)c[E+P]=c[U+P];else if(M==1){for(;P<x;P++)c[E+P]=c[U+P];for(;P<w;P++)c[E+P]=c[U+P]+c[E+P-x]}else if(M==2)for(;P<w;P++)c[E+P]=c[U+P]+c[E+P-w];else if(M==3){for(;P<x;P++)c[E+P]=c[U+P]+(c[E+P-w]>>>1);for(;P<w;P++)c[E+P]=c[U+P]+(c[E+P-w]+c[E+P-x]>>>1)}else{for(;P<x;P++)c[E+P]=c[U+P]+a(0,c[E+P-w],0);for(;P<w;P++)c[E+P]=c[U+P]+a(c[E+P-x],c[E+P-w],c[E+P-x-w])}return c}function a(c,u,l){let p=c+u-l,g=p-c,x=p-u,w=p-l;return g*g<=x*x&&g*g<=w*w?c:x*x<=w*w?u:l}function f(c,u,l){l.width=s.readUint(c,u),u+=4,l.height=s.readUint(c,u),u+=4,l.depth=c[u],u++,l.ctype=c[u],u++,l.compress=c[u],u++,l.filter=c[u],u++,l.interlace=c[u],u++}function m(c,u,l,p,g,x,w,E,U){let M=Math.min(u,g),P=Math.min(l,x),O=0,C=0;for(let _=0;_<P;_++)for(let A=0;A<M;A++)if(w>=0&&E>=0?(O=_*u+A<<2,C=(E+_)*g+w+A<<2):(O=(-E+_)*u-w+A<<2,C=_*g+A<<2),U==0)p[C]=c[O],p[C+1]=c[O+1],p[C+2]=c[O+2],p[C+3]=c[O+3];else if(U==1){var L=c[O+3]*.00392156862745098,y=c[O]*L,d=c[O+1]*L,v=c[O+2]*L,S=p[C+3]*(1/255),b=p[C]*S,I=p[C+1]*S,T=p[C+2]*S;let h=1-L,k=L+S*h,R=k==0?0:1/k;p[C+3]=255*k,p[C+0]=(y+b*h)*R,p[C+1]=(d+I*h)*R,p[C+2]=(v+T*h)*R}else if(U==2)L=c[O+3],y=c[O],d=c[O+1],v=c[O+2],S=p[C+3],b=p[C],I=p[C+1],T=p[C+2],L==S&&y==b&&d==I&&v==T?(p[C]=0,p[C+1]=0,p[C+2]=0,p[C+3]=0):(p[C]=y,p[C+1]=d,p[C+2]=v,p[C+3]=L);else if(U==3){if(L=c[O+3],y=c[O],d=c[O+1],v=c[O+2],S=p[C+3],b=p[C],I=p[C+1],T=p[C+2],L==S&&y==b&&d==I&&v==T)continue;if(L<220&&S>20)return!1}return!0}return{decode:function(u){let l=new Uint8Array(u),p=8,g=s,x=g.readUshort,w=g.readUint,E={tabs:{},frames:[]},U=new Uint8Array(l.length),M,P=0,O=0,C=[137,80,78,71,13,10,26,10];for(var L=0;L<8;L++)if(l[L]!=C[L])throw"The input is not a PNG file!";for(;p<l.length;){let _=g.readUint(l,p);p+=4;let A=g.readASCII(l,p,4);if(p+=4,A=="IHDR")f(l,p,E);else if(A=="iCCP"){for(var y=p;l[y]!=0;)y++;g.readASCII(l,p,y-p),l[y+1];let h=l.slice(y+2,p+_),k=null;try{k=e(h)}catch{k=t(h)}E.tabs[A]=k}else if(A=="CgBI")E.tabs[A]=l.slice(p,p+4);else if(A=="IDAT"){for(L=0;L<_;L++)U[P+L]=l[p+L];P+=_}else if(A=="acTL")E.tabs[A]={num_frames:w(l,p),num_plays:w(l,p+4)},M=new Uint8Array(l.length);else if(A=="fcTL"){O!=0&&((T=E.frames[E.frames.length-1]).data=o(E,M.slice(0,O),T.rect.width,T.rect.height),O=0);let h={x:w(l,p+12),y:w(l,p+16),width:w(l,p+4),height:w(l,p+8)},k=x(l,p+22);k=x(l,p+20)/(k==0?100:k);let R={rect:h,delay:Math.round(1e3*k),dispose:l[p+24],blend:l[p+25]};E.frames.push(R)}else if(A=="fdAT"){for(L=0;L<_-4;L++)M[O+L]=l[p+L+4];O+=_-4}else if(A=="pHYs")E.tabs[A]=[g.readUint(l,p),g.readUint(l,p+4),l[p+8]];else if(A=="cHRM")for(E.tabs[A]=[],L=0;L<8;L++)E.tabs[A].push(g.readUint(l,p+4*L));else if(A=="tEXt"||A=="zTXt"){E.tabs[A]==null&&(E.tabs[A]={});var d=g.nextZero(l,p),v=g.readASCII(l,p,d-p),S=p+_-d-1;if(A=="tEXt")I=g.readASCII(l,d+1,S);else{var b=e(l.slice(d+2,d+2+S));I=g.readUTF8(b,0,b.length)}E.tabs[A][v]=I}else if(A=="iTXt"){E.tabs[A]==null&&(E.tabs[A]={}),d=0,y=p,d=g.nextZero(l,y),v=g.readASCII(l,y,d-y);let h=l[y=d+1];var I;l[y+1],y+=2,d=g.nextZero(l,y),g.readASCII(l,y,d-y),y=d+1,d=g.nextZero(l,y),g.readUTF8(l,y,d-y),S=_-((y=d+1)-p),h==0?I=g.readUTF8(l,y,S):(b=e(l.slice(y,y+S)),I=g.readUTF8(b,0,b.length)),E.tabs[A][v]=I}else if(A=="PLTE")E.tabs[A]=g.readBytes(l,p,_);else if(A=="hIST"){let h=E.tabs.PLTE.length/3;for(E.tabs[A]=[],L=0;L<h;L++)E.tabs[A].push(x(l,p+2*L))}else if(A=="tRNS")E.ctype==3?E.tabs[A]=g.readBytes(l,p,_):E.ctype==0?E.tabs[A]=x(l,p):E.ctype==2&&(E.tabs[A]=[x(l,p),x(l,p+2),x(l,p+4)]);else if(A=="gAMA")E.tabs[A]=g.readUint(l,p)/1e5;else if(A=="sRGB")E.tabs[A]=l[p];else if(A=="bKGD")E.ctype==0||E.ctype==4?E.tabs[A]=[x(l,p)]:E.ctype==2||E.ctype==6?E.tabs[A]=[x(l,p),x(l,p+2),x(l,p+4)]:E.ctype==3&&(E.tabs[A]=l[p]);else if(A=="IEND")break;p+=_,g.readUint(l,p),p+=4}var T;return O!=0&&((T=E.frames[E.frames.length-1]).data=o(E,M.slice(0,O),T.rect.width,T.rect.height)),E.data=o(E,U,E.width,E.height),delete E.compress,delete E.interlace,delete E.filter,E},toRGBA8:function(u){let l=u.width,p=u.height;if(u.tabs.acTL==null)return[r(u.data,l,p,u).buffer];let g=[];u.frames[0].data==null&&(u.frames[0].data=u.data);let x=l*p*4,w=new Uint8Array(x),E=new Uint8Array(x),U=new Uint8Array(x);for(let P=0;P<u.frames.length;P++){let O=u.frames[P],C=O.rect.x,L=O.rect.y,y=O.rect.width,d=O.rect.height,v=r(O.data,y,d,u);if(P!=0)for(var M=0;M<x;M++)U[M]=w[M];if(O.blend==0?m(v,y,d,w,l,p,C,L,0):O.blend==1&&m(v,y,d,w,l,p,C,L,1),g.push(w.buffer.slice(0)),O.dispose!=0){if(O.dispose==1)m(E,y,d,w,l,p,C,L,0);else if(O.dispose==2)for(M=0;M<x;M++)w[M]=U[M]}}return g},_paeth:a,_copyTile:m,_bin:s}}();(function(){let{_copyTile:s}=kt,{_bin:r}=kt,o=kt._paeth;var e={table:function(){let y=new Uint32Array(256);for(let d=0;d<256;d++){let v=d;for(let S=0;S<8;S++)1&v?v=3988292384^v>>>1:v>>>=1;y[d]=v}return y}(),update(y,d,v,S){for(let b=0;b<S;b++)y=e.table[255&(y^d[v+b])]^y>>>8;return y},crc:(y,d,v)=>4294967295^e.update(4294967295,y,d,v)};function t(y,d,v,S){d[v]+=y[0]*S>>4,d[v+1]+=y[1]*S>>4,d[v+2]+=y[2]*S>>4,d[v+3]+=y[3]*S>>4}function n(y){return Math.max(0,Math.min(255,y))}function i(y,d){let v=y[0]-d[0],S=y[1]-d[1],b=y[2]-d[2],I=y[3]-d[3];return v*v+S*S+b*b+I*I}function a(y,d,v,S,b,I,T){T==null&&(T=1);let _=S.length,A=[];for(var h=0;h<_;h++){let D=S[h];A.push([D>>>0&255,D>>>8&255,D>>>16&255,D>>>24&255])}for(h=0;h<_;h++){let D=4294967295;for(var k=0,R=0;R<_;R++){var F=i(A[h],A[R]);R!=h&&F<D&&(D=F,k=R)}}let q=new Uint32Array(b.buffer),H=new Int16Array(d*v*4),B=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(h=0;h<B.length;h++)B[h]=255*((B[h]+.5)/16-.5);for(let D=0;D<v;D++)for(let V=0;V<d;V++){var N;h=4*(D*d+V),T!=2?N=[n(y[h]+H[h]),n(y[h+1]+H[h+1]),n(y[h+2]+H[h+2]),n(y[h+3]+H[h+3])]:(F=B[4*(3&D)+(3&V)],N=[n(y[h]+F),n(y[h+1]+F),n(y[h+2]+F),n(y[h+3]+F)]),k=0;let tt=16777215;for(R=0;R<_;R++){let Y=i(N,A[R]);Y<tt&&(tt=Y,k=R)}let X=A[k],$=[N[0]-X[0],N[1]-X[1],N[2]-X[2],N[3]-X[3]];T==1&&(V!=d-1&&t($,H,h+4,7),D!=v-1&&(V!=0&&t($,H,h+4*d-4,3),t($,H,h+4*d,5),V!=d-1&&t($,H,h+4*d+4,1))),I[h>>2]=k,q[h>>2]=S[k]}}function f(y,d,v,S,b){b==null&&(b={});let{crc:I}=e,T=r.writeUint,_=r.writeUshort,A=r.writeASCII,h=8,k=y.frames.length>1,R,F=!1,q=33+(k?20:0);if(b.sRGB!=null&&(q+=13),b.pHYs!=null&&(q+=21),b.iCCP!=null&&(R=pako.deflate(b.iCCP),q+=21+R.length+4),y.ctype==3){for(var H=y.plte.length,B=0;B<H;B++)y.plte[B]>>>24!=255&&(F=!0);q+=8+3*H+4+(F?8+1*H+4:0)}for(var N=0;N<y.frames.length;N++)k&&(q+=38),q+=(X=y.frames[N]).cimg.length+12,N!=0&&(q+=4);q+=12;let D=new Uint8Array(q),V=[137,80,78,71,13,10,26,10];for(B=0;B<8;B++)D[B]=V[B];if(T(D,h,13),h+=4,A(D,h,"IHDR"),h+=4,T(D,h,d),h+=4,T(D,h,v),h+=4,D[h]=y.depth,h++,D[h]=y.ctype,h++,D[h]=0,h++,D[h]=0,h++,D[h]=0,h++,T(D,h,I(D,h-17,17)),h+=4,b.sRGB!=null&&(T(D,h,1),h+=4,A(D,h,"sRGB"),h+=4,D[h]=b.sRGB,h++,T(D,h,I(D,h-5,5)),h+=4),b.iCCP!=null){let $=13+R.length;T(D,h,$),h+=4,A(D,h,"iCCP"),h+=4,A(D,h,"ICC profile"),h+=11,h+=2,D.set(R,h),h+=R.length,T(D,h,I(D,h-($+4),$+4)),h+=4}if(b.pHYs!=null&&(T(D,h,9),h+=4,A(D,h,"pHYs"),h+=4,T(D,h,b.pHYs[0]),h+=4,T(D,h,b.pHYs[1]),h+=4,D[h]=b.pHYs[2],h++,T(D,h,I(D,h-13,13)),h+=4),k&&(T(D,h,8),h+=4,A(D,h,"acTL"),h+=4,T(D,h,y.frames.length),h+=4,T(D,h,b.loop!=null?b.loop:0),h+=4,T(D,h,I(D,h-12,12)),h+=4),y.ctype==3){for(T(D,h,3*(H=y.plte.length)),h+=4,A(D,h,"PLTE"),h+=4,B=0;B<H;B++){let $=3*B,Y=y.plte[B],it=255&Y,ut=Y>>>8&255,Kt=Y>>>16&255;D[h+$+0]=it,D[h+$+1]=ut,D[h+$+2]=Kt}if(h+=3*H,T(D,h,I(D,h-3*H-4,3*H+4)),h+=4,F){for(T(D,h,H),h+=4,A(D,h,"tRNS"),h+=4,B=0;B<H;B++)D[h+B]=y.plte[B]>>>24&255;h+=H,T(D,h,I(D,h-H-4,H+4)),h+=4}}let tt=0;for(N=0;N<y.frames.length;N++){var X=y.frames[N];k&&(T(D,h,26),h+=4,A(D,h,"fcTL"),h+=4,T(D,h,tt++),h+=4,T(D,h,X.rect.width),h+=4,T(D,h,X.rect.height),h+=4,T(D,h,X.rect.x),h+=4,T(D,h,X.rect.y),h+=4,_(D,h,S[N]),h+=2,_(D,h,1e3),h+=2,D[h]=X.dispose,h++,D[h]=X.blend,h++,T(D,h,I(D,h-30,30)),h+=4);let $=X.cimg;T(D,h,(H=$.length)+(N==0?0:4)),h+=4;let Y=h;A(D,h,N==0?"IDAT":"fdAT"),h+=4,N!=0&&(T(D,h,tt++),h+=4),D.set($,h),h+=H,T(D,h,I(D,Y,h-Y)),h+=4}return T(D,h,0),h+=4,A(D,h,"IEND"),h+=4,T(D,h,I(D,h-4,4)),h+=4,D.buffer}function m(y,d,v){for(let S=0;S<y.frames.length;S++){let b=y.frames[S];b.rect.width;let I=b.rect.height,T=new Uint8Array(I*b.bpl+I);b.cimg=p(b.img,I,b.bpp,b.bpl,T,d,v)}}function c(y,d,v,S,b){let I=b[0],T=b[1],_=b[2],A=b[3],h=b[4],k=b[5],R=6,F=8,q=255;for(var H=0;H<y.length;H++){let pt=new Uint8Array(y[H]);for(var B=pt.length,N=0;N<B;N+=4)q&=pt[N+3]}let D=q!=255,V=function(et,Z,lt,At,at,vt){let ct=[];for(var J=0;J<et.length;J++){let Tt=new Uint8Array(et[J]),Lt=new Uint32Array(Tt.buffer);var St;let It=0,Vt=0,Nt=Z,Yt=lt,Nr=At?1:0;if(J!=0){let Vi=vt||At||J==1||ct[J-2].dispose!=0?1:2,Hr=0,xn=1e9;for(let Ye=0;Ye<Vi;Ye++){var zt=new Uint8Array(et[J-1-Ye]);let zi=new Uint32Array(et[J-1-Ye]),$t=Z,Qt=lt,De=-1,Ze=-1;for(let Zt=0;Zt<lt;Zt++)for(let Jt=0;Jt<Z;Jt++)Lt[mt=Zt*Z+Jt]!=zi[mt]&&(Jt<$t&&($t=Jt),Jt>De&&(De=Jt),Zt<Qt&&(Qt=Zt),Zt>Ze&&(Ze=Zt));De==-1&&($t=Qt=De=Ze=0),at&&((1&$t)==1&&$t--,(1&Qt)==1&&Qt--);let vn=(De-$t+1)*(Ze-Qt+1);vn<xn&&(xn=vn,Hr=Ye,It=$t,Vt=Qt,Nt=De-$t+1,Yt=Ze-Qt+1)}zt=new Uint8Array(et[J-1-Hr]),Hr==1&&(ct[J-1].dispose=2),St=new Uint8Array(Nt*Yt*4),s(zt,Z,lt,St,Nt,Yt,-It,-Vt,0),Nr=s(Tt,Z,lt,St,Nt,Yt,-It,-Vt,3)?1:0,Nr==1?l(Tt,Z,lt,St,{x:It,y:Vt,width:Nt,height:Yt}):s(Tt,Z,lt,St,Nt,Yt,-It,-Vt,0)}else St=Tt.slice(0);ct.push({rect:{x:It,y:Vt,width:Nt,height:Yt},img:St,blend:Nr,dispose:0})}if(At)for(J=0;J<ct.length;J++){if((Xt=ct[J]).blend==1)continue;let Tt=Xt.rect,Lt=ct[J-1].rect,It=Math.min(Tt.x,Lt.x),Vt=Math.min(Tt.y,Lt.y),Nt={x:It,y:Vt,width:Math.max(Tt.x+Tt.width,Lt.x+Lt.width)-It,height:Math.max(Tt.y+Tt.height,Lt.y+Lt.height)-Vt};ct[J-1].dispose=1,J-1!=0&&u(et,Z,lt,ct,J-1,Nt,at),u(et,Z,lt,ct,J,Nt,at)}let ar=0;if(et.length!=1)for(var mt=0;mt<ct.length;mt++){var Xt;ar+=(Xt=ct[mt]).rect.width*Xt.rect.height}return ct}(y,d,v,I,T,_),tt={},X=[],$=[];if(S!=0){let pt=[];for(N=0;N<V.length;N++)pt.push(V[N].img.buffer);let et=function(at){let vt=0;for(var ct=0;ct<at.length;ct++)vt+=at[ct].byteLength;let J=new Uint8Array(vt),St=0;for(ct=0;ct<at.length;ct++){let zt=new Uint8Array(at[ct]),ar=zt.length;for(let mt=0;mt<ar;mt+=4){let Xt=zt[mt],Tt=zt[mt+1],Lt=zt[mt+2],It=zt[mt+3];It==0&&(Xt=Tt=Lt=0),J[St+mt]=Xt,J[St+mt+1]=Tt,J[St+mt+2]=Lt,J[St+mt+3]=It}St+=ar}return J.buffer}(pt),Z=x(et,S);for(N=0;N<Z.plte.length;N++)X.push(Z.plte[N].est.rgba);let lt=0;for(N=0;N<V.length;N++){let At=(it=V[N]).img.length;var Y=new Uint8Array(Z.inds.buffer,lt>>2,At>>2);$.push(Y);let at=new Uint8Array(Z.abuf,lt,At);k&&a(it.img,it.rect.width,it.rect.height,X,at,Y),it.img.set(at),lt+=At}}else for(H=0;H<V.length;H++){var it=V[H];let pt=new Uint32Array(it.img.buffer);var ut=it.rect.width;for(B=pt.length,Y=new Uint8Array(B),$.push(Y),N=0;N<B;N++){let et=pt[N];if(N!=0&&et==pt[N-1])Y[N]=Y[N-1];else if(N>ut&&et==pt[N-ut])Y[N]=Y[N-ut];else{let Z=tt[et];if(Z==null&&(tt[et]=Z=X.length,X.push(et),X.length>=300))break;Y[N]=Z}}}let Kt=X.length;for(Kt<=256&&h==0&&(F=Kt<=2?1:Kt<=4?2:Kt<=16?4:8,F=Math.max(F,A)),H=0;H<V.length;H++){(it=V[H]).rect.x,it.rect.y,ut=it.rect.width;let pt=it.rect.height,et=it.img;new Uint32Array(et.buffer);let Z=4*ut,lt=4;if(Kt<=256&&h==0){Z=Math.ceil(F*ut/8);var Ft=new Uint8Array(Z*pt);let At=$[H];for(let at=0;at<pt;at++){N=at*Z;let vt=at*ut;if(F==8)for(var ot=0;ot<ut;ot++)Ft[N+ot]=At[vt+ot];else if(F==4)for(ot=0;ot<ut;ot++)Ft[N+(ot>>1)]|=At[vt+ot]<<4-4*(1&ot);else if(F==2)for(ot=0;ot<ut;ot++)Ft[N+(ot>>2)]|=At[vt+ot]<<6-2*(3&ot);else if(F==1)for(ot=0;ot<ut;ot++)Ft[N+(ot>>3)]|=At[vt+ot]<<7-1*(7&ot)}et=Ft,R=3,lt=1}else if(D==0&&V.length==1){Ft=new Uint8Array(ut*pt*3);let At=ut*pt;for(N=0;N<At;N++){let at=3*N,vt=4*N;Ft[at]=et[vt],Ft[at+1]=et[vt+1],Ft[at+2]=et[vt+2]}et=Ft,R=2,lt=3,Z=3*ut}it.img=et,it.bpl=Z,it.bpp=lt}return{ctype:R,depth:F,plte:X,frames:V}}function u(y,d,v,S,b,I,T){let _=Uint8Array,A=Uint32Array,h=new _(y[b-1]),k=new A(y[b-1]),R=b+1<y.length?new _(y[b+1]):null,F=new _(y[b]),q=new A(F.buffer),H=d,B=v,N=-1,D=-1;for(let tt=0;tt<I.height;tt++)for(let X=0;X<I.width;X++){let $=I.x+X,Y=I.y+tt,it=Y*d+$,ut=q[it];ut==0||S[b-1].dispose==0&&k[it]==ut&&(R==null||R[4*it+3]!=0)||($<H&&(H=$),$>N&&(N=$),Y<B&&(B=Y),Y>D&&(D=Y))}N==-1&&(H=B=N=D=0),T&&((1&H)==1&&H--,(1&B)==1&&B--),I={x:H,y:B,width:N-H+1,height:D-B+1};let V=S[b];V.rect=I,V.blend=1,V.img=new Uint8Array(I.width*I.height*4),S[b-1].dispose==0?(s(h,d,v,V.img,I.width,I.height,-I.x,-I.y,0),l(F,d,v,V.img,I)):s(F,d,v,V.img,I.width,I.height,-I.x,-I.y,0)}function l(y,d,v,S,b){s(y,d,v,S,b.width,b.height,-b.x,-b.y,2)}function p(y,d,v,S,b,I,T){let _=[],A,h=[0,1,2,3,4];I!=-1?h=[I]:(d*S>5e5||v==1)&&(h=[0]),T&&(A={level:0});let k=Hs;for(var R=0;R<h.length;R++){for(let H=0;H<d;H++)g(b,y,H,S,v,h[R]);_.push(k.deflate(b,A))}let F,q=1e9;for(R=0;R<_.length;R++)_[R].length<q&&(F=R,q=_[R].length);return _[F]}function g(y,d,v,S,b,I){let T=v*S,_=T+v;if(y[_]=I,_++,I==0)if(S<500)for(var A=0;A<S;A++)y[_+A]=d[T+A];else y.set(new Uint8Array(d.buffer,T,S),_);else if(I==1){for(A=0;A<b;A++)y[_+A]=d[T+A];for(A=b;A<S;A++)y[_+A]=d[T+A]-d[T+A-b]+256&255}else if(v==0){for(A=0;A<b;A++)y[_+A]=d[T+A];if(I==2)for(A=b;A<S;A++)y[_+A]=d[T+A];if(I==3)for(A=b;A<S;A++)y[_+A]=d[T+A]-(d[T+A-b]>>1)+256&255;if(I==4)for(A=b;A<S;A++)y[_+A]=d[T+A]-o(d[T+A-b],0,0)+256&255}else{if(I==2)for(A=0;A<S;A++)y[_+A]=d[T+A]+256-d[T+A-S]&255;if(I==3){for(A=0;A<b;A++)y[_+A]=d[T+A]+256-(d[T+A-S]>>1)&255;for(A=b;A<S;A++)y[_+A]=d[T+A]+256-(d[T+A-S]+d[T+A-b]>>1)&255}if(I==4){for(A=0;A<b;A++)y[_+A]=d[T+A]+256-o(0,d[T+A-S],0)&255;for(A=b;A<S;A++)y[_+A]=d[T+A]+256-o(d[T+A-b],d[T+A-S],d[T+A-b-S])&255}}}function x(y,d){let v=new Uint8Array(y),S=v.slice(0),b=new Uint32Array(S.buffer),I=w(S,d),T=I[0],_=I[1],A=v.length,h=new Uint8Array(A>>2),k;if(v.length<2e7)for(var R=0;R<A;R+=4)k=E(T,F=v[R]*(1/255),q=v[R+1]*(1/255),H=v[R+2]*(1/255),B=v[R+3]*(1/255)),h[R>>2]=k.ind,b[R>>2]=k.est.rgba;else for(R=0;R<A;R+=4){var F=v[R]*.00392156862745098,q=v[R+1]*(1/255),H=v[R+2]*(1/255),B=v[R+3]*(1/255);for(k=T;k.left;)k=U(k.est,F,q,H,B)<=0?k.left:k.right;h[R>>2]=k.ind,b[R>>2]=k.est.rgba}return{abuf:S.buffer,inds:h,plte:_}}function w(y,d,v){v==null&&(v=1e-4);let S=new Uint32Array(y.buffer),b={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};b.bst=O(y,b.i0,b.i1),b.est=C(b.bst);let I=[b];for(;I.length<d;){let _=0,A=0;for(var T=0;T<I.length;T++)I[T].est.L>_&&(_=I[T].est.L,A=T);if(_<v)break;let h=I[A],k=M(y,S,h.i0,h.i1,h.est.e,h.est.eMq255);if(h.i0>=k||h.i1<=k){h.est.L=0;continue}let R={i0:h.i0,i1:k,bst:null,est:null,tdst:0,left:null,right:null};R.bst=O(y,R.i0,R.i1),R.est=C(R.bst);let F={i0:k,i1:h.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:h.bst.N-R.bst.N},T=0;T<16;T++)F.bst.R[T]=h.bst.R[T]-R.bst.R[T];for(T=0;T<4;T++)F.bst.m[T]=h.bst.m[T]-R.bst.m[T];F.est=C(F.bst),h.left=R,h.right=F,I[A]=R,I.push(F)}for(I.sort((_,A)=>A.bst.N-_.bst.N),T=0;T<I.length;T++)I[T].ind=T;return[b,I]}function E(y,d,v,S,b){if(y.left==null)return y.tdst=function(R,F,q,H,B){let N=F-R[0],D=q-R[1],V=H-R[2],tt=B-R[3];return N*N+D*D+V*V+tt*tt}(y.est.q,d,v,S,b),y;let I=U(y.est,d,v,S,b),T=y.left,_=y.right;I>0&&(T=y.right,_=y.left);let A=E(T,d,v,S,b);if(A.tdst<=I*I)return A;let h=E(_,d,v,S,b);return h.tdst<A.tdst?h:A}function U(y,d,v,S,b){let{e:I}=y;return I[0]*d+I[1]*v+I[2]*S+I[3]*b-y.eMq}function M(y,d,v,S,b,I){for(S-=4;v<S;){for(;P(y,v,b)<=I;)v+=4;for(;P(y,S,b)>I;)S-=4;if(v>=S)break;let T=d[v>>2];d[v>>2]=d[S>>2],d[S>>2]=T,v+=4,S-=4}for(;P(y,v,b)>I;)v-=4;return v+4}function P(y,d,v){return y[d]*v[0]+y[d+1]*v[1]+y[d+2]*v[2]+y[d+3]*v[3]}function O(y,d,v){let S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=[0,0,0,0],I=v-d>>2;for(let T=d;T<v;T+=4){let _=y[T]*.00392156862745098,A=y[T+1]*(1/255),h=y[T+2]*(1/255),k=y[T+3]*(1/255);b[0]+=_,b[1]+=A,b[2]+=h,b[3]+=k,S[0]+=_*_,S[1]+=_*A,S[2]+=_*h,S[3]+=_*k,S[5]+=A*A,S[6]+=A*h,S[7]+=A*k,S[10]+=h*h,S[11]+=h*k,S[15]+=k*k}return S[4]=S[1],S[8]=S[2],S[9]=S[6],S[12]=S[3],S[13]=S[7],S[14]=S[11],{R:S,m:b,N:I}}function C(y){let{R:d}=y,{m:v}=y,{N:S}=y,b=v[0],I=v[1],T=v[2],_=v[3],A=S==0?0:1/S,h=[d[0]-b*b*A,d[1]-b*I*A,d[2]-b*T*A,d[3]-b*_*A,d[4]-I*b*A,d[5]-I*I*A,d[6]-I*T*A,d[7]-I*_*A,d[8]-T*b*A,d[9]-T*I*A,d[10]-T*T*A,d[11]-T*_*A,d[12]-_*b*A,d[13]-_*I*A,d[14]-_*T*A,d[15]-_*_*A],k=h,R=L,F=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,H=0;if(S!=0)for(let N=0;N<16&&(F=R.multVec(k,F),H=Math.sqrt(R.dot(F,F)),F=R.sml(1/H,F),!(N!=0&&Math.abs(H-q)<1e-9));N++)q=H;let B=[b*A,I*A,T*A,_*A];return{Cov:h,q:B,e:F,L:q,eMq255:R.dot(R.sml(255,B),F),eMq:R.dot(F,B),rgba:(Math.round(255*B[3])<<24|Math.round(255*B[2])<<16|Math.round(255*B[1])<<8|Math.round(255*B[0])<<0)>>>0}}var L={multVec:(y,d)=>[y[0]*d[0]+y[1]*d[1]+y[2]*d[2]+y[3]*d[3],y[4]*d[0]+y[5]*d[1]+y[6]*d[2]+y[7]*d[3],y[8]*d[0]+y[9]*d[1]+y[10]*d[2]+y[11]*d[3],y[12]*d[0]+y[13]*d[1]+y[14]*d[2]+y[15]*d[3]],dot:(y,d)=>y[0]*d[0]+y[1]*d[1]+y[2]*d[2]+y[3]*d[3],sml:(y,d)=>[y*d[0],y*d[1],y*d[2],y*d[3]]};kt.encode=function(d,v,S,b,I,T,_){b==null&&(b=0),_==null&&(_=!1);let A=c(d,v,S,b,[!1,!1,!1,0,_,!1]);return m(A,-1),f(A,v,S,I,T)},kt.encodeLL=function(d,v,S,b,I,T,_,A){let h={ctype:0+(b==1?0:2)+(I==0?0:4),depth:T,frames:[]},k=(b+I)*T,R=k*v;for(let F=0;F<d.length;F++)h.frames.push({rect:{x:0,y:0,width:v,height:S},img:new Uint8Array(d[F]),blend:0,dispose:1,bpp:Math.ceil(k/8),bpl:Math.ceil(R/8)});return m(h,0,!0),f(h,v,S,_,A)},kt.encode.compress=c,kt.encode.dither=a,kt.quantize=x,kt.quantize.getKDtree=w,kt.quantize.getNearest=E})();var vi={toArrayBuffer(s,r){let o=s.width,e=s.height,t=o<<2,n=s.getContext("2d").getImageData(0,0,o,e),i=new Uint32Array(n.data.buffer),a=(32*o+31)/32<<2,f=a*e,m=122+f,c=new ArrayBuffer(m),u=new DataView(c),l=1<<20,p,g,x,w,E=l,U=0,M=0,P=0;function O(y){u.setUint16(M,y,!0),M+=2}function C(y){u.setUint32(M,y,!0),M+=4}function L(y){M+=y}O(19778),C(m),L(4),C(122),C(108),C(o),C(-e>>>0),O(1),O(32),C(3),C(f),C(2835),C(2835),L(8),C(16711680),C(65280),C(255),C(4278190080),C(1466527264),function y(){for(;U<e&&E>0;){for(w=122+U*a,p=0;p<t;)E--,g=i[P++],x=g>>>24,u.setUint32(w+p,g<<8|x),p+=4;U++}P<i.length?(E=l,setTimeout(y,vi._dly)):r(c)}()},toBlob(s,r){this.toArrayBuffer(s,o=>{r(new Blob([o],{type:"image/bmp"}))})},_dly:9},xt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Gs={[xt.CHROME]:16384,[xt.FIREFOX]:11180,[xt.DESKTOP_SAFARI]:16384,[xt.IE]:8192,[xt.IOS]:4096,[xt.ETC]:8192},dn=typeof window<"u",Si=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Or=dn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Bs=(dn||Si)&&(Or&&Or.getOriginalSymbol(window,"File")||typeof File<"u"&&File),bi=(dn||Si)&&(Or&&Or.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function gn(s,r,o=Date.now()){return new Promise(e=>{let t=s.split(","),n=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]),a=i.length,f=new Uint8Array(a);for(;a--;)f[a]=i.charCodeAt(a);let m=new Blob([f],{type:n});m.name=r,m.lastModified=o,e(m)})}function Ii(s){return new Promise((r,o)=>{let e=new bi;e.onload=()=>r(e.result),e.onerror=t=>o(t),e.readAsDataURL(s)})}function _i(s){return new Promise((r,o)=>{let e=new Image;e.onload=()=>r(e),e.onerror=t=>o(t),e.src=s})}function Ce(){if(Ce.cachedResult!==void 0)return Ce.cachedResult;let s=xt.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?s=xt.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?s=xt.IOS:/Safari/i.test(r)?s=xt.DESKTOP_SAFARI:/Firefox/i.test(r)?s=xt.FIREFOX:(/MSIE/i.test(r)||document.documentMode)&&(s=xt.IE),Ce.cachedResult=s,Ce.cachedResult}function wi(s,r){let o=Ce(),e=Gs[o],t=s,n=r,i=t*n,a=t>n?n/t:t/n;for(;i>e*e;){let f=(e+t)/2,m=(e+n)/2;f<m?(n=m,t=m*a):(n=f*a,t=f),i=t*n}return{width:t,height:n}}function kr(s,r){let o,e;try{if(o=new OffscreenCanvas(s,r),e=o.getContext("2d"),e===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{o=document.createElement("canvas"),e=o.getContext("2d")}return o.width=s,o.height=r,[o,e]}function Pi(s,r){let{width:o,height:e}=wi(s.width,s.height),[t,n]=kr(o,e);return r&&/jpe?g/.test(r)&&(n.fillStyle="white",n.fillRect(0,0,t.width,t.height)),n.drawImage(s,0,0,t.width,t.height),t}function Rr(){return Rr.cachedResult!==void 0||(Rr.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Rr.cachedResult}function Dr(s,r={}){return new Promise(function(o,e){let t,n;var i=function(){try{return n=Pi(t,r.fileType||s.type),o([t,n])}catch(f){return e(f)}},a=function(f){try{var m=function(c){try{throw c}catch(u){return e(u)}};try{let c;return Ii(s).then(function(u){try{return c=u,_i(c).then(function(l){try{return t=l,function(){try{return i()}catch(p){return e(p)}}()}catch(p){return m(p)}},m)}catch(l){return m(l)}},m)}catch(c){m(c)}}catch(c){return e(c)}};try{if(Rr()||[xt.DESKTOP_SAFARI,xt.MOBILE_SAFARI].includes(Ce()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(s).then(function(f){try{return t=f,i()}catch{return a()}},a)}catch{a()}})}function Ur(s,r,o,e,t=1){return new Promise(function(n,i){let a;if(r==="image/png"){let m,c,u;return m=s.getContext("2d"),{data:c}=m.getImageData(0,0,s.width,s.height),u=kt.encode([c.buffer],s.width,s.height,4096*t),a=new Blob([u],{type:r}),a.name=o,a.lastModified=e,f.call(this)}{let m=function(){return f.call(this)};if(r==="image/bmp")return new Promise(c=>vi.toBlob(s,c)).then(function(c){try{return a=c,a.name=o,a.lastModified=e,m.call(this)}catch(u){return i(u)}}.bind(this),i);{let c=function(){return m.call(this)};if(typeof OffscreenCanvas=="function"&&s instanceof OffscreenCanvas)return s.convertToBlob({type:r,quality:t}).then(function(u){try{return a=u,a.name=o,a.lastModified=e,c.call(this)}catch(l){return i(l)}}.bind(this),i);{let u;return u=s.toDataURL(r,t),gn(u,o,e).then(function(l){try{return a=l,c.call(this)}catch(p){return i(p)}}.bind(this),i)}}}function f(){return n(a)}})}function qt(s){s.width=0,s.height=0}function $e(){return new Promise(function(s,r){let o,e,t,n,i;return $e.cachedResult!==void 0?s($e.cachedResult):(o="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",gn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return e=a,Dr(e).then(function(f){try{return t=f[1],Ur(t,e.type,e.name,e.lastModified).then(function(m){try{return n=m,qt(t),Dr(n).then(function(c){try{return i=c[0],$e.cachedResult=i.width===1&&i.height===2,s($e.cachedResult)}catch(u){return r(u)}},r)}catch(c){return r(c)}},r)}catch(m){return r(m)}},r)}catch(f){return r(f)}},r))})}function Mi(s){return new Promise((r,o)=>{let e=new bi;e.onload=t=>{let n=new DataView(t.target.result);if(n.getUint16(0,!1)!=65496)return r(-2);let i=n.byteLength,a=2;for(;a<i;){if(n.getUint16(a+2,!1)<=8)return r(-1);let f=n.getUint16(a,!1);if(a+=2,f==65505){if(n.getUint32(a+=2,!1)!=1165519206)return r(-1);let m=n.getUint16(a+=6,!1)==18761;a+=n.getUint32(a+4,m);let c=n.getUint16(a,m);a+=2;for(let u=0;u<c;u++)if(n.getUint16(a+12*u,m)==274)return r(n.getUint16(a+12*u+8,m))}else{if((65280&f)!=65280)break;a+=n.getUint16(a,!1)}}return r(-1)},e.onerror=t=>o(t),e.readAsArrayBuffer(s)})}function Ri(s,r){let{width:o}=s,{height:e}=s,{maxWidthOrHeight:t}=r,n,i=s;return isFinite(t)&&(o>t||e>t)&&([i,n]=kr(o,e),o>e?(i.width=t,i.height=e/o*t):(i.width=o/e*t,i.height=t),n.drawImage(s,0,0,i.width,i.height),qt(s)),i}function Li(s,r){let{width:o}=s,{height:e}=s,[t,n]=kr(o,e);switch(r>4&&r<9?(t.width=e,t.height=o):(t.width=o,t.height=e),r){case 2:n.transform(-1,0,0,1,o,0);break;case 3:n.transform(-1,0,0,-1,o,e);break;case 4:n.transform(1,0,0,-1,0,e);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,e,0);break;case 7:n.transform(0,-1,-1,0,e,o);break;case 8:n.transform(0,-1,1,0,0,o)}return n.drawImage(s,0,0,o,e),qt(s),t}function Ei(s,r,o=0){return new Promise(function(e,t){let n,i,a,f,m,c,u,l,p,g,x,w,E,U,M,P,O,C,L,y;function d(S=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;n+=S,r.onProgress(Math.min(n,100))}function v(S){if(r.signal&&r.signal.aborted)throw r.signal.reason;n=Math.min(Math.max(S,n),100),r.onProgress(n)}return n=o,i=r.maxIteration||10,a=1024*r.maxSizeMB*1024,d(),Dr(s,r).then(function(S){try{return[,f]=S,d(),m=Ri(f,r),d(),new Promise(function(b,I){var T;if(!(T=r.exifOrientation))return Mi(s).then(function(A){try{return T=A,_.call(this)}catch(h){return I(h)}}.bind(this),I);function _(){return b(T)}return _.call(this)}).then(function(b){try{return c=b,d(),$e().then(function(I){try{return u=I?m:Li(m,c),d(),l=r.initialQuality||1,p=r.fileType||s.type,Ur(u,p,s.name,s.lastModified,l).then(function(T){try{{let A=function(){if(i--&&(M>a||M>E)){let k,R;return k=y?.95*L.width:L.width,R=y?.95*L.height:L.height,[O,C]=kr(k,R),C.drawImage(L,0,0,k,R),l*=p==="image/png"?.85:.95,Ur(O,p,s.name,s.lastModified,l).then(function(F){try{return P=F,qt(L),L=O,M=P.size,v(Math.min(99,Math.floor((U-M)/(U-a)*100))),A}catch(q){return t(q)}},t)}return[1]},h=function(){return qt(L),qt(O),qt(m),qt(u),qt(f),v(100),e(P)};if(g=T,d(),x=g.size>a,w=g.size>s.size,!x&&!w)return v(100),e(g);var _;return E=s.size,U=g.size,M=U,L=u,y=!r.alwaysKeepResolution&&x,(_=function(k){for(;k;){if(k.then)return void k.then(_,t);try{if(k.pop){if(k.length)return k.pop()?h.call(this):k;k=A}else k=k.call(this)}catch(R){return t(R)}}}.bind(this))(A)}}catch(A){return t(A)}}.bind(this),t)}catch(T){return t(T)}}.bind(this),t)}catch(I){return t(I)}}.bind(this),t)}catch(b){return t(b)}}.bind(this),t)})}var qs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`,hn;function Ws(s,r){return new Promise((o,e)=>{hn||(hn=function(i){let a=[];return typeof i=="function"?a.push(`(${i})()`):a.push(i),URL.createObjectURL(new Blob(a))}(qs));let t=new Worker(hn);t.addEventListener("message",function(i){if(r.signal&&r.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return e(new Error(i.data.error)),void t.terminate();o(i.data.file),t.terminate()}else r.onProgress(i.data.progress)}),t.addEventListener("error",e),r.signal&&r.signal.addEventListener("abort",()=>{e(r.signal.reason),t.terminate()}),t.postMessage({file:s,imageCompressionLibUrl:r.libURL,options:{...r,onProgress:void 0,signal:void 0}})})}function ft(s,r){return new Promise(function(o,e){let t,n,i,a,f,m;if(t={...r},i=0,{onProgress:a}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,f=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=p=>{i=p,typeof a=="function"&&a(i)},!(s instanceof Blob||s instanceof Bs))return e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(s.type))return e(new Error("The file given is not an image"));if(m=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!f||typeof Worker!="function"||m)return Ei(s,t).then(function(p){try{return n=p,l.call(this)}catch(g){return e(g)}}.bind(this),e);var c=function(){try{return l.call(this)}catch(p){return e(p)}}.bind(this),u=function(p){try{return Ei(s,t).then(function(g){try{return n=g,c()}catch(x){return e(x)}},e)}catch(g){return e(g)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ws(s,t).then(function(p){try{return n=p,c()}catch{return u()}},u)}catch{u()}function l(){try{n.name=s.name,n.lastModified=s.lastModified}catch{}try{t.preserveExif&&s.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===s.type)&&(n=xi(s,n))}catch{}return o(n)}})}ft.getDataUrlFromFile=Ii,ft.getFilefromDataUrl=gn,ft.loadImage=_i,ft.drawImageInCanvas=Pi,ft.drawFileInCanvas=Dr,ft.canvasToFile=Ur,ft.getExifOrientation=Mi,ft.handleMaxWidthOrHeight=Ri,ft.followExifOrientation=Li,ft.cleanupCanvasMemory=qt,ft.isAutoOrientationInBrowser=$e,ft.approximateBelowMaximumCanvasSizeOfBrowser=wi,ft.copyExifWithoutOrientation=xi,ft.getBrowserName=Ce,ft.version="2.0.2";var Oi=async(s=window.location.href,r=!0)=>{let o=await nr("tabs","query",[{url:s}]);o?.length===0&&(o=await nr("tabs","query",[{active:!0}]));let e=o?.[0]?.windowId,t=o?.[0]?.id;if(e&&t){await nr("tabs","update",[t,{active:!0}]);let n=await nr("tabs","captureVisibleTab",[e,{format:"png",quality:80}]);if(await new Promise(i=>setTimeout(i,1e3)),r&&n){let i=new Date().getTime(),a=vo(n,"screenshot.png");if(a){i=new Date().getTime();let f=await ft(a,{useWebWorker:!0,maxWidthOrHeight:1920});return gr(f)||n}}return n}return null};var Ee=class extends G{static{this.type="CREATE_WEBSITE_CONTEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.CreateWebsiteContextConfig||{},t={};e&&Object.keys(e).forEach(i=>{let a=e[i];typeof e[i]=="string"?ke(t,i,o.getShortCutsEngine()?.parseTemplate(a)||e[i]):typeof e[i]=="object"&&Object.keys(e[i]).forEach(f=>{let m=e[i][f];ke(t,`${i}.${f}`,o.getShortCutsEngine()?.parseTemplate(m)||e[i][f])})}),t.sidebarType=this.getCurrentSidebarType(o);let n=await Ti(t);n?.id&&!n.meta?.screenshot&&Oi().then(i=>{i&&Ci({id:n.id},{meta:{screenshot:i}})}),this.output=t.id}catch(e){this.error=e.toString()}}};W([Q()],Ee.prototype,"execute",1);var xe=class extends G{static{this.type="TEXT_HANDLER"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||this.parameters.template||"";e?(this.output=Ar(e,this.parameters.ActionTextHandleParameters),this.error=""):(this.output="",this.error="error: no text for handle")}catch(e){this.error=e.toString()}}};W([Q()],xe.prototype,"execute",1);var yn=ht(Wr());var ve=class extends G{static{this.type="DATE_FORMAT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=typeof this.parameters.DateFormatStyle=="string"?this.parameters.DateFormatStyle:"YYYY-MM-DD",t=r.LAST_ACTION_OUTPUT||(0,yn.default)().format();this.output=(0,yn.default)(t).format(e)}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],ve.prototype,"execute",1);var An=ht(Wr());var Se=class extends G{static{this.type="DATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{(this.parameters.DateActionMode||"Current Date")==="Specified Date"?this.output=(0,An.default)(this.parameters.DateActionDate).format():this.output=(0,An.default)().format()}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],Se.prototype,"execute",1);var sr=400*1e3,Vs=async(s,r)=>new Promise(o=>{fetch(`${Br}/gpt/check_doc_exists`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({doc_id:r})}).then(e=>e.json()).then(e=>{if(_n){o(e?.data?.exists||!1);return}o(!1)}).catch(e=>{o(!1)})}),Tn=async(s,r)=>{let o=await Jn();return new Promise(async e=>{let t=jr(s);if(await Vs(o,t)){e(t);return}let n=new File([s],r||"file.txt",{type:"text/plain"}),i=new FormData;i.append("file",n,n.name.replace(/\.pdf$/,".txt")),i.append("doc_id",jr(s)),fetch(`${Br}/gpt/analyze_file`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i}).then(a=>a.json()).then(a=>{let f=a?.data?.doc_id||"";f||Kr("[API] [/gpt/analyze_file] error",JSON.stringify({error:"response docId is empty"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e(f)}).catch(a=>{Kr("[API] [/gpt/analyze_file] error",JSON.stringify({error:a?.message||a?.toString()||"unknown error"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e("")})})};var be=class extends G{static{this.type="GET_PDF_CONTENTS_OF_CRX"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{if(typeof window<"u"&&window.pdfjsLib&&window?.PDFViewerApplication?.url){let e=window.pdfjsLib,t=0,i=await(async()=>{try{let a=await e.getDocument(window?.PDFViewerApplication?.url).promise,f=a.numPages,m=async p=>{try{return(await(await a.getPage(p)).getTextContent()).items.map(w=>w.str).join("")}catch{return""}},c="",u="",l=0;for(let p=0;p<f;p++){let g="",x=!1;p%2===0?(x=!0,g=await m(f-p)):g=await m(p);let w=(await fr(g)).length;if(w+t>sr)break;l+=1,t+=w,x?u=g+u:c=c+g}return c+u}catch{return""}})();this.output=i}}catch(e){this.error=e.toString()}}};W([Q(),z({onlyError:!0}),gt()],be.prototype,"execute",1);var zs=()=>{let s=ee();return s==="mail.google.com"?"[Gmail] ":s==="outlook.office.com"||s==="outlook.live.com"||s==="outlook.office365.com"?"[Outlook] ":s==="twitter.com"?"[Twitter] ":s==="linkedin.com"?"[LinkedIn] ":s==="facebook.com"?"[Facebook] ":s==="instagram.com"?"[Instagram] ":""},Di=zs;var Ie=class extends G{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ask_chatgpt",n=this.parameters.AskChatGPTProvider,i=this.parameters.AskChatGPTWithHistory||!1,a=this.parameters.AskChatGPTInsertMessageId||"",f=this.getCurrentConversationId(e);t==="ASK_CHAT_GPT_WITH_PREFIX"&&this.parameters.AskChatGPTActionMeta?.contextMenu&&(this.parameters.AskChatGPTActionMeta.contextMenu.text=Di()+this.parameters.AskChatGPTActionMeta.contextMenu.text),this.question=this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT;let{success:m,answer:c,message:u,error:l}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.question,parentMessageId:""},{includeHistory:i,regenerate:!1,meta:{...this.parameters.AskChatGPTActionMeta},aiMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_ANSWER",userMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_QUESTION"},{onProcess:async p=>{a&&f&&(p.messageId=a,await Dt("update",f,0,[p]))},onEnd:async(p,g)=>{a&&f&&g&&(g.messageId=a,await Dt("update",f,0,[ur([g,{originalMessage:{metadata:{isComplete:!0}}}])]))}})||{success:!1,answer:"",error:""};m?(this.output=c,this.message=u):(this.output="",this.error=this.error=Qr(l||c||"ask chatgpt error"))}catch(t){this.error=Qr(t.toString())}}reset(){super.reset(),this.question="",this.message=void 0}};W([He(),Q(),Tr(!1)],Ie.prototype,"execute",1);var j=ht(Ht());var Cn=ht(Ht());var Ui=(s,r)=>{let o,e;return function(){let t=arguments,n=this;return o||(o=!0,setTimeout(()=>o=!1,r),e=s.apply(n,t)),e}};var _e=ht(Ht());var $s=s=>{let[r,o]=(0,_e.useState)(""),{currentAIProviderModelDetail:e}=dr(),t=(0,_e.useMemo)(()=>{let i=e?.maxTokens||4e3;return Math.floor(i/1e3)*1e3},[e]),n=(0,_e.useMemo)(()=>r.length>t,[r,t]);return(0,_e.useEffect)(()=>{let i=a=>{a.startsWith("``NO_HISTORY_&#``\n")&&(a=a.replace("``NO_HISTORY_&#``\n","")),o(a)};return dt(s).subscribe(i),()=>{dt(s).unsubscribe(i)}},[]),{currentMaxInputLength:t,isError:n}},ki=$s;var Qs=()=>Math.max(Math.floor(window.innerHeight*.5/24)||5),je=24,Qe=(s,r=0,o=0)=>{let e=s?.parentElement?.parentElement;if(s&&e){let t=window.getComputedStyle(s),n=parseInt(t.paddingTop,10)+parseInt(t.paddingBottom,10);s.style.cssText="height:0px";let i=s.value?s.scrollHeight:je+n,a=Math.min(je*Qs(),i);o===0&&(o=s?.previousElementSibling?.offsetHeight||0);let f=Math.max(je,o||0);a=Math.max(f,a),s.style.cssText=`height: ${a}px`;let m=a+r;e.style.cssText=`height: ${m}px`}},js=(s,r=0,o=0)=>{Qe(s,r,o),setTimeout(()=>{Qe(s,r,o);let e=s.value;s.focus(),s.setSelectionRange(e.length,e.length)},100)},we=(s,r=0,o=0)=>{let e="",t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&(e="mui",t.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(e="linkedin",n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}s.isSameNode(Gn())||s.isSameNode(Bn())||js(s,r,o)},Ks=s=>{},Xs=s=>{let r=Ct(cr),o=Ct(ho),e=Ct(Gt),{defaultValue:t,onChange:n,onEnter:i,onKeydown:a,loading:f,children:m,error:c=!1,InputId:u=Ot,stopPropagation:l=!0,placeholder:p="Ask AI...",expandNode:g,sx:x}=s,{isError:w}=ki(te===u?"floatingMenuInputMediator":"chatBoxInputMediator"),E=(0,j.useRef)(null),U=(0,j.useRef)(!1),M=(0,j.useRef)(!1),[P,O]=(0,j.useState)(t||""),C=(0,j.useRef)(0),L=(0,j.useRef)(0),y=(0,j.useRef)(null),d=(0,j.useRef)(null),v=(0,j.useMemo)(()=>Ui(Qe,200),[]),S=T=>[C.current,L.current],b=(0,j.useCallback)(T=>{let _=T.target.value;u===Ot?dt("chatBoxInputMediator").updateInputValue(_):u===te?dt("floatingMenuInputMediator").updateInputValue(_):O(_),n&&n(_,{includeHistory:!M.current})},[n]),I=(0,j.useRef)({});return(0,j.useEffect)(()=>{if(u===Ot){let T=(_,A)=>{A&&(I.current=A),_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),M.current=!0),O(_)};return dt("chatBoxInputMediator").subscribe(T),()=>{dt("chatBoxInputMediator").unsubscribe(T)}}if(u===te){let T=_=>{_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),M.current=!0),O(_)};return dt("floatingMenuInputMediator").subscribe(T),()=>{dt("floatingMenuInputMediator").unsubscribe(T)}}return()=>{}},[]),(0,j.useEffect)(()=>{M.current=!1,I.current={}},[e.loading]),(0,j.useEffect)(()=>{v(E.current,...S("inputValue1")),setTimeout(()=>{E.current&&Qe(E.current,...S("inputValue2"))},0)},[P]),(0,j.useEffect)(()=>{let T=new ResizeObserver(A=>{for(let h of A)setTimeout(()=>{C.current=h.target?.offsetHeight||0,E.current&&Qe(E.current,...S("children"))},100)}),_=new ResizeObserver(A=>{for(let h of A)setTimeout(()=>{L.current=h.target?.offsetHeight||0,E.current&&Qe(E.current,...S("expand"))},100)});return d.current&&_.observe(d.current),y.current&&T.observe(y.current),()=>{T.disconnect(),_.disconnect()}},[]),(0,j.useEffect)(()=>{o.open&&E.current&&u===te&&we(E.current,...S("floatingDropdownMenu"))},[o.open]),(0,j.useEffect)(()=>{r.open&&E.current&&u===Ot&&!Fe()&&we(E.current,...S("appState"))},[r.open,f]),lr(()=>{u===Ot&&Rn()&&setTimeout(()=>{we(E.current,...S("appState"))},100)}),j.default.createElement($r,{component:"div",className:f?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${w||c?"rgb(239, 83, 80)":"customColor.borderColor"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{maxHeight:"30px",opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...x}},j.default.createElement($r,{component:"div",className:"chat-box__input-skeleton"},j.default.createElement(eo,{height:je})),j.default.createElement(pr,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,color:T=>T.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",minHeight:je+"px",lineHeight:je+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},j.default.createElement(pr,{ref:d,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"end"}},g),j.default.createElement("textarea",{id:u,placeholder:p,disabled:f,ref:E,value:P,rows:1,onCopy:T=>{T.stopPropagation()},onCut:T=>{T.stopPropagation()},onPaste:T=>{T.stopPropagation()},onKeyUp:T=>{l&&T.stopPropagation()},onKeyPress:T=>{l&&T.stopPropagation()},onKeyDown:T=>{if(l){if(T.key==="ArrowUp"||T.key==="ArrowDown"||T.key==="ArrowLeft"||T.key==="ArrowRight"||T.key==="Escape")return;T.stopPropagation()}if(!U.current){if(!(T.key==="Enter"&&T.shiftKey)){if(T.key==="Enter")i&&i(T.currentTarget.value,{includeHistory:!M.current,meta:I.current}),M.current=!1,I.current={},T.preventDefault();else if(T.code==="Space"){T.stopPropagation();return}}a&&a(T)}},onClick:T=>{we(T.currentTarget,...S("click"))},onCompositionUpdate:T=>{l&&T.stopPropagation()},onCompositionStart:T=>{l&&T.stopPropagation(),U.current=!0},onCompositionEnd:T=>{l&&T.stopPropagation(),U.current=!1,b(T)},onInput:T=>{l&&T.stopPropagation(),U.current?O(T.currentTarget.value):b(T)},onBlur:T=>{v(T.currentTarget,...S("blur")),Ks(T.currentTarget)}})),j.default.createElement(pr,{ref:y,width:"100%"},m))},rm=Xs;var Pe=class extends G{static{this.type="INSERT_USER_INPUT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters?.compliedTemplate||r?.LAST_ACTION_OUTPUT||"",t=this.parameters.AskChatGPTActionMeta,n=Fe(),i=await Vn(()=>{let a=null;return n?a=qn()?.querySelector(`#${te}`):a=re()?.querySelector(`#${Ot}`),a?Promise.resolve(a):Promise.reject("not found")},30,100);i&&(n?(dt("floatingMenuInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),we(i,0)):(dt("chatBoxInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),we(i,44.5))),i||n?this.output=e:this.error=""}catch{}}};W([Q(),Tr()],Pe.prototype,"execute",1);var Me=class extends G{static{this.type="ANALYZE_CHAT_FILE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{await this.pushMessageToChat({type:"system",text:"Generating summary...",messageId:nt(),extra:{status:"info"}},o);let e=this.parameters.AnalyzeChatFileName||r.AnalyzeChatFileName||"Content.txt",t=this.parameters.AnalyzeChatFileImmediateUpdateConversation||r.AnalyzeChatFileImmediateUpdateConversation||!1,n=r.LAST_ACTION_OUTPUT,i=(await fr(n)).length,a=i>12e3;i>sr&&(n=await tr(n,sr));let f=await tr(n,12e3);if(a)if(t){let m=await Tn(n,e);await this.updateConversation(o,{meta:{docId:m}})}else Tn(n,e).then(async m=>{await this.updateConversation(o,{meta:{docId:m}})});await this.updateConversation(o,{meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
            \`\`\`
            ${f}
            \`\`\``}}),this.output=f}catch(e){this.error=e.toString()}}};W([Q()],Me.prototype,"execute",1);var Re=class extends G{static{this.type="RENDER_CHATGPT_PROMPT"}constructor(r,o,e,t){super(r,"RENDER_CHATGPT_PROMPT",e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};W([Q()],Re.prototype,"execute",1);var Le=class extends G{static{this.type="CHAT_MESSAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.ActionChatMessageType||"system",t=this.parameters.ActionChatMessageOperationType||"add",n=this.parameters.ActionChatMessageConfig,i=o.getChartGPT(),a=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;if(!n||!a||!i){this.error="invalid parameters";return}n.type||(n.type=e),t==="add"?(n.messageId||(n.messageId=nt()),await i.pushMessage(ur([n]),a)):t==="update"?await i.updateMessage(n,a):t==="delete"&&await i.deleteMessage(1,a),this.output=n.messageId}catch(e){this.error=e.message}}};W([He()],Le.prototype,"execute",1);var Oe=class extends G{static{this.type="RENDER_TEMPLATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};W([Q()],Oe.prototype,"execute",1);var Ni={[Re.type]:Re,[Oe.type]:Oe,[Ie.type]:Ie,[Me.type]:Me,[Le.type]:Le,[Pe.type]:Pe,[oe.type]:oe,[Ge.type]:Ge,[Be.type]:Be,[ie.type]:ie,[se.type]:se,[qe.type]:qe,[ne.type]:ne,[ae.type]:ae,[ce.type]:ce,[We.type]:We,[ue.type]:ue,[be.type]:be,[Ve.type]:Ve,[ze.type]:ze,[le.type]:le,[fe.type]:fe,[pe.type]:pe,[me.type]:me,[he.type]:he,[Se.type]:Se,[ve.type]:ve,[Ae.type]:Ae,[Te.type]:Te,[Ee.type]:Ee,[xe.type]:xe,[de.type]:de},Ys=s=>new Promise(r=>setTimeout(r,s)),En=class{constructor(){this.status="idle";this.variables=new Map;this.stepIndex=-1;this.actions=[];this.listeners=[]}setActions(r){this.reset(),this.actions=[],r.map(o=>{let e=Ni[o.type];if(!e)throw new Error(`Action type ${o.type} not found`);let t=new e(o.id||nt(),o.type,o.parameters||{},typeof o.autoExecute=="boolean"?o.autoExecute:!0);this.actions.push(t)})}pushActions(r,o){let e=[];r.map(t=>{let n=Ni[t.type];if(!n)throw new Error(`Action type ${t.type} not found`);let i=new n(t.id||nt(),t.type,t.parameters||{},typeof t.autoExecute=="boolean"?t.autoExecute:!0);e.push(i)}),o==="after"?this.actions.splice(this.stepIndex+1,0,...e):this.actions.push(...e)}async executeAction(r,o){try{if(r.reset(),r.status="running",this.emit("action",r),await r.execute(this.getVariables(),o),r.error){r.status="error",this.emit("action",r);return}r.status="complete",this.emit("action",r)}catch{r.status="error",this.emit("action",r)}}async run(r){try{let{engine:o,parameters:e}=r;if(this.status==="idle"||this.status==="stop")for(this.status="running",this.emit("status",this);this.status==="running"&&this.status!=="stop";){if(this.stepIndex+=1,this.stepIndex>=this.actions.length){this.status="complete",this.emit("status",this),this.reset();break}e&&this.stepIndex===0&&this.setVariables(e);let t=this.getCurrentAction();if(t){if(this.emit("beforeRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),await this.executeAction(t,o),this.emit("afterRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),t.error){this.status="stop",this.emit("status",this),this.stepIndex=this.stepIndex-1;break}let n=t.output||"";if(this.setVariable("LAST_ACTION_OUTPUT",n,!0),this.getNextAction()?.autoExecute&&!t.error)continue}await Ys(100)}}catch{this.status="stop",this.emit("status",this)}}stop(){this.status="stop"}reset(){this.stepIndex=-1,this.variables=new Map,this.status="idle"}setVariable(r,o,e){this.variables.has(r)?e&&this.variables.set(r,o):this.variables.set(r,o)}setVariables(r){r.forEach(o=>{this.setVariable(o.key,o.value,o.overwrite)})}getVariable(r){return this.variables.get(r)}getVariables(){return Object.fromEntries(this.variables)}getCurrentAction(){return this.actions[this.stepIndex]}getNextAction(){return this.actions[this.stepIndex+1]||null}getPrevAction(){return this.actions[this.stepIndex-1]||null}get progress(){return Number((Math.max(this.stepIndex,0)/this.actions.length).toFixed(2))}addListener(r){this.listeners.push(r)}removeListener(r){let o=this.listeners.indexOf(r);o>-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}emit(r,o){this.listeners.forEach(e=>{e(r,o)})}parseTemplate(r){return Ne(r,this.getVariables()).data}},Hi=En;var Gi=Sn({key:"ShortCutsState",default:{status:"idle"}});var Fr=new Hi,Zs=new Ue({runtime:"shortcut"}),Jr=s=>{let{isLogin:r}=so(),o=Zr(),[e,t]=bn(Gi),{loading:n}=Ct(Gt),i=(0,Ke.useRef)(Fr),a=Co(s||""),f=l=>i.current?(i.current?.setActions(l),!0):!1,m=(0,Ke.useCallback)(async(l=!1)=>{if(i.current){(!r||l&&!rr())&&er();try{await On()&&(i.current?.stepIndex===-1||i.current.status==="stop")&&(i.current?.actions.find(x=>x.type==="ASK_CHATGPT")&&t({status:"running"}),await i.current.run({parameters:o().shortCutsParameters,engine:{getShortCutsEngine:()=>i.current,getChartGPT:()=>a,getBackgroundConversation:()=>Zs}}))}catch{}finally{t({status:Fr.status||"idle"})}}},[a,i,o,r]),c=(0,Ke.useCallback)(()=>{i.current&&(i.current.stop(),t({status:Fr.status||"idle"}))},[i]),u=(0,Ke.useCallback)(()=>{i.current&&(i.current.reset(),t({status:Fr.status||"idle"}))},[]);return{...a,shortCutsEngineRef:i,runShortCuts:m,setShortCuts:f,loading:e.status==="running"||n,status:e.status,stopShortCuts:c,resetShortCuts:u}};var Wt=ht(Ht());var qi=ht(Wr());var Js=`You are a research expert who is good at coming up with the perfect search query to help find answers to any question. Your task is to think of the most effective search query for the following question delimited by <question></question>:

<question>
{{current_question}}
</question>

The question is the final one in a series of previous questions and answers. Here are the earlier questions listed in the order they were asked, from the very first to the one before the final question, delimited by <previous_questions></previous_questions>:
<previous_questions>
{{previous_questions}}
</previous_questions>

For your reference, today's date is {{CURRENT_DATE}}.

Output the search query without additional context, explanation, or extra wording, just the search query itself. Don't use any punctuation, especially no quotes or backticks, around the search query.`,Bi=s=>{let r=Js;r=r.replaceAll("{{CURRENT_DATE}}",(0,qi.default)().format("YYYY-MM-DD HH:mm:ss"));let o=s[s.length-1],e=s.slice(0,-1);r=r.replaceAll("{{current_question}}",o);let t="";return e.forEach((n,i)=>{t+=`${i+1}) ${n}${i<e.length-1?`
`:""}`}),r=r.replaceAll("{{previous_questions}}",t),r},ta=async s=>{let r=ro;if(!r)return s;r=r.replaceAll("{query}",s),r=r.replace("{web_results}","{{PAGE_CONTENT}}"),r=r.replaceAll("{current_date}","{{CURRENT_DATE}}");let o=await Ao();return o.userSettings?.language&&(r=r+`
Respond in ${o.userSettings?.language}`),r},ea=()=>{let{currentSidebarConversationId:s,currentSidebarConversationType:r,currentSidebarConversationMessages:o,updateSidebarConversationType:e}=jt(),t=In(Gt),n=co(),{currentUserPlan:i}=Zn(),{setShortCuts:a,runShortCuts:f}=Jr(""),[m,c]=(0,Wt.useState)([]),{createConversation:u}=po(),l=(0,Wt.useRef)(!1),p=(0,Wt.useMemo)(()=>{let M=[];for(let P=o.length-1;P>=0;P--){let O=o[P];if(M.unshift(O?.originalMessage?.metadata?.title||O.text||""),O.type==="ai"&&O?.originalMessage?.include_history===!1)break}return M},[o]),g=async(M,P)=>{if(!l.current){rr()||er(),r!=="Search"&&await e("Search"),await Vr("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0),t(O=>({...O,loading:!0}));try{let O=await u("Search");if(t(v=>({...v,loading:!1})),i.name!=="pro"){let v=Number((await Fn()).ON_BOARDING_RECORD_SEARCH_FREE_TRIAL_TIMES)||0;if(v>0)await Vr("ON_BOARDING_RECORD_SEARCH_FREE_TRIAL_TIMES",v-1);else{await Dt("add",O,0,[ao(n.SIDEBAR_SEARCH_WITH_AI)]),io("show","SIDEBAR_SEARCH_WITH_AI");return}}let C=M,L="",y=M.match(/\/site:(\S+)/);y&&(L=y[1],C=M.replace(y[0],"")),C=Ar(C,{trim:!0,noQuotes:!0,noCommand:!0});let d=[{type:"DATE",parameters:{DateActionMode:"Current Date",DateFormatStyle:"YYYY-MM-DD HH:mm:ss"}},{type:"SET_VARIABLE",parameters:{VariableName:"CURRENT_DATE"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:nt(),text:"",originalMessage:{metadata:{title:M,quickSearch:[{title:"Understanding question",status:"loading",icon:"CheckCircle"}]},include_history:P}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"ASK_CHATGPT",parameters:{AskChatGPTWithHistory:P,template:Bi(P?p.concat(C):[C]),AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",AskChatGPTActionMeta:{messageVisibleText:M,contextMenu:{id:"b481731b-19e3-4713-8f0b-81fd7b2d5169",droppable:!1,parent:"",text:"[Search] smart query",data:{editable:!1,type:"shortcuts",actions:[]}}}}},{type:"TEXT_HANDLER",parameters:{ActionTextHandleParameters:{trim:!0,noQuotes:!0,noCommand:!0}}},{type:"SET_VARIABLE",parameters:{VariableName:"SMART_SEARCH_QUERY"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{quickSearch:[{title:"Understanding question",status:"complete",icon:"CheckCircle"},{title:"Searching web",status:"loading",icon:"Search",value:"{{SMART_SEARCH_QUERY}}"}],sources:{status:"loading",links:[]}},content:{contentType:"text",text:""}}}}},{type:"GET_CONTENTS_OF_SEARCH_ENGINE",parameters:{URLSearchEngine:"google",URLSearchEngineParams:{q:"{{SMART_SEARCH_QUERY}}",region:"",limit:"6",btf:"",nojs:"1",ei:"UTF-8",csp:"1",site:L}}},{type:"SET_VARIABLE",parameters:{VariableName:"SEARCH_SOURCES"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{title:M,quickSearch:[{title:"Understanding question",status:"complete",icon:"CheckCircle"},{title:"Searching web",status:"complete",icon:"Search",value:"{{SMART_SEARCH_QUERY}}"}],sources:{status:"complete",links:"{{SEARCH_SOURCES}}"}}}}}},{type:"RENDER_TEMPLATE",parameters:{template:"{{SEARCH_SOURCES}}"}},{type:"WEBGPT_SEARCH_RESULTS_EXPAND",parameters:{SummarizeActionType:"NO_SUMMARIZE"}},{type:"SET_VARIABLE",parameters:{VariableName:"PAGE_CONTENT"}},{type:"ASK_CHATGPT",parameters:{AskChatGPTWithHistory:P,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",AskChatGPTActionMeta:{messageVisibleText:M,searchSources:"{{SEARCH_SOURCES}}",contextMenu:{id:"73361add-2d6a-4bf3-b2a7-5097551653e7",droppable:!1,parent:"",text:"[Search] answer",data:{editable:!1,type:"shortcuts",actions:[]}}},template:await ta(C)}}];c(d)}catch{}}},x=(0,Wt.useRef)(g);(0,Wt.useEffect)(()=>{x.current=g},[g]);let w=async()=>(await zn())?.sidebarSettings?.search?.conversationId||"",E=async M=>{rr()||er(),r!=="Search"&&await e("Search");let P=await w()||await u("Search");await Dt("add",P,0,[M])},U=async()=>{try{if(s){let M=null,P=0;for(let C=o.length-1;C>=0;C--){let L=o[C];if(P++,L.type==="ai"){M=L;break}}let O=M?.originalMessage?.metadata?.title||M?.text||"";O?(await Dt("delete",s,P,[]),setTimeout(async()=>{await x.current(O,M?.originalMessage?.include_history||!1)},200)):await Dt("delete",s,9999,[])}}catch{}};return(0,Wt.useEffect)(()=>{m.length>0&&!l.current&&r==="Search"&&s&&(l.current=!0,a(m)?f().then().catch().finally(()=>{l.current=!1,c([])}):(c([]),l.current=!1))},[f,c,r,s,m]),{createSearchWithAI:g,regenerateSearchWithAI:U,continueInSearchWithAI:E}},Mh=ea;var Rt=ht(Ht());var Mt=ht(Ht());var Xe=new Ue({runtime:"client"}),ra=()=>{let[s,r]=(0,Mt.useState)([]),{currentAIProviderModelDetail:o,aiProvider:e}=dr(),{currentSidebarConversationMessages:t,currentSidebarConversationId:n}=jt(),i=(0,Mt.useRef)(!1),a=(0,Mt.useMemo)(()=>o?.uploadFileConfig,[o]),f=(0,Mt.useCallback)(async u=>{i.current=!0;let l=Je(u).map(p=>(p.uploadStatus==="idle"&&(p.uploadStatus="uploading",p.uploadProgress=20),p));switch(r(l),e){case"OPENAI":await Xe.postMessage({event:"Client_chatUploadFiles",data:{files:l}});break;case"BING":{let p=await Promise.all(u.map(async g=>{if(g.file&&yr(g.file)){let x=await So(g.file);x&&(g.base64Data=x)}return g}));await Xe.postMessage({event:"Client_chatUploadFiles",data:{files:p}})}break;default:{let p=await Promise.all(u.map(async g=>{let x=await xo(g.file),w=Je(g);return w.file=x,w}));await Xe.postMessage({event:"Client_chatUploadFiles",data:{files:p}})}break}setTimeout(()=>{i.current=!1},1e3)},[a,e]),m=(0,Mt.useCallback)(async u=>{let l=await Xe.postMessage({event:"Client_chatRemoveFiles",data:{files:u}});return r(l.data||[]),l.success},[a]),c=(0,Mt.useMemo)(()=>{switch(e){case"OPENAI":return"File uploading. Please send your message once upload completes.";default:return"File uploading. Please send your message once upload completes."}return""},[e]);return(0,Mt.useEffect)(()=>{let u=s.find(l=>l.uploadStatus==="error");if(u){switch(e){case"OPENAI":n&&!or(t,l=>l.messageId===u.id)&&Dt("add",n,0,[{messageId:u.id,text:u.uploadErrorMessage||`File ${u.fileName} upload error.`,type:"system",extra:{status:u.uploadErrorMessage==="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again."?"info":"error"}}]);break;default:n&&!or(t,l=>l.messageId===u.id)&&Dt("add",n,0,[{messageId:u.id,text:u.uploadErrorMessage||`File ${u.fileName} upload error.`,type:"system",extra:{status:"error"}}])}m([u])}},[s,e]),kn(()=>{Xe.postMessage({event:"Client_chatGetFiles",data:{}}).then(u=>{i.current||qr(u.data)&&r(u.data)})}),lr(()=>{Xe.postMessage({event:"Client_chatGetFiles",data:{}}).then(u=>{qr(u.data)&&r(u.data)})}),Nn(async(u,l,p)=>{switch(u){case"Client_listenUploadFilesChange":{let{files:g}=l;return r(g),{success:!0,data:{},message:""}}default:break}}),{aiProviderUploadingTooltip:c,AIProviderConfig:a,aiProviderUploadFiles:f,aiProviderRemoveFiles:m,files:s}},Wi=ra;var na=s=>{let{disabled:r=!1,TooltipProps:o,onUpload:e,onDone:t,...n}=s,{t:i}=jn(["common","client"]),{files:a,AIProviderConfig:f,aiProviderUploadFiles:m,aiProviderRemoveFiles:c,aiProviderUploadingTooltip:u}=Wi(),l=Ct(Qn),p=Ct(Gt),g=(0,Rt.useRef)(null),x=f?.maxCount||1,w=f?.maxFileSize||5*1024*1024,E=(0,Rt.useMemo)(()=>a.length>=(f?.maxCount||1),[a]),U=async M=>{let P=a?.length||0,O=x-P,C=M.target.files;if(!C||O===0)return;let L=Array.from(C);if(L=L.slice(0,O),L.length===0)return;let y=await Promise.all(L.map(async d=>{let v=yr(d),S="file",b="";v&&(S="image",b=await gr(d)||"");let I={id:nt(),file:d,fileName:d.name,fileSize:d.size,fileType:d.type,base64Data:b,blobUrl:URL.createObjectURL(d),uploadStatus:"idle",uploadErrorMessage:"",uploadProgress:0,icon:S};return w>0&&I.fileSize>w&&(I.uploadStatus="error",I.uploadErrorMessage=`Upload failed: ${I.fileName} exceeds the ${(w/1024/1024).toFixed(0)}MB limit. Please select a smaller file.`),I}));await m(a.concat(y)),g.current&&(g.current.value="")};return!f||l.status!=="success"||p.loading?Rt.default.createElement(Rt.default.Fragment,null):Rt.default.createElement(bo,{files:a,loadingTooltipTitle:u,onRemove:async M=>{await c([M])},TooltipProps:o,...n},!E&&Rt.default.createElement(Kn,{placement:"top",title:f?.acceptTooltip?f.acceptTooltip(i):"Upload file",...o},Rt.default.createElement($n,{disabled:r,sx:{minWidth:"unset",p:0,my:"4px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{g.current&&g.current.click()}},Rt.default.createElement(mo,{icon:"AddCircle",sx:{color:"inherit"}}))),Rt.default.createElement("input",{multiple:x>1,onChange:U,ref:g,accept:f?.accept||"",hidden:!0,style:{display:"none"},type:"file"}))},od=na;export{Oa as a,Io as b,Mo as c,es as d,Pu as e,ki as f,rm as g,Jr as h,Mh as i,od as j};
