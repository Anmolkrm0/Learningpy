import{a as yr,c as mi,d as Do,e as Cr,g as br,h as Ce,i as wr}from"./FZ2GZC7W.js";import{a as fr}from"./D3TVNGC4.js";import{c as Oo}from"./WCTRZLYY.js";import{a as xo,b as dr}from"./ZRWT4YW4.js";import{a as pi}from"./JMRIPDH5.js";import{a as gr}from"./UAB7UEHC.js";import{a as xr}from"./SGC75SOE.js";import{a as Er}from"./HMWPREJN.js";import{a as fn}from"./6MDJIXWZ.js";import{b as Mr,c as di}from"./SVN3RKFH.js";import{g as Fo}from"./4NAB6M5G.js";import{b as St,c as Sr}from"./KIFV56CW.js";import{a as hr}from"./ZYXXBE3P.js";import{$a as Jn,A as dt,Aa as je,Ab as Ct,Ba as fe,Bb as cr,C as ft,Ca as Xt,Cb as pr,D as Ln,Da as gt,E as Rn,Ea as rt,Eb as mr,Fa as Wn,Ga as Jt,Ha as Qt,I as Fn,Ia as ke,Ja as Zt,Ka as eo,La as to,Ma as oo,Na as Lo,Oa as Un,P as On,Pa as zn,Q as Nn,Qa as Vn,R as Oe,Ra as Gn,Sa as Kn,Ta as no,Ua as $n,Va as ro,Wa as io,Xa as qn,Ya as jn,Za as Yn,_a as Xn,ab as xt,b as Mn,bb as ao,cb as ht,d as ve,da as Kt,db as Qn,e as Fe,ea as $t,eb as Zn,fa as jt,fb as so,g as zt,gb as er,ib as tr,jb as lo,kb as or,lb as nr,mb as uo,nb as rr,o as mt,ob as po,t as Tn,tb as mo,u as vn,ub as fo,v as kn,vb as Tt,wb as Ro,x as An,xb as go,y as Pn,yb as lr,z as Bn,zb as ur}from"./BSEQX7JW.js";import{c as Gt,d as _t}from"./H2NXPTRN.js";import{a as Xe}from"./WBKERYKW.js";import{g as de}from"./TAMQTRNZ.js";import{da as qt,ea as co,ga as Ye,ha as yt,ia as ir,ja as ar,ka as sr}from"./PEYNS6YO.js";import{t as bn}from"./OQCOQ46A.js";import{a as Bo}from"./4JVVI5M5.js";import{a as pn}from"./UBBURTUS.js";import{b as Ir}from"./DETFCCYF.js";import{i as Be,j as Vt}from"./ZAZJKFJ6.js";import{c as Ut}from"./SNV3FDHQ.js";import{b as Me,o as En,r as Dn}from"./KUL6UDBQ.js";import{c as Wt,d as wn,g as _n}from"./BQGQFNDN.js";import{a as R}from"./M3D6HDXF.js";import{d as j}from"./PC5JBKQI.js";import{a as V,b as In,u as U}from"./FIOVDIPM.js";import{g as cn}from"./QZNWBGPK.js";import{c as ct,d as vo,g as tt,h as ko,j as un}from"./QZVUH6Z4.js";import{a as pt}from"./YSIM5RLZ.js";import{a as Hn,b as Yt}from"./RW4DAJBJ.js";import{D as yn,E as Ue,J as Cn,K as wt,L as Nt,Q as Ht,R as Sn,a as Ot,b as gn,g as nt,k as xn,s as hn}from"./SVGE6UYD.js";import{c as z}from"./QPPETRF6.js";import{f as mn,g as ne,i as De,k as dn,m as Ie,r as qe}from"./AA7KRV4Y.js";import{M as $e,P as Ft}from"./LVENEOJP.js";import{K as Ao,N as Po,R as ln,T as Ke,U as Dt,a as To,e as W,f as K,g as ue,k as ot,l as Lt,p as Ge,q as nn,r as rn,s as an,t as Rt,u as sn}from"./CIA73AT4.js";import{a as H}from"./64D36THL.js";import{c as on,f as A}from"./PQ35KENF.js";var zr=on(yo=>{"use strict";var _i=In();Object.defineProperty(yo,"__esModule",{value:!0});yo.default=void 0;var Ti=_i(wn()),vi=un(),ki=(0,Ti.default)((0,vi.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");yo.default=ki});var Vr=on(Co=>{"use strict";var Ai=In();Object.defineProperty(Co,"__esModule",{value:!0});Co.default=void 0;var Pi=Ai(wn()),Bi=un(),Li=(0,Pi.default)((0,Bi.jsx)("path",{d:"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"}),"KeyboardReturn");Co.default=Li});var _=A(H());var No=A(pi()),re=A(H());gr(No.default);xr(No.default);var Je=new pt("ContextMenu/Rangy"),fi=new Ft({runtime:"client"}),gi=()=>{let{show:o,initRangyCore:t,rangy:e,showRangy:n,hideRangy:r,saveTempSelection:i,currentSelection:l}=ke(),s=W(Ke).userSettings,{chatBoxShortCutKey:u}=Xe(),[c,p]=K(fe),f=W(zt),[,m]=K(Jt),h=ue(Xt);lr();let[E,G]=K(gt),d=(0,re.useRef)(null),x=(0,re.useRef)(null),{showFloatingContextMenuWithVirtualElement:P}=Ct();Ue(()=>{Promise.all([import("./3VSRMID4.js"),import("./5FYG5HQB.js"),import("./PZGV7OON.js")]).then(([{default:M},{default:C},{default:F}])=>{let v=()=>{t(M)};C(M),F(M),M.init(),M.addInitListener(v)})});let g=(0,re.useRef)(o);(0,re.useEffect)(()=>{g.current=o},[o]);let T=(0,re.useCallback)(M=>{{if(g.current&&M instanceof KeyboardEvent&&M.key==="Escape"){Je.info("Escape close floating button"),r(),mo(),fo();return}let C=M.target,F=M instanceof MouseEvent,v=go(),ee=(e.getSelection().toString()||document?.getSelection()?.toString()||"").trim().replace(/\u200B/g,"");if(C){if(C&&(C.id===Lt||C.id===Rt||C.id===rn))return;if(d.current&&(C=d.current),v){let _e=Tt(v);_e.isEditableElement&&(C=_e.editableElement)}if(!C)return;let{editableElement:J}=Tt(C);if(J&&(C=J),!J&&!ee){r(),x.current=null;return}x.current=Ro(C,{target:C,eventType:F?"mouseup":"keyup"}),Je.info(`native selection [${F?"mouse":"keyboard"}]: 	`,x.current,C)}let N=!1,L=!1;x.current&&(x.current?.isEditableElement?(N=!0,(x.current?.editableElementSelectionText||e.getSelection()?.toString()||document.getSelection()?.toString())&&(L=!0)):x.current?.selectionText&&(N=!0,L=!0),N&&(i({selectionText:x.current?.editableElementSelectionText||x.current.selectionText,selectionHTML:x.current?.editableElementSelectionText||x.current.selectionHTML,selectionRect:x.current.selectionRect,activeElement:x.current.target,selectionInputAble:x.current?.isEditableElement,selectionElement:x.current}),Je.info("save selection temp data",x.current?.isEditableElement,`
`,x.current?.editableElementSelectionText,`
`,x.current?.selectionText)),L?(Je.info("show floating button"),n()):(Je.info("hide floating button"),r()))}},[e,i,n,r]),X=(0,re.useRef)(T);(0,re.useEffect)(()=>{X.current=T},[T]);let D=(0,re.useRef)(()=>{});(0,re.useEffect)(()=>{let M=nt(X.current,200),C=nt(X.current,200),F=v=>{D.current(),D.current=ur(J=>{if(!J.selectionText&&(r(),!J.isEditableElement)){x.current=null;return}x.current=J,J.selectionText&&(J.eventType==="mouseup"?M({target:null}):C({target:null}))});let ee=v.target,{isEditableElement:N,editableElement:L}=Tt(ee);if(N&&L){if(d.current?.isSameNode(L))return;d.current&&(d.current.removeEventListener("mouseup",M),d.current.removeEventListener("keyup",C)),Je.info("save targetElement ref",L),d.current=L,L.addEventListener("mouseup",M),L.addEventListener("keyup",C)}else Je.info("clear targetElement ref"),d.current=null};return document.addEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F),d.current&&(d.current.removeEventListener("mouseup",M),d.current.removeEventListener("keyup",C))}},[e,u,s?.shortcutHintEnable]),(0,re.useEffect)(()=>{let M=nt(X.current,200),C=nt(X.current,200),F=()=>{};return e?.initialized&&(document.addEventListener("mouseup",M),document.addEventListener("keyup",C),F=hr(v=>{if(!v.selectionText&&(r(),!v.isEditableElement)){x.current=null;return}x.current=v,v.selectionText&&(v.eventType==="mouseup"?M({target:null}):C({target:null})),v.isEmbedPage&&v.selectionText&&v?.tagName==="BUTTON"&&yr(),v.selectionText||p(ee=>({...ee,open:!1}))})),()=>{document.removeEventListener("mouseup",M),document.removeEventListener("keyup",C),F()}},[e]),Sn(async(M,C,F)=>{switch(M){case"Client_listenOpenChatMessageBox":{let v=window.getSelection()?.rangeCount;if(v&&v>0){let L=window.getSelection()?.getRangeAt(0)?.cloneRange();h({range:L||null,selectionText:window?.getSelection()?.toString()||""})}let{command:ee}=C,N=ee==="show-floating-menu";if(!x.current){let L=go(),{editableElement:J,isEditableElement:_e}=Tt(L);_e&&J&&(x.current=Ro(J,{target:J,eventType:"keyup"}))}return Je.info("Client_listenOpenChatMessageBox",x.current?.isEditableElement,x.current?.selectionText),P(x.current,{},N),x.current&&(x.current=null),{success:!0,data:{},message:""}}break}});let Z=(0,re.useRef)("");(0,re.useEffect)(()=>{Z.current=E.lastOutput},[E.lastOutput]);let me=(0,re.useRef)(l?.selectionElement);(0,re.useEffect)(()=>{me.current=l?.selectionElement},[l]),(0,re.useEffect)(()=>{let M=me.current||x.current,C=["REPLACE_SELECTION","INSERT_BELOW","INSERT","INSERT_ABOVE","DISCARD","COPY"],F=uo(E.selectContextMenuId||"");if(F)switch(C.includes(F)&&(h({range:null,selectionText:""}),p({open:!1,rootRect:null}),G({selectContextMenuId:"",lastOutput:""}),r(),x.current=null),F){case"INSERT_BELOW":case"INSERT":case"INSERT_ABOVE":case"REPLACE_SELECTION":M&&fi.postMessage({event:"Client_updateIframeInput",data:{value:Z.current,type:F,startMarkerId:M.startMarkerId,endMarkerId:M.endMarkerId,caretOffset:M.caretOffset}});break;case"TRY_AGAIN":{let v="";if(f.length>0){let ee=!1;for(let N=f.length-1;N>=0;N--){let L=f[N];if(L.type==="user"&&(ee=!0),ee&&L.type==="ai"){v=L.messageId;break}}}m({lastAIMessageId:v})}break;case"COPY":try{let v=document.createElement("textarea");v.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,v.value=Z.current,document.body.appendChild(v),v.select(),document.execCommand("copy",!1,""),v.remove()}catch{}break;default:break}},[E.selectContextMenuId]),(0,re.useEffect)(()=>{c.open||h(M=>{if(M.range){window.getSelection()?.removeAllRanges(),window.getSelection()?.addRange(M.range);let C=go();if(C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA")){let F=C,v=F.value.indexOf(M.selectionText||""),ee=v+(M.selectionText||"").length;F.focus(),F.setSelectionRange(v,ee)}setTimeout(()=>{let F=new KeyboardEvent("keyup",{key:" ",code:"Space",location:0,bubbles:!0,cancelable:!0,shiftKey:!1});(C||document.body).focus(),(C||document.body).dispatchEvent(F)},0)}return{...M,range:null}})},[c.open])},_r=gi;var ci=A(To());var Tr=A(H()),xi=()=>{let{setShortCuts:o,runShortCuts:t,loading:e}=Ce("");(0,Tr.useEffect)(()=>{let n=async r=>{if(r.data?.id==="USECHATGPT_WEB_INJECT"){let{taskId:i,type:l,data:a}=r.data;switch(l){case"ping":window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"pong",taskId:i,data:{success:!0}},r.origin);break;case"runShortCutActions":{let{actions:s}=a;e?window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!1,error:"shortcuts is running"}},r.origin):(await o(s),await t(!0),window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!0,error:""}},r.origin));break}}}};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},[e,o,t])},vr=xi;var ze=A(H());var bt=A(H());var hi=()=>{let o=ue(Fe),t=ue(ve),e=jt(),{currentUserPlan:n}=Oe(),{setShortCuts:r,runShortCuts:i}=Ce(""),[l,a]=(0,bt.useState)([]),{createConversation:s}=ft(),u=(0,bt.useRef)(!1),c=async()=>{if(u.current)return;await wt("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0);let p=vn();if(t(f=>({...f,loading:!0})),p){let f=await An(p);if(f?.id)if(o(m=>({...m,summaryConversationId:p})),f.messages?.find(m=>m.type==="ai")){t(m=>({...m,loading:!1}));return}else await dt("clear",p,0,[]);try{if(await s(),t(h=>({...h,loading:!1})),n.name!=="pro"){let h=Number((await Nt()).ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES)||0;if(h>0)await wt("ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES",h-1);else{await dt("clear",p,0,[]),await dt("add",p,0,[qt(e.PAGE_SUMMARY)]),Kt("show","PAGE_SUMMARY");return}}let m=Tn(kn());a(m)}catch{}}};return(0,bt.useEffect)(()=>{l.length>0&&!u.current&&(u.current=!0,r(l)?i().then().catch().finally(()=>{u.current=!1,a([])}):(a([]),u.current=!1))},[i,a,l]),{createPageSummary:c}},kr=hi;var it=A(H()),yi=()=>{let[o,t]=(0,it.useState)(""),e=(0,it.useRef)(""),n=(0,it.useRef)(document.title),r=(0,it.useRef)(0),i=(0,it.useRef)(null),l=()=>{a(),i.current=setInterval(()=>{let s=window.location.href;if(!e.current){n.current=document.title,e.current=s;return}if(s===e.current){n.current=document.title;return}s!==e.current&&(r.current=0),n.current!==document.title?(r.current=0,n.current=document.title,e.current=s,t(s)):(r.current+=1,r.current>10&&(r.current=0,n.current=document.title,e.current=s,t(s)))},1e3)},a=()=>{i.current&&clearInterval(i.current)};return{pageUrl:o,startListen:l,stopListen:a}},Ar=yi;var Ci=()=>{let o=W(Dt),{createPageSummary:t}=kr(),[e,n]=K(Fe),{pageUrl:r,startListen:i}=Ar(),{changeConversation:l}=ft(),a=(0,ze.useRef)(e),{currentAIProviderRef:s,updateChatGPTProvider:u}=Ln(),c=(0,ze.useRef)(s.current);(0,ze.useEffect)(()=>{a.current=e},[e]),(0,ze.useEffect)(()=>{e.type==="Summary"?(c.current=s.current,t().then().catch().finally(()=>{i()})):e.type==="Chat"&&a.current?.chatConversationId&&l(a.current.chatConversationId).then(p=>{!p&&c.current?u(c.current):c.current=s.current})},[e.type]),(0,ze.useEffect)(()=>{e.summaryConversationId||setTimeout(()=>{a.current.type==="Summary"&&t().then().catch()},500)},[e.summaryConversationId]),(0,ze.useEffect)(()=>{a.current.type==="Summary"&&r&&n(p=>({...p,type:"Chat"}))},[r]),(0,ze.useEffect)(()=>{o.chatTypeConversationId&&a.current.type==="Chat"&&n(p=>({...p,chatConversationId:o.chatTypeConversationId}))},[o.chatTypeConversationId]),yn(()=>{a.current.type==="Chat"&&a.current.chatConversationId&&l(a.current.chatConversationId).then()})},Pr=Ci;var Qo=A(ln());var Br=()=>{Ht(async(o,t,e)=>{switch(o){case"ShortCuts_ClientExecuteOperationPageElement":{let{taskId:n,OperationElementConfig:r}=t;return n?(await Mr(n,r),{success:!0,data:!0,message:"ok"}):{success:!1,message:"No taskId",data:null}}break;default:break}})};var Lr=A(H());var Si={inviteLink:o=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText||"").trim()||`Sign up on MaxAI.me using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${o}`},at=Si;var bi=()=>{let{userInfo:o}=Oe(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Ce();return{autoTwitterReferral:(0,Lr.useCallback)(async()=>{if(!n){let l=at.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:`https://twitter.com/intent/tweet?text=${l}`}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetButton"]'],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['a[data-testid="AppTabBar_Profile_Link"]'],actionType:"click",afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetText"]'],actionType:"getText",executeElementCount:10}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:l.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://twitter.com/MaxAI_HQ"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="1667007582270296064-follow"]'],actionType:"click",beforeDelay:2e3,afterDelay:3e3}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")a=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let f=p.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Linkedin] ${f?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:f,shareLink:`[ ${a} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),f&&mt("/user/complete_referral",{referral_types:["TWITTER_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[n,e,t,o?.referral_code]),autoTwitterReferralLoading:n}},Rr=bi;var Dr=A(H());var Ii=()=>{let{userInfo:o}=Oe(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Ce();return{autoFacebookReferral:(0,Dr.useCallback)(async()=>{if(!n){let l=at.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["textarea[title]"],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:at.inviteLink(o?.referral_code||"")},beforeDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[name="__CONFIRM__"]'],actionType:"click",afterDelay:3e3}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/profile.php"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-ad-preview="message"]','div[data-ad-comet-preview="message"]'],executeElementCount:10,actionType:"getText",beforeDelay:2e3}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:l.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a=(s,u)=>{let c=u?.action;if(s==="afterRunAction"&&c?.type==="SET_VARIABLE"&&c.parameters?.VariableName==="AutoTwitterReferralResult"){let p=c.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Facebook] ${p?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:p},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),p&&mt("/user/complete_referral",{referral_types:["FACEBOOK_SHARE"]}).then()}};return r.current?.addListener(a),await e(),r.current?.removeListener(a),!0}return!1},[n,e,t,o?.referral_code]),autoFacebookReferralLoading:n}},Fr=Ii;var Or=A(H());var Mi=()=>{let{userInfo:o}=Oe(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Ce();return{autoLinkedinReferral:(0,Or.useCallback)(async()=>{if(!n){let l=at.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.artdeco-button"],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[contenteditable="true"]'],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:l},afterDelay:1e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.share-actions__primary-action"],actionType:"click",afterDelay:3e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__view-btn"],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__continue-btn"],actionType:"getText"}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:"linkedin",WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")a=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let f=p.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Linkedin] ${f?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:f,shareLink:`[ ${a} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),f&&mt("/user/complete_referral",{referral_types:["LINKEDIN_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[n,e,t,o?.referral_code]),autoLinkedinReferralLoading:n}},Nr=Mi;var ho=A(H());var Ei=()=>{let{autoTwitterReferral:o}=Rr(),{autoFacebookReferral:t}=Fr(),{autoLinkedinReferral:e}=Nr(),n=(0,ho.useRef)({});(0,ho.useEffect)(()=>{n.current={twitter:o,linkedin:e,facebook:t}},[o,e,t]),Ue(()=>{Ao&&location.href.includes(Ao)&&setInterval(()=>{let r=document.querySelector("#appMaxAIReferralShareOneClickContainer"),i=document.querySelector("#appMaxAIReferralShareOneClickButton");if(r&&i){if(!r.classList.contains("loaded"))r.classList.add("loaded");else return;i.addEventListener("click",async()=>{let l=Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));for(let c=0;c<l.length;c++){let f=l[c].getAttribute("data-name"),m=n.current?.[f];m&&await m()}await(c=>new Promise(p=>setTimeout(p,c)))(3e3);let s=new URL(window.location.href),u=new URLSearchParams(s.search);u.set("show_completed","true"),s.search=u.toString(),window.location.href=s.toString()})}},1e3)})},Hr=Ei;var Wr=A(di());var wi=()=>{let o=new Map,t=new Ft,e=async(n,r,i)=>{await t.postMessage({event:"Client_ListenProxyWebsocketResponse",data:{data:r,taskId:n,listenerType:i}})};Ht(async(n,r)=>{switch(n){case"Client_ListenProxyWebsocket":{let{taskId:i,data:l,type:a}=r;switch(a){case"Open":{let s=l.mode,u=new Wr.default(l.url,s==="bing"?{packMessage:Fo.packMessage,unpackMessage:Fo.unpackMessage}:{});return u.onUnpackedMessage.addListener(c=>{e(i,c,"onUnpackedMessage")}),u.onMessage.addListener(async c=>{e(i,c,"onMessage")}),u.onClose.addListener(()=>{e(i,{},"onClose")}),await u.open(),o.set(i,u),{success:!0,data:"success",message:"ok"}}break;case"Close":{let s=o.get(i);return s?(s.removeAllListeners(),await s.close(),o.delete(i),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;case"SendPacked":{let s=o.get(i);return s?(s.sendPacked(l),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;default:return{success:!0,data:"success",message:"ok"}}}break}})},Ur=wi;var Ze=A(H());var Ve=A(H()),Xr=A(To());vo();ko();var I=A(H());var le=A(H());var b=A(H());var Se=A(H());var Ho=A(zr()),Kr=A(Vr());var ce=b.forwardRef(({label:o,icon:t,CustomRenderNode:e,onClick:n,isGroup:r,...i},l)=>{let a=i;return b.createElement(R,{...i,sx:{boxSizing:"border-box",borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:l,component:"div",role:"menuitem",onClick:s=>{n?.(s),a?.onClick?.(s)}},b.createElement(R,null,e||b.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},b.createElement(de,{size:16,icon:t||"Empty",sx:{color:"primary.main",flexShrink:0}}),b.createElement(U,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o),r&&b.createElement(Ho.default,{sx:{ml:"auto",mr:0,flexShrink:0,color:s=>s.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}))))}),Wo=b.forwardRef(({label:o,disabled:t,menuItem:e,...n},r)=>{let i=n,{t:l}=z(["prompt"]),a=W(Wn),[s,u]=K(rt),c=(0,Se.useMemo)(()=>{let m=e.id.replace(yt,""),h=`prompt:${m}`;return l(h)!==m?l(h):e.text},[e.text,l]),p=(0,Se.useMemo)(()=>a.includes(e.id)||e.id===s.lastHoverContextMenuId,[a,s.lastHoverContextMenuId]),f=(0,Se.useMemo)(()=>s.lastHoverContextMenuId===e.id&&p,[p,s.lastHoverContextMenuId]);return b.createElement(R,{...n,"data-id":e.id,className:`floating-context-menu-item ${p?"floating-context-menu-item--active":""}`,tabIndex:p?0:-1,sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1,boxSizing:"border-box",px:1,borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:m=>m.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:m=>m.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:r,component:"div",role:"menuitem",onKeyDown:m=>{i?.onKeyDown?.(m),m.code==="Enter"&&(u(h=>({...h,selectedContextMenuId:e.id})),m.stopPropagation())},onClick:m=>{u(h=>({...h,selectedContextMenuId:e.id})),i?.onClick?.(m)}},e?.data?.icon&&b.createElement(de,{size:16,icon:e.data.icon,sx:{color:"primary.main",flexShrink:0}}),b.createElement(U,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},c),b.createElement("span",{className:"floating-context-menu-item__footer-icon "+(e.data.type==="group"?"floating-context-menu-item__footer-icon--active":"")},e.data.type==="group"?b.createElement(Ho.default,{sx:{color:m=>m.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}):f&&b.createElement(Kr.default,{sx:{color:m=>m.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}})))}),Gr=b.forwardRef(({referenceElement:o,referenceElementOpen:t,zIndex:e,children:n,label:r,root:i,hoverOpen:l=!0,customOpen:a=!1,needAutoUpdate:s=!1,menuSx:u,defaultPlacement:c,defaultFallbackPlacements:p,onClickContextMenu:f,onClickReferenceElement:m,menuWidth:h=400,...E},G)=>{let d=Un(),x=zn(),P=Lo(),g=!P&&e===2147483601,[T,X]=K(rt),D=P!=null,[Z,me]=b.useState(a?t:!1);(0,Se.useEffect)(()=>{setTimeout(()=>{me(t)},1)},[t]);let[M,C]=b.useState(g?1:null),F=W(fe),[v,ee]=b.useState(!1),N=(0,Se.useRef)(null),L=(0,Se.useRef)(null),J=b.useRef([]),_e=b.useRef(b.Children.map(n,S=>b.isValidElement(S)?S.props.label:null)),Eo=c||(g?"bottom-start":"right-start"),wo=p||(g?["bottom-start","top-start","right"]:["right","right-start","right-end","left","left-start","left-end"]),Ne=()=>{C(null),L.current=null,N.current=null},{x:Mt,y:_o,strategy:st,refs:lt,context:Re}=xt({nodeId:x,open:Z,onOpenChange:S=>{S||Ne(),!a&&me(S)},placement:Eo,middleware:[eo({mainAxis:g?4:0,alignmentAxis:g?0:-4}),Zt({fallbackPlacements:wo}),to()],whileElementsMounted:s?oo:void 0}),et=Kn(Re,{enabled:l&&v,delay:{open:75},handleClose:Jn({restMs:25,blockPointerEvents:!1})}),Et=ro(Re,{event:"mousedown",toggle:!D||!v,ignoreMouse:D}),kt=Yn(Re,{role:"menu"}),At=io(Re),He=(0,Se.useRef)(null),y=qn(Re,{listRef:J,activeIndex:M,nested:D,onNavigate(S){let Q=()=>{let q=ne()?.querySelector(`#${Ge}`);q&&q?.focus()},B=P?"[\u5B50\u7EA7]":"[\u6839\u7EA7]",se=He.current?.key;if(se){let q=!1,xe=null;L.current&&(q=!0,xe=So(L.current));let te=[];J.current?.forEach((ye,Bt)=>{let Te=ye?.getAttribute("data-id");Te&&te.push({floatingUIId:ye?.id?.replace(/:/g,"\\:")||"",contextMenuId:Te,contextMenuIndex:Bt})}),X(ye=>{let Bt=ye.hoverContextMenuIdMap[x]||ye.lastHoverContextMenuId||"";q&&xe?.contextMenuId&&(Bt=xe.contextMenuId);let Te=te.findIndex(ut=>ut.contextMenuId===Bt);if(se==="ArrowLeft")return C(null),Q(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[x]:""}};if(se==="ArrowRight")if(te.length>0){let ut=te[0];return C(ut.contextMenuIndex),Q(),{...ye,lastHoverContextMenuId:ut.contextMenuId}}else return C(null),Q(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[x]:""}};let Zo=!1,en=He.current?.target,tn=en?.getAttribute("data-lastid");if(tn&&(Te=te.findIndex(ut=>ut.floatingUIId===tn),en.removeAttribute("data-lastid"),Zo=!0),Te===-1&&(P||(Te=0)),Te===-1)return Q(),ye;let We=null;return se==="ArrowDown"?Zo||q?We=te[Te]:te[Te+1]?We=te[Te+1]:We=te[0]:se==="ArrowUp"&&(te[Te-1]?We=te[Te-1]:We=te[te.length-1]),We?(C(We.contextMenuIndex),Q(),{...ye,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[x||""]:We.contextMenuId},lastHoverContextMenuId:We.contextMenuId}):(Q(),ye)}),He.current=null}},loop:!0,virtual:!0}),k=Xn(Re,{enabled:Z,listRef:_e,onMatch:Z?C:void 0,activeIndex:M}),{getReferenceProps:$,getFloatingProps:be,getItemProps:ae}=ao([et,Et,kt,At,y,k]);b.useEffect(()=>{if(!d)return;function S(){a||me(!1)}function Q(B){B.nodeId!==x&&B.parentId===P&&me(!1)}return d.events.on("click",S),d.events.on("menuopen",Q),()=>{d.events.off("click",S),d.events.off("menuopen",Q)}},[d,x,P,a]),b.useEffect(()=>{Z&&d&&d.events.emit("menuopen",{parentId:P,nodeId:x})},[d,Z,x,P]),b.useEffect(()=>{function S({pointerType:B}){B!=="touch"&&ee(!0)}function Q(){ee(!1)}return window.addEventListener("pointermove",S,{once:!0,capture:!0}),window.addEventListener("keydown",Q,!0),()=>{window.removeEventListener("pointermove",S,{capture:!0}),window.removeEventListener("keydown",Q,!0)}},[v]),(0,Se.useEffect)(()=>{let S=!1;return g&&T.lastHoverContextMenuId&&n&&setTimeout(()=>{S||C(Q=>{let B=n.findIndex(se=>se?.key===T.lastHoverContextMenuId);return B!==-1&&Q===null?B:Q})},0),()=>{S=!0}},[T.lastHoverContextMenuId,n]);let Pe=jn([lt.setReference,G]),Pt=(0,Se.useCallback)(()=>{let S=T.lastHoverContextMenuId;if(S){let Q=ne()?.querySelector(`[data-id="${S}"]`);Q&&Q.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0,code:"Enter",keyCode:13}))}},[T]);return(0,Se.useEffect)(()=>{F.open||(Ne(),X(S=>({...S,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})))},[F.open]),b.createElement(Vn,{id:x},o?b.isValidElement(o)&&b.cloneElement(o,{...$({...E,className:`${D?"MenuItem":"RootMenu"}`,onClick(S){S.stopPropagation(),m?.(S)},onKeyDownCapture(S){if(S.key==="Enter"&&!P){Pt();return}if(S.key==="ArrowDown"||S.key==="ArrowUp"||S.key==="ArrowLeft"||S.key==="ArrowRight"){if(L.current=null,S.key==="ArrowLeft"){if(!P&&N.current){let B=So(N.current);B?.parentDropdownSelectedItem&&(B.dropdownSelectedItem.focus(),B.dropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:S.key,bubbles:!0,cancelable:!0})),B.parentDropdownSelectedItem&&B.id&&(B.parentDropdownSelectedItem.setAttribute("data-lastid",B.id),B.parentDropdownSelectedItem.focus(),B.parentDropdownSelectedItem.classList.contains("RootMenu")?N.current=null:N.current=B.parentDropdownSelectedItem,B.parentDropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))))}return}else if(S.key==="ArrowRight"&&!P&&M!==null){let B=J.current[M];if(N.current){let se=N.current?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),q=ne()?.querySelector(`#${se}`);if(q){let xe=q.getAttribute("aria-activedescendant")?.replace(/:/g,"\\:"),te=q.querySelector(`#${xe}`);te.id&&te.getAttribute("aria-haspopup")&&(B=te)}}B&&B.getAttribute("aria-haspopup")==="menu"&&(B.focus(),B.dispatchEvent(new KeyboardEvent("keydown",{key:S.key,bubbles:!0,cancelable:!0})),N.current=B);return}else if(N.current){N.current.focus(),N.current.dispatchEvent(new KeyboardEvent("keydown",{key:S.key,bubbles:!0,cancelable:!0}));return}ne()?.querySelector(`#${Ge}`)?.focus(),He.current=S}},...D&&{role:"menuitem"},ref:Pe})}):b.createElement(j,{ref:Pe,...$({...E,className:`${D?"MenuItem":"RootMenu"}`,onClick(S){S.stopPropagation()},...D&&{role:"menuitem"}}),startIcon:b.createElement(Me,{sx:{fontSize:16,color:"inherit"}}),variant:"outlined"},r||"Use ChatGPT"),b.createElement(no,{root:i},Z&&b.Children.count(n)&&b.createElement($n,{context:Re,modal:!1,initialFocus:-1,visuallyHiddenDismiss:!0},b.createElement(R,{sx:{zIndex:(e||0)+1,display:"flex",flexDirection:"column",p:.5,outline:"none!important",width:h,maxHeight:327,boxSizing:"border-box",overflowY:"auto",border:"1px solid",borderColor:"customColor.borderColor",bgcolor:"background.paper",borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px","& *":{outline:"none!important"},"&:has(.max-ai--popper-wrapper)":{overflowY:"unset"},...u},component:"div",ref:lt.setFloating,className:"Menu",style:{position:st,top:_o??0,left:Mt??0},...be()},b.Children.map(n,(S,Q)=>b.isValidElement(S)&&b.cloneElement(S,ae({tabIndex:M===Q?0:-1,ref(B){J.current[Q]=B},onMouseDown(B){f&&(d?.events.emit("click"),S.props?.menuItem?.data?.type==="shortcuts"&&f?.(S.props.menuItem))},onClick(B){f||(S.props.onClick?.(B),d?.events.emit("click"))},onKeyDownCapture(B){He.current=B},onMouseEnter(B){B.stopPropagation(),B.preventDefault();let se=B.currentTarget;if(se.getAttribute("data-id")){N.current=se;let q=So(se);if((q?.id||q?.contextMenuId)&&q.expandedSiblingMenuItem){if(q.expandedSiblingMenuItem?.getAttribute("data-id")===q.contextMenuId)return;let xe=So(q.expandedSiblingMenuItem);if(xe?.dropdownSelectedItem){let te=new KeyboardEvent("keydown",{key:"ArrowLeft",bubbles:!0,cancelable:!0});L.current=xe.dropdownSelectedItem,xe.dropdownSelectedItem.focus(),xe.dropdownSelectedItem.dispatchEvent(te),q.expandedSiblingMenuItem.setAttribute("data-lastid",q.contextMenuId),q.expandedSiblingMenuItem.classList.contains("RootMenu")?N.current=null:N.current=xe.parentDropdownSelectedItem,q.expandedSiblingMenuItem.focus(),q.expandedSiblingMenuItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))}}if(q?.id){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});L.current=se,q.keydownEmitElement?.dispatchEvent(xe);let te=new KeyboardEvent("keydown",{key:"ArrowRight",bubbles:!0,cancelable:!0});L.current=se,se.dispatchEvent(te)}else if(q?.contextMenuId){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});L.current=se,se.dispatchEvent(xe)}}}})))))))}),Le=b.forwardRef((o,t)=>Lo()===null?b.createElement(Gn,null,b.createElement(Gr,{...o,ref:t})):b.createElement(Gr,{...o,ref:t})),So=o=>{let t=ne();if(!o||!t)return null;let e=o.getAttribute("id")?.replace(/:/g,"\\:")||"",n=o.getAttribute("data-id")||"",r=o.getAttribute("aria-haspopup")==="menu",i=t.querySelector(`div[aria-haspopup="menu"][aria-activedescendant="${e}"]`),l=i?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),a=l?t.querySelector(`#${l}`):null,s=o.getAttribute("aria-controls")?.replace(/:/g,"\\:"),u=s?t.querySelector(`#${s}`):null,c=null;u&&!c&&(c=u.querySelector('.floating-context-menu-item--active:not([aria-haspopup="menu"])'),c||(c=u.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')));let p=o.parentElement?.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])'),f=o.parentElement?.querySelector('.floating-context-menu-item[aria-expanded="true"]');return{id:e,contextMenuId:n,isMenu:r,parentDropdownSelectedItem:i,parentDropdown:a,dropdownMenu:u,dropdownSelectedItem:c,keydownEmitElement:p,expandedSiblingMenuItem:f}};var Uo=(0,le.forwardRef)((o,t)=>{let{menuItem:e,root:n,referenceElement:r,referenceElementOpen:i,rootMenu:l,customOpen:a,onClickContextMenu:s,menuWidth:u,...c}=o,{t:p}=z(["prompt"]),f=(0,le.useMemo)(()=>p(`prompt:${e.id}`)!==e.id?p(`prompt:${e.id}`):e.text,[e.text,p]),m=(0,le.useCallback)(h=>p(`prompt:${h.id}`)!==h.id?p(`prompt:${h.id}`):h.text,[p]);return e.data.type==="group"?le.default.createElement(Le,{zIndex:o.zIndex,ref:t,root:n,label:f,menuWidth:u,onClickContextMenu:s,referenceElement:le.default.createElement(Wo,{...c,label:f,menuItem:e})},e.children.map((h,E)=>le.default.createElement(Uo,{...c,root:n,key:h.id,menuItem:h,label:m(h)}))):le.default.createElement(Wo,{...c,menuItem:e,ref:t,label:f})}),Ri=o=>{let{root:t,referenceElement:e,referenceElementOpen:n,menuList:r,customOpen:i,needAutoUpdate:l,defaultPlacement:a,defaultFallbackPlacements:s,onClickContextMenu:u,menuWidth:c,onClickReferenceElement:p,hoverOpen:f,...m}=o,{t:h}=z(["prompt"]),E=(0,le.useMemo)(()=>{let G=[];return r.forEach((d,x)=>{let P=h(`prompt:${d.id}`)!==d.id?h(`prompt:${d.id}`):d.text;d.data.type==="group"?(x>0&&G.push(le.default.createElement(R,{key:d.id+"_group_spector","aria-disabled":!0,onClick:g=>{g.stopPropagation(),g.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:"customColor.borderColor",my:1}})),G.push(le.default.createElement(R,{key:d.id+"_group_name",component:"div","aria-disabled":!0,sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",px:1,pointerEvents:"none"},onClick:g=>{g.stopPropagation(),g.preventDefault()}},le.default.createElement(U,{textAlign:"left",fontSize:12,color:"text.secondary"},P))),d.children.forEach((g,T)=>{G.push(le.default.createElement(Uo,{menuWidth:c,onClickContextMenu:u,zIndex:2147483602,...m,key:g.id,label:"",menuItem:g,root:t}))})):G.push(le.default.createElement(Uo,{menuWidth:c,onClickContextMenu:u,key:d.id,label:"",menuItem:d,root:t}))}),G},[r,h]);return le.default.createElement(Le,{zIndex:2147483601,label:"",root:t,customOpen:i,needAutoUpdate:l,referenceElement:e,referenceElementOpen:n,defaultPlacement:a,defaultFallbackPlacements:s,onClickContextMenu:u,onClickReferenceElement:p,hoverOpen:f,menuWidth:c},E)},bo=Ri;var pe=A(H());var zo=o=>{let{sx:t}=o,{t:e}=z(["common","client"]),[n,r]=(0,pe.useState)(!0),[i,l]=(0,pe.useState)(null);return(0,pe.useEffect)(()=>{if(i)return;let a=ne();a&&l(a),r(!1)},[]),pe.default.createElement(_t,{loading:n},i&&pe.default.createElement(Le,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:i,menuSx:{width:240},referenceElement:pe.default.createElement(R,{sx:{alignSelf:"end"}},pe.default.createElement(j,{size:"small",variant:"text",sx:{width:32,height:32,color:"inherit",minWidth:"unset",...t}},pe.default.createElement(de,{icon:"More",sx:{color:"text.primary",fontSize:16}})))},pe.default.createElement(ce,{onClick:()=>{Ie({key:"options",query:"#/my-own-prompts"})},label:e("client:floating_menu__button__manage_my_own_prompt"),icon:"DefaultIcon"}),pe.default.createElement(Le,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:i,referenceElement:pe.default.createElement(ce,{isGroup:!0,icon:"Delete",label:e("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},pe.default.createElement(ce,{label:e("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Ye.getMediator("textSelectPopupButton").clearCache()}}),pe.default.createElement(ce,{label:e("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Ye.getMediator("textSelectPopupButton").clearAllHostCache()}})),pe.default.createElement(ce,{onClick:()=>{Ie({key:"options"})},label:e("common:settings"),icon:"Settings"})))};var Vo=A(H());var Io=A(H());var Go=o=>{let{t}=z(["common","client"]),{sx:e,placement:n,ButtonProps:r,iconSize:i=16,icon:l="Close"}=o,[,a]=K(fe),s=ue(je);return Io.default.createElement(Be,{title:t("client:floating_menu__button__hide_menu__until_next_visit"),floatingMenuTooltip:!0,placement:n},Io.default.createElement(j,{size:"small",variant:"text",sx:{width:32,height:32,minWidth:"unset",color:"text.primary",...e},onClick:async()=>{a({open:!1,rootRect:null}),s(u=>({...u,closeBeforeRefresh:!0}))},...r},Io.default.createElement(de,{icon:l,sx:{color:"inherit",fontSize:i}})))};var oe=A(H());var Mo=A(H());var vt=o=>{let{t}=z(["common","client"]),{hideRangy:e}=ke(),[,n]=K(fe),{chatBoxShortCutKey:r}=Xe();return Mo.default.createElement(Be,{description:r,title:t("client:floating_menu__button__switch_to_sidebar"),placement:"bottom",...o.TooltipProps},Mo.default.createElement(j,{sx:{ml:"0px!important",height:"24px",flexShrink:0,alignSelf:"end",minWidth:"unset",padding:"6px 5px"},className:"max-ai__actions__button--toggle-sidebar",variant:"text",onClick:()=>{rr(),e(),n({open:!1,rootRect:null}),dn()||De()}},Mo.default.createElement(En,{sx:{fontSize:"16px",color:"text.primary"}})))};var Ko=()=>{let o=W(ve),t=(0,oe.useRef)(!1),e=(0,oe.useMemo)(()=>!!(o.loading&&o.writingMessage?.text),[o.loading,o.writingMessage]),{stopGenerateMessage:n,reGenerate:r}=mr(),i=(0,oe.useCallback)(async a=>{a==="s"&&(t.current=!1,await n()),a==="r"&&(t.current=!0,await n())},[n]),l=(0,oe.useRef)(r);return(0,oe.useEffect)(()=>{l.current=r},[r]),(0,oe.useEffect)(()=>{if(!e)return;let a=async s=>{let u=s.key;lo()&&["r","s","o","c"].includes(u)&&(s.preventDefault(),s.stopPropagation(),await i(u))};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[e,i]),e?oe.default.createElement(V,{direction:"row",spacing:1,sx:{ml:"auto!important","& .usechatgpt-floating-menu__button__shortcut":{fontSize:"12px",opacity:.7,ml:"4px"}}},oe.default.createElement(j,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("r")}},oe.default.createElement(U,{component:"span",fontSize:"14px",color:"primary.main"},"Try again",oe.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"R"))),oe.default.createElement(j,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("s")}},oe.default.createElement(U,{component:"span",fontSize:"14px",color:"primary.main"},"Stop",oe.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"S"))),oe.default.createElement(vt,null)):oe.default.createElement(oe.default.Fragment,null)};var w=A(H());var Qe=A(H());var Di=o=>{let t=ne()||document.body,{children:e,content:n,boxSx:r,onClick:i,PopperProps:l,hoverOpen:a,stopEvent:s=!0}=o,[u,c]=Qe.default.useState(null),p=(0,Qe.useRef)(Ot()),f=d=>{s&&(d.stopPropagation(),d.preventDefault()),c(u?null:d.currentTarget),i?.(d)},m=d=>{a&&c(d.currentTarget)},h=d=>{a&&c(null)},E=!!u,G=E?p.current:void 0;return Qe.default.createElement(Qe.default.Fragment,null,Qe.default.createElement(R,{component:"div",onMouseEnter:m,onMouseLeave:h,onClick:f,onMouseDown:d=>{s&&(d.stopPropagation(),d.preventDefault())},onMouseUp:d=>{s&&(d.stopPropagation(),d.preventDefault())},sx:{...r}},e),Qe.default.createElement(Dn,{disablePortal:!0,id:G,open:E,anchorEl:u,container:t,style:{zIndex:2147483630},className:"max-ai--popper-wrapper",...l},n))},$o=Di;var Ee=A(H());var Fi=({liteMode:o})=>{let{t}=z(["common","client"]);return Ee.default.createElement(Ee.default.Fragment,null,o?Ee.default.createElement(R,{sx:{borderRadius:"4px",bgcolor:e=>e.palette.mode==="dark"?"rgb(7, 19, 24)":"rgb(229, 246, 253)",color:e=>e.palette.mode==="dark"?"rgb(184, 231, 251)":"rgb(1, 67, 97)",p:2,overflow:"hidden"}},Ee.default.createElement(V,{spacing:1,alignItems:"center"},Ee.default.createElement(U,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),Ee.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry-small.png",alt:"settings-entry",width:200,height:80}))):Ee.default.createElement(xo,{icon:Ee.default.createElement(Ee.default.Fragment,null),sx:{mt:1,mb:2}},Ee.default.createElement(V,{spacing:1},Ee.default.createElement(U,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),Ee.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry.png",alt:"settings-entry",width:466,height:121}))))},qo=Fi;var jo=o=>{let{sx:t,placement:e}=o,{t:n}=z(["common","client"]),[r,i]=(0,w.useState)(!0),l=ue(je),{updateButtonSettingsWithDomain:a,toggleButtonSettings:s}=Hn(),{hideRangy:u}=ke(),[,c]=K(fe),[p,f]=(0,w.useState)(null),[m,h]=(0,w.useState)(!1);return(0,w.useEffect)(()=>{if(p)return;let E=ne();E&&f(E),i(!1)},[]),w.default.createElement(_t,{loading:r},p&&w.default.createElement(Le,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:p,menuSx:{width:240},referenceElement:w.default.createElement(R,{sx:{zIndex:2,alignSelf:"end",position:"relative",display:"flex",bgcolor:m?"background.paper":"transparent",borderRadius:m?0:"0 14px 14px 0",transition:m?"background-color 0s ease-out":"background-color 0.1s ease-in-out",width:"34px","&::before":{content:'""',position:"absolute",left:0,height:"28px",bgcolor:"background.paper",width:"21px"}}},w.default.createElement(j,{onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)},size:"small",variant:"text",sx:{padding:"5px 8px",color:"inherit",minWidth:"unset",...t}},w.default.createElement(de,{icon:"More",sx:{color:E=>E.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)",fontSize:"18px"}})),w.default.createElement(Go,{ButtonProps:{onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)}},icon:m?"Close":"More",iconSize:18,sx:{zIndex:1,left:m?"100%":0,transition:"left 0.1s ease-in-out",width:"34px",height:"28px",padding:"5px 8px",borderRadius:"0 14px 14px 0",right:"-100%",position:"absolute",bgcolor:"background.paper",color:E=>E.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)","&:hover":{bgcolor:E=>E.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}},placement:e}))},w.default.createElement(Le,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:w.default.createElement(ce,{isGroup:!0,icon:"Delete",label:n("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},w.default.createElement(ce,{label:n("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Ye.getMediator("textSelectPopupButton").clearCache()}}),w.default.createElement(ce,{label:n("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Ye.getMediator("textSelectPopupButton").clearAllHostCache()}})),w.default.createElement(Le,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:w.default.createElement(ce,{isGroup:!0,icon:"VisibilityOff",label:n("client:floating_menu__button__hide_menu")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},w.default.createElement(ce,{onClick:()=>{c({open:!1,rootRect:null}),l(E=>({...E,closeBeforeRefresh:!0}))},label:n("client:floating_menu__button__hide_menu__until_next_visit")}),w.default.createElement(ce,{CustomRenderNode:w.default.createElement($o,{PopperProps:{placement:"top"},onClick:E=>{E.stopPropagation(),E.preventDefault()},content:w.default.createElement(Oo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},w.default.createElement(V,{spacing:1},w.default.createElement(U,{textAlign:"center",fontWeight:"600",fontSize:"16px",color:"text.primary"},n("client:floating_menu__button__hide_menu__this_site__tooltip__title")),w.default.createElement(qo,{liteMode:!0}),w.default.createElement(R,null),w.default.createElement(j,{variant:"outlined",color:"primary",onClick:async()=>{await a("textSelectPopupButton"),c({open:!1,rootRect:null})}},n("client:floating_menu__button__hide_menu__this_site__tooltip__confirm")),w.default.createElement(j,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},n("common:cancel"))))},w.default.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},w.default.createElement(de,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),w.default.createElement(U,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n("client:floating_menu__button__hide_menu__this_site"))))}),w.default.createElement(ce,{CustomRenderNode:w.default.createElement($o,{PopperProps:{placement:"top"},onClick:E=>{E.stopPropagation(),E.preventDefault()},content:w.default.createElement(Oo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},w.default.createElement(V,{spacing:1},w.default.createElement(U,{fontSize:"16px",color:"text.primary",textAlign:"center",fontWeight:"600"},n("client:floating_menu__button__hide_menu__all_sites__tooltip__title")),w.default.createElement(qo,{liteMode:!0}),w.default.createElement(R,null),w.default.createElement(j,{variant:"outlined",color:"primary",onClick:async()=>{await s("textSelectPopupButton",!1),c({open:!1,rootRect:null})}},n("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm")),w.default.createElement(j,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},n("common:cancel"))))},w.default.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},w.default.createElement(de,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),w.default.createElement(U,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n("client:floating_menu__button__hide_menu__all_sites"))))}),w.default.createElement(ce,{label:n("client:floating_menu__button__menu_settings"),icon:"Settings",onClick:()=>{Ie({key:"options",query:"#/mini-menu"})}})),w.default.createElement(ce,{onClick:()=>{Ie({key:"options"})},label:n("common:settings"),icon:"Settings"})))};var Y=A(H());var Oi=o=>{let t=pn(),{onChange:e}=o,n=W(zt),r=W(fe),[,i]=K(gt),[,l]=K(Jt),a=W(Qt),s=(0,Y.useRef)("");(0,Y.useEffect)(()=>{s.current=On(n,m=>m.type==="ai")?.messageId||""},[n]),(0,Y.useEffect)(()=>{r.open&&l({lastAIMessageId:s.current})},[r.open]),(0,Y.useEffect)(()=>{i(m=>({...m,lastOutput:a})),e?.(a)},[a,r.open]);let u=(0,Y.useRef)(null),c=Y.default.useRef(null),p=(0,Y.useCallback)(hn(()=>{let m=u.current;m&&(m.style.minHeight=`${c.current?.offsetHeight||0}px`)},100),[]),f=(0,Y.useCallback)(nt(()=>{let m=u.current;m&&(m.style.minHeight=`${(c.current?.offsetHeight||0)+1}px`)},100),[]);return(0,Y.useEffect)(()=>{setTimeout(()=>{c.current?.scrollTo({top:c.current.scrollHeight}),p(),f()},0)},[a]),(0,Y.useEffect)(()=>{let m=h=>{if((h.metaKey||h.ctrlKey)&&(h.stopPropagation(),h.key==="C"||h.key==="c"||h.key==="x"||h.key==="X")){let E=window.getSelection();if(E&&E.rangeCount>0){let d=E.getRangeAt(0).toString()||E.toString();d&&(h.preventDefault(),navigator.clipboard.writeText(d))}}};c.current?.addEventListener("keydown",m,!0)},[]),Y.default.createElement(V,{ref:u,className:"chat-message--text max-ai__writing-message-box",whiteSpace:"pre-wrap",width:"100%",sx:{wordBreak:"break-word",borderBottomLeftRadius:0,color:m=>m.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)","& .markdown-body":{userSelect:"text",maxHeight:"min(40vh, 320px)",overflowY:"auto","*":{fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important'},"& p:last-child":{mb:"1em"}}},component:"div"},gn(a)?Y.default.createElement(Ni,null):null,Y.default.createElement("div",{tabIndex:-1,ref:c,style:{textAlign:"left"},className:`markdown-body ${t.isDarkMode?"markdown-body-dark":""}`},Y.default.createElement(Er,null,a.replace(/^\s+/,""))))},Ni=()=>{let{t:o}=z(["common","client"]),{currentSelection:t}=ke(),e=(0,Y.useMemo)(()=>{if(t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText){let n=t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText.trim().replace(/\u200B/g,"");return((i,l)=>{if(i.length<=l)return{start:i,end:""};let a=i.substring(i.length-l);return{start:i.substring(0,i.length-l),end:a}})(n,15)}return{start:"",end:""}},[t]);return!e.start&&!e.end?null:Y.default.createElement(U,{sx:{width:"100%",display:"flex",flexDirection:"row"},fontSize:"12px",fontWeight:400,color:"text.secondary"},Y.default.createElement("span",{style:{flexShrink:0}},o("client:floating_menu__draft_card__context__title"),":"," "),Y.default.createElement("span",{style:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"}},e.start),Y.default.createElement("span",{style:{flexShrink:0,whiteSpace:"nowrap"}},e.end))},$r=Oi;var jr=A(mi());var we=A(H());var Hi=({TooltipProps:o,...t})=>{let e=W(Fe),{currentAIProviderDetail:n,currentAIProviderModelDetail:r}=Bn(),{t:i}=z(["common","client"]),[l,a]=(0,we.useState)(void 0);return(0,we.useEffect)(()=>{if(e.type==="Chat"&&n&&r){let s=i(n.label)!==n.label?i(n.label):n.label,u=i(r.title)!==r.title?i(r.title):r.title;a({title:`${s} (${u})`,provider:n.value,model:r.value})}},[n,r,i,e.type]),we.default.createElement(we.default.Fragment,null,l?we.default.createElement(Be,{...o,title:l.title},we.default.createElement(R,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},l.provider?we.default.createElement(Rn,{aiProviderType:l.provider,...t}):we.default.createElement(Me,{sx:{fontSize:t.size,...t.sx}}))):we.default.createElement(R,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},we.default.createElement(Me,{sx:{fontSize:t.size,...t.sx}})))},qr=Hi;var Wi=[],Ui=!0,Yr=o=>{let{root:t}=o,{t:e}=z(["common","client"]),{palette:n}=cn(),{currentSelectionRef:r}=ke(),i=W(ve),l=ue(Ke),[a,s]=K(Fe),[u,c]=K(fe),p=W(Qt),{isLogin:f}=$t(),m=W(Mn),[h,E]=K(gt),G=(0,I.useCallback)(()=>{let y=r.current?.activeElement||r.current?.selectionElement?.target;return y&&mn()?.contains(y)},[]),d=(0,I.useMemo)(()=>h.lastOutput,[h.lastOutput]),[x,P]=K(rt),[g,T]=(0,I.useState)([]),X=(0,I.useMemo)(()=>{if(u.rootRect){let y=Math.max(u.rootRect?.width||0,Po-32);return y>1280?1280:y}return Po-32},[u.rootRect]),D=(0,I.useMemo)(()=>{let y="bottom-start",k="bottom-start";if(u.rootRect&&X){let $=Zn(u.rootRect,X,400);$.y>u.rootRect.top?(y="bottom-start",k="bottom-start"):$.y<u.rootRect.top&&(y="top-start",k="top-start"),$.x>u.rootRect.left+300?y="right-start":$.x<u.rootRect.left-300&&(y="left-start")}return{inputPlacement:y,contextMenuPlacement:k}},[u.rootRect,X]),{x:Z,y:me,strategy:M,refs:C,context:F}=xt({open:u.open,onOpenChange:y=>{c(k=>({...k,open:y}))},placement:D.inputPlacement,middleware:tr,whileElementsMounted:oo}),v=ro(F),ee=io(F,{}),{getFloatingProps:N}=ao([ee,v]),[L,J]=(0,I.useState)(""),_e=(0,I.useRef)(null),{setShortCuts:Eo,runShortCuts:wo,loading:Ne,reGenerate:Mt,shortCutsEngineRef:_o}=Ce(""),{contextMenuList:st,originContextMenuList:lt}=po("textSelectPopupButton",L),Re=cr(),et=(0,I.useMemo)(()=>Ne?Wi:d?Re:st,[Ne,st,d,Re]);(0,I.useEffect)(()=>{},[et]);let Et=(0,I.useMemo)(()=>L.length>0,[L]);(0,I.useEffect)(()=>{if(u.rootRect){let y=so(u.rootRect);if(!Ui){document.querySelector("#rangeBorderBox")?.remove();let k=document.createElement("div");k.id="rangeBorderBox",k.style.position="absolute",k.style.left=y.left+"px",k.style.top=y.top+window.scrollY+"px",k.style.width=y.width+"px",k.style.height=y.height+"px",k.style.border="1px solid green",k.style.zIndex="9999",k.style.pointerEvents="none",document.body.appendChild(k)}C.setPositionReference({getBoundingClientRect(){return y}})}},[u.rootRect]),(0,I.useEffect)(()=>{if(u.open&&et.length>0){let y=null;et.find(k=>{if(k.data.type==="group"){if(k.children.length>0)return y=k.children.find($=>$.data.type==="shortcuts")||null,y!==null}else if(k.data.type==="shortcuts")return y=k,!0;return!1}),y&&P(k=>({...k,lastHoverContextMenuId:y?.id||""}))}},[et,u.open]),(0,I.useEffect)(()=>{if(u.open){ht("floatingMenuInputMediator").updateInputValue("");let y=ne()?.querySelector(`#${Ge}`);y&&setTimeout(()=>{y?.focus()},1),co().then(k=>{l(k)})}else{let k=ne()?.querySelector(`#${Ge}`)?.value;k&&ht("chatBoxInputMediator").updateInputValue(k)}},[u.open]),(0,I.useEffect)(()=>{if(!i.loading&&lo()){let y=ne()?.querySelector(`#${Ge}`);y&&setTimeout(()=>{y?.focus()},1)}},[i.loading]);let kt=y=>{if(y.trim()){let k=p,$="",be=r.current?.selectionElement;be&&(be.isEditableElement?be.editableElementSelectionText?k?$=k:$="{{SELECTED_TEXT}}":k?$=k:$="":$="{{SELECTED_TEXT}}");let ae=`${y}`;$&&(ae+=`:
"""
${$}
"""`),G()||s(Pe=>({...Pe,type:"Chat"})),T([{type:"RENDER_TEMPLATE",parameters:{template:ae}},{type:"ASK_CHATGPT",parameters:{}}])}},At=(0,I.useRef)(Mt);(0,I.useEffect)(()=>{At.current=Mt},[Mt]),(0,I.useEffect)(()=>{if(x.selectedContextMenuId&&lt.length>0&&u.open&&!Ne){let y=x.selectedContextMenuId,k=!1,$=!1,be=!1,ae=null;if(ir(y)&&(y=y.replace(yt,""),k=!0),(!f||m.status!=="success")&&($=!0),be=or(y),be){let Pe=nr(y);Pe&&(ae=Pe)}else ae=lt.find(Pe=>Pe.id===y)||null;if(ae&&ae.id){if(ae.data.type==="group")return;be||Ye.getMediator("textSelectPopupButton").favoriteContextMenu(ae).then().catch(),k&&(ae=ar(ae)),_e.current=ae;let Pe=ae.id,Pt=ae.data.actions||[];if(P(()=>({selectedContextMenuId:null,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})),G()||s(S=>({...S,type:"Chat"})),Pt.length>0)T(Pt);else if(be){if($){De(),c({open:!1,rootRect:null});return}E(S=>({...S,selectContextMenuId:ae?.id||null})),uo(Pe)==="TRY_AGAIN"&&At.current(),setTimeout(()=>{E(S=>({...S,selectContextMenuId:null}))},100)}}}},[x.selectedContextMenuId,lt,u.open,Ne,m.status,f]),(0,I.useEffect)(()=>{},[x.selectedContextMenuId]);let He=(0,I.useRef)(!1);return(0,I.useEffect)(()=>{let y=$e(g);if(g.length>0&&(a.type==="Chat"||G())){if(He.current)return;He.current=!0,_e.current&&(_e.current=null),Eo(y),T([]),_e.current||ht("floatingMenuInputMediator").updateInputValue("");let $=r.current?.selectionElement?.isEditableElement,be=!1;(!f||m.status!=="success")&&(be=!0),(!$||be)&&(c({open:!1,rootRect:null}),De()),J(""),wo().then(()=>{(_o.current?.getNextAction()?.error||"")&&(c({open:!1,rootRect:null}),De())}).catch().finally(()=>{He.current=!1})}},[g,f,a.type]),(0,I.useEffect)(()=>{let y=(k,$)=>{$&&$?.contextMenu&&(_e.current=$.contextMenu),J(k)};return ht("floatingMenuInputMediator").subscribe(y),()=>{ht("floatingMenuInputMediator").unsubscribe(y)}},[J]),I.default.createElement(no,{root:t},I.default.createElement("div",{ref:C.setFloating,...N(),style:{position:M,zIndex:u.open?2147483601:-1,opacity:u.open?1:0,top:me??0,left:Z??0,width:X,maxWidth:"90vw"},onKeyUp:y=>{y.stopPropagation()},id:nn,"aria-hidden":u.open?"false":"true"},I.default.createElement(bo,{customOpen:!0,defaultPlacement:D.contextMenuPlacement,needAutoUpdate:!0,hoverOpen:!1,menuList:et,referenceElementOpen:u.open,referenceElement:I.default.createElement("div",{style:{boxSizing:"border-box",border:"1px solid",borderColor:n.customColor.borderColor,background:n.customColor.paperBackground,borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",overflow:"hidden",isolation:"isolate",display:"flex",flexDirection:"column",width:"100%",padding:"7px 12px"},onKeyPress:y=>{y.stopPropagation()}},I.default.createElement($r,null),I.default.createElement(V,{width:"100%",direction:"row",alignItems:"center",gap:1},I.default.createElement(qr,{TooltipProps:{placement:D.contextMenuPlacement,floatingMenuTooltip:!0},size:16,sx:{flexShrink:0,p:"4px",alignSelf:"start"}}),I.default.createElement(V,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left"},Ne?I.default.createElement(I.default.Fragment,null,I.default.createElement(U,{fontSize:"16px",color:"primary.main"},e("client:floating_menu__input__running_placeholder")),I.default.createElement(Gt,{size:"16px"})):I.default.createElement(br,{expandNode:u.open&&I.default.createElement(wr,{TooltipProps:{placement:D.contextMenuPlacement,floatingMenuTooltip:!0},sx:{alignSelf:"end"},direction:"column",size:"tiny"}),placeholder:u.open?e("client:floating_menu__input__placeholder"):"",InputId:Ge,sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:"24px"},onEnter:y=>{!d&&st.length>0||kt(y)}}),!Ne&&I.default.createElement(I.default.Fragment,null,I.default.createElement(Be,{floatingMenuTooltip:!0,title:e("client:floating_menu__button__send_to_ai"),description:"\u23CE",placement:D.contextMenuPlacement},I.default.createElement(_n,{sx:{height:"24px",width:"24px",borderRadius:"4px",flexShrink:0,alignSelf:"end",alignItems:"center",p:0,m:0,cursor:Et?"pointer":"default",bgcolor:Et?"primary.main":"rgb(219,219,217)","&:hover":{bgcolor:Et?"primary.main":"rgb(219,219,217)"}},onClick:()=>{!d&&st.length>0||kt(L)}},I.default.createElement(jr.default,{sx:{color:"#fff",fontSize:16}}))),I.default.createElement(zo,{sx:{width:24,height:24,alignSelf:"end"}}),I.default.createElement(vt,{TooltipProps:{placement:D.contextMenuPlacement,floatingMenuTooltip:!0}})),I.default.createElement(Ko,null)))),root:t})))};var Jr=A(ln()),zi="USE_CHAT_GPT_AI".toLowerCase().replace(/_/g,"-"),Vi=({containerId:o="modal-root",children:t})=>{let[e,n]=(0,Ve.useState)(null),r=(0,Ve.useRef)(null);return(0,Ve.useEffect)(()=>{let i=document.getElementById(o);if(i){let l=document.createElement("div");l.id=sn;let a=document.createElement("style"),s=document.createElement("link");if(s.rel="stylesheet",s.href=Jr.default.runtime.getURL("content_style.css"),i.shadowRoot)i.shadowRoot.appendChild(l),i.shadowRoot.appendChild(a),i.shadowRoot.appendChild(s);else{let u=i.attachShadow({mode:"open"});u.appendChild(l),u.appendChild(a),u.appendChild(s)}r.current=ct({key:`${zi}-context-menu`,prepend:!0,container:a}),n(l)}},[o]),!e||!r.current?null:(0,Xr.createPortal)(Ve.default.createElement(tt,{value:r.current},Ve.default.createElement(Yr,{root:e}),t),e)},Qr=Vi;var ge=A(H());var It=A(H());var Gi=o=>{let{buttonSettingKey:t,placement:e,onClick:n}=o,{t:r}=z(["common","client","prompt"]),{favoriteContextMenuList:i}=sr(t);return It.default.createElement(V,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}}}},i?.map(l=>{let a=!l.data.icon,s=l.text,u=l.id.replace(yt,""),c=`prompt:${u}`;r(c)!==u&&(s=r(c));let p=String(s[0]||"").toUpperCase();return It.default.createElement(Vt,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom"},title:s,key:l.id,sx:{minWidth:"unset",p:a?"6px!important":"8px!important"},onMouseUp:f=>{f.stopPropagation(),f.preventDefault()},onMouseDown:f=>{f.stopPropagation(),f.preventDefault()},onClick:f=>{f.stopPropagation(),f.preventDefault(),n&&n(l)}},a?It.default.createElement(V,{className:"max-ai__click-menu-button--box__text-icon",alignItems:"center",justifyContent:"center",sx:{width:"22px",height:"22px",boxSizing:"border-box",borderRadius:"4px",bgcolor:f=>f.palette.mode==="dark"?"#4f4f4f":"#F5F6F7",color:f=>f.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}},It.default.createElement(U,{component:"span",fontSize:"13px",color:"inherit"},p)):It.default.createElement(de,{icon:l.data.icon,sx:{fontSize:"18px",color:f=>f.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}}))}))},Zr=Gi;var Ki=o=>{let{t}=z(["common","client"]),{tempSelection:e,show:n,hideRangy:r}=ke(),{chatBoxShortCutKey:i}=Xe(),l=Yt("textSelectPopupButton"),a=ue(rt),s=W(ve),u=ue(Xt),{closeBeforeRefresh:c}=W(je),{showFloatingContextMenu:p}=Ct(),[f]=K(fe),m=(0,ge.useMemo)(()=>n&&l?.buttonVisible&&!c&&!f.open,[c,n,l,f]),{x:h,y:E,strategy:G,refs:d,placement:x}=xt({placement:"bottom-start",middleware:[Zt({fallbackPlacements:["top-start","right","left"]}),to({crossAxis:!0,padding:16}),eo(g=>{if(g.placement.indexOf("bottom")>-1){let T={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight+window.scrollY};return Qn({top:g.y,left:g.x,bottom:g.y+g.rects.floating.height+50,right:g.rects.floating.width+g.x},T)?g.rects.reference.y-g.y-g.rects.floating.height-8:8}else return 8})]});(0,ge.useEffect)(()=>{if(!e||!m)return;let g=so(e.selectionRect);if(m&&g){if(g=er(g),!ot){document.querySelector("#rangeBorderBox")?.remove();let T=document.createElement("div");T.id="rangeBorderBox",T.style.position="absolute",T.style.left=g.left+"px",T.style.top=g.top+window.scrollY+"px",T.style.width=g.width+"px",T.style.height=g.height+"px",T.style.border="2px solid red",T.style.zIndex="9999",T.style.pointerEvents="none",document.body.appendChild(T)}d.setPositionReference({getBoundingClientRect(){return{...g,x:g.left,y:g.top}}})}},[e,m]);let P=(0,ge.useCallback)(()=>{if(d.floating.current){if(getComputedStyle(d.floating.current).opacity==="0")return;r(),mo(),fo()}},[]);return(0,ge.useEffect)(()=>{let g=T=>{T.key==="Escape"&&P()};return document.addEventListener("keydown",g,!0),()=>{document.removeEventListener("keydown",g,!0)}},[]),(0,ge.useEffect)(()=>{s.loading&&(setTimeout(()=>{P()},1e3),P())},[s.loading]),ge.default.createElement(Wt,{elevation:3,component:"div",ref:d.setFloating,className:`max-ai__click-context-menu ${m?"open":"close"}`,sx:{bgcolor:"transparent",borderRadius:"14px",zIndex:m?2147483600:-1,position:G,opacity:m?1:0,top:E??0,left:h??0,width:"max-content"}},ge.default.createElement(V,{direction:"row",alignItems:"center",sx:{"& .max-ai__click-menu-button--box":{div:{display:"flex"},height:"28px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{"&:has(button)&::after":{display:"none"}},"& button":{bgcolor:"background.paper",minWidth:"unset",padding:"5px 8px!important",boxSizing:"border-box",borderRadius:"0","&:hover":{bgcolor:g=>g.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"},"&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 6px!important"}},"&:first-child":{"& button":{borderTopLeftRadius:"14px",borderBottomLeftRadius:"14px",borderTopRightRadius:0,borderBottomRightRadius:0}},"&:not(:last-child)":{"&::after":{content:'""',position:"absolute",right:0,top:"25%",transform:"scale(0.5) translateY(-50%)",width:"1px",height:"32px",bgcolor:g=>g.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}}}}},ge.default.createElement(R,{component:"div",className:"max-ai__click-menu-button--box"},ge.default.createElement(Vt,{TooltipProps:{floatingMenuTooltip:!0,placement:x,description:i,sx:{maxWidth:360}},title:t("client:floating_menu__button__cta__tooltip"),className:"usechatgpt-ai__context-menu--handle-button",id:"max_ai__floating_context_menu__cta_button",size:"small",variant:"text",onMouseUp:g=>{g.stopPropagation(),g.preventDefault()},onMouseDown:g=>{g.stopPropagation(),g.preventDefault()},onClick:g=>{g.stopPropagation(),g.preventDefault();let T=window.getSelection()?.rangeCount;if(T&&T>0){let X=window.getSelection()?.getRangeAt(0)?.cloneRange();u({range:X||null,selectionText:window?.getSelection()?.toString()||""})}e&&p()}},ge.default.createElement(Me,{sx:{fontSize:"18px"}}))),ge.default.createElement(Zr,{placement:x,buttonSettingKey:"textSelectPopupButton",onClick:g=>{e&&p(),setTimeout(()=>{a(T=>({...T,selectedContextMenuId:g.id}))},100)}}),ge.default.createElement(jo,{placement:x})))},ei=Ki;var he=A(H());var $i=()=>{let{closeBeforeRefresh:o}=W(je),{haveSelection:t,showFloatingContextMenu:e,floatingDropdownMenuOpen:n}=Ct(),r=Yt("textSelectPopupButton"),[i,l]=(0,he.useState)(16),[a,s]=(0,he.useState)(3),{chatBoxShortCutKey:u}=Xe();return(0,he.useEffect)(()=>{if(!(r?.buttonVisible&&!o)&&t){let c=document.querySelector(`#${Lt}`);c&&c.classList.contains("open")?l((c.getBoundingClientRect().width||0)+16):l(16),s(1)}},[t,r,o]),(0,he.useEffect)(()=>{if(a===1)s(2);else if(a===2){let c=setTimeout(()=>{s(3)},2e3);return()=>{clearTimeout(c)}}return()=>{}},[a]),(0,he.useEffect)(()=>{s(3)},[n]),null;return he.default.createElement(he.default.Fragment,null,u?he.default.createElement(R,{className:"usechatgpt-ai__context-menu--handle-button",sx:{position:"fixed",bottom:16,right:i,zIndex:a!==3?2147483661:-1,backgroundColor:"rgba(98,98,105,1)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",overflow:"hidden",maxWidth:a!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(U,{fontSize:"24px",fontWeight:"bold",color:"#fff",noWrap:!0,sx:{px:"10px",py:"4px"}},u)):he.default.createElement(R,{sx:{position:"fixed",bottom:16,right:i,zIndex:a!==3?2147483661:-1,backgroundColor:"#fff",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",maxWidth:a!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(Wt,{elevation:3,sx:{padding:"8px 10px"}},he.default.createElement(Me,{sx:{fontSize:24}}))))},ti=$i;var Ae=A(H()),ii=A(To());var O=A(H());var ie=A(H());vo();ko();var qi=o=>{let{buttonKey:t,children:e,rootId:n,root:r,permissionWrapperCardSceneType:i}=o,[l,a]=(0,ie.useState)(null),[s,u]=K(Fe),{currentUserPlan:c}=Oe(),p=jt(),{createConversation:f}=ft(),{contextMenuList:m}=po(t,"",!1),{loading:h}=W(ve),{setShortCuts:E,runShortCuts:G}=Ce(),d=(0,ie.useRef)(null),x=(0,ie.useMemo)(()=>!(i&&c.name==="free"),[i,c]),P=(0,ie.useCallback)(async D=>{if(!h&&D.data.actions){let Z=await Nt(),me=`ON_BOARDING_RECORD_INPUT_ASSISTANT_BUTTON_${qe()}_TIMES`,M=Number(Z[me]||0);if(!x&&i)if(M>0)await wt(me,M-1);else{De(),Kt("show",i);let F=await f();await dt("add",F,0,[qt(p[i])]);return}let C=$e(D.data.actions);C.splice(0,0,{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{OperationElementElementSelector:`[maxai-input-assistant-button-id="${n}"]`}}}),await E(C),await G(!0)}},[E,G,h,x,i]),g=(0,ie.useRef)(P);(0,ie.useEffect)(()=>{g.current=P},[P]);let T=(0,ie.useRef)(!1),X=(0,ie.useRef)(s.type);return(0,ie.useEffect)(()=>{X.current=s.type},[s.type]),(0,ie.useEffect)(()=>{!T.current&&l&&g.current&&X.current==="Chat"&&(T.current=!0,a(null),g.current(l).then().catch().finally(()=>{T.current=!1}))},[l]),(0,ie.useEffect)(()=>{if(r&&n&&!d.current){let D=document.createElement("style");D.setAttribute("data-emotion-id",n),r.appendChild(D),d.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:D})}},[r,n]),!r||!d.current?null:ie.default.createElement(tt,{value:d.current},ie.default.createElement(bo,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["bottom-end","bottom","top-start","top-end","top","right","left"],root:r,menuList:m,needAutoUpdate:!0,hoverOpen:!1,menuWidth:240,referenceElement:e,onClickContextMenu:D=>{u(Z=>({...Z,type:"Chat"})),a(D)},onClickReferenceElement:()=>{}}))},Yo=qi;vo();ko();var ji=o=>{let{rootId:t,InputAssistantBoxSx:e,DropdownButtonStyle:n,CTAButtonStyle:r,buttonGroup:i,shadowRoot:l,placement:a}=o,s=(0,O.useRef)(null),{t:u}=z(["client"]),[c,p]=(0,O.useState)(null),{loading:f}=W(ve),[m,h]=(0,O.useState)(!1),[E,G]=(0,O.useState)(!1),d=(0,O.useMemo)(()=>{let P=$e(r),g=$e(n),T={},X={};if(i.forEach(D=>{D.CTAButtonStyle&&(P=Object.assign(P,{...D.CTAButtonStyle})),D.DropdownButtonStyle&&(g=Object.assign(g,{...D.DropdownButtonStyle}))}),T){let{backgroundColor:D="#7601D3",hoverBackgroundColor:Z="rgb(94,34,169)",color:me="#fff",hoverColor:M="#fff",borderColor:C="rgb(77, 26, 137)",hoverBorderColor:F="rgb(77, 26, 137)",borderRadius:v="4px 0 0 4px",borderWidth:ee="0 1px 0 0",iconSize:N=20,padding:L="8px 12px"}=P||{};T={minWidth:"unset",backgroundColor:D,color:me,borderColor:C,borderRadius:v,fontSize:`${N}px`,borderWidth:ee,borderStyle:"solid",position:"relative",padding:L,"&:hover":{color:M,backgroundColor:Z,borderColor:F}}}if(X){let{backgroundColor:D="#7601D3",hoverBackgroundColor:Z="rgb(94,34,169)",color:me="#fff",hoverColor:M="#fff",borderColor:C="transparent",hoverBorderColor:F="transparent",borderRadius:v="0 4px 4px 0",borderWidth:ee="0",iconSize:N=20,padding:L="8px 4px"}=g||{};X={minWidth:"unset",backgroundColor:m?Z:D,color:m?M:me,borderColor:m?F:C,borderRadius:v,fontSize:`${N}px`,borderWidth:ee,borderStyle:"solid",padding:L,"&:hover":{color:M,backgroundColor:Z,borderColor:F}}}return{ctaButtonSx:T,dropdownButtonSx:X}},[r,n,m,i]),x=(0,O.useMemo)(()=>{let P=$e(e)||{};i.forEach(T=>{T.InputAssistantBoxSx&&Object.assign(P,T.InputAssistantBoxSx)});let g={boxShadow:"0px 2px 3px 1px rgba(118, 1, 211, 0.16), 1px 0px 2px 0px rgba(118, 1, 211, 0.08), -1px 0px 2px 0px rgba(118, 1, 211, 0.08)",...P?.["&:hover"]};return g&&delete P["&:hover"],{...P,...E?g:{}}},[e,E,i]);return(0,O.useEffect)(()=>{if(l){let P=document.createElement("style");l.appendChild(P),s.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:P})}},[l]),(0,O.useEffect)(()=>{p(document.querySelector(`#${an}`)?.shadowRoot?.querySelector("div"))},[]),O.default.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"4px",...x},onMouseEnter:()=>G(!0),onMouseLeave:()=>G(!1)},i[0]&&O.default.createElement(Yo,{rootId:t,buttonKey:i[0].buttonKey,permissionWrapperCardSceneType:i[0].permissionWrapperCardSceneType,root:c},O.default.createElement(R,null,O.default.createElement(Be,{placement:a,zIndex:2e6,PopperProps:{container:c},title:u(i[0].tooltip)},O.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"},onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)}},s.current&&O.default.createElement(tt,{value:s.current},O.default.createElement(R,{position:"absolute",top:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:ot?"transparent":"red",zIndex:2000001}),O.default.createElement(j,{id:`maxAIInputAssistantCtaButton${t}`,"data-testid":"maxai-input-assistant-cta-button",disabled:f,sx:d.ctaButtonSx},f?O.default.createElement(Gt,{size:r?.iconSize||20,sx:{fontSize:"inherit",color:"#fff"}}):O.default.createElement(Me,{sx:{fontSize:"inherit",color:"inherit"}})),O.default.createElement(R,{position:"absolute",bottom:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:ot?"transparent":"red",zIndex:2000001})))))),i[1]&&O.default.createElement(Yo,{rootId:t,buttonKey:i[1].buttonKey,permissionWrapperCardSceneType:i[1].permissionWrapperCardSceneType,root:c},O.default.createElement(R,null,O.default.createElement(Be,{placement:a,zIndex:2e6,PopperProps:{container:c},title:u(i[1].tooltip)},O.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"}},s.current&&O.default.createElement(tt,{value:s.current},O.default.createElement(R,{position:"absolute",top:`-${n?.transparentHeight||0}px`,width:"100%",height:`${n?.transparentHeight||0}px`,bgcolor:ot?"transparent":"red",zIndex:2000001}),O.default.createElement(j,{id:`maxAIInputAssistantDropdownButton${t}`,"data-testid":"maxai-input-assistant-dropdown-button",disabled:f,sx:d.dropdownButtonSx},O.default.createElement(de,{icon:"ArrowDropDown",sx:{fontSize:"inherit",color:"inherit"}})),O.default.createElement(R,{position:"absolute",bottom:`-${n?.transparentHeight||0}px`,width:"100%",height:`${n?.transparentHeight||0}px`,bgcolor:ot?"transparent":"red",zIndex:2000001})))))))},oi=ji;var Yi=o=>{let t=qe();return t==="mail.google.com"?Xi(o):t==="outlook.office.com"||t==="outlook.live.com"||t==="outlook.office365.com"?Ji(o):t==="twitter.com"?Qi(o):t==="linkedin.com"?Zi(o):t==="facebook.com"?ea(o):t==="youtube.com"?[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]:t==="studio.youtube.com"?[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]:[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]},Xi=o=>{let{keyElement:t,buttonGroupConfig:e}=o,n=document.querySelectorAll("div[data-message-id]");for(let r=0;r<n.length;r++)if(n[r].nextElementSibling?.contains(t))return[e.composeReplyButton,e.refineDraftButton];return[e.composeNewButton,e.refineDraftButton]},Ji=o=>{let{keyElement:t,buttonGroupConfig:e}=o,n=document.querySelector('div[data-app-section="ConversationContainer"]'),r=document.querySelector("#ReadingPaneContainerId"),i=r.querySelectorAll('div[role="textbox"]:has(#removeButton)').length,l=r.querySelector("#RplyFwdMsg")||r.querySelector("#divRplyFwdMsg"),a=Array.from(document.querySelectorAll('div[role="dialog"]')).find(u=>u.contains(t)),s=r.querySelector('input[maxlength="255"]')?.value||"";return!n?.contains(t)&&i===0&&!l&&!a&&!s?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},Qi=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return Cr(t)?.querySelector('article[data-testid="tweet"]')?[e.composeReplyButton,e.refineDraftButton]:Array.from(document.querySelectorAll('article[data-testid="tweet"]')).find(i=>i.nextElementSibling?.contains(t))?[e.composeReplyButton,e.refineDraftButton]:[e.composeNewButton,e.refineDraftButton]},Zi=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return t.classList.contains("share-box_actions")?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},ea=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return Do('form[method="POST"]',t,20)?[e.composeNewButton,e.refineDraftButton]:Do('form[role="presentation"]',t)?.getBoundingClientRect().width<240?[]:[e.composeReplyButton,e.refineDraftButton]},Xo=Yi;var ni=new pt("ContextMenu/InputAssistantButtonManager"),Jo=class{constructor(){this.interval=1e3;this.stop=!1,this.host=qe(),this.config=Cn[this.host],this.observerMap=new Map}createInputAssistantButtonListener(t){this.timer=setInterval(()=>{if(!this.stop&&this.config){let{rootSelectors:e,rootSelectorStyle:n,rootParentDeep:r=0}=this.config,i=[];e.map(s=>i.push(...document.querySelectorAll(s)));let l=!1;i.forEach(s=>{let u=s,c=s,p=r;for(;p>0;)p--,c=c.parentElement;n&&(u.style.cssText=n);let f=this.attachInputAssistantButton(c);f&&(l=!0,ni.info("newObserverData: ",f))}),(this.cleanObserverMap()||l)&&t(this.getAllObserverData(),this.config)}},this.interval)}attachInputAssistantButton(t){if(!this.config||t.querySelector("[maxai-input-assistant-button-id]"))return null;let{rootStyle:e,rootParentStyle:n,rootParentStyleDeep:r=1}=this.config;if(t&&e&&(t.style.cssText=e),n){let d=0,x=t;for(;d<r;)d++,x=x?.parentElement;x&&(x.style.cssText=n)}let i=Ot(),{rootWrapperTagName:l,appendPosition:a,rootWrapperStyle:s}=this.config,u="customElements"in window,c=document.createElement(l);s&&(c.style.cssText=s);let p=document.createElement(u?"maxai-input-assistant-button":"div");if(p.setAttribute("maxai-input-assistant-button-id",i),c.appendChild(p),xn(a)){let d=t.childNodes[a];d?t.insertBefore(c,d):t.appendChild(c)}else t.appendChild(c);p.attachShadow({mode:"open"});let f=p.shadowRoot,m=document.createElement("div");f?.appendChild(m),ni.info("appendElement: ",c);let h=new MutationObserver(()=>{});if(h.observe(t,{childList:!0,subtree:!0}),Xo({keyElement:t,buttonGroupConfig:this.config}).length===0)return h.disconnect(),c.remove(),null;let G={id:i,destroy:()=>{h.disconnect(),c.remove()},renderRootElement:m,observer:h,shadowRootElement:f,buttonGroup:Xo({keyElement:t,buttonGroupConfig:this.config})};return this.observerMap.set(t,G),G}cleanObserverMap(){let t=!1;return this.observerMap.forEach((e,n)=>{let i=Array.from(e.shadowRootElement.querySelectorAll("style[data-emotion]")).find(l=>l.sheet?.cssRules.length===0&&l.innerHTML==="");document.body.contains(n)&&!i||(t=!0,e.destroy(),this.observerMap.delete(n))}),t}clearObserverMap(){this.observerMap.forEach((t,e)=>{t.destroy(),this.observerMap.delete(e)})}getAllObserverData(){let t=[];return this.observerMap.forEach(e=>t.push(e)),t}pause(){this.stop=!0,this.clearObserverMap()}continue(){this.stop=!1}},ri=Jo;var ta=()=>{let o=W(Ke),[t,e]=(0,Ae.useState)(null),[n,r]=(0,Ae.useState)([]),i=Ae.default.useRef(null);Ue(()=>{i.current=new ri,i.current.createInputAssistantButtonListener((a,s)=>{r(a),e(s)})});let l=(0,Ae.useMemo)(()=>{let a=qe();return a==="mail.google.com"?o.userSettings?.inputAssistantButton?.gmail===!0:a==="outlook.live.com"||a==="outlook.office.com"||a==="outlook.office365.com"?o.userSettings?.inputAssistantButton?.outlook===!0:a==="twitter.com"?o.userSettings?.inputAssistantButton?.twitter===!0:a==="linkedin.com"?o.userSettings?.inputAssistantButton?.linkedIn===!0:a==="facebook.com"?o.userSettings?.inputAssistantButton?.facebook===!0:a==="youtube.com"||a==="studio.youtube.com"?o.userSettings?.inputAssistantButton?.youtube===!0:!1},[o.userSettings?.inputAssistantButton]);return(0,Ae.useEffect)(()=>{i.current&&(l?i.current?.continue():i.current?.pause())},[l]),Ae.default.createElement(Ae.default.Fragment,null,n.map(a=>(0,ii.createPortal)(Ae.default.createElement(oi,{shadowRoot:a.shadowRootElement,rootId:a.id,buttonGroup:a.buttonGroup,root:a.renderRootElement,InputAssistantBoxSx:t?.InputAssistantBoxSx,CTAButtonStyle:t?.CTAButtonStyle,DropdownButtonStyle:t?.DropdownButtonStyle}),a.renderRootElement,a.id)))},ai=ta;var oa=()=>Ze.default.createElement(Ze.default.Fragment,null,Ze.default.createElement(Qr,{containerId:Rt},Ze.default.createElement(ei,null),Ze.default.createElement(ti,null),Ze.default.createElement(li,null)),Ze.default.createElement(ai,null)),si=oa;var ui=new pt("AppInit"),na=()=>window.location.host!=="www.usechatgpt.ai"&&window.location.host!=="www.maxai.me"?_.default.createElement(_.default.Fragment,null):_.default.createElement(j,{onClick:()=>{Ie({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}),ra=()=>{let o=ue(Ke),t=ue(Dt);return fr(),(0,_.useEffect)(()=>{let e=async()=>{let n=await co();n&&(o({...n}),ui.info("get db settings",n));let r=await bn();r&&(t({...r}),ui.info("get local settings",r))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),_.default.createElement(_.default.Fragment,null)},ia=()=>{let{t:o}=z(["common","client"]),[t,e]=_.default.useState(null),n=_.default.useRef(!1);Ue(()=>{window.location.href.includes(Qo.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")&&e(100)}),dr(()=>{let r=document.body.querySelector("#usechatgptPDFViewerErrorAlert");if(r){if(n.current)return;n.current=!0,e(null);let i=r.getAttribute("data-url");(0,ci.render)(_.default.createElement(V,{spacing:2,p:2,width:"100%",sx:{boxSizing:"border-box"}},_.default.createElement(V,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1.4,color:"#fff"},_.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:48,width:48,src:"/assets/USE_CHAT_GPT_AI/icons/maxai_48_normal.png"}),_.default.createElement(U,{variant:"body1",fontSize:18,fontWeight:700},o("client:pdf__info_card__title"))),_.default.createElement(V,{alignItems:"center",spacing:0},_.default.createElement(U,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},o("client:pdf__info_card__access_permission__description1"),_.default.createElement(Ut,{color:"rgba(255,255,255,1)",href:"#",onClick:async l=>{l.preventDefault(),await Ie({key:"manage_extension"}),window.close()}},"chrome://extensions"),` ${o("client:pdf__info_card__access_permission__description2")} `),_.default.createElement(U,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:2}},i),_.default.createElement(R,{mb:2},_.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Bo("/images/pdf/guide-1.gif")})),_.default.createElement(j,{disableElevation:!0,size:"small",variant:"contained",onClick:async l=>{l.preventDefault(),await Ie({key:"manage_extension"}),window.close()},sx:{height:"56px",backgroundColor:"#7601D3",color:"#fff",fontSize:"18px",textTransform:"none",px:3,"&:hover":{backgroundColor:"#7601D3",color:"#fff"}}},o("client:pdf__info_card__access_permission__button"))),_.default.createElement(Fn,{sx:{color:"#fff"}},o("common:or")),_.default.createElement(V,{spacing:2},_.default.createElement(U,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},o("client:pdf__info_card__disabled__description1"),_.default.createElement(Ut,{color:"rgba(255,255,255,1)",href:"#",onClick:async l=>{l.preventDefault(),l.stopPropagation(),await Ie({key:"options",query:"?id=pdf-viewer#/appearance"}),window.close()}},o("client:pdf__info_card__disabled__description2")),o("client:pdf__info_card__disabled__description3")),_.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Bo("/images/pdf/guide-2.gif")}))),r);return}},t)},li=()=>{let{t:o}=z(["client","common"]);return(0,_.useMemo)(()=>window.location.href.includes(Qo.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")?document.body.querySelector("#usechatgpt-disabled-pdf")||window.localStorage.getItem("hide_usechatgptai_pdf_alert")==="true"?null:_.default.createElement(R,{position:"fixed",right:8,top:40,zIndex:1e4,id:"usechatgpt-disabled-pdf"},_.default.createElement(xo,{icon:_.default.createElement(_.default.Fragment,null),action:_.default.createElement(_.default.Fragment,null),sx:{p:"8px!important",bgcolor:"#fff",border:"1px solid #7601D3","& > div":{"&:first-of-type":{display:"none"},"&:nth-of-type(2)":{padding:"0!important"},"&:last-of-type":{margin:"0!important",padding:"0!important",position:"absolute",top:0,right:0}},"& *":{color:"#7601D3"}}},_.default.createElement(V,{spacing:1,maxWidth:320},_.default.createElement(V,{direction:"row",alignItems:"center",spacing:1},_.default.createElement(Me,{sx:{fontSize:14}}),_.default.createElement(U,{variant:"body1",fontSize:14,fontWeight:700},o("client:pdf__floating_card__title"))),_.default.createElement(U,{fontSize:14},o("client:pdf__floating_card__description1"),_.default.createElement(Ut,{href:"#",onClick:async e=>{e.preventDefault(),e.stopPropagation(),await Ie({key:"options",query:"?id=pdf-viewer#/appearance"})}},o("client:pdf__floating_card__description2")),o("client:pdf__floating_card__description3")),_.default.createElement(j,{size:"small",disableElevation:!0,sx:{bgcolor:"#7601D3",color:"#fff","&:hover":{bgcolor:"#7601D3"},textTransform:"none"},onClick:async()=>{window.localStorage.setItem("hide_usechatgptai_pdf_alert",JSON.stringify(!0)),ne()?.querySelector("#usechatgpt-disabled-pdf")?.remove()}},o("client:pdf__floating_card__button"))))):null,[o])},aa=()=>(pr(),$t(),Nn(),Ir(),vr(),Pn(),ia(),Pr(),Ue(()=>{fn()&&De(),Br(),Sr().then().catch(),Ur()}),Hr(),_r(),_.default.createElement(_.default.Fragment,null,_.default.createElement(si,null),_.default.createElement(ra,null),_.default.createElement(na,null))),Pd=aa;export{ra as a,Pd as b};
