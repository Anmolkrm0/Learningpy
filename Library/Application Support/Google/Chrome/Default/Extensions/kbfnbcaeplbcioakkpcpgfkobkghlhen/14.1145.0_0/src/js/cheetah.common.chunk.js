(self.webpackChunk=self.webpackChunk||[]).push([[4382],{36149:(e,t,i)=>{i.r(t),i.d(t,{CheetahFeatureImpl:()=>ei,isAssistantOpened:()=>Xt});var s=i(17771),n=i(17889),a=i(62965),r=i(6294),o=i(85892),l=i(57050),c=i(27378),h=i(54696),d=i(57757),p=i(55649),u=i(98805),g=i(14601),m=i(32952),v=i(60797),_=i(66310),b=i(24209),S=i(85985),f=i(23063),w=i(40151),y=i(98403),x=i(2844),I=i(77176),A=i(2834),R=i(76974),C=i(28043),E=i(93508),U=i(16118),k=i(13444),B=i(12126),T=i(78674),M=i(17343),O=i(80544),P=i(79692),z=i(67434),G=i(19751),N=i(44586),F=i(97425),j=i(5114),H=i(8125),D=i(83078),q=i(95195),W=i(22232),$=i(54001),V=i(23239),L=i(34217),Y=i(51325);const Z=({width:e,height:t,top:i,left:s,visibility:n})=>c.createElement("div",{"data-grammarly-part":"cheetah-highlight-rect",...(0,$.Sh)(Y.highlightRect,"hidden"===n?Y.hidden:null,"attention"===n?Y.attention:null),style:{width:e,height:t,top:i,left:s}});var Q=i(6726),K=i(16805);const J=c.forwardRef((function({forceTooltipMessage:e,onClick:t,onMouseEnter:i,onMouseLeave:s},n){return c.createElement(Q.u,{message:"Rewrite with Grammarly",forcedMessage:e},c.createElement("button",{onClick:t,"data-grammarly-part":"cheetah-ideate-button",className:K.ideateButton,ref:n,onMouseEnter:i,onMouseLeave:s},c.createElement("div",{className:K.ideateButtonIcon})))}));var X=i(88571),ee=i(4147),te=i(89894),ie=i(15073),se=i(42103),ne=i(51369),ae=i(85665);const re=te.ux.style({fontStyle:"normal",fontWeight:"normal",fontFamily:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif, Arial",$nest:{"button, input, textarea":{fontFamily:"inherit"}}}),oe=({children:e})=>{var t;const i=null===(t=c.useContext(ae.nS.Context))||void 0===t?void 0:t.host;return c.createElement(ee.o,null,c.createElement(X.Q,{remSize:R.of(16),setter:e=>ie.u.setRootCssVar(i||document.documentElement,e)},c.createElement(se.G.DefaultProvider,null,c.createElement("div",{className:re},e,c.createElement(ne.X,null)))))};var le=i(37869),ce=i(50783);const he=({referenceElement:e,placement:t,offset:i,disabled:s,onClick:n})=>{const[a,r]=c.useState(null),{styles:o,attributes:l}=(0,le.D)(e,a,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return c.createElement("button",{ref:r,style:o.popper,...l.popper,onClick:n,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-reply-button",className:ce.replyButton,"data-disabled":s},c.createElement("div",{className:ce.icon}),c.createElement("span",null,"Reply quickly"))};var de=i(87491);const pe=({referenceElement:e,placement:t,offset:i,disabled:s,onMagicRewriteClick:n,onOpenRewriteClick:a})=>{const[r,o]=c.useState(null),{styles:l,attributes:h}=(0,le.D)(e,r,{placement:t,modifiers:i?[{name:"offset",options:{offset:i}}]:[]});return n||a?c.createElement("div",{ref:o,style:l.popper,...h.popper,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},"data-grammarly-part":"cheetah-entry-button",className:de.entryButton,"data-disabled":s},n?c.createElement(Q.u,{message:"Improve it"},c.createElement("button",{onClick:n,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:de.entryButtonItem,"data-disabled":s},c.createElement("i",{className:de.rewriteIcon}))):null,a?c.createElement(Q.u,{message:"Rewrite with Grammarly"},c.createElement("button",{onClick:a,onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:de.entryButtonItem,"data-disabled":s},c.createElement("i",{className:de.openIcon}))):null):null};var ue=i(90845),ge=i(49708),me=i(8543),ve=i(48033);const _e=()=>c.createElement("svg",{className:ve.icon,viewBox:"0 0 16 16",fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round"},c.createElement("path",{d:"M8,16C12.418,16 16,12.418 16,8C16,3.582 12.418,0 8,0C3.582,0 0,3.582 0,8C0,12.418 3.582,16 8,16Z",fill:"#0A9A78"}),c.createElement("path",{d:"M4,8L12,8M8,4L8,12",fill:"none",fillRule:"nonzero",stroke:"white",strokeWidth:"1.5px"})),be=({overflow:e,...t})=>e?c.createElement(fe,{...t}):c.createElement(Se,{...t}),Se=({left:e,top:t,height:i})=>c.createElement(c.Fragment,null,c.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ve.quasiCaret,style:{left:e,top:t+i,height:i+8}},c.createElement(_e,null))),fe=({left:e,top:t,height:i})=>{const{ref:n,onMount:a}=ue.P.useElWatcher(),r=c.useMemo((()=>V.h.create(j.none)),[]),{rect:o,onMount:h}=ue.P.useRectWatcher(),d=c.useCallback((e=>{e.style.pointerEvents="all",r.set((0,l.zG)(s.Y(j.option)({rect:j.some(e.getBoundingClientRect()),goodParent:(0,l.zG)(e.getBoundingClientRect(),(e=>({x:e.x+e.width/2,y:e.y+e.height/2})),(({x:e,y:t})=>{var i,s;return j.fromNullable(null===(s=null===(i=document.elementFromPoint(e,t))||void 0===i?void 0:i.shadowRoot)||void 0===s?void 0:s.elementFromPoint(e,t))}),j.filter((t=>t===e||e.contains(t||null))))}),j.fold((()=>j.none),(({rect:e})=>j.some({x:e.x,y:e.y}))))),e.style.pointerEvents="none"}),[]),p=c.useMemo((()=>ge.R(document,"scroll",{capture:!0}).pipe(E.O(null))),[]);return ue.P.useSubscriptionTo(x.aj([n.pipe(v.oA),p,o]).pipe(A.b((([e])=>d(e))))),c.createElement(c.Fragment,null,c.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret",className:ve.quasiCaret,style:{left:e,top:t+i,height:i+8},ref:e=>{a(e),h(e)}},c.createElement(me.F.div,{style:r.pipe(I.U((e=>(0,l.zG)(e,j.fold((()=>({opacity:1})),(()=>({opacity:0})))))))},c.createElement(_e,null))),c.createElement(me.F.Fragment,null,r.pipe(I.U((e=>(0,l.zG)(e,j.fold(l.gn,(e=>c.createElement("div",{"data-grammarly-part":"cheetah-quasi-caret-fixed-bro",className:ve.quasiCaret,style:{transform:"none",position:"fixed",left:e.x,top:e.y,height:i+8}},c.createElement(_e,null))))))))))};var we=i(10389),ye=i(64015),xe=i(1846),Ie=i(819),Ae=i(20545),Re=i(24451),Ce=i(69693),Ee=i(85746),Ue=i(2906),ke=i(55093),Be=i(21903),Te=i(43254),Me=i(33148),Oe=i(84403),Pe=i(92627),ze=i(99877),Ge=i(35144),Ne=i(72004),Fe=i(36847),je=i(35298),He=i(29972),De=i(51129),qe=i(7534);var We=i(44358),$e=i(81873),Ve=i(81531),Le=i(65504),Ye=i(9205),Ze=i(9629),Qe=i(88355),Ke=i(4068),Je=i(30857);function Xe(e){var t,i;const s="pushRewrite"===e.mode?null:e;return null!==(i=null===(t=null==s?void 0:s.source)||void 0===t?void 0:t.alertId)&&void 0!==i?i:null}function et(e,t,i,s){switch(e.mode){case"ideation":return{mode:e.mode,metadata:t,documentUrl:s};case"rewrite":case"quickRewrite":return{mode:e.mode,metadata:t};case"quickReply":return{mode:e.mode,quickReplyContext:(0,l.zG)(i,j.fold((()=>Ke.H.empty),tt)),metadata:t};case"pushRewrite":return{mode:e.mode,writingExpertContext:e.writingExpertContext};default:(0,W.L0)(e)}}function tt(e){var t,i,s,n,a,r,o,c,h,d,p,u,g,m,v,_,b;const S=e=>{var t;return null!==(t=null==e?void 0:e.reduce(((e,t)=>{var i;return t.email&&!e.has(t.email)&&e.set(t.email,{name:null!==(i=t.name)&&void 0!==i?i:"",email:t.email}),e}),new Map))&&void 0!==t?t:new Map},f=S(null===(s=null===(i=null===(t=e.parents)||void 0===t?void 0:t[0])||void 0===i?void 0:i.audience)||void 0===s?void 0:s.indirectRecipients),w=S(null===(r=null===(a=null===(n=e.parents)||void 0===n?void 0:n[0])||void 0===a?void 0:a.audience)||void 0===r?void 0:r.undisclosedRecipients),y=S(null===(d=null===(h=null===(c=null===(o=e.parents)||void 0===o?void 0:o[0])||void 0===c?void 0:c.audience)||void 0===h?void 0:h.recipients)||void 0===d?void 0:d.filter((({email:e})=>(0,Je.HD)(e)&&!f.has(e)&&!w.has(e)))),x=S(null===(p=e.audience)||void 0===p?void 0:p.indirectRecipients),I=S(null===(u=e.audience)||void 0===u?void 0:u.undisclosedRecipients),A=S(null===(m=null===(g=e.audience)||void 0===g?void 0:g.recipients)||void 0===m?void 0:m.filter((({email:e})=>(0,Je.HD)(e)&&!x.has(e)&&!I.has(e))));return{previousMessageInfo:(0,l.zG)(ye.YM(null!==(v=e.parents)&&void 0!==v?v:[]),j.fold((()=>Ke.H.PreviousMessageInfo.empty),(e=>{var t;return{author:(0,l.zG)(ye.YM(null!==(t=e.authors)&&void 0!==t?t:[]),j.fold((()=>Ke.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(y.values()),text:e.delta?(0,Qe.l)(e.delta,""):""}}))),title:null!==(_=e.title)&&void 0!==_?_:"",author:(0,l.zG)(ye.YM(null!==(b=e.authors)&&void 0!==b?b:[]),j.fold((()=>Ke.H.Person.empty),(e=>{var t,i;return{name:null!==(t=e.name)&&void 0!==t?t:"",email:null!==(i=e.email)&&void 0!==i?i:""}}))),directRecipients:Array.from(A.values()),indirectRecipients:Array.from(x.values()),undisclosedRecipients:Array.from(I.values())}}var it=i(41127),st=i(8709),nt=i(20236),at=i(67534);function rt(e,t,i,s){const{left:n,right:a}=(0,l.zG)(e,ye.UI((({alertId:e,alternativeIndex:i})=>function(e,t,i){return(0,l.zG)(q.fromOption((()=>`Alert ${e} not found`))(i(e)),q.filterOrElse(nt.S.isCapiAlert,(t=>`Unsupported alert ${e} with type ${t._tag}`)),q.chain((i=>h.$.isWithTransformJson(i)?(0,l.zG)(i.transformJSON.alternatives,j.chain((e=>{var i;return j.fromNullable(null===(i=e.alternatives[t])||void 0===i?void 0:i.delta)})),q.fromOption((()=>`Alternative ${t} not found for WithTransformJson alert ${e}`))):h.$.isWithSubAlerts(i)?(0,l.zG)(i.subalerts.alternatives,j.chain((e=>{var i;return j.fromNullable(null===(i=e.alternatives[t])||void 0===i?void 0:i.delta)})),q.fromOption((()=>`Alternative ${t} or context not found for WithSubAlerts alert ${e}`))):h.$.isWithPosition(i)?q.right((new st.i).retain(i.transformRange.start).delete(i.transformRange.end-i.transformRange.start).insert(i.transformText)):q.left(`Unsupported alert ${e}`))),q.map((i=>({delta:i,alertId:e,alternativeIndex:t}))))}(e,i,t))),ye.oh),r=a.reduce(((e,t)=>e.compose(t.delta)),new st.i),o=(0,at.g)(r),c=(0,at.B)(r);return i.performBatchReplacements(o).then((()=>q.right(void 0))).catch((t=>q.left(`Replacement error for [${e.map((e=>`alertId: ${e.alertId} altIdx: ${e.alternativeIndex}`)).join(", ")}]: `+String(t)))).then((e=>(0,l.zG)(s(),j.filter((()=>c.length>0)),j.fold((()=>Promise.resolve(q.right(void 0))),(e=>Promise.all(c.map((({range:t,formatting:i})=>e.apply(t,i).then((()=>q.right(void 0))).catch((e=>q.left(String(e))))))).then((0,l.ls)(ye.oh,(({left:e})=>e.length>0?q.left(`Formatting errors [${e.join(", ")}]`):q.right(void 0))))))).then((t=>{const i=n.concat(q.isLeft(e)?[e.left]:[]).concat(q.isLeft(t)?[t.left]:[]);return i.length>0?q.left(new Error(`AlertApply - ${i.join(" - ")}`)):q.right(void 0)}))))}var ot=i(80358),lt=i(36919),ct=i(19125);var ht=i(71078),dt=i(18625);var pt=i(48015);function ut(e){return i.e(8661).then(i.bind(i,19853)).then((({createRevisionEngine:t})=>{const i=V.h.create(e.initialAlertId),s=e.alertStateService.getActiveAlertByClick().pipe(I.U((e=>{var t;return null!==(t=null==e?void 0:e.alertId)&&void 0!==t?t:null}))).subscribe(y.wW(i)),n=p.Y.create("cheetah.revision"),{revisionEngine:a,dispose:r}=t({capiService:e.capiService,textEditorService:e.textEditorService,lifecycleService:e.lifecycleService,sduiService:{supportedForms:e.supportedForms,sduiItemCollectionChanges:(c=e.sduiBufferService,b.T(c.pipe(U.G(),I.U((([e,t])=>j.isSome(e)?j.some((0,ct.ex)()):j.none)),v.oA),c.pipe(_.w(j.fold((()=>w.E),(e=>e.capiEvents.pipe(S.h((0,H.Kg)(ot.h.is("sdui_add"),ot.h.is("sdui_update"),ot.h.is("sdui_remove"))),I.U((e=>{switch(e.kind){case"sdui_add":return(0,ct.K5)(e.sduiRootId,e.sdui);case"sdui_update":return(0,ct.FE)(e.sduiRootId,e.sdui);case"sdui_remove":return(0,ct.Ul)(e.sduiRootId);default:return(0,l.Rz)(e)}})))))))).pipe((e=>e.pipe(lt.f(e.pipe(T.b(0))))),S.h((e=>e.length>0)))).pipe(A.b((e=>n.trace("sduiService.sduiItemCollectionChanges",e))))},alertService:{alertCollectionChanges:(o=e.alertProcessor.alerts,dt.P((()=>o.changes.pipe(I.U((e=>{const t=new Set(e.addedAlerts.filter(nt.S.isCapiAlert).map((e=>e.id))),i=new Set(e.removedAlerts.filter((e=>nt.S.isCapiAlert(e.alert))).map((e=>e.id)));return[...e.addedAlerts.filter(nt.S.isCapiAlert).filter((e=>!i.has(e.id))).map((e=>(0,ht.Tm)(e.id))),...e.removedAlerts.filter((e=>nt.S.isCapiAlert(e.alert))).filter((e=>!t.has(e.id))).map((e=>(0,ht.qQ)(e.id,"textChange"===e.reason._tag?"textChange":"other")))]})),E.O(Array.from(o.getAll()).filter(nt.S.isCapiAlert).map((e=>(0,ht.Tm)(e.id)))),(e=>e.pipe(lt.f(e.pipe(T.b(0))))),I.U((e=>e.flatMap(l.yR))),S.h((e=>e.length>0)))))).pipe(A.b((e=>n.trace("alertService.alertCollectionChange",e)))),selectedAlertId:i,applyAlerts:t=>{const i=rt(t,(t=>j.fromNullable(e.alertProcessor.alerts.getAlertById(t))),e.replacementService,e.getFormattingService).then(q.fold((e=>{throw n.warn("Error applying alerts",{applyAlertsInfo:t,error:e}),e}),(()=>{})));return e.requestAwaitService.addRequest(i),i},removeAlerts:t=>(0,pt.DV)((()=>Promise.resolve(t.forEach((({alertId:t,removalReason:i})=>{e.alertProcessor.removeAlert(t,{_tag:"alertApplied"===i?it.i.alertAccepted:it.i.ignore})})))),(e=>(n.warn("Error removing alerts",{removedAlertsInfo:t,error:e}),Promise.reject(e)))),setAlertsVisibility:t=>(e.highlightsUpdater.setAlertsVisibility(t),e.highlightsScroller.scrollToEmphasizedAlert(t,i.get()),Promise.resolve(void 0)),updateAlertsVisibility:t=>(e.highlightsUpdater.updateAlertsVisibility(t),e.highlightsScroller.scrollToEmphasizedAlert(t,i.get()),Promise.resolve(void 0))},monitoringService:{notify:t=>function(e,t,i,s){"error"===t.kind?e.cheetah.error(t,i,s):"warn"===t.kind?e.cheetah.warning(t,i,s):"info"===t.kind?e.cheetah.info(t,i,s):(0,W.L0)(t.kind)}(e.telemetry,t,e.domain,e.getSessionUuid())},logger:n});var o,c;return{revisionEngine:a,dispose:()=>{e.highlightsUpdater.clearAll(),s.unsubscribe(),r()}}}))}var gt=i(48044),mt=i(13853),vt=i(7604),_t=i(73975),bt=i(95300),St=i(32409);class ft{constructor(e){this._params=e,this._subs=new g.w,this._visibleAlertsSubject=new bt.X(new Map),this._emphasizedAlertsSubject=new bt.X(new Map),this._visibleAlerts=this._visibleAlertsSubject.pipe(G.skipBy(gt.Eh(_t.yv,mt.Eh(_t.yv)))),this._emphasizedAlerts=this._emphasizedAlertsSubject.pipe(G.skipBy(gt.Eh(_t.yv,mt.Eh(_t.yv)))),this.hasHighlights=this._visibleAlerts.pipe(I.U((e=>e.size>0)),E.O(!1),C.x(),G.shareReplay({bufferSize:1,refCount:!0})),this._subs.add(this._visibleAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("visible highlights",e)}))),this._subs.add(this._emphasizedAlerts.subscribe((e=>{var t;return null===(t=this._params.logger)||void 0===t?void 0:t.debug("emphasized highlights",e)})))}setAlertsVisibility(e){this.clearAll();const t=new Map(this._visibleAlertsSubject.value),i=new Map(this._emphasizedAlertsSubject.value);e.filter((e=>"hidden"!==e.visibility)).forEach((({alertId:e,visibility:s})=>{const n=this._params.getAlertById(e);if(n){const a=n.highlightRanges.map((t=>({range:t,highlightId:wt(e,t)})));a.forEach((({range:e,highlightId:t})=>{this._params.highlightCollection.addHighlight(t,e,St.M.getHighlightMeta(n,t,e,!1,!1))})),t.set(e,new Set(a.map((e=>e.highlightId)))),"emphasized"===s&&i.set(e,new Set(a.map((e=>e.highlightId))))}})),this._visibleAlertsSubject.next(t),this._emphasizedAlertsSubject.next(i)}updateAlertsVisibility(e){const t=new Map(this._visibleAlertsSubject.value),i=new Map(this._emphasizedAlertsSubject.value);e.forEach((({alertId:e,visibility:s})=>{var n;const a=this._params.getAlertById(e);if(a&&"hidden"!==s){const n=a.highlightRanges.map((t=>({range:t,highlightId:wt(e,t)})));n.forEach((({range:e,highlightId:t})=>{this._params.highlightCollection.updateHighlight(t,e,St.M.getHighlightMeta(a,t,e,!1,!1))})),t.set(e,new Set(n.map((e=>e.highlightId)))),"emphasized"===s?i.set(e,new Set(n.map((e=>e.highlightId)))):i.delete(e)}else{const s=Array.from(null!==(n=this._visibleAlertsSubject.value.get(e))&&void 0!==n?n:new Set);s.length>0&&this._params.highlightCollection.removeHighlights(s),t.delete(e),i.delete(e)}})),this._visibleAlertsSubject.next(t),this._emphasizedAlertsSubject.next(i)}clearAll(){const e=new Set(Array.from(this._visibleAlertsSubject.value.values()).concat(Array.from(this._emphasizedAlertsSubject.value.values())).flatMap((e=>Array.from(e))));e.size>0&&this._params.highlightCollection.removeHighlights(Array.from(e)),this._visibleAlertsSubject.next(new Map),this._emphasizedAlertsSubject.next(new Map)}getHighlightVisualState(e){const t=this._params.alertStateService.getHighlightedAlert().pipe(I.U((t=>{var i;return!0===(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.includes(e))})),E.O(!1),C.x()),i=this._params.alertStateService.getActiveAlertByClick().pipe(I.U((t=>{var i;return!0===(null===(i=null==t?void 0:t.highlightIds)||void 0===i?void 0:i.includes(e))})),E.O(!1),C.x()),s=this._emphasizedAlerts.pipe(I.U((t=>Array.from(t.values()).some((t=>t.has(e))))),C.x());return x.aj([t,i,s]).pipe(I.U((([e,t,i])=>({hovered:e,selectedByClick:t,emphasized:i}))),E.O({hovered:!1,selectedByClick:!1,emphasized:!1}),U.G(),I.U((([e,t])=>t.hovered||t.selectedByClick?vt.pc.hovered:t.emphasized?e.hovered||e.selectedByClick?vt.pc.hovered:vt.pc.hoveredNeedsAttention:vt.pc.none)),E.O(vt.pc.none),C.x(),A.b((t=>{var i;return null===(i=this._params.logger)||void 0===i?void 0:i.debug(`[${e}] visual state:`,t)})))}dispose(){this.clearAll(),this._subs.unsubscribe()}}function wt(e,t){return`${e}|${t.start}-${t.end}|cheetah`}class yt{constructor(e){this._params=e,this._subscriptions=new g.w,this._currentEmphasizedAlertId=null}scrollToEmphasizedAlert(e,t){this._params.experimentClient.isGateEnabled(Ye.K.CheetahMergedWithExtensionScrolling)&&e.forEach((({alertId:e,visibility:i})=>{const s=this._params.getAlertById(e);if(s&&"emphasized"===i&&e!==this._currentEmphasizedAlertId){if(s.highlightRanges.length>1&&e===t)return;const i=s.highlightRanges[0];i&&(this._params.integration.scrollToHighlight(i),this._currentEmphasizedAlertId=e)}}))}dispose(){this._subscriptions.unsubscribe()}}class xt{constructor(e){this._options=e}async getCapabilities(){return"plaintext"===this._options.type?{insertText:"yes",insertTextWithFormatting:"no",insertTextWithImages:"no",insertTextWithLinks:"no",pasteImages:"no"}:{insertText:"yes",insertTextWithFormatting:"yes",insertTextWithImages:"yes",insertTextWithLinks:"yes",pasteImages:"yes"}}async setSelection({range:e}){this._options.setSelection(e)}async getDocumentState({withSelection:e}){let t;e&&(t=this._options.getSelection().find(Boolean));return{doc:{ops:this._options.getText().ops},selection:t}}async pasteImage({data:e,format:t}){const i=await It(t,e);if(await this._copyToClipboard(i),"plaintext"===this._options.type)throw new Error("Cannot paste image into plaintext");this._options.replaceText(new st.i([{insert:{image:URL.createObjectURL(i)}}]))}async _copyToClipboard(e){const t={};["image/png","text/html","text/plain"].includes(e.type)?t[e.type]=e:(t[`web ${e.type}`]=e,e.type.startsWith("image/")&&(t["text/html"]=new Blob([`<img src="${URL.createObjectURL(e)}">`],{type:"text/html"}))),await navigator.clipboard.write([new ClipboardItem(t)])}async copyImage({data:e,format:t}){const i=await It(t,e);await this._copyToClipboard(i)}async copyText({text:e}){await navigator.clipboard.writeText(e)}async insertText({text:e}){await this._options.replaceText(e)}async insertAtCaret({delta:e}){await this._options.replaceText(new st.i(e.ops))}async applyDelta({delta:e}){await this._options.replaceText(new st.i(e.ops))}}async function It(e,t){if(!["png","gif","jpeg"].includes(e))throw new Error(`Unsupported format: ${e}`);const i=await fetch(`data:image/${e};base64,${t}`);return await i.blob()}var At=i(65432),Rt=i(62497),Ct=i(99966);var Et=i(85441);class Ut{constructor({gOS:e,createEditSession:t,changes:i}){this._defaultSkillRequestsValue={size:{width:416,height:245},close:!1},this._bg=new Ct.X(new Rt.rr("skills-bg-d5ccc5edf7e1",(0,Et.OB)().message)),this._running=null,this._requests=new bt.X(this._defaultSkillRequestsValue),this._gOS=e,this._createEditSession=t,this._editorChanges=i.subscribe((({selection:e,document:t})=>{if(null==this._running)return;const i=new At.RS(this._running.rpc.call.bind(this._running.rpc));e&&i.selectionUpdated(null),t&&i.textUpdated(null)}))}dispose(){this._editorChanges.unsubscribe()}get skillRequests(){return this._requests.asObservable()}getSkills(){return a.Y3((async()=>{try{return await this._bg.api.getSkills()}catch(e){throw new Error(`Failed to get skills: ${e}`)}}),q.toError)}initSkill(e,t){return null!=this._running&&this._gOS.forceTerminate(this._running),a.Y3((()=>new Promise((i=>{const s={kind:"ui",id:`skill-${e.id}`,displayName:e.displayName,entryPoint:e.srcUrl,version:"1.0.0"};this._gOS.registry.register(s);const{applet:n}=this._gOS.createUIAppletContainer((0,At.SP)(s),{onInit:e=>{this._requests.next({...this._requests.getValue(),size:e.initialSize}),i(e.initialSize)},onResize:e=>{this._requests.next({...this._requests.getValue(),size:e})}},this._createEditSession(),t);this._running=n,this._requests.next(this._defaultSkillRequestsValue)}))),q.toError)}terminateSkill(e){return a.Y3((async()=>{if(null==this._running)return;const t=(0,At.SP)({kind:"ui",id:`skill-${e.id}`});if((0,At.SP)(this._running.manifest)!==t)return;const i=this._running;this._running=null,await i.gracefullyUnloadApplet()}),q.toError)}}var kt=i(87827);class Bt extends Ct.X{constructor(){const e=pt.iy.create();super(new Rt.rr("gOS-bg-d5ccc5edf7e1",(0,Et.OB)().message,e)),this.id=e}}function Tt(e){return"dev-qa"===e||"qa"===e?"qa":"dev-preprod"===e?"preprod":"prod"}var Mt,Ot=i(24853);function Pt(e,t){return JSON.stringify({clientId:e,instanceId:t})}class zt extends Ot.S{constructor(e,t){super(new Gt("gOS-fg-d5ccc5edf7e1",(0,Et.OB)().message,e.id),{dispatchAction:({clientId:e},i,s,n)=>t.dispatchAction(Pt(e,i),s,n),dispose:({clientId:e},i)=>t.dispose(Pt(e,i))})}}class Gt{constructor(e,t,i){this._rpcMessageName=e,this._message=t,this._clientId=i,this.inbound=new N.y((e=>{const t=t=>{t.clientId===this._clientId&&e.next(t)};return this._message.on(this._rpcMessageName,t),()=>this._message.off(this._rpcMessageName,t)})),this.outbound=e=>{this._message.sendBackground(this._rpcMessageName,e)}}}class Nt{constructor(e){this._host=e}_getContainerFor(e){const t=this._host.getAppletContainer(e);if(null==t)throw new Error(`No applet container for context ${e}`);return t}async dispatchAction(e,t,i){const s=this._getContainerFor(e),n=t.split(".").slice(0,-1).join(".");return null==s.objects.get(n)?await s.rpc.call(t,i):await s.objects.execute(t,i)}async dispose(e){}}class Ft{constructor(e){var t;this._didReceiveReadyMessage=!1,this._onMessageListeners=[],this._pendingOutgoingMessages=[],this._onMessage=e=>{null!=e.source&&e.source===this._iframe.contentWindow&&(this._didReceiveReadyMessage=!0,this._onMessageListeners.forEach((t=>t(e.data))),this._flushPendingOutgoingMessages())},this._flushPendingOutgoingMessages=()=>{if(this._didReceiveReadyMessage&&0!==this._pendingOutgoingMessages.length&&null!=this._iframe.contentWindow){for(const e of this._pendingOutgoingMessages)this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin);this._pendingOutgoingMessages.length=0}},this._iframe=e;const i=new URL(e.src,self.location.href),s=i.origin,n=self.origin;this._iframeTargetOrigin="null"===n||"http:"===self.location.protocol&&"https:"===i.protocol||!1===(null===(t=e.getAttribute("sandbox"))||void 0===t?void 0:t.includes("allow-same-origin"))?"*":s,self.addEventListener("message",this._onMessage)}postMessage(e){null!=this._iframe.contentWindow&&this._didReceiveReadyMessage?(this._flushPendingOutgoingMessages(),this._iframe.contentWindow.postMessage(e,this._iframeTargetOrigin)):this._pendingOutgoingMessages.push(e)}onMessage(e){this._onMessageListeners.push(e)}dispose(){self.removeEventListener("message",this._onMessage),this._onMessageListeners.length=0,this._pendingOutgoingMessages.length=0}}!function(e){e.postMessage="postMessage",e.resize="resize",e.setSource="setSource"}(Mt||(Mt={}));class jt{constructor(e,t){const i=null!=t?t:document.createElement("iframe");null==i.getAttribute("sandbox")&&i.setAttribute("sandbox","allow-scripts"),i.allow="clipboard-read *; clipboard-write *",i.src=`${e.baseUri}src/gOS-sandbox.html`,this._frame=i,this._messenger=new Ft(i),this._shouldDetach=null==t}setSource(e){this._messenger.postMessage({type:Mt.setSource,url:e})}resize(e){const t=0===e.height?"":`${e.height}`;this._frame.width=`${e.width}`,this._frame.height=`${t}`,this._messenger.postMessage({type:Mt.resize,size:e})}postMessage(e){this._messenger.postMessage({type:Mt.postMessage,data:e})}onMessage(e){this._messenger.onMessage(e)}dispose(){this._messenger.dispose(),this._shouldDetach&&this._frame.remove()}get frame(){return this._frame}}class Ht{constructor(e,t=(0,Et.OB)().browserApi){this._usingFrame=e,this._api=t}createBackgroundSandbox(e,t){throw new Error("Not supported")}createUISandbox(e,t){return new jt(this._api,this._usingFrame)}}class Dt{constructor(e,t,i){this._container=e,this._delegates=t,this._logger=i}async initialize(e){var t,i;this._resize(e.initialSize);const s=await this._container.createInitializeResponse(e);return null===(i=(t=this._delegates).onInit)||void 0===i||i.call(t,e),{...s,platform:"extension"}}async visuallyReady(){}async resizeFrame(e){var t,i;null===(i=(t=this._delegates).onResize)||void 0===i||i.call(t,this._resize(e))}_resize(e){var t,i;const s=Math.max(null!==(i=null===(t=this._container.view.frame.parentElement)||void 0===t?void 0:t.clientWidth)&&void 0!==i?i:0,e.width),n=e.height;return this._container.view.resize({width:s,height:n}),{width:s,height:n}}async requestClose(){var e,t;null===(t=(e=this._delegates).onClose)||void 0===t||t.call(e),setTimeout((()=>{this._container.gracefullyUnloadApplet()})),this._container.view.frame.style.display="none"}async startDragMove(){}async log(e){this._logger.log(e.level,e.message,e.data,"",-1,-1,"")}async openURL(e){if(null==self.open(e.url,"_blank","noopener"))throw new Error("Failed to open URL")}async triggerSettingsMenu(e){}}class qt{constructor(e,t,i){this.registry=i,this._nextInstanceId=0,this._running=new Map,this._logger=p.Y.create("GOSRuntimeHost"),this._root=new At._y(e,i).withContainerFactory(new Ht),this._background=t}getAppletContainer(e){return this._running.get(function(e){return JSON.parse(e)}(e).instanceId)}createUIAppletContainer(e,t={},i,s){const n=this._nextInstanceId++;let a=this._root;null!=s&&(a=a.withContainerFactory(new Ht(s))),null!=i&&(a=a.withEditSession(i)),this._registerForwardingServices(a,((e,t)=>this._background.dispatchAction(n,e,t)));const r=a.createAppletView(e);this._running.set(n,r);const o=a.environment.makeLogger(e),l=new Dt(r,t,o);return r.objects.register(At.xe.objectName,new At.xe(l)),r.onBeforeUnload((()=>{this._running.delete(n),this._background.dispose(n),r.view.dispose()})),new At.GO(r.rpc.call.bind(r.rpc.call)).start({entryPoint:"ideation",userState:{settings:{inlineQuickReplyEnabled:!0,inlineRewriteEnabled:!0},usage:{promptsAllocated:100,promptsRemaining:100,refillDate:(new Date).toISOString()}}}).catch((()=>{})),{applet:r,host:l}}forceTerminate(e){this._logger.warn(`Force terminating applet: ${e.manifest.id}`),this._running.forEach(((t,i)=>{t===e&&this._running.delete(i)}));try{e.unloadApplet(),e.objects.dispose(),e.rpc.dispose()}catch(e){this._logger.error(`Failed to force terminate applet: ${e}`)}}_registerForwardingServices(e,t){e.registerObject("host.authorizedHttpClient",new At.Wr(new At.ik(t))),e.registerObject("host.capiSocket",new At.Hd(new At.C(t))),e.registerObject("host.userAccount",new At.Ng(new At.c3(t)))}}class Wt{static get shared(){return null===this._instance&&(this._instance=new Wt(new kt.h((0,Et.OB)().browserApi.preferences))),this._instance}constructor(e){this.store=e,this._cache=null}get _state(){return null===this._cache&&(this._cache=this._create()),this._cache}_create(){const e=new At.Ic,t=new Bt,i=new qt(function(e,t){const{bgRpc:i}=t,{buildInfo:s,bundleInfo:n}=t.config;return{environment:Tt(n.env),async getContainerId(){var e;return null!==(e=await i.api.getContainerIdOrUndefined())&&void 0!==e?e:""},async getUserId(){var t,i;return null!==(i=null===(t=(await e.get(["user"])).user)||void 0===t?void 0:t.id)&&void 0!==i?i:"-1"},clientName:n.extensionType,clientVersion:s.version,clientType:"extension",isDebugMode:n.env.startsWith("dev"),openURL(e){},makeLogger:e=>{return t=p.Y.create(`applet/${e}`),{log(e,i,s,n,a,r,o){const l=a>0?`${i} (${o} at ${n}:${a}:${r})`:i;switch(e){case"debug":t.debug(l,s);break;case"info":t.info(l,s);break;case"warn":t.warn(l,s);break;case"error":t.error(l,s)}}};var t},makePerformanceTracker:()=>({})}}(this.store,(0,Et.OB)()),t.api,e);return{registry:e,client:t,host:i,server:new zt(t,new Nt(i))}}get registry(){return this._state.registry}get host(){return this._state.host}dispose(){null!==this._cache&&(Object.values(this._cache).forEach((e=>"dispose"in e&&e.dispose())),this._cache=null)}}Wt._instance=null;var $t=i(45630);class Vt{constructor(e){this._experimentClient=e,this.gates=$t.CI,this.experiments=$t.V}getTreatment(e){return a.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.getTreatment(e))),(e=>String(e)))}isGateEnabled(e){return a.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.isGateEnabled(e))),(e=>String(e)))}logTreatment(e,t){return a.Y3((async()=>{await this._experimentClient.logTreatment(e,t)}),(e=>String(e)))}peekTreatment(e){return a.Y3((async()=>(await this._experimentClient.fetchTreatments(),this._experimentClient.peekTreatment(e))),(e=>String(e)))}}var Lt=i(95399);function Yt(e,t,i){return Lt.z(dt.P((()=>B.D(t()))).pipe(S.h(i)),e)}var Zt=i(53917);const Qt=(0,$.xb)(J),Kt=new Set(["onboarding","gdocsOnboardingPopup","loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","noPaymentMethodSubscription","grammarlyBusinessSigninPopup","gdocsFeedbackUI"]),Jt=new Set(["onboarding","gdocsOnboardingPopup","loginSSO","accountMigration","standWithUkraineGrammarlySuspended","claimedUser","dataControl","grammarlyBusinessSigninPopup"]);function Xt(e){return"opened"===e.kind}class ei{constructor(e){this._params=e,this._subs=new g.w,this._log=p.Y.create("CheetahFeatureImpl"),this._inlineButtonUI=V.h.create(null),this._ideateButtonUI=V.h.create(null),this._expandedIdeateButtonUI=V.h.create(null),this._assistantUI=V.h.create(null),this._highlightUI=V.h.create(null),this._quasiCaretUI=V.h.create(null),this._onboardingUI=V.h.create(null),this._nativeCursorHider=V.h.create(j.none),this._lastRestartAttemptTime=V.h.create(0),this._contextHighlight=V.h.create(j.none),this._highlightsUpdater=new ft({getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e),highlightCollection:this._params.highlightCollection,alertStateService:this._params.alertStateService,logger:p.Y.create("cheetah.revision.highlights")}),this._highlightsScroller=new yt({integration:this._params.integration,experimentClient:this._params.experimentClient,getAlertById:e=>this._params.alertProcessor.alerts.getAlertById(e)}),this._ideateButtonTooltipNotificationState=V.h.create(j.none),this._assistantFocused=V.h.create(!1),this._inlineButtonRecentlyPressed=V.h.create(!1),this._ideateButtonRecentlyHovered=V.h.create(!1),this._selectionRange=V.h.create(j.none),this._highlights=V.h.create([]),this._quasiCaretRect=V.h.create(j.none),this._assistantUIState=V.h.create(j.none),this._onboardingViewModels=V.h.create(j.none),this._ideateButtonRefChange=new m.xQ,this._disposed=new m.xQ,this._initialOnboardingBlockedForSession=V.h.create(!1),this._assistantServices=function(e,t,i,s,n,o,c,h,v,w,y,C,E,U,k,B,T,M,H,D,$,L,Y,Z,Q,K,J,X,ee,te,ie){const se=new m.xQ,ne=()=>(0,l.zG)(e.get(),q.fromOption((()=>new Error("checking service not initialized")))),ae={notify(e){null==ie||ie.info("received monitoring event",{event:e}),(0,l.zG)(ne(),q.map((e=>e.sessionUuid)),q.map((t=>{"error"===e.kind?(X.cheetah.error(e,K,t),"waitForContextTimeout"!==e.name&&"waitForAckTimeout"!==e.name||"getContext"!==e.source||(Date.now()-Q.get()>u.LK(5)?(Q.set(Date.now()),J()):(0,l.zG)(e.name,(e=>"waitForAckTimeout"===e?"ack":"waitForContextTimeout"===e?"setContext":void(0,W.L0)(e)),(e=>X.cheetah.sessionRestartTimeout(e,K,t))))):"info"===e.kind?X.cheetah.info(e,K,t):"warn"===e.kind?X.cheetah.warning(e,K,t):(0,W.L0)(e.kind)})))}},re=new Te.t({inboundCAPIMessages:Yt(t,i,Me.J4),sendCAPIMessage:({action:e,data:t,shouldInjectRev:i,shouldInjectSessionId:s})=>(0,l.zG)(a.Uo(ne()),a.tS((n=>n.sendMessage(e,t,i,s)))),monitoringService:ae}),oe=new Oe.c(re),le={user:V.h.combine(s,n,((e,t)=>({id:e.id,isPremium:De.n5.isPremium(e),dialect:t,email:e.email,institution:(0,l.zG)(j.fromNullable(e.institutionInfo),j.map((({id:e,name:t})=>({id:e,name:t}))))}))),setDialect:o},ce=new Pe.L(re,v.view((0,l.ls)(j.chain((e=>j.fromNullable(e.cheetahState))),j.fold((()=>({enabled:!1})),(e=>({enabled:!0,userState:e})))))),he=c.pipe(_.w(j.fold((()=>R.of(j.none)),(e=>e.sessionService.session.view(j.some))))),de=w.pipe(O.QV(P.E),z.R(((e,t)=>{const i=e.filter(ii);return t&&ii(t)?[...i,t]:i}),[]),I.U(ye.Z$),G.shareReplay({bufferSize:1,refCount:!0})),pe=x.aj([de,y,C]).pipe(I.U((([e,t,i])=>(0,l.zG)(e,j.filter((()=>t)),j.fold((()=>({})),(e=>({[ze.n.initialPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0,[ze.n.initialBTSPopupAnchor]:i?{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}:void 0,[ze.n.rewriteTooltipAnchor]:{reference:e,placement:"top",offset:8,boundaryAreaPadding:10}}))))))),ue=e=>{null==ie||ie.debug(`Completing step [${e}]`);U.get()[e].extension.completed||k({[e]:{completed:!0,lastSeen:Date.now()}})},ge=()=>{const e=new Set;B.get().rewrite&&T||e.add(Ae.T.StepName.rewrite),B.get().compose||e.add(Ae.T.StepName.initial),B.get().onboarding||(e.add(Ae.T.StepName.initial),e.add(Ae.T.StepName.initialBTS),e.add(Ae.T.StepName.rewrite),e.add(Ae.T.StepName.prompts),e.add(Ae.T.StepName.review),e.add(Ae.T.StepName.knowledgeHub),e.add(Ae.T.StepName.references));const t=(0,l.zG)(v.get(),j.map((e=>"ASSIGNMENT_WRITING"===e.defaultDocumentContext.writingIntent)),j.getOrElse(l.jv));return B.get().onboardingBTS&&t||e.add(Ae.T.StepName.initialBTS),B.get().knowledgeHubIntegration||e.add(Ae.T.StepName.knowledgeHub),(0,Ge.Q)({upstreamOnboardingState:U,session:he,textStats:h,forceDisabledOnboardingSteps:e,assistantUIActions:se,externalElements:pe,hideAssistantOnboardingTooltips:c.pipe(_.w(j.fold((()=>V.h.create(!1)),(e=>e.dragBehavior.pipe(I.U((e=>"draggable"===e.kind&&e.isDragging))))))),promptsAllocated:ce.availability.view(Ie._.getPromptsAllocated),client:"extension",trackingService:oe,disposed:E,logger:Ve.C8.Logging.getLogger("OnboardingCompletionEffects"),completeOnboardingStep:ue})},me={flush:()=>a.fF((()=>new N.y((t=>{const i=new g.w;return M.empty.get()?t.next(void 0):(M.flush(),(0,l.zG)(e.get(),j.fold((()=>t.next(void 0)),(e=>{i.add(e.messages.pipe(S.h((e=>e._tag===we.J8.Type.submitOtAck)),F.L(500,R.of(null)),A.b((()=>t.next(void 0)))).subscribe())})))),()=>i.unsubscribe()})).pipe(f.q(1)).toPromise())),getText:e=>a.tD((()=>H(e))),insertText:e=>a.tD((()=>D(e))),copyText:e=>()=>(0,d.v)(e).pipe(f.q(1)).toPromise(),setContextHighlight:(e,t)=>{Y.set(j.some({range:e,visibility:t}))},selectedRange:$,textUpdated:L},ve={reportUphookShow:e=>a.tD((()=>{e.isPremium||((0,We.n)(Z,{placement:"grammarlyGoPrompts",upgradeHookName:"grammarlyGoPrompts",upgradeHookSlot:"grammarlyGo"}),X.upgradeHooks.showUpgradeHook("grammarlyGoPrompts","grammarlyGo"))})),reportUphookClick:e=>a.tD((()=>{e.isPremium?self.open(r.Rd().appConfig.url.support):((0,We.Q)(Z,{placement:"grammarlyGoPrompts",upgradeHookName:"grammarlyGoPrompts",upgradeHookSlot:"grammarlyGo"}),X.upgradeHooks.clickUpgradeHook("grammarlyGoPrompts","grammarlyGo"),(0,qe.wW)("upHook","grammarlyGoPrompts"))}))},_e={domain:R.of(K),submitFeedback:e=>a.Y3((()=>(0,l.zG)(e.source,(e=>e===Ne.x.Source.resultCard?"cheetah-card":e===Ne.x.Source.quickReplyInitialActions||e===Ne.x.Source.intentCard?"cheetah-quick-reply":void(0,W.L0)(e)),(t=>Z.feedbackFormSubmit(e.mood,t,e.domain,e.message)))),(e=>new Error(String(e))))},be=new Fe.p({capiService:re,monitoringService:ae}),Se=new je.j(V.h.create({contextUpdatesClient:ee.isGateEnabled(Ye.K.CheetahSelectionContextUpdates)&&"test"===ee.getTreatment(Ze.p.CheetahSelectionContextUpdates),contextUpdatesServer:ee.isGateEnabled(Ye.K.CheetahSelectionContextUpdatesServer)&&"test"===ee.getTreatment(Ze.p.CheetahSelectionContextUpdates)})),fe=new He.w({capiService:re,logger:p.Y.create("cheetah.toneDetectorService"),trackToneReportShow:({tones:t,brandTonesEnabled:i})=>{var s,n;return Z.emogenieReportShow(t.map((({name:e,confidence:t,prevalence:i,emojiId:s})=>({emoji:String.fromCodePoint(parseInt(s,16)),name:e,confidence:t,prevalence:i}))),i,t.length,null!==(n=null===(s=j.toNullable(e.get()))||void 0===s?void 0:s.sessionUuid)&&void 0!==n?n:"")}});let xe,Re;ee.isGateEnabled(Ye.K.GOSRollout)&&(xe=new Vt(ee),Ce={gOS:Wt.shared.host,createEditSession:te,changes:(0,b.T)($.pipe(I.U((()=>({selection:!0,document:!1})))),L.pipe(I.U((()=>({selection:!1,document:!0})))))},Re=new Ut(Ce));var Ce;return{capiService:re,userService:le,genAIAvailabilityService:ce,trackingService:oe,textEditorService:me,feedbackService:_e,uphookService:ve,monitoringService:ae,userSurveyService:be,selectionContextAvailabilityService:Se,toneDetectorService:fe,experimentService:xe,skillService:Re,createOnboardingViewModels:ge,notifyAssistantUIAction:e=>se.next(e),dispose:()=>{ce.dispose(),be.dispose(),Se.dispose(),null==Re||Re.dispose()}}}(this._params.checkingService,this._params.checkingService.pipe(v.oA,_.w((e=>e.capiMessages))),(()=>Object.values(this._params.latestCAPIMessages.get())),this._params.user,this._params.dapiSettings.view((e=>{var t,i;return null!==(i=null!==(t=e.dialectStrong)&&void 0!==t?t:e.dialectWeak)&&void 0!==i?i:"american"})),(e=>a.fF((()=>this._params.dapiActions.changeStrongDialect(e)))),this._assistantUIState,this._params.textStats,this._params.capiStartAckMessage,this._ideateButtonRefChange,V.h.combine(this._params.integration.canShowIdeateButtonPopups,this._params.gButtonPopupState.view("type").view((e=>!Kt.has(e))),H.xD),V.h.combine(this._params.csPageState.view("cheetah").view((e=>(null==e?void 0:e.canShowInitialOnboarding)||(null==e?void 0:e.canShowInitialBTSOnboarding)||!1)),this._initialOnboardingBlockedForSession,((e,t)=>e&&!t)),b.T(this._params.csPageState.view("isActiveTab").pipe(S.h((e=>!e))),this._disposed).pipe(f.q(1)),this._params.dapiSettings.view((e=>function(e){const t=xe.Z.State.toClientState(xe.Z.decode(e.extension||""),"extension"),i=xe.Z.State.toClientState(xe.Z.decode(e.editor||""),"editor"),s=xe.Z.State.toClientState(xe.Z.decode(e.llamaMac||""),"llamaMac"),n=xe.Z.State.toClientState(xe.Z.decode(e.llamaWindows||""),"llamaWin");return(0,l.zG)(xe.Z.State.empty,xe.Z.State.patch(t,"extension"),xe.Z.State.patch(i,"editor"),xe.Z.State.patch(s,"llamaMac"),xe.Z.State.patch(n,"llamaWin"))}({extension:e["cheetah:onboardingState"],editor:e["cheetah:onboardingState:editor"],llamaMac:e["cheetah:onboardingState:llamaMac"],llamaWindows:e["cheetah:onboardingState:llamaWindows"]}))),(e=>{this._params.dapiActions.modifyCheetahOnboardingState((0,l.ls)(xe.Z.decode,(t=>(0,l.zG)(xe.Z.State.toClientState(t,"extension"),(t=>({...t,...e})),(e=>xe.Z.State.patch(e,"extension")(t)))),xe.Z.encode))}),this._params.featureFlags,this._params.integration.enableInlineRewrites,this._params.textChangeBuffer,(e=>this._params.integration.getText(e)),(e=>this._insertText(e)),this._selectionRange,this._params.integration.textUpdated,this._contextHighlight,this._params.gnar,this._lastRestartAttemptTime,this._params.domain,(()=>this._restartAssistant()),this._params.telemetry,this._params.experimentClient,(()=>{return e={type:this._params.replacementService.capabilities,getSelection:()=>(0,l.zG)(this._selectionRange.get(),D.dH((e=>[e]),[])),setSelection:e=>this._params.selectionService.setSelection(e),getText:()=>this._params.textObserver.getTextSource().getRichText(),replaceText:async(e,t)=>{await this._params.replacementService.performReplacement({pos:null!=t?t:(0,l.zG)(this._selectionRange.get(),j.getOrElse((()=>({start:0,end:0})))),value:e})}},new xt(e);var e}),this._log),this._isOnboardingPopupVisible=V.h.create(!1),this._entryPointsEnabled=V.h.create(!1),this._openAssistantSubject=new m.xQ,this.inlineButtonUI=this._inlineButtonUI.view(),this.ideateButtonUI=this._ideateButtonUI.view(),this.expandedIdeateButtonUI=this._expandedIdeateButtonUI.view(),this.assistantUI=this._assistantUI.view(),this.highlightUI=this._highlightUI.view(),this.quasiCaretUI=this._quasiCaretUI.view(),this.onboardingUI=this._onboardingUI.view(),this.assistantState=this._assistantUI.view((0,l.ls)(j.fromNullable,j.fold((()=>({kind:"closed"})),(()=>({kind:"opened",supportsRevision:this._params.supportsRevision}))))),this.isOnboardingPopupVisible=this._isOnboardingPopupVisible.view(),this.isAvailable=V.h.combine(this._assistantServices.genAIAvailabilityService.availability.view((0,H.ff)(Ie._.isUnavailable)),this._params.csPageState.view("cheetah"),((e,t)=>{var i;return e&&!0===(null===(i=null==t?void 0:t.status)||void 0===i?void 0:i.cheetahEnabled)})),this.userSettings=this._assistantServices.genAIAvailabilityService.availability.view("userSettings"),this._params.dapiActions.reloadPropsRateLimited(),this._subs.add(this._params.checkingService.pipe(v.oA,_.w((e=>e.readyState)),S.h((e=>e===we.kQ.ready)),f.q(1)).subscribe((()=>this._init()))),this._subs.add(this._setupIdeateTooltipStateObs());const t=this._onboardingViewModels.pipe(_.w(j.fold((()=>w.E),(e=>e.onboarding.uiActions))));this._subs.add(t.pipe(S.h(ni)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialOnboardingShown()}))),this._subs.add(t.pipe(S.h(ai)).subscribe((()=>{this._params.cheetahCSActions.cheetahInitialBTSOnboardingShown()}))),this._subs.add(this._getOnboardingVMStepActive([Ae.T.StepName.initial,Ae.T.StepName.initialBTS]).subscribe(y.wW(this._isOnboardingPopupVisible))),this._subs.add(this._params.gButtonPopupState.view("type").view((e=>Jt.has(e))).subscribe((e=>{e&&this._initialOnboardingBlockedForSession.set(!0)}))),this._subs.add(x.aj([this._params.gButtonDisabledReason,this._params.integration.entryPointsEnabled]).pipe(I.U((([e,t])=>t&&!function(e){const t=new Set([Le.P.DATA_CONTROL_ACTIVE,Le.P.OFFLINE,Le.P.STAND_WITH_UKRAINE,Le.P.USER_CLAIMED,Le.P.USER_EDC_BLOCKED,Le.P.SIGNED_OUT_GB]);return null!==e&&t.has(e)}(e)))).subscribe(y.wW(this._entryPointsEnabled))),(0,Zt.G)(this._params.experimentClient)||this._subs.add(this._params.csPageState.view("cheetah").view((e=>{var t;return!1===(null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.cheetahEnabled)})).subscribe((()=>this._closeAssistant($e.j.disposed)))),this._registerDebugHelpers()}closeAssistant(e){this._closeAssistant(e)}getHoveredStateBehavior(e){return this._highlightsUpdater.getHighlightVisualState(e)}suggestStartSessionMode(){const e=this._params.featureFlags.get();return(0,l.zG)(this._params.integration.selectionRange.get(),j.filter((t=>si(t)&&e.rewrite)),j.fold((()=>"ideation"),(()=>"rewrite")))}_init(){this._subs.add(this._assistantFocused.subscribe((e=>this._log.debug("Assistant "+(e?"focused":"blurred"))))),this._subs.add(this._openAssistantSubject.pipe(_.w((e=>this._openAssistant(e)))).subscribe()),this._subs.add(this._params.openAssistant.subscribe(this._openAssistantSubject)),this._subs.add(this._getInlineButtonUI().subscribe(y.wW(this._inlineButtonUI))),this._subs.add(this._getIdeateButtonUI().subscribe(y.wW(this._ideateButtonUI))),this._subs.add(this._getExpandedIdeateButtonUI().subscribe(y.wW(this._expandedIdeateButtonUI))),this._subs.add(this._getHighlightUI().subscribe(y.wW(this._highlightUI))),this._subs.add(this._getQuasiCaretUI().subscribe(y.wW(this._quasiCaretUI))),this._subs.add(this._getOnboardingUI().subscribe(y.wW(this._onboardingUI))),this._subs.add(this._updateSelectionRange().subscribe(y.wW(this._selectionRange))),this._subs.add(this._updateHighlightRects().subscribe(y.wW(this._highlights))),this._subs.add(this._updateQuasiCaretRect().subscribe(y.wW(this._quasiCaretRect))),this._subs.add(this._updateNativeCursor().subscribe()),this._subs.add(this.assistantState.subscribe((e=>{Xt(e)&&this._params.closeLegacyAssistant()}))),this._subs.add(this._createOnboardingViewModelWhenCheetahAvailable().subscribe()),this._subs.add(this._handleTryItOut().subscribe())}_handleTryItOut(){return this._onboardingViewModels.pipe(_.w(j.fold((()=>w.E),(e=>e.onboarding.uiActions))),S.h(Re.l.is(Re.l.Kind.tryItOut)),A.b((()=>this._openAssistantSubject.next({mode:ti(this._params.integration.quickReplyContext.get())&&this._params.featureFlags.get().quickReply?"quickReply":"ideation"}))))}_getOnboardingVMStepActive(e){return this._onboardingViewModels.pipe(_.w(j.fold((()=>R.of(!1)),(t=>t.onboarding.activeStep.view((0,l.ls)(j.filter((e=>e.show)),j.map((t=>e.includes(t.name))),j.getOrElse(l.jv)))))),C.x())}_setupIdeateTooltipStateObs(){return this._assistantServices.genAIAvailabilityService.availability.pipe(E.O(null),U.G(),I.U((([e,t])=>e&&t&&Ie._.isPassive(e)&&Ie._.isActive(t)?j.some("You’ve got prompts!"):j.none)),_.w(j.fold((()=>R.of(j.none)),(e=>b.T(R.of(j.some(e)),R.of(j.none).pipe(k.g(3e3))))))).subscribe(y.wW(this._ideateButtonTooltipNotificationState))}_registerDebugHelpers(){!function(e){const t=self;t&&(t.cheetahDebug=t.cheetahDebug||{},Object.assign(t.cheetahDebug,e))}({clearOnboarding:()=>this._params.dapiActions.modifyCheetahOnboardingState((()=>xe.Z.encode(xe.Z.State.empty)))})}_createOnboardingViewModelWhenCheetahAvailable(){return V.h.combine(this._params.featureFlags,this._assistantServices.genAIAvailabilityService.availability.view(Ie._.isUsable),((e,t)=>e.onboarding&&t)).pipe(A.b((e=>this._onboardingViewModels.modify((t=>((0,l.zG)(t,D.bw((e=>e.onboarding.dispose()))),e?j.some(this._assistantServices.createOnboardingViewModels()):j.none))))))}_onClickIdeateButton(e){Xt(this.assistantState.get())?this._closeAssistant($e.j.closed):this._openAssistantSubject.next({mode:e})}_updateSelectionRange(){return x.aj([this._params.integration.selectionRange,this.assistantState.view(Xt)]).pipe(I.U((([e,t])=>({selectionRange:e,assistantIsFocused:this._assistantFocused.get(),inlineButtonRecentlyPressed:this._inlineButtonRecentlyPressed.get(),ideateButtonRecentlyHovered:this._ideateButtonRecentlyHovered.get(),initialPopupOnboardingStepIsActive:this.isOnboardingPopupVisible.get(),assistantOpened:t}))),A.b((({inlineButtonRecentlyPressed:e,ideateButtonRecentlyHovered:t})=>{e&&this._inlineButtonRecentlyPressed.set(!1),t&&this._ideateButtonRecentlyHovered.set(!1)})),S.h((({selectionRange:e,assistantIsFocused:t,inlineButtonRecentlyPressed:i,ideateButtonRecentlyHovered:s,initialPopupOnboardingStepIsActive:n,assistantOpened:a})=>!i&&!s&&(!a||(!j.isNone(e)||!t&&!n)))),I.U((({selectionRange:e})=>e)))}_updateHighlightRects(){return e=this._selectionRange,t=this._contextHighlight,i=this._params.integration,x.aj([e.pipe(_.w(j.fold((()=>R.of([])),(e=>i.getHighlightRects(e).pipe(I.U((e=>e.map((e=>({rect:e,visibility:"visible"})))))))))),t.pipe(_.w(j.fold((()=>R.of([])),(e=>i.getHighlightRects(e.range).pipe(I.U((t=>t.map((t=>({rect:t,visibility:e.visibility}))))))))))]).pipe(I.U((([e,t])=>t.find((e=>"hidden"!==e.visibility))?t:e)));var e,t,i}_updateQuasiCaretRect(){return x.aj([this._selectionRange,this._highlightsUpdater.hasHighlights]).pipe(_.w((([e,t])=>(0,l.zG)(e,j.filter((()=>!this._params.supportsRevision||!t)),j.filter(h.SV.isCollapsed),j.fold((()=>R.of([])),(e=>this._params.integration.getHighlightRects(e)))))),I.U((e=>(0,l.zG)(e,n.c2,j.map((e=>e[e.length-1]))))))}_updateNativeCursor(){return V.h.combine(this._quasiCaretRect,this.assistantState.view(Xt),((e,t)=>(0,l.zG)(s.Y(j.option)({nativeUIHider:j.fromNullable(this._params.integration.createNativeUIHider),quasiCaretRect:e}),j.filter((()=>t)),D.ew((()=>{this._nativeCursorHider.modify((e=>((0,l.zG)(e,D.bw((e=>e.dispose()))),j.none)))})),D.bw((({nativeUIHider:e})=>{this._nativeCursorHider.modify((t=>((0,l.zG)(t,D.bw((e=>e.dispose()))),j.some(e()))))})))))}_closeAssistant(e){var t;(0,l.zG)(this._assistantUIState.get(),D.bw((({dispose:e})=>e()))),this._assistantUIState.set(j.none),this._assistantUI.set(null),e!==$e.j.closed&&e!==$e.j.assistantBlurred||this._params.integration.focusTextField(),null===(t=this._params.assistantDidClose)||void 0===t||t.next()}_restartAssistant(){this._log.info("reconnecting checking service and restarting session"),(0,l.zG)(this._assistantUIState.get(),j.map((({sessionService:e})=>e.session.get().mode)),D.bw((e=>{this._closeAssistant($e.j.disposed),(0,l.zG)(this._params.checkingService.get(),D.bw((e=>{e.reconnect()}))),Ce.w.isPushRewrite(e)?this._openAssistantSubject.next({mode:"ideation"}):this._openAssistantSubject.next({mode:e})})))}async _openAssistant(e){var t;Xt(this.assistantState.get())&&this._closeAssistant($e.j.disposed),this._assistantFocused.set(!0),"pushRewrite"===e.mode&&this._selectionRange.set(j.some(e.transformRange));const i=new Ee.Z({logger:p.Y.create("cheetah.sessionService"),startSessionOptions:et(e,{disableKnowledgeEngine:"disabled"===this._params.dapiSettings.get().serengetiState||void 0},this._params.integration.quickReplyContext.get(),this._params.url),textEditorService:this._assistantServices.textEditorService,capiService:this._assistantServices.capiService,userService:this._assistantServices.userService,trackingService:this._assistantServices.trackingService,monitoringService:this._assistantServices.monitoringService,selectionContextAvailability:this._assistantServices.selectionContextAvailabilityService.availability,skillService:this._assistantServices.skillService,experimentService:this._assistantServices.experimentService}),s={openUrl:e=>(self.open(e,"_blank","noreferrer"),Promise.resolve())},{revisionEngine:n,dispose:a}=this._params.supportsRevision?await ut({capiService:this._assistantServices.capiService,textEditorService:this._assistantServices.textEditorService,sduiBufferService:this._params.sduiBufferService,lifecycleService:s,alertProcessor:this._params.alertProcessor,initialAlertId:Xe(e),highlightsUpdater:this._highlightsUpdater,highlightsScroller:this._highlightsScroller,replacementService:this._params.replacementService,getFormattingService:this._params.getFormattingService,requestAwaitService:this._params.requestAwaitService,alertStateService:this._params.alertStateService,domain:this._params.domain,getSessionUuid:()=>{var e,t;return null!==(t=null===(e=j.toNullable(this._params.checkingService.get()))||void 0===e?void 0:e.sessionUuid)&&void 0!==t?t:null},telemetry:this._params.telemetry,supportedForms:this._params.supportedForms}):{revisionEngine:void 0,dispose:l.Q1},r={logger:p.Y.create("cheetah.ui"),toneDetectorService:this._assistantServices.toneDetectorService,textEditorService:this._assistantServices.textEditorService,userService:this._assistantServices.userService,genAIAvailabilityService:this._assistantServices.genAIAvailabilityService,trackingService:this._assistantServices.trackingService,uphookService:this._assistantServices.uphookService,feedbackService:this._assistantServices.feedbackService,monitoringService:this._assistantServices.monitoringService,userSurveyService:this._assistantServices.userSurveyService,experimentService:this._assistantServices.experimentService,skillService:this._assistantServices.skillService,selectionContextAvailabilityService:this._assistantServices.selectionContextAvailabilityService,sessionService:i,revisionEngine:n,theme:V.h.create({flatUI:this._params.supportsRevision}),notifyAssistantUIAction:this._assistantServices.notifyAssistantUIAction,settingsOptions:this._params.supportsRevision?{kind:"withView",getView:()=>this._params.settingsService.getView()}:void 0};try{const e=await this._params.getHostInfo(),n=await this._params.integration.renderAssistant((({sizeBehavior:t,dragBehavior:n,readyToDrag:o})=>{const{assistantUI:l,dispose:c}=(0,Ue.e)({...r,lifecycleService:{...s,sizeBehavior:t,dragBehavior:n,readyToDrag:o,hostInfo:e,starting:()=>Promise.resolve(void 0),visuallyReady:()=>Promise.resolve(void 0),focusStateChanged:({isFocused:e})=>(this._assistantFocused.set(e),Promise.resolve()),close:()=>(this._closeAssistant($e.j.closed),Promise.resolve())}});return this._assistantUIState.set(j.some({sessionService:i,dragBehavior:B.D(n),dispose:()=>{a(),c(),i.dispose(),this._assistantFocused.set(!1)}})),l}));this._assistantUI.set(c.createElement(oe,null,n)),null===(t=this._params.assistantDidOpen)||void 0===t||t.next()}catch(e){this._log.error("failed to open assistant",e),this._assistantUIState.set(j.none),this._assistantUI.set(null)}}_getInlineButtonUI(){return(0,l.zG)(s.Y(o.P)({inlineButtonInfo:this._params.integration.inlineButtonPlacement,selectionRange:this._selectionRange,selectionOngoing:b.T(this._params.integration.selectionRange.pipe(I.U((e=>(0,l.zG)(e,j.isSome)))),this._params.integration.selectionRange.pipe(T.b(100),M.h(!1))),assistantOpened:this.assistantState.view(Xt),textMapIsEmpty:this._params.integration.textMapIsEmpty,quickReplyContext:this._params.integration.quickReplyContext,availability:this._assistantServices.genAIAvailabilityService.availability,entryPointsEnabled:this._entryPointsEnabled,featureFlags:this._params.featureFlags})).pipe(I.U((({inlineButtonInfo:e,selectionRange:t,selectionOngoing:i,assistantOpened:s,textMapIsEmpty:n,quickReplyContext:a,availability:r,entryPointsEnabled:o,featureFlags:h})=>(0,l.zG)(e,j.filter((()=>o)),j.filter((()=>!s)),j.filter((()=>Ie._.isUsable(r))),j.fold(l.gn,(e=>(0,l.zG)(t,j.fold(l.gn,(t=>n&&j.isSome(a)&&h.inlineQuickReply?c.createElement(he,{disabled:!1,referenceElement:e.referenceElement,placement:e.placement,offset:j.toNullable(e.offset),onClick:()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next({mode:"quickReply"})}}):si(t)&&(h.inlineRewrite||h.magicRewrite)&&this._params.integration.enableInlineRewrites?c.createElement(pe,{disabled:i,referenceElement:e.referenceElement,placement:e.placement,offset:j.toNullable(e.offset),onOpenRewriteClick:h.inlineRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next({mode:"rewrite"})}:void 0,onMagicRewriteClick:h.magicRewrite?()=>{this._inlineButtonRecentlyPressed.set(!0),this._openAssistantSubject.next({mode:"quickRewrite"})}:void 0}):null)))))))))}_getOnboardingUI(){return this._onboardingViewModels.view(j.fold(l.gn,(e=>c.createElement(oe,null,L.UI.mount(ke.T,(0,Be.A)(e))))))}_getHighlightUI(){return V.h.combine(this._highlights,this.assistantState.view(Xt),this._assistantFocused,((e,t,i)=>t&&i?e.map((({rect:e,visibility:t},i)=>c.createElement(Z,{key:`cheetah-highlight-rect-${i}`,top:e.top,left:e.left,width:e.width,height:e.height,visibility:t}))):null))}_getQuasiCaretUI(){return V.h.combine(this._quasiCaretRect,this.assistantState.view(Xt),((e,t)=>(0,l.zG)(e,j.filter((()=>t)),j.fold((()=>null),(e=>c.createElement(be,{left:e.left,top:e.top,height:e.height,overflow:this._params.integration.allowCustomCaretOverflow}))))))}_getIdeateButtonUI(){return V.h.combine(this._params.featureFlags,this._inlineButtonUI,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._entryPointsEnabled,((e,t,i,s,n,a)=>(0,l.zG)(t,j.fromPredicate((e=>null===e)),j.filter((()=>a&&e.ideateButton)),j.filter((()=>Ie._.isUsable(n))),j.fold(l.gn,(()=>this._getIdeateButtonForSelectionRange(i,s,e))))))}_getExpandedIdeateButtonUI(){return this._params.supportsRevision?V.h.create(null):V.h.combine(this._params.featureFlags,this._selectionRange,this._params.integration.quickReplyContext,this._assistantServices.genAIAvailabilityService.availability,this._entryPointsEnabled,((e,t,i,s,n)=>(0,l.zG)(s,j.fromPredicate((e=>Ie._.isVisible(e))),j.filter((()=>n&&e.ideateButton)),j.fold(l.gn,(()=>this._getIdeateButtonForSelectionRange(t,i,e))))))}_getIdeateButtonForSelectionRange(e,t,i){return this._params.supportsRevision?null:(0,l.zG)(e,j.filter((e=>si(e)&&i.rewrite)),j.fold((()=>ti(t)&&i.quickReply?"quickReply":i.compose?"ideation":null),(()=>"rewrite")),j.fromNullable,j.fold(l.gn,(e=>c.createElement(Qt,{onMouseEnter:()=>this._ideateButtonRecentlyHovered.set(!0),onMouseLeave:()=>this._ideateButtonRecentlyHovered.set(!1),onClick:()=>this._onClickIdeateButton(e),mount:e=>this._ideateButtonRefChange.next(e),forceTooltipMessage:this._ideateButtonTooltipNotificationState.view(j.toUndefined)}))))}_insertText(e){""!==e?this._params.integration.insertText(e,this._selectionRange.get()):this._log.warn("insert() - attempting to insert empty response, skipping insert.")}dispose(){var e;this._disposed.next(null),this._highlightsUpdater.dispose(),this._closeAssistant($e.j.disposed),null===(e=j.toUndefined((0,l.zG)(this._onboardingViewModels.get(),j.map((e=>e.onboarding)))))||void 0===e||e.dispose(),this._assistantServices.dispose(),this._subs.unsubscribe(),(0,l.zG)(this._nativeCursorHider.get(),D.bw((e=>e.dispose()))),this._params.integration.dispose()}}function ti(e){return(0,l.zG)(e,j.exists((e=>Object.values(e).filter((e=>void 0!==e)).length>0)))}function ii(e){return e.isConnected&&null!==e.offsetParent}function si(e){const t=e.end-e.start;return t>=10&&t<5e3}function ni(e){return(0,H.W9)(Re.l.is(Re.l.Kind.mount),(e=>e.step===Ae.T.StepName.initial))(e)}function ai(e){return(0,H.W9)(Re.l.is(Re.l.Kind.mount),(e=>e.step===Ae.T.StepName.initialBTS))(e)}},67534:(e,t,i)=>{i.d(t,{B:()=>o,g:()=>r});var s=i(17528),n=i(48015),a=i(36991);const r=e=>e.reduce((({actions:e,index:t},i)=>{const s=e[0];return a.s.isInsertString(i)?(e.unshift({pos:{start:t,end:t},value:i.insert}),{actions:e,index:t}):a.s.isInsertEmbed(i)?{actions:e,index:t+1}:a.s.isRetain(i)?{actions:e,index:t+i.retain}:a.s.isDelete(i)?(s&&s.pos.start===s.pos.end&&s.pos.end===t?s.pos={...s.pos,end:s.pos.end+i.delete}:e.unshift({pos:{start:t,end:t+i.delete},value:""}),{actions:e,index:t+i.delete}):void(0,n.vE)(i)}),{actions:[],index:0}).actions.reduce(((e,t)=>(e.length&&e[e.length-1].value&&e[e.length-1].pos.start===t.pos.start?e[e.length-1].value=`${t.value}${e[e.length-1].value}`:e.push(t),e)),[]),o=e=>e.reduce((({formattings:e,index:t},i)=>s.m.hasFormatting(i)?a.s.isInsertString(i)?(e.push({range:{start:t,end:"\n"===i.insert?t:t+i.insert.length},formatting:i.attributes}),{formattings:e,index:t+i.insert.length}):a.s.isInsertEmbed(i)?{formattings:e,index:t+1}:a.s.isRetain(i)?(e.push({range:{start:t,end:t+i.retain},formatting:i.attributes}),{formattings:e,index:t+i.retain}):{formattings:e,index:t}:a.s.isInsertString(i)?{formattings:e,index:t+i.insert.length}:a.s.isInsertEmbed(i)?{formattings:e,index:t+1}:a.s.isRetain(i)?{formattings:e,index:t+i.retain}:a.s.isDelete(i)?{formattings:e,index:t}:void(0,n.vE)(i)),{formattings:[],index:0}).formattings},88571:(e,t,i)=>{i.d(t,{Q:()=>l});var s=i(27378),n=i(15073),a=i(60797),r=i(95300),o=i(5114);const l=({children:e,remSize:t,setter:i})=>(c+=1,s.useEffect((()=>{const e=t.subscribe((e=>{h.next(o.some(e)),i(o.some(e))}));return()=>{e.unsubscribe(),c-=1,0===c&&(h.next(o.none),i(o.none))}}),[t]),s.createElement(n.u.Context.Provider,{value:h.pipe(a.oA)},e));let c=0;const h=new r.X(o.none)},57757:(e,t,i)=>{i.d(t,{v:()=>a});var s=i(44586),n=i(95195);function a(e,t=self){return new s.y((i=>{var s,a;(null===(a=null===(s=t.navigator)||void 0===s?void 0:s.clipboard)||void 0===a?void 0:a.writeText)?t.navigator.clipboard.writeText(e).then((()=>i.next(n.right(void 0)))).catch((e=>i.next(n.left(new Error(String(e)))))):i.next(n.left(new Error("The Clipboard API is not available.")))}))}},51325:e=>{e.exports={highlightRect:"XWxTA",hidden:"o979x",attention:"bHjcD",blink:"oy7wj"}},16805:e=>{e.exports={ideateButton:"_ErYR",ideateButtonIcon:"i8HXG",spin:"CSZH1"}},87491:e=>{e.exports={entryButton:"cDocn",entryButtonItem:"dJCJe",rewriteIcon:"wGNWN",openIcon:"vIUqu",spin:"A8MjA"}},50783:e=>{e.exports={replyButton:"ZfD1U",icon:"BdxRh",spin:"MBS28"}},48033:e=>{e.exports={quasiCaret:"WhbAl",icon:"Yd_W5"}}}]);