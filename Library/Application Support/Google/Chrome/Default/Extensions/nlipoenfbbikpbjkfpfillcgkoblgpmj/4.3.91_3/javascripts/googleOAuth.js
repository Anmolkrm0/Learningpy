var googleOAuth={clientId:"934696770472-j7vpq5hjkgke5599r0jacuh95ekhga85.apps.googleusercontent.com",clientSecret:"wrVV86YTdcrqYtct2BRapBpm",redirectURL:"https://www.awesomescreenshot.com/google_auth_extension",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/youtube.upload","https://www.googleapis.com/auth/drive.file"],oauthBaseURL:"https://accounts.google.com/o/oauth2/v2/auth",accessTokenURL:"https://www.googleapis.com/oauth2/v4/token",userInfoURL:"https://www.googleapis.com/oauth2/v2/userinfo",autherize:function(e){var t=this,o=this._get();!o.accessToken||this._is30DaysLater()?(this.callback=e,this._openAuthorizationCodePopup()):this._isAccessTokenExpired()?o.refreshToken?this._refreshAccessToken(o.refreshToken,(function(o,s){var n=t._get();n.accessTokenDate=(new Date).valueOf(),n.accessToken=o,n.expiresIn=s,t._saveToLocalStorage(n),e&&e(o)}),(function(){t.callback=e,t._openAuthorizationCodePopup()})):(this.callback=e,this._openAuthorizationCodePopup()):e&&e(o.accessToken)},finishAuth:function(e){var t=this,o=null;try{o=this._parseAuthorizationCode(e)}catch(e){this.callback&&this.callback(e)}this._getAccessAndRefreshTokens(o,(function(e){var o=t._get();for(var s in o.accessTokenDate=(new Date).valueOf(),e)e.hasOwnProperty(s)&&e[s]&&(o[s]=e[s]);t._getUserInfo(o,(function(e){t._saveToLocalStorage(e),t.callback&&t.callback(e.accessToken)}))}))},getAccount:function(){return this._get()},clearAccount:function(){localStorage.removeItem("google_oauth")},_getUserInfo:function(e,t){var o=new XMLHttpRequest;o.open("GET",this.userInfoURL),o.setRequestHeader("Authorization","OAuth "+e.accessToken),o.onreadystatechange=function(){if(4==this.readyState){var s=JSON.parse(o.response);e.email=s.email,t(e)}},o.send()},_saveToLocalStorage:function(e,t){"string"!=typeof e&&(e=JSON.stringify(e)),localStorage.google_oauth=e},_parseAuthorizationCode:function(e){var t=(e=decodeURIComponent(e)).match(/[&\?]error=([^&]+)/);if(t)throw"Error getting authorization code: "+t[1];return e.match(/.+?code=([\w\/\-]+)/)[1]},_parseAccessToken:function(e){var t=JSON.parse(e);return{accessToken:t.access_token,refreshToken:t.refresh_token,expiresIn:t.expires_in}},_getAccessAndRefreshTokens:function(e,t){var o=this,s=new XMLHttpRequest;s.addEventListener("readystatechange",(function(e){4==s.readyState&&200==s.status&&t(o._parseAccessToken(s.responseText))}));var n={code:e,client_id:o.clientId,client_secret:o.clientSecret,redirect_uri:o.redirectURL,grant_type:"authorization_code"},a=null,c=new FormData;for(a in n)c.append(a,n[a]);s.open("POST",o.accessTokenURL,!0),s.send(c)},_getAuthUrl:function(){return(this.oauthBaseURL+"?client_id={{CLIENT_ID}}&redirect_uri={{REDIRECT_URI}}&scope={{API_SCOPE}}&access_type=offline&response_type=code&prompt=consent").replace("{{CLIENT_ID}}",this.clientId).replace("{{REDIRECT_URI}}",this.redirectURL).replace("{{API_SCOPE}}",this.scopes.join(" "))},_get:function(e){var t=localStorage.google_oauth,o=t?JSON.parse(t):{};return e?o[e]:o},_isAccessTokenExpired:function(){var e=this._get();return(new Date).valueOf()-e.accessTokenDate>1e3*e.expiresIn},_is30DaysLater:function(){var e=this._get();return!e.accessTokenDate||(new Date).valueOf()-e.accessTokenDate>1728e6},_openAuthorizationCodePopup:function(){chrome.tabs.create({url:this._getAuthUrl()})},_refreshAccessToken:function(e,t,o){var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(4==s.readyState)if(200==s.status){var n=JSON.parse(s.responseText);t(n.access_token,n.expires_in)}else 400!==s.status&&401!=s.status||o&&o()};var n=new FormData;n.append("client_id",this.clientId),n.append("client_secret",this.clientSecret),n.append("refresh_token",e),n.append("grant_type","refresh_token"),s.open("POST",this.accessTokenURL,!0),s.send(n)}};function checkGoogleCallBackTab(e){chrome.tabs.get(e,(function(t){if(t&&/^https:\/\/www.awesomescreenshot.com\/google_auth_extension/.test(t.url)){var o=t.url,s="?",n=o.indexOf(s);n>-1&&(s=o.substring(n)),googleOAuth.finishAuth(s),chrome.tabs.remove(e)}}))}chrome.tabs.onUpdated.addListener((function(e,t,o){if(/^https:\/\/www.awesomescreenshot.com\/google_auth_extension/.test(t.url)){var s=t.url,n="?",a=s.indexOf(n);a>-1&&(n=s.substring(a)),googleOAuth.finishAuth(n),chrome.tabs.remove(e)}else t.url||checkGoogleCallBackTab(e)}));