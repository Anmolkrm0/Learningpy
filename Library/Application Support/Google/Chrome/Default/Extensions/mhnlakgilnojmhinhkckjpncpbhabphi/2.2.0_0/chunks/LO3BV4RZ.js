import{a as pe}from"./EFAAWHBD.js";import{a as D}from"./QZ23CPMF.js";import{a as de,b as ce}from"./XYIXPUO3.js";import{f as L,h as Ae}from"./HZY6G6NS.js";import"./NUBBX6Y3.js";import"./XGYN32GS.js";import"./Z3L7RW5H.js";import"./5QUJ6DKB.js";import"./FHOPNJBR.js";import"./4H6XCDWT.js";import"./ZLWHHAAC.js";import"./KV6T5ANA.js";import"./4M75FOZX.js";import"./WJHHHIFF.js";import{a as ne,b as le}from"./MJNORM6I.js";import{a as $}from"./K7PFX32G.js";import{a as k}from"./JHE5GVMS.js";import{a as H}from"./CGGBDVKK.js";import"./NFYTNHAT.js";import"./HXPONVFL.js";import"./CUWLSLUX.js";import{c as z}from"./CZZ5V5WB.js";import{a as me}from"./VEFNH7NE.js";import{a as K}from"./DGXYGUZ3.js";import{b as ae}from"./AVRUINLW.js";import{G as h,Y as ie,u as re}from"./QXSPNHGD.js";import{d as we,e as _e,h as W}from"./3NC6GYYS.js";import"./5O7EG2CD.js";import{c as F}from"./SBPSCB6O.js";import"./4565WM6X.js";import"./RBZSLUSE.js";import"./BJ4XCQYH.js";import"./RPTTQXMU.js";import"./ZDOLJC6M.js";import"./L33QHTPD.js";import"./EYWU5WEI.js";import{d as te,h as oe}from"./773OEKYN.js";import"./LLMPFG5R.js";import{c as R}from"./ZSF23SB7.js";import{d as ee}from"./SH2AV755.js";import"./SMO67HIN.js";import{a as E}from"./PGNR3OFA.js";import"./5EASWQBS.js";import{d as T}from"./BEC6NYYF.js";import{a as r,b as Y,u as d}from"./JUQUTDV2.js";import"./H3PWEBSP.js";import"./QZNWBGPK.js";import{j as Z}from"./QZVUH6Z4.js";import"./6NCLE6FY.js";import{i as se}from"./XNIWJ77D.js";import"./6LS5XNTR.js";import"./7ADITARJ.js";import"./WWJM5EAZ.js";import"./GDFPIX4S.js";import"./SJ3MEPLB.js";import"./3X42KLOD.js";import"./MT7GI5KY.js";import{c as I}from"./QPPETRF6.js";import{j as B}from"./BIAAAE54.js";import{p as X}from"./T463YMPS.js";import{L as Q,m as A}from"./LZHALC2F.js";import{a as b}from"./64D36THL.js";import"./3JX3VARJ.js";import{c as J,f}from"./PQ35KENF.js";var ge=J(P=>{"use strict";var Be=Y();Object.defineProperty(P,"__esModule",{value:!0});P.default=void 0;var Ee=Be(ee()),Fe=Z(),ze=(0,Ee.default)((0,Fe.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");P.default=ze});var Ce=J(N=>{"use strict";var We=Y();Object.defineProperty(N,"__esModule",{value:!0});N.default=void 0;var He=We(ee()),$e=Z(),qe=(0,He.default)((0,$e.jsx)("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"}),"Code");N.default=qe});var i=f(b());var u=f(b());var ue=f(ge()),fe=f(we());var De=["www.linkedin.com"],Le=a=>{let{onEdit:t,onSave:m,editAble:p,message:s}=a,{t:c}=I(["common","client"]),[o,l]=(0,u.useState)("done"),S=(0,u.useMemo)(()=>s.extra.meta?.messageVisibleText||s.text,[s]);return u.default.createElement(r,{direction:"row",alignItems:"center",width:"100%",justifyContent:"flex-end"},u.default.createElement(k,{copyText:S,onCopy:()=>{a.onCopy?.(),De.includes(window.location.host)&&setTimeout(B,1)}}),o==="done"&&p&&u.default.createElement(H,{title:c("common:edit"),onClick:()=>{t(),l("edit")}},u.default.createElement(ue.default,{sx:{fontSize:16}})),o==="edit"&&p&&u.default.createElement(H,{title:c("common:save"),onClick:()=>{m(),l("done")}},u.default.createElement(fe.default,{sx:{fontSize:16}})))},xe=Le;var x=f(b());var ye=f(_e());var Pe=["www.linkedin.com"],Ne=a=>{let{t}=I(["common","client"]),{message:m,insertAble:p}=a,s=(0,x.useMemo)(()=>p,[p]),c=x.default.useRef(null),o=(0,x.useMemo)(()=>{let l=m.originalMessage?.content?.text||m.text;if(m.originalMessage?.metadata?.sources?.links){l=l.replace(/\[\[(\d+)\]\([^)]+\)\]/g,"[$1]");let S=m.originalMessage.metadata.sources.links,w=`

Citations:`;S.length>0&&S.forEach((g,_)=>{w+=`
[${_+1}] ${g.url}`}),l+=w}return l},[m]);return x.default.createElement(r,{direction:"row",alignItems:"center",spacing:1,ref:c},s&&x.default.createElement(T,{disableElevation:!0,size:"small",variant:"contained",title:"insert to draft",startIcon:x.default.createElement(ye.default,null),onClick:()=>{}},t("client:sidebar__button__insert")),x.default.createElement(k,{className:"max-ai__actions__button--copy",copyText:o,onCopy:()=>{a.onCopy?.(),Pe.includes(window.location.host)&&setTimeout(B,1)}}),a.useChatGPTAble&&x.default.createElement(pe,{className:"max-ai__actions__button--use-max-ai",iconButton:!0,onBeforeShowContextMenu:()=>({template:o,target:c.current?.parentElement})}))},he=Ne;var M=f(b());var Ue=a=>{let{onRetry:t,message:m}=a,{t:p}=I(["common","client"]),{currentUserPlan:s,userInfo:c}=re(),o=m.extra.systemMessageType||"normal";return(0,M.useEffect)(()=>{o==="needUpgrade"&&s.name==="pro"&&ae("[Pricing] Pro show pricing card",JSON.stringify({message:m.text,user:c,plan:s}),{uuid:"7a04bc02-6155-4253-bcdb-ade3db6de492"})},[s.name,o]),M.default.createElement(r,{direction:"row",alignItems:"center",flexWrap:"wrap",gap:1},o==="needUpgrade"&&M.default.createElement(T,{fullWidth:!0,sx:{height:48,fontSize:"16px",fontWeight:500},variant:"contained",color:"primary",target:"_blank",href:`${Q}/pricing`,onClick:l=>{m.extra.systemMessageType==="needUpgrade"&&m.extra.permissionSceneType&&ie("click",m.extra.permissionSceneType)}},p("client:sidebar__button__upgrade_to_pro")),o==="normal"&&m.parentMessageId&&M.default.createElement(T,{size:"small",variant:"outlined",color:"error",onClick:t,sx:{border:"1px solid rgba(244, 67, 54, 0.5)",color:"#f44336"}},p("client:sidebar__button__retry")))},Se=Ue;var y=f(b());var be=f(Ce());var Oe=({message:a})=>{let t=(0,y.useMemo)(()=>JSON.stringify(a,null,2),[a]);return y.default.createElement(D,null,y.default.createElement(E,{position:"absolute",top:16,left:16},y.default.createElement(oe,{title:y.default.createElement(r,null,y.default.createElement("pre",{style:{fontSize:"12px"}},t),y.default.createElement(k,{copyText:t}))},y.default.createElement(be.default,null))))},Ie=Oe;var e=f(b());var je=a=>{let{message:t,isDarkMode:m}=a,p=t.originalMessage!==void 0,s=(0,e.useMemo)(()=>{let o={title:t.originalMessage?.metadata?.title,quickSearch:t.originalMessage?.metadata?.quickSearch,sources:t.originalMessage?.metadata?.sources,sourcesLoading:t.originalMessage?.metadata?.sources?.status==="loading",answer:t.text,content:t.originalMessage?.content,messageIsComplete:!t.originalMessage?.metadata?.isComplete};return t.originalMessage?.content?.text&&(o.answer=ne(t.originalMessage.content.text,{noResponseTag:!0,noSummaryTag:!0})||t.text),o.answer=o.answer.replace(/^\s+/,""),o},[t]),c=(0,e.useMemo)(()=>!s.answer,[s.answer]);return e.default.createElement(e.default.Fragment,null,p?e.default.createElement(r,{spacing:2},s.title&&e.default.createElement(d,{sx:{fontWeight:"bold",fontSize:28}},s.title),s.quickSearch&&e.default.createElement(r,{spacing:1},e.default.createElement(r,{direction:"row",alignItems:"center",spacing:1},e.default.createElement(r,{alignItems:"center",justifyContent:"center",width:16,height:16},e.default.createElement(W,{sx:{color:"primary.main",fontSize:24},icon:"Bolt"})),e.default.createElement(d,{sx:{color:"primary.main",fontSize:18}},"Quick search")),e.default.createElement(r,{spacing:1},s.quickSearch.map(o=>e.default.createElement(r,{key:o.status+o.title,spacing:.5},e.default.createElement(r,{spacing:1,direction:"row",alignItems:"center"},e.default.createElement(r,{alignItems:"center",justifyContent:"center",width:16,height:16},o.status==="loading"&&!s.messageIsComplete?e.default.createElement(F,{size:16}):e.default.createElement(W,{sx:{color:"primary.main",fontSize:16},icon:o.icon})),e.default.createElement(d,{fontSize:16,color:"text.primary",noWrap:!0,sx:{p:0}},o.title)),o.value&&e.default.createElement(r,{spacing:1,direction:"row",alignItems:"center"},e.default.createElement(r,{alignItems:"center",justifyContent:"center",width:16,height:16}),X(o.value)&&o.value.map(l=>e.default.createElement(z,{key:l,variant:"outlined",sx:{px:1}},e.default.createElement(d,{fontSize:14,color:"text.primary"},l))),typeof o.value=="string"&&e.default.createElement(z,{variant:"outlined",sx:{px:1}},e.default.createElement(d,{fontSize:14,color:"text.primary"},o.value))))))),s.sources&&e.default.createElement(r,{spacing:1},e.default.createElement(r,{direction:"row",alignItems:"center",spacing:1},s.sourcesLoading&&!s.messageIsComplete?e.default.createElement(F,{size:18}):e.default.createElement(ce,{sx:{color:"primary.main",fontSize:20}}),e.default.createElement(d,{sx:{color:"primary.main",fontSize:18}},"Sources")),s.sources.links&&e.default.createElement(L,{container:!0,spacing:1,sx:{ml:"-8px!important"}},s.sourcesLoading?Array(se).fill("").map((o,l)=>e.default.createElement(L,{item:!0,xs:6,key:l},e.default.createElement(h,{variant:"rounded",width:"100%",height:60}))):s.sources.links.map((o,l)=>e.default.createElement(L,{item:!0,xs:6,key:o.title},e.default.createElement(z,{variant:"outlined"},e.default.createElement(R,{href:o.url,target:"_blank",underline:"none"},e.default.createElement(r,{p:1,spacing:.5},e.default.createElement(d,{fontSize:14,color:"text.primary",noWrap:!0,sx:{p:0}},o.title),e.default.createElement(r,{direction:"row",alignItems:"center",spacing:.5},e.default.createElement(E,{width:16,height:16,borderRadius:"50%",overflow:"hidden",flexShrink:0},e.default.createElement("img",{src:o.favicon,alt:o?.from,width:"100%",height:"100%"})),e.default.createElement(d,{fontSize:12,color:"text.secondary",noWrap:!0},o?.from),e.default.createElement(d,{fontSize:12,color:"text.secondary",flexShrink:0},"\xB7 ",l+1))))))))),s.content&&e.default.createElement(r,null,s.messageIsComplete?e.default.createElement(r,{direction:"row",alignItems:"center",spacing:1},e.default.createElement(F,{size:18}),e.default.createElement(d,{sx:{color:"primary.main",fontSize:18,lineHeight:"20px"}},"Writing")):e.default.createElement(r,{direction:"row",alignItems:"center",spacing:1},e.default.createElement(de,{sx:{color:"primary.main",fontSize:20}}),e.default.createElement(d,{sx:{color:"primary.main",fontSize:18,lineHeight:"20px"}},"Answer")),c?e.default.createElement(r,null,e.default.createElement(h,{animation:"wave",height:10}),e.default.createElement(h,{animation:"wave",height:10}),e.default.createElement(h,{animation:"wave",height:10}),e.default.createElement(h,{animation:"wave",height:10}),e.default.createElement(h,{animation:"wave",height:10}),e.default.createElement(h,{animation:"wave",height:10})):e.default.createElement("div",{className:`markdown-body ${m?"markdown-body-dark":""}`},e.default.createElement($,null,s.answer)))):e.default.createElement("div",{className:`markdown-body ${m?"markdown-body-dark":""}`},e.default.createElement($,null,s.answer)))},ke=je;var Ge=i.default.lazy(()=>import("./NVMJ527B.js")),Me=a=>a.type==="system"?a.text:a?.extra?.meta?.messageVisibleText||a.text||"",Ve=a=>{let{message:t,editAble:m,insertAble:p,replaceAble:s,useChatGPTAble:c,onSave:o,onCopy:l,onRetry:S,className:w}=a,{isDarkMode:g}=K(),[_,ve]=(0,i.useState)(()=>Me(t)),[q,O]=(0,i.useState)(!1),[j,G]=(0,i.useState)(!1),v=(0,i.useRef)(null),Te=(0,i.useMemo)(()=>{let n=j?{"& *":{userSelect:"text!important"}}:{"& *":{userSelect:"none!important"}};return t.type==="ai"?{borderRadius:"8px",borderBottomLeftRadius:0,color:g?"#FFFFFFDE":"rgba(0,0,0,0.87)",border:"1px solid",borderColor:g?"customColor.borderColor":"transparent",bgcolor:g?"rgba(255, 255, 255, 0.04)":"rgb(233,233,235)!important",...n}:t.type==="user"||t.type==="third"?{flexDirection:"row",justifyContent:"flex-start",bgcolor:()=>g?"#6B23C259 !important":"#F1E2FD !important",border:"1px solid",borderColor:g?"customColor.borderColor":"transparent",color:g?"#FFFFFFDE":"rgba(0,0,0,0.87)!important",maxWidth:"100%",width:"auto",borderRadius:"8px",borderBottomRightRadius:0,flexWrap:"wrap",ml:"auto",mr:"0",overflow:"hidden",p:1,...n}:t?.extra?.systemMessageType==="needUpgrade"?{borderRadius:"8px",bgcolor:"#333","& > div":{maxWidth:450,bgcolor:"#333",padding:0,"& *":{color:"#FFFFFF!important"}},...n}:{borderRadius:"8px",border:{info:"1px solid #03a9f4!important",error:"1px solid rgb(239, 83, 80)!important",success:"1px solid #34A853!important"}[t?.extra?.status]||"1px solid #03a9f4!important",bgcolor:"background.paper",...n}},[t.type,j,g]);(0,i.useEffect)(()=>{ve(Me(t))},[t.text]);let V=(0,i.useMemo)(()=>{if(t.type==="user"){let n=t?.extra?.meta?.attachments;if(n&&n.length)return n.filter(C=>C.uploadStatus==="success")}return[]},[t]);return i.default.createElement(r,{className:w,sx:{width:"100%",p:1,color:"text.primary",position:"relative","& .chat-message--text":{textAlign:"left",fontSize:"16px",lineHeight:1.4,fontWeight:400}},onCopy:n=>{n.preventDefault(),n.stopPropagation();let C=window.getSelection();if(C&&C.toString().trim()){let U=C.toString().trim();U&&navigator.clipboard.writeText(U)}},onMouseEnter:()=>{v.current&&clearTimeout(v.current),G(!0)},onMouseLeave:()=>{v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{G(!1);let n=window.getSelection();n&&n.toString().trim()&&n.focusNode&&n.focusNode.isSameNode(document.body)&&n.removeAllRanges()},500)},spacing:1,key:t.messageId},i.default.createElement(D,null,i.default.createElement(Ie,{message:t})),i.default.createElement(r,{className:"chat-message--text",whiteSpace:"pre-wrap",width:"100%",spacing:1,p:1,sx:{wordBreak:"break-word",...Te}},i.default.createElement(me,null,t.type==="system"?i.default.createElement(te,{severity:t?.extra?.status||"info",sx:{p:1,"& .MuiAlert-message":{p:0},"& > div:first-child":{display:"none"},"& .markdown-body":{"& > p:first-child":{mt:0}}},icon:i.default.createElement(i.default.Fragment,null)},i.default.createElement("div",{className:`markdown-body ${g?"markdown-body-dark":""}`},i.default.createElement(Ge,null,_.replace(/^\s+/,"")))):i.default.createElement(r,{className:"chat-message--text",id:`${A}_chat_message_${t.messageId}`,contentEditable:q,whiteSpace:"pre-wrap",sx:{wordBreak:"break-word",borderColor:"primary.main",borderStyle:"solid",borderWidth:q?1:0}},t.type==="user"&&V.length>0&&i.default.createElement(le,{size:"small",direction:"row",disabledRemove:!0,sx:{mb:1},files:V}),t.type==="user"&&_.replace(/^\s+/,""),(t.type==="third"||t.type==="ai")&&i.default.createElement(ke,{isDarkMode:g,message:t}))),t.type==="user"&&i.default.createElement(xe,{editAble:m,onCopy:l,message:t,onSave:()=>{O(!1);let n=document.getElementById(`${A}_chat_message_${t.messageId}`);o&&o(n?.innerText||t.text||"")},onEdit:()=>{O(!0),setTimeout(()=>{let n=document.getElementById(`${A}_chat_message_${t.messageId}`);n&&n.focus()},0)}}),t.type==="ai"&&i.default.createElement(he,{insertAble:p,replaceAble:s,useChatGPTAble:c,onCopy:l,message:t}),t.type==="system"&&i.default.createElement(Se,{onRetry:()=>{t.parentMessageId&&S&&S(t.parentMessageId)},message:t})))},Kt=Ve;export{Kt as default};
