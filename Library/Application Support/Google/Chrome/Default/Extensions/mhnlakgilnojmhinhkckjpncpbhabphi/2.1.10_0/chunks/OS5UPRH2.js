import{a as uo}from"./66EZUONK.js";import{a as Rn}from"./SYP23LOT.js";import{a as ao,c as ur,d as co,e as fr,h as lo}from"./4NAB6M5G.js";import{a as qr}from"./UTNIZF65.js";import{b as zr}from"./TCYBICPB.js";import{A as Gr,B as Yn,Ba as ro,Eb as so,Ha as no,Ia as oo,P as Xe,X as Jn,b as Gn,cb as dt,d as Le,e as zn,ea as to,g as sr,h as Hr,jb as Oe,m as Br,n as Vn,p as Ut,q as ar,r as $n,s as Qn,w as cr,x as jn,z as lr}from"./V4ZRBBRM.js";import{g as eo}from"./FHWSD74W.js";import{O as Kn,P as Xn,fa as io}from"./OSRZ6DNI.js";import{c as Fr,d as Hn,e as nr,f as or,g as Ke}from"./KGHUEQWQ.js";import{i as Zn}from"./NDPIADS7.js";import{d as Mi}from"./AWXXSJ4S.js";import{a as Nr}from"./PZ6W2FT2.js";import{d as Bn}from"./RU4PPZ26.js";import{a as ir,b as Pi}from"./SOBQVLGH.js";import{j as wi}from"./QZVUH6Z4.js";import{a as Wn}from"./4XTFPKLI.js";import{D as Fn,E as rr,R as Nn,a as it,c as Un,j as Dn,p as kr,t as kn}from"./LW65P6WP.js";import{c as qn}from"./QPPETRF6.js";import{d as In,e as _n,f as Yt,g as wn,i as Pn,k as Mn,m as Dr,n as Ln,p as On,r as Zt,t as je}from"./3QCQTR6Z.js";import{M as Qe,O as Sn,P as Me,e as bn,p as Ur}from"./TLLLFF6C.js";import{G as Cn,H as Or,K as Rr,T as er,U as vn,c as An,e as ft,f as Tn,k as En,p as Rt,q as Xt,u as xn}from"./H75Y2WTH.js";import{a as Wt}from"./64D36THL.js";import{c as _t,f as bt,h as z}from"./PQ35KENF.js";var zi=_t(mr=>{"use strict";var Hi=Pi();Object.defineProperty(mr,"__esModule",{value:!0});mr.default=void 0;var Bi=Hi(Mi()),Gi=wi(),qi=(0,Bi.default)((0,Gi.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");mr.default=qi});var Ho=_t(dr=>{"use strict";dr.byteLength=Yi;dr.toByteArray=Ji;dr.fromByteArray=rs;var Nt=[],Mt=[],Xi=typeof Uint8Array<"u"?Uint8Array:Array,Yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(pe=0,Fo=Yr.length;pe<Fo;++pe)Nt[pe]=Yr[pe],Mt[Yr.charCodeAt(pe)]=pe;var pe,Fo;Mt["-".charCodeAt(0)]=62;Mt["_".charCodeAt(0)]=63;function No(s){var r=s.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=s.indexOf("=");o===-1&&(o=r);var e=o===r?0:4-o%4;return[o,e]}function Yi(s){var r=No(s),o=r[0],e=r[1];return(o+e)*3/4-e}function Zi(s,r,o){return(r+o)*3/4-o}function Ji(s){var r,o=No(s),e=o[0],t=o[1],n=new Xi(Zi(s,e,t)),i=0,a=t>0?e-4:e,f;for(f=0;f<a;f+=4)r=Mt[s.charCodeAt(f)]<<18|Mt[s.charCodeAt(f+1)]<<12|Mt[s.charCodeAt(f+2)]<<6|Mt[s.charCodeAt(f+3)],n[i++]=r>>16&255,n[i++]=r>>8&255,n[i++]=r&255;return t===2&&(r=Mt[s.charCodeAt(f)]<<2|Mt[s.charCodeAt(f+1)]>>4,n[i++]=r&255),t===1&&(r=Mt[s.charCodeAt(f)]<<10|Mt[s.charCodeAt(f+1)]<<4|Mt[s.charCodeAt(f+2)]>>2,n[i++]=r>>8&255,n[i++]=r&255),n}function ts(s){return Nt[s>>18&63]+Nt[s>>12&63]+Nt[s>>6&63]+Nt[s&63]}function es(s,r,o){for(var e,t=[],n=r;n<o;n+=3)e=(s[n]<<16&16711680)+(s[n+1]<<8&65280)+(s[n+2]&255),t.push(ts(e));return t.join("")}function rs(s){for(var r,o=s.length,e=o%3,t=[],n=16383,i=0,a=o-e;i<a;i+=n)t.push(es(s,i,i+n>a?a:i+n));return e===1?(r=s[o-1],t.push(Nt[r>>2]+Nt[r<<4&63]+"==")):e===2&&(r=(s[o-2]<<8)+s[o-1],t.push(Nt[r>>10]+Nt[r>>4&63]+Nt[r<<2&63]+"=")),t.join("")}});var qo=_t((hf,Go)=>{function Lt(s,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(s)),this._timeouts=s,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Go.exports=Lt;Lt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Lt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Lt.prototype.retry=function(s){if(this._timeout&&clearTimeout(this._timeout),!s)return!1;var r=new Date().getTime();if(s&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(s),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(s);var o=this._timeouts.shift();if(o===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),o=this._cachedTimeouts.slice(-1);else return!1;var e=this;return this._timer=setTimeout(function(){e._attempts++,e._operationTimeoutCb&&(e._timeout=setTimeout(function(){e._operationTimeoutCb(e._attempts)},e._operationTimeout),e._options.unref&&e._timeout.unref()),e._fn(e._attempts)},o),this._options.unref&&this._timer.unref(),!0};Lt.prototype.attempt=function(s,r){this._fn=s,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var o=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){o._operationTimeoutCb()},o._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Lt.prototype.try=function(s){this.attempt(s)};Lt.prototype.start=function(s){this.attempt(s)};Lt.prototype.start=Lt.prototype.try;Lt.prototype.errors=function(){return this._errors};Lt.prototype.attempts=function(){return this._attempts};Lt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var s={},r=null,o=0,e=0;e<this._errors.length;e++){var t=this._errors[e],n=t.message,i=(s[n]||0)+1;s[n]=i,i>=o&&(r=t,o=i)}return r}});var zo=_t(he=>{var as=qo();he.operation=function(s){var r=he.timeouts(s);return new as(r,{forever:s&&(s.forever||s.retries===1/0),unref:s&&s.unref,maxRetryTime:s&&s.maxRetryTime})};he.timeouts=function(s){if(s instanceof Array)return[].concat(s);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var o in s)r[o]=s[o];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],t=0;t<r.retries;t++)e.push(this.createTimeout(t,r));return s&&s.forever&&!e.length&&e.push(this.createTimeout(t,r)),e.sort(function(n,i){return n-i}),e};he.createTimeout=function(s,r){var o=r.randomize?Math.random()+1:1,e=Math.round(o*Math.max(r.minTimeout,1)*Math.pow(r.factor,s));return e=Math.min(e,r.maxTimeout),e};he.wrap=function(s,r,o){if(r instanceof Array&&(o=r,r=null),!o){o=[];for(var e in s)typeof s[e]=="function"&&o.push(e)}for(var t=0;t<o.length;t++){var n=o[t],i=s[n];s[n]=function(f){var p=he.operation(r),c=Array.prototype.slice.call(arguments,1),l=c.pop();c.push(function(u){p.retry(u)||(u&&(arguments[0]=p.mainError()),l.apply(this,arguments))}),p.attempt(function(){f.apply(s,c)})}.bind(s,i),s[n].options=r}}});var Vo=_t((gf,Wo)=>{Wo.exports=zo()});var Qo=_t((yf,yr)=>{"use strict";var cs=Vo(),ls=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],gr=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}},us=(s,r,o)=>{let e=o.retries-(r-1);return s.attemptNumber=r,s.retriesLeft=e,s},fs=s=>ls.includes(s),$o=(s,r)=>new Promise((o,e)=>{r={onFailedAttempt:()=>{},retries:10,...r};let t=cs.operation(r);t.attempt(async n=>{try{o(await s(n))}catch(i){if(!(i instanceof Error)){e(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof gr)t.stop(),e(i.originalError);else if(i instanceof TypeError&&!fs(i.message))t.stop(),e(i);else{us(i,n,r);try{await r.onFailedAttempt(i)}catch(a){e(a);return}t.retry(i)||e(t.mainError())}}})});yr.exports=$o;yr.exports.default=$o;yr.exports.AbortError=gr});var Ko=_t((Af,tn)=>{"use strict";var ms=Object.prototype.hasOwnProperty,Tt="~";function Ze(){}Object.create&&(Ze.prototype=Object.create(null),new Ze().__proto__||(Tt=!1));function ps(s,r,o){this.fn=s,this.context=r,this.once=o||!1}function jo(s,r,o,e,t){if(typeof o!="function")throw new TypeError("The listener must be a function");var n=new ps(o,e||s,t),i=Tt?Tt+r:r;return s._events[i]?s._events[i].fn?s._events[i]=[s._events[i],n]:s._events[i].push(n):(s._events[i]=n,s._eventsCount++),s}function Ar(s,r){--s._eventsCount===0?s._events=new Ze:delete s._events[r]}function gt(){this._events=new Ze,this._eventsCount=0}gt.prototype.eventNames=function(){var r=[],o,e;if(this._eventsCount===0)return r;for(e in o=this._events)ms.call(o,e)&&r.push(Tt?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(o)):r};gt.prototype.listeners=function(r){var o=Tt?Tt+r:r,e=this._events[o];if(!e)return[];if(e.fn)return[e.fn];for(var t=0,n=e.length,i=new Array(n);t<n;t++)i[t]=e[t].fn;return i};gt.prototype.listenerCount=function(r){var o=Tt?Tt+r:r,e=this._events[o];return e?e.fn?1:e.length:0};gt.prototype.emit=function(r,o,e,t,n,i){var a=Tt?Tt+r:r;if(!this._events[a])return!1;var f=this._events[a],p=arguments.length,c,l;if(f.fn){switch(f.once&&this.removeListener(r,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,o),!0;case 3:return f.fn.call(f.context,o,e),!0;case 4:return f.fn.call(f.context,o,e,t),!0;case 5:return f.fn.call(f.context,o,e,t,n),!0;case 6:return f.fn.call(f.context,o,e,t,n,i),!0}for(l=1,c=new Array(p-1);l<p;l++)c[l-1]=arguments[l];f.fn.apply(f.context,c)}else{var u=f.length,m;for(l=0;l<u;l++)switch(f[l].once&&this.removeListener(r,f[l].fn,void 0,!0),p){case 1:f[l].fn.call(f[l].context);break;case 2:f[l].fn.call(f[l].context,o);break;case 3:f[l].fn.call(f[l].context,o,e);break;case 4:f[l].fn.call(f[l].context,o,e,t);break;default:if(!c)for(m=1,c=new Array(p-1);m<p;m++)c[m-1]=arguments[m];f[l].fn.apply(f[l].context,c)}}return!0};gt.prototype.on=function(r,o,e){return jo(this,r,o,e,!1)};gt.prototype.once=function(r,o,e){return jo(this,r,o,e,!0)};gt.prototype.removeListener=function(r,o,e,t){var n=Tt?Tt+r:r;if(!this._events[n])return this;if(!o)return Ar(this,n),this;var i=this._events[n];if(i.fn)i.fn===o&&(!t||i.once)&&(!e||i.context===e)&&Ar(this,n);else{for(var a=0,f=[],p=i.length;a<p;a++)(i[a].fn!==o||t&&!i[a].once||e&&i[a].context!==e)&&f.push(i[a]);f.length?this._events[n]=f.length===1?f[0]:f:Ar(this,n)}return this};gt.prototype.removeAllListeners=function(r){var o;return r?(o=Tt?Tt+r:r,this._events[o]&&Ar(this,o)):(this._events=new Ze,this._eventsCount=0),this};gt.prototype.off=gt.prototype.removeListener;gt.prototype.addListener=gt.prototype.on;gt.prefixed=Tt;gt.EventEmitter=gt;typeof tn<"u"&&(tn.exports=gt)});var Yo=_t((Tf,Xo)=>{"use strict";Xo.exports=(s,r)=>(r=r||(()=>{}),s.then(o=>new Promise(e=>{e(r())}).then(()=>o),o=>new Promise(e=>{e(r())}).then(()=>{throw o})))});var Jo=_t((Ef,Er)=>{"use strict";var hs=Yo(),Tr=class extends Error{constructor(r){super(r),this.name="TimeoutError"}},Zo=(s,r,o)=>new Promise((e,t)=>{if(typeof r!="number"||r<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(r===1/0){e(s);return}let n=setTimeout(()=>{if(typeof o=="function"){try{e(o())}catch(f){t(f)}return}let i=typeof o=="string"?o:`Promise timed out after ${r} milliseconds`,a=o instanceof Error?o:new Tr(i);typeof s.cancel=="function"&&s.cancel(),t(a)},r);hs(s.then(e,t),()=>{clearTimeout(n)})});Er.exports=Zo;Er.exports.default=Zo;Er.exports.TimeoutError=Tr});var ti=_t(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});function ds(s,r,o){let e=0,t=s.length;for(;t>0;){let n=t/2|0,i=e+n;o(s[i],r)<=0?(e=++i,t-=n+1):t=n}return e}en.default=ds});var ei=_t(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});var gs=ti(),rn=class{constructor(){this._queue=[]}enqueue(r,o){o=Object.assign({priority:0},o);let e={priority:o.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=o.priority){this._queue.push(e);return}let t=gs.default(this._queue,e,(n,i)=>i.priority-n.priority);this._queue.splice(t,0,e)}dequeue(){let r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(o=>o.priority===r.priority).map(o=>o.run)}get size(){return this._queue.length}};nn.default=rn});var ni=_t(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});var ys=Ko(),ri=Jo(),As=ei(),xr=()=>{},Ts=new ri.TimeoutError,on=class extends ys{constructor(r){var o,e,t,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=xr,this._resolveIdle=xr,r=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:As.default},r),!(typeof r.intervalCap=="number"&&r.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(e=(o=r.intervalCap)===null||o===void 0?void 0:o.toString())!==null&&e!==void 0?e:""}\` (${typeof r.intervalCap})`);if(r.interval===void 0||!(Number.isFinite(r.interval)&&r.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(n=(t=r.interval)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof r.interval})`);this._carryoverConcurrencyCount=r.carryoverConcurrencyCount,this._isIntervalIgnored=r.intervalCap===1/0||r.interval===0,this._intervalCap=r.intervalCap,this._interval=r.interval,this._queue=new r.queueClass,this._queueClass=r.queueClass,this.concurrency=r.concurrency,this._timeout=r.timeout,this._throwOnTimeout=r.throwOnTimeout===!0,this._isPaused=r.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=xr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=xr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let r=Date.now();if(this._intervalId===void 0){let o=this._intervalEnd-r;if(o<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},o)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let r=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let o=this._queue.dequeue();return o?(this.emit("active"),o(),r&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(r){if(!(typeof r=="number"&&r>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${r}\` (${typeof r})`);this._concurrency=r,this._processQueue()}async add(r,o={}){return new Promise((e,t)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&o.timeout===void 0?r():ri.default(Promise.resolve(r()),o.timeout===void 0?this._timeout:o.timeout,()=>{(o.throwOnTimeout===void 0?this._throwOnTimeout:o.throwOnTimeout)&&t(Ts)});e(await i)}catch(i){t(i)}this._next()};this._queue.enqueue(n,o),this._tryToStartAnother(),this.emit("add")})}async addAll(r,o){return Promise.all(r.map(async e=>this.add(e,o)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(r=>{let o=this._resolveEmpty;this._resolveEmpty=()=>{o(),r()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(r=>{let o=this._resolveIdle;this._resolveIdle=()=>{o(),r()}})}get size(){return this._queue.size}sizeBy(r){return this._queue.filter(r).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(r){this._timeout=r}};sn.default=on});var Q=bt(Wt());var Wr=bt(Wt());var fo=(s,r)=>{let o,e;return function(){let t=arguments,n=this;return o||(o=!0,setTimeout(()=>o=!1,r),e=s.apply(n,t)),e}};var Jt=bt(Wt());var Li=s=>{let[r,o]=(0,Jt.useState)(""),{currentAIProviderModelDetail:e}=lr(),t=(0,Jt.useMemo)(()=>{let i=e?.maxTokens||4e3;return Math.floor(i/1e3)*1e3},[e]),n=(0,Jt.useMemo)(()=>r.length>t,[r,t]);return(0,Jt.useEffect)(()=>{let i=a=>{a.startsWith("``NO_HISTORY_&#``\n")&&(a=a.replace("``NO_HISTORY_&#``\n","")),o(a)};return dt(s).subscribe(i),()=>{dt(s).unsubscribe(i)}},[]),{currentMaxInputLength:t,isError:n}},mo=Li;var Oi=()=>Math.max(Math.floor(window.innerHeight*.5/24)||5),Ue=24,Re=(s,r=0,o=0)=>{let e=s?.parentElement?.parentElement;if(s&&e){let t=window.getComputedStyle(s),n=parseInt(t.paddingTop,10)+parseInt(t.paddingBottom,10);s.style.cssText="height:0px";let i=s.value?s.scrollHeight:Ue+n,a=Math.min(Ue*Oi(),i);o===0&&(o=s?.previousElementSibling?.offsetHeight||0);let f=Math.max(Ue,o||0);a=Math.max(f,a),s.style.cssText=`height: ${a}px`;let p=a+r;e.style.cssText=`height: ${p}px`}},Ri=(s,r=0,o=0)=>{Re(s,r,o),setTimeout(()=>{Re(s,r,o);let e=s.value;s.focus(),s.setSelectionRange(e.length,e.length)},100)},te=(s,r=0,o=0)=>{let e="",t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&(e="mui",t.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(e="linkedin",n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}s.isSameNode(In())||s.isSameNode(_n())||Ri(s,r,o)},Ui=s=>{},Di=s=>{let r=ft(er),o=ft(ro),e=ft(Le),{defaultValue:t,onChange:n,onEnter:i,onKeydown:a,loading:f,children:p,error:c=!1,InputId:l=Rt,stopPropagation:u=!0,placeholder:m="Ask AI...",expandNode:A,sx:C}=s,{isError:w}=mo(Xt===l?"floatingMenuInputMediator":"chatBoxInputMediator"),x=(0,Q.useRef)(null),k=(0,Q.useRef)(!1),L=(0,Q.useRef)(!1),[M,U]=(0,Q.useState)(t||""),E=(0,Q.useRef)(0),O=(0,Q.useRef)(0),g=(0,Q.useRef)(null),d=(0,Q.useRef)(null),v=(0,Q.useMemo)(()=>fo(Re,200),[]),b=T=>[E.current,O.current],S=(0,Q.useCallback)(T=>{let _=T.target.value;l===Rt?dt("chatBoxInputMediator").updateInputValue(_):l===Xt?dt("floatingMenuInputMediator").updateInputValue(_):U(_),n&&n(_,{includeHistory:!L.current})},[n]),I=(0,Q.useRef)({});return(0,Q.useEffect)(()=>{if(l===Rt){let T=(_,y)=>{y&&(I.current=y),_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),U(_)};return dt("chatBoxInputMediator").subscribe(T),()=>{dt("chatBoxInputMediator").unsubscribe(T)}}if(l===Xt){let T=_=>{_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),U(_)};return dt("floatingMenuInputMediator").subscribe(T),()=>{dt("floatingMenuInputMediator").unsubscribe(T)}}return()=>{}},[]),(0,Q.useEffect)(()=>{L.current=!1,I.current={}},[e.loading]),(0,Q.useEffect)(()=>{v(x.current,...b("inputValue1")),setTimeout(()=>{x.current&&Re(x.current,...b("inputValue2"))},0)},[M]),(0,Q.useEffect)(()=>{let T=new ResizeObserver(y=>{for(let h of y)setTimeout(()=>{E.current=h.target?.offsetHeight||0,x.current&&Re(x.current,...b("children"))},100)}),_=new ResizeObserver(y=>{for(let h of y)setTimeout(()=>{O.current=h.target?.offsetHeight||0,x.current&&Re(x.current,...b("expand"))},100)});return d.current&&_.observe(d.current),g.current&&T.observe(g.current),()=>{T.disconnect(),_.disconnect()}},[]),(0,Q.useEffect)(()=>{o.open&&x.current&&l===Xt&&te(x.current,...b("floatingDropdownMenu"))},[o.open]),(0,Q.useEffect)(()=>{r.open&&x.current&&l===Rt&&!Oe()&&te(x.current,...b("appState"))},[r.open,f]),rr(()=>{l===Rt&&Rn()&&setTimeout(()=>{te(x.current,...b("appState"))},100)}),Q.default.createElement(Nr,{component:"div",className:f?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${w||c?"rgb(239, 83, 80)":"customColor.borderColor"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{maxHeight:"30px",opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...C}},Q.default.createElement(Nr,{component:"div",className:"chat-box__input-skeleton"},Q.default.createElement(Jn,{height:Ue})),Q.default.createElement(ir,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,color:T=>T.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",minHeight:Ue+"px",lineHeight:Ue+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},Q.default.createElement(ir,{ref:d,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"end"}},A),Q.default.createElement("textarea",{id:l,placeholder:m,disabled:f,ref:x,value:M,rows:1,onCopy:T=>{T.stopPropagation()},onCut:T=>{T.stopPropagation()},onPaste:T=>{T.stopPropagation()},onKeyUp:T=>{u&&T.stopPropagation()},onKeyPress:T=>{u&&T.stopPropagation()},onKeyDown:T=>{if(u){if(T.key==="ArrowUp"||T.key==="ArrowDown"||T.key==="ArrowLeft"||T.key==="ArrowRight"||T.key==="Escape")return;T.stopPropagation()}if(!k.current){if(!(T.key==="Enter"&&T.shiftKey)){if(T.key==="Enter")i&&i(T.currentTarget.value,{includeHistory:!L.current,meta:I.current}),L.current=!1,I.current={},T.preventDefault();else if(T.code==="Space"){T.stopPropagation();return}}a&&a(T)}},onClick:T=>{te(T.currentTarget,...b("click"))},onCompositionUpdate:T=>{u&&T.stopPropagation()},onCompositionStart:T=>{u&&T.stopPropagation(),k.current=!0},onCompositionEnd:T=>{u&&T.stopPropagation(),k.current=!1,S(T)},onInput:T=>{u&&T.stopPropagation(),k.current?U(T.currentTarget.value):S(T)},onBlur:T=>{v(T.currentTarget,...b("blur")),Ui(T.currentTarget)}})),Q.default.createElement(ir,{ref:g,width:"100%"},p))},oa=Di;var Pt=bt(Wt());var wt=bt(Wt());var De=new Me({runtime:"client"}),ki=()=>{let[s,r]=(0,wt.useState)([]),{currentAIProviderModelDetail:o,aiProvider:e}=lr(),{chatConversationId:t}=ft(zn),n=ft(sr),i=(0,wt.useRef)(!1),a=(0,wt.useMemo)(()=>o?.uploadFileConfig,[o]),f=(0,wt.useCallback)(async l=>{i.current=!0;let u=Qe(l).map(m=>(m.uploadStatus==="idle"&&(m.uploadStatus="uploading",m.uploadProgress=20),m));switch(r(u),e){case"OPENAI":await De.postMessage({event:"Client_chatUploadFiles",data:{files:u}});break;case"BING":{let m=await Promise.all(l.map(async A=>{if(A.file&&fr(A.file)){let C=await lo(A.file);C&&(A.base64Data=C)}return A}));await De.postMessage({event:"Client_chatUploadFiles",data:{files:m}})}break;default:{let m=await Promise.all(l.map(async A=>{let C=await ao(A.file),w=Qe(A);return w.file=C,w}));await De.postMessage({event:"Client_chatUploadFiles",data:{files:m}})}break}setTimeout(()=>{i.current=!1},1e3)},[a,e]),p=(0,wt.useCallback)(async l=>{let u=await De.postMessage({event:"Client_chatRemoveFiles",data:{files:l}});return r(u.data||[]),u.success},[a]),c=(0,wt.useMemo)(()=>{switch(e){case"OPENAI":return"File uploading. Please send your message once upload completes.";default:return"File uploading. Please send your message once upload completes."}return""},[e]);return(0,wt.useEffect)(()=>{let l=s.find(u=>u.uploadStatus==="error");if(l){switch(e){case"OPENAI":t&&!Xe(n,u=>u.messageId===l.id)&&Gr("add",t,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:l.uploadErrorMessage==="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again."?"info":"error"}}]);break;default:t&&!Xe(n,u=>u.messageId===l.id)&&Gr("add",t,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:"error"}}])}p([l])}},[s,e]),Fn(()=>{De.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{i.current||Ur(l.data)&&r(l.data)})}),rr(()=>{De.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{Ur(l.data)&&r(l.data)})}),Nn(async(l,u,m)=>{switch(l){case"Client_listenUploadFilesChange":{let{files:A}=u;return r(A),{success:!0,data:{},message:""}}default:break}}),{aiProviderUploadingTooltip:c,AIProviderConfig:a,aiProviderUploadFiles:f,aiProviderRemoveFiles:p,files:s}},po=ki;var Fi=s=>{let{disabled:r=!1,TooltipProps:o,onUpload:e,onDone:t,...n}=s,{t:i}=qn(["common","client"]),{files:a,AIProviderConfig:f,aiProviderUploadFiles:p,aiProviderRemoveFiles:c,aiProviderUploadingTooltip:l}=po(),u=ft(Gn),m=ft(Le),A=(0,Pt.useRef)(null),C=f?.maxCount||1,w=f?.maxFileSize||5*1024*1024,x=(0,Pt.useMemo)(()=>a.length>=(f?.maxCount||1),[a]),k=async L=>{let M=a?.length||0,U=C-M,E=L.target.files;if(!E||U===0)return;let O=Array.from(E);if(O=O.slice(0,U),O.length===0)return;let g=await Promise.all(O.map(async d=>{let v=fr(d),b="file",S="";v&&(b="image",S=await ur(d)||"");let I={id:it(),file:d,fileName:d.name,fileSize:d.size,fileType:d.type,base64Data:S,blobUrl:URL.createObjectURL(d),uploadStatus:"idle",uploadErrorMessage:"",uploadProgress:0,icon:b};return w>0&&I.fileSize>w&&(I.uploadStatus="error",I.uploadErrorMessage=`Upload failed: ${I.fileName} exceeds the ${(w/1024/1024).toFixed(0)}MB limit. Please select a smaller file.`),I}));await p(a.concat(g)),A.current&&(A.current.value="")};return!f||u.status!=="success"||m.loading?Pt.default.createElement(Pt.default.Fragment,null):Pt.default.createElement(uo,{files:a,loadingTooltipTitle:l,onRemove:async L=>{await c([L])},TooltipProps:o,...n},!x&&Pt.default.createElement(Zn,{placement:"top",title:f?.acceptTooltip?f.acceptTooltip(i):"Upload file",...o},Pt.default.createElement(Bn,{disabled:r,sx:{minWidth:"unset",p:0,my:"4px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{A.current&&A.current.click()}},Pt.default.createElement(eo,{icon:"AddCircle",sx:{color:"inherit"}}))),Pt.default.createElement("input",{multiple:C>1,onChange:k,ref:A,accept:f?.accept||"",hidden:!0,style:{display:"none"},type:"file"}))},Ra=Fi;var go=(s,r,o,e)=>new Promise(t=>{let n=!1,i=setTimeout(()=>{n=!0,t(void 0)},e),a=setInterval(()=>{if(!n){let f=s.querySelector(r);f&&(clearInterval(a),clearTimeout(i),t(f))}},o)}),ho=(s,r,o,e,t)=>new Promise(n=>{let i=!1,a=setTimeout(()=>{i=!0,n(void 0)},e),f=setInterval(()=>{if(!i){let p=Array.from(s.querySelectorAll(r));if(t){let c=t(p);c&&(clearInterval(f),clearTimeout(a),n(c))}else p.length>0&&(clearInterval(f),clearTimeout(a),n(p[0]))}},o)}),Ni=()=>new Promise(async s=>{let o=setTimeout(()=>{s({success:!1,error:"timeout"})},4e3),e=t=>{clearTimeout(o),s(t)};try{let t=document.getElementById(xn)?.shadowRoot;if(t){let n=await ho(t,".usechatgpt-ai__context-menu--handle-button",200,2e3,i=>i.find(a=>window.getComputedStyle(a).opacity!=="0"));if(n){setTimeout(()=>{n.click()},100);let i=await ho(t,".floating-context-menu-item",50,2e3,a=>a.find(f=>f.innerText.startsWith("Run this prompt")));if(i){i.click(),e({success:!0,error:""});return}}}e({success:!1,error:"no context menu"})}catch(t){e({success:!1,error:t?.toString()||""})}}),ka=Ni;var Vr=class{constructor(){this.pending=new Map}async send(r,o,e=5*1e3){let t=it(),n={...o,uuid:t};return new Promise((i,a)=>{let f=setTimeout(()=>{this.pending.delete(t),a(new Error("Timeout Error"))},e);this.pending.set(t,p=>{clearTimeout(f),i(p)}),window.dispatchEvent(new CustomEvent(r,{detail:n}))})}receive(r,o){window.addEventListener(r,async e=>{if(e instanceof CustomEvent&&e.detail&&e.detail.uuid){let{uuid:t,...n}=e.detail,i,a=o(n);a instanceof Promise?i=await a:i=a;let f=this.pending.get(t);f&&(f(i),this.pending.delete(t))}})}},yo=new Vr;var We=bt(Wt());var $r=class{constructor(r,o,e,t){this.id=r,this.type=o,this.status="idle",this.parameters=Object.assign({},e)||{},this.autoExecute=t}async execute(r,o){this.status="running",this.error="",this.output="",this.status="complete"}pushMessageToChat(r,o){if(o&&o.getChartGPT()?.pushMessage){let e=this.getCurrentConversationId(o);o.getChartGPT()?.pushMessage(r,e)}}reset(){this.status="idle",this.error="",this.output=""}getCurrentConversationId(r){return r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||""}getCurrentSidebarType(r){return r.getChartGPT()?.getSidebarRef()?.currentSidebarSettingsRef?.current?.type||"Chat"}getNextAction(r){return r?.getShortCutsEngine()?.getNextAction()}getPrevAction(r){return r?.getShortCutsEngine()?.getPrevAction()}async getCurrentConversation(r){let o=r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||"";return o?await jn(o):null}async updateConversation(r,o){let e=this.getCurrentConversationId(r);await Yn(e,o)}},B=$r;var Ye=(s,r)=>{try{return{data:s.replace(/\{\{(.+?)\}\}/g,(e,t)=>{let n=t.trim().split("."),i=r;for(;n.length;){let a=n.shift();if(Object.prototype.hasOwnProperty.call(i,a))i=i[a];else{i="";break}}return i}),error:""}}catch{return{data:"",error:"parse template error"}}};function j(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;if(i.parameters?.template){let a=Ye(i.parameters?.template||"",n);a.error?(i.error=a.error,i.parameters.compliedTemplate=""):i.parameters.compliedTemplate=a.data}await e.apply(this,t)}}}function V({onlySuccess:s,onlyError:r}={onlySuccess:!1,onlyError:!1}){return function(o,e,t){let n=t.value;t.value=async function(...i){let[,a]=i,f=this,p=await n.apply(this,i),c=a.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;return f.error&&!s?a.getChartGPT()?.pushMessage({type:"system",text:f.error,messageId:it(),extra:{status:"error"},conversationId:c}):f.output&&!r&&a.getChartGPT()?.pushMessage({type:"system",text:f.output,messageId:it(),extra:{status:"success"}},c),p}}}function Et(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[,n]=t;n.getChartGPT()?.showLoading();let i=await e.apply(this,t);return n.getChartGPT()?.hideLoading(),i}}}function ke(s=!0){return function(r,o,e){let t=e.value;e.value=async function(...n){let i=Oe(),a="chatBoxInputMediator";if(i&&(a="floatingMenuInputMediator"),s)return dt(a).updateInputValue(""),await t.apply(this,n);{let f=await t.apply(this,n);return dt(a).updateInputValue(""),f}}}}var ee=class extends B{static{this.type="GET_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=Kn(`<html>${document?.documentElement?.innerHTML}</html>`).document,t=Xn(e);t?t.success?this.output=t?.body||"":this.error=t?.body||"":this.error="No webpage contents",this.output||(this.output="",this.error="No webpage contents")}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ee.prototype,"execute",1);var re=class extends B{static{this.type="SET_VARIABLE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableName||this.parameters.Variable||"";if(!e){this.error="Action no variable name!";return}let t=o.getShortCutsEngine();t&&t.setVariable&&(t.setVariable(e,this.parameters?.WFFormValues?.Value||r.LAST_ACTION_OUTPUT||"",!0),this.output=r.LAST_ACTION_OUTPUT||"")}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],re.prototype,"execute",1);var Fe=class extends B{static{this.type="OPERATION_ELEMENT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getBackgroundConversation(),t=this.parameters.OperationElementConfig||r.OperationElementConfig;if(!e||!t){this.error="Action cannot execute!";return}let n=this.parameters.OperationElementTabID||r.OperationElementTabID,a=(await e.postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:t,OperationElementTabID:n}})).data;a?.success?(t.successMessage&&this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.successMessage,extra:{status:"info"}},o),t.actionType==="getText"?this.output=a.elementsInnerText:t.actionType==="getLink"&&(this.output=a.link)):t.errorMessage&&this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.errorMessage,extra:{status:"error"}},o)}catch(e){this.error=e.toString()}}};var Ne=class extends B{static{this.type="SCRIPTS_CONDITIONAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=!1,t=this.parameters.WFCondition||r.WFCondition||void 0,n=this.parameters.WFMatchTextCaseSensitive!==!1,i=this.parameters.WFFormValues?.Value||"",a=r.LAST_ACTION_OUTPUT||"",f=this.parameters.WFConditionalIfTrueActions||[],p=this.parameters.WFConditionalIfFalseActions||[];switch(bn(i)?a=JSON.parse(a||"{}"):!n&&typeof i=="string"&&typeof a=="string"&&(i=i.toLocaleLowerCase(),a=a.toLocaleLowerCase()),t){case"Equals":e=Dn(i,a);break;case"Is Greater Than":e=Number(i)>Number(a);break;case"Is Less Than":e=Number(i)<Number(a);break;case"Contains":e=a.includes(String(i));break;case void 0:e=!a;break;default:break}if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(e?f:p,"after");else{this.error="no shortCutsEngine";return}}catch(e){this.error=e.toString()}}};var Ao=bt(Wt());var Qr=()=>{let s=ft(er),{currentSelection:r}=oo(),o=ft(sr),e=ft(no),t=ft(vn);return(0,Ao.useCallback)(()=>{let n="".replace(/<br\s*\/?>/gi,`
`).replace(/<\/?div[^>]*>/g,`
`).replace(/<[^>]+>/g,"").replace(/\u00ad/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/data:image\/(png|jpeg|gif);base64,\s?[A-Za-z0-9+/]+={0,2}/g,"").replace(/\n{3,}/g,`
`)||"",i=r?.selectionHTML||"",a=r?.selectionText||"",f=t.userSettings?.language||Or;f===Cn&&(f=Or);let p={GMAIL_EMAIL_CONTEXT:"",GMAIL_DRAFT_CONTEXT:n,SELECTED_HTML:i,SELECTED_TEXT:a,USER_INPUT:Yt()?.querySelector(`#${Rt}`)?.value||"",LAST_AI_OUTPUT:Xe(o,l=>l.type==="ai")?.text||"",AI_RESPONSE_LANGUAGE:f,AI_OUTPUT_LANGUAGE:f,CURRENT_WEBSITE_DOMAIN:typeof window<"u"?window.location.hostname:"",CURRENT_WEBPAGE_URL:typeof window<"u"?window.location.href:"",CURRENT_WEBPAGE_TITLE:typeof window<"u"?document.title:"",POPUP_DRAFT:e||""},c=[];return Object.keys(p).forEach(l=>{c.push({key:l,value:p[l],overwrite:!0})}),{builtInParameters:p,parameters:c,shortCutsParameters:Object.values(c)}},[s.env,r,t.userSettings,e])};var To=bt(Wt());var ne=class extends B{static{this.type="SET_VARIABLES_MODAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.SetVariablesModalConfig;if(!e){this.error="No config!";return}if(e.modelKey==="Sidebar"){let f=Yt();f&&await go(f,"#max-ai__ai-provider-floating-button",100,5e3)}let t=o.getShortCutsEngine(),n=t.getVariables(),i=Qe(e);i.variables.map(f=>(f.defaultValue&&typeof f.defaultValue=="string"&&(f.defaultValue=Ye(f.defaultValue,n).data||""),f)),i.template=e.template||this.parameters?.compliedTemplate||"";let a=await yo.send("SetVariablesModal",{task:"open",config:i},5*60*1e3);a.success?Object.keys(a.data).forEach(f=>{a.data[f]!==void 0&&t?.setVariable(f,a.data[f],!0)}):(this.error="User cancel!",t?.reset()),this.output=JSON.stringify(a.data)}catch(e){this.error=e.toString()}}};z([j()],ne.prototype,"execute",1);var oe=class extends B{static{this.type="SET_VARIABLE_MAP"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableMap||{},t=o.getShortCutsEngine();t&&t.setVariable&&(Object.keys(e).forEach(n=>{e[n]!==void 0&&t?.setVariable(n,e[n],!0)}),this.output=JSON.stringify(e))}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],oe.prototype,"execute",1);var He=class extends B{static{this.type="URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.output=this.parameters.URLActionURL||this.parameters.LAST_ACTION_OUTPUT,this.output||(this.output="",this.error="No input url")}catch(e){this.error=e.toString()}}};var ie=class extends B{static{this.type="GET_CONTENTS_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.URLActionURL||r.URLActionURL||r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(e&&t){this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:it(),extra:{status:"info"}},o);let n=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:e}});n.success?this.output=n?.data?.body||"":this.error=n?.data?.body||""}else this.error=`Could not fetch the page.
Make sure the URL is correct.`;this.output||(this.output="",this.error=`Could not fetch the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ie.prototype,"execute",1);var se=class extends B{static{this.type="GET_CONTENTS_OF_SEARCH_ENGINE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.compliedTemplate||r.LAST_ACTION_OUTPUT||this.parameters?.URLSearchEngineParams?.q||this.parameters?.URLSearchEngineParams?.query||"",t=o.getBackgroundConversation();if(e&&t){this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:it(),extra:{status:"info"}},o),e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1));let n=this.parameters.URLSearchEngine||"yahoo",i=this.parameters.URLSearchEngineParams||{},a=this.getFullSearchURL(n,i,e),f=await t.postMessage({event:"ShortCuts_getContentOfSearchEngine",data:{URL:a}}),{status:p,html:c}=f.data||{};if(f.success&&p===200&&c){let l=this.getSearchResults({html:c,limit:Number(i?.limit||3),searchEngine:n});if(l.length<=0){this.output="",this.error="No search results found. Please try a different query.";return}else{this.output=JSON.stringify(l,null,2);return}}if(this.error="Failed to access the search page. Please try again.",p===301){this.output="",this.error=`<a href="${a}" target="_blank" style="color: inherit">Click here to pass the security check</a> and try again.`;return}}this.output||(this.output="",this.error=`Could not search the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}getFullSearchURL(r,o,e){let t=$i(r,o?.region),n=Vi(r,o,e);return`${t}?${n.toString()}`}getSearchResults({html:r,limit:o,searchEngine:e}){try{switch(e){case"yahoo":{let t=qr.load(r),n=[],i=t("#right .searchRightTop");if(i.length){let a=i.find(".compText a").first(),p=i.find(".compInfo li").map((c,l)=>t(l).text().trim()).get().join(`
`);n.push({title:a.text().trim(),body:`${i.find(".compText").text().trim()}${p?`

${p}`:""}`,url:this.extractRealUrl(a.attr("href")??"")})}return t('.algo-sr:not([class*="ad"])').slice(0,o).each((a,f)=>{let p=t(f),c=p.find("h3.title a");n.push({title:c.attr("aria-label")??"",body:p.find(".compText").text().trim(),url:this.extractRealUrl(c.attr("href")??"")})}),n}case"google":{let t=qr.load(r),n=[],i=t("#rhs");if(i&&i.length){let a=i.find('h2[data-attrid="title"]').text().trim(),f=i.find(".kno-rdesc a[href]"),p=i.find("div.wp-ms").text().trim();n.push({title:a,body:p,url:this.extractRealUrl(f.attr("href")??"")})}return t("#search #rso > div").filter((a,f)=>!!t(f).find("a > h3").text()).slice(0,o).each((a,f)=>{let p=t(f),c=p.find("a > h3");n.push({title:c.text().trim()??"",body:p.find("div.MUxGbd").text().trim(),url:this.extractRealUrl(c.closest("a").attr("href")??"")})}),n}default:return[]}}catch{return[]}}extractRealUrl(r){let o=r.match(/RU=([^/]+)/);return o&&o[1]?decodeURIComponent(o[1]):r}};z([V({onlyError:!0})],se.prototype,"execute",1);function Vi(s,r,o){let e={...r};delete e.limit;let t=o||e.query;return e.region&&e.region!=="wt-wt"&&(s==="google"?t=`location:${e.region} ${t}`:t=`${e.region} ${t}`,delete e.region),s==="yahoo"&&(e.p=t),new URLSearchParams({...e,q:t})}function $i(s,r="wt-wt"){switch(s){case"google":return"https://www.google.com/search";case"yahoo":return"https://search.yahoo.com/search";case"baidu":return"https://www.baidu.com/s";case"bing":return"https://www.bing.com/search";case"duckduckgo":return"https://duckduckgo.com";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://search.yahoo.com/search"}}var Be=class extends B{static{this.type="FETCH_ACTIONS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getShortCutsEngine(),t=await io(this.parameters.template||"");e.pushActions(t,"after"),this.output=r.LAST_AI_OUTPUT||""}catch(e){this.error=e.toString()}}};var ae=class extends B{static{this.type="GET_YOUTUBE_TRANSCRIPT_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=window.location.href.includes("youtube.com")?window.location.href:"",t=this.parameters.URLActionURL||e||"";if(!t){this.error="Youtube URL is empty.";return}let n=await Ut.fetchTranscript(t);if((n.length<=10?n.map(a=>a.text).join("").trim()==="":!1)&&t&&t.startsWith("https://")){let a=await Vn(t,{parse:"text"});a.success&&a.data&&(n=[{start:"",duration:"",text:await ar()}])}if(n.length>0){let a=await Ut.transcriptFormat(n),{getChartGPT:f,getShortCutsEngine:p}=o;if(p()?.getNextAction?.()?.type==="ASK_CHATGPT"){let c=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;await f()?.updateConversation({meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
\`\`\`
${a}
\`\`\``}},c)}this.output=a}}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),Et()],ae.prototype,"execute",1);var Ge=class extends B{static{this.type="OPEN_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",t=r.URLActionActiveTab||this.parameters.URLActionActiveTab;if(!e){this.error="No open url";return}e==="current_page"?this.output=await Dr({key:"current_page"})||void 0:this.output=await Dr({url:e,active:t})||void 0}catch(e){this.error=e.toString()}}};var qe=class extends B{static{this.type="CLOSE_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.OperationElementTabID||this.parameters.OperationElementTabID,t=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",n=await Ln({tabId:e,url:t});n?.success||(this.error=n?.message)}catch(e){this.error=e.toString()}}};var ce=class extends B{static{this.type="GET_READABILITY_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=await cr()||await ar();this.output=e}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),Et()],ce.prototype,"execute",1);var le=class extends B{static{this.type="GET_EMAIL_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await cr()||await Qn(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),Et()],le.prototype,"execute",1);var ue=class extends B{static{this.type="GET_EMAIL_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";if(e){let t=await $n(e);this.output=t}else this.output=""}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),Et()],ue.prototype,"execute",1);var Qi=s=>{if(s.length>0){let r=[];s.forEach((t,n)=>{let{content:i,author:a}=t;r.push({text:`[Comment ${n+1}]
**Author:** ${a}
**Comment:**
${i}`,data:t})});let o=r[r.length-1],e=r.slice(0,r.length-1);return{last:o,lastText:r[r.length-1].text,previous:e,previousText:e.map(t=>t.text).join(`

`),fullText:r.join(`

`)}}return null},K=class{constructor(r,o){this.commentList=[];let{postTitle:e="Post",postContentTagName:t="Post caption/description",meta:n={}}=o||{};this.config={postTitle:e,postContentTagName:t,meta:n},this.post=r}static get emptyData(){return{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",postText:""}}addCommentList(r){this.commentList.push(r)}get data(){let{content:r,author:o,title:e}=this.post,t=Qi(this.commentList?.[0]||[]),n="";return n+=`[${this.config.postTitle}]`,n+=`
**Post author:** ${o||"N/A"}`,n+=`
**Post title:** ${e||"N/A"}`,n+=`
**${this.config.postContentTagName}:**
${r||"N/A"}`,Object.keys(this.config.meta||{}).forEach(i=>{n+=`
**${i}:**
${this.config.meta?.[i]||"N/A"}`}),t?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.lastText,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.previousText?`${n}

${t.previousText}

${t.lastText}`:`${n}

${t.lastText}`,post:this.post,postText:n,replyCommentText:t.last.text,replyComment:t.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:t.previousText}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:n,post:this.post,postText:n,previousComments:this.commentList?.[0]||[],previousCommentsText:t?.previousText}}};var St=(s,r)=>new Promise(o=>setTimeout(()=>{if(r){let t=window.innerHeight/10;r.scrollIntoView(!1),window.scrollBy(0,t)}o(!0)},s)),rt=(s,r,o=20)=>{let e=r,t=0;for(;t<o&&!e.querySelector(s);)e=e?.parentElement,t++;return e.querySelector(s)||null},st=(s,r,o=20)=>{let e=r,t=0;for(;t<o&&!e?.matches(s);)e=e?.parentElement,t++;return e?.matches(s)?e:null};var Eo=s=>{let r=s.querySelector('div[data-testid="User-Name"]'),[o,e]=kn(Array.from(r?.querySelectorAll("span")).map(i=>i.textContent||"").filter(i=>i&&i!=="\xB7")),t=s.querySelector("time")?.dateTime||"",n=s.querySelector('div[data-testid="tweetText"]').innerText;return{author:`${o}(${e})`,date:t,content:n,title:""}},xo=async s=>{let r=rt('article[data-testid="tweet"]',s);if(r){let o=[],e=st('div[data-testid="cellInnerDiv"]',r,5);for(;e;){if(e?.getAttribute("data-testid")==="cellInnerDiv"){let t=e.querySelector('article[data-testid="tweet"]');t&&o.splice(0,0,Eo(t))}e=e.previousElementSibling}if(o.length>0){let t=o.shift(),n=new K(t);return n.addCommentList(o),n.data}else return new K(Eo(r)).data}return K.emptyData},Co=s=>rt("div.DraftEditor-editorContainer",s,30)?.innerText||"",eu=s=>{let r=Array.from(document.querySelectorAll('div[role="progressbar"]')),o=null;for(let e=0;e<r.length;e++){let t=r[e];if(t.parentElement?.contains(s)){o=t.parentElement;break}}return o};var vo=async s=>{let r=(s.querySelector("span.comments-post-meta__name span:not(.visually-hidden)")?.innerText||"").split(`
`)[0],o=s.querySelector("time")?.innerText||"",e=s.querySelector("& > .comments-reply-item-content-body button.see-more");e&&(e.click(),await St(100));let t=s.querySelector("& > div.comments-comment-item-content-body")?.innerText||s.querySelector("& > div.comments-reply-item-content-body")?.innerText;return{author:r||"",date:o||"",content:t||""}},bo=async s=>{let r=rt(".comments-comment-box",s),o=rt(".social-details-social-activity",r);if(r&&o){let e=rt(".feed-shared-update-v2__description-wrapper",r);if(e){let t=e?.parentElement,n=t?.querySelector('button[role="button"].see-more');n&&(n.click(),await St(100,s));let i=t?.querySelector(".update-components-actor__name span:not(.visually-hidden)")?.textContent||"",a=e?.innerText||"",f=(t?.querySelector("div.ml4.mt2.text-body-xsmall")?.innerText||"").split("\u2022")?.[0],p=new K({author:i,content:a,title:"",date:f});if(r.parentElement?.classList.contains("comments-comment-item__nested-items")){let c=[],l=st("article.comments-comment-item",s),m=l?.querySelector('div.editor-content div[contenteditable="true"]')?.innerText||"";if(c.push(await vo(l)),m){let A=Array.from(l.querySelectorAll("article"));for(let C=0;C<A.length;C++){let w=A[C],x=await vo(w);if(m.startsWith(x.author)){c.push(x);break}}}await St(0,s),p.addCommentList(c)}return p.data}}return K.emptyData},So=s=>rt("div.ql-editor",s,30)?.innerText||"";var jr=async s=>{let r=s?.querySelector("a > span > span")?.innerText||"",o=s?.querySelector("span[lang][dir]")?.innerText||"",e=Array.from(s?.querySelectorAll("a > span")),t=e[e.length-1]?.innerText||"";return{content:o,author:r,date:t}},Io=async s=>{let r=rt('form[role="presentation"]',s),o=rt('div[data-ad-preview="message"]',r,30),e=rt("span:has(h3 > span)",r,30),t=e||rt("span:has(h4 > div)",r,30),n=t?.innerText||"",i=e?t?.nextElementSibling?.querySelector("a")?.innerText:t?.parentElement?.nextElementSibling?.querySelectorAll("a")?.[1]?.innerText||"",a=o?.querySelector('div[dir] > div[role="button"]');a&&(a.click(),await St(100,s));let f=o?.innerText||"",p=[],c=new K({author:n,date:i,content:f,title:""});if(r){let u=r.querySelector('div[contenteditable="true"][role="textbox"]')?.innerText||"",m=st("li",r,10);for(;m;){let A=m.childNodes[0];if(A){let C=await jr(A);if(p.length===0&&!u.startsWith(C.author)&&m&&u){let w=Array.from(m.querySelectorAll("& > div > ul li > div"));for(let x=0;x<w.length;x++){let k=w[x],L=await jr(k);if(u.startsWith(L.author)){p.push(L);break}}}if(p.splice(0,0,C),m?.parentElement){m=st("li",m.parentElement,10);continue}}break}if(u.replace(`
`,"")&&!p.length){let A=rt('div[role="article"]',r),C=await jr(A);u.startsWith(C.author)&&p.push(C)}c.addCommentList(p)}return c.data},_o=s=>rt('div[contenteditable="true"]',s,30)?.innerText||"";var Kr=async s=>{let r=s.querySelector("#header-author #author-text > span")?.innerText||"",o=s.querySelector("#header-author > yt-formatted-string")?.innerText||"",e=s?.querySelector("tp-yt-paper-button#expand");e&&(e.click(),await St(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},wo=async s=>{try{let r=st("ytd-commentbox",s),o=Ut.retrieveVideoId(window.location.href),e=null;if(o){let t=await Ut.transcriptFormat(await Ut.fetchTranscript(window.location.href),2048),n=document.querySelector("ytd-watch-metadata"),i=n?.querySelector("#title > h1")?.innerText||document.title,a=document.querySelector("ytd-video-owner-renderer"),f=a?.querySelector("yt-formatted-string")?.textContent,p=n?.querySelector("tp-yt-paper-button#expand");p&&(p.click(),await St(100,s));let c=a?.querySelector("a")?.getAttribute("href")?.includes("@")&&a?.querySelector("a")?.getAttribute("href")?.split("/")[1],l=n?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",u=n?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||"";e=new K({title:i,author:`${f}(${c})`,date:l,content:u},{postTitle:"Video post",meta:{"Post video transcript":t}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let n=st("ytd-reel-video-renderer",s,50)?.querySelector("ytd-reel-player-header-renderer");if(n){let i=n?.querySelector(".title > yt-formatted-string")?.innerText||"",a=n?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";e=new K({title:i,author:a,date:"",content:""},{postTitle:"Video post"})}}if(r&&e){if(!st("ytd-comment-simplebox-renderer",r,5)){let t=st("ytd-comment-thread-renderer",r)?.querySelector("& > ytd-comment-renderer");if(t){let n=st("ytd-comment-renderer",r);n&&(rt("ytd-comment-replies-renderer",n,5)?.contains(n)&&!n.isSameNode(t)?e.addCommentList([await Kr(t),await Kr(n)]):e.addCommentList([await Kr(t)]))}}return e.data}}catch{}return K.emptyData},Po=s=>rt('div#contenteditable-root[contenteditable="true"]',s,30)?.innerText||"";var Xr=async s=>{let r=s.querySelector("#badge-name")?.innerText||s.querySelector("#name")?.innerText||"",o=s.querySelector("yt-formatted-string.published-time-text")?.innerText||"",e=s?.querySelector("ytcp-button#more");e&&(e.click(),await St(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Mo=async s=>{try{let r=st("ytcp-commentbox",s);if(!r)return K.emptyData;let o=st("ytcp-comment-thread",r),e=o?.querySelector("ytcp-comment-button > a[href]"),t=Ut.retrieveVideoId(e?.href||""),n=null;if(t){let i=await Ut.transcriptFormat(await Ut.fetchTranscript(window.location.href),2048),a=o?.querySelector("#video-title > yt-formatted-string")?.innerText||"",f=document.querySelector("#entity-name")?.innerText,p="";n=new K({title:a,author:`${f}`,date:p,content:""},{postTitle:"Video post",meta:{"Post video transcript":i}})}if(r&&n){let i=st("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(i){let a=st("ytcp-comment",r);a&&(rt("ytcp-comment-replies",a,5)?.contains(a)&&!a.isSameNode(i)?n.addCommentList([await Xr(i),await Xr(a)]):n.addCommentList([await Xr(i)]))}return n.data}}catch{}return K.emptyData},Lo=s=>rt("textarea#textarea",s,30)?.innerText||"";var pr=async s=>{let r=Array.from(s.querySelectorAll("a")).find(i=>i.innerText.trim()!=="")?.innerText||"",o=s.querySelector("time"),e="",t="",n=s.querySelector('div[role="button"][tabindex="0"]');return n&&n?.innerText==="more"&&(n.click(),await St(500)),o&&(t=o?.dateTime||"",e=st("div",o)?.nextElementSibling?.innerText||""),e||(e=(s.querySelector("h3")||s.querySelector("h2"))?.nextElementSibling?.innerText||""),e||(e=s.querySelector("span[dir] > span[dir]")?.innerText||""),{content:e,author:r.startsWith("@")?r:`${r?`@${r}`:""}`,date:t}},Oo=async s=>{let r=st("section",s),o=r?.querySelector("textarea")?.value||"",e=r?.parentElement?.parentElement;if(e){let t=e.querySelector("hr")?Array.from(e?.querySelectorAll("hr + div > div > div > div")):Array.from(e?.querySelectorAll("section + div > ul > *")),[n,...i]=t;if(!n){let p=e.querySelector("div:has( > span[dir] > span[dir])");if(p){let c=await pr(p);return new K({author:c.author,content:c.content,title:"",date:c.date}).data}else return K.emptyData}let a=await pr(n),f=new K({author:a.author,content:a.content,title:"",date:a.date});if(o.startsWith("@")){let p=o.split(" ")?.[0],c=[];for(let l=0;l<i.length;l++){let u=!1,m=await pr(i[l]);p.startsWith(m.author)&&(c.push(m),u=!0);let A=Array.from(i[l+1]?.querySelectorAll("ul > div"));if(A.length>0)for(let C=0;C<A.length;C++){let w=await pr(A[C]);if(p.startsWith(w.author)){c.push(m),c.push(w),u=!0;break}}if(u)break}f.addCommentList(c)}return f.data}return K.emptyData},Ro=s=>{let r=rt('div[contenteditable="true"]',s,20);return r?r?.innerText||"":rt("form textarea",s,20)?.value};var Uo=async s=>{let r=document.querySelector(s);if(!r)return K.emptyData;let o=Zt();return o==="twitter.com"?await xo(r):o==="linkedin.com"?await bo(r):o==="facebook.com"?await Io(r):o==="youtube.com"?await wo(r):o==="studio.youtube.com"?await Mo(r):o==="instagram.com"?await Oo(r):K.emptyData},Do=async s=>{let r=Zt(),o=document.querySelector(s);return o?r==="twitter.com"?Co(o):r==="linkedin.com"?So(o):r==="facebook.com"?_o(o):r==="youtube.com"?Po(o):r==="studio.youtube.com"?Lo(o):r==="instagram.com"?Ro(o):"":""};var fe=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Do(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),Et()],fe.prototype,"execute",1);var me=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_CONTENT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Uo(e),n=o.getShortCutsEngine();n&&n.pushActions([{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}}}],"after"),this.output=t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),Et()],me.prototype,"execute",1);var hr=class{constructor(r){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=r.pageContent?r.pageContent.toString():this.pageContent,this.metadata=r.metadata??{}}};var ji=Object.defineProperty,Ki=(s,r,o)=>r in s?ji(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,ko=(s,r,o)=>(Ki(s,typeof r!="symbol"?r+"":r,o),o);var Bo=bt(Ho(),1);function ns(s,r){let o=Array.from({length:s.length},(e,t)=>({start:t,end:t+1}));for(;o.length>1;){let e=null;for(let t=0;t<o.length-1;t++){let n=s.slice(o[t].start,o[t+1].end),i=r.get(n.join(","));i!=null&&(e==null||i<e[0])&&(e=[i,t])}if(e!=null){let t=e[1];o[t]={start:o[t].start,end:o[t+1].end},o.splice(t+1,1)}else break}return o}function os(s,r){return s.length===1?[r.get(s.join(","))]:ns(s,r).map(o=>r.get(s.slice(o.start,o.end).join(","))).filter(o=>o!=null)}function is(s){return s.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Zr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(s,r){this.patStr=s.pat_str;let o=s.bpe_ranks.split(`
`).filter(Boolean).reduce((e,t)=>{let[n,i,...a]=t.split(" "),f=Number.parseInt(i,10);return a.forEach((p,c)=>e[p]=f+c),e},{});for(let[e,t]of Object.entries(o)){let n=Bo.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...s.special_tokens,...r},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(s,r=[],o="all"){let e=new RegExp(this.patStr,"ug"),t=Zr.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(r==="all"?Object.keys(this.specialTokens):r),a=new Set(o==="all"?Object.keys(this.specialTokens).filter(p=>!i.has(p)):o);if(a.size>0){let p=Zr.specialTokenRegex([...a]),c=s.match(p);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let f=0;for(;;){let p=null,c=f;for(;t.lastIndex=c,p=t.exec(s),!(p==null||i.has(p[0]));)c=p.index+1;let l=p?.index??s.length;for(let m of s.substring(f,l).matchAll(e)){let A=this.textEncoder.encode(m[0]),C=this.rankMap.get(A.join(","));if(C!=null){n.push(C);continue}n.push(...os(A,this.rankMap))}if(p==null)break;let u=this.specialTokens[p[0]];n.push(u),f=p.index+p[0].length}return n}decode(s){let r=[],o=0;for(let n=0;n<s.length;++n){let i=s[n],a=this.textMap.get(i)??this.inverseSpecialTokens[i];a!=null&&(r.push(a),o+=a.length)}let e=new Uint8Array(o),t=0;for(let n of r)e.set(n,t),t+=n.length;return this.textDecoder.decode(e)}},Jr=Zr;ko(Jr,"specialTokenRegex",s=>new RegExp(s.map(r=>is(r)).join("|"),"g"));var Es=bt(Qo(),1),xs=bt(ni(),1);var an=class{constructor(r){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),this.chunkSize=r?.chunkSize??this.chunkSize,this.chunkOverlap=r?.chunkOverlap??this.chunkOverlap,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async createDocuments(r,o=[],e={}){let t=o.length>0?o:new Array(r.length).fill({}),{chunkHeader:n="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:a=!1}=e,f=new Array;for(let p=0;p<r.length;p+=1){let c=r[p],l=1,u=null;for(let m of await this.splitText(c)){let A=n,C=0;if(u){let L=c.indexOf(m),M=c.indexOf(u)+u.length;C=(c.slice(M,L).match(/\n/g)||[]).length,a&&(A+=i)}l+=C;let w=(m.match(/\n/g)||[]).length,x=t[p].loc&&typeof t[p].loc=="object"?{...t[p].loc}:{};x.lines={from:l,to:l+w};let k={...t[p],loc:x};A+=m,f.push(new hr({pageContent:A,metadata:k})),l+=w,u=m}}return f}async splitDocuments(r,o={}){let e=r.filter(i=>i.pageContent!==void 0),t=e.map(i=>i.pageContent),n=e.map(i=>i.metadata);return this.createDocuments(t,n,o)}joinDocs(r,o){let e=r.join(o).trim();return e===""?null:e}mergeSplits(r,o){let e=[],t=[],n=0;for(let a of r){let f=a.length;if(n+f+(t.length>0?o.length:0)>this.chunkSize&&(n>this.chunkSize,t.length>0)){let p=this.joinDocs(t,o);for(p!==null&&e.push(p);n>this.chunkOverlap||n+f>this.chunkSize&&n>0;)n-=t[0].length,t.shift()}t.push(a),n+=f}let i=this.joinDocs(t,o);return i!==null&&e.push(i),e}};var Cr=class extends an{constructor(r){super(r),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=r?.separators??this.separators}async splitText(r){let o=[],e=this.separators[this.separators.length-1];for(let i of this.separators){if(i===""){e=i;break}if(r.includes(i)){e=i;break}}let t;e?t=r.split(e):t=r.split("");let n=[];for(let i of t)if(i.length<this.chunkSize)n.push(i);else{if(n.length){let f=this.mergeSplits(n,e);o.push(...f),n=[]}let a=await this.splitText(i);o.push(...a)}if(n.length){let i=this.mergeSplits(n,e);o.push(...i)}return o}};var oi=async(s,r=1e3)=>{try{let o=s;return{docs:await new Cr({chunkSize:r}).createDocuments([o])}}catch{return{docs:[]}}};var Cs=6e3,cn=async(s,r,o)=>{let e=it(),t=[],{docs:n}=await oi(s,o);(r==="STUFF"||r==="REFINE")&&n.splice(1);let i="",a=Math.ceil(o/n.length);return n.length===1?t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${n[0].pageContent}
"""`}}):(n.forEach(({pageContent:f},p)=>{let c=f||"";c&&(t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${c}
"""`}}),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_PART_${p}_ID_${e}`}}),i+=`{{SUMMARIZE_TEXT_PART_${p}_ID_${e}}}
`)}),t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (probably an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${o} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${i}
"""`}})),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_ID_${e}`}}),{variableName:`SUMMARIZE_TEXT_ID_${e}`,actions:t}},de=class extends B{static{this.type="SUMMARIZE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"",t=this.parameters.SummarizeActionType||"STUFF";if(!e){this.error="No text to summarize";return}let{actions:n}=await cn(e,t,this.parameters.SliceTextActionType==="TOKENS"?await or(e,this.parameters.SliceTextActionTokens):this.parameters.SliceTextActionLength||Cs);if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(n.map(i=>({...i,parameters:{...i.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=""}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],de.prototype,"execute",1);var ge=class extends B{static{this.type="WEBGPT_SEARCH_RESULTS_EXPAND"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(!e||!t){this.error="no search result";return}let n=JSON.parse(e),i=this.parameters.SummarizeActionType||"STUFF",a=await Promise.all(n.map(async c=>{try{let l=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:c.url}});return{...c,body:l?.data?.body||c.body||"",title:l?.data?.title||c.title||""}}catch{return{...c}}})),f="",p=[];for(let c=0;c<a.length;c++){let l=a[c];if(i==="NO_SUMMARIZE")p.push({type:"RENDER_TEMPLATE",parameters:{template:l.body}}),p.push({type:"SLICE_OF_TEXT",parameters:{SliceTextActionType:"TOKENS",SliceTextActionTokens:Math.ceil(Fr*Hn/a.length)}}),p.push({type:"SET_VARIABLE",parameters:{VariableName:`SLICE_OF_TEXT_${c}`}}),f+=`NUMBER:${c+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: {{SLICE_OF_TEXT_${c}}}

`;else{let u=await or(l.body,Fr/a.length),{actions:m,variableName:A}=await cn(l.body,i,u);p.push(...m),f+=`NUMBER:${c+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: {{${A}}}

`}}if(p.push({type:"RENDER_TEMPLATE",parameters:{template:f}}),o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(p.map(c=>({...c,parameters:{...c.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=f}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ge.prototype,"execute",1);var ye=class extends B{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="WEBGPT_ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ASK_CHAT_GPT";this.question=o.LAST_ACTION_OUTPUT;let n=t==="ASK_CHAT_GPT_REPLACEMENT",i;n&&e.getShortCutsEngine()?.actions.find(c=>c.message?.messageId?(i=c.message,!0):!1);let{success:a,answer:f,message:p}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT,parentMessageId:""},{includeHistory:!1,regenerate:!1,hiddenInChat:t==="ASK_CHAT_GPT_HIDDEN",replaceMessage:i})||{success:!1,answer:""};a?(this.output=f,this.message=p):(this.output="",this.error=f||"ask chatgpt error")}catch(t){this.error=t.toString()}}reset(){super.reset(),this.question="",this.message=void 0}};z([j(),ke(!1)],ye.prototype,"execute",1);var vs=6e3,Ae=class extends B{static{this.type="SLICE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"";if(!e){this.output="";return}if(this.parameters.SliceTextActionType==="TOKENS"||this.parameters.SliceTextActionTokens)this.output=await Ke(e,this.parameters.SliceTextActionTokens||4096);else{let t=this.parameters.SliceTextActionLength||vs;this.output=e.slice(0,t)}}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],Ae.prototype,"execute",1);var ii=new Me,si=async s=>(await ii.postMessage({event:"WebsiteContext_createWebsiteContext",data:{websiteContext:{url:window.location.href||location.href||document.location.href,host:Zt(),html:document.documentElement.outerHTML,...s}}})).data;var ai=async(s,r)=>s.id?(await ii.postMessage({event:"WebsiteContext_updateWebsiteContext",data:{query:s,websiteContext:r}})).success:!1;function bs(s,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in s)){var t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(s,e,t.get?t:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(s)}function li(s,r){return new Promise(function(o,e){let t;return Ss(s).then(function(n){try{return t=n,o(new Blob([r.slice(0,2),t,r.slice(2)],{type:"image/jpeg"}))}catch(i){return e(i)}},e)})}var Ss=s=>new Promise((r,o)=>{let e=new FileReader;e.addEventListener("load",({target:{result:t}})=>{let n=new DataView(t),i=0;if(n.getUint16(i)!==65496)return o("not a valid JPEG");for(i+=2;;){let a=n.getUint16(i);if(a===65498)break;let f=n.getUint16(i+2);if(a===65505&&n.getUint32(i+4)===1165519206){let p=i+10,c;switch(n.getUint16(p)){case 18761:c=!0;break;case 19789:c=!1;break;default:return o("TIFF header contains invalid endian")}if(n.getUint16(p+2,c)!==42)return o("TIFF header contains invalid version");let l=n.getUint32(p+4,c),u=p+l+2+12*n.getUint16(p+l,c);for(let m=p+l+2;m<u;m+=12)if(n.getUint16(m,c)==274){if(n.getUint16(m+2,c)!==3)return o("Orientation data type is invalid");if(n.getUint32(m+4,c)!==1)return o("Orientation data count is invalid");n.setUint16(m+8,1,c);break}return r(t.slice(i,i+2+f))}i+=2+f}return r(new Blob)}),e.readAsArrayBuffer(s)}),br={},Is={get exports(){return br},set exports(s){br=s}};(function(s){var r,o,e={};Is.exports=e,e.parse=function(t,n){for(var i=e.bin.readUshort,a=e.bin.readUint,f=0,p={},c=new Uint8Array(t),l=c.length-4;a(c,l)!=101010256;)l--;f=l,f+=4;var u=i(c,f+=4);i(c,f+=2);var m=a(c,f+=2),A=a(c,f+=4);f+=4,f=A;for(var C=0;C<u;C++){a(c,f),f+=4,f+=4,f+=4,a(c,f+=4),m=a(c,f+=4);var w=a(c,f+=4),x=i(c,f+=4),k=i(c,f+2),L=i(c,f+4);f+=6;var M=a(c,f+=8);f+=4,f+=x+k+L,e._readLocal(c,M,p,m,w,n)}return p},e._readLocal=function(t,n,i,a,f,p){var c=e.bin.readUshort,l=e.bin.readUint;l(t,n),c(t,n+=4),c(t,n+=2);var u=c(t,n+=2);l(t,n+=2),l(t,n+=4),n+=4;var m=c(t,n+=8),A=c(t,n+=2);n+=2;var C=e.bin.readUTF8(t,n,m);if(n+=m,n+=A,p)i[C]={size:f,csize:a};else{var w=new Uint8Array(t.buffer,n);if(u==0)i[C]=new Uint8Array(w.buffer.slice(n,n+a));else{if(u!=8)throw"unknown compression method: "+u;var x=new Uint8Array(f);e.inflateRaw(w,x),i[C]=x}}},e.inflateRaw=function(t,n){return e.F.inflate(t,n)},e.inflate=function(t,n){return t[0],t[1],e.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),n)},e.deflate=function(t,n){n==null&&(n={level:6});var i=0,a=new Uint8Array(50+Math.floor(1.1*t.length));a[i]=120,a[i+1]=156,i+=2,i=e.F.deflateRaw(t,a,i,n.level);var f=e.adler(t,0,t.length);return a[i+0]=f>>>24&255,a[i+1]=f>>>16&255,a[i+2]=f>>>8&255,a[i+3]=f>>>0&255,new Uint8Array(a.buffer,0,i+4)},e.deflateRaw=function(t,n){n==null&&(n={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),a=e.F.deflateRaw(t,i,a,n.level);return new Uint8Array(i.buffer,0,a)},e.encode=function(t,n){n==null&&(n=!1);var i=0,a=e.bin.writeUint,f=e.bin.writeUshort,p={};for(var c in t){var l=!e._noNeed(c)&&!n,u=t[c],m=e.crc.crc(u,0,u.length);p[c]={cpr:l,usize:u.length,crc:m,file:l?e.deflateRaw(u):u}}for(var c in p)i+=p[c].file.length+30+46+2*e.bin.sizeUTF8(c);i+=22;var A=new Uint8Array(i),C=0,w=[];for(var c in p){var x=p[c];w.push(C),C=e._writeHeader(A,C,c,x,0)}var k=0,L=C;for(var c in p)x=p[c],w.push(C),C=e._writeHeader(A,C,c,x,1,w[k++]);var M=C-L;return a(A,C,101010256),C+=4,f(A,C+=4,k),f(A,C+=2,k),a(A,C+=2,M),a(A,C+=4,L),C+=4,C+=2,A.buffer},e._noNeed=function(t){var n=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},e._writeHeader=function(t,n,i,a,f,p){var c=e.bin.writeUint,l=e.bin.writeUshort,u=a.file;return c(t,n,f==0?67324752:33639248),n+=4,f==1&&(n+=2),l(t,n,20),l(t,n+=2,0),l(t,n+=2,a.cpr?8:0),c(t,n+=2,0),c(t,n+=4,a.crc),c(t,n+=4,u.length),c(t,n+=4,a.usize),l(t,n+=4,e.bin.sizeUTF8(i)),l(t,n+=2,0),n+=2,f==1&&(n+=2,n+=2,c(t,n+=6,p),n+=4),n+=e.bin.writeUTF8(t,n,i),f==0&&(t.set(u,n),n+=u.length),n},e.crc={table:function(){for(var t=new Uint32Array(256),n=0;n<256;n++){for(var i=n,a=0;a<8;a++)1&i?i=3988292384^i>>>1:i>>>=1;t[n]=i}return t}(),update:function(t,n,i,a){for(var f=0;f<a;f++)t=e.crc.table[255&(t^n[i+f])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.adler=function(t,n,i){for(var a=1,f=0,p=n,c=n+i;p<c;){for(var l=Math.min(p+5552,c);p<l;)f+=a+=t[p++];a%=65521,f%=65521}return f<<16|a},e.bin={readUshort:function(t,n){return t[n]|t[n+1]<<8},writeUshort:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255},readUint:function(t,n){return 16777216*t[n+3]+(t[n+2]<<16|t[n+1]<<8|t[n])},writeUint:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255,t[n+2]=i>>16&255,t[n+3]=i>>24&255},readASCII:function(t,n,i){for(var a="",f=0;f<i;f++)a+=String.fromCharCode(t[n+f]);return a},writeASCII:function(t,n,i){for(var a=0;a<i.length;a++)t[n+a]=i.charCodeAt(a)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,n,i){for(var a,f="",p=0;p<i;p++)f+="%"+e.bin.pad(t[n+p].toString(16));try{a=decodeURIComponent(f)}catch{return e.bin.readASCII(t,n,i)}return a},writeUTF8:function(t,n,i){for(var a=i.length,f=0,p=0;p<a;p++){var c=i.charCodeAt(p);if(!(4294967168&c))t[n+f]=c,f++;else if(!(4294965248&c))t[n+f]=192|c>>6,t[n+f+1]=128|c>>0&63,f+=2;else if(!(4294901760&c))t[n+f]=224|c>>12,t[n+f+1]=128|c>>6&63,t[n+f+2]=128|c>>0&63,f+=3;else{if(4292870144&c)throw"e";t[n+f]=240|c>>18,t[n+f+1]=128|c>>12&63,t[n+f+2]=128|c>>6&63,t[n+f+3]=128|c>>0&63,f+=4}}return f},sizeUTF8:function(t){for(var n=t.length,i=0,a=0;a<n;a++){var f=t.charCodeAt(a);if(!(4294967168&f))i++;else if(!(4294965248&f))i+=2;else if(!(4294901760&f))i+=3;else{if(4292870144&f)throw"e";i+=4}}return i}},e.F={},e.F.deflateRaw=function(t,n,i,a){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],p=e.F.U,c=e.F._goodIndex;e.F._hash;var l=e.F._putsE,u=0,m=i<<3,A=0,C=t.length;if(a==0){for(;u<C;)l(n,m,u+(b=Math.min(65535,C-u))==C?1:0),m=e.F._copyExact(t,u,b,n,m+8),u+=b;return m>>>3}var w=p.lits,x=p.strt,k=p.prev,L=0,M=0,U=0,E=0,O=0,g=0;for(C>2&&(x[g=e.F._hash(t,0)]=0),u=0;u<C;u++){if(O=g,u+1<C-2){g=e.F._hash(t,u+1);var d=u+1&32767;k[d]=x[g],x[g]=d}if(A<=u){(L>14e3||M>26697)&&C-u>100&&(A<u&&(w[L]=u-A,L+=2,A=u),m=e.F._writeBlock(u==C-1||A==C?1:0,w,L,E,t,U,u-U,n,m),L=M=E=0,U=u);var v=0;u<C-2&&(v=e.F._bestMatch(t,u,k,O,Math.min(f[2],C-u),f[3]));var b=v>>>16,S=65535&v;if(v!=0){S=65535&v;var I=c(b=v>>>16,p.of0);p.lhst[257+I]++;var T=c(S,p.df0);p.dhst[T]++,E+=p.exb[I]+p.dxb[T],w[L]=b<<23|u-A,w[L+1]=S<<16|I<<8|T,L+=2,A=u+b}else p.lhst[t[u]]++;M++}}for(U==u&&t.length!=0||(A<u&&(w[L]=u-A,L+=2,A=u),m=e.F._writeBlock(1,w,L,E,t,U,u-U,n,m),L=0,M=0,L=M=E=0,U=u);7&m;)m++;return m>>>3},e.F._bestMatch=function(t,n,i,a,f,p){var c=32767&n,l=i[c],u=c-l+32768&32767;if(l==c||a!=e.F._hash(t,n-u))return 0;for(var m=0,A=0,C=Math.min(32767,n);u<=C&&--p!=0&&l!=c;){if(m==0||t[n+m]==t[n+m-u]){var w=e.F._howLong(t,n,u);if(w>m){if(A=u,(m=w)>=f)break;u+2<w&&(w=u+2);for(var x=0,k=0;k<w-2;k++){var L=n-u+k+32768&32767,M=L-i[L]+32768&32767;M>x&&(x=M,l=L)}}}u+=(c=l)-(l=i[c])+32768&32767}return m<<16|A},e.F._howLong=function(t,n,i){if(t[n]!=t[n-i]||t[n+1]!=t[n+1-i]||t[n+2]!=t[n+2-i])return 0;var a=n,f=Math.min(t.length,n+258);for(n+=3;n<f&&t[n]==t[n-i];)n++;return n-a},e.F._hash=function(t,n){return(t[n]<<8|t[n+1])+(t[n+2]<<4)&65535},e.saved=0,e.F._writeBlock=function(t,n,i,a,f,p,c,l,u){var m,A,C,w,x,k,L,M,U,E=e.F.U,O=e.F._putsF,g=e.F._putsE;E.lhst[256]++,A=(m=e.F.getTrees())[0],C=m[1],w=m[2],x=m[3],k=m[4],L=m[5],M=m[6],U=m[7];var d=32+(u+3&7?8-(u+3&7):0)+(c<<3),v=a+e.F.contSize(E.fltree,E.lhst)+e.F.contSize(E.fdtree,E.dhst),b=a+e.F.contSize(E.ltree,E.lhst)+e.F.contSize(E.dtree,E.dhst);b+=14+3*L+e.F.contSize(E.itree,E.ihst)+(2*E.ihst[16]+3*E.ihst[17]+7*E.ihst[18]);for(var S=0;S<286;S++)E.lhst[S]=0;for(S=0;S<30;S++)E.dhst[S]=0;for(S=0;S<19;S++)E.ihst[S]=0;var I=d<v&&d<b?0:v<b?1:2;if(O(l,u,t),O(l,u+1,I),u+=3,I==0){for(;7&u;)u++;u=e.F._copyExact(f,p,c,l,u)}else{var T,_;if(I==1&&(T=E.fltree,_=E.fdtree),I==2){e.F.makeCodes(E.ltree,A),e.F.revCodes(E.ltree,A),e.F.makeCodes(E.dtree,C),e.F.revCodes(E.dtree,C),e.F.makeCodes(E.itree,w),e.F.revCodes(E.itree,w),T=E.ltree,_=E.dtree,g(l,u,x-257),g(l,u+=5,k-1),g(l,u+=5,L-4),u+=4;for(var y=0;y<L;y++)g(l,u+3*y,E.itree[1+(E.ordr[y]<<1)]);u+=3*L,u=e.F._codeTiny(M,E.itree,l,u),u=e.F._codeTiny(U,E.itree,l,u)}for(var h=p,D=0;D<i;D+=2){for(var P=n[D],F=P>>>23,q=h+(8388607&P);h<q;)u=e.F._writeLit(f[h++],T,l,u);if(F!=0){var H=n[D+1],G=H>>16,N=H>>8&255,R=255&H;g(l,u=e.F._writeLit(257+N,T,l,u),F-E.of0[N]),u+=E.exb[N],O(l,u=e.F._writeLit(R,_,l,u),G-E.df0[R]),u+=E.dxb[R],h+=F}}u=e.F._writeLit(256,T,l,u)}return u},e.F._copyExact=function(t,n,i,a,f){var p=f>>>3;return a[p]=i,a[p+1]=i>>>8,a[p+2]=255-a[p],a[p+3]=255-a[p+1],p+=4,a.set(new Uint8Array(t.buffer,n,i),p),f+(i+4<<3)},e.F.getTrees=function(){for(var t=e.F.U,n=e.F._hufTree(t.lhst,t.ltree,15),i=e.F._hufTree(t.dhst,t.dtree,15),a=[],f=e.F._lenCodes(t.ltree,a),p=[],c=e.F._lenCodes(t.dtree,p),l=0;l<a.length;l+=2)t.ihst[a[l]]++;for(l=0;l<p.length;l+=2)t.ihst[p[l]]++;for(var u=e.F._hufTree(t.ihst,t.itree,7),m=19;m>4&&t.itree[1+(t.ordr[m-1]<<1)]==0;)m--;return[n,i,u,f,c,m,a,p]},e.F.getSecond=function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(t[i+1]);return n},e.F.nonZero=function(t){for(var n="",i=0;i<t.length;i+=2)t[i+1]!=0&&(n+=(i>>1)+",");return n},e.F.contSize=function(t,n){for(var i=0,a=0;a<n.length;a++)i+=n[a]*t[1+(a<<1)];return i},e.F._codeTiny=function(t,n,i,a){for(var f=0;f<t.length;f+=2){var p=t[f],c=t[f+1];a=e.F._writeLit(p,n,i,a);var l=p==16?2:p==17?3:7;p>15&&(e.F._putsE(i,a,c,l),a+=l)}return a},e.F._lenCodes=function(t,n){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var a=0;a<i;a+=2){var f=t[a+1],p=a+3<i?t[a+3]:-1,c=a+5<i?t[a+5]:-1,l=a==0?-1:t[a-1];if(f==0&&p==f&&c==f){for(var u=a+5;u+2<i&&t[u+2]==f;)u+=2;(m=Math.min(u+1-a>>>1,138))<11?n.push(17,m-3):n.push(18,m-11),a+=2*m-2}else if(f==l&&p==f&&c==f){for(u=a+5;u+2<i&&t[u+2]==f;)u+=2;var m=Math.min(u+1-a>>>1,6);n.push(16,m-3),a+=2*m-2}else n.push(f,0)}return i>>>1},e.F._hufTree=function(t,n,i){var a=[],f=t.length,p=n.length,c=0;for(c=0;c<p;c+=2)n[c]=0,n[c+1]=0;for(c=0;c<f;c++)t[c]!=0&&a.push({lit:c,f:t[c]});var l=a.length,u=a.slice(0);if(l==0)return 0;if(l==1){var m=a[0].lit;return u=m==0?1:0,n[1+(m<<1)]=1,n[1+(u<<1)]=1,1}a.sort(function(M,U){return M.f-U.f});var A=a[0],C=a[1],w=0,x=1,k=2;for(a[0]={lit:-1,f:A.f+C.f,l:A,r:C,d:0};x!=l-1;)A=w!=x&&(k==l||a[w].f<a[k].f)?a[w++]:a[k++],C=w!=x&&(k==l||a[w].f<a[k].f)?a[w++]:a[k++],a[x++]={lit:-1,f:A.f+C.f,l:A,r:C};var L=e.F.setDepth(a[x-1],0);for(L>i&&(e.F.restrictDepth(u,i,L),L=i),c=0;c<l;c++)n[1+(u[c].lit<<1)]=u[c].d;return L},e.F.setDepth=function(t,n){return t.lit!=-1?(t.d=n,n):Math.max(e.F.setDepth(t.l,n+1),e.F.setDepth(t.r,n+1))},e.F.restrictDepth=function(t,n,i){var a=0,f=1<<i-n,p=0;for(t.sort(function(l,u){return u.d==l.d?l.f-u.f:u.d-l.d}),a=0;a<t.length&&t[a].d>n;a++){var c=t[a].d;t[a].d=n,p+=f-(1<<i-c)}for(p>>>=i-n;p>0;)(c=t[a].d)<n?(t[a].d++,p-=1<<n-c-1):a++;for(;a>=0;a--)t[a].d==n&&p<0&&(t[a].d--,p++);p!=0},e.F._goodIndex=function(t,n){var i=0;return n[16|i]<=t&&(i|=16),n[8|i]<=t&&(i|=8),n[4|i]<=t&&(i|=4),n[2|i]<=t&&(i|=2),n[1|i]<=t&&(i|=1),i},e.F._writeLit=function(t,n,i,a){return e.F._putsF(i,a,n[t<<1]),a+n[1+(t<<1)]},e.F.inflate=function(t,n){var i=Uint8Array;if(t[0]==3&&t[1]==0)return n||new i(0);var a=e.F,f=a._bitsF,p=a._bitsE,c=a._decodeTiny,l=a.makeCodes,u=a.codes2map,m=a._get17,A=a.U,C=n==null;C&&(n=new i(t.length>>>2<<3));for(var w,x,k=0,L=0,M=0,U=0,E=0,O=0,g=0,d=0,v=0;k==0;)if(k=f(t,v,1),L=f(t,v+1,2),v+=3,L!=0){if(C&&(n=e.F._check(n,d+(1<<17))),L==1&&(w=A.flmap,x=A.fdmap,O=511,g=31),L==2){M=p(t,v,5)+257,U=p(t,v+5,5)+1,E=p(t,v+10,4)+4,v+=14;for(var b=0;b<38;b+=2)A.itree[b]=0,A.itree[b+1]=0;var S=1;for(b=0;b<E;b++){var I=p(t,v+3*b,3);A.itree[1+(A.ordr[b]<<1)]=I,I>S&&(S=I)}v+=3*E,l(A.itree,S),u(A.itree,S,A.imap),w=A.lmap,x=A.dmap,v=c(A.imap,(1<<S)-1,M+U,t,v,A.ttree);var T=a._copyOut(A.ttree,0,M,A.ltree);O=(1<<T)-1;var _=a._copyOut(A.ttree,M,U,A.dtree);g=(1<<_)-1,l(A.ltree,T),u(A.ltree,T,w),l(A.dtree,_),u(A.dtree,_,x)}for(;;){var y=w[m(t,v)&O];v+=15&y;var h=y>>>4;if(!(h>>>8))n[d++]=h;else{if(h==256)break;var D=d+h-254;if(h>264){var P=A.ldef[h-257];D=d+(P>>>3)+p(t,v,7&P),v+=7&P}var F=x[m(t,v)&g];v+=15&F;var q=F>>>4,H=A.ddef[q],G=(H>>>4)+f(t,v,15&H);for(v+=15&H,C&&(n=e.F._check(n,d+(1<<17)));d<D;)n[d]=n[d++-G],n[d]=n[d++-G],n[d]=n[d++-G],n[d]=n[d++-G];d=D}}}else{7&v&&(v+=8-(7&v));var N=4+(v>>>3),R=t[N-4]|t[N-3]<<8;C&&(n=e.F._check(n,d+R)),n.set(new i(t.buffer,t.byteOffset+N,R),d),v=N+R<<3,d+=R}return n.length==d?n:n.slice(0,d)},e.F._check=function(t,n){var i=t.length;if(n<=i)return t;var a=new Uint8Array(Math.max(i<<1,n));return a.set(t,0),a},e.F._decodeTiny=function(t,n,i,a,f,p){for(var c=e.F._bitsE,l=e.F._get17,u=0;u<i;){var m=t[l(a,f)&n];f+=15&m;var A=m>>>4;if(A<=15)p[u]=A,u++;else{var C=0,w=0;A==16?(w=3+c(a,f,2),f+=2,C=p[u-1]):A==17?(w=3+c(a,f,3),f+=3):A==18&&(w=11+c(a,f,7),f+=7);for(var x=u+w;u<x;)p[u]=C,u++}}return f},e.F._copyOut=function(t,n,i,a){for(var f=0,p=0,c=a.length>>>1;p<i;){var l=t[p+n];a[p<<1]=0,a[1+(p<<1)]=l,l>f&&(f=l),p++}for(;p<c;)a[p<<1]=0,a[1+(p<<1)]=0,p++;return f},e.F.makeCodes=function(t,n){for(var i,a,f,p,c=e.F.U,l=t.length,u=c.bl_count,m=0;m<=n;m++)u[m]=0;for(m=1;m<l;m+=2)u[t[m]]++;var A=c.next_code;for(i=0,u[0]=0,a=1;a<=n;a++)i=i+u[a-1]<<1,A[a]=i;for(f=0;f<l;f+=2)(p=t[f+1])!=0&&(t[f]=A[p],A[p]++)},e.F.codes2map=function(t,n,i){for(var a=t.length,f=e.F.U.rev15,p=0;p<a;p+=2)if(t[p+1]!=0)for(var c=p>>1,l=t[p+1],u=c<<4|l,m=n-l,A=t[p]<<m,C=A+(1<<m);A!=C;)i[f[A]>>>15-n]=u,A++},e.F.revCodes=function(t,n){for(var i=e.F.U.rev15,a=15-n,f=0;f<t.length;f+=2){var p=t[f]<<n-t[f+1];t[f]=i[p]>>>a}},e.F._putsE=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8},e.F._putsF=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8,t[a+2]|=i>>>16},e.F._bitsE=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8)>>>(7&n)&(1<<i)-1},e.F._bitsF=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)&(1<<i)-1},e.F._get17=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)},e.F._get25=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16|t[3+(n>>>3)]<<24)>>>(7&n)},e.F.U=(r=Uint16Array,o=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var t=e.F.U,n=0;n<32768;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[n]=(i>>>16|i<<16)>>>17}function a(f,p,c){for(;p--!=0;)f.push(0,c)}for(n=0;n<32;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];a(t.fltree,144,8),a(t.fltree,112,9),a(t.fltree,24,7),a(t.fltree,8,8),e.F.makeCodes(t.fltree,9),e.F.codes2map(t.fltree,9,t.flmap),e.F.revCodes(t.fltree,9),a(t.fdtree,32,5),e.F.makeCodes(t.fdtree,5),e.F.codes2map(t.fdtree,5,t.fdmap),e.F.revCodes(t.fdtree,5),a(t.itree,19,0),a(t.ltree,286,0),a(t.dtree,30,0),a(t.ttree,320,0)}()})();var _s=bs({__proto__:null,default:br},[br]),Dt=function(){var s={nextZero(c,l){for(;c[l]!=0;)l++;return l},readUshort:(c,l)=>c[l]<<8|c[l+1],writeUshort(c,l,u){c[l]=u>>8&255,c[l+1]=255&u},readUint:(c,l)=>16777216*c[l]+(c[l+1]<<16|c[l+2]<<8|c[l+3]),writeUint(c,l,u){c[l]=u>>24&255,c[l+1]=u>>16&255,c[l+2]=u>>8&255,c[l+3]=255&u},readASCII(c,l,u){let m="";for(let A=0;A<u;A++)m+=String.fromCharCode(c[l+A]);return m},writeASCII(c,l,u){for(let m=0;m<u.length;m++)c[l+m]=u.charCodeAt(m)},readBytes(c,l,u){let m=[];for(let A=0;A<u;A++)m.push(c[l+A]);return m},pad:c=>c.length<2?`0${c}`:c,readUTF8(c,l,u){let m,A="";for(let C=0;C<u;C++)A+=`%${s.pad(c[l+C].toString(16))}`;try{m=decodeURIComponent(A)}catch{return s.readASCII(c,l,u)}return m}};function r(c,l,u,m){let A=l*u,C=n(m),w=Math.ceil(l*C/8),x=new Uint8Array(4*A),k=new Uint32Array(x.buffer),{ctype:L}=m,{depth:M}=m,U=s.readUshort;if(L==6){let P=A<<2;if(M==8)for(var E=0;E<P;E+=4)x[E]=c[E],x[E+1]=c[E+1],x[E+2]=c[E+2],x[E+3]=c[E+3];if(M==16)for(E=0;E<P;E++)x[E]=c[E<<1]}else if(L==2){let P=m.tabs.tRNS;if(P==null){if(M==8)for(E=0;E<A;E++){var O=3*E;k[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O]}if(M==16)for(E=0;E<A;E++)O=6*E,k[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O]}else{var g=P[0];let F=P[1],q=P[2];if(M==8)for(E=0;E<A;E++){var d=E<<2;O=3*E,k[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O],c[O]==g&&c[O+1]==F&&c[O+2]==q&&(x[d+3]=0)}if(M==16)for(E=0;E<A;E++)d=E<<2,O=6*E,k[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O],U(c,O)==g&&U(c,O+2)==F&&U(c,O+4)==q&&(x[d+3]=0)}}else if(L==3){let P=m.tabs.PLTE,F=m.tabs.tRNS,q=F?F.length:0;if(M==1)for(var v=0;v<u;v++){var b=v*w,S=v*l;for(E=0;E<l;E++){d=S+E<<2;var I=3*(T=c[b+(E>>3)]>>7-((7&E)<<0)&1);x[d]=P[I],x[d+1]=P[I+1],x[d+2]=P[I+2],x[d+3]=T<q?F[T]:255}}if(M==2)for(v=0;v<u;v++)for(b=v*w,S=v*l,E=0;E<l;E++)d=S+E<<2,I=3*(T=c[b+(E>>2)]>>6-((3&E)<<1)&3),x[d]=P[I],x[d+1]=P[I+1],x[d+2]=P[I+2],x[d+3]=T<q?F[T]:255;if(M==4)for(v=0;v<u;v++)for(b=v*w,S=v*l,E=0;E<l;E++)d=S+E<<2,I=3*(T=c[b+(E>>1)]>>4-((1&E)<<2)&15),x[d]=P[I],x[d+1]=P[I+1],x[d+2]=P[I+2],x[d+3]=T<q?F[T]:255;if(M==8)for(E=0;E<A;E++){var T;d=E<<2,I=3*(T=c[E]),x[d]=P[I],x[d+1]=P[I+1],x[d+2]=P[I+2],x[d+3]=T<q?F[T]:255}}else if(L==4){if(M==8)for(E=0;E<A;E++){d=E<<2;var _=c[y=E<<1];x[d]=_,x[d+1]=_,x[d+2]=_,x[d+3]=c[y+1]}if(M==16)for(E=0;E<A;E++){var y;d=E<<2,_=c[y=E<<2],x[d]=_,x[d+1]=_,x[d+2]=_,x[d+3]=c[y+2]}}else if(L==0)for(g=m.tabs.tRNS?m.tabs.tRNS:-1,v=0;v<u;v++){let P=v*w,F=v*l;if(M==1)for(var h=0;h<l;h++){var D=(_=255*(c[P+(h>>>3)]>>>7-(7&h)&1))==255*g?0:255;k[F+h]=D<<24|_<<16|_<<8|_}else if(M==2)for(h=0;h<l;h++)D=(_=85*(c[P+(h>>>2)]>>>6-((3&h)<<1)&3))==85*g?0:255,k[F+h]=D<<24|_<<16|_<<8|_;else if(M==4)for(h=0;h<l;h++)D=(_=17*(c[P+(h>>>1)]>>>4-((1&h)<<2)&15))==17*g?0:255,k[F+h]=D<<24|_<<16|_<<8|_;else if(M==8)for(h=0;h<l;h++)D=(_=c[P+h])==g?0:255,k[F+h]=D<<24|_<<16|_<<8|_;else if(M==16)for(h=0;h<l;h++)_=c[P+(h<<1)],D=U(c,P+(h<<1))==g?0:255,k[F+h]=D<<24|_<<16|_<<8|_}return x}function o(c,l,u,m){let A=n(c),C=Math.ceil(u*A/8),w=new Uint8Array((C+1+c.interlace)*m);return l=c.tabs.CgBI?t(l,w):e(l,w),c.interlace==0?l=i(l,c,0,u,m):c.interlace==1&&(l=function(k,L){let M=L.width,U=L.height,E=n(L),O=E>>3,g=Math.ceil(M*E/8),d=new Uint8Array(U*g),v=0,b=[0,0,4,0,2,0,1],S=[0,4,0,2,0,1,0],I=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1],_=0;for(;_<7;){let h=I[_],D=T[_],P=0,F=0,q=b[_];for(;q<U;)q+=h,F++;let H=S[_];for(;H<M;)H+=D,P++;let G=Math.ceil(P*E/8);i(k,L,v,P,F);let N=0,R=b[_];for(;R<U;){let W=S[_],tt=v+N*G<<3;for(;W<M;){var y;if(E==1&&(y=(y=k[tt>>3])>>7-(7&tt)&1,d[R*g+(W>>3)]|=y<<7-((7&W)<<0)),E==2&&(y=(y=k[tt>>3])>>6-(7&tt)&3,d[R*g+(W>>2)]|=y<<6-((3&W)<<1)),E==4&&(y=(y=k[tt>>3])>>4-(7&tt)&15,d[R*g+(W>>1)]|=y<<4-((1&W)<<2)),E>=8){let X=R*g+W*O;for(let $=0;$<O;$++)d[X+$]=k[(tt>>3)+$]}tt+=E,W+=D}N++,R+=h}P*F!=0&&(v+=F*(1+G)),_+=1}return d}(l,c)),l}function e(c,l){return t(new Uint8Array(c.buffer,2,c.length-6),l)}var t=function(){let c={H:{}};return c.H.N=function(l,u){let m=Uint8Array,A,C,w=0,x=0,k=0,L=0,M=0,U=0,E=0,O=0,g=0;if(l[0]==3&&l[1]==0)return u||new m(0);let d=c.H,v=d.b,b=d.e,S=d.R,I=d.n,T=d.A,_=d.Z,y=d.m,h=u==null;for(h&&(u=new m(l.length>>>2<<5));w==0;)if(w=v(l,g,1),x=v(l,g+1,2),g+=3,x!=0){if(h&&(u=c.H.W(u,O+(1<<17))),x==1&&(A=y.J,C=y.h,U=511,E=31),x==2){k=b(l,g,5)+257,L=b(l,g+5,5)+1,M=b(l,g+10,4)+4,g+=14;let P=1;for(var D=0;D<38;D+=2)y.Q[D]=0,y.Q[D+1]=0;for(D=0;D<M;D++){let H=b(l,g+3*D,3);y.Q[1+(y.X[D]<<1)]=H,H>P&&(P=H)}g+=3*M,I(y.Q,P),T(y.Q,P,y.u),A=y.w,C=y.d,g=S(y.u,(1<<P)-1,k+L,l,g,y.v);let F=d.V(y.v,0,k,y.C);U=(1<<F)-1;let q=d.V(y.v,k,L,y.D);E=(1<<q)-1,I(y.C,F),T(y.C,F,A),I(y.D,q),T(y.D,q,C)}for(;;){let P=A[_(l,g)&U];g+=15&P;let F=P>>>4;if(!(F>>>8))u[O++]=F;else{if(F==256)break;{let q=O+F-254;if(F>264){let W=y.q[F-257];q=O+(W>>>3)+b(l,g,7&W),g+=7&W}let H=C[_(l,g)&E];g+=15&H;let G=H>>>4,N=y.c[G],R=(N>>>4)+v(l,g,15&N);for(g+=15&N;O<q;)u[O]=u[O++-R],u[O]=u[O++-R],u[O]=u[O++-R],u[O]=u[O++-R];O=q}}}}else{7&g&&(g+=8-(7&g));let P=4+(g>>>3),F=l[P-4]|l[P-3]<<8;h&&(u=c.H.W(u,O+F)),u.set(new m(l.buffer,l.byteOffset+P,F),O),g=P+F<<3,O+=F}return u.length==O?u:u.slice(0,O)},c.H.W=function(l,u){let m=l.length;if(u<=m)return l;let A=new Uint8Array(m<<1);return A.set(l,0),A},c.H.R=function(l,u,m,A,C,w){let x=c.H.e,k=c.H.Z,L=0;for(;L<m;){let M=l[k(A,C)&u];C+=15&M;let U=M>>>4;if(U<=15)w[L]=U,L++;else{let E=0,O=0;U==16?(O=3+x(A,C,2),C+=2,E=w[L-1]):U==17?(O=3+x(A,C,3),C+=3):U==18&&(O=11+x(A,C,7),C+=7);let g=L+O;for(;L<g;)w[L]=E,L++}}return C},c.H.V=function(l,u,m,A){let C=0,w=0,x=A.length>>>1;for(;w<m;){let k=l[w+u];A[w<<1]=0,A[1+(w<<1)]=k,k>C&&(C=k),w++}for(;w<x;)A[w<<1]=0,A[1+(w<<1)]=0,w++;return C},c.H.n=function(l,u){let m=c.H.m,A=l.length,C,w,x,k,L=m.j;for(var M=0;M<=u;M++)L[M]=0;for(M=1;M<A;M+=2)L[l[M]]++;let U=m.K;for(C=0,L[0]=0,w=1;w<=u;w++)C=C+L[w-1]<<1,U[w]=C;for(x=0;x<A;x+=2)k=l[x+1],k!=0&&(l[x]=U[k],U[k]++)},c.H.A=function(l,u,m){let A=l.length,C=c.H.m.r;for(let w=0;w<A;w+=2)if(l[w+1]!=0){let x=w>>1,k=l[w+1],L=x<<4|k,M=u-k,U=l[w]<<M,E=U+(1<<M);for(;U!=E;)m[C[U]>>>15-u]=L,U++}},c.H.l=function(l,u){let m=c.H.m.r,A=15-u;for(let C=0;C<l.length;C+=2){let w=l[C]<<u-l[C+1];l[C]=m[w]>>>A}},c.H.M=function(l,u,m){m<<=7&u;let A=u>>>3;l[A]|=m,l[A+1]|=m>>>8},c.H.I=function(l,u,m){m<<=7&u;let A=u>>>3;l[A]|=m,l[A+1]|=m>>>8,l[A+2]|=m>>>16},c.H.e=function(l,u,m){return(l[u>>>3]|l[1+(u>>>3)]<<8)>>>(7&u)&(1<<m)-1},c.H.b=function(l,u,m){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)&(1<<m)-1},c.H.Z=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)},c.H.i=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16|l[3+(u>>>3)]<<24)>>>(7&u)},c.H.m=function(){let l=Uint16Array,u=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new u(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new u(286),Y:new u(30),a:new u(19),t:new u(15e3),k:new l(65536),g:new l(32768)}}(),function(){let l=c.H.m;for(var u=0;u<32768;u++){let A=u;A=(2863311530&A)>>>1|(1431655765&A)<<1,A=(3435973836&A)>>>2|(858993459&A)<<2,A=(4042322160&A)>>>4|(252645135&A)<<4,A=(4278255360&A)>>>8|(16711935&A)<<8,l.r[u]=(A>>>16|A<<16)>>>17}function m(A,C,w){for(;C--!=0;)A.push(0,w)}for(u=0;u<32;u++)l.q[u]=l.S[u]<<3|l.T[u],l.c[u]=l.p[u]<<4|l.z[u];m(l._,144,8),m(l._,112,9),m(l._,24,7),m(l._,8,8),c.H.n(l._,9),c.H.A(l._,9,l.J),c.H.l(l._,9),m(l.$,32,5),c.H.n(l.$,5),c.H.A(l.$,5,l.h),c.H.l(l.$,5),m(l.Q,19,0),m(l.C,286,0),m(l.D,30,0),m(l.v,320,0)}(),c.H.N}();function n(c){return[1,null,3,1,2,null,4][c.ctype]*c.depth}function i(c,l,u,m,A){let C=n(l),w=Math.ceil(m*C/8),x,k;C=Math.ceil(C/8);let L=c[u],M=0;if(L>1&&(c[u]=[0,0,1][L-2]),L==3)for(M=C;M<w;M++)c[M+1]=c[M+1]+(c[M+1-C]>>>1)&255;for(let U=0;U<A;U++)if(x=u+U*w,k=x+U+1,L=c[k-1],M=0,L==0)for(;M<w;M++)c[x+M]=c[k+M];else if(L==1){for(;M<C;M++)c[x+M]=c[k+M];for(;M<w;M++)c[x+M]=c[k+M]+c[x+M-C]}else if(L==2)for(;M<w;M++)c[x+M]=c[k+M]+c[x+M-w];else if(L==3){for(;M<C;M++)c[x+M]=c[k+M]+(c[x+M-w]>>>1);for(;M<w;M++)c[x+M]=c[k+M]+(c[x+M-w]+c[x+M-C]>>>1)}else{for(;M<C;M++)c[x+M]=c[k+M]+a(0,c[x+M-w],0);for(;M<w;M++)c[x+M]=c[k+M]+a(c[x+M-C],c[x+M-w],c[x+M-C-w])}return c}function a(c,l,u){let m=c+l-u,A=m-c,C=m-l,w=m-u;return A*A<=C*C&&A*A<=w*w?c:C*C<=w*w?l:u}function f(c,l,u){u.width=s.readUint(c,l),l+=4,u.height=s.readUint(c,l),l+=4,u.depth=c[l],l++,u.ctype=c[l],l++,u.compress=c[l],l++,u.filter=c[l],l++,u.interlace=c[l],l++}function p(c,l,u,m,A,C,w,x,k){let L=Math.min(l,A),M=Math.min(u,C),U=0,E=0;for(let _=0;_<M;_++)for(let y=0;y<L;y++)if(w>=0&&x>=0?(U=_*l+y<<2,E=(x+_)*A+w+y<<2):(U=(-x+_)*l-w+y<<2,E=_*A+y<<2),k==0)m[E]=c[U],m[E+1]=c[U+1],m[E+2]=c[U+2],m[E+3]=c[U+3];else if(k==1){var O=c[U+3]*.00392156862745098,g=c[U]*O,d=c[U+1]*O,v=c[U+2]*O,b=m[E+3]*(1/255),S=m[E]*b,I=m[E+1]*b,T=m[E+2]*b;let h=1-O,D=O+b*h,P=D==0?0:1/D;m[E+3]=255*D,m[E+0]=(g+S*h)*P,m[E+1]=(d+I*h)*P,m[E+2]=(v+T*h)*P}else if(k==2)O=c[U+3],g=c[U],d=c[U+1],v=c[U+2],b=m[E+3],S=m[E],I=m[E+1],T=m[E+2],O==b&&g==S&&d==I&&v==T?(m[E]=0,m[E+1]=0,m[E+2]=0,m[E+3]=0):(m[E]=g,m[E+1]=d,m[E+2]=v,m[E+3]=O);else if(k==3){if(O=c[U+3],g=c[U],d=c[U+1],v=c[U+2],b=m[E+3],S=m[E],I=m[E+1],T=m[E+2],O==b&&g==S&&d==I&&v==T)continue;if(O<220&&b>20)return!1}return!0}return{decode:function(l){let u=new Uint8Array(l),m=8,A=s,C=A.readUshort,w=A.readUint,x={tabs:{},frames:[]},k=new Uint8Array(u.length),L,M=0,U=0,E=[137,80,78,71,13,10,26,10];for(var O=0;O<8;O++)if(u[O]!=E[O])throw"The input is not a PNG file!";for(;m<u.length;){let _=A.readUint(u,m);m+=4;let y=A.readASCII(u,m,4);if(m+=4,y=="IHDR")f(u,m,x);else if(y=="iCCP"){for(var g=m;u[g]!=0;)g++;A.readASCII(u,m,g-m),u[g+1];let h=u.slice(g+2,m+_),D=null;try{D=e(h)}catch{D=t(h)}x.tabs[y]=D}else if(y=="CgBI")x.tabs[y]=u.slice(m,m+4);else if(y=="IDAT"){for(O=0;O<_;O++)k[M+O]=u[m+O];M+=_}else if(y=="acTL")x.tabs[y]={num_frames:w(u,m),num_plays:w(u,m+4)},L=new Uint8Array(u.length);else if(y=="fcTL"){U!=0&&((T=x.frames[x.frames.length-1]).data=o(x,L.slice(0,U),T.rect.width,T.rect.height),U=0);let h={x:w(u,m+12),y:w(u,m+16),width:w(u,m+4),height:w(u,m+8)},D=C(u,m+22);D=C(u,m+20)/(D==0?100:D);let P={rect:h,delay:Math.round(1e3*D),dispose:u[m+24],blend:u[m+25]};x.frames.push(P)}else if(y=="fdAT"){for(O=0;O<_-4;O++)L[U+O]=u[m+O+4];U+=_-4}else if(y=="pHYs")x.tabs[y]=[A.readUint(u,m),A.readUint(u,m+4),u[m+8]];else if(y=="cHRM")for(x.tabs[y]=[],O=0;O<8;O++)x.tabs[y].push(A.readUint(u,m+4*O));else if(y=="tEXt"||y=="zTXt"){x.tabs[y]==null&&(x.tabs[y]={});var d=A.nextZero(u,m),v=A.readASCII(u,m,d-m),b=m+_-d-1;if(y=="tEXt")I=A.readASCII(u,d+1,b);else{var S=e(u.slice(d+2,d+2+b));I=A.readUTF8(S,0,S.length)}x.tabs[y][v]=I}else if(y=="iTXt"){x.tabs[y]==null&&(x.tabs[y]={}),d=0,g=m,d=A.nextZero(u,g),v=A.readASCII(u,g,d-g);let h=u[g=d+1];var I;u[g+1],g+=2,d=A.nextZero(u,g),A.readASCII(u,g,d-g),g=d+1,d=A.nextZero(u,g),A.readUTF8(u,g,d-g),b=_-((g=d+1)-m),h==0?I=A.readUTF8(u,g,b):(S=e(u.slice(g,g+b)),I=A.readUTF8(S,0,S.length)),x.tabs[y][v]=I}else if(y=="PLTE")x.tabs[y]=A.readBytes(u,m,_);else if(y=="hIST"){let h=x.tabs.PLTE.length/3;for(x.tabs[y]=[],O=0;O<h;O++)x.tabs[y].push(C(u,m+2*O))}else if(y=="tRNS")x.ctype==3?x.tabs[y]=A.readBytes(u,m,_):x.ctype==0?x.tabs[y]=C(u,m):x.ctype==2&&(x.tabs[y]=[C(u,m),C(u,m+2),C(u,m+4)]);else if(y=="gAMA")x.tabs[y]=A.readUint(u,m)/1e5;else if(y=="sRGB")x.tabs[y]=u[m];else if(y=="bKGD")x.ctype==0||x.ctype==4?x.tabs[y]=[C(u,m)]:x.ctype==2||x.ctype==6?x.tabs[y]=[C(u,m),C(u,m+2),C(u,m+4)]:x.ctype==3&&(x.tabs[y]=u[m]);else if(y=="IEND")break;m+=_,A.readUint(u,m),m+=4}var T;return U!=0&&((T=x.frames[x.frames.length-1]).data=o(x,L.slice(0,U),T.rect.width,T.rect.height)),x.data=o(x,k,x.width,x.height),delete x.compress,delete x.interlace,delete x.filter,x},toRGBA8:function(l){let u=l.width,m=l.height;if(l.tabs.acTL==null)return[r(l.data,u,m,l).buffer];let A=[];l.frames[0].data==null&&(l.frames[0].data=l.data);let C=u*m*4,w=new Uint8Array(C),x=new Uint8Array(C),k=new Uint8Array(C);for(let M=0;M<l.frames.length;M++){let U=l.frames[M],E=U.rect.x,O=U.rect.y,g=U.rect.width,d=U.rect.height,v=r(U.data,g,d,l);if(M!=0)for(var L=0;L<C;L++)k[L]=w[L];if(U.blend==0?p(v,g,d,w,u,m,E,O,0):U.blend==1&&p(v,g,d,w,u,m,E,O,1),A.push(w.buffer.slice(0)),U.dispose!=0){if(U.dispose==1)p(x,g,d,w,u,m,E,O,0);else if(U.dispose==2)for(L=0;L<C;L++)w[L]=k[L]}}return A},_paeth:a,_copyTile:p,_bin:s}}();(function(){let{_copyTile:s}=Dt,{_bin:r}=Dt,o=Dt._paeth;var e={table:function(){let g=new Uint32Array(256);for(let d=0;d<256;d++){let v=d;for(let b=0;b<8;b++)1&v?v=3988292384^v>>>1:v>>>=1;g[d]=v}return g}(),update(g,d,v,b){for(let S=0;S<b;S++)g=e.table[255&(g^d[v+S])]^g>>>8;return g},crc:(g,d,v)=>4294967295^e.update(4294967295,g,d,v)};function t(g,d,v,b){d[v]+=g[0]*b>>4,d[v+1]+=g[1]*b>>4,d[v+2]+=g[2]*b>>4,d[v+3]+=g[3]*b>>4}function n(g){return Math.max(0,Math.min(255,g))}function i(g,d){let v=g[0]-d[0],b=g[1]-d[1],S=g[2]-d[2],I=g[3]-d[3];return v*v+b*b+S*S+I*I}function a(g,d,v,b,S,I,T){T==null&&(T=1);let _=b.length,y=[];for(var h=0;h<_;h++){let R=b[h];y.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(h=0;h<_;h++){let R=4294967295;for(var D=0,P=0;P<_;P++){var F=i(y[h],y[P]);P!=h&&F<R&&(R=F,D=P)}}let q=new Uint32Array(S.buffer),H=new Int16Array(d*v*4),G=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(h=0;h<G.length;h++)G[h]=255*((G[h]+.5)/16-.5);for(let R=0;R<v;R++)for(let W=0;W<d;W++){var N;h=4*(R*d+W),T!=2?N=[n(g[h]+H[h]),n(g[h+1]+H[h+1]),n(g[h+2]+H[h+2]),n(g[h+3]+H[h+3])]:(F=G[4*(3&R)+(3&W)],N=[n(g[h]+F),n(g[h+1]+F),n(g[h+2]+F),n(g[h+3]+F)]),D=0;let tt=16777215;for(P=0;P<_;P++){let Y=i(N,y[P]);Y<tt&&(tt=Y,D=P)}let X=y[D],$=[N[0]-X[0],N[1]-X[1],N[2]-X[2],N[3]-X[3]];T==1&&(W!=d-1&&t($,H,h+4,7),R!=v-1&&(W!=0&&t($,H,h+4*d-4,3),t($,H,h+4*d,5),W!=d-1&&t($,H,h+4*d+4,1))),I[h>>2]=D,q[h>>2]=b[D]}}function f(g,d,v,b,S){S==null&&(S={});let{crc:I}=e,T=r.writeUint,_=r.writeUshort,y=r.writeASCII,h=8,D=g.frames.length>1,P,F=!1,q=33+(D?20:0);if(S.sRGB!=null&&(q+=13),S.pHYs!=null&&(q+=21),S.iCCP!=null&&(P=pako.deflate(S.iCCP),q+=21+P.length+4),g.ctype==3){for(var H=g.plte.length,G=0;G<H;G++)g.plte[G]>>>24!=255&&(F=!0);q+=8+3*H+4+(F?8+1*H+4:0)}for(var N=0;N<g.frames.length;N++)D&&(q+=38),q+=(X=g.frames[N]).cimg.length+12,N!=0&&(q+=4);q+=12;let R=new Uint8Array(q),W=[137,80,78,71,13,10,26,10];for(G=0;G<8;G++)R[G]=W[G];if(T(R,h,13),h+=4,y(R,h,"IHDR"),h+=4,T(R,h,d),h+=4,T(R,h,v),h+=4,R[h]=g.depth,h++,R[h]=g.ctype,h++,R[h]=0,h++,R[h]=0,h++,R[h]=0,h++,T(R,h,I(R,h-17,17)),h+=4,S.sRGB!=null&&(T(R,h,1),h+=4,y(R,h,"sRGB"),h+=4,R[h]=S.sRGB,h++,T(R,h,I(R,h-5,5)),h+=4),S.iCCP!=null){let $=13+P.length;T(R,h,$),h+=4,y(R,h,"iCCP"),h+=4,y(R,h,"ICC profile"),h+=11,h+=2,R.set(P,h),h+=P.length,T(R,h,I(R,h-($+4),$+4)),h+=4}if(S.pHYs!=null&&(T(R,h,9),h+=4,y(R,h,"pHYs"),h+=4,T(R,h,S.pHYs[0]),h+=4,T(R,h,S.pHYs[1]),h+=4,R[h]=S.pHYs[2],h++,T(R,h,I(R,h-13,13)),h+=4),D&&(T(R,h,8),h+=4,y(R,h,"acTL"),h+=4,T(R,h,g.frames.length),h+=4,T(R,h,S.loop!=null?S.loop:0),h+=4,T(R,h,I(R,h-12,12)),h+=4),g.ctype==3){for(T(R,h,3*(H=g.plte.length)),h+=4,y(R,h,"PLTE"),h+=4,G=0;G<H;G++){let $=3*G,Y=g.plte[G],ot=255&Y,lt=Y>>>8&255,Vt=Y>>>16&255;R[h+$+0]=ot,R[h+$+1]=lt,R[h+$+2]=Vt}if(h+=3*H,T(R,h,I(R,h-3*H-4,3*H+4)),h+=4,F){for(T(R,h,H),h+=4,y(R,h,"tRNS"),h+=4,G=0;G<H;G++)R[h+G]=g.plte[G]>>>24&255;h+=H,T(R,h,I(R,h-H-4,H+4)),h+=4}}let tt=0;for(N=0;N<g.frames.length;N++){var X=g.frames[N];D&&(T(R,h,26),h+=4,y(R,h,"fcTL"),h+=4,T(R,h,tt++),h+=4,T(R,h,X.rect.width),h+=4,T(R,h,X.rect.height),h+=4,T(R,h,X.rect.x),h+=4,T(R,h,X.rect.y),h+=4,_(R,h,b[N]),h+=2,_(R,h,1e3),h+=2,R[h]=X.dispose,h++,R[h]=X.blend,h++,T(R,h,I(R,h-30,30)),h+=4);let $=X.cimg;T(R,h,(H=$.length)+(N==0?0:4)),h+=4;let Y=h;y(R,h,N==0?"IDAT":"fdAT"),h+=4,N!=0&&(T(R,h,tt++),h+=4),R.set($,h),h+=H,T(R,h,I(R,Y,h-Y)),h+=4}return T(R,h,0),h+=4,y(R,h,"IEND"),h+=4,T(R,h,I(R,h-4,4)),h+=4,R.buffer}function p(g,d,v){for(let b=0;b<g.frames.length;b++){let S=g.frames[b];S.rect.width;let I=S.rect.height,T=new Uint8Array(I*S.bpl+I);S.cimg=m(S.img,I,S.bpp,S.bpl,T,d,v)}}function c(g,d,v,b,S){let I=S[0],T=S[1],_=S[2],y=S[3],h=S[4],D=S[5],P=6,F=8,q=255;for(var H=0;H<g.length;H++){let pt=new Uint8Array(g[H]);for(var G=pt.length,N=0;N<G;N+=4)q&=pt[N+3]}let R=q!=255,W=function(et,Z,ut,yt,at,Ct){let ct=[];for(var J=0;J<et.length;J++){let At=new Uint8Array(et[J]),Ot=new Uint32Array(At.buffer);var vt;let It=0,Bt=0,Ft=Z,Qt=ut,Mr=yt?1:0;if(J!=0){let Ii=Ct||yt||J==1||ct[J-2].dispose!=0?1:2,Lr=0,gn=1e9;for(let Ve=0;Ve<Ii;Ve++){var Gt=new Uint8Array(et[J-1-Ve]);let _i=new Uint32Array(et[J-1-Ve]),qt=Z,zt=ut,Pe=-1,$e=-1;for(let jt=0;jt<ut;jt++)for(let Kt=0;Kt<Z;Kt++)Ot[ht=jt*Z+Kt]!=_i[ht]&&(Kt<qt&&(qt=Kt),Kt>Pe&&(Pe=Kt),jt<zt&&(zt=jt),jt>$e&&($e=jt));Pe==-1&&(qt=zt=Pe=$e=0),at&&((1&qt)==1&&qt--,(1&zt)==1&&zt--);let yn=(Pe-qt+1)*($e-zt+1);yn<gn&&(gn=yn,Lr=Ve,It=qt,Bt=zt,Ft=Pe-qt+1,Qt=$e-zt+1)}Gt=new Uint8Array(et[J-1-Lr]),Lr==1&&(ct[J-1].dispose=2),vt=new Uint8Array(Ft*Qt*4),s(Gt,Z,ut,vt,Ft,Qt,-It,-Bt,0),Mr=s(At,Z,ut,vt,Ft,Qt,-It,-Bt,3)?1:0,Mr==1?u(At,Z,ut,vt,{x:It,y:Bt,width:Ft,height:Qt}):s(At,Z,ut,vt,Ft,Qt,-It,-Bt,0)}else vt=At.slice(0);ct.push({rect:{x:It,y:Bt,width:Ft,height:Qt},img:vt,blend:Mr,dispose:0})}if(yt)for(J=0;J<ct.length;J++){if(($t=ct[J]).blend==1)continue;let At=$t.rect,Ot=ct[J-1].rect,It=Math.min(At.x,Ot.x),Bt=Math.min(At.y,Ot.y),Ft={x:It,y:Bt,width:Math.max(At.x+At.width,Ot.x+Ot.width)-It,height:Math.max(At.y+At.height,Ot.y+Ot.height)-Bt};ct[J-1].dispose=1,J-1!=0&&l(et,Z,ut,ct,J-1,Ft,at),l(et,Z,ut,ct,J,Ft,at)}let tr=0;if(et.length!=1)for(var ht=0;ht<ct.length;ht++){var $t;tr+=($t=ct[ht]).rect.width*$t.rect.height}return ct}(g,d,v,I,T,_),tt={},X=[],$=[];if(b!=0){let pt=[];for(N=0;N<W.length;N++)pt.push(W[N].img.buffer);let et=function(at){let Ct=0;for(var ct=0;ct<at.length;ct++)Ct+=at[ct].byteLength;let J=new Uint8Array(Ct),vt=0;for(ct=0;ct<at.length;ct++){let Gt=new Uint8Array(at[ct]),tr=Gt.length;for(let ht=0;ht<tr;ht+=4){let $t=Gt[ht],At=Gt[ht+1],Ot=Gt[ht+2],It=Gt[ht+3];It==0&&($t=At=Ot=0),J[vt+ht]=$t,J[vt+ht+1]=At,J[vt+ht+2]=Ot,J[vt+ht+3]=It}vt+=tr}return J.buffer}(pt),Z=C(et,b);for(N=0;N<Z.plte.length;N++)X.push(Z.plte[N].est.rgba);let ut=0;for(N=0;N<W.length;N++){let yt=(ot=W[N]).img.length;var Y=new Uint8Array(Z.inds.buffer,ut>>2,yt>>2);$.push(Y);let at=new Uint8Array(Z.abuf,ut,yt);D&&a(ot.img,ot.rect.width,ot.rect.height,X,at,Y),ot.img.set(at),ut+=yt}}else for(H=0;H<W.length;H++){var ot=W[H];let pt=new Uint32Array(ot.img.buffer);var lt=ot.rect.width;for(G=pt.length,Y=new Uint8Array(G),$.push(Y),N=0;N<G;N++){let et=pt[N];if(N!=0&&et==pt[N-1])Y[N]=Y[N-1];else if(N>lt&&et==pt[N-lt])Y[N]=Y[N-lt];else{let Z=tt[et];if(Z==null&&(tt[et]=Z=X.length,X.push(et),X.length>=300))break;Y[N]=Z}}}let Vt=X.length;for(Vt<=256&&h==0&&(F=Vt<=2?1:Vt<=4?2:Vt<=16?4:8,F=Math.max(F,y)),H=0;H<W.length;H++){(ot=W[H]).rect.x,ot.rect.y,lt=ot.rect.width;let pt=ot.rect.height,et=ot.img;new Uint32Array(et.buffer);let Z=4*lt,ut=4;if(Vt<=256&&h==0){Z=Math.ceil(F*lt/8);var kt=new Uint8Array(Z*pt);let yt=$[H];for(let at=0;at<pt;at++){N=at*Z;let Ct=at*lt;if(F==8)for(var nt=0;nt<lt;nt++)kt[N+nt]=yt[Ct+nt];else if(F==4)for(nt=0;nt<lt;nt++)kt[N+(nt>>1)]|=yt[Ct+nt]<<4-4*(1&nt);else if(F==2)for(nt=0;nt<lt;nt++)kt[N+(nt>>2)]|=yt[Ct+nt]<<6-2*(3&nt);else if(F==1)for(nt=0;nt<lt;nt++)kt[N+(nt>>3)]|=yt[Ct+nt]<<7-1*(7&nt)}et=kt,P=3,ut=1}else if(R==0&&W.length==1){kt=new Uint8Array(lt*pt*3);let yt=lt*pt;for(N=0;N<yt;N++){let at=3*N,Ct=4*N;kt[at]=et[Ct],kt[at+1]=et[Ct+1],kt[at+2]=et[Ct+2]}et=kt,P=2,ut=3,Z=3*lt}ot.img=et,ot.bpl=Z,ot.bpp=ut}return{ctype:P,depth:F,plte:X,frames:W}}function l(g,d,v,b,S,I,T){let _=Uint8Array,y=Uint32Array,h=new _(g[S-1]),D=new y(g[S-1]),P=S+1<g.length?new _(g[S+1]):null,F=new _(g[S]),q=new y(F.buffer),H=d,G=v,N=-1,R=-1;for(let tt=0;tt<I.height;tt++)for(let X=0;X<I.width;X++){let $=I.x+X,Y=I.y+tt,ot=Y*d+$,lt=q[ot];lt==0||b[S-1].dispose==0&&D[ot]==lt&&(P==null||P[4*ot+3]!=0)||($<H&&(H=$),$>N&&(N=$),Y<G&&(G=Y),Y>R&&(R=Y))}N==-1&&(H=G=N=R=0),T&&((1&H)==1&&H--,(1&G)==1&&G--),I={x:H,y:G,width:N-H+1,height:R-G+1};let W=b[S];W.rect=I,W.blend=1,W.img=new Uint8Array(I.width*I.height*4),b[S-1].dispose==0?(s(h,d,v,W.img,I.width,I.height,-I.x,-I.y,0),u(F,d,v,W.img,I)):s(F,d,v,W.img,I.width,I.height,-I.x,-I.y,0)}function u(g,d,v,b,S){s(g,d,v,b,S.width,S.height,-S.x,-S.y,2)}function m(g,d,v,b,S,I,T){let _=[],y,h=[0,1,2,3,4];I!=-1?h=[I]:(d*b>5e5||v==1)&&(h=[0]),T&&(y={level:0});let D=_s;for(var P=0;P<h.length;P++){for(let H=0;H<d;H++)A(S,g,H,b,v,h[P]);_.push(D.deflate(S,y))}let F,q=1e9;for(P=0;P<_.length;P++)_[P].length<q&&(F=P,q=_[P].length);return _[F]}function A(g,d,v,b,S,I){let T=v*b,_=T+v;if(g[_]=I,_++,I==0)if(b<500)for(var y=0;y<b;y++)g[_+y]=d[T+y];else g.set(new Uint8Array(d.buffer,T,b),_);else if(I==1){for(y=0;y<S;y++)g[_+y]=d[T+y];for(y=S;y<b;y++)g[_+y]=d[T+y]-d[T+y-S]+256&255}else if(v==0){for(y=0;y<S;y++)g[_+y]=d[T+y];if(I==2)for(y=S;y<b;y++)g[_+y]=d[T+y];if(I==3)for(y=S;y<b;y++)g[_+y]=d[T+y]-(d[T+y-S]>>1)+256&255;if(I==4)for(y=S;y<b;y++)g[_+y]=d[T+y]-o(d[T+y-S],0,0)+256&255}else{if(I==2)for(y=0;y<b;y++)g[_+y]=d[T+y]+256-d[T+y-b]&255;if(I==3){for(y=0;y<S;y++)g[_+y]=d[T+y]+256-(d[T+y-b]>>1)&255;for(y=S;y<b;y++)g[_+y]=d[T+y]+256-(d[T+y-b]+d[T+y-S]>>1)&255}if(I==4){for(y=0;y<S;y++)g[_+y]=d[T+y]+256-o(0,d[T+y-b],0)&255;for(y=S;y<b;y++)g[_+y]=d[T+y]+256-o(d[T+y-S],d[T+y-b],d[T+y-S-b])&255}}}function C(g,d){let v=new Uint8Array(g),b=v.slice(0),S=new Uint32Array(b.buffer),I=w(b,d),T=I[0],_=I[1],y=v.length,h=new Uint8Array(y>>2),D;if(v.length<2e7)for(var P=0;P<y;P+=4)D=x(T,F=v[P]*(1/255),q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255)),h[P>>2]=D.ind,S[P>>2]=D.est.rgba;else for(P=0;P<y;P+=4){var F=v[P]*.00392156862745098,q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255);for(D=T;D.left;)D=k(D.est,F,q,H,G)<=0?D.left:D.right;h[P>>2]=D.ind,S[P>>2]=D.est.rgba}return{abuf:b.buffer,inds:h,plte:_}}function w(g,d,v){v==null&&(v=1e-4);let b=new Uint32Array(g.buffer),S={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};S.bst=U(g,S.i0,S.i1),S.est=E(S.bst);let I=[S];for(;I.length<d;){let _=0,y=0;for(var T=0;T<I.length;T++)I[T].est.L>_&&(_=I[T].est.L,y=T);if(_<v)break;let h=I[y],D=L(g,b,h.i0,h.i1,h.est.e,h.est.eMq255);if(h.i0>=D||h.i1<=D){h.est.L=0;continue}let P={i0:h.i0,i1:D,bst:null,est:null,tdst:0,left:null,right:null};P.bst=U(g,P.i0,P.i1),P.est=E(P.bst);let F={i0:D,i1:h.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:h.bst.N-P.bst.N},T=0;T<16;T++)F.bst.R[T]=h.bst.R[T]-P.bst.R[T];for(T=0;T<4;T++)F.bst.m[T]=h.bst.m[T]-P.bst.m[T];F.est=E(F.bst),h.left=P,h.right=F,I[y]=P,I.push(F)}for(I.sort((_,y)=>y.bst.N-_.bst.N),T=0;T<I.length;T++)I[T].ind=T;return[S,I]}function x(g,d,v,b,S){if(g.left==null)return g.tdst=function(P,F,q,H,G){let N=F-P[0],R=q-P[1],W=H-P[2],tt=G-P[3];return N*N+R*R+W*W+tt*tt}(g.est.q,d,v,b,S),g;let I=k(g.est,d,v,b,S),T=g.left,_=g.right;I>0&&(T=g.right,_=g.left);let y=x(T,d,v,b,S);if(y.tdst<=I*I)return y;let h=x(_,d,v,b,S);return h.tdst<y.tdst?h:y}function k(g,d,v,b,S){let{e:I}=g;return I[0]*d+I[1]*v+I[2]*b+I[3]*S-g.eMq}function L(g,d,v,b,S,I){for(b-=4;v<b;){for(;M(g,v,S)<=I;)v+=4;for(;M(g,b,S)>I;)b-=4;if(v>=b)break;let T=d[v>>2];d[v>>2]=d[b>>2],d[b>>2]=T,v+=4,b-=4}for(;M(g,v,S)>I;)v-=4;return v+4}function M(g,d,v){return g[d]*v[0]+g[d+1]*v[1]+g[d+2]*v[2]+g[d+3]*v[3]}function U(g,d,v){let b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],S=[0,0,0,0],I=v-d>>2;for(let T=d;T<v;T+=4){let _=g[T]*.00392156862745098,y=g[T+1]*(1/255),h=g[T+2]*(1/255),D=g[T+3]*(1/255);S[0]+=_,S[1]+=y,S[2]+=h,S[3]+=D,b[0]+=_*_,b[1]+=_*y,b[2]+=_*h,b[3]+=_*D,b[5]+=y*y,b[6]+=y*h,b[7]+=y*D,b[10]+=h*h,b[11]+=h*D,b[15]+=D*D}return b[4]=b[1],b[8]=b[2],b[9]=b[6],b[12]=b[3],b[13]=b[7],b[14]=b[11],{R:b,m:S,N:I}}function E(g){let{R:d}=g,{m:v}=g,{N:b}=g,S=v[0],I=v[1],T=v[2],_=v[3],y=b==0?0:1/b,h=[d[0]-S*S*y,d[1]-S*I*y,d[2]-S*T*y,d[3]-S*_*y,d[4]-I*S*y,d[5]-I*I*y,d[6]-I*T*y,d[7]-I*_*y,d[8]-T*S*y,d[9]-T*I*y,d[10]-T*T*y,d[11]-T*_*y,d[12]-_*S*y,d[13]-_*I*y,d[14]-_*T*y,d[15]-_*_*y],D=h,P=O,F=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,H=0;if(b!=0)for(let N=0;N<16&&(F=P.multVec(D,F),H=Math.sqrt(P.dot(F,F)),F=P.sml(1/H,F),!(N!=0&&Math.abs(H-q)<1e-9));N++)q=H;let G=[S*y,I*y,T*y,_*y];return{Cov:h,q:G,e:F,L:q,eMq255:P.dot(P.sml(255,G),F),eMq:P.dot(F,G),rgba:(Math.round(255*G[3])<<24|Math.round(255*G[2])<<16|Math.round(255*G[1])<<8|Math.round(255*G[0])<<0)>>>0}}var O={multVec:(g,d)=>[g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3],g[4]*d[0]+g[5]*d[1]+g[6]*d[2]+g[7]*d[3],g[8]*d[0]+g[9]*d[1]+g[10]*d[2]+g[11]*d[3],g[12]*d[0]+g[13]*d[1]+g[14]*d[2]+g[15]*d[3]],dot:(g,d)=>g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3],sml:(g,d)=>[g*d[0],g*d[1],g*d[2],g*d[3]]};Dt.encode=function(d,v,b,S,I,T,_){S==null&&(S=0),_==null&&(_=!1);let y=c(d,v,b,S,[!1,!1,!1,0,_,!1]);return p(y,-1),f(y,v,b,I,T)},Dt.encodeLL=function(d,v,b,S,I,T,_,y){let h={ctype:0+(S==1?0:2)+(I==0?0:4),depth:T,frames:[]},D=(S+I)*T,P=D*v;for(let F=0;F<d.length;F++)h.frames.push({rect:{x:0,y:0,width:v,height:b},img:new Uint8Array(d[F]),blend:0,dispose:1,bpp:Math.ceil(D/8),bpl:Math.ceil(P/8)});return p(h,0,!0),f(h,v,b,_,y)},Dt.encode.compress=c,Dt.encode.dither=a,Dt.quantize=C,Dt.quantize.getKDtree=w,Dt.quantize.getNearest=x})();var ui={toArrayBuffer(s,r){let o=s.width,e=s.height,t=o<<2,n=s.getContext("2d").getImageData(0,0,o,e),i=new Uint32Array(n.data.buffer),a=(32*o+31)/32<<2,f=a*e,p=122+f,c=new ArrayBuffer(p),l=new DataView(c),u=1<<20,m,A,C,w,x=u,k=0,L=0,M=0;function U(g){l.setUint16(L,g,!0),L+=2}function E(g){l.setUint32(L,g,!0),L+=4}function O(g){L+=g}U(19778),E(p),O(4),E(122),E(108),E(o),E(-e>>>0),U(1),U(32),E(3),E(f),E(2835),E(2835),O(8),E(16711680),E(65280),E(255),E(4278190080),E(1466527264),function g(){for(;k<e&&x>0;){for(w=122+k*a,m=0;m<t;)x--,A=i[M++],C=A>>>24,l.setUint32(w+m,A<<8|C),m+=4;k++}M<i.length?(x=u,setTimeout(g,ui._dly)):r(c)}()},toBlob(s,r){this.toArrayBuffer(s,o=>{r(new Blob([o],{type:"image/bmp"}))})},_dly:9},xt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ws={[xt.CHROME]:16384,[xt.FIREFOX]:11180,[xt.DESKTOP_SAFARI]:16384,[xt.IE]:8192,[xt.IOS]:4096,[xt.ETC]:8192},un=typeof window<"u",fi=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Sr=un&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ps=(un||fi)&&(Sr&&Sr.getOriginalSymbol(window,"File")||typeof File<"u"&&File),mi=(un||fi)&&(Sr&&Sr.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function fn(s,r,o=Date.now()){return new Promise(e=>{let t=s.split(","),n=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]),a=i.length,f=new Uint8Array(a);for(;a--;)f[a]=i.charCodeAt(a);let p=new Blob([f],{type:n});p.name=r,p.lastModified=o,e(p)})}function pi(s){return new Promise((r,o)=>{let e=new mi;e.onload=()=>r(e.result),e.onerror=t=>o(t),e.readAsDataURL(s)})}function hi(s){return new Promise((r,o)=>{let e=new Image;e.onload=()=>r(e),e.onerror=t=>o(t),e.src=s})}function Te(){if(Te.cachedResult!==void 0)return Te.cachedResult;let s=xt.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?s=xt.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?s=xt.IOS:/Safari/i.test(r)?s=xt.DESKTOP_SAFARI:/Firefox/i.test(r)?s=xt.FIREFOX:(/MSIE/i.test(r)||document.documentMode)&&(s=xt.IE),Te.cachedResult=s,Te.cachedResult}function di(s,r){let o=Te(),e=ws[o],t=s,n=r,i=t*n,a=t>n?n/t:t/n;for(;i>e*e;){let f=(e+t)/2,p=(e+n)/2;f<p?(n=p,t=p*a):(n=f*a,t=f),i=t*n}return{width:t,height:n}}function wr(s,r){let o,e;try{if(o=new OffscreenCanvas(s,r),e=o.getContext("2d"),e===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{o=document.createElement("canvas"),e=o.getContext("2d")}return o.width=s,o.height=r,[o,e]}function gi(s,r){let{width:o,height:e}=di(s.width,s.height),[t,n]=wr(o,e);return r&&/jpe?g/.test(r)&&(n.fillStyle="white",n.fillRect(0,0,t.width,t.height)),n.drawImage(s,0,0,t.width,t.height),t}function vr(){return vr.cachedResult!==void 0||(vr.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),vr.cachedResult}function Ir(s,r={}){return new Promise(function(o,e){let t,n;var i=function(){try{return n=gi(t,r.fileType||s.type),o([t,n])}catch(f){return e(f)}},a=function(f){try{var p=function(c){try{throw c}catch(l){return e(l)}};try{let c;return pi(s).then(function(l){try{return c=l,hi(c).then(function(u){try{return t=u,function(){try{return i()}catch(m){return e(m)}}()}catch(m){return p(m)}},p)}catch(u){return p(u)}},p)}catch(c){p(c)}}catch(c){return e(c)}};try{if(vr()||[xt.DESKTOP_SAFARI,xt.MOBILE_SAFARI].includes(Te()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(s).then(function(f){try{return t=f,i()}catch{return a()}},a)}catch{a()}})}function _r(s,r,o,e,t=1){return new Promise(function(n,i){let a;if(r==="image/png"){let p,c,l;return p=s.getContext("2d"),{data:c}=p.getImageData(0,0,s.width,s.height),l=Dt.encode([c.buffer],s.width,s.height,4096*t),a=new Blob([l],{type:r}),a.name=o,a.lastModified=e,f.call(this)}{let p=function(){return f.call(this)};if(r==="image/bmp")return new Promise(c=>ui.toBlob(s,c)).then(function(c){try{return a=c,a.name=o,a.lastModified=e,p.call(this)}catch(l){return i(l)}}.bind(this),i);{let c=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&s instanceof OffscreenCanvas)return s.convertToBlob({type:r,quality:t}).then(function(l){try{return a=l,a.name=o,a.lastModified=e,c.call(this)}catch(u){return i(u)}}.bind(this),i);{let l;return l=s.toDataURL(r,t),fn(l,o,e).then(function(u){try{return a=u,c.call(this)}catch(m){return i(m)}}.bind(this),i)}}}function f(){return n(a)}})}function Ht(s){s.width=0,s.height=0}function ze(){return new Promise(function(s,r){let o,e,t,n,i;return ze.cachedResult!==void 0?s(ze.cachedResult):(o="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",fn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return e=a,Ir(e).then(function(f){try{return t=f[1],_r(t,e.type,e.name,e.lastModified).then(function(p){try{return n=p,Ht(t),Ir(n).then(function(c){try{return i=c[0],ze.cachedResult=i.width===1&&i.height===2,s(ze.cachedResult)}catch(l){return r(l)}},r)}catch(c){return r(c)}},r)}catch(p){return r(p)}},r)}catch(f){return r(f)}},r))})}function yi(s){return new Promise((r,o)=>{let e=new mi;e.onload=t=>{let n=new DataView(t.target.result);if(n.getUint16(0,!1)!=65496)return r(-2);let i=n.byteLength,a=2;for(;a<i;){if(n.getUint16(a+2,!1)<=8)return r(-1);let f=n.getUint16(a,!1);if(a+=2,f==65505){if(n.getUint32(a+=2,!1)!=1165519206)return r(-1);let p=n.getUint16(a+=6,!1)==18761;a+=n.getUint32(a+4,p);let c=n.getUint16(a,p);a+=2;for(let l=0;l<c;l++)if(n.getUint16(a+12*l,p)==274)return r(n.getUint16(a+12*l+8,p))}else{if((65280&f)!=65280)break;a+=n.getUint16(a,!1)}}return r(-1)},e.onerror=t=>o(t),e.readAsArrayBuffer(s)})}function Ai(s,r){let{width:o}=s,{height:e}=s,{maxWidthOrHeight:t}=r,n,i=s;return isFinite(t)&&(o>t||e>t)&&([i,n]=wr(o,e),o>e?(i.width=t,i.height=e/o*t):(i.width=o/e*t,i.height=t),n.drawImage(s,0,0,i.width,i.height),Ht(s)),i}function Ti(s,r){let{width:o}=s,{height:e}=s,[t,n]=wr(o,e);switch(r>4&&r<9?(t.width=e,t.height=o):(t.width=o,t.height=e),r){case 2:n.transform(-1,0,0,1,o,0);break;case 3:n.transform(-1,0,0,-1,o,e);break;case 4:n.transform(1,0,0,-1,0,e);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,e,0);break;case 7:n.transform(0,-1,-1,0,e,o);break;case 8:n.transform(0,-1,1,0,0,o)}return n.drawImage(s,0,0,o,e),Ht(s),t}function ci(s,r,o=0){return new Promise(function(e,t){let n,i,a,f,p,c,l,u,m,A,C,w,x,k,L,M,U,E,O,g;function d(b=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;n+=b,r.onProgress(Math.min(n,100))}function v(b){if(r.signal&&r.signal.aborted)throw r.signal.reason;n=Math.min(Math.max(b,n),100),r.onProgress(n)}return n=o,i=r.maxIteration||10,a=1024*r.maxSizeMB*1024,d(),Ir(s,r).then(function(b){try{return[,f]=b,d(),p=Ai(f,r),d(),new Promise(function(S,I){var T;if(!(T=r.exifOrientation))return yi(s).then(function(y){try{return T=y,_.call(this)}catch(h){return I(h)}}.bind(this),I);function _(){return S(T)}return _.call(this)}).then(function(S){try{return c=S,d(),ze().then(function(I){try{return l=I?p:Ti(p,c),d(),u=r.initialQuality||1,m=r.fileType||s.type,_r(l,m,s.name,s.lastModified,u).then(function(T){try{{let y=function(){if(i--&&(L>a||L>x)){let D,P;return D=g?.95*O.width:O.width,P=g?.95*O.height:O.height,[U,E]=wr(D,P),E.drawImage(O,0,0,D,P),u*=m==="image/png"?.85:.95,_r(U,m,s.name,s.lastModified,u).then(function(F){try{return M=F,Ht(O),O=U,L=M.size,v(Math.min(99,Math.floor((k-L)/(k-a)*100))),y}catch(q){return t(q)}},t)}return[1]},h=function(){return Ht(O),Ht(U),Ht(p),Ht(l),Ht(f),v(100),e(M)};if(A=T,d(),C=A.size>a,w=A.size>s.size,!C&&!w)return v(100),e(A);var _;return x=s.size,k=A.size,L=k,O=l,g=!r.alwaysKeepResolution&&C,(_=function(D){for(;D;){if(D.then)return void D.then(_,t);try{if(D.pop){if(D.length)return D.pop()?h.call(this):D;D=y}else D=D.call(this)}catch(P){return t(P)}}}.bind(this))(y)}}catch(y){return t(y)}}.bind(this),t)}catch(T){return t(T)}}.bind(this),t)}catch(I){return t(I)}}.bind(this),t)}catch(S){return t(S)}}.bind(this),t)})}var Ms=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`,ln;function Ls(s,r){return new Promise((o,e)=>{ln||(ln=function(i){let a=[];return typeof i=="function"?a.push(`(${i})()`):a.push(i),URL.createObjectURL(new Blob(a))}(Ms));let t=new Worker(ln);t.addEventListener("message",function(i){if(r.signal&&r.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return e(new Error(i.data.error)),void t.terminate();o(i.data.file),t.terminate()}else r.onProgress(i.data.progress)}),t.addEventListener("error",e),r.signal&&r.signal.addEventListener("abort",()=>{e(r.signal.reason),t.terminate()}),t.postMessage({file:s,imageCompressionLibUrl:r.libURL,options:{...r,onProgress:void 0,signal:void 0}})})}function mt(s,r){return new Promise(function(o,e){let t,n,i,a,f,p;if(t={...r},i=0,{onProgress:a}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,f=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=m=>{i=m,typeof a=="function"&&a(i)},!(s instanceof Blob||s instanceof Ps))return e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(s.type))return e(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!f||typeof Worker!="function"||p)return ci(s,t).then(function(m){try{return n=m,u.call(this)}catch(A){return e(A)}}.bind(this),e);var c=function(){try{return u.call(this)}catch(m){return e(m)}}.bind(this),l=function(m){try{return ci(s,t).then(function(A){try{return n=A,c()}catch(C){return e(C)}},e)}catch(A){return e(A)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ls(s,t).then(function(m){try{return n=m,c()}catch{return l()}},l)}catch{l()}function u(){try{n.name=s.name,n.lastModified=s.lastModified}catch{}try{t.preserveExif&&s.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===s.type)&&(n=li(s,n))}catch{}return o(n)}})}mt.getDataUrlFromFile=pi,mt.getFilefromDataUrl=fn,mt.loadImage=hi,mt.drawImageInCanvas=gi,mt.drawFileInCanvas=Ir,mt.canvasToFile=_r,mt.getExifOrientation=yi,mt.handleMaxWidthOrHeight=Ai,mt.followExifOrientation=Ti,mt.cleanupCanvasMemory=Ht,mt.isAutoOrientationInBrowser=ze,mt.approximateBelowMaximumCanvasSizeOfBrowser=di,mt.copyExifWithoutOrientation=li,mt.getBrowserName=Te,mt.version="2.0.2";var Ei=async(s=window.location.href,r=!0)=>{let o=await je("tabs","query",[{url:s}]);o?.length===0&&(o=await je("tabs","query",[{active:!0}]));let e=o?.[0]?.windowId,t=o?.[0]?.id;if(e&&t){await je("tabs","update",[t,{active:!0}]);let n=await je("tabs","captureVisibleTab",[e,{format:"png",quality:80}]);if(await new Promise(i=>setTimeout(i,1e3)),r&&n){let i=new Date().getTime(),a=co(n,"screenshot.png");if(a){i=new Date().getTime();let f=await mt(a,{useWebWorker:!0,maxWidthOrHeight:1920});return ur(f)||n}}return n}return null};var Ee=class extends B{static{this.type="CREATE_WEBSITE_CONTEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.CreateWebsiteContextConfig||{},t={};e&&Object.keys(e).forEach(i=>{let a=e[i];typeof e[i]=="string"?kr(t,i,o.getShortCutsEngine()?.parseTemplate(a)||e[i]):typeof e[i]=="object"&&Object.keys(e[i]).forEach(f=>{let p=e[i][f];kr(t,`${i}.${f}`,o.getShortCutsEngine()?.parseTemplate(p)||e[i][f])})}),t.sidebarType=this.getCurrentSidebarType(o);let n=await si(t);n?.id&&!n.meta?.screenshot&&Ei().then(i=>{i&&ai({id:n.id},{meta:{screenshot:i}})}),this.output=t.id}catch(e){this.error=e.toString()}}};z([j()],Ee.prototype,"execute",1);var mn=bt(Un());var xe=class extends B{static{this.type="DATE_FORMAT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=typeof this.parameters.DateFormatStyle=="string"?this.parameters.DateFormatStyle:"YYYY-MM-DD",t=r.LAST_ACTION_OUTPUT||(0,mn.default)().format();this.output=(0,mn.default)(t).format(e)}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],xe.prototype,"execute",1);var pn=bt(Un());var Ce=class extends B{static{this.type="DATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{(this.parameters.DateActionMode||"Current Date")==="Specified Date"?this.output=(0,pn.default)(this.parameters.DateActionDate).format():this.output=(0,pn.default)().format()}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],Ce.prototype,"execute",1);var Je=400*1e3,Os=async(s,r)=>new Promise(o=>{fetch(`${Rr}/gpt/check_doc_exists`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({doc_id:r})}).then(e=>e.json()).then(e=>{if(En){o(e?.data?.exists||!1);return}o(!1)}).catch(e=>{o(!1)})}),hn=async(s,r)=>{let o=await Wn();return new Promise(async e=>{let t=Hr(s);if(await Os(o,t)){e(t);return}let n=new File([s],r||"file.txt",{type:"text/plain"}),i=new FormData;i.append("file",n,n.name.replace(/\.pdf$/,".txt")),i.append("doc_id",Hr(s)),fetch(`${Rr}/gpt/analyze_file`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i}).then(a=>a.json()).then(a=>{let f=a?.data?.doc_id||"";f||zr("[API] [/gpt/analyze_file] error",JSON.stringify({error:"response docId is empty"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e(f)}).catch(a=>{zr("[API] [/gpt/analyze_file] error",JSON.stringify({error:a?.message||a?.toString()||"unknown error"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e("")})})};var ve=class extends B{static{this.type="GET_PDF_CONTENTS_OF_CRX"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{if(typeof window<"u"&&window.pdfjsLib&&window?.PDFViewerApplication?.url){let e=window.pdfjsLib,t=0,i=await(async()=>{try{let a=await e.getDocument(window?.PDFViewerApplication?.url).promise,f=a.numPages,p=async m=>{try{return(await(await a.getPage(m)).getTextContent()).items.map(w=>w.str).join("")}catch{return""}},c="",l="",u=0;for(let m=0;m<f;m++){let A="",C=!1;m%2===0?(C=!0,A=await p(f-m)):A=await p(m);let w=(await nr(A)).length;if(w+t>Je)break;u+=1,t+=w,C?l=A+l:c=c+A}return c+l}catch{return""}})();this.output=i}}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),Et()],ve.prototype,"execute",1);var Rs=()=>{let s=Zt();return s==="mail.google.com"?"[Gmail] ":s==="outlook.office.com"||s==="outlook.live.com"||s==="outlook.office365.com"?"[Outlook] ":s==="twitter.com"?"[Twitter] ":s==="linkedin.com"?"[LinkedIn] ":s==="facebook.com"?"[Facebook] ":s==="instagram.com"?"[Instagram] ":""},xi=Rs;var be=class extends B{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ask_chatgpt";t==="ASK_CHAT_GPT_WITH_PREFIX"&&this.parameters.AskChatGPTActionMeta?.contextMenu&&(this.parameters.AskChatGPTActionMeta.contextMenu.text=xi()+this.parameters.AskChatGPTActionMeta.contextMenu.text),this.question=o.LAST_ACTION_OUTPUT;let{success:n,answer:i,message:a,error:f}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT,parentMessageId:""},{includeHistory:!1,regenerate:!1,hiddenInChat:t==="ASK_CHAT_GPT_HIDDEN",meta:{...this.parameters.AskChatGPTActionMeta}})||{success:!1,answer:"",error:""};n?(this.output=i,this.message=a):(this.output="",this.error=this.error=Br(f||i||"ask chatgpt error"))}catch(t){this.error=Br(t.toString())}}reset(){super.reset(),this.question="",this.message=void 0}};z([j(),ke(!1)],be.prototype,"execute",1);var Se=class extends B{static{this.type="INSERT_USER_INPUT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters?.compliedTemplate||r?.LAST_ACTION_OUTPUT||"",t=this.parameters.AskChatGPTActionMeta,n=Oe(),i=await On(()=>{let a=null;return n?a=wn()?.querySelector(`#${Xt}`):a=Yt()?.querySelector(`#${Rt}`),a?Promise.resolve(a):Promise.reject("not found")},30,100);i&&(n?(dt("floatingMenuInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),te(i,0)):(dt("chatBoxInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),te(i,44.5))),i||n?this.output=e:this.error=""}catch{}}};z([j(),ke()],Se.prototype,"execute",1);var Ie=class extends B{static{this.type="ANALYZE_CHAT_FILE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.pushMessageToChat({type:"system",text:"Generating summary...",messageId:it(),extra:{status:"info"}},o);let e=this.parameters.AnalyzeChatFileName||r.AnalyzeChatFileName||"Content.txt",t=this.parameters.AnalyzeChatFileImmediateUpdateConversation||r.AnalyzeChatFileImmediateUpdateConversation||!1,n=r.LAST_ACTION_OUTPUT,i=(await nr(n)).length,a=i>12e3;i>Je&&(n=await Ke(n,Je));let f=await Ke(n,12e3);if(a)if(t){let p=await hn(n,e);await this.updateConversation(o,{meta:{docId:p}})}else hn(n,e).then(async p=>{await this.updateConversation(o,{meta:{docId:p}})});await this.updateConversation(o,{meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
            \`\`\`
            ${f}
            \`\`\``}}),this.output=f}catch(e){this.error=e.toString()}}};z([j()],Ie.prototype,"execute",1);var _e=class extends B{static{this.type="RENDER_CHATGPT_PROMPT"}constructor(r,o,e,t){super(r,"RENDER_CHATGPT_PROMPT",e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],_e.prototype,"execute",1);var we=class extends B{static{this.type="RENDER_TEMPLATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],we.prototype,"execute",1);var vi={[_e.type]:_e,[we.type]:we,[be.type]:be,[Ie.type]:Ie,[Se.type]:Se,[re.type]:re,[Fe.type]:Fe,[Ne.type]:Ne,[ne.type]:ne,[oe.type]:oe,[He.type]:He,[ee.type]:ee,[ie.type]:ie,[se.type]:se,[Be.type]:Be,[ae.type]:ae,[ve.type]:ve,[Ge.type]:Ge,[qe.type]:qe,[ce.type]:ce,[le.type]:le,[ue.type]:ue,[fe.type]:fe,[me.type]:me,[Ce.type]:Ce,[xe.type]:xe,[de.type]:de,[Ae.type]:Ae,[Ee.type]:Ee,[ge.type]:ge,[ye.type]:ye},Us=s=>new Promise(r=>setTimeout(r,s)),dn=class{constructor(){this.status="idle";this.variables=new Map;this.stepIndex=-1;this.actions=[];this.listeners=[]}setActions(r){this.reset(),this.actions=[],r.map(o=>{let e=vi[o.type];if(!e)throw new Error(`Action type ${o.type} not found`);let t=new e(o.id||it(),o.type,o.parameters||{},typeof o.autoExecute=="boolean"?o.autoExecute:!0);this.actions.push(t)})}pushActions(r,o){let e=[];r.map(t=>{let n=vi[t.type];if(!n)throw new Error(`Action type ${t.type} not found`);let i=new n(t.id||it(),t.type,t.parameters||{},typeof t.autoExecute=="boolean"?t.autoExecute:!0);e.push(i)}),o==="after"?this.actions.splice(this.stepIndex+1,0,...e):this.actions.push(...e)}async executeAction(r,o){try{if(r.reset(),r.status="running",this.emit("action",r),await r.execute(this.getVariables(),o),r.error){r.status="error",this.emit("action",r);return}r.status="complete",this.emit("action",r)}catch{r.status="error",this.emit("action",r)}}async run(r){try{let{engine:o,parameters:e}=r;if(this.status==="idle"||this.status==="stop")for(this.status="running",this.emit("status",this);this.status==="running"&&this.status!=="stop";){if(this.stepIndex+=1,this.stepIndex>=this.actions.length){this.status="complete",this.emit("status",this),this.reset();break}e&&this.stepIndex===0&&this.setVariables(e);let t=this.getCurrentAction();if(t){if(this.emit("beforeRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),await this.executeAction(t,o),this.emit("afterRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),t.error){this.status="stop",this.emit("status",this),this.stepIndex=this.stepIndex-1;break}let n=t.output||"";if(this.setVariable("LAST_ACTION_OUTPUT",n,!0),this.getNextAction()?.autoExecute&&!t.error)continue}await Us(100)}}catch{this.status="stop",this.emit("status",this)}}stop(){this.status="stop"}reset(){this.stepIndex=-1,this.variables=new Map,this.status="idle"}setVariable(r,o,e){this.variables.has(r)?e&&this.variables.set(r,o):this.variables.set(r,o)}setVariables(r){r.forEach(o=>{this.setVariable(o.key,o.value,o.overwrite)})}getVariable(r){return this.variables.get(r)}getVariables(){return Object.fromEntries(this.variables)}getCurrentAction(){return this.actions[this.stepIndex]}getNextAction(){return this.actions[this.stepIndex+1]||null}getPrevAction(){return this.actions[this.stepIndex-1]||null}get progress(){return Number((Math.max(this.stepIndex,0)/this.actions.length).toFixed(2))}addListener(r){this.listeners.push(r)}removeListener(r){let o=this.listeners.indexOf(r);o>-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}emit(r,o){this.listeners.forEach(e=>{e(r,o)})}parseTemplate(r){return Ye(r,this.getVariables()).data}},bi=dn;var Si=An({key:"ShortCutsState",default:{status:"idle"}});var Pr=new bi,Ds=new Me({runtime:"shortcut"}),Wi=s=>{let{isLogin:r}=to(),o=Qr(),[e,t]=Tn(Si),{loading:n}=ft(Le),i=(0,We.useRef)(Pr),a=so(s||""),f=u=>i.current?(i.current?.setActions(u),!0):!1,p=(0,We.useCallback)(async(u=!1)=>{if(i.current){(!r||u&&!Mn())&&Pn();try{await Sn()&&(i.current?.stepIndex===-1||i.current.status==="stop")&&(i.current?.actions.find(C=>C.type==="ASK_CHATGPT")&&t({status:"running"}),await i.current.run({parameters:o().shortCutsParameters,engine:{getShortCutsEngine:()=>i.current,getChartGPT:()=>a,getBackgroundConversation:()=>Ds}}))}catch{}finally{t({status:Pr.status||"idle"})}}},[a,i,o,r]),c=(0,We.useCallback)(()=>{i.current&&(i.current.stop(),t({status:Pr.status||"idle"}))},[i]),l=(0,We.useCallback)(()=>{i.current&&(i.current.reset(),t({status:Pr.status||"idle"}))},[]);return{...a,shortCutsEngineRef:i,runShortCuts:p,setShortCuts:f,loading:e.status==="running"||n,status:e.status,stopShortCuts:c,resetShortCuts:l}};export{ka as a,yo as b,zi as c,rt as d,st as e,eu as f,mo as g,oa as h,Wi as i,Ra as j};
