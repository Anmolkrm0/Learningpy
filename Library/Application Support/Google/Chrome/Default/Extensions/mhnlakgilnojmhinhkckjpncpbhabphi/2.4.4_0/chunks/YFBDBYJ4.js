import{a as Ve,b as Wo}from"./FSE6QFO2.js";import{a as No,b as Ho}from"./S6KJ77EJ.js";import{v as ba}from"./TPLPQCTH.js";import{a as xa}from"./6L4QKYCK.js";import{a as ya}from"./JPAWUU4R.js";import{a as Wn}from"./XYFFQRMZ.js";import{a as Go,c as vr,d as Bo,e as Ir,h as qo}from"./4NAB6M5G.js";import{b as ur}from"./DYUK4WZS.js";import{$ as xo,C as en,D as Cr,Fa as Lo,I as go,J as Ao,Ka as Oo,La as Do,Lb as Fo,Q as rn,S as kt,T as Er,U as To,V as Co,Y as Eo,Z as Sr,_ as So,aa as vo,c as so,da as xr,e as qt,fa as br,fb as gt,ka as wo,mb as We,s as lr,t as mo,tb as vt,u as fo,ub as X,v as wt,vb as at,w as po,x as Yt,z as ho}from"./R7ESC43Z.js";import{l as Po}from"./FOUKVBQX.js";import{i as uo}from"./XYZAUIQ2.js";import{f as co}from"./6UCR6JSM.js";import{a as tn,c as Sa}from"./IPNS2UUO.js";import{d as ao}from"./FRAG5SMK.js";import{a as Ar,b as Ea}from"./DRCUZC3I.js";import{d as Un,e as Aa,h as kn,i as Fn,j as Ta,n as Ca}from"./MWTIYFYH.js";import{aa as Io,ba as _o,d as yo,ga as Uo,ha as ko,s as bo}from"./IQBPRLVE.js";import{c as Zn,d as qe,e as to,f as ae,s as yr}from"./HEBGDMW5.js";import{b as eo,c as ro,d as se,e as no,g as ce,i as sr,k as Zr,l as oo,n as io,p as cr}from"./TYBXNNUH.js";import{a as Tr}from"./KG5SJQNS.js";import{a as Mo,b as Ro}from"./HQC5KEMG.js";import{$ as Jn,C as Kn,G as ar,N as Xn,O as gr,U as Jr,V as Yn,a as it,b as zn,c as Xr,e as ir,g as $n,h as Xt,j as Yr,q as Qn,r as jn,x as Be}from"./AAMCXCLO.js";import{c as lo}from"./CAPNT4IP.js";import{d as $t,e as Vn}from"./YN4XY6JW.js";import{H as Bn,I as Kr,L as or,T as hr,U as qn,a as Dt,c as Rn,d as Ln,f as Ct,g as On,h as Dn,j as Nn,l as Hn,q as Ut,r as ie,v as Gn}from"./IPAGS25B.js";import{c as _t,f as mt,h as W}from"./PQ35KENF.js";var Ra=_t(wr=>{"use strict";var _a=Ea();Object.defineProperty(wr,"__esModule",{value:!0});wr.default=void 0;var wa=_a(Sa()),Pa=Ca(),Ma=(0,wa.default)((0,Pa.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");wr.default=Ma});var Ci=_t(Rr=>{"use strict";Rr.byteLength=Ha;Rr.toByteArray=Ba;Rr.fromByteArray=Va;var Wt=[],Pt=[],Na=typeof Uint8Array<"u"?Uint8Array:Array,mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Se=0,Ai=mn.length;Se<Ai;++Se)Wt[Se]=mn[Se],Pt[mn.charCodeAt(Se)]=Se;var Se,Ai;Pt["-".charCodeAt(0)]=62;Pt["_".charCodeAt(0)]=63;function Ti(a){var r=a.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=a.indexOf("=");o===-1&&(o=r);var e=o===r?0:4-o%4;return[o,e]}function Ha(a){var r=Ti(a),o=r[0],e=r[1];return(o+e)*3/4-e}function Ga(a,r,o){return(r+o)*3/4-o}function Ba(a){var r,o=Ti(a),e=o[0],t=o[1],n=new Na(Ga(a,e,t)),i=0,s=t>0?e-4:e,m;for(m=0;m<s;m+=4)r=Pt[a.charCodeAt(m)]<<18|Pt[a.charCodeAt(m+1)]<<12|Pt[a.charCodeAt(m+2)]<<6|Pt[a.charCodeAt(m+3)],n[i++]=r>>16&255,n[i++]=r>>8&255,n[i++]=r&255;return t===2&&(r=Pt[a.charCodeAt(m)]<<2|Pt[a.charCodeAt(m+1)]>>4,n[i++]=r&255),t===1&&(r=Pt[a.charCodeAt(m)]<<10|Pt[a.charCodeAt(m+1)]<<4|Pt[a.charCodeAt(m+2)]>>2,n[i++]=r>>8&255,n[i++]=r&255),n}function qa(a){return Wt[a>>18&63]+Wt[a>>12&63]+Wt[a>>6&63]+Wt[a&63]}function Wa(a,r,o){for(var e,t=[],n=r;n<o;n+=3)e=(a[n]<<16&16711680)+(a[n+1]<<8&65280)+(a[n+2]&255),t.push(qa(e));return t.join("")}function Va(a){for(var r,o=a.length,e=o%3,t=[],n=16383,i=0,s=o-e;i<s;i+=n)t.push(Wa(a,i,i+n>s?s:i+n));return e===1?(r=a[o-1],t.push(Wt[r>>2]+Wt[r<<4&63]+"==")):e===2&&(r=(a[o-2]<<8)+a[o-1],t.push(Wt[r>>10]+Wt[r>>4&63]+Wt[r<<2&63]+"=")),t.join("")}});var xi=_t((Ym,Si)=>{function Mt(a,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(a)),this._timeouts=a,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Si.exports=Mt;Mt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Mt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Mt.prototype.retry=function(a){if(this._timeout&&clearTimeout(this._timeout),!a)return!1;var r=new Date().getTime();if(a&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(a),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(a);var o=this._timeouts.shift();if(o===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),o=this._cachedTimeouts.slice(-1);else return!1;var e=this;return this._timer=setTimeout(function(){e._attempts++,e._operationTimeoutCb&&(e._timeout=setTimeout(function(){e._operationTimeoutCb(e._attempts)},e._operationTimeout),e._options.unref&&e._timeout.unref()),e._fn(e._attempts)},o),this._options.unref&&this._timer.unref(),!0};Mt.prototype.attempt=function(a,r){this._fn=a,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var o=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){o._operationTimeoutCb()},o._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Mt.prototype.try=function(a){this.attempt(a)};Mt.prototype.start=function(a){this.attempt(a)};Mt.prototype.start=Mt.prototype.try;Mt.prototype.errors=function(){return this._errors};Mt.prototype.attempts=function(){return this._attempts};Mt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var a={},r=null,o=0,e=0;e<this._errors.length;e++){var t=this._errors[e],n=t.message,i=(a[n]||0)+1;a[n]=i,i>=o&&(r=t,o=i)}return r}});var bi=_t(xe=>{var Ka=xi();xe.operation=function(a){var r=xe.timeouts(a);return new Ka(r,{forever:a&&(a.forever||a.retries===1/0),unref:a&&a.unref,maxRetryTime:a&&a.maxRetryTime})};xe.timeouts=function(a){if(a instanceof Array)return[].concat(a);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var o in a)r[o]=a[o];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],t=0;t<r.retries;t++)e.push(this.createTimeout(t,r));return a&&a.forever&&!e.length&&e.push(this.createTimeout(t,r)),e.sort(function(n,i){return n-i}),e};xe.createTimeout=function(a,r){var o=r.randomize?Math.random()+1:1,e=Math.round(o*Math.max(r.minTimeout,1)*Math.pow(r.factor,a));return e=Math.min(e,r.maxTimeout),e};xe.wrap=function(a,r,o){if(r instanceof Array&&(o=r,r=null),!o){o=[];for(var e in a)typeof a[e]=="function"&&o.push(e)}for(var t=0;t<o.length;t++){var n=o[t],i=a[n];a[n]=function(m){var p=xe.operation(r),c=Array.prototype.slice.call(arguments,1),l=c.pop();c.push(function(u){p.retry(u)||(u&&(arguments[0]=p.mainError()),l.apply(this,arguments))}),p.attempt(function(){m.apply(a,c)})}.bind(a,i),a[n].options=r}}});var Ii=_t((Zm,vi)=>{vi.exports=bi()});var wi=_t((tf,Or)=>{"use strict";var Xa=Ii(),Ya=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Lr=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}},Ja=(a,r,o)=>{let e=o.retries-(r-1);return a.attemptNumber=r,a.retriesLeft=e,a},Za=a=>Ya.includes(a),_i=(a,r)=>new Promise((o,e)=>{r={onFailedAttempt:()=>{},retries:10,...r};let t=Xa.operation(r);t.attempt(async n=>{try{o(await a(n))}catch(i){if(!(i instanceof Error)){e(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof Lr)t.stop(),e(i.originalError);else if(i instanceof TypeError&&!Za(i.message))t.stop(),e(i);else{Ja(i,n,r);try{await r.onFailedAttempt(i)}catch(s){e(s);return}t.retry(i)||e(t.mainError())}}})});Or.exports=_i;Or.exports.default=_i;Or.exports.AbortError=Lr});var Mi=_t((ef,dn)=>{"use strict";var ts=Object.prototype.hasOwnProperty,Et="~";function mr(){}Object.create&&(mr.prototype=Object.create(null),new mr().__proto__||(Et=!1));function es(a,r,o){this.fn=a,this.context=r,this.once=o||!1}function Pi(a,r,o,e,t){if(typeof o!="function")throw new TypeError("The listener must be a function");var n=new es(o,e||a,t),i=Et?Et+r:r;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],n]:a._events[i].push(n):(a._events[i]=n,a._eventsCount++),a}function Dr(a,r){--a._eventsCount===0?a._events=new mr:delete a._events[r]}function yt(){this._events=new mr,this._eventsCount=0}yt.prototype.eventNames=function(){var r=[],o,e;if(this._eventsCount===0)return r;for(e in o=this._events)ts.call(o,e)&&r.push(Et?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(o)):r};yt.prototype.listeners=function(r){var o=Et?Et+r:r,e=this._events[o];if(!e)return[];if(e.fn)return[e.fn];for(var t=0,n=e.length,i=new Array(n);t<n;t++)i[t]=e[t].fn;return i};yt.prototype.listenerCount=function(r){var o=Et?Et+r:r,e=this._events[o];return e?e.fn?1:e.length:0};yt.prototype.emit=function(r,o,e,t,n,i){var s=Et?Et+r:r;if(!this._events[s])return!1;var m=this._events[s],p=arguments.length,c,l;if(m.fn){switch(m.once&&this.removeListener(r,m.fn,void 0,!0),p){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,o),!0;case 3:return m.fn.call(m.context,o,e),!0;case 4:return m.fn.call(m.context,o,e,t),!0;case 5:return m.fn.call(m.context,o,e,t,n),!0;case 6:return m.fn.call(m.context,o,e,t,n,i),!0}for(l=1,c=new Array(p-1);l<p;l++)c[l-1]=arguments[l];m.fn.apply(m.context,c)}else{var u=m.length,f;for(l=0;l<u;l++)switch(m[l].once&&this.removeListener(r,m[l].fn,void 0,!0),p){case 1:m[l].fn.call(m[l].context);break;case 2:m[l].fn.call(m[l].context,o);break;case 3:m[l].fn.call(m[l].context,o,e);break;case 4:m[l].fn.call(m[l].context,o,e,t);break;default:if(!c)for(f=1,c=new Array(p-1);f<p;f++)c[f-1]=arguments[f];m[l].fn.apply(m[l].context,c)}}return!0};yt.prototype.on=function(r,o,e){return Pi(this,r,o,e,!1)};yt.prototype.once=function(r,o,e){return Pi(this,r,o,e,!0)};yt.prototype.removeListener=function(r,o,e,t){var n=Et?Et+r:r;if(!this._events[n])return this;if(!o)return Dr(this,n),this;var i=this._events[n];if(i.fn)i.fn===o&&(!t||i.once)&&(!e||i.context===e)&&Dr(this,n);else{for(var s=0,m=[],p=i.length;s<p;s++)(i[s].fn!==o||t&&!i[s].once||e&&i[s].context!==e)&&m.push(i[s]);m.length?this._events[n]=m.length===1?m[0]:m:Dr(this,n)}return this};yt.prototype.removeAllListeners=function(r){var o;return r?(o=Et?Et+r:r,this._events[o]&&Dr(this,o)):(this._events=new mr,this._eventsCount=0),this};yt.prototype.off=yt.prototype.removeListener;yt.prototype.addListener=yt.prototype.on;yt.prefixed=Et;yt.EventEmitter=yt;typeof dn<"u"&&(dn.exports=yt)});var Li=_t((rf,Ri)=>{"use strict";Ri.exports=(a,r)=>(r=r||(()=>{}),a.then(o=>new Promise(e=>{e(r())}).then(()=>o),o=>new Promise(e=>{e(r())}).then(()=>{throw o})))});var Di=_t((nf,kr)=>{"use strict";var rs=Li(),Ur=class extends Error{constructor(r){super(r),this.name="TimeoutError"}},Oi=(a,r,o)=>new Promise((e,t)=>{if(typeof r!="number"||r<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(r===1/0){e(a);return}let n=setTimeout(()=>{if(typeof o=="function"){try{e(o())}catch(m){t(m)}return}let i=typeof o=="string"?o:`Promise timed out after ${r} milliseconds`,s=o instanceof Error?o:new Ur(i);typeof a.cancel=="function"&&a.cancel(),t(s)},r);rs(a.then(e,t),()=>{clearTimeout(n)})});kr.exports=Oi;kr.exports.default=Oi;kr.exports.TimeoutError=Ur});var Ui=_t(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});function ns(a,r,o){let e=0,t=a.length;for(;t>0;){let n=t/2|0,i=e+n;o(a[i],r)<=0?(e=++i,t-=n+1):t=n}return e}hn.default=ns});var ki=_t(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});var os=Ui(),gn=class{constructor(){this._queue=[]}enqueue(r,o){o=Object.assign({priority:0},o);let e={priority:o.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=o.priority){this._queue.push(e);return}let t=os.default(this._queue,e,(n,i)=>i.priority-n.priority);this._queue.splice(t,0,e)}dequeue(){let r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(o=>o.priority===r.priority).map(o=>o.run)}get size(){return this._queue.length}};yn.default=gn});var Ni=_t(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});var is=Mi(),Fi=Di(),as=ki(),Fr=()=>{},ss=new Fi.TimeoutError,An=class extends is{constructor(r){var o,e,t,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Fr,this._resolveIdle=Fr,r=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:as.default},r),!(typeof r.intervalCap=="number"&&r.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(e=(o=r.intervalCap)===null||o===void 0?void 0:o.toString())!==null&&e!==void 0?e:""}\` (${typeof r.intervalCap})`);if(r.interval===void 0||!(Number.isFinite(r.interval)&&r.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(n=(t=r.interval)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof r.interval})`);this._carryoverConcurrencyCount=r.carryoverConcurrencyCount,this._isIntervalIgnored=r.intervalCap===1/0||r.interval===0,this._intervalCap=r.intervalCap,this._interval=r.interval,this._queue=new r.queueClass,this._queueClass=r.queueClass,this.concurrency=r.concurrency,this._timeout=r.timeout,this._throwOnTimeout=r.throwOnTimeout===!0,this._isPaused=r.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Fr,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Fr,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let r=Date.now();if(this._intervalId===void 0){let o=this._intervalEnd-r;if(o<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},o)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let r=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let o=this._queue.dequeue();return o?(this.emit("active"),o(),r&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(r){if(!(typeof r=="number"&&r>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${r}\` (${typeof r})`);this._concurrency=r,this._processQueue()}async add(r,o={}){return new Promise((e,t)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&o.timeout===void 0?r():Fi.default(Promise.resolve(r()),o.timeout===void 0?this._timeout:o.timeout,()=>{(o.throwOnTimeout===void 0?this._throwOnTimeout:o.throwOnTimeout)&&t(ss)});e(await i)}catch(i){t(i)}this._next()};this._queue.enqueue(n,o),this._tryToStartAnother(),this.emit("add")})}async addAll(r,o){return Promise.all(r.map(async e=>this.add(e,o)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(r=>{let o=this._resolveEmpty;this._resolveEmpty=()=>{o(),r()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(r=>{let o=this._resolveIdle;this._resolveIdle=()=>{o(),r()}})}get size(){return this._queue.size}sizeBy(r){return this._queue.filter(r).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(r){this._timeout=r}};Tn.default=An});var tr=mt(Dt());var nn=class{constructor(r,o,e,t){this.id=r,this.type=o,this.status="idle",this.parameters=Object.assign({},e)||{},this.autoExecute=t}async execute(r,o){this.status="running",this.error="",this.output="",this.status="complete"}async pushMessageToChat(r,o){if(o&&o.getChartGPT()?.pushMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.pushMessage(r,e)}}async deleteMessageFromChat(r,o){if(o&&o.getChartGPT()?.deleteMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.deleteMessage(r,e)}}reset(){this.status="idle",this.error="",this.output=""}getCurrentConversationId(r){return r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||""}getCurrentSidebarType(r){return r.getChartGPT()?.getSidebarRef()?.currentSidebarSettingsRef?.current?.type||"Chat"}getNextAction(r){return r?.getShortCutsEngine()?.getNextAction()}getPrevAction(r){return r?.getShortCutsEngine()?.getPrevAction()}async getCurrentConversation(r){let o=r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||"";return o?await br(o):null}async updateConversation(r,o){let e=this.getCurrentConversationId(r);await po(e,o)}},G=nn;var Jt=(a,r)=>{try{return{data:a.replace(/\{\{(.+?)\}\}/g,(e,t)=>{let n=t.trim().split("."),i=r;for(;n.length;){let s=n.shift();if(Object.prototype.hasOwnProperty.call(i,s))i=i[s];else{i="";break}}return i}),error:""}}catch{return{data:"",error:"parse template error"}}};function j(){return function(a,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;if(i.parameters?.template){let s=Jt(i.parameters?.template||"",n);s.error?(i.error=s.error,i.parameters.compliedTemplate=""):i.parameters.compliedTemplate=s.data}await e.apply(this,t)}}}function Zt(a){return function(r,o,e){let t=e.value;e.value=async function(...n){let[i]=n,s=this;mo(s.parameters,(m,p)=>{if(!a?.includes(m.join("."))&&typeof p=="string"){let c=Jt(p,i).data;try{let l=JSON.parse(c);Be(s.parameters,m,l)}catch{Be(s.parameters,m,c)}}}),await t.apply(this,n)}}}function z({onlySuccess:a,onlyError:r}={onlySuccess:!1,onlyError:!1}){return function(o,e,t){let n=t.value;t.value=async function(...i){let[,s]=i,m=this,p=await n.apply(this,i),c=s.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;return m.error&&!a?s.getChartGPT()?.pushMessage({type:"system",text:m.error,messageId:it(),extra:{status:"error"},conversationId:c}):m.output&&!r&&s.getChartGPT()?.pushMessage({type:"system",text:m.output,messageId:it(),extra:{status:"success"}},c),p}}}function lt(){return function(a,r,o){let e=o.value;o.value=async function(...t){let[,n]=t;n.getChartGPT()?.showLoading();let i=await e.apply(this,t);return n.getChartGPT()?.hideLoading(),i}}}function _r(a=!0){return function(r,o,e){let t=e.value;e.value=async function(...n){let i=We(),s="chatBoxInputMediator";if(i&&(s="floatingMenuInputMediator"),a)return gt(s).updateInputValue(""),await t.apply(this,n);{let m=await t.apply(this,n);return gt(s).updateInputValue(""),m}}}}var le=class extends G{static{this.type="GET_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=Io(`<html>${document?.documentElement?.innerHTML}</html>`).document,t=_o(e);t?t.success?this.output=t?.body||"":this.error=t?.body||"":this.error="No webpage contents",this.output||(this.output="",this.error="No webpage contents")}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],le.prototype,"execute",1);var ue=class extends G{static{this.type="SET_VARIABLE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableName||this.parameters.Variable||"";if(!e){this.error="Action no variable name!";return}let t=o.getShortCutsEngine();t&&t.setVariable&&(t.setVariable(e,this.parameters?.WFFormValues?.Value||r.LAST_ACTION_OUTPUT||"",!0),this.output=r.LAST_ACTION_OUTPUT||"")}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],ue.prototype,"execute",1);var ze=class extends G{static{this.type="OPERATION_ELEMENT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getBackgroundConversation(),t=this.parameters.OperationElementConfig||r.OperationElementConfig;if(!e||!t){this.error="Action cannot execute!";return}let n=this.parameters.OperationElementTabID||r.OperationElementTabID,s=(await e.postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:t,OperationElementTabID:n}})).data;s?.success?(t.successMessage&&await this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.successMessage,extra:{status:"info"}},o),t.actionType==="getText"?this.output=s.elementsInnerText:t.actionType==="getLink"&&(this.output=s.link)):t.errorMessage&&await this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.errorMessage,extra:{status:"error"}},o)}catch(e){this.error=e.toString()}}};var $e=class extends G{static{this.type="SCRIPTS_CONDITIONAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=!1,t=this.parameters.WFCondition||r.WFCondition||void 0,n=this.parameters.WFMatchTextCaseSensitive!==!1,i=this.parameters.WFFormValues?.Value||"",s=r.LAST_ACTION_OUTPUT||"",m=this.parameters.WFConditionalIfTrueActions||[],p=this.parameters.WFConditionalIfFalseActions||[];switch(zn(i)?s=JSON.parse(s||"{}"):!n&&typeof i=="string"&&typeof s=="string"&&(i=i.toLocaleLowerCase(),s=s.toLocaleLowerCase()),t){case"Equals":e=Qn(i,s);break;case"Is Greater Than":e=Number(i)>Number(s);break;case"Is Less Than":e=Number(i)<Number(s);break;case"Contains":e=s.includes(String(i));break;case void 0:e=!s;break;default:break}if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(e?m:p,"after");else{this.error="no shortCutsEngine";return}}catch(e){this.error=e.toString()}}};var on=class{constructor(){this.pending=new Map}async send(r,o,e=5*1e3){let t=it(),n={...o,uuid:t};return new Promise((i,s)=>{let m=setTimeout(()=>{this.pending.delete(t),s(new Error("Timeout Error"))},e);this.pending.set(t,p=>{clearTimeout(m),i(p)}),window.dispatchEvent(new CustomEvent(r,{detail:n}))})}receive(r,o){window.addEventListener(r,async e=>{if(e instanceof CustomEvent&&e.detail&&e.detail.uuid){let{uuid:t,...n}=e.detail,i,s=o(n);s instanceof Promise?i=await s:i=s;let m=this.pending.get(t);m&&(m(i),this.pending.delete(t))}})}},Vo=new on;var $o=(a,r,o,e)=>new Promise(t=>{let n=!1,i=setTimeout(()=>{n=!0,t(void 0)},e),s=setInterval(()=>{if(!n){let m=a.querySelector(r);m&&(clearInterval(s),clearTimeout(i),t(m))}},o)}),zo=(a,r,o,e,t)=>new Promise(n=>{let i=!1,s=setTimeout(()=>{i=!0,n(void 0)},e),m=setInterval(()=>{if(!i){let p=Array.from(a.querySelectorAll(r));if(t){let c=t(p);c&&(clearInterval(m),clearTimeout(s),n(c))}else p.length>0&&(clearInterval(m),clearTimeout(s),n(p[0]))}},o)}),va=()=>new Promise(async a=>{let o=setTimeout(()=>{a({success:!1,error:"timeout"})},4e3),e=t=>{clearTimeout(o),a(t)};try{let t=document.getElementById(Gn)?.shadowRoot;if(t){let n=await zo(t,".usechatgpt-ai__context-menu--handle-button",200,2e3,i=>i.find(s=>window.getComputedStyle(s).opacity!=="0"));if(n){setTimeout(()=>{n.click()},100);let i=await zo(t,".floating-context-menu-item",50,2e3,s=>s.find(m=>m.innerText.startsWith("Run this prompt")));if(i){i.click(),e({success:!0,error:""});return}}}e({success:!1,error:"no context menu"})}catch(t){e({success:!1,error:t?.toString()||""})}}),Ec=va;var Ko=mt(Dt());var Qo=mt(Dt()),Ia=()=>{let{currentSidebarConversationMessages:a,currentSidebarConversationType:r}=Yt(),o=Ct(qt),e=Ct(Oo),t=[],n=e.lastAIMessageId;return(0,Qo.useMemo)(()=>{if(r==="Chat"){if(n||a.filter(s=>s.type==="ai").length===1&&(n="root"),n)for(let s=a.length-1;s>=0;s--){let m=a[s];if(m.messageId===n)break;m.type==="ai"&&t.unshift(m)}return o.writingMessage&&o.writingMessage.type==="ai"&&t.push(o.writingMessage),t.map(s=>s.text).join(`

`).replace(/\n{2,}/,`

`)}return""},[n,o.writingMessage,a,r])},jo=Ia;var an=()=>{let a=Ct(hr),{currentSelection:r}=Do(),{currentSidebarConversationMessages:o}=Yt(),e=jo(),t=Ct(qn);return(0,Ko.useCallback)(()=>{let n="".replace(/<br\s*\/?>/gi,`
`).replace(/<\/?div[^>]*>/g,`
`).replace(/<[^>]+>/g,"").replace(/\u00ad/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/data:image\/(png|jpeg|gif);base64,\s?[A-Za-z0-9+/]+={0,2}/g,"").replace(/\n{3,}/g,`
`)||"",i=r?.selectionHTML||"",s=r?.selectionText||"",m=t.userSettings?.language||Kr;m===Bn&&(m=Kr);let p={GMAIL_EMAIL_CONTEXT:"",GMAIL_DRAFT_CONTEXT:n,SELECTED_HTML:i,SELECTED_TEXT:s,USER_INPUT:se()?.querySelector(`#${Ut}`)?.value||"",LAST_AI_OUTPUT:lr(o,l=>l.type==="ai")?.text||"",AI_RESPONSE_LANGUAGE:m,AI_OUTPUT_LANGUAGE:m,CURRENT_WEBSITE_DOMAIN:typeof window<"u"?window.location.hostname:"",CURRENT_WEBPAGE_URL:typeof window<"u"?window.location.href:"",CURRENT_WEBPAGE_TITLE:typeof window<"u"?document.title:"",POPUP_DRAFT:e||""},c=[];return Object.keys(p).forEach(l=>{c.push({key:l,value:p[l],overwrite:!0})}),{builtInParameters:p,parameters:c,shortCutsParameters:Object.values(c)}},[a.env,r,t.userSettings,e])};var Xo=mt(Dt());var me=class extends G{static{this.type="SET_VARIABLES_MODAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.SetVariablesModalConfig;if(!e){this.error="No config!";return}if(e.modelKey==="Sidebar"){ce();let m=se();m&&await $o(m,"#max-ai__ai-provider-floating-button",100,5e3)}let t=o.getShortCutsEngine(),n=t.getVariables(),i=ir(e);i.variables.map(m=>(m.defaultValue&&typeof m.defaultValue=="string"&&(m.defaultValue=Jt(m.defaultValue,n).data||""),m)),i.answerInsertMessageId&&(i.answerInsertMessageId=Jt(i.answerInsertMessageId,n).data||i.answerInsertMessageId),i.systemVariables.map(m=>(m.defaultValue&&typeof m.defaultValue=="string"&&(m.defaultValue=Jt(m.defaultValue,n).data||""),m)),i.template=e.template||this.parameters?.compliedTemplate||"";let s=await Vo.send("SetVariablesModal",{task:"open",config:i},5*60*1e3);s.success?Object.keys(s.data).forEach(m=>{s.data[m]!==void 0&&t?.setVariable(m,s.data[m],!0)}):(this.error="User cancel!",t?.reset()),this.output=JSON.stringify(s.data)}catch(e){this.error=e.toString()}}};W([j()],me.prototype,"execute",1);var fe=class extends G{static{this.type="SET_VARIABLE_MAP"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableMap||{},t=o.getShortCutsEngine();t&&t.setVariable&&(Object.keys(e).forEach(n=>{e[n]!==void 0&&t?.setVariable(n,e[n],!0)}),this.output=JSON.stringify(e))}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],fe.prototype,"execute",1);var Qe=class extends G{static{this.type="URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.output=this.parameters.URLActionURL||this.parameters.LAST_ACTION_OUTPUT,this.output||(this.output="",this.error="No input url")}catch(e){this.error=e.toString()}}};var pe=class extends G{static{this.type="GET_CONTENTS_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.URLActionURL||r.URLActionURL||r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(e&&t){await this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:it(),extra:{status:"info"}},o);let n=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:e}});n.success?this.output=n?.data?.body||"":this.error=n?.data?.body||""}else this.error=`Could not fetch the page.
Make sure the URL is correct.`;this.output||(this.output="",this.error=`Could not fetch the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}};W([lt(),Zt(),z({onlyError:!0})],pe.prototype,"execute",1);var de=class extends G{constructor(o,e,t,n){super(o,"GET_CONTENTS_OF_SEARCH_ENGINE",t,n);this.SearchEngineResultDefaultLimit=6}static{this.type="GET_CONTENTS_OF_SEARCH_ENGINE"}async execute(o,e){try{let t=o.compliedTemplate||this.parameters?.URLSearchEngineParams?.q||this.parameters?.URLSearchEngineParams?.query||o.LAST_ACTION_OUTPUT||"",n=e.getBackgroundConversation();if(t&&n){t=t.trim(),t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let i=this.parameters.URLSearchEngine||"yahoo",s=this.parameters.URLSearchEngineParams||{},m=jn(Number(s?.limit))?Number(s?.limit):this.SearchEngineResultDefaultLimit,p=[t];s.splitWith&&t.includes(s.splitWith)&&(p=t.split(s.splitWith),delete s.splitWith);let c=await Promise.all(p.map(async f=>{let h=this.getFullSearchURL(i,s,f.trim()),{html:S,status:I}=await Ho(h);return I===301||I===302||I===429?(this.error=`[Click here for ${i.replace(/^\w/,E=>E.toUpperCase())}.](${h}) Pass security checks and keep the tab open for stable web access.`,[]):I===200&&S?No({html:S,searchEngine:i}):[]}));if(this.error)return;let u=fo(...c).slice(0,m);u.length<=0?(this.output="[]",this.error="No search results found. Please try again with a different search engine or search query."):(this.error="",this.output=JSON.stringify(u,null,2))}}catch(t){this.error=t.toString()}}getFullSearchURL(o,e,t){let n=Oa(o),i=La(o,e,t);return`${n}?${i.toString()}`}};W([Zt(),z({onlyError:!0}),lt()],de.prototype,"execute",1);function La(a,r,o){let e={...r};delete e.limit;let t=o||e.query;switch(delete e.query,delete e.q,e.site&&(t=`site:${e.site} ${t}`),delete e.site,e.region&&e.region!=="wt-wt"&&(a==="google"?t=`location:${e.region} ${t}`:t=`${e.region} ${t}`,delete e.region),a){case"yahoo":{e.p=t;break}case"baidu":{e.wd=t;break}case"naver":case"sogou":{e.query=t;break}case"yandex":{e.text=t;break}case"bing":case"duckduckgo":case"brave":case"google":default:e.q=t}return new URLSearchParams({...e})}function Oa(a){switch(a){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://search.yahoo.com/search"}}var je=class extends G{static{this.type="FETCH_ACTIONS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getShortCutsEngine(),t=await ko(this.parameters.template||"");e.pushActions(t,"after"),this.output=r.LAST_AI_OUTPUT||""}catch(e){this.error=e.toString()}}};var he=class extends G{static{this.type="GET_YOUTUBE_TRANSCRIPT_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=window.location.href.includes("youtube.com")?window.location.href:"",t=this.parameters.URLActionURL||e||"";if(!t){this.error="Youtube URL is empty.";return}let n=await kt.fetchTranscript(t);if((n.length<=10?n.map(s=>s.text).join("").trim()==="":!1)&&t&&t.startsWith("https://")){let s=await Cr(t,{parse:"text"});s.success&&s.data&&(n=[{start:"",duration:"",text:await Er()}])}if(n.length>0){let s=await kt.transcriptFormat(n),{getChartGPT:m,getShortCutsEngine:p}=o;if(p()?.getNextAction?.()?.type==="ASK_CHATGPT"){let c=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;await m()?.updateConversation({meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
\`\`\`
${s}
\`\`\``}},c)}this.output=s}}catch(e){this.error=e.toString()}}};W([j(),z({onlyError:!0}),lt()],he.prototype,"execute",1);var Ke=class extends G{static{this.type="OPEN_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",t=r.URLActionActiveTab||this.parameters.URLActionActiveTab;if(!e){this.error="No open url";return}e==="current_page"?this.output=await Zr({key:"current_page"})||void 0:this.output=await Zr({url:e,active:t})||void 0}catch(e){this.error=e.toString()}}};var Xe=class extends G{static{this.type="CLOSE_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.OperationElementTabID||this.parameters.OperationElementTabID,t=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",n=await oo({tabId:e,url:t});n?.success||(this.error=n?.message)}catch(e){this.error=e.toString()}}};var ge=class extends G{static{this.type="GET_READABILITY_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=await Sr()||await Er();this.output=e}catch(e){this.error=e.toString()}}};W([j(),z({onlyError:!0}),lt()],ge.prototype,"execute",1);var ye=class extends G{static{this.type="GET_EMAIL_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Sr()||await Co(e);this.output=t}catch(t){this.error=t.toString()}}};W([j(),z({onlyError:!0}),lt()],ye.prototype,"execute",1);var Ae=class extends G{static{this.type="GET_EMAIL_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";if(e){let t=await To(e);this.output=t}else this.output=""}catch(e){this.error=e.toString()}}};W([j(),z({onlyError:!0}),lt()],Ae.prototype,"execute",1);var Da=a=>{if(a.length>0){let r=[];a.forEach((t,n)=>{let{content:i,author:s}=t;r.push({text:`[Comment ${n+1}]
**Author:** ${s}
**Comment:**
${i}`,data:t})});let o=r[r.length-1],e=r.slice(0,r.length-1);return{last:o,lastText:r[r.length-1].text,previous:e,previousText:e.map(t=>t.text).join(`

`),fullText:r.join(`

`)}}return null},$=class{constructor(r,o){this.commentList=[];let{postTitle:e="Post",postContentTagName:t="Post caption/description",meta:n={}}=o||{};this.config={postTitle:e,postContentTagName:t,meta:n},this.post=r}static get emptyData(){return{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",postText:""}}addCommentList(r){this.commentList.push(r)}get data(){let{content:r,author:o,title:e}=this.post,t=Da(this.commentList?.[0]||[]),n="";return n+=`[${this.config.postTitle}]`,n+=`
**Post author:** ${o||"N/A"}`,n+=`
**Post title:** ${e||"N/A"}`,n+=`
**${this.config.postContentTagName}:**
${r||"N/A"}`,Object.keys(this.config.meta||{}).forEach(i=>{n+=`
**${i}:**
${this.config.meta?.[i]||"N/A"}`}),t?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.lastText,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.previousText?`${n}

${t.previousText}

${t.lastText}`:`${n}

${t.lastText}`,post:this.post,postText:n,replyCommentText:t.last.text,replyComment:t.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:t.previousText}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:n,post:this.post,postText:n,previousComments:this.commentList?.[0]||[],previousCommentsText:t?.previousText}}};var Yo=a=>{let r=a.querySelector('div[data-testid="User-Name"]'),[o,e]=Kn(Array.from(r?.querySelectorAll("span")).map(i=>i.textContent||"").filter(i=>i&&i!=="\xB7")),t=a.querySelector("time")?.dateTime||"",n=a.querySelector('div[data-testid="tweetText"]')?.innerText||"";return{author:`${o}(${e})`,date:t,content:n,title:""}},Jo=async a=>{let r=X('article[data-testid="tweet"]',a);if(r){let o=[],e=at('div[data-testid="cellInnerDiv"]',r,5);for(;e;){if(e?.getAttribute("data-testid")==="cellInnerDiv"){let t=e.querySelector('article[data-testid="tweet"]');t&&o.splice(0,0,Yo(t))}e=e.previousElementSibling}if(o.length>0){let t=o.shift(),n=new $(t);return n.addCommentList(o),n.data}else return new $(Yo(r)).data}return $.emptyData},Zo=a=>X("div.DraftEditor-editorContainer",a,30)?.innerText||"",Tu=a=>{let r=Array.from(document.querySelectorAll('div[role="progressbar"]')),o=null;for(let e=0;e<r.length;e++){let t=r[e];if(t.parentElement?.contains(a)){o=t.parentElement;break}}return o};var ti=async a=>{let r=(a.querySelector("span.comments-post-meta__name span:not(.visually-hidden)")?.innerText||"").split(`
`)[0],o=a.querySelector("time")?.innerText||"",e=a.querySelector("& > .comments-reply-item-content-body button.see-more");e&&(e.click(),await vt(100));let t=a.querySelector("& > div.comments-comment-item-content-body")?.innerText||a.querySelector("& > div.comments-reply-item-content-body")?.innerText;return{author:r||"",date:o||"",content:t||""}},ei=async a=>{let r=X(".comments-comment-box",a),o=X(".social-details-social-activity",r);if(r&&o){let e=X(".feed-shared-update-v2__description-wrapper",r);if(e){let t=e?.parentElement,n=t?.querySelector('button[role="button"].see-more');n&&(n.click(),await vt(100,a));let i=t?.querySelector(".update-components-actor__name span:not(.visually-hidden)")?.textContent||"",s=e?.innerText||"",m=(t?.querySelector("div.ml4.mt2.text-body-xsmall")?.innerText||"").split("\u2022")?.[0],p=new $({author:i,content:s,title:"",date:m});if(r.parentElement?.classList.contains("comments-comment-item__nested-items")){let c=[],l=at("article.comments-comment-item",a),f=l?.querySelector('div.editor-content div[contenteditable="true"]')?.innerText||"";if(c.push(await ti(l)),f){let h=Array.from(l.querySelectorAll("article"));for(let S=0;S<h.length;S++){let I=h[S],E=await ti(I);if(f.startsWith(E.author)){c.push(E);break}}}await vt(0,a),p.addCommentList(c)}return p.data}}return $.emptyData},ri=a=>X("div.ql-editor",a,30)?.innerText||"";var cn=async a=>{let r=a?.querySelector("a > span > span")?.innerText||"",o=a?.querySelector("span[lang][dir]")?.innerText||"",e=Array.from(a?.querySelectorAll("a > span")),t=e[e.length-1]?.innerText||"";return{content:o,author:r,date:t}},ni=async a=>{let r=X('form[role="presentation"]',a),o=X('div[data-ad-preview="message"]',r,30),e=X("span:has(h3 > span)",r,30),t=e||X("span:has(h4 > div)",r,30),n=t?.innerText||"",i=e?t?.nextElementSibling?.querySelector("a")?.innerText:t?.parentElement?.nextElementSibling?.querySelectorAll("a")?.[1]?.innerText||"",s=o?.querySelector('div[dir] > div[role="button"]');s&&(s.click(),await vt(100,a));let m=o?.innerText||"",p=[],c=new $({author:n,date:i,content:m,title:""});if(r){let u=r.querySelector('div[contenteditable="true"][role="textbox"]')?.innerText||"",f=at("li",r,10);for(;f;){let h=f.childNodes[0];if(h){let S=await cn(h);if(p.length===0&&!u.startsWith(S.author)&&f&&u){let I=Array.from(f.querySelectorAll("& > div > ul li > div"));for(let E=0;E<I.length;E++){let U=I[E],L=await cn(U);if(u.startsWith(L.author)){p.push(L);break}}}if(p.splice(0,0,S),f?.parentElement){f=at("li",f.parentElement,10);continue}}break}if(u.replace(`
`,"")&&!p.length){let h=X('div[role="article"]',r),S=await cn(h);u.startsWith(S.author)&&p.push(S)}c.addCommentList(p)}return c.data},oi=a=>X('div[contenteditable="true"]',a,30)?.innerText||"";var ln=async a=>{let r=a.querySelector("#header-author #author-text > span")?.innerText||"",o=a.querySelector("#header-author > yt-formatted-string")?.innerText||"",e=a?.querySelector("tp-yt-paper-button#expand");e&&(e.click(),await vt(100));let t=a.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},ii=async a=>{try{let r=at("ytd-commentbox",a),o=kt.retrieveVideoId(window.location.href),e=null;if(o){let t=await kt.transcriptFormat(await kt.fetchTranscript(window.location.href),2048),n=document.querySelector("ytd-watch-metadata"),i=n?.querySelector("#title > h1")?.innerText||document.title,s=document.querySelector("ytd-video-owner-renderer"),m=s?.querySelector("yt-formatted-string")?.textContent,p=n?.querySelector("tp-yt-paper-button#expand");p&&(p.click(),await vt(100,a));let c=s?.querySelector("a")?.getAttribute("href")?.includes("@")&&s?.querySelector("a")?.getAttribute("href")?.split("/")[1],l=n?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",u=n?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||"";e=new $({title:i,author:`${m}(${c})`,date:l,content:u},{postTitle:"Video post",meta:{"Post video transcript":t}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let n=at("ytd-reel-video-renderer",a,50)?.querySelector("ytd-reel-player-header-renderer");if(n){let i=n?.querySelector(".title > yt-formatted-string")?.innerText||"",s=n?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";e=new $({title:i,author:s,date:"",content:""},{postTitle:"Video post"})}}if(r&&e){if(!at("ytd-comment-simplebox-renderer",r,5)){let t=at("ytd-comment-thread-renderer",r)?.querySelector("& > ytd-comment-renderer");if(t){let n=at("ytd-comment-renderer",r);n&&(X("ytd-comment-replies-renderer",n,5)?.contains(n)&&!n.isSameNode(t)?e.addCommentList([await ln(t),await ln(n)]):e.addCommentList([await ln(t)]))}}return e.data}}catch{}return $.emptyData},ai=a=>X('div#contenteditable-root[contenteditable="true"]',a,30)?.innerText||"";var un=async a=>{let r=a.querySelector("#badge-name")?.innerText||a.querySelector("#name")?.innerText||"",o=a.querySelector("yt-formatted-string.published-time-text")?.innerText||"",e=a?.querySelector("ytcp-button#more");e&&(e.click(),await vt(100));let t=a.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},si=async a=>{try{let r=at("ytcp-commentbox",a);if(!r)return $.emptyData;let o=at("ytcp-comment-thread",r),e=o?.querySelector("ytcp-comment-button > a[href]"),t=kt.retrieveVideoId(e?.href||""),n=null;if(t){let i=await kt.transcriptFormat(await kt.fetchTranscript(window.location.href),2048),s=o?.querySelector("#video-title > yt-formatted-string")?.innerText||"",m=document.querySelector("#entity-name")?.innerText,p="";n=new $({title:s,author:`${m}`,date:p,content:""},{postTitle:"Video post",meta:{"Post video transcript":i}})}if(r&&n){let i=at("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(i){let s=at("ytcp-comment",r);s&&(X("ytcp-comment-replies",s,5)?.contains(s)&&!s.isSameNode(i)?n.addCommentList([await un(i),await un(s)]):n.addCommentList([await un(i)]))}return n.data}}catch{}return $.emptyData},ci=a=>X("textarea#textarea",a,30)?.innerText||"";var Pr=async a=>{let r=Array.from(a.querySelectorAll("a")).find(i=>i.innerText.trim()!=="")?.innerText||"",o=a.querySelector("time"),e="",t="",n=a.querySelector('div[role="button"][tabindex="0"]');return n&&n?.innerText==="more"&&(n.click(),await vt(500)),o&&(t=o?.dateTime||"",e=at("div",o)?.nextElementSibling?.innerText||""),e||(e=(a.querySelector("h3")||a.querySelector("h2"))?.nextElementSibling?.innerText||""),e||(e=a.querySelector("span[dir] > span[dir]")?.innerText||""),{content:e,author:r.startsWith("@")?r:`${r?`@${r}`:""}`,date:t}},li=async a=>{let r=at("section",a),o=r?.querySelector("textarea")?.value||"",e=r?.parentElement?.parentElement;if(e){let t=e.querySelector("hr")?Array.from(e?.querySelectorAll("hr + div > div > div > div")):Array.from(e?.querySelectorAll("section + div > ul > *")),[n,...i]=t;if(!n){let p=e.querySelector("div:has( > span[dir] > span[dir])");if(p){let c=await Pr(p);return new $({author:c.author,content:c.content,title:"",date:c.date}).data}else return $.emptyData}let s=await Pr(n),m=new $({author:s.author,content:s.content,title:"",date:s.date});if(o.startsWith("@")){let p=o.split(" ")?.[0],c=[];for(let l=0;l<i.length;l++){let u=!1,f=await Pr(i[l]);p.startsWith(f.author)&&(c.push(f),u=!0);let h=Array.from(i[l+1]?.querySelectorAll("ul > div"));if(h.length>0)for(let S=0;S<h.length;S++){let I=await Pr(h[S]);if(p.startsWith(I.author)){c.push(f),c.push(I),u=!0;break}}if(u)break}m.addCommentList(c)}return m.data}return $.emptyData},ui=a=>{let r=X('div[contenteditable="true"]',a,20);return r?r?.innerText||"":X("form textarea",a,20)?.value};var mi=async a=>{let r=a.querySelector('a[data-testid="comment_author_link"]')?.innerHTML||"",o=a.querySelector('div[data-testid="comment"]')?.innerText||a.querySelector("div.RichTextJSON-root")?.innerText||"";return{author:r,date:"",content:o}},fi=async a=>{let r=X('div[data-test-id="post-content"]',a,50);if(r){let o=r.querySelector('div[data-adclicklocation="title"]').innerText||r.querySelector("h1")?.innerText||"",e=r.querySelector('a[data-testid="post_author_link"]')?.innerHTML||"",t=r.querySelector(".RichTextJSON-root").innerText||"",n=new $({author:e,content:t,title:o,date:""}),i=Array.from(document.querySelectorAll("div:has( > div[data-scroller-first])")).find(s=>s.contains(a));if(i){let s=a;for(let m=0;m<100&&!s?.parentElement?.isSameNode(i);m++)s.parentElement&&(s=s.parentElement);if(s){let m=[];m.push(await mi(s));let p=Number(s.querySelector("div[id][style][tabindex]")?.style?.paddingLeft?.replace("px",""))||0,c=s.previousElementSibling,l=Number(i.querySelector("div[data-scroller-first]")?.style?.paddingLeft?.replace("px",""))||16;for(;c&&p>l;){let u=Number(c.querySelector("div[id][style][tabindex]")?.style?.paddingLeft?.replace("px",""))||0;if(p>u)if(m.unshift(await mi(c)),p=u,c.previousElementSibling)c=c.previousElementSibling;else break;else if(p>l&&c.previousElementSibling)c=c.previousElementSibling;else break}n.addCommentList(m)}}return n.data}return $.emptyData},pi=a=>{let r=X('div[contenteditable="true"]',a,15);return r?r?.innerText||"":X('textarea[rows="1"]:has( + span[id])',a,15)?.value||""};var di=async a=>{let r=document.querySelector(a);if(!r)return $.emptyData;let o=$t();return o==="twitter.com"?await Jo(r):o==="linkedin.com"?await ei(r):o==="facebook.com"?await ni(r):o==="youtube.com"?await ii(r):o==="studio.youtube.com"?await si(r):o==="instagram.com"?await li(r):o==="reddit.com"?await fi(r):$.emptyData},hi=async a=>{let r=$t(),o=document.querySelector(a);return o?r==="twitter.com"?Zo(o):r==="linkedin.com"?ri(o):r==="facebook.com"?oi(o):r==="youtube.com"?ai(o):r==="studio.youtube.com"?ci(o):r==="instagram.com"?ui(o):r==="reddit.com"?await pi(o):"":""};var Te=class extends G{static{this.type="GET_SOCIAL_MEDIA_POST_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await hi(e);this.output=t}catch(t){this.error=t.toString()}}};W([j(),z({onlyError:!0}),lt()],Te.prototype,"execute",1);var Ce=class extends G{static{this.type="GET_SOCIAL_MEDIA_POST_CONTENT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await di(e),n=o.getShortCutsEngine();n&&n.pushActions([{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}}}],"after"),this.output=t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}catch(t){this.error=t.toString()}}};W([j(),z({onlyError:!0}),lt()],Ce.prototype,"execute",1);var Ua=async(a,r,o,e=!1)=>{let{chat_history:t=[],message_content:n,prompt_id:i,prompt_name:s,temperature:m=1,doc_id:p}=o,c=$t(),l=new Xt({runtime:"client"});if(e){let{data:h}=await l.postMessage({event:"Client_logCallApiRequest",data:{name:s,id:i,host:c}});if(h)return{success:!1,error:"daily usage limit",data:""}}else l.postMessage({event:"Client_logCallApiRequest",data:{name:s,id:i,host:c}}).then().catch();let u="";if(a==="MAXAI_CLAUDE"?u="/gpt/get_claude_response":a==="USE_CHAT_GPT_PLUS"&&(u="/gpt/get_chatgpt_response"),!u)return{success:!1,error:"no ai provider",data:""};let f=await Cr(`${or}${u}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await Tr()}`},body:JSON.stringify({streaming:!1,message_content:n,chat_history:t,chrome_extension_version:Nn,model_name:r,prompt_id:i,prompt_name:s,temperature:Math.min(m,1.2),...p?{doc_id:p}:{}})});return{success:!0,error:"",data:f.data?.text||f.data?.toString()||f.data||""}},gi=Ua;var Ee=class extends G{static{this.type="WEBGPT_SEARCH_RESULTS_EXPAND"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(!e||!t){this.error="no search result";return}let n=this.parameters.SummarizeActionType||"NO_SUMMARIZE",i=this.parameters.template||"",s=JSON.parse(e),m="",p=[];if(n==="NO_SUMMARIZE")for(let c=0;c<s.length;c++){let l=s[c];p.push({type:"RENDER_TEMPLATE",parameters:{template:l.body}}),p.push({type:"SET_VARIABLE",parameters:{VariableName:`SLICE_OF_TEXT_${c}`}}),m+=`NUMBER:${c+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: {{SLICE_OF_TEXT_${c}}}

`}else n==="MAP_REDUCE"&&(await Promise.all(s.map(async l=>{try{let u=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:l.url,timeOut:2e4}}),f=l.body||"",h=l.title||"";if(u.data.success){let S=Math.floor(Zn/s.length);if(f=u?.data?.body||f,h=u?.data?.title||h,(await qe(f)).length>S){let E=await this.createWebpageSummary(l,i,S);f=Ve(E.data,{trim:!0,noSummaryTag:!0}),f=await ae(f,S)}}return l.title=h,l.body=f,l}catch{return l}}))).forEach((l,u)=>{m+=`NUMBER:${u+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: ${l.body}

`});if(p.push({type:"RENDER_TEMPLATE",parameters:{template:m}}),o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(p,"after");else{this.error="no shortCutsEngine";return}this.output=m}catch(e){this.error=e.toString()}}async createWebpageSummary(r,o,e){return await gi("MAXAI_CLAUDE","claude-instant-v1",{message_content:o.replaceAll("{{WEBPAGE_URL}}",r.url).replaceAll("{{NUMBER_OF_WORDS}}",`${e}`).replaceAll("{{WEBPAGE_CONTENT}}",`${r.body}`),prompt_id:"cae761b7-3703-4ff9-83ab-527b7a24e53b",prompt_name:"[Search] smart page"})}};W([lt(),z({onlyError:!0})],Ee.prototype,"execute",1);var Mr=class{constructor(r){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=r.pageContent?r.pageContent.toString():this.pageContent,this.metadata=r.metadata??{}}};var ka=Object.defineProperty,Fa=(a,r,o)=>r in a?ka(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o,yi=(a,r,o)=>(Fa(a,typeof r!="symbol"?r+"":r,o),o);var Ei=mt(Ci(),1);function za(a,r){let o=Array.from({length:a.length},(e,t)=>({start:t,end:t+1}));for(;o.length>1;){let e=null;for(let t=0;t<o.length-1;t++){let n=a.slice(o[t].start,o[t+1].end),i=r.get(n.join(","));i!=null&&(e==null||i<e[0])&&(e=[i,t])}if(e!=null){let t=e[1];o[t]={start:o[t].start,end:o[t+1].end},o.splice(t+1,1)}else break}return o}function $a(a,r){return a.length===1?[r.get(a.join(","))]:za(a,r).map(o=>r.get(a.slice(o.start,o.end).join(","))).filter(o=>o!=null)}function Qa(a){return a.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var fn=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(a,r){this.patStr=a.pat_str;let o=a.bpe_ranks.split(`
`).filter(Boolean).reduce((e,t)=>{let[n,i,...s]=t.split(" "),m=Number.parseInt(i,10);return s.forEach((p,c)=>e[p]=m+c),e},{});for(let[e,t]of Object.entries(o)){let n=Ei.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...a.special_tokens,...r},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(a,r=[],o="all"){let e=new RegExp(this.patStr,"ug"),t=fn.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(r==="all"?Object.keys(this.specialTokens):r),s=new Set(o==="all"?Object.keys(this.specialTokens).filter(p=>!i.has(p)):o);if(s.size>0){let p=fn.specialTokenRegex([...s]),c=a.match(p);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let m=0;for(;;){let p=null,c=m;for(;t.lastIndex=c,p=t.exec(a),!(p==null||i.has(p[0]));)c=p.index+1;let l=p?.index??a.length;for(let f of a.substring(m,l).matchAll(e)){let h=this.textEncoder.encode(f[0]),S=this.rankMap.get(h.join(","));if(S!=null){n.push(S);continue}n.push(...$a(h,this.rankMap))}if(p==null)break;let u=this.specialTokens[p[0]];n.push(u),m=p.index+p[0].length}return n}decode(a){let r=[],o=0;for(let n=0;n<a.length;++n){let i=a[n],s=this.textMap.get(i)??this.inverseSpecialTokens[i];s!=null&&(r.push(s),o+=s.length)}let e=new Uint8Array(o),t=0;for(let n of r)e.set(n,t),t+=n.length;return this.textDecoder.decode(e)}},pn=fn;yi(pn,"specialTokenRegex",a=>new RegExp(a.map(r=>Qa(r)).join("|"),"g"));var cs=mt(wi(),1),ls=mt(Ni(),1);var Cn=class{constructor(r){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),this.chunkSize=r?.chunkSize??this.chunkSize,this.chunkOverlap=r?.chunkOverlap??this.chunkOverlap,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async createDocuments(r,o=[],e={}){let t=o.length>0?o:new Array(r.length).fill({}),{chunkHeader:n="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:s=!1}=e,m=new Array;for(let p=0;p<r.length;p+=1){let c=r[p],l=1,u=null;for(let f of await this.splitText(c)){let h=n,S=0;if(u){let L=c.indexOf(f),P=c.indexOf(u)+u.length;S=(c.slice(P,L).match(/\n/g)||[]).length,s&&(h+=i)}l+=S;let I=(f.match(/\n/g)||[]).length,E=t[p].loc&&typeof t[p].loc=="object"?{...t[p].loc}:{};E.lines={from:l,to:l+I};let U={...t[p],loc:E};h+=f,m.push(new Mr({pageContent:h,metadata:U})),l+=I,u=f}}return m}async splitDocuments(r,o={}){let e=r.filter(i=>i.pageContent!==void 0),t=e.map(i=>i.pageContent),n=e.map(i=>i.metadata);return this.createDocuments(t,n,o)}joinDocs(r,o){let e=r.join(o).trim();return e===""?null:e}mergeSplits(r,o){let e=[],t=[],n=0;for(let s of r){let m=s.length;if(n+m+(t.length>0?o.length:0)>this.chunkSize&&(n>this.chunkSize,t.length>0)){let p=this.joinDocs(t,o);for(p!==null&&e.push(p);n>this.chunkOverlap||n+m>this.chunkSize&&n>0;)n-=t[0].length,t.shift()}t.push(s),n+=m}let i=this.joinDocs(t,o);return i!==null&&e.push(i),e}};var Nr=class extends Cn{constructor(r){super(r),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=r?.separators??this.separators}async splitText(r){let o=[],e=this.separators[this.separators.length-1];for(let i of this.separators){if(i===""){e=i;break}if(r.includes(i)){e=i;break}}let t;e?t=r.split(e):t=r.split("");let n=[];for(let i of t)if(i.length<this.chunkSize)n.push(i);else{if(n.length){let m=this.mergeSplits(n,e);o.push(...m),n=[]}let s=await this.splitText(i);o.push(...s)}if(n.length){let i=this.mergeSplits(n,e);o.push(...i)}return o}};var Hi=async(a,r=1e3)=>{try{let o=a;return{docs:await new Nr({chunkSize:r}).createDocuments([o])}}catch{return{docs:[]}}};var us=6e3,ms=async(a,r,o)=>{let e=it(),t=[],{docs:n}=await Hi(a,o);(r==="STUFF"||r==="REFINE")&&n.splice(1);let i="",s=Math.ceil(o/n.length);return n.length===1?t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${s} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${n[0].pageContent}
"""`}}):(n.forEach(({pageContent:m},p)=>{let c=m||"";c&&(t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${s} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${c}
"""`}}),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_PART_${p}_ID_${e}`}}),i+=`{{SUMMARIZE_TEXT_PART_${p}_ID_${e}}}
`)}),t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (probably an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${o} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${i}
"""`}})),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_ID_${e}`}}),{variableName:`SUMMARIZE_TEXT_ID_${e}`,actions:t}},be=class extends G{static{this.type="SUMMARIZE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"",t=this.parameters.SummarizeActionType||"STUFF";if(!e){this.error="No text to summarize";return}let{actions:n}=await ms(e,t,this.parameters.SliceTextActionType==="TOKENS"?await to(e,this.parameters.SliceTextActionTokens):this.parameters.SliceTextActionLength||us);if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(n.map(i=>({...i,parameters:{...i.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=""}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],be.prototype,"execute",1);var fs=6e3,ve=class extends G{static{this.type="SLICE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"";if(!e){this.output="";return}if(this.parameters.SliceTextActionType==="TOKENS"||this.parameters.SliceTextActionTokens)this.output=await ae(e,this.parameters.SliceTextActionTokens||4096);else{let t=this.parameters.SliceTextActionLength||fs;this.output=e.slice(0,t)}}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],ve.prototype,"execute",1);var Gi=new Xt,Bi=async a=>(await Gi.postMessage({event:"WebsiteContext_createWebsiteContext",data:{websiteContext:{url:window.location.href||location.href||document.location.href,host:$t(),html:document.documentElement.outerHTML,...a}}})).data;var qi=async(a,r)=>a.id?(await Gi.postMessage({event:"WebsiteContext_updateWebsiteContext",data:{query:a,websiteContext:r}})).success:!1;function ps(a,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in a)){var t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(a,e,t.get?t:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(a)}function Vi(a,r){return new Promise(function(o,e){let t;return ds(a).then(function(n){try{return t=n,o(new Blob([r.slice(0,2),t,r.slice(2)],{type:"image/jpeg"}))}catch(i){return e(i)}},e)})}var ds=a=>new Promise((r,o)=>{let e=new FileReader;e.addEventListener("load",({target:{result:t}})=>{let n=new DataView(t),i=0;if(n.getUint16(i)!==65496)return o("not a valid JPEG");for(i+=2;;){let s=n.getUint16(i);if(s===65498)break;let m=n.getUint16(i+2);if(s===65505&&n.getUint32(i+4)===1165519206){let p=i+10,c;switch(n.getUint16(p)){case 18761:c=!0;break;case 19789:c=!1;break;default:return o("TIFF header contains invalid endian")}if(n.getUint16(p+2,c)!==42)return o("TIFF header contains invalid version");let l=n.getUint32(p+4,c),u=p+l+2+12*n.getUint16(p+l,c);for(let f=p+l+2;f<u;f+=12)if(n.getUint16(f,c)==274){if(n.getUint16(f+2,c)!==3)return o("Orientation data type is invalid");if(n.getUint32(f+4,c)!==1)return o("Orientation data count is invalid");n.setUint16(f+8,1,c);break}return r(t.slice(i,i+2+m))}i+=2+m}return r(new Blob)}),e.readAsArrayBuffer(a)}),Gr={},hs={get exports(){return Gr},set exports(a){Gr=a}};(function(a){var r,o,e={};hs.exports=e,e.parse=function(t,n){for(var i=e.bin.readUshort,s=e.bin.readUint,m=0,p={},c=new Uint8Array(t),l=c.length-4;s(c,l)!=101010256;)l--;m=l,m+=4;var u=i(c,m+=4);i(c,m+=2);var f=s(c,m+=2),h=s(c,m+=4);m+=4,m=h;for(var S=0;S<u;S++){s(c,m),m+=4,m+=4,m+=4,s(c,m+=4),f=s(c,m+=4);var I=s(c,m+=4),E=i(c,m+=4),U=i(c,m+2),L=i(c,m+4);m+=6;var P=s(c,m+=8);m+=4,m+=E+U+L,e._readLocal(c,P,p,f,I,n)}return p},e._readLocal=function(t,n,i,s,m,p){var c=e.bin.readUshort,l=e.bin.readUint;l(t,n),c(t,n+=4),c(t,n+=2);var u=c(t,n+=2);l(t,n+=2),l(t,n+=4),n+=4;var f=c(t,n+=8),h=c(t,n+=2);n+=2;var S=e.bin.readUTF8(t,n,f);if(n+=f,n+=h,p)i[S]={size:m,csize:s};else{var I=new Uint8Array(t.buffer,n);if(u==0)i[S]=new Uint8Array(I.buffer.slice(n,n+s));else{if(u!=8)throw"unknown compression method: "+u;var E=new Uint8Array(m);e.inflateRaw(I,E),i[S]=E}}},e.inflateRaw=function(t,n){return e.F.inflate(t,n)},e.inflate=function(t,n){return t[0],t[1],e.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),n)},e.deflate=function(t,n){n==null&&(n={level:6});var i=0,s=new Uint8Array(50+Math.floor(1.1*t.length));s[i]=120,s[i+1]=156,i+=2,i=e.F.deflateRaw(t,s,i,n.level);var m=e.adler(t,0,t.length);return s[i+0]=m>>>24&255,s[i+1]=m>>>16&255,s[i+2]=m>>>8&255,s[i+3]=m>>>0&255,new Uint8Array(s.buffer,0,i+4)},e.deflateRaw=function(t,n){n==null&&(n={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),s=e.F.deflateRaw(t,i,s,n.level);return new Uint8Array(i.buffer,0,s)},e.encode=function(t,n){n==null&&(n=!1);var i=0,s=e.bin.writeUint,m=e.bin.writeUshort,p={};for(var c in t){var l=!e._noNeed(c)&&!n,u=t[c],f=e.crc.crc(u,0,u.length);p[c]={cpr:l,usize:u.length,crc:f,file:l?e.deflateRaw(u):u}}for(var c in p)i+=p[c].file.length+30+46+2*e.bin.sizeUTF8(c);i+=22;var h=new Uint8Array(i),S=0,I=[];for(var c in p){var E=p[c];I.push(S),S=e._writeHeader(h,S,c,E,0)}var U=0,L=S;for(var c in p)E=p[c],I.push(S),S=e._writeHeader(h,S,c,E,1,I[U++]);var P=S-L;return s(h,S,101010256),S+=4,m(h,S+=4,U),m(h,S+=2,U),s(h,S+=2,P),s(h,S+=4,L),S+=4,S+=2,h.buffer},e._noNeed=function(t){var n=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},e._writeHeader=function(t,n,i,s,m,p){var c=e.bin.writeUint,l=e.bin.writeUshort,u=s.file;return c(t,n,m==0?67324752:33639248),n+=4,m==1&&(n+=2),l(t,n,20),l(t,n+=2,0),l(t,n+=2,s.cpr?8:0),c(t,n+=2,0),c(t,n+=4,s.crc),c(t,n+=4,u.length),c(t,n+=4,s.usize),l(t,n+=4,e.bin.sizeUTF8(i)),l(t,n+=2,0),n+=2,m==1&&(n+=2,n+=2,c(t,n+=6,p),n+=4),n+=e.bin.writeUTF8(t,n,i),m==0&&(t.set(u,n),n+=u.length),n},e.crc={table:function(){for(var t=new Uint32Array(256),n=0;n<256;n++){for(var i=n,s=0;s<8;s++)1&i?i=3988292384^i>>>1:i>>>=1;t[n]=i}return t}(),update:function(t,n,i,s){for(var m=0;m<s;m++)t=e.crc.table[255&(t^n[i+m])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.adler=function(t,n,i){for(var s=1,m=0,p=n,c=n+i;p<c;){for(var l=Math.min(p+5552,c);p<l;)m+=s+=t[p++];s%=65521,m%=65521}return m<<16|s},e.bin={readUshort:function(t,n){return t[n]|t[n+1]<<8},writeUshort:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255},readUint:function(t,n){return 16777216*t[n+3]+(t[n+2]<<16|t[n+1]<<8|t[n])},writeUint:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255,t[n+2]=i>>16&255,t[n+3]=i>>24&255},readASCII:function(t,n,i){for(var s="",m=0;m<i;m++)s+=String.fromCharCode(t[n+m]);return s},writeASCII:function(t,n,i){for(var s=0;s<i.length;s++)t[n+s]=i.charCodeAt(s)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,n,i){for(var s,m="",p=0;p<i;p++)m+="%"+e.bin.pad(t[n+p].toString(16));try{s=decodeURIComponent(m)}catch{return e.bin.readASCII(t,n,i)}return s},writeUTF8:function(t,n,i){for(var s=i.length,m=0,p=0;p<s;p++){var c=i.charCodeAt(p);if(!(4294967168&c))t[n+m]=c,m++;else if(!(4294965248&c))t[n+m]=192|c>>6,t[n+m+1]=128|c>>0&63,m+=2;else if(!(4294901760&c))t[n+m]=224|c>>12,t[n+m+1]=128|c>>6&63,t[n+m+2]=128|c>>0&63,m+=3;else{if(4292870144&c)throw"e";t[n+m]=240|c>>18,t[n+m+1]=128|c>>12&63,t[n+m+2]=128|c>>6&63,t[n+m+3]=128|c>>0&63,m+=4}}return m},sizeUTF8:function(t){for(var n=t.length,i=0,s=0;s<n;s++){var m=t.charCodeAt(s);if(!(4294967168&m))i++;else if(!(4294965248&m))i+=2;else if(!(4294901760&m))i+=3;else{if(4292870144&m)throw"e";i+=4}}return i}},e.F={},e.F.deflateRaw=function(t,n,i,s){var m=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][s],p=e.F.U,c=e.F._goodIndex;e.F._hash;var l=e.F._putsE,u=0,f=i<<3,h=0,S=t.length;if(s==0){for(;u<S;)l(n,f,u+(b=Math.min(65535,S-u))==S?1:0),f=e.F._copyExact(t,u,b,n,f+8),u+=b;return f>>>3}var I=p.lits,E=p.strt,U=p.prev,L=0,P=0,O=0,C=0,R=0,y=0;for(S>2&&(E[y=e.F._hash(t,0)]=0),u=0;u<S;u++){if(R=y,u+1<S-2){y=e.F._hash(t,u+1);var g=u+1&32767;U[g]=E[y],E[y]=g}if(h<=u){(L>14e3||P>26697)&&S-u>100&&(h<u&&(I[L]=u-h,L+=2,h=u),f=e.F._writeBlock(u==S-1||h==S?1:0,I,L,C,t,O,u-O,n,f),L=P=C=0,O=u);var x=0;u<S-2&&(x=e.F._bestMatch(t,u,U,R,Math.min(m[2],S-u),m[3]));var b=x>>>16,v=65535&x;if(x!=0){v=65535&x;var _=c(b=x>>>16,p.of0);p.lhst[257+_]++;var T=c(v,p.df0);p.dhst[T]++,C+=p.exb[_]+p.dxb[T],I[L]=b<<23|u-h,I[L+1]=v<<16|_<<8|T,L+=2,h=u+b}else p.lhst[t[u]]++;P++}}for(O==u&&t.length!=0||(h<u&&(I[L]=u-h,L+=2,h=u),f=e.F._writeBlock(1,I,L,C,t,O,u-O,n,f),L=0,P=0,L=P=C=0,O=u);7&f;)f++;return f>>>3},e.F._bestMatch=function(t,n,i,s,m,p){var c=32767&n,l=i[c],u=c-l+32768&32767;if(l==c||s!=e.F._hash(t,n-u))return 0;for(var f=0,h=0,S=Math.min(32767,n);u<=S&&--p!=0&&l!=c;){if(f==0||t[n+f]==t[n+f-u]){var I=e.F._howLong(t,n,u);if(I>f){if(h=u,(f=I)>=m)break;u+2<I&&(I=u+2);for(var E=0,U=0;U<I-2;U++){var L=n-u+U+32768&32767,P=L-i[L]+32768&32767;P>E&&(E=P,l=L)}}}u+=(c=l)-(l=i[c])+32768&32767}return f<<16|h},e.F._howLong=function(t,n,i){if(t[n]!=t[n-i]||t[n+1]!=t[n+1-i]||t[n+2]!=t[n+2-i])return 0;var s=n,m=Math.min(t.length,n+258);for(n+=3;n<m&&t[n]==t[n-i];)n++;return n-s},e.F._hash=function(t,n){return(t[n]<<8|t[n+1])+(t[n+2]<<4)&65535},e.saved=0,e.F._writeBlock=function(t,n,i,s,m,p,c,l,u){var f,h,S,I,E,U,L,P,O,C=e.F.U,R=e.F._putsF,y=e.F._putsE;C.lhst[256]++,h=(f=e.F.getTrees())[0],S=f[1],I=f[2],E=f[3],U=f[4],L=f[5],P=f[6],O=f[7];var g=32+(u+3&7?8-(u+3&7):0)+(c<<3),x=s+e.F.contSize(C.fltree,C.lhst)+e.F.contSize(C.fdtree,C.dhst),b=s+e.F.contSize(C.ltree,C.lhst)+e.F.contSize(C.dtree,C.dhst);b+=14+3*L+e.F.contSize(C.itree,C.ihst)+(2*C.ihst[16]+3*C.ihst[17]+7*C.ihst[18]);for(var v=0;v<286;v++)C.lhst[v]=0;for(v=0;v<30;v++)C.dhst[v]=0;for(v=0;v<19;v++)C.ihst[v]=0;var _=g<x&&g<b?0:x<b?1:2;if(R(l,u,t),R(l,u+1,_),u+=3,_==0){for(;7&u;)u++;u=e.F._copyExact(m,p,c,l,u)}else{var T,w;if(_==1&&(T=C.fltree,w=C.fdtree),_==2){e.F.makeCodes(C.ltree,h),e.F.revCodes(C.ltree,h),e.F.makeCodes(C.dtree,S),e.F.revCodes(C.dtree,S),e.F.makeCodes(C.itree,I),e.F.revCodes(C.itree,I),T=C.ltree,w=C.dtree,y(l,u,E-257),y(l,u+=5,U-1),y(l,u+=5,L-4),u+=4;for(var A=0;A<L;A++)y(l,u+3*A,C.itree[1+(C.ordr[A]<<1)]);u+=3*L,u=e.F._codeTiny(P,C.itree,l,u),u=e.F._codeTiny(O,C.itree,l,u)}for(var d=p,k=0;k<i;k+=2){for(var M=n[k],F=M>>>23,q=d+(8388607&M);d<q;)u=e.F._writeLit(m[d++],T,l,u);if(F!=0){var H=n[k+1],B=H>>16,N=H>>8&255,D=255&H;y(l,u=e.F._writeLit(257+N,T,l,u),F-C.of0[N]),u+=C.exb[N],R(l,u=e.F._writeLit(D,w,l,u),B-C.df0[D]),u+=C.dxb[D],d+=F}}u=e.F._writeLit(256,T,l,u)}return u},e.F._copyExact=function(t,n,i,s,m){var p=m>>>3;return s[p]=i,s[p+1]=i>>>8,s[p+2]=255-s[p],s[p+3]=255-s[p+1],p+=4,s.set(new Uint8Array(t.buffer,n,i),p),m+(i+4<<3)},e.F.getTrees=function(){for(var t=e.F.U,n=e.F._hufTree(t.lhst,t.ltree,15),i=e.F._hufTree(t.dhst,t.dtree,15),s=[],m=e.F._lenCodes(t.ltree,s),p=[],c=e.F._lenCodes(t.dtree,p),l=0;l<s.length;l+=2)t.ihst[s[l]]++;for(l=0;l<p.length;l+=2)t.ihst[p[l]]++;for(var u=e.F._hufTree(t.ihst,t.itree,7),f=19;f>4&&t.itree[1+(t.ordr[f-1]<<1)]==0;)f--;return[n,i,u,m,c,f,s,p]},e.F.getSecond=function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(t[i+1]);return n},e.F.nonZero=function(t){for(var n="",i=0;i<t.length;i+=2)t[i+1]!=0&&(n+=(i>>1)+",");return n},e.F.contSize=function(t,n){for(var i=0,s=0;s<n.length;s++)i+=n[s]*t[1+(s<<1)];return i},e.F._codeTiny=function(t,n,i,s){for(var m=0;m<t.length;m+=2){var p=t[m],c=t[m+1];s=e.F._writeLit(p,n,i,s);var l=p==16?2:p==17?3:7;p>15&&(e.F._putsE(i,s,c,l),s+=l)}return s},e.F._lenCodes=function(t,n){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var s=0;s<i;s+=2){var m=t[s+1],p=s+3<i?t[s+3]:-1,c=s+5<i?t[s+5]:-1,l=s==0?-1:t[s-1];if(m==0&&p==m&&c==m){for(var u=s+5;u+2<i&&t[u+2]==m;)u+=2;(f=Math.min(u+1-s>>>1,138))<11?n.push(17,f-3):n.push(18,f-11),s+=2*f-2}else if(m==l&&p==m&&c==m){for(u=s+5;u+2<i&&t[u+2]==m;)u+=2;var f=Math.min(u+1-s>>>1,6);n.push(16,f-3),s+=2*f-2}else n.push(m,0)}return i>>>1},e.F._hufTree=function(t,n,i){var s=[],m=t.length,p=n.length,c=0;for(c=0;c<p;c+=2)n[c]=0,n[c+1]=0;for(c=0;c<m;c++)t[c]!=0&&s.push({lit:c,f:t[c]});var l=s.length,u=s.slice(0);if(l==0)return 0;if(l==1){var f=s[0].lit;return u=f==0?1:0,n[1+(f<<1)]=1,n[1+(u<<1)]=1,1}s.sort(function(P,O){return P.f-O.f});var h=s[0],S=s[1],I=0,E=1,U=2;for(s[0]={lit:-1,f:h.f+S.f,l:h,r:S,d:0};E!=l-1;)h=I!=E&&(U==l||s[I].f<s[U].f)?s[I++]:s[U++],S=I!=E&&(U==l||s[I].f<s[U].f)?s[I++]:s[U++],s[E++]={lit:-1,f:h.f+S.f,l:h,r:S};var L=e.F.setDepth(s[E-1],0);for(L>i&&(e.F.restrictDepth(u,i,L),L=i),c=0;c<l;c++)n[1+(u[c].lit<<1)]=u[c].d;return L},e.F.setDepth=function(t,n){return t.lit!=-1?(t.d=n,n):Math.max(e.F.setDepth(t.l,n+1),e.F.setDepth(t.r,n+1))},e.F.restrictDepth=function(t,n,i){var s=0,m=1<<i-n,p=0;for(t.sort(function(l,u){return u.d==l.d?l.f-u.f:u.d-l.d}),s=0;s<t.length&&t[s].d>n;s++){var c=t[s].d;t[s].d=n,p+=m-(1<<i-c)}for(p>>>=i-n;p>0;)(c=t[s].d)<n?(t[s].d++,p-=1<<n-c-1):s++;for(;s>=0;s--)t[s].d==n&&p<0&&(t[s].d--,p++);p!=0},e.F._goodIndex=function(t,n){var i=0;return n[16|i]<=t&&(i|=16),n[8|i]<=t&&(i|=8),n[4|i]<=t&&(i|=4),n[2|i]<=t&&(i|=2),n[1|i]<=t&&(i|=1),i},e.F._writeLit=function(t,n,i,s){return e.F._putsF(i,s,n[t<<1]),s+n[1+(t<<1)]},e.F.inflate=function(t,n){var i=Uint8Array;if(t[0]==3&&t[1]==0)return n||new i(0);var s=e.F,m=s._bitsF,p=s._bitsE,c=s._decodeTiny,l=s.makeCodes,u=s.codes2map,f=s._get17,h=s.U,S=n==null;S&&(n=new i(t.length>>>2<<3));for(var I,E,U=0,L=0,P=0,O=0,C=0,R=0,y=0,g=0,x=0;U==0;)if(U=m(t,x,1),L=m(t,x+1,2),x+=3,L!=0){if(S&&(n=e.F._check(n,g+(1<<17))),L==1&&(I=h.flmap,E=h.fdmap,R=511,y=31),L==2){P=p(t,x,5)+257,O=p(t,x+5,5)+1,C=p(t,x+10,4)+4,x+=14;for(var b=0;b<38;b+=2)h.itree[b]=0,h.itree[b+1]=0;var v=1;for(b=0;b<C;b++){var _=p(t,x+3*b,3);h.itree[1+(h.ordr[b]<<1)]=_,_>v&&(v=_)}x+=3*C,l(h.itree,v),u(h.itree,v,h.imap),I=h.lmap,E=h.dmap,x=c(h.imap,(1<<v)-1,P+O,t,x,h.ttree);var T=s._copyOut(h.ttree,0,P,h.ltree);R=(1<<T)-1;var w=s._copyOut(h.ttree,P,O,h.dtree);y=(1<<w)-1,l(h.ltree,T),u(h.ltree,T,I),l(h.dtree,w),u(h.dtree,w,E)}for(;;){var A=I[f(t,x)&R];x+=15&A;var d=A>>>4;if(!(d>>>8))n[g++]=d;else{if(d==256)break;var k=g+d-254;if(d>264){var M=h.ldef[d-257];k=g+(M>>>3)+p(t,x,7&M),x+=7&M}var F=E[f(t,x)&y];x+=15&F;var q=F>>>4,H=h.ddef[q],B=(H>>>4)+m(t,x,15&H);for(x+=15&H,S&&(n=e.F._check(n,g+(1<<17)));g<k;)n[g]=n[g++-B],n[g]=n[g++-B],n[g]=n[g++-B],n[g]=n[g++-B];g=k}}}else{7&x&&(x+=8-(7&x));var N=4+(x>>>3),D=t[N-4]|t[N-3]<<8;S&&(n=e.F._check(n,g+D)),n.set(new i(t.buffer,t.byteOffset+N,D),g),x=N+D<<3,g+=D}return n.length==g?n:n.slice(0,g)},e.F._check=function(t,n){var i=t.length;if(n<=i)return t;var s=new Uint8Array(Math.max(i<<1,n));return s.set(t,0),s},e.F._decodeTiny=function(t,n,i,s,m,p){for(var c=e.F._bitsE,l=e.F._get17,u=0;u<i;){var f=t[l(s,m)&n];m+=15&f;var h=f>>>4;if(h<=15)p[u]=h,u++;else{var S=0,I=0;h==16?(I=3+c(s,m,2),m+=2,S=p[u-1]):h==17?(I=3+c(s,m,3),m+=3):h==18&&(I=11+c(s,m,7),m+=7);for(var E=u+I;u<E;)p[u]=S,u++}}return m},e.F._copyOut=function(t,n,i,s){for(var m=0,p=0,c=s.length>>>1;p<i;){var l=t[p+n];s[p<<1]=0,s[1+(p<<1)]=l,l>m&&(m=l),p++}for(;p<c;)s[p<<1]=0,s[1+(p<<1)]=0,p++;return m},e.F.makeCodes=function(t,n){for(var i,s,m,p,c=e.F.U,l=t.length,u=c.bl_count,f=0;f<=n;f++)u[f]=0;for(f=1;f<l;f+=2)u[t[f]]++;var h=c.next_code;for(i=0,u[0]=0,s=1;s<=n;s++)i=i+u[s-1]<<1,h[s]=i;for(m=0;m<l;m+=2)(p=t[m+1])!=0&&(t[m]=h[p],h[p]++)},e.F.codes2map=function(t,n,i){for(var s=t.length,m=e.F.U.rev15,p=0;p<s;p+=2)if(t[p+1]!=0)for(var c=p>>1,l=t[p+1],u=c<<4|l,f=n-l,h=t[p]<<f,S=h+(1<<f);h!=S;)i[m[h]>>>15-n]=u,h++},e.F.revCodes=function(t,n){for(var i=e.F.U.rev15,s=15-n,m=0;m<t.length;m+=2){var p=t[m]<<n-t[m+1];t[m]=i[p]>>>s}},e.F._putsE=function(t,n,i){i<<=7&n;var s=n>>>3;t[s]|=i,t[s+1]|=i>>>8},e.F._putsF=function(t,n,i){i<<=7&n;var s=n>>>3;t[s]|=i,t[s+1]|=i>>>8,t[s+2]|=i>>>16},e.F._bitsE=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8)>>>(7&n)&(1<<i)-1},e.F._bitsF=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)&(1<<i)-1},e.F._get17=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)},e.F._get25=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16|t[3+(n>>>3)]<<24)>>>(7&n)},e.F.U=(r=Uint16Array,o=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var t=e.F.U,n=0;n<32768;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[n]=(i>>>16|i<<16)>>>17}function s(m,p,c){for(;p--!=0;)m.push(0,c)}for(n=0;n<32;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];s(t.fltree,144,8),s(t.fltree,112,9),s(t.fltree,24,7),s(t.fltree,8,8),e.F.makeCodes(t.fltree,9),e.F.codes2map(t.fltree,9,t.flmap),e.F.revCodes(t.fltree,9),s(t.fdtree,32,5),e.F.makeCodes(t.fdtree,5),e.F.codes2map(t.fdtree,5,t.fdmap),e.F.revCodes(t.fdtree,5),s(t.itree,19,0),s(t.ltree,286,0),s(t.dtree,30,0),s(t.ttree,320,0)}()})();var gs=ps({__proto__:null,default:Gr},[Gr]),Ft=function(){var a={nextZero(c,l){for(;c[l]!=0;)l++;return l},readUshort:(c,l)=>c[l]<<8|c[l+1],writeUshort(c,l,u){c[l]=u>>8&255,c[l+1]=255&u},readUint:(c,l)=>16777216*c[l]+(c[l+1]<<16|c[l+2]<<8|c[l+3]),writeUint(c,l,u){c[l]=u>>24&255,c[l+1]=u>>16&255,c[l+2]=u>>8&255,c[l+3]=255&u},readASCII(c,l,u){let f="";for(let h=0;h<u;h++)f+=String.fromCharCode(c[l+h]);return f},writeASCII(c,l,u){for(let f=0;f<u.length;f++)c[l+f]=u.charCodeAt(f)},readBytes(c,l,u){let f=[];for(let h=0;h<u;h++)f.push(c[l+h]);return f},pad:c=>c.length<2?`0${c}`:c,readUTF8(c,l,u){let f,h="";for(let S=0;S<u;S++)h+=`%${a.pad(c[l+S].toString(16))}`;try{f=decodeURIComponent(h)}catch{return a.readASCII(c,l,u)}return f}};function r(c,l,u,f){let h=l*u,S=n(f),I=Math.ceil(l*S/8),E=new Uint8Array(4*h),U=new Uint32Array(E.buffer),{ctype:L}=f,{depth:P}=f,O=a.readUshort;if(L==6){let M=h<<2;if(P==8)for(var C=0;C<M;C+=4)E[C]=c[C],E[C+1]=c[C+1],E[C+2]=c[C+2],E[C+3]=c[C+3];if(P==16)for(C=0;C<M;C++)E[C]=c[C<<1]}else if(L==2){let M=f.tabs.tRNS;if(M==null){if(P==8)for(C=0;C<h;C++){var R=3*C;U[C]=255<<24|c[R+2]<<16|c[R+1]<<8|c[R]}if(P==16)for(C=0;C<h;C++)R=6*C,U[C]=255<<24|c[R+4]<<16|c[R+2]<<8|c[R]}else{var y=M[0];let F=M[1],q=M[2];if(P==8)for(C=0;C<h;C++){var g=C<<2;R=3*C,U[C]=255<<24|c[R+2]<<16|c[R+1]<<8|c[R],c[R]==y&&c[R+1]==F&&c[R+2]==q&&(E[g+3]=0)}if(P==16)for(C=0;C<h;C++)g=C<<2,R=6*C,U[C]=255<<24|c[R+4]<<16|c[R+2]<<8|c[R],O(c,R)==y&&O(c,R+2)==F&&O(c,R+4)==q&&(E[g+3]=0)}}else if(L==3){let M=f.tabs.PLTE,F=f.tabs.tRNS,q=F?F.length:0;if(P==1)for(var x=0;x<u;x++){var b=x*I,v=x*l;for(C=0;C<l;C++){g=v+C<<2;var _=3*(T=c[b+(C>>3)]>>7-((7&C)<<0)&1);E[g]=M[_],E[g+1]=M[_+1],E[g+2]=M[_+2],E[g+3]=T<q?F[T]:255}}if(P==2)for(x=0;x<u;x++)for(b=x*I,v=x*l,C=0;C<l;C++)g=v+C<<2,_=3*(T=c[b+(C>>2)]>>6-((3&C)<<1)&3),E[g]=M[_],E[g+1]=M[_+1],E[g+2]=M[_+2],E[g+3]=T<q?F[T]:255;if(P==4)for(x=0;x<u;x++)for(b=x*I,v=x*l,C=0;C<l;C++)g=v+C<<2,_=3*(T=c[b+(C>>1)]>>4-((1&C)<<2)&15),E[g]=M[_],E[g+1]=M[_+1],E[g+2]=M[_+2],E[g+3]=T<q?F[T]:255;if(P==8)for(C=0;C<h;C++){var T;g=C<<2,_=3*(T=c[C]),E[g]=M[_],E[g+1]=M[_+1],E[g+2]=M[_+2],E[g+3]=T<q?F[T]:255}}else if(L==4){if(P==8)for(C=0;C<h;C++){g=C<<2;var w=c[A=C<<1];E[g]=w,E[g+1]=w,E[g+2]=w,E[g+3]=c[A+1]}if(P==16)for(C=0;C<h;C++){var A;g=C<<2,w=c[A=C<<2],E[g]=w,E[g+1]=w,E[g+2]=w,E[g+3]=c[A+2]}}else if(L==0)for(y=f.tabs.tRNS?f.tabs.tRNS:-1,x=0;x<u;x++){let M=x*I,F=x*l;if(P==1)for(var d=0;d<l;d++){var k=(w=255*(c[M+(d>>>3)]>>>7-(7&d)&1))==255*y?0:255;U[F+d]=k<<24|w<<16|w<<8|w}else if(P==2)for(d=0;d<l;d++)k=(w=85*(c[M+(d>>>2)]>>>6-((3&d)<<1)&3))==85*y?0:255,U[F+d]=k<<24|w<<16|w<<8|w;else if(P==4)for(d=0;d<l;d++)k=(w=17*(c[M+(d>>>1)]>>>4-((1&d)<<2)&15))==17*y?0:255,U[F+d]=k<<24|w<<16|w<<8|w;else if(P==8)for(d=0;d<l;d++)k=(w=c[M+d])==y?0:255,U[F+d]=k<<24|w<<16|w<<8|w;else if(P==16)for(d=0;d<l;d++)w=c[M+(d<<1)],k=O(c,M+(d<<1))==y?0:255,U[F+d]=k<<24|w<<16|w<<8|w}return E}function o(c,l,u,f){let h=n(c),S=Math.ceil(u*h/8),I=new Uint8Array((S+1+c.interlace)*f);return l=c.tabs.CgBI?t(l,I):e(l,I),c.interlace==0?l=i(l,c,0,u,f):c.interlace==1&&(l=function(U,L){let P=L.width,O=L.height,C=n(L),R=C>>3,y=Math.ceil(P*C/8),g=new Uint8Array(O*y),x=0,b=[0,0,4,0,2,0,1],v=[0,4,0,2,0,1,0],_=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1],w=0;for(;w<7;){let d=_[w],k=T[w],M=0,F=0,q=b[w];for(;q<O;)q+=d,F++;let H=v[w];for(;H<P;)H+=k,M++;let B=Math.ceil(M*C/8);i(U,L,x,M,F);let N=0,D=b[w];for(;D<O;){let V=v[w],et=x+N*B<<3;for(;V<P;){var A;if(C==1&&(A=(A=U[et>>3])>>7-(7&et)&1,g[D*y+(V>>3)]|=A<<7-((7&V)<<0)),C==2&&(A=(A=U[et>>3])>>6-(7&et)&3,g[D*y+(V>>2)]|=A<<6-((3&V)<<1)),C==4&&(A=(A=U[et>>3])>>4-(7&et)&15,g[D*y+(V>>1)]|=A<<4-((1&V)<<2)),C>=8){let Y=D*y+V*R;for(let Q=0;Q<R;Q++)g[Y+Q]=U[(et>>3)+Q]}et+=C,V+=k}N++,D+=d}M*F!=0&&(x+=F*(1+B)),w+=1}return g}(l,c)),l}function e(c,l){return t(new Uint8Array(c.buffer,2,c.length-6),l)}var t=function(){let c={H:{}};return c.H.N=function(l,u){let f=Uint8Array,h,S,I=0,E=0,U=0,L=0,P=0,O=0,C=0,R=0,y=0;if(l[0]==3&&l[1]==0)return u||new f(0);let g=c.H,x=g.b,b=g.e,v=g.R,_=g.n,T=g.A,w=g.Z,A=g.m,d=u==null;for(d&&(u=new f(l.length>>>2<<5));I==0;)if(I=x(l,y,1),E=x(l,y+1,2),y+=3,E!=0){if(d&&(u=c.H.W(u,R+(1<<17))),E==1&&(h=A.J,S=A.h,O=511,C=31),E==2){U=b(l,y,5)+257,L=b(l,y+5,5)+1,P=b(l,y+10,4)+4,y+=14;let M=1;for(var k=0;k<38;k+=2)A.Q[k]=0,A.Q[k+1]=0;for(k=0;k<P;k++){let H=b(l,y+3*k,3);A.Q[1+(A.X[k]<<1)]=H,H>M&&(M=H)}y+=3*P,_(A.Q,M),T(A.Q,M,A.u),h=A.w,S=A.d,y=v(A.u,(1<<M)-1,U+L,l,y,A.v);let F=g.V(A.v,0,U,A.C);O=(1<<F)-1;let q=g.V(A.v,U,L,A.D);C=(1<<q)-1,_(A.C,F),T(A.C,F,h),_(A.D,q),T(A.D,q,S)}for(;;){let M=h[w(l,y)&O];y+=15&M;let F=M>>>4;if(!(F>>>8))u[R++]=F;else{if(F==256)break;{let q=R+F-254;if(F>264){let V=A.q[F-257];q=R+(V>>>3)+b(l,y,7&V),y+=7&V}let H=S[w(l,y)&C];y+=15&H;let B=H>>>4,N=A.c[B],D=(N>>>4)+x(l,y,15&N);for(y+=15&N;R<q;)u[R]=u[R++-D],u[R]=u[R++-D],u[R]=u[R++-D],u[R]=u[R++-D];R=q}}}}else{7&y&&(y+=8-(7&y));let M=4+(y>>>3),F=l[M-4]|l[M-3]<<8;d&&(u=c.H.W(u,R+F)),u.set(new f(l.buffer,l.byteOffset+M,F),R),y=M+F<<3,R+=F}return u.length==R?u:u.slice(0,R)},c.H.W=function(l,u){let f=l.length;if(u<=f)return l;let h=new Uint8Array(f<<1);return h.set(l,0),h},c.H.R=function(l,u,f,h,S,I){let E=c.H.e,U=c.H.Z,L=0;for(;L<f;){let P=l[U(h,S)&u];S+=15&P;let O=P>>>4;if(O<=15)I[L]=O,L++;else{let C=0,R=0;O==16?(R=3+E(h,S,2),S+=2,C=I[L-1]):O==17?(R=3+E(h,S,3),S+=3):O==18&&(R=11+E(h,S,7),S+=7);let y=L+R;for(;L<y;)I[L]=C,L++}}return S},c.H.V=function(l,u,f,h){let S=0,I=0,E=h.length>>>1;for(;I<f;){let U=l[I+u];h[I<<1]=0,h[1+(I<<1)]=U,U>S&&(S=U),I++}for(;I<E;)h[I<<1]=0,h[1+(I<<1)]=0,I++;return S},c.H.n=function(l,u){let f=c.H.m,h=l.length,S,I,E,U,L=f.j;for(var P=0;P<=u;P++)L[P]=0;for(P=1;P<h;P+=2)L[l[P]]++;let O=f.K;for(S=0,L[0]=0,I=1;I<=u;I++)S=S+L[I-1]<<1,O[I]=S;for(E=0;E<h;E+=2)U=l[E+1],U!=0&&(l[E]=O[U],O[U]++)},c.H.A=function(l,u,f){let h=l.length,S=c.H.m.r;for(let I=0;I<h;I+=2)if(l[I+1]!=0){let E=I>>1,U=l[I+1],L=E<<4|U,P=u-U,O=l[I]<<P,C=O+(1<<P);for(;O!=C;)f[S[O]>>>15-u]=L,O++}},c.H.l=function(l,u){let f=c.H.m.r,h=15-u;for(let S=0;S<l.length;S+=2){let I=l[S]<<u-l[S+1];l[S]=f[I]>>>h}},c.H.M=function(l,u,f){f<<=7&u;let h=u>>>3;l[h]|=f,l[h+1]|=f>>>8},c.H.I=function(l,u,f){f<<=7&u;let h=u>>>3;l[h]|=f,l[h+1]|=f>>>8,l[h+2]|=f>>>16},c.H.e=function(l,u,f){return(l[u>>>3]|l[1+(u>>>3)]<<8)>>>(7&u)&(1<<f)-1},c.H.b=function(l,u,f){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)&(1<<f)-1},c.H.Z=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)},c.H.i=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16|l[3+(u>>>3)]<<24)>>>(7&u)},c.H.m=function(){let l=Uint16Array,u=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new u(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new u(286),Y:new u(30),a:new u(19),t:new u(15e3),k:new l(65536),g:new l(32768)}}(),function(){let l=c.H.m;for(var u=0;u<32768;u++){let h=u;h=(2863311530&h)>>>1|(1431655765&h)<<1,h=(3435973836&h)>>>2|(858993459&h)<<2,h=(4042322160&h)>>>4|(252645135&h)<<4,h=(4278255360&h)>>>8|(16711935&h)<<8,l.r[u]=(h>>>16|h<<16)>>>17}function f(h,S,I){for(;S--!=0;)h.push(0,I)}for(u=0;u<32;u++)l.q[u]=l.S[u]<<3|l.T[u],l.c[u]=l.p[u]<<4|l.z[u];f(l._,144,8),f(l._,112,9),f(l._,24,7),f(l._,8,8),c.H.n(l._,9),c.H.A(l._,9,l.J),c.H.l(l._,9),f(l.$,32,5),c.H.n(l.$,5),c.H.A(l.$,5,l.h),c.H.l(l.$,5),f(l.Q,19,0),f(l.C,286,0),f(l.D,30,0),f(l.v,320,0)}(),c.H.N}();function n(c){return[1,null,3,1,2,null,4][c.ctype]*c.depth}function i(c,l,u,f,h){let S=n(l),I=Math.ceil(f*S/8),E,U;S=Math.ceil(S/8);let L=c[u],P=0;if(L>1&&(c[u]=[0,0,1][L-2]),L==3)for(P=S;P<I;P++)c[P+1]=c[P+1]+(c[P+1-S]>>>1)&255;for(let O=0;O<h;O++)if(E=u+O*I,U=E+O+1,L=c[U-1],P=0,L==0)for(;P<I;P++)c[E+P]=c[U+P];else if(L==1){for(;P<S;P++)c[E+P]=c[U+P];for(;P<I;P++)c[E+P]=c[U+P]+c[E+P-S]}else if(L==2)for(;P<I;P++)c[E+P]=c[U+P]+c[E+P-I];else if(L==3){for(;P<S;P++)c[E+P]=c[U+P]+(c[E+P-I]>>>1);for(;P<I;P++)c[E+P]=c[U+P]+(c[E+P-I]+c[E+P-S]>>>1)}else{for(;P<S;P++)c[E+P]=c[U+P]+s(0,c[E+P-I],0);for(;P<I;P++)c[E+P]=c[U+P]+s(c[E+P-S],c[E+P-I],c[E+P-S-I])}return c}function s(c,l,u){let f=c+l-u,h=f-c,S=f-l,I=f-u;return h*h<=S*S&&h*h<=I*I?c:S*S<=I*I?l:u}function m(c,l,u){u.width=a.readUint(c,l),l+=4,u.height=a.readUint(c,l),l+=4,u.depth=c[l],l++,u.ctype=c[l],l++,u.compress=c[l],l++,u.filter=c[l],l++,u.interlace=c[l],l++}function p(c,l,u,f,h,S,I,E,U){let L=Math.min(l,h),P=Math.min(u,S),O=0,C=0;for(let w=0;w<P;w++)for(let A=0;A<L;A++)if(I>=0&&E>=0?(O=w*l+A<<2,C=(E+w)*h+I+A<<2):(O=(-E+w)*l-I+A<<2,C=w*h+A<<2),U==0)f[C]=c[O],f[C+1]=c[O+1],f[C+2]=c[O+2],f[C+3]=c[O+3];else if(U==1){var R=c[O+3]*.00392156862745098,y=c[O]*R,g=c[O+1]*R,x=c[O+2]*R,b=f[C+3]*(1/255),v=f[C]*b,_=f[C+1]*b,T=f[C+2]*b;let d=1-R,k=R+b*d,M=k==0?0:1/k;f[C+3]=255*k,f[C+0]=(y+v*d)*M,f[C+1]=(g+_*d)*M,f[C+2]=(x+T*d)*M}else if(U==2)R=c[O+3],y=c[O],g=c[O+1],x=c[O+2],b=f[C+3],v=f[C],_=f[C+1],T=f[C+2],R==b&&y==v&&g==_&&x==T?(f[C]=0,f[C+1]=0,f[C+2]=0,f[C+3]=0):(f[C]=y,f[C+1]=g,f[C+2]=x,f[C+3]=R);else if(U==3){if(R=c[O+3],y=c[O],g=c[O+1],x=c[O+2],b=f[C+3],v=f[C],_=f[C+1],T=f[C+2],R==b&&y==v&&g==_&&x==T)continue;if(R<220&&b>20)return!1}return!0}return{decode:function(l){let u=new Uint8Array(l),f=8,h=a,S=h.readUshort,I=h.readUint,E={tabs:{},frames:[]},U=new Uint8Array(u.length),L,P=0,O=0,C=[137,80,78,71,13,10,26,10];for(var R=0;R<8;R++)if(u[R]!=C[R])throw"The input is not a PNG file!";for(;f<u.length;){let w=h.readUint(u,f);f+=4;let A=h.readASCII(u,f,4);if(f+=4,A=="IHDR")m(u,f,E);else if(A=="iCCP"){for(var y=f;u[y]!=0;)y++;h.readASCII(u,f,y-f),u[y+1];let d=u.slice(y+2,f+w),k=null;try{k=e(d)}catch{k=t(d)}E.tabs[A]=k}else if(A=="CgBI")E.tabs[A]=u.slice(f,f+4);else if(A=="IDAT"){for(R=0;R<w;R++)U[P+R]=u[f+R];P+=w}else if(A=="acTL")E.tabs[A]={num_frames:I(u,f),num_plays:I(u,f+4)},L=new Uint8Array(u.length);else if(A=="fcTL"){O!=0&&((T=E.frames[E.frames.length-1]).data=o(E,L.slice(0,O),T.rect.width,T.rect.height),O=0);let d={x:I(u,f+12),y:I(u,f+16),width:I(u,f+4),height:I(u,f+8)},k=S(u,f+22);k=S(u,f+20)/(k==0?100:k);let M={rect:d,delay:Math.round(1e3*k),dispose:u[f+24],blend:u[f+25]};E.frames.push(M)}else if(A=="fdAT"){for(R=0;R<w-4;R++)L[O+R]=u[f+R+4];O+=w-4}else if(A=="pHYs")E.tabs[A]=[h.readUint(u,f),h.readUint(u,f+4),u[f+8]];else if(A=="cHRM")for(E.tabs[A]=[],R=0;R<8;R++)E.tabs[A].push(h.readUint(u,f+4*R));else if(A=="tEXt"||A=="zTXt"){E.tabs[A]==null&&(E.tabs[A]={});var g=h.nextZero(u,f),x=h.readASCII(u,f,g-f),b=f+w-g-1;if(A=="tEXt")_=h.readASCII(u,g+1,b);else{var v=e(u.slice(g+2,g+2+b));_=h.readUTF8(v,0,v.length)}E.tabs[A][x]=_}else if(A=="iTXt"){E.tabs[A]==null&&(E.tabs[A]={}),g=0,y=f,g=h.nextZero(u,y),x=h.readASCII(u,y,g-y);let d=u[y=g+1];var _;u[y+1],y+=2,g=h.nextZero(u,y),h.readASCII(u,y,g-y),y=g+1,g=h.nextZero(u,y),h.readUTF8(u,y,g-y),b=w-((y=g+1)-f),d==0?_=h.readUTF8(u,y,b):(v=e(u.slice(y,y+b)),_=h.readUTF8(v,0,v.length)),E.tabs[A][x]=_}else if(A=="PLTE")E.tabs[A]=h.readBytes(u,f,w);else if(A=="hIST"){let d=E.tabs.PLTE.length/3;for(E.tabs[A]=[],R=0;R<d;R++)E.tabs[A].push(S(u,f+2*R))}else if(A=="tRNS")E.ctype==3?E.tabs[A]=h.readBytes(u,f,w):E.ctype==0?E.tabs[A]=S(u,f):E.ctype==2&&(E.tabs[A]=[S(u,f),S(u,f+2),S(u,f+4)]);else if(A=="gAMA")E.tabs[A]=h.readUint(u,f)/1e5;else if(A=="sRGB")E.tabs[A]=u[f];else if(A=="bKGD")E.ctype==0||E.ctype==4?E.tabs[A]=[S(u,f)]:E.ctype==2||E.ctype==6?E.tabs[A]=[S(u,f),S(u,f+2),S(u,f+4)]:E.ctype==3&&(E.tabs[A]=u[f]);else if(A=="IEND")break;f+=w,h.readUint(u,f),f+=4}var T;return O!=0&&((T=E.frames[E.frames.length-1]).data=o(E,L.slice(0,O),T.rect.width,T.rect.height)),E.data=o(E,U,E.width,E.height),delete E.compress,delete E.interlace,delete E.filter,E},toRGBA8:function(l){let u=l.width,f=l.height;if(l.tabs.acTL==null)return[r(l.data,u,f,l).buffer];let h=[];l.frames[0].data==null&&(l.frames[0].data=l.data);let S=u*f*4,I=new Uint8Array(S),E=new Uint8Array(S),U=new Uint8Array(S);for(let P=0;P<l.frames.length;P++){let O=l.frames[P],C=O.rect.x,R=O.rect.y,y=O.rect.width,g=O.rect.height,x=r(O.data,y,g,l);if(P!=0)for(var L=0;L<S;L++)U[L]=I[L];if(O.blend==0?p(x,y,g,I,u,f,C,R,0):O.blend==1&&p(x,y,g,I,u,f,C,R,1),h.push(I.buffer.slice(0)),O.dispose!=0){if(O.dispose==1)p(E,y,g,I,u,f,C,R,0);else if(O.dispose==2)for(L=0;L<S;L++)I[L]=U[L]}}return h},_paeth:s,_copyTile:p,_bin:a}}();(function(){let{_copyTile:a}=Ft,{_bin:r}=Ft,o=Ft._paeth;var e={table:function(){let y=new Uint32Array(256);for(let g=0;g<256;g++){let x=g;for(let b=0;b<8;b++)1&x?x=3988292384^x>>>1:x>>>=1;y[g]=x}return y}(),update(y,g,x,b){for(let v=0;v<b;v++)y=e.table[255&(y^g[x+v])]^y>>>8;return y},crc:(y,g,x)=>4294967295^e.update(4294967295,y,g,x)};function t(y,g,x,b){g[x]+=y[0]*b>>4,g[x+1]+=y[1]*b>>4,g[x+2]+=y[2]*b>>4,g[x+3]+=y[3]*b>>4}function n(y){return Math.max(0,Math.min(255,y))}function i(y,g){let x=y[0]-g[0],b=y[1]-g[1],v=y[2]-g[2],_=y[3]-g[3];return x*x+b*b+v*v+_*_}function s(y,g,x,b,v,_,T){T==null&&(T=1);let w=b.length,A=[];for(var d=0;d<w;d++){let D=b[d];A.push([D>>>0&255,D>>>8&255,D>>>16&255,D>>>24&255])}for(d=0;d<w;d++){let D=4294967295;for(var k=0,M=0;M<w;M++){var F=i(A[d],A[M]);M!=d&&F<D&&(D=F,k=M)}}let q=new Uint32Array(v.buffer),H=new Int16Array(g*x*4),B=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<B.length;d++)B[d]=255*((B[d]+.5)/16-.5);for(let D=0;D<x;D++)for(let V=0;V<g;V++){var N;d=4*(D*g+V),T!=2?N=[n(y[d]+H[d]),n(y[d+1]+H[d+1]),n(y[d+2]+H[d+2]),n(y[d+3]+H[d+3])]:(F=B[4*(3&D)+(3&V)],N=[n(y[d]+F),n(y[d+1]+F),n(y[d+2]+F),n(y[d+3]+F)]),k=0;let et=16777215;for(M=0;M<w;M++){let J=i(N,A[M]);J<et&&(et=J,k=M)}let Y=A[k],Q=[N[0]-Y[0],N[1]-Y[1],N[2]-Y[2],N[3]-Y[3]];T==1&&(V!=g-1&&t(Q,H,d+4,7),D!=x-1&&(V!=0&&t(Q,H,d+4*g-4,3),t(Q,H,d+4*g,5),V!=g-1&&t(Q,H,d+4*g+4,1))),_[d>>2]=k,q[d>>2]=b[k]}}function m(y,g,x,b,v){v==null&&(v={});let{crc:_}=e,T=r.writeUint,w=r.writeUshort,A=r.writeASCII,d=8,k=y.frames.length>1,M,F=!1,q=33+(k?20:0);if(v.sRGB!=null&&(q+=13),v.pHYs!=null&&(q+=21),v.iCCP!=null&&(M=pako.deflate(v.iCCP),q+=21+M.length+4),y.ctype==3){for(var H=y.plte.length,B=0;B<H;B++)y.plte[B]>>>24!=255&&(F=!0);q+=8+3*H+4+(F?8+1*H+4:0)}for(var N=0;N<y.frames.length;N++)k&&(q+=38),q+=(Y=y.frames[N]).cimg.length+12,N!=0&&(q+=4);q+=12;let D=new Uint8Array(q),V=[137,80,78,71,13,10,26,10];for(B=0;B<8;B++)D[B]=V[B];if(T(D,d,13),d+=4,A(D,d,"IHDR"),d+=4,T(D,d,g),d+=4,T(D,d,x),d+=4,D[d]=y.depth,d++,D[d]=y.ctype,d++,D[d]=0,d++,D[d]=0,d++,D[d]=0,d++,T(D,d,_(D,d-17,17)),d+=4,v.sRGB!=null&&(T(D,d,1),d+=4,A(D,d,"sRGB"),d+=4,D[d]=v.sRGB,d++,T(D,d,_(D,d-5,5)),d+=4),v.iCCP!=null){let Q=13+M.length;T(D,d,Q),d+=4,A(D,d,"iCCP"),d+=4,A(D,d,"ICC profile"),d+=11,d+=2,D.set(M,d),d+=M.length,T(D,d,_(D,d-(Q+4),Q+4)),d+=4}if(v.pHYs!=null&&(T(D,d,9),d+=4,A(D,d,"pHYs"),d+=4,T(D,d,v.pHYs[0]),d+=4,T(D,d,v.pHYs[1]),d+=4,D[d]=v.pHYs[2],d++,T(D,d,_(D,d-13,13)),d+=4),k&&(T(D,d,8),d+=4,A(D,d,"acTL"),d+=4,T(D,d,y.frames.length),d+=4,T(D,d,v.loop!=null?v.loop:0),d+=4,T(D,d,_(D,d-12,12)),d+=4),y.ctype==3){for(T(D,d,3*(H=y.plte.length)),d+=4,A(D,d,"PLTE"),d+=4,B=0;B<H;B++){let Q=3*B,J=y.plte[B],ot=255&J,ut=J>>>8&255,te=J>>>16&255;D[d+Q+0]=ot,D[d+Q+1]=ut,D[d+Q+2]=te}if(d+=3*H,T(D,d,_(D,d-3*H-4,3*H+4)),d+=4,F){for(T(D,d,H),d+=4,A(D,d,"tRNS"),d+=4,B=0;B<H;B++)D[d+B]=y.plte[B]>>>24&255;d+=H,T(D,d,_(D,d-H-4,H+4)),d+=4}}let et=0;for(N=0;N<y.frames.length;N++){var Y=y.frames[N];k&&(T(D,d,26),d+=4,A(D,d,"fcTL"),d+=4,T(D,d,et++),d+=4,T(D,d,Y.rect.width),d+=4,T(D,d,Y.rect.height),d+=4,T(D,d,Y.rect.x),d+=4,T(D,d,Y.rect.y),d+=4,w(D,d,b[N]),d+=2,w(D,d,1e3),d+=2,D[d]=Y.dispose,d++,D[d]=Y.blend,d++,T(D,d,_(D,d-30,30)),d+=4);let Q=Y.cimg;T(D,d,(H=Q.length)+(N==0?0:4)),d+=4;let J=d;A(D,d,N==0?"IDAT":"fdAT"),d+=4,N!=0&&(T(D,d,et++),d+=4),D.set(Q,d),d+=H,T(D,d,_(D,J,d-J)),d+=4}return T(D,d,0),d+=4,A(D,d,"IEND"),d+=4,T(D,d,_(D,d-4,4)),d+=4,D.buffer}function p(y,g,x){for(let b=0;b<y.frames.length;b++){let v=y.frames[b];v.rect.width;let _=v.rect.height,T=new Uint8Array(_*v.bpl+_);v.cimg=f(v.img,_,v.bpp,v.bpl,T,g,x)}}function c(y,g,x,b,v){let _=v[0],T=v[1],w=v[2],A=v[3],d=v[4],k=v[5],M=6,F=8,q=255;for(var H=0;H<y.length;H++){let dt=new Uint8Array(y[H]);for(var B=dt.length,N=0;N<B;N+=4)q&=dt[N+3]}let D=q!=255,V=function(rt,Z,ft,At,st,xt){let ct=[];for(var tt=0;tt<rt.length;tt++){let Tt=new Uint8Array(rt[tt]),Ot=new Uint32Array(Tt.buffer);var bt;let It=0,zt=0,Bt=Z,re=ft,Qr=At?1:0;if(tt!=0){let ha=xt||At||tt==1||ct[tt-2].dispose!=0?1:2,jr=0,Pn=1e9;for(let rr=0;rr<ha;rr++){var Qt=new Uint8Array(rt[tt-1-rr]);let ga=new Uint32Array(rt[tt-1-rr]),jt=Z,Kt=ft,Ge=-1,nr=-1;for(let ne=0;ne<ft;ne++)for(let oe=0;oe<Z;oe++)Ot[ht=ne*Z+oe]!=ga[ht]&&(oe<jt&&(jt=oe),oe>Ge&&(Ge=oe),ne<Kt&&(Kt=ne),ne>nr&&(nr=ne));Ge==-1&&(jt=Kt=Ge=nr=0),st&&((1&jt)==1&&jt--,(1&Kt)==1&&Kt--);let Mn=(Ge-jt+1)*(nr-Kt+1);Mn<Pn&&(Pn=Mn,jr=rr,It=jt,zt=Kt,Bt=Ge-jt+1,re=nr-Kt+1)}Qt=new Uint8Array(rt[tt-1-jr]),jr==1&&(ct[tt-1].dispose=2),bt=new Uint8Array(Bt*re*4),a(Qt,Z,ft,bt,Bt,re,-It,-zt,0),Qr=a(Tt,Z,ft,bt,Bt,re,-It,-zt,3)?1:0,Qr==1?u(Tt,Z,ft,bt,{x:It,y:zt,width:Bt,height:re}):a(Tt,Z,ft,bt,Bt,re,-It,-zt,0)}else bt=Tt.slice(0);ct.push({rect:{x:It,y:zt,width:Bt,height:re},img:bt,blend:Qr,dispose:0})}if(At)for(tt=0;tt<ct.length;tt++){if((ee=ct[tt]).blend==1)continue;let Tt=ee.rect,Ot=ct[tt-1].rect,It=Math.min(Tt.x,Ot.x),zt=Math.min(Tt.y,Ot.y),Bt={x:It,y:zt,width:Math.max(Tt.x+Tt.width,Ot.x+Ot.width)-It,height:Math.max(Tt.y+Tt.height,Ot.y+Ot.height)-zt};ct[tt-1].dispose=1,tt-1!=0&&l(rt,Z,ft,ct,tt-1,Bt,st),l(rt,Z,ft,ct,tt,Bt,st)}let dr=0;if(rt.length!=1)for(var ht=0;ht<ct.length;ht++){var ee;dr+=(ee=ct[ht]).rect.width*ee.rect.height}return ct}(y,g,x,_,T,w),et={},Y=[],Q=[];if(b!=0){let dt=[];for(N=0;N<V.length;N++)dt.push(V[N].img.buffer);let rt=function(st){let xt=0;for(var ct=0;ct<st.length;ct++)xt+=st[ct].byteLength;let tt=new Uint8Array(xt),bt=0;for(ct=0;ct<st.length;ct++){let Qt=new Uint8Array(st[ct]),dr=Qt.length;for(let ht=0;ht<dr;ht+=4){let ee=Qt[ht],Tt=Qt[ht+1],Ot=Qt[ht+2],It=Qt[ht+3];It==0&&(ee=Tt=Ot=0),tt[bt+ht]=ee,tt[bt+ht+1]=Tt,tt[bt+ht+2]=Ot,tt[bt+ht+3]=It}bt+=dr}return tt.buffer}(dt),Z=S(rt,b);for(N=0;N<Z.plte.length;N++)Y.push(Z.plte[N].est.rgba);let ft=0;for(N=0;N<V.length;N++){let At=(ot=V[N]).img.length;var J=new Uint8Array(Z.inds.buffer,ft>>2,At>>2);Q.push(J);let st=new Uint8Array(Z.abuf,ft,At);k&&s(ot.img,ot.rect.width,ot.rect.height,Y,st,J),ot.img.set(st),ft+=At}}else for(H=0;H<V.length;H++){var ot=V[H];let dt=new Uint32Array(ot.img.buffer);var ut=ot.rect.width;for(B=dt.length,J=new Uint8Array(B),Q.push(J),N=0;N<B;N++){let rt=dt[N];if(N!=0&&rt==dt[N-1])J[N]=J[N-1];else if(N>ut&&rt==dt[N-ut])J[N]=J[N-ut];else{let Z=et[rt];if(Z==null&&(et[rt]=Z=Y.length,Y.push(rt),Y.length>=300))break;J[N]=Z}}}let te=Y.length;for(te<=256&&d==0&&(F=te<=2?1:te<=4?2:te<=16?4:8,F=Math.max(F,A)),H=0;H<V.length;H++){(ot=V[H]).rect.x,ot.rect.y,ut=ot.rect.width;let dt=ot.rect.height,rt=ot.img;new Uint32Array(rt.buffer);let Z=4*ut,ft=4;if(te<=256&&d==0){Z=Math.ceil(F*ut/8);var Gt=new Uint8Array(Z*dt);let At=Q[H];for(let st=0;st<dt;st++){N=st*Z;let xt=st*ut;if(F==8)for(var nt=0;nt<ut;nt++)Gt[N+nt]=At[xt+nt];else if(F==4)for(nt=0;nt<ut;nt++)Gt[N+(nt>>1)]|=At[xt+nt]<<4-4*(1&nt);else if(F==2)for(nt=0;nt<ut;nt++)Gt[N+(nt>>2)]|=At[xt+nt]<<6-2*(3&nt);else if(F==1)for(nt=0;nt<ut;nt++)Gt[N+(nt>>3)]|=At[xt+nt]<<7-1*(7&nt)}rt=Gt,M=3,ft=1}else if(D==0&&V.length==1){Gt=new Uint8Array(ut*dt*3);let At=ut*dt;for(N=0;N<At;N++){let st=3*N,xt=4*N;Gt[st]=rt[xt],Gt[st+1]=rt[xt+1],Gt[st+2]=rt[xt+2]}rt=Gt,M=2,ft=3,Z=3*ut}ot.img=rt,ot.bpl=Z,ot.bpp=ft}return{ctype:M,depth:F,plte:Y,frames:V}}function l(y,g,x,b,v,_,T){let w=Uint8Array,A=Uint32Array,d=new w(y[v-1]),k=new A(y[v-1]),M=v+1<y.length?new w(y[v+1]):null,F=new w(y[v]),q=new A(F.buffer),H=g,B=x,N=-1,D=-1;for(let et=0;et<_.height;et++)for(let Y=0;Y<_.width;Y++){let Q=_.x+Y,J=_.y+et,ot=J*g+Q,ut=q[ot];ut==0||b[v-1].dispose==0&&k[ot]==ut&&(M==null||M[4*ot+3]!=0)||(Q<H&&(H=Q),Q>N&&(N=Q),J<B&&(B=J),J>D&&(D=J))}N==-1&&(H=B=N=D=0),T&&((1&H)==1&&H--,(1&B)==1&&B--),_={x:H,y:B,width:N-H+1,height:D-B+1};let V=b[v];V.rect=_,V.blend=1,V.img=new Uint8Array(_.width*_.height*4),b[v-1].dispose==0?(a(d,g,x,V.img,_.width,_.height,-_.x,-_.y,0),u(F,g,x,V.img,_)):a(F,g,x,V.img,_.width,_.height,-_.x,-_.y,0)}function u(y,g,x,b,v){a(y,g,x,b,v.width,v.height,-v.x,-v.y,2)}function f(y,g,x,b,v,_,T){let w=[],A,d=[0,1,2,3,4];_!=-1?d=[_]:(g*b>5e5||x==1)&&(d=[0]),T&&(A={level:0});let k=gs;for(var M=0;M<d.length;M++){for(let H=0;H<g;H++)h(v,y,H,b,x,d[M]);w.push(k.deflate(v,A))}let F,q=1e9;for(M=0;M<w.length;M++)w[M].length<q&&(F=M,q=w[M].length);return w[F]}function h(y,g,x,b,v,_){let T=x*b,w=T+x;if(y[w]=_,w++,_==0)if(b<500)for(var A=0;A<b;A++)y[w+A]=g[T+A];else y.set(new Uint8Array(g.buffer,T,b),w);else if(_==1){for(A=0;A<v;A++)y[w+A]=g[T+A];for(A=v;A<b;A++)y[w+A]=g[T+A]-g[T+A-v]+256&255}else if(x==0){for(A=0;A<v;A++)y[w+A]=g[T+A];if(_==2)for(A=v;A<b;A++)y[w+A]=g[T+A];if(_==3)for(A=v;A<b;A++)y[w+A]=g[T+A]-(g[T+A-v]>>1)+256&255;if(_==4)for(A=v;A<b;A++)y[w+A]=g[T+A]-o(g[T+A-v],0,0)+256&255}else{if(_==2)for(A=0;A<b;A++)y[w+A]=g[T+A]+256-g[T+A-b]&255;if(_==3){for(A=0;A<v;A++)y[w+A]=g[T+A]+256-(g[T+A-b]>>1)&255;for(A=v;A<b;A++)y[w+A]=g[T+A]+256-(g[T+A-b]+g[T+A-v]>>1)&255}if(_==4){for(A=0;A<v;A++)y[w+A]=g[T+A]+256-o(0,g[T+A-b],0)&255;for(A=v;A<b;A++)y[w+A]=g[T+A]+256-o(g[T+A-v],g[T+A-b],g[T+A-v-b])&255}}}function S(y,g){let x=new Uint8Array(y),b=x.slice(0),v=new Uint32Array(b.buffer),_=I(b,g),T=_[0],w=_[1],A=x.length,d=new Uint8Array(A>>2),k;if(x.length<2e7)for(var M=0;M<A;M+=4)k=E(T,F=x[M]*(1/255),q=x[M+1]*(1/255),H=x[M+2]*(1/255),B=x[M+3]*(1/255)),d[M>>2]=k.ind,v[M>>2]=k.est.rgba;else for(M=0;M<A;M+=4){var F=x[M]*.00392156862745098,q=x[M+1]*(1/255),H=x[M+2]*(1/255),B=x[M+3]*(1/255);for(k=T;k.left;)k=U(k.est,F,q,H,B)<=0?k.left:k.right;d[M>>2]=k.ind,v[M>>2]=k.est.rgba}return{abuf:b.buffer,inds:d,plte:w}}function I(y,g,x){x==null&&(x=1e-4);let b=new Uint32Array(y.buffer),v={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};v.bst=O(y,v.i0,v.i1),v.est=C(v.bst);let _=[v];for(;_.length<g;){let w=0,A=0;for(var T=0;T<_.length;T++)_[T].est.L>w&&(w=_[T].est.L,A=T);if(w<x)break;let d=_[A],k=L(y,b,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=k||d.i1<=k){d.est.L=0;continue}let M={i0:d.i0,i1:k,bst:null,est:null,tdst:0,left:null,right:null};M.bst=O(y,M.i0,M.i1),M.est=C(M.bst);let F={i0:k,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:d.bst.N-M.bst.N},T=0;T<16;T++)F.bst.R[T]=d.bst.R[T]-M.bst.R[T];for(T=0;T<4;T++)F.bst.m[T]=d.bst.m[T]-M.bst.m[T];F.est=C(F.bst),d.left=M,d.right=F,_[A]=M,_.push(F)}for(_.sort((w,A)=>A.bst.N-w.bst.N),T=0;T<_.length;T++)_[T].ind=T;return[v,_]}function E(y,g,x,b,v){if(y.left==null)return y.tdst=function(M,F,q,H,B){let N=F-M[0],D=q-M[1],V=H-M[2],et=B-M[3];return N*N+D*D+V*V+et*et}(y.est.q,g,x,b,v),y;let _=U(y.est,g,x,b,v),T=y.left,w=y.right;_>0&&(T=y.right,w=y.left);let A=E(T,g,x,b,v);if(A.tdst<=_*_)return A;let d=E(w,g,x,b,v);return d.tdst<A.tdst?d:A}function U(y,g,x,b,v){let{e:_}=y;return _[0]*g+_[1]*x+_[2]*b+_[3]*v-y.eMq}function L(y,g,x,b,v,_){for(b-=4;x<b;){for(;P(y,x,v)<=_;)x+=4;for(;P(y,b,v)>_;)b-=4;if(x>=b)break;let T=g[x>>2];g[x>>2]=g[b>>2],g[b>>2]=T,x+=4,b-=4}for(;P(y,x,v)>_;)x-=4;return x+4}function P(y,g,x){return y[g]*x[0]+y[g+1]*x[1]+y[g+2]*x[2]+y[g+3]*x[3]}function O(y,g,x){let b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=[0,0,0,0],_=x-g>>2;for(let T=g;T<x;T+=4){let w=y[T]*.00392156862745098,A=y[T+1]*(1/255),d=y[T+2]*(1/255),k=y[T+3]*(1/255);v[0]+=w,v[1]+=A,v[2]+=d,v[3]+=k,b[0]+=w*w,b[1]+=w*A,b[2]+=w*d,b[3]+=w*k,b[5]+=A*A,b[6]+=A*d,b[7]+=A*k,b[10]+=d*d,b[11]+=d*k,b[15]+=k*k}return b[4]=b[1],b[8]=b[2],b[9]=b[6],b[12]=b[3],b[13]=b[7],b[14]=b[11],{R:b,m:v,N:_}}function C(y){let{R:g}=y,{m:x}=y,{N:b}=y,v=x[0],_=x[1],T=x[2],w=x[3],A=b==0?0:1/b,d=[g[0]-v*v*A,g[1]-v*_*A,g[2]-v*T*A,g[3]-v*w*A,g[4]-_*v*A,g[5]-_*_*A,g[6]-_*T*A,g[7]-_*w*A,g[8]-T*v*A,g[9]-T*_*A,g[10]-T*T*A,g[11]-T*w*A,g[12]-w*v*A,g[13]-w*_*A,g[14]-w*T*A,g[15]-w*w*A],k=d,M=R,F=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,H=0;if(b!=0)for(let N=0;N<16&&(F=M.multVec(k,F),H=Math.sqrt(M.dot(F,F)),F=M.sml(1/H,F),!(N!=0&&Math.abs(H-q)<1e-9));N++)q=H;let B=[v*A,_*A,T*A,w*A];return{Cov:d,q:B,e:F,L:q,eMq255:M.dot(M.sml(255,B),F),eMq:M.dot(F,B),rgba:(Math.round(255*B[3])<<24|Math.round(255*B[2])<<16|Math.round(255*B[1])<<8|Math.round(255*B[0])<<0)>>>0}}var R={multVec:(y,g)=>[y[0]*g[0]+y[1]*g[1]+y[2]*g[2]+y[3]*g[3],y[4]*g[0]+y[5]*g[1]+y[6]*g[2]+y[7]*g[3],y[8]*g[0]+y[9]*g[1]+y[10]*g[2]+y[11]*g[3],y[12]*g[0]+y[13]*g[1]+y[14]*g[2]+y[15]*g[3]],dot:(y,g)=>y[0]*g[0]+y[1]*g[1]+y[2]*g[2]+y[3]*g[3],sml:(y,g)=>[y*g[0],y*g[1],y*g[2],y*g[3]]};Ft.encode=function(g,x,b,v,_,T,w){v==null&&(v=0),w==null&&(w=!1);let A=c(g,x,b,v,[!1,!1,!1,0,w,!1]);return p(A,-1),m(A,x,b,_,T)},Ft.encodeLL=function(g,x,b,v,_,T,w,A){let d={ctype:0+(v==1?0:2)+(_==0?0:4),depth:T,frames:[]},k=(v+_)*T,M=k*x;for(let F=0;F<g.length;F++)d.frames.push({rect:{x:0,y:0,width:x,height:b},img:new Uint8Array(g[F]),blend:0,dispose:1,bpp:Math.ceil(k/8),bpl:Math.ceil(M/8)});return p(d,0,!0),m(d,x,b,w,A)},Ft.encode.compress=c,Ft.encode.dither=s,Ft.quantize=S,Ft.quantize.getKDtree=I,Ft.quantize.getNearest=E})();var zi={toArrayBuffer(a,r){let o=a.width,e=a.height,t=o<<2,n=a.getContext("2d").getImageData(0,0,o,e),i=new Uint32Array(n.data.buffer),s=(32*o+31)/32<<2,m=s*e,p=122+m,c=new ArrayBuffer(p),l=new DataView(c),u=1<<20,f,h,S,I,E=u,U=0,L=0,P=0;function O(y){l.setUint16(L,y,!0),L+=2}function C(y){l.setUint32(L,y,!0),L+=4}function R(y){L+=y}O(19778),C(p),R(4),C(122),C(108),C(o),C(-e>>>0),O(1),O(32),C(3),C(m),C(2835),C(2835),R(8),C(16711680),C(65280),C(255),C(4278190080),C(1466527264),function y(){for(;U<e&&E>0;){for(I=122+U*s,f=0;f<t;)E--,h=i[P++],S=h>>>24,l.setUint32(I+f,h<<8|S),f+=4;U++}P<i.length?(E=u,setTimeout(y,zi._dly)):r(c)}()},toBlob(a,r){this.toArrayBuffer(a,o=>{r(new Blob([o],{type:"image/bmp"}))})},_dly:9},St={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},ys={[St.CHROME]:16384,[St.FIREFOX]:11180,[St.DESKTOP_SAFARI]:16384,[St.IE]:8192,[St.IOS]:4096,[St.ETC]:8192},Sn=typeof window<"u",$i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Br=Sn&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),As=(Sn||$i)&&(Br&&Br.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Qi=(Sn||$i)&&(Br&&Br.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function xn(a,r,o=Date.now()){return new Promise(e=>{let t=a.split(","),n=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]),s=i.length,m=new Uint8Array(s);for(;s--;)m[s]=i.charCodeAt(s);let p=new Blob([m],{type:n});p.name=r,p.lastModified=o,e(p)})}function ji(a){return new Promise((r,o)=>{let e=new Qi;e.onload=()=>r(e.result),e.onerror=t=>o(t),e.readAsDataURL(a)})}function Ki(a){return new Promise((r,o)=>{let e=new Image;e.onload=()=>r(e),e.onerror=t=>o(t),e.src=a})}function Ie(){if(Ie.cachedResult!==void 0)return Ie.cachedResult;let a=St.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?a=St.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?a=St.IOS:/Safari/i.test(r)?a=St.DESKTOP_SAFARI:/Firefox/i.test(r)?a=St.FIREFOX:(/MSIE/i.test(r)||document.documentMode)&&(a=St.IE),Ie.cachedResult=a,Ie.cachedResult}function Xi(a,r){let o=Ie(),e=ys[o],t=a,n=r,i=t*n,s=t>n?n/t:t/n;for(;i>e*e;){let m=(e+t)/2,p=(e+n)/2;m<p?(n=p,t=p*s):(n=m*s,t=m),i=t*n}return{width:t,height:n}}function Vr(a,r){let o,e;try{if(o=new OffscreenCanvas(a,r),e=o.getContext("2d"),e===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{o=document.createElement("canvas"),e=o.getContext("2d")}return o.width=a,o.height=r,[o,e]}function Yi(a,r){let{width:o,height:e}=Xi(a.width,a.height),[t,n]=Vr(o,e);return r&&/jpe?g/.test(r)&&(n.fillStyle="white",n.fillRect(0,0,t.width,t.height)),n.drawImage(a,0,0,t.width,t.height),t}function Hr(){return Hr.cachedResult!==void 0||(Hr.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Hr.cachedResult}function qr(a,r={}){return new Promise(function(o,e){let t,n;var i=function(){try{return n=Yi(t,r.fileType||a.type),o([t,n])}catch(m){return e(m)}},s=function(m){try{var p=function(c){try{throw c}catch(l){return e(l)}};try{let c;return ji(a).then(function(l){try{return c=l,Ki(c).then(function(u){try{return t=u,function(){try{return i()}catch(f){return e(f)}}()}catch(f){return p(f)}},p)}catch(u){return p(u)}},p)}catch(c){p(c)}}catch(c){return e(c)}};try{if(Hr()||[St.DESKTOP_SAFARI,St.MOBILE_SAFARI].includes(Ie()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(a).then(function(m){try{return t=m,i()}catch{return s()}},s)}catch{s()}})}function Wr(a,r,o,e,t=1){return new Promise(function(n,i){let s;if(r==="image/png"){let p,c,l;return p=a.getContext("2d"),{data:c}=p.getImageData(0,0,a.width,a.height),l=Ft.encode([c.buffer],a.width,a.height,4096*t),s=new Blob([l],{type:r}),s.name=o,s.lastModified=e,m.call(this)}{let p=function(){return m.call(this)};if(r==="image/bmp")return new Promise(c=>zi.toBlob(a,c)).then(function(c){try{return s=c,s.name=o,s.lastModified=e,p.call(this)}catch(l){return i(l)}}.bind(this),i);{let c=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&a instanceof OffscreenCanvas)return a.convertToBlob({type:r,quality:t}).then(function(l){try{return s=l,s.name=o,s.lastModified=e,c.call(this)}catch(u){return i(u)}}.bind(this),i);{let l;return l=a.toDataURL(r,t),xn(l,o,e).then(function(u){try{return s=u,c.call(this)}catch(f){return i(f)}}.bind(this),i)}}}function m(){return n(s)}})}function Vt(a){a.width=0,a.height=0}function Ye(){return new Promise(function(a,r){let o,e,t,n,i;return Ye.cachedResult!==void 0?a(Ye.cachedResult):(o="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",xn("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(s){try{return e=s,qr(e).then(function(m){try{return t=m[1],Wr(t,e.type,e.name,e.lastModified).then(function(p){try{return n=p,Vt(t),qr(n).then(function(c){try{return i=c[0],Ye.cachedResult=i.width===1&&i.height===2,a(Ye.cachedResult)}catch(l){return r(l)}},r)}catch(c){return r(c)}},r)}catch(p){return r(p)}},r)}catch(m){return r(m)}},r))})}function Ji(a){return new Promise((r,o)=>{let e=new Qi;e.onload=t=>{let n=new DataView(t.target.result);if(n.getUint16(0,!1)!=65496)return r(-2);let i=n.byteLength,s=2;for(;s<i;){if(n.getUint16(s+2,!1)<=8)return r(-1);let m=n.getUint16(s,!1);if(s+=2,m==65505){if(n.getUint32(s+=2,!1)!=1165519206)return r(-1);let p=n.getUint16(s+=6,!1)==18761;s+=n.getUint32(s+4,p);let c=n.getUint16(s,p);s+=2;for(let l=0;l<c;l++)if(n.getUint16(s+12*l,p)==274)return r(n.getUint16(s+12*l+8,p))}else{if((65280&m)!=65280)break;s+=n.getUint16(s,!1)}}return r(-1)},e.onerror=t=>o(t),e.readAsArrayBuffer(a)})}function Zi(a,r){let{width:o}=a,{height:e}=a,{maxWidthOrHeight:t}=r,n,i=a;return isFinite(t)&&(o>t||e>t)&&([i,n]=Vr(o,e),o>e?(i.width=t,i.height=e/o*t):(i.width=o/e*t,i.height=t),n.drawImage(a,0,0,i.width,i.height),Vt(a)),i}function ta(a,r){let{width:o}=a,{height:e}=a,[t,n]=Vr(o,e);switch(r>4&&r<9?(t.width=e,t.height=o):(t.width=o,t.height=e),r){case 2:n.transform(-1,0,0,1,o,0);break;case 3:n.transform(-1,0,0,-1,o,e);break;case 4:n.transform(1,0,0,-1,0,e);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,e,0);break;case 7:n.transform(0,-1,-1,0,e,o);break;case 8:n.transform(0,-1,1,0,0,o)}return n.drawImage(a,0,0,o,e),Vt(a),t}function Wi(a,r,o=0){return new Promise(function(e,t){let n,i,s,m,p,c,l,u,f,h,S,I,E,U,L,P,O,C,R,y;function g(b=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;n+=b,r.onProgress(Math.min(n,100))}function x(b){if(r.signal&&r.signal.aborted)throw r.signal.reason;n=Math.min(Math.max(b,n),100),r.onProgress(n)}return n=o,i=r.maxIteration||10,s=1024*r.maxSizeMB*1024,g(),qr(a,r).then(function(b){try{return[,m]=b,g(),p=Zi(m,r),g(),new Promise(function(v,_){var T;if(!(T=r.exifOrientation))return Ji(a).then(function(A){try{return T=A,w.call(this)}catch(d){return _(d)}}.bind(this),_);function w(){return v(T)}return w.call(this)}).then(function(v){try{return c=v,g(),Ye().then(function(_){try{return l=_?p:ta(p,c),g(),u=r.initialQuality||1,f=r.fileType||a.type,Wr(l,f,a.name,a.lastModified,u).then(function(T){try{{let A=function(){if(i--&&(L>s||L>E)){let k,M;return k=y?.95*R.width:R.width,M=y?.95*R.height:R.height,[O,C]=Vr(k,M),C.drawImage(R,0,0,k,M),u*=f==="image/png"?.85:.95,Wr(O,f,a.name,a.lastModified,u).then(function(F){try{return P=F,Vt(R),R=O,L=P.size,x(Math.min(99,Math.floor((U-L)/(U-s)*100))),A}catch(q){return t(q)}},t)}return[1]},d=function(){return Vt(R),Vt(O),Vt(p),Vt(l),Vt(m),x(100),e(P)};if(h=T,g(),S=h.size>s,I=h.size>a.size,!S&&!I)return x(100),e(h);var w;return E=a.size,U=h.size,L=U,R=l,y=!r.alwaysKeepResolution&&S,(w=function(k){for(;k;){if(k.then)return void k.then(w,t);try{if(k.pop){if(k.length)return k.pop()?d.call(this):k;k=A}else k=k.call(this)}catch(M){return t(M)}}}.bind(this))(A)}}catch(A){return t(A)}}.bind(this),t)}catch(T){return t(T)}}.bind(this),t)}catch(_){return t(_)}}.bind(this),t)}catch(v){return t(v)}}.bind(this),t)})}var Ts=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`,En;function Cs(a,r){return new Promise((o,e)=>{En||(En=function(i){let s=[];return typeof i=="function"?s.push(`(${i})()`):s.push(i),URL.createObjectURL(new Blob(s))}(Ts));let t=new Worker(En);t.addEventListener("message",function(i){if(r.signal&&r.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return e(new Error(i.data.error)),void t.terminate();o(i.data.file),t.terminate()}else r.onProgress(i.data.progress)}),t.addEventListener("error",e),r.signal&&r.signal.addEventListener("abort",()=>{e(r.signal.reason),t.terminate()}),t.postMessage({file:a,imageCompressionLibUrl:r.libURL,options:{...r,onProgress:void 0,signal:void 0}})})}function pt(a,r){return new Promise(function(o,e){let t,n,i,s,m,p;if(t={...r},i=0,{onProgress:s}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,m=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=f=>{i=f,typeof s=="function"&&s(i)},!(a instanceof Blob||a instanceof As))return e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(a.type))return e(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!m||typeof Worker!="function"||p)return Wi(a,t).then(function(f){try{return n=f,u.call(this)}catch(h){return e(h)}}.bind(this),e);var c=function(){try{return u.call(this)}catch(f){return e(f)}}.bind(this),l=function(f){try{return Wi(a,t).then(function(h){try{return n=h,c()}catch(S){return e(S)}},e)}catch(h){return e(h)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Cs(a,t).then(function(f){try{return n=f,c()}catch{return l()}},l)}catch{l()}function u(){try{n.name=a.name,n.lastModified=a.lastModified}catch{}try{t.preserveExif&&a.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===a.type)&&(n=Vi(a,n))}catch{}return o(n)}})}pt.getDataUrlFromFile=ji,pt.getFilefromDataUrl=xn,pt.loadImage=Ki,pt.drawImageInCanvas=Yi,pt.drawFileInCanvas=qr,pt.canvasToFile=Wr,pt.getExifOrientation=Ji,pt.handleMaxWidthOrHeight=Zi,pt.followExifOrientation=ta,pt.cleanupCanvasMemory=Vt,pt.isAutoOrientationInBrowser=Ye,pt.approximateBelowMaximumCanvasSizeOfBrowser=Xi,pt.copyExifWithoutOrientation=Vi,pt.getBrowserName=Ie,pt.version="2.0.2";var ea=async(a=window.location.href,r=!0)=>{let o=await cr("tabs","query",[{url:a}]);o?.length===0&&(o=await cr("tabs","query",[{active:!0}]));let e=o?.[0]?.windowId,t=o?.[0]?.id;if(e&&t){await cr("tabs","update",[t,{active:!0}]);let n=await cr("tabs","captureVisibleTab",[e,{format:"png",quality:80}]);if(await new Promise(i=>setTimeout(i,1e3)),r&&n){let i=new Date().getTime(),s=Bo(n,"screenshot.png");if(s){i=new Date().getTime();let m=await pt(s,{useWebWorker:!0,maxWidthOrHeight:1920});return vr(m)||n}}return n}return null};var _e=class extends G{static{this.type="CREATE_WEBSITE_CONTEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.CreateWebsiteContextConfig||{},t={};e&&Object.keys(e).forEach(i=>{let s=e[i];typeof e[i]=="string"?Be(t,i,o.getShortCutsEngine()?.parseTemplate(s)||e[i]):typeof e[i]=="object"&&Object.keys(e[i]).forEach(m=>{let p=e[i][m];Be(t,`${i}.${m}`,o.getShortCutsEngine()?.parseTemplate(p)||e[i][m])})}),t.sidebarType=this.getCurrentSidebarType(o);let n=await Bi(t);n?.id&&!n.meta?.screenshot&&ea().then(i=>{i&&qi({id:n.id},{meta:{screenshot:i}})}),this.output=t.id}catch(e){this.error=e.toString()}}};W([j()],_e.prototype,"execute",1);var we=class extends G{static{this.type="TEXT_HANDLER"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||this.parameters.template||"";e?(this.output=Ve(e,this.parameters.ActionTextHandleParameters),this.error=""):(this.output="",this.error="error: no text for handle")}catch(e){this.error=e.toString()}}};W([j()],we.prototype,"execute",1);var bn=mt(Yr());var Pe=class extends G{static{this.type="DATE_FORMAT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=typeof this.parameters.DateFormatStyle=="string"?this.parameters.DateFormatStyle:"YYYY-MM-DD",t=r.LAST_ACTION_OUTPUT||(0,bn.default)().format();this.output=(0,bn.default)(t).format(e)}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],Pe.prototype,"execute",1);var vn=mt(Yr());var Me=class extends G{static{this.type="DATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{(this.parameters.DateActionMode||"Current Date")==="Specified Date"?this.output=(0,vn.default)(this.parameters.DateActionDate).format():this.output=(0,vn.default)().format()}catch(e){this.error=e.toString()}}};W([z({onlyError:!0})],Me.prototype,"execute",1);var fr=400*1e3,Es=async(a,r)=>new Promise(o=>{fetch(`${or}/gpt/check_doc_exists`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({doc_id:r})}).then(e=>e.json()).then(e=>{if(Hn){o(e?.data?.exists||!1);return}o(!1)}).catch(e=>{o(!1)})}),In=async(a,r)=>{let o=await Tr();return new Promise(async e=>{let t=rn(a);if(await Es(o,t)){e(t);return}let n=new File([a],r||"file.txt",{type:"text/plain"}),i=new FormData;i.append("file",n,n.name.replace(/\.pdf$/,".txt")),i.append("doc_id",rn(a)),fetch(`${or}/gpt/analyze_file`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i}).then(s=>s.json()).then(s=>{let m=s?.data?.doc_id||"";m||ur("[API] [/gpt/analyze_file] error",JSON.stringify({error:"response docId is empty"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e(m)}).catch(s=>{ur("[API] [/gpt/analyze_file] error",JSON.stringify({error:s?.message||s?.toString()||"unknown error"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e("")})})};var Re=class extends G{static{this.type="GET_PDF_CONTENTS_OF_CRX"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{if(typeof window<"u"&&window.pdfjsLib&&window?.PDFViewerApplication?.url){let e=window.pdfjsLib,t=0,i=await(async()=>{try{let s=await e.getDocument(window?.PDFViewerApplication?.url).promise,m=s.numPages,p=async f=>{try{return(await(await s.getPage(f)).getTextContent()).items.map(I=>I.str).join("")}catch{return""}},c="",l="",u=0;for(let f=0;f<m;f++){let h="",S=!1;f%2===0?(S=!0,h=await p(m-f)):h=await p(f);let I=(await qe(h)).length;if(I+t>fr)break;u+=1,t+=I,S?l=h+l:c=c+h}return c+l}catch{return""}})();this.output=i}}catch(e){this.error=e.toString()}}};W([j(),z({onlyError:!0}),lt()],Re.prototype,"execute",1);var Ss=()=>{let a=$t();return a==="mail.google.com"?"[Gmail] ":a==="outlook.office.com"||a==="outlook.live.com"||a==="outlook.office365.com"?"[Outlook] ":a==="twitter.com"?"[Twitter] ":a==="linkedin.com"?"[LinkedIn] ":a==="facebook.com"?"[Facebook] ":a==="instagram.com"?"[Instagram] ":a==="reddit.com"?"[Reddit] ":""},ra=Ss;var Le=class extends G{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ASK_CHAT_GPT",n=this.parameters.AskChatGPTProvider,i=this.parameters.AskChatGPTWithHistory||!1,s=this.parameters.AskChatGPTInsertMessageId||"",m=this.getCurrentConversationId(e);t==="ASK_CHAT_GPT_WITH_PREFIX"&&this.parameters.AskChatGPTActionMeta?.contextMenu&&(this.parameters.AskChatGPTActionMeta.contextMenu.text=ra()+this.parameters.AskChatGPTActionMeta.contextMenu.text),this.question=this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT;let{success:p,answer:c,message:l,error:u}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.question,parentMessageId:""},{includeHistory:i,regenerate:!1,meta:{...this.parameters.AskChatGPTActionMeta},aiMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_ANSWER",userMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_QUESTION"},{onProcess:async f=>{if(s&&m){if(f.messageId=s,f.type==="ai"){let h=f;h.originalMessage&&(h.originalMessage.content?h.text=f.text:h.originalMessage.content={text:f.text,contentType:"text"})}await wt("update",m,0,f.type==="ai"?[ar([f,{originalMessage:{content:{contentType:f.originalMessage?.content?.contentType||"text",text:f.text}}}])]:[f])}},onEnd:async(f,h)=>{s&&m&&h&&(h.messageId=s,await wt("update",m,0,[h.type==="ai"?ar([h,{originalMessage:{metadata:{isComplete:!0}}}]):[h]]))}})||{success:!1,answer:"",error:""};p?(this.output=c,this.message=l):(this.output="",this.error=this.error=en(u||c||"ask chatgpt error"))}catch(t){this.error=en(t.toString())}}reset(){super.reset(),this.question="",this.message=void 0}};W([Zt(),j(),_r(!1)],Le.prototype,"execute",1);var K=mt(Dt());var _n=mt(Dt());var na=(a,r)=>{let o,e;return function(){let t=arguments,n=this;return o||(o=!0,setTimeout(()=>o=!1,r),e=a.apply(n,t)),e}};var Oe=mt(Dt());var xs=a=>{let[r,o]=(0,Oe.useState)(""),{currentAIProviderModelDetail:e}=xr(),t=(0,Oe.useMemo)(()=>{let i=e?.maxTokens||4e3;return Math.floor(i/1e3)*1e3},[e]),n=(0,Oe.useMemo)(()=>r.length>t,[r,t]);return(0,Oe.useEffect)(()=>{let i=s=>{s.startsWith("``NO_HISTORY_&#``\n")&&(s=s.replace("``NO_HISTORY_&#``\n","")),o(s)};return gt(a).subscribe(i),()=>{gt(a).unsubscribe(i)}},[]),{currentMaxInputLength:t,isError:n}},oa=xs;var bs=()=>Math.max(Math.floor(window.innerHeight*.5/24)||5),Ze=24,Je=(a,r=0,o=0)=>{let e=a?.parentElement?.parentElement;if(a&&e){let t=window.getComputedStyle(a),n=parseInt(t.paddingTop,10)+parseInt(t.paddingBottom,10);a.style.cssText="height:0px";let i=a.value?a.scrollHeight:Ze+n,s=Math.min(Ze*bs(),i);o===0&&(o=a?.previousElementSibling?.offsetHeight||0);let m=Math.max(Ze,o||0);s=Math.max(m,s),a.style.cssText=`height: ${s}px`;let p=s+r;e.style.cssText=`height: ${p}px`}},vs=(a,r=0,o=0)=>{Je(a,r,o),setTimeout(()=>{Je(a,r,o);let e=a.value;a.focus(),a.setSelectionRange(e.length,e.length)},100)},De=(a,r=0,o=0)=>{let e="",t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&(e="mui",t.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(e="linkedin",n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}a.isSameNode(eo())||a.isSameNode(ro())||vs(a,r,o)},Is=a=>{},_s=a=>{let r=Ct(hr),o=Ct(Lo),e=Ct(qt),{defaultValue:t,onChange:n,onEnter:i,onKeydown:s,loading:m,children:p,error:c=!1,InputId:l=Ut,stopPropagation:u=!0,placeholder:f="Ask AI...",expandNode:h,sx:S}=a,{isError:I}=oa(ie===l?"floatingMenuInputMediator":"chatBoxInputMediator"),E=(0,K.useRef)(null),U=(0,K.useRef)(!1),L=(0,K.useRef)(!1),[P,O]=(0,K.useState)(t||""),C=(0,K.useRef)(0),R=(0,K.useRef)(0),y=(0,K.useRef)(null),g=(0,K.useRef)(null),x=(0,K.useMemo)(()=>na(Je,200),[]),b=T=>[C.current,R.current],v=(0,K.useCallback)(T=>{let w=T.target.value;l===Ut?gt("chatBoxInputMediator").updateInputValue(w):l===ie?gt("floatingMenuInputMediator").updateInputValue(w):O(w),n&&n(w,{includeHistory:!L.current})},[n]),_=(0,K.useRef)({});return(0,K.useEffect)(()=>{if(l===Ut){let T=(w,A)=>{A&&(_.current=A),w.startsWith("``NO_HISTORY_&#``\n")&&(w=w.replace("``NO_HISTORY_&#``\n",""),L.current=!0),O(w)};return gt("chatBoxInputMediator").subscribe(T),()=>{gt("chatBoxInputMediator").unsubscribe(T)}}if(l===ie){let T=w=>{w.startsWith("``NO_HISTORY_&#``\n")&&(w=w.replace("``NO_HISTORY_&#``\n",""),L.current=!0),O(w)};return gt("floatingMenuInputMediator").subscribe(T),()=>{gt("floatingMenuInputMediator").unsubscribe(T)}}return()=>{}},[]),(0,K.useEffect)(()=>{L.current=!1,_.current={}},[e.loading]),(0,K.useEffect)(()=>{x(E.current,...b("inputValue1")),setTimeout(()=>{E.current&&Je(E.current,...b("inputValue2"))},0)},[P]),(0,K.useEffect)(()=>{let T=new ResizeObserver(A=>{for(let d of A)setTimeout(()=>{C.current=d.target?.offsetHeight||0,E.current&&Je(E.current,...b("children"))},100)}),w=new ResizeObserver(A=>{for(let d of A)setTimeout(()=>{R.current=d.target?.offsetHeight||0,E.current&&Je(E.current,...b("expand"))},100)});return g.current&&w.observe(g.current),y.current&&T.observe(y.current),()=>{T.disconnect(),w.disconnect()}},[]),(0,K.useEffect)(()=>{o.open&&E.current&&l===ie&&De(E.current,...b("floatingDropdownMenu"))},[o.open]),(0,K.useEffect)(()=>{r.open&&E.current&&l===Ut&&!We()&&De(E.current,...b("appState"))},[r.open,m]),gr(()=>{l===Ut&&Vn()&&setTimeout(()=>{De(E.current,...b("appState"))},100)}),K.default.createElement(tn,{component:"div",className:m?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${I||c?"rgb(239, 83, 80)":"customColor.borderColor"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{maxHeight:"30px",opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...S}},K.default.createElement(tn,{component:"div",className:"chat-box__input-skeleton"},K.default.createElement(go,{height:Ze})),K.default.createElement(Ar,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,color:T=>T.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",minHeight:Ze+"px",lineHeight:Ze+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},K.default.createElement(Ar,{ref:g,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"end"}},h),K.default.createElement("textarea",{id:l,placeholder:f,disabled:m,ref:E,value:P,rows:1,onCopy:T=>{T.stopPropagation()},onCut:T=>{T.stopPropagation()},onPaste:T=>{T.stopPropagation()},onKeyUp:T=>{u&&T.stopPropagation()},onKeyPress:T=>{u&&T.stopPropagation()},onKeyDown:T=>{if(u){if(T.key==="ArrowUp"||T.key==="ArrowDown"||T.key==="ArrowLeft"||T.key==="ArrowRight"||T.key==="Escape")return;T.stopPropagation()}if(!U.current){if(!(T.key==="Enter"&&T.shiftKey)){if(T.key==="Enter")i&&i(T.currentTarget.value,{includeHistory:!L.current,meta:_.current}),L.current=!1,_.current={},T.preventDefault();else if(T.code==="Space"){T.stopPropagation();return}}s&&s(T)}},onClick:T=>{De(T.currentTarget,...b("click"))},onCompositionUpdate:T=>{u&&T.stopPropagation()},onCompositionStart:T=>{u&&T.stopPropagation(),U.current=!0},onCompositionEnd:T=>{u&&T.stopPropagation(),U.current=!1,v(T)},onInput:T=>{u&&T.stopPropagation(),U.current?O(T.currentTarget.value):v(T)},onBlur:T=>{x(T.currentTarget,...b("blur")),Is(T.currentTarget)}})),K.default.createElement(Ar,{ref:y,width:"100%"},p))},ad=_s;var Ue=class extends G{static{this.type="INSERT_USER_INPUT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters?.compliedTemplate||r?.LAST_ACTION_OUTPUT||"",t=this.parameters.AskChatGPTActionMeta,n=We(),i=await io(()=>{let s=null;return n?s=no()?.querySelector(`#${ie}`):s=se()?.querySelector(`#${Ut}`),s?Promise.resolve(s):Promise.reject("not found")},30,100);i&&(n?(gt("floatingMenuInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),De(i,0)):(gt("chatBoxInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),De(i,44.5))),i||n?this.output=e:this.error=""}catch{}}};W([j(),_r()],Ue.prototype,"execute",1);var ke=class extends G{static{this.type="ANALYZE_CHAT_FILE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.AnalyzeChatFileName||r.AnalyzeChatFileName||"Content.txt",t=this.parameters.AnalyzeChatFileImmediateUpdateConversation||r.AnalyzeChatFileImmediateUpdateConversation||!1,n=r.LAST_ACTION_OUTPUT,i=(await qe(n)).length,s=i>12e3;i>fr&&(n=await ae(n,fr));let m=await ae(n,12e3);if(s)if(ur("[Summary] tokens has reached maximum limit.",`${JSON.stringify({summary_type:Eo(),url:window.location.href,total_tokens:`${Math.floor(i/1e3)}k`},null,4)}`,{uuid:"95fbacd5-f4a6-4fca-9d77-ac109ae4a94a"}).then().catch(),t){let p=await In(n,e);await this.updateConversation(o,{meta:{docId:p}})}else In(n,e).then(async p=>{await this.updateConversation(o,{meta:{docId:p}})});await this.updateConversation(o,{meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
            \`\`\`
            ${m}
            \`\`\``}}),this.output=m}catch(e){this.error=e.toString()}}};W([j()],ke.prototype,"execute",1);var Fe=class extends G{static{this.type="RENDER_CHATGPT_PROMPT"}constructor(r,o,e,t){super(r,"RENDER_CHATGPT_PROMPT",e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};W([j()],Fe.prototype,"execute",1);var Ne=class extends G{static{this.type="CHAT_MESSAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.ActionChatMessageType||"system",t=this.parameters.ActionChatMessageOperationType||"add",n=this.parameters.ActionChatMessageConfig,i=o.getChartGPT(),s=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;if(!n||!s||!i){this.error="invalid parameters";return}n.type||(n.type=e),t==="add"?(n.messageId||(n.messageId=it()),await i.pushMessage(ar([n]),s)):t==="update"?await i.updateMessage(n,s):t==="delete"&&await i.deleteMessage(1,s),this.output=String(n.messageId)}catch(e){this.error=e.message}}};W([Zt()],Ne.prototype,"execute",1);var He=class extends G{static{this.type="RENDER_TEMPLATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};W([j()],He.prototype,"execute",1);var aa={[Fe.type]:Fe,[He.type]:He,[Le.type]:Le,[ke.type]:ke,[Ne.type]:Ne,[Ue.type]:Ue,[ue.type]:ue,[ze.type]:ze,[$e.type]:$e,[me.type]:me,[fe.type]:fe,[Qe.type]:Qe,[le.type]:le,[pe.type]:pe,[de.type]:de,[je.type]:je,[he.type]:he,[Re.type]:Re,[Ke.type]:Ke,[Xe.type]:Xe,[ge.type]:ge,[ye.type]:ye,[Ae.type]:Ae,[Te.type]:Te,[Ce.type]:Ce,[Me.type]:Me,[Pe.type]:Pe,[be.type]:be,[ve.type]:ve,[_e.type]:_e,[we.type]:we,[Ee.type]:Ee},ws=a=>new Promise(r=>setTimeout(r,a)),wn=class{constructor(){this.status="idle";this.variables=new Map;this.stepIndex=-1;this.actions=[];this.listeners=[]}setActions(r){this.reset(),this.actions=[],r.map(o=>{let e=aa[o.type];if(!e)throw new Error(`Action type ${o.type} not found`);let t=new e(o.id||it(),o.type,o.parameters||{},typeof o.autoExecute=="boolean"?o.autoExecute:!0);this.actions.push(t)})}pushActions(r,o){let e=[];r.map(t=>{let n=aa[t.type];if(!n)throw new Error(`Action type ${t.type} not found`);let i=new n(t.id||it(),t.type,t.parameters||{},typeof t.autoExecute=="boolean"?t.autoExecute:!0);e.push(i)}),o==="after"?this.actions.splice(this.stepIndex+1,0,...e):this.actions.push(...e)}async executeAction(r,o){try{if(r.reset(),r.status="running",this.emit("action",r),await r.execute(this.getVariables(),o),r.error){r.status="error",this.emit("action",r);return}r.status="complete",this.emit("action",r)}catch{r.status="error",this.emit("action",r)}}async run(r){try{let{engine:o,parameters:e}=r;if(this.status==="idle"||this.status==="stop")for(this.status="running",this.emit("status",this);this.status==="running"&&this.status!=="stop";){if(this.stepIndex+=1,this.stepIndex>=this.actions.length){this.status="complete",this.emit("status",this),this.reset();break}e&&this.stepIndex===0&&this.setVariables(e);let t=this.getCurrentAction();if(t){if(this.emit("beforeRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),await this.executeAction(t,o),this.emit("afterRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),t.error){this.status="stop",this.emit("status",this),this.stepIndex=this.stepIndex-1;break}let n=t.output||"";if(this.setVariable("LAST_ACTION_OUTPUT",n,!0),this.getNextAction()?.autoExecute&&!t.error)continue}await ws(100)}}catch{this.status="stop",this.emit("status",this)}}stop(){this.status="stop"}reset(){this.stepIndex=-1,this.variables=new Map,this.status="idle"}setVariable(r,o,e){this.variables.has(r)?e&&this.variables.set(r,o):this.variables.set(r,o)}setVariables(r){r.forEach(o=>{this.setVariable(o.key,o.value,o.overwrite)})}getVariable(r){return this.variables.get(r)}getVariables(){return Object.fromEntries(this.variables)}getCurrentAction(){return this.actions[this.stepIndex]}getNextAction(){return this.actions[this.stepIndex+1]||null}getPrevAction(){return this.actions[this.stepIndex-1]||null}get progress(){return Number((Math.max(this.stepIndex,0)/this.actions.length).toFixed(2))}addListener(r){this.listeners.push(r)}removeListener(r){let o=this.listeners.indexOf(r);o>-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}emit(r,o){this.listeners.forEach(e=>{e(r,o)})}parseTemplate(r){return Jt(r,this.getVariables()).data}},sa=wn;var ca=Ln({key:"ShortCutsState",default:{status:"idle"}});var zr=new sa,Ps=new Xt({runtime:"shortcut"}),sn=a=>{let{isLogin:r}=xo(),o=an(),[e,t]=On(ca),{loading:n}=Ct(qt),i=(0,tr.useRef)(zr),s=Fo(a||""),m=u=>i.current?(i.current?.setActions(u),!0):!1,p=(0,tr.useCallback)(async(u=!1)=>{if(i.current){(!r||u&&!sr())&&ce();try{await $n()&&(i.current?.stepIndex===-1||i.current.status==="stop")&&(i.current?.actions.find(S=>S.type==="ASK_CHATGPT")&&t({status:"running"}),await i.current.run({parameters:o().shortCutsParameters,engine:{getShortCutsEngine:()=>i.current,getChartGPT:()=>s,getBackgroundConversation:()=>Ps}}))}catch{}finally{t({status:zr.status||"idle"})}}},[s,i,o,r]),c=(0,tr.useCallback)(()=>{i.current&&(i.current.stop(),t({status:zr.status||"idle"}))},[i]),l=(0,tr.useCallback)(()=>{i.current&&(i.current.reset(),t({status:zr.status||"idle"}))},[]);return{...s,shortCutsEngineRef:i,runShortCuts:p,setShortCuts:m,loading:e.status==="running"||n,status:e.status,stopShortCuts:c,resetShortCuts:l}};var Nt=mt(Dt());var ua=mt(Yr());var Ms=`You are a research expert who is good at coming up with the perfect search query to help find answers to any question. Your task is to think of the most effective search query for the following question delimited by <question></question>:

<question>
{{current_question}}
</question>

The question is the final one in a series of previous questions and answers. Here are the earlier questions listed in the order they were asked, from the very first to the one before the final question, delimited by <previous_questions></previous_questions>:
<previous_questions>
{{previous_questions}}
</previous_questions>

For your reference, today's date is {{CURRENT_DATE}}.

Output 3 search queries as JSON Array format without additional number, context, explanation, or extra wording, site information, just 3 text search queries as JSON Array format.`,Rs=`You are a research expert who is good at coming up with the perfect search query to help find answers to any question. Your task is to think of the most effective search query for the following question delimited by <question></question>:

<question>
{{current_question}}
</question>

The question is the final one in a series of previous questions and answers. Here are the earlier questions listed in the order they were asked, from the very first to the one before the final question, delimited by <previous_questions></previous_questions>:
<previous_questions>
{{previous_questions}}
</previous_questions>

For your reference, today's date is {{CURRENT_DATE}}.

Output 1 search query as JSON Array format without additional number, context, explanation, or extra wording, site information, just 1 text search query as JSON Array format.`,Ls=",",la=(a,r=!1)=>{let o=r?Ms:Rs;o=o.replaceAll("{{CURRENT_DATE}}",(0,ua.default)().format("YYYY-MM-DD HH:mm:ss"));let e=a[a.length-1],t=a.slice(0,-1);o=o.replaceAll("{{current_question}}",e);let n="";return t.forEach((i,s)=>{n+=`${s+1}) ${i}${s<t.length-1?`
`:""}`}),o=o.replaceAll("{{previous_questions}}",n),o},Os=async a=>{let r=yo;if(!r)return a;r=r.replaceAll("{query}",a),r=r.replace("{web_results}","{{PAGE_CONTENT}}"),r=r.replaceAll("{current_date}","{{CURRENT_DATE}}");let o=await Uo();return o.userSettings?.language&&(r=r+`
Respond in ${o.userSettings?.language}`),r},ma=async(a,r,o)=>{let{searchEngine:e="google",maxResultsCount:t=6,copilot:n=!1}=(await yr()).sidebarSettings?.search||{},i=it(),s=a,m="",p=a.match(/\/site:(\S+)/);return p&&(m=p[1],s=a.replace(p[0],"")),s=Ve(s,{trim:!0,noQuotes:!0,noCommand:!0}),{actions:[{type:"DATE",parameters:{DateActionMode:"Current Date",DateFormatStyle:"YYYY-MM-DD HH:mm:ss"}},{type:"SET_VARIABLE",parameters:{VariableName:"CURRENT_DATE"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:i,text:"",originalMessage:{metadata:{shareType:"search",title:{title:a},copilot:{title:{title:n?"Copilot":"Quick search",titleIcon:n?"Awesome":"Bolt",titleIconSize:24},steps:[{title:"Understanding question",status:"loading",icon:"CheckCircle"}]}},include_history:o}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"ASK_CHATGPT",parameters:{AskChatGPTWithHistory:o,template:la(o?r.concat(s):[s],n),AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",AskChatGPTActionMeta:{temperature:0,messageVisibleText:a,contextMenu:{id:"b481731b-19e3-4713-8f0b-81fd7b2d5169",droppable:!1,parent:"",text:"[Search] smart query",data:{editable:!1,type:"shortcuts",actions:[]}}}}},{type:"TEXT_HANDLER",parameters:{ActionTextHandleParameters:{trim:!0,noQuotes:!0,noCommand:!0,matchSquareBracketContent:!0}}},{type:"SET_VARIABLE",parameters:{VariableName:"SMART_SEARCH_QUERY"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Understanding question",status:"complete",icon:"CheckCircle"},{title:"Searching web",status:"loading",icon:"Search"}]},sources:{status:"loading",links:[]}},content:{contentType:"text",text:""}}}}},{type:"GET_CONTENTS_OF_SEARCH_ENGINE",parameters:{URLSearchEngine:e,URLSearchEngineParams:{q:"{{SMART_SEARCH_QUERY}}",region:"",limit:`${t}`,btf:"",nojs:"1",ei:"UTF-8",csp:"1",site:m,splitWith:Ls}}},{type:"SET_VARIABLE",parameters:{VariableName:"SEARCH_SOURCES"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Understanding question",status:"complete",icon:"CheckCircle"},{title:"Searching web",status:"complete",icon:"Search",valueType:"tags",value:"{{SMART_SEARCH_QUERY}}"}]},sources:{status:"complete",links:"{{SEARCH_SOURCES}}"}}}}}},{type:"RENDER_TEMPLATE",parameters:{template:"{{SEARCH_SOURCES}}"}},{type:"WEBGPT_SEARCH_RESULTS_EXPAND",parameters:{SummarizeActionType:n?"MAP_REDUCE":"NO_SUMMARIZE",template:`You are a highly proficient researcher that can read and write properly and fluently, and can extract all important information from any text. You task is to extract and summarize the information related to the following question, delimited by <question></question>, from the following text, delimited by <text></text>.

---

Question:
<question>
${s}
</question>

Text:
<text>
{{WEBPAGE_CONTENT}}
</text>

---

Output a concise summary that is at most {{NUMBER_OF_WORDS}} words.

Use the following format:
<summary>
The summary of the text
</summary>

---

If there's no information related to question, delimited by <question></question>, in the text, delimited by <text></text>, simply reply N/A.

The text is sourced from the main content of the webpage at {{WEBPAGE_URL}}.

Respond in the same language variety or dialect of the text.`}},{type:"SET_VARIABLE",parameters:{VariableName:"PAGE_CONTENT"}},{type:"ASK_CHATGPT",parameters:{AskChatGPTWithHistory:o,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN",AskChatGPTActionMeta:{messageVisibleText:a,searchSources:"{{SEARCH_SOURCES}}",contextMenu:{id:"73361add-2d6a-4bf3-b2a7-5097551653e7",droppable:!1,parent:"",text:"[Search] answer",data:{editable:!1,type:"shortcuts",actions:[]}}},template:await Os(s)}}],messageId:i}};var Ds=()=>{let{currentSidebarConversationId:a,currentSidebarConversationType:r,currentSidebarConversationMessages:o,updateSidebarConversationType:e}=Yt(),t=Dn(qt),n=vo(),{currentUserPlan:i}=ho(),{setShortCuts:s,runShortCuts:m}=sn(""),[p,c]=(0,Nt.useState)([]),{createConversation:l}=wo(),u=(0,Nt.useRef)(!1),f=(0,Nt.useRef)(""),h=(0,Nt.useMemo)(()=>{let P=[];for(let O=o.length-1;O>=0;O--){let C=o[O];if(P.unshift(C?.originalMessage?.metadata?.title?.title||C.text||""),C.type==="ai"&&C?.originalMessage?.include_history===!1)break}return P},[o]),S=async(P,O)=>{if(!u.current){sr()||ce(),r!=="Search"&&await e("Search"),await Jr("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0),t(C=>({...C,loading:!0}));try{let C=await l("Search");if(t(g=>({...g,loading:!1})),i.name!=="pro"&&i.name!=="elite"){let g=Number((await Yn()).ON_BOARDING_RECORD_SEARCH_FREE_TRIAL_TIMES)||0;if(g>0)await Jr("ON_BOARDING_RECORD_SEARCH_FREE_TRIAL_TIMES",g-1);else{await wt("add",C,0,[bo(n.SIDEBAR_SEARCH_WITH_AI)]),So("show","SIDEBAR_SEARCH_WITH_AI");return}}let{messageId:R,actions:y}=await ma(P,h,O);f.current=R,c(y)}catch{}}},I=(0,Nt.useRef)(S);(0,Nt.useEffect)(()=>{I.current=S},[S]);let E=async()=>(await yr())?.sidebarSettings?.search?.conversationId||"",U=async P=>{sr()||ce(),r!=="Search"&&await e("Search");let O=await E();O&&await br(O)||(O=await l("Search")),await wt("add",O,0,[P])},L=async()=>{try{if(a){let P=null,O=0;for(let R=o.length-1;R>=0;R--){let y=o[R];if(O++,y.type==="ai"){P=y;break}}let C=P?.originalMessage?.metadata?.title?.title||P?.text||"";C?(await wt("delete",a,O,[]),setTimeout(async()=>{await I.current(C,P?.originalMessage?.include_history||!1)},200)):await wt("delete",a,9999,[])}}catch{}};return(0,Nt.useEffect)(()=>{p.length>0&&!u.current&&r==="Search"&&a&&(u.current=!0,s(p)?m().then().catch().finally(async()=>{u.current=!1,c([]);let P=await E();P&&f.current&&wt("update",P,0,[{messageId:f.current,originalMessage:{metadata:{sources:{status:"complete"},isComplete:!0}}}]).then().catch()}):(c([]),u.current=!1))},[m,c,r,a,p]),{createSearchWithAI:S,regenerateSearchWithAI:L,continueInSearchWithAI:U}},Hh=Ds;var Lt=mt(Dt());var Rt=mt(Dt());var er=new Xt({runtime:"client"}),Us=()=>{let[a,r]=(0,Rt.useState)([]),{currentAIProviderModelDetail:o,aiProvider:e}=xr(),{currentSidebarConversationMessages:t,currentSidebarConversationId:n}=Yt(),i=(0,Rt.useRef)(!1),s=(0,Rt.useMemo)(()=>o?.uploadFileConfig,[o]),m=(0,Rt.useCallback)(async l=>{i.current=!0;let u=ir(l).map(f=>(f.uploadStatus==="idle"&&(f.uploadStatus="uploading",f.uploadProgress=20),f));switch(r(u),e){case"OPENAI":await er.postMessage({event:"Client_chatUploadFiles",data:{files:u}});break;case"BING":{let f=await Promise.all(l.map(async h=>{if(h.file&&Ir(h.file)){let S=await qo(h.file);S&&(h.base64Data=S)}return h}));await er.postMessage({event:"Client_chatUploadFiles",data:{files:f}})}break;default:{let f=await Promise.all(l.map(async h=>{let S=await Go(h.file),I=ir(h);return I.file=S,I}));await er.postMessage({event:"Client_chatUploadFiles",data:{files:f}})}break}setTimeout(()=>{i.current=!1},1e3)},[s,e]),p=(0,Rt.useCallback)(async l=>{let u=await er.postMessage({event:"Client_chatRemoveFiles",data:{files:l}});return r(u.data||[]),u.success},[s]),c=(0,Rt.useMemo)(()=>{switch(e){case"OPENAI":return"File uploading. Please send your message once upload completes.";default:return"File uploading. Please send your message once upload completes."}return""},[e]);return(0,Rt.useEffect)(()=>{let l=a.find(u=>u.uploadStatus==="error");if(l){switch(e){case"OPENAI":n&&!lr(t,u=>u.messageId===l.id)&&wt("add",n,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:l.uploadErrorMessage==="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again."?"info":"error"}}]);break;default:n&&!lr(t,u=>u.messageId===l.id)&&wt("add",n,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:"error"}}])}p([l])}},[a,e]),Xn(()=>{er.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{i.current||Xr(l.data)&&r(l.data)})}),gr(()=>{er.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{Xr(l.data)&&r(l.data)})}),Jn(async(l,u,f)=>{switch(l){case"Client_listenUploadFilesChange":{let{files:h}=u;return r(h),{success:!0,data:{},message:""}}default:break}}),{aiProviderUploadingTooltip:c,AIProviderConfig:s,aiProviderUploadFiles:m,aiProviderRemoveFiles:p,files:a}},fa=Us;var ks=a=>{let{disabled:r=!1,TooltipProps:o,onUpload:e,onDone:t,...n}=a,{t:i}=lo(["common","client"]),{files:s,AIProviderConfig:m,aiProviderUploadFiles:p,aiProviderRemoveFiles:c,aiProviderUploadingTooltip:l}=fa(),u=Ct(so),f=Ct(qt),h=(0,Lt.useRef)(null),S=m?.maxCount||1,I=m?.maxFileSize||5*1024*1024,E=(0,Lt.useMemo)(()=>s.length>=(m?.maxCount||1),[s]),U=async L=>{let P=s?.length||0,O=S-P,C=L.target.files;if(!C||O===0)return;let R=Array.from(C);if(R=R.slice(0,O),R.length===0)return;let y=await Promise.all(R.map(async g=>{let x=Ir(g),b="file",v="";x&&(b="image",v=await vr(g)||"");let _={id:it(),file:g,fileName:g.name,fileSize:g.size,fileType:g.type,base64Data:v,blobUrl:URL.createObjectURL(g),uploadStatus:"idle",uploadErrorMessage:"",uploadProgress:0,icon:b};return I>0&&_.fileSize>I&&(_.uploadStatus="error",_.uploadErrorMessage=`Upload failed: ${_.fileName} exceeds the ${(I/1024/1024).toFixed(0)}MB limit. Please select a smaller file.`),_}));await p(s.concat(y)),h.current&&(h.current.value="")};return!m||u.status!=="success"||f.loading?Lt.default.createElement(Lt.default.Fragment,null):Lt.default.createElement(Wo,{files:s,loadingTooltipTitle:l,onRemove:async L=>{await c([L])},TooltipProps:o,...n},!E&&Lt.default.createElement(uo,{placement:"top",title:m?.acceptTooltip?m.acceptTooltip(i):"Upload file",...o},Lt.default.createElement(ao,{disabled:r,sx:{minWidth:"unset",p:0,my:"4px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{h.current&&h.current.click()}},Lt.default.createElement(Po,{icon:"AddCircle",sx:{color:"inherit"}}))),Lt.default.createElement("input",{multiple:S>1,onChange:U,ref:h,accept:m?.accept||"",hidden:!0,style:{display:"none"},type:"file"}))},pg=ks;Aa();Ta();var Ht=mt(Dt()),pa=mt(ya()),da=mt(xa());var Fs="maxai-snackbar",Ns="maxai-snackbar-container",pr,Hs=()=>(pr=Ro(),null);var Gs=()=>{let{customTheme:a}=Wn({colorSchema:"dark"});return Ht.default.createElement(Fn,{theme:a},Ht.default.createElement(Mo,{maxSnack:3,preventDuplicate:!0,hideIconVariant:!0,autoHideDuration:3e3,anchorOrigin:{vertical:"bottom",horizontal:"right"},action:r=>Ht.default.createElement(co,{onClick:()=>{pr&&pr.closeSnackbar&&pr.closeSnackbar(r)}},Ht.default.createElement(da.default,{fontSize:"inherit",sx:{color:"white"}}))},Ht.default.createElement(Hs,null)))},vg=()=>{let{container:a,shadowRoot:r,emotionRoot:o}=Ao({containerId:Ns,shadowRootId:Fs,presetContainerElement(t){t.style.color="#fff"}});a.style.zIndex="2147483647",document.body.appendChild(r);let e=Un({key:"webchatgpt-snackbar-emotion-cache",prepend:!0,container:o});(0,pa.createRoot)(a).render(Ht.default.createElement(Ht.default.StrictMode,null,Ht.default.createElement(Rn,null,Ht.default.createElement(kn,{value:e},Ht.default.createElement(Gs,null)))))},$r=(a,r={})=>{pr.enqueueSnackbar(a,r)},Bs=(a,r={})=>{$r(a,{...r,variant:"success"})},qs=(a,r={})=>{$r(a,{...r,variant:"warning"})},Ws=(a,r={})=>{$r(a,{...r,variant:"info"})},Vs=(a,r={})=>{$r(a,{...r,variant:"error"})},zs={success:Bs,warning:qs,info:Ws,error:Vs},Ig=zs;export{Ec as a,Vo as b,jo as c,Ra as d,Tu as e,oa as f,ad as g,sn as h,Hh as i,pg as j,vg as k,Ig as l};
