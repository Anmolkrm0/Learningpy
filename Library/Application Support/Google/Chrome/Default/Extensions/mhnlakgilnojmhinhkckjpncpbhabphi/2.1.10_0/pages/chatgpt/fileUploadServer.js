import"../../chunks/PQ35KENF.js";var f="MAX_AI_CHAT_GPT_MESSAGE_KEY",u=class{constructor(){this.pendingPromises=[];window.addEventListener("message",async o=>{if(o.data?.event===f&&o.data?.type==="arkoseToken"){let e=await this.generate();window.postMessage({event:f,type:"arkoseTokenResponse",data:{taskId:o.data?.data?.taskId,token:e}})}})}useArkoseSetupEnforcement(o){this.enforcement=o,window.useArkoseSetupEnforcement(new Proxy(o,{get:(e,t,a)=>t==="setConfig"?n=>{this.config=n;let s=n.onCompleted;n.onCompleted=c=>{s(c),this.pendingPromises.forEach(l=>{l.resolve(c.token)}),this.pendingPromises=[]};let d=n.onFailed;return n.onFailed=c=>{d(c),this.pendingPromises.forEach(l=>{l.reject(new Error("Failed to generate arkose token"))})},Reflect.get(e,t,a)(n)}:Reflect.get(e,t,a)}))}injectScript(o){let e=window;e.useArkoseSetupEnforcement2=this.useArkoseSetupEnforcement.bind(this);let t=document.createElement("script");t.src=o,t.async=!0,t.defer=!0,t.setAttribute("data-callback","useArkoseSetupEnforcement2"),document.body.appendChild(t)}async loadConfig(){let o=document.querySelector("#prompt-textarea")||document.querySelector("textarea");if(o){o.focus(),o.select();let e=!1;for(;!e;)document.execCommand("insertText",!1,"a"),await new Promise(t=>setTimeout(t,1e3)),e=!!this.config}return o.select(),document.execCommand("Delete",!1,""),!0}async run(){let o=document.querySelector("#prompt-textarea")||document.querySelector("textarea");o&&(o.focus(),o.select(),document.execCommand("Delete",!1,""),await new Promise(e=>setTimeout(e,2e3)),document.execCommand("insertText",!1,"a"),await new Promise(e=>setTimeout(e,2e3)),document.execCommand("Delete",!1,""))}async generate(){if(this.enforcement)return new Promise(async(o,e)=>{this.pendingPromises=[{resolve:o,reject:e}],this.config||await this.loadConfig(),await this.run()})}},h=new u;var i="MAX_AI_CHAT_GPT_MESSAGE_KEY",m=!1,p=[],y=window.fetch,w=(r,o)=>y(r,o).then(function(e){return new Promise(t=>{if(m&&(["https://chat.openai.com/backend-api/files","https://chat.openai.com/backend-api/conversation/interpreter/process_upload"].includes(r)||r.includes("https://chat.openai.com/backend-api/files"))){let a=e.clone(),n=r==="https://chat.openai.com/backend-api/files"?1:2;a.json().then(s=>{if(window.postMessage({event:i,type:"upload_change",data:{status:e.status,url:r,result:s,progress:n===2?100:80,done:n===2}}),n===2){s.status="error";let d=new Response(JSON.stringify(s),{status:500,statusText:"error",headers:e.headers});m=!1,t(d)}t(e)}).catch(s=>{t(e)})}else t(e)})});window.fetch=w;var k=()=>document.querySelector('input[type="file"]');window.addEventListener("message",r=>{if(r.data?.event===i){let{type:o,data:e}=r.data;switch(o){case"ping":{let{taskId:t}=e,a=!!k();window.postMessage({event:i,type:"pong",data:{taskId:t,success:a}})}break;case"upload":{let{files:t,taskId:a}=e;p=t,m=!0,window.postMessage({event:i,type:"upload_result",data:{taskId:a,success:!0}})}break;case"upload_change":{let{result:t,progress:a,done:n}=e,s=p[0];t?.file_id&&(s.uploadedFileId=t?.file_id),t.status==="success"?(s.uploadProgress=a,s.uploadStatus=n?"success":"uploading",s.uploadedUrl=t?.download_url):(s.uploadProgress=0,s.uploadStatus="error",s.uploadErrorMessage=t?.error||"upload error"),window.postMessage({event:i,type:"upload_change_result",data:{files:p}})}break;default:break}}});var g=document.querySelector("script[data-arkose]")?.getAttribute("data-arkose");g&&h.injectScript(g);
