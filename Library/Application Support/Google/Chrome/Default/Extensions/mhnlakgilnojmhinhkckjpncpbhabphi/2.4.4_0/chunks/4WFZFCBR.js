import{a as Zt,b as yt,c as er,e as tr,f as na,h as sa}from"./T24GFQ67.js";import"./AHWP7E53.js";import{a as ia,c as la}from"./B3S7E6KC.js";import{a as ma}from"./7WIRVMYB.js";import{a as Jt}from"./PQGFOO7I.js";import{a as Ee}from"./OJNVQ3UZ.js";import{a as pa}from"./EWBIKZPQ.js";import{b as No,d as Ho,f as zo,g as Go,h as $t,i as Wo,j as jo,l as tt}from"./YFBDBYJ4.js";import"./FSE6QFO2.js";import{a as un}from"./35DEV6ZR.js";import"./S6KJ77EJ.js";import{a as Uo}from"./UKCA3OWL.js";import{d as $o,f as pe,h as ea,i as Qt,j as Br,k as ht,p as _t,q as ra,s as oa,t as Xt,u as aa,v as he}from"./TPLPQCTH.js";import{b as Jo,c as Zo,f as ta}from"./XS6LGTM5.js";import"./IA5SYYCH.js";import{c as Xo}from"./O7EBOFNZ.js";import{c as qo,f as Ko,k as Yo,l as Qo}from"./6RQCUKHB.js";import"./CAIW4P6U.js";import{g as bt}from"./U6WUZGPQ.js";import{f as me}from"./TXJVG63N.js";import{a as Ro}from"./XSN3FURQ.js";import"./QDB4CE2P.js";import"./ONY4XELL.js";import{a as Vo}from"./6L4QKYCK.js";import{a as mo,c as uo,e as Ce,f as ft}from"./ZZYV6GAN.js";import"./JPAWUU4R.js";import"./XYFFQRMZ.js";import"./4NAB6M5G.js";import"./CML227OB.js";import{a as mn}from"./DYUK4WZS.js";import{A as Ao,Aa as Bo,B as Yt,I as Ge,Kb as pn,Lb as Fo,Y as Mo,c as So,ca as et,e as zt,f as vo,fa as ko,fb as Dr,ka as Oo,p as Io,q as an,r as Or,x as k,za as Do}from"./R7ESC43Z.js";import{c as Ie,d as Kt}from"./F7SGTV27.js";import"./5QWZ7UE4.js";import{e as nn,f as sn,h as ln,l as Le}from"./FOUKVBQX.js";import{I as qt,T as Eo,b as To,d as ze,l as Ut,q as Rt,r as Lo,w as jt}from"./NXGYST7J.js";import"./LP276KYG.js";import"./RO4X7EGV.js";import"./2N2SG5RC.js";import"./NNU75GHZ.js";import{d as Wt,e as He}from"./QJSKL7UD.js";import"./KXHDIDXQ.js";import{h as ue,i as Se,j as Gt}from"./XYZAUIQ2.js";import{c as gt}from"./QONG524O.js";import{f as Po,h as Ht,r as Co}from"./ES4G5FSE.js";import{c as Te,f as ne}from"./6UCR6JSM.js";import{a as M,b as on,c as Ze}from"./IPNS2UUO.js";import{d as G}from"./FRAG5SMK.js";import"./HYW7LR6S.js";import{b as Nt}from"./6ER2OOH3.js";import{C as xo,a as c,b as Je,u as _}from"./DRCUZC3I.js";import"./RSO45DR6.js";import"./TY7U7FR6.js";import{t as po}from"./PF3XPTWR.js";import{F as lo,I as wr,l as so,m as en,n as ke,q as tn}from"./MWTIYFYH.js";import"./IQBPRLVE.js";import"./HEBGDMW5.js";import"./6LS5XNTR.js";import"./W2F53U5Z.js";import{a as kr,d as q,k as _o,o as yo}from"./TYBXNNUH.js";import"./DUIWQHLB.js";import{b as Pe,c as wo}from"./KG5SJQNS.js";import"./HQC5KEMG.js";import{B as kt,C as go,F as bo,G as Vt,O as Ot,W as ho,a as Qe,e as Mt,f as co,j as fo,k as rn,r as Xe,u as Mr}from"./AAMCXCLO.js";import{c as P}from"./CAPNT4IP.js";import{e as Ne}from"./YN4XY6JW.js";import{E as io,M as Ar,Q as no,V as dt,a as h,d as $e,f as Me,g as Ve,j as oo,l as ao,q as Ft}from"./IPAGS25B.js";import{a as ro}from"./3JX3VARJ.js";import{c as Ye,f as u}from"./PQ35KENF.js";var ua=Ye(rr=>{"use strict";var cn=Je();Object.defineProperty(rr,"__esModule",{value:!0});rr.default=void 0;var dn=cn(Ze()),fn=ke(),gn=(0,dn.default)((0,fn.jsx)("path",{d:"m19 8-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"}),"Cached");rr.default=gn});var da=Ye(or=>{"use strict";var hn=Je();Object.defineProperty(or,"__esModule",{value:!0});or.default=void 0;var _n=hn(Ze()),yn=ke(),xn=(0,_n.default)((0,yn.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"}),"Favorite");or.default=xn});var Ha=Ye(cr=>{"use strict";var Yn=Je();Object.defineProperty(cr,"__esModule",{value:!0});cr.default=void 0;var $n=Yn(Ze()),Qn=ke(),Xn=(0,$n.default)((0,Qn.jsx)("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"}),"FavoriteOutlined");cr.default=Xn});var Wa=Ye(dr=>{"use strict";var Jn=Je();Object.defineProperty(dr,"__esModule",{value:!0});dr.default=void 0;var Zn=Jn(Ze()),es=ke(),ts=(0,Zn.default)((0,es.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}),"RemoveRedEye");dr.default=ts});var Ja=Ye(br=>{"use strict";var ps=Je();Object.defineProperty(br,"__esModule",{value:!0});br.default=void 0;var ms=ps(Ze()),us=ke(),cs=(0,ms.default)((0,us.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"AddOutlined");br.default=cs});var Fi=Ye(Cr=>{"use strict";var js=Je();Object.defineProperty(Cr,"__esModule",{value:!0});Cr.default=void 0;var qs=js(Ze()),Ks=ke(),Ys=(0,qs.default)((0,Ks.jsx)("path",{d:"M7.41 18.59 8.83 20 12 16.83 15.17 20l1.41-1.41L12 14l-4.59 4.59zm9.18-13.18L15.17 4 12 7.17 8.83 4 7.41 5.41 12 10l4.59-4.59z"}),"UnfoldLess");Cr.default=Ys});var Vi=Ye(Tr=>{"use strict";var $s=Je();Object.defineProperty(Tr,"__esModule",{value:!0});Tr.default=void 0;var Qs=$s(Ze()),Xs=ke(),Js=(0,Qs.default)((0,Xs.jsx)("path",{d:"M12 5.83 15.17 9l1.41-1.41L12 3 7.41 7.59 8.83 9 12 5.83zm0 12.34L8.83 15l-1.41 1.41L12 21l4.59-4.59L15.17 15 12 18.17z"}),"UnfoldMore");Tr.default=Js});var Et=u(h());var y=u(h());var Ri=u(ua());var ji=u(un());var Z=u(h());var pi=u(Ho());var xt=u(h());var bn=()=>{let{t:e}=P(["client","common"]),{updateSidebarSettings:t,sidebarSettings:r}=k();return xt.default.createElement(Se,{title:e("client:sidebar__search_with_ai__advanced__copilot__description")},xt.default.createElement(c,{onClick:async()=>{r?.search?.copilot?await t({search:{copilot:!1}}):await t({search:{copilot:!0}})},direction:"row",alignItems:"center",gap:.5,sx:{py:"6px",px:1,cursor:"pointer","& .use-chat-gpt-ai--MuiSwitch-switchBase":{padding:0,margin:"2px",transitionDuration:"300ms","&.Mui-checked":{transform:"translateX(16px)",color:"#fff","& + .use-chat-gpt-ai--MuiSwitch-track":{backgroundColor:"primary.main",opacity:1,border:0},"&.Mui-disabled + .use-chat-gpt-ai--MuiSwitch-track":{opacity:.5}},"&.Mui-focusVisible .use-chat-gpt-ai--MuiSwitch-thumb":{color:"primary.main",border:"6px solid #fff"},"&.Mui-disabled .use-chat-gpt-ai--MuiSwitch-thumb":{color:o=>o.palette.mode==="light"?o.palette.grey[100]:o.palette.grey[600]},"&.Mui-disabled + .use-chat-gpt-ai--MuiSwitch-track":{opacity:o=>o.palette.mode==="light"?.7:.3}},"& .use-chat-gpt-ai--MuiSwitch-thumb":{boxSizing:"border-box",width:12,height:12},"& .use-chat-gpt-ai--MuiSwitch-track":{borderRadius:16/2,backgroundColor:o=>o.palette.mode==="light"?"#E9E9EA":"#39393D",opacity:1,transition:o=>o.transitions.create(["background-color"],{duration:500})}}},xt.default.createElement(c,{alignItems:"center",justifyContent:"center",p:"2px"},xt.default.createElement(ta,{checked:r?.search?.copilot,sx:{width:32,height:16,padding:0},color:"primary"})),xt.default.createElement(_,{fontSize:"14px",color:"text.primary"},e("client:sidebar__search_with_ai__advanced__copilot__title"))))},ca=bn;var $=u(h());var Lt=u(h());var Oe=u(h());en();var We=u(h()),ha=u(da());var fa="Public",ga="MaxAI.me",Fr="https://api.maxai.me/app/maxai-web?ref=webchatgpt";var gl=$e({key:"PromptCategoryOptions",default:[]}),Sn={category:"All",use_case:"All",keyword:"",tab_active:fa},bl=$e({key:"PromptSearchParamsStore",default:Sn}),hl=$e({key:"FavoritesPromptIdsAtom",default:[]}),_l=$e({key:"SelectPromptIdAtom",default:null}),ar=$e({key:"PromptLibraryState",default:{open:!1,editPromptId:"",selectedPromptLibraryCard:null}}),ba=$e({key:"PromptLibraryListParametersState",default:{enabled:!1,activeTab:"Public",query:"",category:"All",use_case:"All",page:0,page_size:12,total:0}});var Pn=()=>{let[e,t]=Ve(ba),r=n=>{t(s=>({...s,...n}))},o=n=>{r({activeTab:n})},a=n=>{r({query:n,page:0})};return{promptLibraryListParameters:e,activeTab:e.activeTab,searchQuery:e.query,updatePromptLibraryListParameters:r,updateActiveTab:o,updateSearchQuery:a}},K=Pn;var vn=so(({...e})=>We.default.createElement(Xt,{...e}))(({theme:e})=>{let r=e.palette.mode==="dark";return{"&":{},[`.${Br.root}`]:{padding:"6px 16px",borderBottom:"1px solid",borderColor:r?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",minHeight:52},[`.${Br.root}.Mui-selected`]:{background:r?"#3E3F4C":"rgba(0, 0, 0, 0.08)",color:r?"#fff":"rgba(0, 0, 0, 0.6)"},[`.${oa.indicator}`]:{backgroundColor:"#d8d8d8"},[`.${xo.root}`]:{fontSize:"16px"}}}),Cn=()=>{let{t:e}=P(["prompt_library"]),{activeTab:t,updateActiveTab:r}=K();return We.default.createElement(M,{flex:1,flexBasis:"100%"},We.default.createElement(vn,{value:t,variant:"fullWidth",onChange:(o,a)=>{r(a)}},We.default.createElement(ht,{icon:We.default.createElement(ha.default,{sx:{fontSize:"24px"}}),iconPosition:"start",value:"Favorites",label:e("prompt_library:tab__favorites__title")}),We.default.createElement(ht,{value:"Public",label:e("prompt_library:tab__public__title")}),We.default.createElement(ht,{value:"Own",label:e("prompt_library:tab__own__title")})))},_a=Cn;var St=u(h());var D={GET_FAVOURITE_PROMPTS:"/prompt/get_favourite_prompts",GET_OWN_PROMPTS:"/prompt/get_own_prompts",SEARCH_PROMPT:"/prompt/search_prompt",GET_PROMPT_DETAIL:"/prompt/get_prompt_detail",GET_PRIVATE_PROMPT_DETAIL:"/prompt/get_private_prompt_detail",PROMPT_CATEGORY:"/prompt/category",ADD_PROMPT:"/prompt/add_own_prompt",ADD_FAVOURITE_PROMPT:"/prompt/add_favourite_prompt",REMOVE_FAVOURITE_PROMPT:"/prompt/remove_favourite_prompt",DELETE_PROMPT:"/prompt/remove_own_prompt",EDIT_OWN_PROMPT:"/prompt/update_own_prompt"},Y=class{constructor(){}static async getCategoryOptions(){let t=await wo(D.PROMPT_CATEGORY);if(t.status==="OK"&&t.data?.length){let r=new Map;return t.data.forEach(o=>{if(r.has(o.category)){let a=r.get(o.category);a&&(a.use_cases=go([...a.use_cases,...o.use_cases]))}else r.set(o.category,o)}),Array.from(r.values())}return[]}static async getPublicPrompts(t){let r=await Pe(D.SEARCH_PROMPT,bo({page:t.page,page_size:t.page_size,category:t.category==="All"?"":t.category,use_case:t.use_case==="All"?"":t.use_case,keyword:t.query}));if(r.status==="OK")return r}static async getFavouritePrompts(){return(await Pe(D.GET_FAVOURITE_PROMPTS,{})).data?.favourite_prompts||[]}static async addFavoritePrompt(t){return(await Pe(D.ADD_FAVOURITE_PROMPT,{id:t})).status==="OK"}static async removeFavoritePrompt(t){return(await Pe(D.REMOVE_FAVOURITE_PROMPT,{id:t})).status==="OK"}static async getOwnPrompts(){return(await Pe(D.GET_OWN_PROMPTS,{})).data?.own_prompts||[]}static async getPublicPromptDetail(t){return(await Pe(D.GET_PROMPT_DETAIL,{id:t})).data}static async getPrivatePromptDetail(t){return(await Pe(D.GET_PRIVATE_PROMPT_DETAIL,{id:t})).data}static async addPrivatePrompt(t){return(await Pe(D.ADD_PROMPT,{...t,prompt_hint:"_",id:""})).data}static async editPrivatePrompt(t){return(await Pe(D.EDIT_OWN_PROMPT,{...t,prompt_hint:t.prompt_hint||"_"})).data}static async deletePrivatePrompt(t){return(await Pe(D.DELETE_PROMPT,{id:t})).status==="OK"}};var Vr=u(h());var Tn=e=>{let{isLoading:t,data:r}=Ce({queryKey:[D.PROMPT_CATEGORY],queryFn:Y.getCategoryOptions,initialData:[{category:"All",use_cases:["All"]}]}),o=(0,Vr.useMemo)(()=>r?Mr(Or(r,{labelKey:"category",valueKey:"category"}),n=>n.value==="All",["desc"]):[],[r]);return{useCaseOptions:(0,Vr.useMemo)(()=>{let n=e||"All",s=o.find(l=>l.value===n);return s?Mr(Or(s?.origin?.use_cases||[]),l=>l.value==="All",["desc"]):[]},[o,e]),categoryOptions:o,loading:t}},ir=Tn;var In=()=>{let{t:e}=P(["prompt_library"]),{promptLibraryListParameters:t,updatePromptLibraryListParameters:r}=K(),{categoryOptions:o,useCaseOptions:a,loading:n}=ir(t.category),s=Ee(),l=(0,St.useMemo)(()=>({width:s==="xs"||s==="sm"||s==="md"?"100%":"unset",[`& .${Wt.root}`]:{width:s==="xs"||s==="sm"||s==="md"?"calc(50% - 8px)":"unset"},[`& .${qt.root}`]:{width:s==="xs"||s==="sm"||s==="md"?"100%":"220px"}}),[s]);return St.default.createElement(c,{direction:"row",flexWrap:"wrap",alignItems:"center",gap:2,sx:l},St.default.createElement(et,{loading:n,sx:{height:44},label:e("prompt_library:filters__category__label"),options:o,value:t.category,MenuProps:{sx:{maxHeight:"550px"}},onChange:async(i,p)=>{r({category:i,use_case:"All",page:0})}}),St.default.createElement(et,{loading:n,sx:{height:44},label:e("prompt_library:filters__use_case__label"),options:a,value:t.use_case,MenuProps:{sx:{maxHeight:"550px"}},onChange:async(i,p)=>{r({use_case:i,page:0})}}))},ya=In;var ge=u(h());var xa=u(an());var Ln=()=>{let{t:e}=P(["prompt_library"]),{searchQuery:t,updateSearchQuery:r}=K(),o=(0,ge.useRef)(null),a=(0,ge.useRef)(null),n=(0,ge.useCallback)(p=>{let m=a.current;if(p?.stopPropagation(),m!==null&&m!==""&&m.length<=2){tt.warning("Enter at least 3 characters to search.",{anchorOrigin:{vertical:"top",horizontal:"center"}});return}r(m||"")},[t]),s=(0,ge.useCallback)(()=>{o.current&&clearTimeout(o.current),o.current=window.setTimeout(()=>{(a.current&&a.current?.length>=3||a.current==="")&&n()},600)},[n]),l=Ee(),i=(0,ge.useMemo)(()=>({[`&.${Wt.root}`]:{width:l==="xs"?"100%":l==="sm"||l==="md"?"calc(50% - 8px)":"220px"}}),[l]);return ge.default.createElement(me,{defaultValue:t,label:e("prompt_library:filters__query__placeholder"),variant:"outlined",size:"small",sx:i,onChange:p=>{let m=p.target.value;a.current=m,(m===""||m.length>2)&&s()},onKeyDown:p=>{p.key==="Enter"&&n(p)},onBlur:n,InputProps:{sx:{height:44,fontSize:"16px"},endAdornment:ge.default.createElement(Xo,{position:"end"},ge.default.createElement(ne,{onClick:n,edge:"end"},ge.default.createElement(xa.default,null)))}})},Sa=Ln;var sr=u(h());var Ca=u(Nt()),nr=u(h());var Pa=()=>q(),rt={success:(e,t={})=>tt.success(e,{anchorOrigin:{vertical:"bottom",horizontal:"left"},...t}),warning:(e,t={})=>tt.warning(e,{anchorOrigin:{vertical:"bottom",horizontal:"left"},...t}),info:(e,t={})=>tt.info(e,{anchorOrigin:{vertical:"bottom",horizontal:"left"},...t}),error:(e,t={})=>tt.error(e,{anchorOrigin:{vertical:"bottom",horizontal:"left"},...t})},va=e=>e?e.some(t=>t.type==="livecrawling"):!1;var En=({total:e,current:t,pageSize:r,maxPage:o=0,sx:a,paginationProps:n,onChange:s,onPageSizeChange:l})=>{if(!e||!t&&t!==0||!r)return null;let i=Number(e),p=Number(t),m=Number(r),g=Number(o),d=()=>g&&p>g?g:p,f=(L,v)=>{s&&s(L,v)},T=L=>{let v=L.target?.value;l&&l(Number(v)),s&&s(null,0)};return nr.default.createElement("div",null,i>m?nr.default.createElement(c,{direction:"row",sx:{justifyContent:"center",px:2,pt:4,...a}},nr.default.createElement(ra,{component:"div",sx:{[`& > .${_t.toolbar}`]:{pl:0,boxSizing:"border-box"},[`& .${_t.select}`]:{height:"24px",lineHeight:"24px",fontSize:"16px"},[`& .${_t.selectLabel}`]:{fontSize:"14px"},[`& .${_t.actions}`]:{display:"flex"},[`& .${_t.displayedRows}`]:{fontSize:"14px"},[`& .${Ca.svgIconClasses.root}`]:{fontSize:"24px"}},count:i,page:d(),rowsPerPage:m,onPageChange:f,onRowsPerPageChange:T,SelectProps:{MenuProps:{container:Pa()}},...n})):null)},Ta=En;var An=()=>{let{t:e}=P(["prompt_library"]),{activeTab:t,promptLibraryListParameters:r,updatePromptLibraryListParameters:o}=K(),a=(0,sr.useMemo)(()=>({labelRowsPerPage:e("prompt_library:pagination__label_rows_per_page__title"),rowsPerPageOptions:[8,12,16,20]}),[e]);return t!=="Public"?null:sr.default.createElement(Ta,{total:r.total,current:r.page,pageSize:r.page_size,sx:{justifyContent:"flex-end",pt:0,px:0},paginationProps:a,onChange:(n,s)=>{o({page:s})},onPageSizeChange:n=>{o({page_size:n})}})},lr=An;var wn=()=>{let{t:e}=P(["prompt_library"]),{activeTab:t,promptLibraryListParameters:r}=K();return Oe.default.createElement(c,{width:"100%",gap:2,position:"sticky",top:0},Oe.default.createElement(Kt,{loading:!r.enabled},Oe.default.createElement(_,{fontSize:"24px",lineHeight:"28px",fontWeight:800,color:"text.primary",textAlign:"center"},e("prompt_library:use_prompt_library__title")),Oe.default.createElement(_a,null),t==="Public"&&Oe.default.createElement(c,{alignItems:"center",direction:"row",gap:2,justifyContent:"space-between",flexWrap:"wrap"},Oe.default.createElement(ya,null),Oe.default.createElement(Sa,null)),Oe.default.createElement(lr,null)))},Ia=wn;var ae=u(h());var Mn=()=>Ce({queryKey:[D.GET_FAVOURITE_PROMPTS],queryFn:Y.getFavouritePrompts}),Pt=Mn;var kn=()=>{let{promptLibraryListParameters:e,updatePromptLibraryListParameters:t}=K(),{enabled:r,use_case:o,category:a,page:n,page_size:s,query:l}=e;return Ce({queryKey:[D.SEARCH_PROMPT,a,o,l,n,s],queryFn:async()=>{let i=await Y.getPublicPrompts(e);if(i?.data)return t({total:i.total}),i.data;throw new Error("Network error. Please try again.")},placeholderData:mo,enabled:r})},La=kn;var Aa=u(h());var On=()=>Ce({queryKey:[D.GET_OWN_PROMPTS],queryFn:Y.getOwnPrompts}),Ea=On;var Dn=()=>{let{activeTab:e}=K(),t=Pt(),r=La(),o=Ea();return(0,Aa.useMemo)(()=>e==="Favorites"?t:e==="Own"?o:r,[e,r,t])},pr=Dn;var qa=u(nn()),Ka=u(ln());var gr=u(fo()),Ya=u(rn()),O=u(h());var mr=u(h()),Bn=e=>{let{href:t,underline:r="none",...o}=e,a=(0,mr.useRef)(null);return mr.default.createElement(gt,{target:"_blank",ref:a,href:t??"#",component:"a",underline:r,...o})},wa=Bn;var se=u(h());var Va=u(Nt());function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},De.apply(this,arguments)}function Nr(e,t){if(e==null)return{};var r={},o=Object.keys(e),a,n;for(n=0;n<o.length;n++)a=o[n],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}var Oa=u(h());function vt(e,t,r=void 0){let o={};return Object.keys(e).forEach(a=>{o[a]=e[a].reduce((n,s)=>{if(s){let l=t(s);l!==""&&n.push(l),r&&r[s]&&n.push(r[s])}return n},[]).join(" ")}),o}var ot=u(on());var Ma=u(tn());function ka(e){return(0,Ma.default)("MuiLoadingButton",e)}var Fn=(0,aa.unstable_generateUtilityClasses)("MuiLoadingButton",["root","loading","loadingIndicator","loadingIndicatorCenter","loadingIndicatorStart","loadingIndicatorEnd","endIconLoadingEnd","startIconLoadingStart"]),Ae=Fn;var Hr=u(ke()),Da=u(ke()),Vn=["children","disabled","id","loading","loadingIndicator","loadingPosition","variant"],Nn=e=>{let{loading:t,loadingPosition:r,classes:o}=e,a={root:["root",t&&"loading"],startIcon:[t&&`startIconLoading${(0,ot.capitalize)(r)}`],endIcon:[t&&`endIconLoading${(0,ot.capitalize)(r)}`],loadingIndicator:["loadingIndicator",t&&`loadingIndicator${(0,ot.capitalize)(r)}`]},n=vt(a,ka,o);return De({},o,n)},Hn=e=>e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"&&e!=="classes",zn=wr(G,{shouldForwardProp:e=>Hn(e)||e==="classes",name:"MuiLoadingButton",slot:"Root",overridesResolver:(e,t)=>[t.root,t.startIconLoadingStart&&{[`& .${Ae.startIconLoadingStart}`]:t.startIconLoadingStart},t.endIconLoadingEnd&&{[`& .${Ae.endIconLoadingEnd}`]:t.endIconLoadingEnd}]})(({ownerState:e,theme:t})=>De({[`& .${Ae.startIconLoadingStart}, & .${Ae.endIconLoadingEnd}`]:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0}},e.loadingPosition==="center"&&{transition:t.transitions.create(["background-color","box-shadow","border-color"],{duration:t.transitions.duration.short}),[`&.${Ae.loading}`]:{color:"transparent"}},e.loadingPosition==="start"&&e.fullWidth&&{[`& .${Ae.startIconLoadingStart}, & .${Ae.endIconLoadingEnd}`]:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0,marginRight:-8}},e.loadingPosition==="end"&&e.fullWidth&&{[`& .${Ae.startIconLoadingStart}, & .${Ae.endIconLoadingEnd}`]:{transition:t.transitions.create(["opacity"],{duration:t.transitions.duration.short}),opacity:0,marginLeft:-8}})),Gn=wr("span",{name:"MuiLoadingButton",slot:"LoadingIndicator",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.loadingIndicator,t[`loadingIndicator${(0,ot.capitalize)(r.loadingPosition)}`]]}})(({theme:e,ownerState:t})=>De({position:"absolute",visibility:"visible",display:"flex"},t.loadingPosition==="start"&&(t.variant==="outlined"||t.variant==="contained")&&{left:t.size==="small"?10:14},t.loadingPosition==="start"&&t.variant==="text"&&{left:6},t.loadingPosition==="center"&&{left:"50%",transform:"translate(-50%)",color:(e.vars||e).palette.action.disabled},t.loadingPosition==="end"&&(t.variant==="outlined"||t.variant==="contained")&&{right:t.size==="small"?10:14},t.loadingPosition==="end"&&t.variant==="text"&&{right:6},t.loadingPosition==="start"&&t.fullWidth&&{position:"relative",left:-10},t.loadingPosition==="end"&&t.fullWidth&&{position:"relative",right:-10})),Wn=Oa.forwardRef(function(t,r){let o=lo({props:t,name:"MuiLoadingButton"}),{children:a,disabled:n=!1,id:s,loading:l=!1,loadingIndicator:i,loadingPosition:p="center",variant:m="text"}=o,g=Nr(o,Vn),d=(0,ot.unstable_useId)(s),f=i??(0,Hr.jsx)(Ie,{"aria-labelledby":d,color:"inherit",size:16}),T=De({},o,{disabled:n,loading:l,loadingIndicator:f,loadingPosition:p,variant:m}),L=Nn(T),v=l?(0,Hr.jsx)(Gn,{className:L.loadingIndicator,ownerState:T,children:f}):null;return(0,Da.jsxs)(zn,De({disabled:n||l,id:d,ref:r},g,{variant:m,classes:L,ownerState:T,children:[T.loadingPosition==="end"?a:v,T.loadingPosition==="end"?v:a]}))}),at=Wn;var Ue=u(h());var Ba=u(Vo());var Be=u(h()),Un=({children:e,show:t=!1,sx:r,onClose:o,bgTransparent:a=!1,maxWidth:n,width:s,height:l,...i})=>Be.default.createElement(Rt,{open:t,onClose:(m,g)=>{o&&o(g)},disablePortal:!0,...i},Be.default.createElement(Be.default.Fragment,null,Be.default.createElement(Ut,{in:t},Be.default.createElement(Te,{id:"mui-modal",sx:[{width:s??"90vw",height:l??"90vh",maxWidth:n??"lg",margin:"5vh auto",overflowY:"auto","&:focus-visible":{outline:"none"},bgcolor:m=>m.palette.mode==="dark"?(0,po.lighten)(m.palette.background.paper,.1):"pageBackground",...r,tabIndex:"100"},a&&{bgcolor:"transparent",boxShadow:"none"}]},Be.default.createElement(M,{sx:{position:"fixed",top:16,left:16}},Be.default.createElement(ne,{onClick:()=>{o&&o("closeBtn")},sx:{color:"white",bgcolor:"#616161","&:hover":{bgcolor:"#7e7e7e"}}},Be.default.createElement(Ba.default,null))),e)))),ur=Un;var Rn=({show:e,loading:t,onCancel:r,onConfirm:o})=>{let{t:a}=P(["prompt_library"]);return Ue.default.createElement(ur,{show:e,width:400,bgTransparent:!0,onClose:r,sx:{height:"auto",my:"40vh"}},Ue.default.createElement(Te,{sx:{p:2,height:"max-content"},elevation:0},Ue.default.createElement(c,{spacing:2},Ue.default.createElement(_,null,a("prompt_library:delete_prompt__title")),Ue.default.createElement(c,{direction:"row",spacing:1,justifyContent:"flex-end"},Ue.default.createElement(at,{loading:t,variant:"secondary",onClick:n=>{n.stopPropagation(),n.preventDefault(),o?.()}},a("prompt_library:delete_prompt__action__confirm__title")),Ue.default.createElement(G,{variant:"contained",type:"submit",onClick:n=>{n.stopPropagation(),n.preventDefault(),r?.()}},a("prompt_library:delete_prompt__cancel__confirm__title"))))))},Fa=Rn;var jn=()=>{let[e,t]=Ve(ar),r=uo(),o=m=>{t(g=>({...g,editPromptId:m||Qe()}))},a=()=>{t(m=>({...m,editPromptId:""}))},n=ft({mutationFn:Y.addFavoritePrompt,onSuccess:async()=>{await r.refetchQueries({queryKey:[D.GET_FAVOURITE_PROMPTS]})}}),s=ft({mutationFn:Y.removeFavoritePrompt,onSuccess:async()=>{await r.refetchQueries({queryKey:[D.GET_FAVOURITE_PROMPTS]})}}),l=ft({mutationFn:Y.addPrivatePrompt,onSuccess:()=>{rt.success("Add prompt success"),r.refetchQueries({queryKey:[D.GET_OWN_PROMPTS]})},onError:async m=>{let d=(await m?.json?.()||{})?.detail||"";d.includes("too long")&&(d="The template is too long. Please shorten it."),rt.error(d||"Add prompt failed, please try again later")}}),i=ft({mutationFn:Y.editPrivatePrompt,onSuccess:()=>{rt.success("Add prompt success"),r.refetchQueries({queryKey:[D.GET_OWN_PROMPTS]})},onError:async m=>{let d=(await m?.json?.()||{})?.detail||"";d.includes("too long")&&(d="The template is too long. Please shorten it."),rt.error(d||"Add prompt failed, please try again later")}}),p=ft({mutationFn:Y.deletePrivatePrompt,onSuccess:()=>{rt.success("Delete prompt success"),r.refetchQueries({queryKey:[D.GET_OWN_PROMPTS]})},onError:async m=>{let d=(await m?.json?.()||{})?.detail||"";rt.error(d||"Delete prompt failed, please try again later")}});return{editPromptId:e.editPromptId,isOpenPromptLibraryEditForm:e.editPromptId!=="",openPromptLibraryEditForm:o,closePromptLibraryEditForm:a,addFavoritePromptMutation:n,removeFavoritePromptMutation:s,addPromptLibraryCardMutation:l,editPromptLibraryCardMutation:i,deletePromptLibraryCardMutation:p}},_e=jn;var qn=e=>se.default.createElement(Va.default,{viewBox:"0 0 20 20",sx:e.sx},se.default.createElement("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},se.default.createElement("path",{d:"M4.66699 14C4.30033 14 3.98644 13.8694 3.72533 13.6083C3.46421 13.3472 3.33366 13.0333 3.33366 12.6667V4H2.66699V2.66667H6.00033V2H10.0003V2.66667H13.3337V4H12.667V12.6667C12.667 13.0333 12.5364 13.3472 12.2753 13.6083C12.0142 13.8694 11.7003 14 11.3337 14H4.66699ZM11.3337 4H4.66699V12.6667H11.3337V4ZM6.00033 11.3333H7.33366V5.33333H6.00033V11.3333ZM8.66699 11.3333H10.0003V5.33333H8.66699V11.3333Z",fill:"currentColor"}))),zr=({promptId:e,promptTitle:t})=>{let{deletePromptLibraryCardMutation:r,removeFavoritePromptMutation:o}=_e(),[a,n]=(0,se.useState)(!1),{data:s}=Pt(),l=(0,se.useMemo)(()=>(s||[]).map(m=>m.id),[s]),i=(0,se.useMemo)(()=>l.includes(e),[l,e]),p=async()=>{r.mutate(e),i&&o.mutate(e),n(!1)};return se.default.createElement(se.default.Fragment,null,se.default.createElement(ue,{title:"Delete Prompt"},se.default.createElement(ne,{size:"small",onClick:m=>{m.stopPropagation(),n(!0)}},r.isPending||o.isPending?se.default.createElement(Ie,{size:16,sx:{m:"0 auto"}}):se.default.createElement(qn,{sx:{fontSize:16}}))),se.default.createElement(Fa,{promptTitle:t,loading:r.isPending,show:a,onConfirm:p,onCancel:()=>{n(!1)}}))};var it=u(h());var Na=u(Nt()),Kn=e=>it.default.createElement(Na.default,{viewBox:"0 0 20 20",sx:e.sx},it.default.createElement("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},it.default.createElement("path",{d:"M3.33333 13.8C2.96667 13.8 2.65278 13.6695 2.39167 13.4084C2.13056 13.1473 2 12.8334 2 12.4667V3.13337C2 2.7667 2.13056 2.45281 2.39167 2.1917C2.65278 1.93059 2.96667 1.80003 3.33333 1.80003H9.28333L7.95 3.13337H3.33333V12.4667H12.6667V7.83337L14 6.50003V12.4667C14 12.8334 13.8694 13.1473 13.6083 13.4084C13.3472 13.6695 13.0333 13.8 12.6667 13.8H3.33333ZM10.7833 2.18337L11.7333 3.1167L7.33333 7.5167V8.4667H8.26667L12.6833 4.05003L13.6333 4.98337L8.83333 9.80003H6V6.9667L10.7833 2.18337ZM13.6333 4.98337L10.7833 2.18337L12.45 0.516699C12.7167 0.250033 13.0361 0.116699 13.4083 0.116699C13.7806 0.116699 14.0944 0.250033 14.35 0.516699L15.2833 1.4667C15.5389 1.72225 15.6667 2.03337 15.6667 2.40003C15.6667 2.7667 15.5389 3.07781 15.2833 3.33337L13.6333 4.98337Z",fill:"currentColor"}))),Gr=({onClick:e})=>it.default.createElement(ue,{title:"Edit Prompt"},it.default.createElement(ne,{size:"small",onClick:t=>{t.stopPropagation(),e&&e()}},it.default.createElement(Kn,{sx:{fontSize:16}})));var za=u(sn()),Ga=u(Ha()),ce=u(h());var Wr=({promptId:e})=>{let{addFavoritePromptMutation:t,removeFavoritePromptMutation:r}=_e(),{data:o}=Pt(),a=(0,ce.useMemo)(()=>(o||[]).map(m=>m.id),[o]),n=(0,ce.useMemo)(()=>a.includes(e),[a,e]),s=(0,ce.useMemo)(()=>({fontSize:16}),[]),l=(0,ce.useMemo)(()=>n?ce.default.createElement(Ga.default,{sx:s}):ce.default.createElement(za.default,{sx:s}),[n,s]),i=(0,ce.useMemo)(()=>n?"Remove from Favorites":"Add to Favorites",[n]),p=ce.default.createElement(ne,{size:"small",onClick:async m=>{m.stopPropagation(),n?r.mutate(e):t.mutate(e)}},t.isPending||r.isPending?ce.default.createElement(Ie,{size:16}):ce.default.createElement(ue,{title:i},l));return ce.default.createElement(ce.default.Fragment,null,p)};var Ua=u(Wa());var fr=u(h()),Ur=({detailLink:e})=>fr.default.createElement(ue,{title:"View prompt details"},fr.default.createElement(ne,{size:"small",onClick:t=>{t.stopPropagation(),window.open(e)}},fr.default.createElement(Ua.default,{sx:{fontSize:16}})));var $a=u(pn());var oe=u(h()),rs=({tip:e,sx:t,children:r,lineClamp:o=3,resizeListener:a=!1,...n})=>{let s=(0,oe.useRef)(null),l=(0,oe.useRef)(null),[i,p]=(0,oe.useState)(!1),[m,g]=(0,oe.useState)(!0),d=(0,oe.useMemo)(()=>e??r,[r,e]),f=(0,oe.useCallback)(()=>{if(l.current){let T=l.current;g(T.offsetHeight>=T.scrollHeight)}},[l]);return(0,oe.useEffect)(()=>{i&&f()},[i,f]),(0,oe.useEffect)(()=>{r&&!i&&p(!0)},[r,i]),(0,oe.useEffect)(()=>{if(i&&a){let T=()=>f();s.current=new ResizeObserver(T),l.current&&s.current.observe(l.current)}return()=>{s.current?.disconnect()}},[i,a,f,l]),oe.default.createElement(ue,{title:m?"":d},oe.default.createElement(_,{ref:l,sx:{MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:`${o}`,lineClamp:`${o}`,boxOrient:"vertical",display:"-webkit-box",overflow:"hidden",textOverflow:"ellipsis",...t},...n},r))},Rr=rs;var Ct=u(h());var Ra={websearch:"Web Search",livecrawling:"Live Crawling"},os={websearch:{bgcolor:e=>e.palette.mode==="dark"?"rgba(178, 115, 255, 0.16)":"rgba(118, 1, 211, 0.08)",color:"primary.main"},livecrawling:{bgcolor:e=>e.palette.mode==="dark"?"rgba(178, 115, 255, 0.16)":"rgba(118, 1, 211, 0.08)",color:"primary.main"}},as=({typeList:e,variables:t})=>{let r=(0,Ct.useMemo)(()=>e?e?.filter(o=>Ra[o])||[]:va(t)?["livecrawling"]:[],[e,t]);return Ct.default.createElement(Ct.default.Fragment,null,r.map(o=>Ct.default.createElement(_,{key:o,component:"span",sx:a=>({fontSize:14,color:"primary.main",bgcolor:a.palette.mode==="dark"?"rgba(178, 115, 255, 0.16)":"rgba(118, 1, 211, 0.08)",px:.5,mr:1,borderRadius:1,...os[o]})},Ra[o])))},ja=as;var is=()=>{let[e,t]=Ve(ar),{updatePromptLibraryListParameters:r}=K(),o=i=>{r({...i,enabled:!0})},a=()=>{t(i=>({...i,open:!0}))},n=()=>{t(i=>({...i,open:!1}))},s=i=>{t(p=>({...p,selectedPromptLibraryCard:i}))},l=()=>t(i=>({...i,selectedPromptLibraryCard:null}));return{selectedPromptLibraryCard:e.selectedPromptLibraryCard,selectPromptLibraryCard:s,cancelSelectPromptLibraryCard:l,promptLibrary:e,promptLibraryOpen:e.open,openPromptLibrary:a,closePromptLibrary:n,initPromptLibrary:o}},Tt=is;gr.default.extend($a.default);gr.default.extend(Ya.default);var ns=({prompt:e,actionButton:t=["see","favorite"],onClick:r})=>{let{openPromptLibraryEditForm:o}=_e(),{selectedPromptLibraryCard:a,selectPromptLibraryCard:n,cancelSelectPromptLibraryCard:s}=Tt(),l=a?.id===e.id,i=(0,O.useMemo)(()=>e.type==="private"?`${Ar}/prompts/own/${e.id}`:`${Ar}/prompts/${e.id}`,[e]),p=()=>{let d=[];return t.includes("see")&&d.push(O.default.createElement(Ur,{key:"see",detailLink:i})),t.includes("delete")&&d.push(O.default.createElement(zr,{key:"delete",promptId:e.id,promptTitle:e.prompt_title})),t.includes("edit")&&d.push(O.default.createElement(Gr,{key:"edit",onClick:()=>{o(e.id)}})),t.includes("favorite")&&d.push(O.default.createElement(Wr,{key:"favorite",promptId:e.id})),d},m=(0,O.useMemo)(()=>e?.author_url||Fr,[e.author_url]),g=(0,O.useMemo)(()=>m!==Fr&&!e?.author?m:e?.author||ga,[e?.author,m]);return O.default.createElement(c,{p:2,spacing:1.5,onClick:()=>{l?(s(),r?.()):(n(e),r?.(e))},sx:d=>{let f=d.palette.mode==="dark";return{textAlign:"left",position:"relative",color:"text.primary",border:"1px solid",cursor:"pointer",borderRadius:"4px",transition:"all 0.2s ease-in-out",height:"calc(100% - 16px - 16px)",borderColor:f?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",bgcolor:l?f?"#202123":"rgba(0, 0, 0, 0.04)":f?"#3E3F4C":"#fff","&:hover":{boxShadow:`0px 4px 8px ${f?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.16)"}`}}}},O.default.createElement(c,{direction:"row",spacing:1.5,justifyContent:"space-between"},O.default.createElement(Rr,{tip:e.prompt_title,color:"text.secondary",fontSize:16,sx:{fontSize:"20px",lineHeight:"24px",whiteSpace:"normal",wordBreak:"break-word",fontWeight:700,minHeight:"72px"}},e.prompt_title),O.default.createElement(_,{variant:"body1",sx:{}}),O.default.createElement(c,{direction:"row",fontSize:16,height:"max-content"},p())),O.default.createElement(c,{direction:"row",alignItems:"center",spacing:1},O.default.createElement(ss,{tag:`${e.category}${e.use_case?` / ${e.use_case}`:""}`})),O.default.createElement(c,{direction:"row",alignItems:"center",spacing:.5,sx:d=>({fontSize:12,color:d.palette.mode==="dark"?"rgba(255, 255, 255, 0.6)":"rgba(0, 0, 0, 0.6)"})},e?.type==="private"?O.default.createElement(Ka.default,{fontSize:"inherit"}):O.default.createElement(qa.default,{fontSize:"inherit"}),O.default.createElement(_,{variant:"caption",fontSize:12},"\xB7"),O.default.createElement(wa,{href:m,underline:"always",sx:{color:"inherit"},onClick:d=>{d.stopPropagation()}},g),e.update_time&&O.default.createElement("span",null,O.default.createElement(_,{variant:"caption",fontSize:12},"\xB7"),O.default.createElement(_,{variant:"caption",fontSize:12},gr.default.utc(e.update_time).fromNow()))),O.default.createElement(Rr,{tip:e.teaser,color:"text.secondary",fontSize:16,sx:{lineHeight:"20px",whiteSpace:"normal",wordBreak:"break-word",minHeight:60}},O.default.createElement(ja,{typeList:e.variable_types,variables:e.variables}),e.teaser))},ss=e=>{let{tag:t}=e;return O.default.createElement(M,null,O.default.createElement(_,{sx:r=>{let o=r.palette.mode==="dark";return{borderRadius:"4px",display:"inline-flex",bgcolor:o?"rgba(255, 255, 255, 0.16)":"rgb(235,235,235)",color:o?"#fff":"text.secondary",fontSize:"14px",lineHeight:"20px",px:.5}}},t))},Qa=ns;var ye=u(h());var ls=e=>{let{actionKeys:t}=e;return ye.default.createElement(c,{p:2,spacing:1.5,onClick:()=>{},sx:r=>{let o=r.palette.mode==="dark";return{position:"relative",color:"text.primary",border:"1px solid",cursor:"pointer",borderRadius:"4px",transition:"all 0.2s ease-in-out",height:"calc(100% - 16px - 16px)",borderColor:o?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",bgcolor:o?"#3E3F4C":"#fff","&:hover":{boxShadow:`0px 4px 8px ${o?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.16)"}`}}}},ye.default.createElement(c,{direction:"row",spacing:1.5,justifyContent:"space-between"},ye.default.createElement(Ge,{variant:"rectangular",width:0,height:72,sx:{borderRadius:"4px",flex:1}}),ye.default.createElement(c,{direction:"row",fontSize:16,height:"max-content",spacing:.5},t.map(r=>ye.default.createElement(Ge,{variant:"rounded",width:24,height:24,key:r})))),ye.default.createElement(Ge,{variant:"rectangular",width:"60%",height:20,sx:{borderRadius:"4px"}}),ye.default.createElement(Ge,{variant:"rectangular",width:"33.3%",height:20,sx:{borderRadius:"4px"}}),ye.default.createElement(c,{gap:.5},ye.default.createElement(Ge,{variant:"rectangular",width:"100%",height:17.33,sx:{borderRadius:"4px"}}),ye.default.createElement(Ge,{variant:"rectangular",width:"100%",height:17.33,sx:{borderRadius:"4px"}}),ye.default.createElement(Ge,{variant:"rectangular",width:"100%",height:17.33,sx:{borderRadius:"4px"}})))},Xa=ls;var Za=u(Ja());var Dt=u(h());var ds=()=>{let{t:e}=P(["prompt_library"]),{openPromptLibraryEditForm:t}=_e();return Dt.default.createElement(c,{p:2,spacing:2,onClick:()=>{t("NEW_PROMPT")},sx:r=>{let o=r.palette.mode==="dark";return{color:"text.primary",border:"1px solid",borderColor:o?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.08)",cursor:"pointer",borderRadius:"4px",transition:"all 0.2s ease-in-out",alignItems:"center",justifyContent:"center",minHeight:160,height:"calc(100% - 16px - 16px)",userSelect:"none",bgcolor:o?"#3E3F4C":"#fff","&:hover":{boxShadow:`0px 4px 8px ${o?"rgba(255, 255, 255, 0.08)":"rgba(0, 0, 0, 0.16)"}`}}}},Dt.default.createElement(c,{direction:"row",alignItems:"center",spacing:1,color:"inherit"},Dt.default.createElement(Za.default,{sx:{fontSize:20}}),Dt.default.createElement(_,{fontSize:16},e("prompt_library:add_new_prompt_card__cta__title"))))},ei=ds;var fs=e=>{let{onClick:t}=e,{data:r,isLoading:o}=pr(),{activeTab:a,promptLibraryListParameters:n}=K(),s=Ee(),l=(0,ae.useMemo)(()=>s==="xs"?12:s==="sm"?6:s==="md"?4:s==="lg"||s==="xl"?3:6,[s]),i=(0,ae.useMemo)(()=>a==="Own"?["see","delete","edit","favorite"]:a==="Favorites"?["see","favorite"]:["see","favorite"],[a]),p=(0,ae.useMemo)(()=>o?new Array(n.page_size).fill(1).map((m,g)=>ae.default.createElement(pe,{key:g,item:!0,xs:l},ae.default.createElement(Xa,{actionKeys:i}))):r?ae.default.createElement(ae.default.Fragment,null,r.map(m=>ae.default.createElement(pe,{key:m.id,item:!0,xs:l},ae.default.createElement(Qa,{actionButton:i,prompt:m,onClick:t})))):null,[o,r,a,i,n.page_size,t,l]);return ae.default.createElement(c,{spacing:0,mb:0,height:0,flex:1,width:"100%",sx:{overflowY:"auto"}},ae.default.createElement(pe,{container:!0,spacing:2},a==="Own"&&ae.default.createElement(pe,{item:!0,xs:l},ae.default.createElement(ei,null)),p,ae.default.createElement(pe,{item:!0,xs:12},ae.default.createElement(lr,null))))},ti=fs;var nt=u(h());var gs=e=>{let[t,r]=(0,nt.useState)(0);return(0,nt.useEffect)(()=>{let o=null;return e?(r(10),o=setInterval(()=>{r(a=>{let n=a+10;return n>=100?100:n})},50)):r(0),()=>{o&&clearInterval(o)}},[e]),t},bs=e=>{let{sx:t}=e,{isFetching:r,isLoading:o}=pr(),a=gs(r);return nt.default.createElement(c,{sx:{position:"absolute",top:0,left:0,width:"100%",...t}},!o&&r&&nt.default.createElement(Zo,{sx:{[`&.${Jo.root}`]:{backgroundColor:"transparent"}},variant:"determinate",value:a}))},ri=bs;var b=u(h());var st=u(h());var hs=e=>{let{defaultValue:t,label:r,name:o,control:a,disabled:n,rules:s,FormControlProps:l,SelectProps:i,MenuItemProps:p,children:m,options:g}=e,d=`${o}-label`;return st.default.createElement(He,{...l},st.default.createElement(ze,{id:d},st.default.createElement(_,{variant:"body1"},r)),st.default.createElement(yt,{name:o,control:a,disabled:n,rules:s,render:({field:f,fieldState:T,formState:L})=>{let{onChange:v,...j}=i||{};return st.default.createElement(Eo,{ref:f.ref,disabled:n,value:f.value||t,onChange:(N,X)=>{f.onChange(N),v?.(N,X)},...j},g?g.map(N=>st.default.createElement(Io,{key:N.value,value:N.value,sx:{...p}},N.label)):m)}}))},jr=hs;var _s=(e,t)=>Ce({queryKey:[D.GET_PROMPT_DETAIL,e,t],queryFn:async()=>e==="NEW_PROMPT"?{id:"",prompt_template:"",teaser:"",prompt_hint:"",prompt_title:"",category:"Other",use_case:"Other",type:"private",author:"",author_url:"",variables:[]}:await(t==="private"?Y.getPrivatePromptDetail(e):Y.getPublicPromptDetail(e)),enabled:e!==""}),oi=_s;var hr=e=>{let t=[],r=e.prompt_template||"",o=new Map,a=[],n=[],s=!1;e.variables?.forEach(i=>{let p={VariableName:i.name,label:i.name,placeholder:i.hint,valueType:"Text",systemVariable:i.isSystemVariable};i.type==="text"&&a.push(p),o.set(p.VariableName,p)});let l=[];if(o.get("System Current Date")&&(l.push({type:"DATE",parameters:{DateActionMode:"Current Date",DateFormatStyle:"YYYY-MM-DD HH:mm:ss"}}),l.push({type:"SET_VARIABLE",parameters:{VariableName:"SYSTEM_CURRENT_DATE"}})),e.variable_types?.includes("livecrawling")&&(n.push(tr.LIVE_CRAWLING_TARGET_URL),r=r.replaceAll("{{Live Crawling Target URL}}","{{LIVE_CRAWLING_TARGET_URL}}"),r=r.replaceAll("{{Live Crawling Crawled Text}}","{{LIVE_CRAWLING_CRAWLED_TEXT}}"),l.push({type:"GET_CONTENTS_OF_URL",parameters:{URLActionURL:"{{LIVE_CRAWLING_TARGET_URL}}"}}),l.push({type:"SET_VARIABLE",parameters:{VariableName:"LIVE_CRAWLING_CRAWLED_TEXT"}})),e.variable_types?.includes("websearch")){r=r.replaceAll("{{Web Search Query}}","{{WEB_SEARCH_QUERY}}"),r=r.replaceAll("{{Web Search Results}}","{{WEB_SEARCH_RESULTS}}"),s=!0,n.push(tr.WEB_SEARCH_QUERY);let i=[{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",text:"",originalMessage:{metadata:{shareType:"search",title:{title:"{{WEB_SEARCH_QUERY}}"},copilot:{title:{title:"Quick search",titleIcon:"Bolt",titleIconSize:24},steps:[{title:"Searching web",status:"loading",icon:"Search"}]}},include_history:!1}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"GET_CONTENTS_OF_SEARCH_ENGINE",parameters:{URLSearchEngine:"google",URLSearchEngineParams:{q:"{{WEB_SEARCH_QUERY}}",region:"",limit:"6",btf:"",nojs:"1",ei:"UTF-8",site:"",csp:"1"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SEARCH_SOURCES"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Searching web",status:"complete",icon:"Search",valueType:"tags",value:"{{WEB_SEARCH_QUERY}}"}]},sources:{status:"complete",links:"{{SEARCH_SOURCES}}"}}}}}},{type:"RENDER_TEMPLATE",parameters:{template:"{{SEARCH_SOURCES}}"}},{type:"WEBGPT_SEARCH_RESULTS_EXPAND",parameters:{SummarizeActionType:"NO_SUMMARIZE"}},{type:"SET_VARIABLE",parameters:{VariableName:"WEB_SEARCH_RESULTS"}}];l.push(...i)}return a.length>0||n.filter(i=>i.valueType!=="Select").length>0?(r=r.replaceAll("{{TARGET_LANGUAGE}}","{{AI_RESPONSE_LANGUAGE}}"),r=r.replaceAll("{{TONE}}","{{AI_RESPONSE_TONE}}"),r=r.replaceAll("{{WRITTINGSTYLE}}","{{AI_RESPONSE_WRITING_STYLE}}"),o.get("AI_RESPONSE_LANGUAGE")||n.push({VariableName:"AI_RESPONSE_LANGUAGE",defaultValue:"English",systemVariable:!0,valueType:"Select",label:"AI Response language"}),o.get("AI_RESPONSE_TONE")||n.push({VariableName:"AI_RESPONSE_TONE",defaultValue:"Default",systemVariable:!0,valueType:"Select",label:"Tone"}),o.get("AI_RESPONSE_WRITING_STYLE")||n.push({VariableName:"AI_RESPONSE_WRITING_STYLE",defaultValue:"Default",systemVariable:!0,valueType:"Select",label:"Writing style"}),t.push({type:"SET_VARIABLES_MODAL",parameters:{SetVariablesModalConfig:{template:r,contextMenuId:Qe(),title:e.prompt_title,modelKey:"Sidebar",variables:a,systemVariables:n,actions:l,answerInsertMessageId:s?"{{AI_RESPONSE_MESSAGE_ID}}":""}}})):(t.push(...l),t.push({type:"ASK_CHATGPT",parameters:{template:r}})),t},_r=(e,t)=>{let r="",o=["RENDER_TEMPLATE","ASK_CHATGPT","RENDER_CHATGPT_PROMPT","SET_VARIABLES_MODAL"];for(let i=e.length-1;i>=0;i--){let p=e[i];o.includes(p.type)&&(p.parameters.template?r=p.parameters.template:p.parameters.SetVariablesModalConfig?.template&&(r=p.parameters.SetVariablesModalConfig.template))}let a=new Map;Object.values(tr).forEach(i=>{r.indexOf(i.VariableName)>-1&&a.set(i.VariableName,i)}),e.forEach(i=>{i.parameters.SetVariablesModalConfig?.variables&&i.parameters.SetVariablesModalConfig.variables.forEach(p=>{a.set(p.VariableName,Vt([a.get(p.VariableName),p]))}),i.parameters.SetVariablesModalConfig?.systemVariables&&i.parameters.SetVariablesModalConfig.systemVariables.forEach(p=>{a.set(p.VariableName,Vt([a.get(p.VariableName),p]))})});let n=Array.from(a.values()).filter(i=>!i.systemVariable).map(i=>i.label?(r=r.replaceAll(`{{${i.VariableName}}`,`{{${i.label}}`),{name:i.label,hint:i.placeholder,type:"text"}):{name:i.VariableName,hint:i.placeholder,type:"text"}),s=[];return a.get("SYSTEM_CURRENT_DATE")&&(s.push("system"),n.push({hint:"This variable will be automatically updated with the current date",name:"System Current Date",type:"system"})),a.get("SELECTED_TEXT")&&n.push({hint:"The text you selected on the current page",name:"SELECTED_TEXT",type:"text"}),(a.get("LIVE_CRAWLING_TARGET_URL")||a.get("LIVE_CRAWLING_CRAWLED_TEXT"))&&(s.push("livecrawling"),n.push({hint:"Enter the URL you wish to extract text from",name:"Live Crawling Target URL",type:"livecrawling"}),n.push({hint:"This variable will be automatically updated with text extracted from the target URL",name:"Live Crawling Crawled Text",type:"livecrawling"})),(a.get("WEB_SEARCH_QUERY")||a.get("WEB_SEARCH_RESULTS"))&&(s.push("livecrawling"),n.push({hint:"Enter your search term",name:"Web Search Query",type:"websearch"}),n.push({hint:"This variable will be automatically updated with the search results",name:"Web Search Results",type:"websearch"})),Vt([{author:"",author_url:"",category:"Other",favourite_cnt:0,id:"",optional_prompt_template:"Please write in {{TONE}} tone, {{WRITTINGSTYLE}} writing style, using {{TARGET_LANGUAGE}}.",prompt_hint:"",prompt_template:r,prompt_title:"",teaser:"",type:"private",update_time:"",use_case:"Other",user_input:"{'target_language': {'type': 'option', 'default': 'English'}, 'prompt': {'type': 'string', 'default': ''}, 'tone': {'type': 'optional_type', 'default': ''}, 'writing_style': {'type': 'optional_type', 'default': ''}}",variable_types:[],variables:[]},t,{prompt_template:r,variable_types:s,variables:n}])};var lt=u(h());var ys=({open:e,confirmText:t,confirmButtonText:r,cancelButtonText:o,onClose:a,onConfirm:n,children:s})=>{let{t:l}=P(["settings","common"]),i=()=>{n&&n()};return lt.default.createElement(Rt,{open:e,onClose:a},lt.default.createElement(Te,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:360,bgcolor:"background.paper",boxShadow:" 0px 4px 16px rgba(0, 0, 0, 0.08);",p:2}},s||lt.default.createElement(_,null,t),lt.default.createElement(c,{direction:"row-reverse",gap:1,mt:2},lt.default.createElement(G,{variant:"contained",onClick:a},o??l("common:cancel")),lt.default.createElement(G,{variant:"contained",sx:{bgcolor:p=>p.palette.mode==="dark"?"#4f4f4f":"#f5f5f5",color:p=>p.palette.mode==="dark"?"#f5f5f5":"#626262",":hover":{bgcolor:"#666",color:"#fff"}},onClick:i},r??l("common:confirm")))))},ai=ys;var It={sx:{fontSize:"16px !important"}},xs={sx:{fontSize:"16px !important"}},Ss=e=>{if(e.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u"){let t=document.createRange();t.selectNodeContents(e),t.collapse(!1);let r=window.getSelection();r?.removeAllRanges(),r?.addRange(t)}else if(typeof document.body.createTextRange<"u"){let t=document.body.createTextRange();t.moveToElementText(e),t.collapse(!1),t.select()}},Ps=()=>{let{t:e}=P(["prompt_library"]),{control:t,register:r,reset:o,getValues:a,trigger:n,setValue:s,formState:{errors:l}}=er(),i=Ee(),{setActions:p,generateActions:m}=na(),[g,d]=(0,b.useState)(!1),{activeTab:f}=K(),{editPromptId:T,isOpenPromptLibraryEditForm:L,closePromptLibraryEditForm:v,addPromptLibraryCardMutation:j,editPromptLibraryCardMutation:N}=_e(),X=T==="NEW_PROMPT",{categoryOptions:ie,useCaseOptions:F,loading:ee}=ir(),[I,R]=(0,b.useState)({prompt_template:"",author_url:""}),{data:V,isFetching:H}=oi(T,f==="Own"?"private":"public"),z=(0,b.useMemo)(()=>H,[H]),ve=async()=>{let x=a(),J=m(x.prompt_title);x=_r(J,x),s("prompt_template",x.prompt_template),await n()&&(X?j.mutate(x):N.mutate(x),v())},ct=async()=>{let x=a(),J=m(x.prompt_title);x=_r(J,x),s("prompt_template",x.prompt_template),await n()&&(j.mutate(x),v())},C=x=>{let J=a(),be=J.prompt_template,Re=m(J.prompt_title);if(J=_r(Re,J),be===J.prompt_template)v();else if(x==="escapeKeyDown"||x==="closeBtn"||x==="backdropClick"){d(!0);return}};(0,b.useEffect)(()=>{!H&&V&&(o(V),p(hr(V)),setTimeout(()=>{let x=q()?.querySelector("#prompt-template-input");x&&Ss(x)},100))},[V,H]);let w=(0,b.useMemo)(()=>i==="xs"||i==="sm"?12:6,[i]);return(0,b.useEffect)(()=>{L&&setTimeout(()=>{let x=q()?.querySelector("#prompt-form-modal");x&&x.focus()},100)},[L]),b.default.createElement(ur,{width:800,height:"unset",sx:{maxWidth:i==="xs"||i==="sm"?"90%":"800"},show:L,onClose:C},b.default.createElement(Te,{tabIndex:-1,id:"prompt-form-modal",sx:{textAlign:"left",height:"74vh",maxHeight:"74vh",overflowY:"auto",display:"flex",gap:2,flexDirection:"column",p:{xs:2,sm:3,md:4}}},b.default.createElement(Kt,{loading:H},b.default.createElement(_,{variant:"body1",fontWeight:500,sx:{flexShrink:0}},e("prompt_library:edit_prompt_modal__title")),b.default.createElement(pe,{container:!0,spacing:2,sx:{flex:1,height:0,overflowY:"auto"}},b.default.createElement(pe,{item:!0,xs:12},b.default.createElement(He,{size:"small",variant:"standard",fullWidth:!0},b.default.createElement(ze,null,b.default.createElement(_,{variant:"body1"},e("prompt_library:edit_prompt_modal__field__template__label"),b.default.createElement(Zt,null))),b.default.createElement(yt,{control:t,name:"prompt_template",rules:{required:!0},render:({field:x,fieldState:J,formState:be})=>b.default.createElement(sa,{error:J.invalid,placeholder:e("prompt_library:edit_prompt__template__placeholder")})}))),b.default.createElement(pe,{item:!0,xs:12},b.default.createElement(He,{size:"small",variant:"standard",fullWidth:!0},b.default.createElement(ze,null,b.default.createElement(_,{variant:"body1"},e("prompt_library:edit_prompt_modal__field__title__label"),b.default.createElement(Zt,null))),b.default.createElement(me,{size:"small",InputProps:It,disabled:z,...r("prompt_title",{required:!0}),placeholder:e("prompt_library:edit_prompt_modal__field__title__placeholder"),error:!!l.prompt_title,FormHelperTextProps:{sx:{ml:0}},helperText:l.prompt_title?"Title is required":""}))),b.default.createElement(pe,{item:!0,xs:12},b.default.createElement(He,{size:"small",variant:"standard",fullWidth:!0},b.default.createElement(ze,null,b.default.createElement(_,{variant:"body1"},e("prompt_library:edit_prompt_modal__field__description__label"),b.default.createElement(Zt,null))),b.default.createElement(me,{size:"small",InputProps:It,disabled:z,multiline:!0,...r("teaser",{required:!0}),placeholder:e("prompt_library:edit_prompt_modal__field__description__placeholder"),error:!!l.teaser,FormHelperTextProps:{sx:{ml:0}},helperText:l.teaser?"Prompt description is required":""}))),b.default.createElement(pe,{item:!0,xs:w},b.default.createElement(jr,{control:t,FormControlProps:{size:"small",variant:"standard",fullWidth:!0},MenuItemProps:xs,SelectProps:{variant:"outlined",inputProps:It,onChange:()=>{s("use_case","All")}},defaultValue:"All",label:e("prompt_library:edit_prompt_modal__field__category__label"),options:ie,name:"category"})),b.default.createElement(pe,{item:!0,xs:w},b.default.createElement(jr,{FormControlProps:{size:"small",variant:"standard",fullWidth:!0},SelectProps:{variant:"outlined",inputProps:It},defaultValue:"All",control:t,label:e("prompt_library:edit_prompt_modal__field__use_case__label"),options:F,name:"use_case"})),b.default.createElement(pe,{item:!0,xs:w},b.default.createElement(He,{size:"small",variant:"standard",fullWidth:!0},b.default.createElement(ze,null,b.default.createElement(_,{variant:"body1"},e("prompt_library:edit_prompt_modal__field__author_name__label"))),b.default.createElement(me,{size:"small",InputProps:It,disabled:z,...r("author"),placeholder:e("prompt_library:edit_prompt_modal__field__author_name__placeholder")}))),b.default.createElement(pe,{item:!0,xs:w},b.default.createElement(He,{size:"small",variant:"standard",fullWidth:!0},b.default.createElement(ze,null,b.default.createElement(_,{variant:"body1"},e("prompt_library:edit_prompt_modal__field__author_url__label"))),b.default.createElement(me,{size:"small",InputProps:It,disabled:z,...r("author_url",{pattern:/^(((ht|f)tps?):\/\/)?([^!@#$%^&*?.\s-]([^!@#$%^&*?.\s]{0,63}[^!@#$%^&*?.\s])?\.)+[a-z]{2,6}\/?/,validate:x=>{if(!x)return!0;let J=x?.startsWith("http://")||x?.startsWith("https://");return J||R(be=>({...be,author_url:'Please enter a valid URL starting with "http".'})),J}}),placeholder:e("prompt_library:edit_prompt_modal__field__author_url__placeholder"),FormHelperTextProps:{sx:{ml:0}},error:!!l.author_url,helperText:l.author_url?I.author_url||"Please enter the correct URL":""})))),b.default.createElement(c,{direction:"row",justifyContent:"flex-end",spacing:1,pt:1,flexShrink:0},b.default.createElement(G,{variant:"secondary",onClick:()=>{v()}},e("prompt_library:edit_prompt_modal__action__cancel__title")),!X&&b.default.createElement(at,{variant:"outlined",loading:ee,onClick:ct},e("prompt_library:edit_prompt_modal__action__clone__title")),b.default.createElement(at,{variant:"contained",onClick:ve,loading:ee},e("prompt_library:edit_prompt_modal__action__save_prompt__title")))),b.default.createElement(ai,{open:g,confirmText:"You have entered some text that has not been saved. Are you sure you want to close the input box?",onClose:()=>d(!1),onConfirm:()=>{d(!1),v()},cancelButtonText:"No, take me back!",confirmButtonText:"Close anyway"})))},ii=Ps;var ni=u(Nt()),vs=e=>{let{closeOnSelect:t=!0}=e,{closePromptLibrary:r}=Tt();return Lt.default.createElement(c,{height:"100%",position:"relative",gap:2,sx:{[`.${To.root}`]:{fontSize:"16px"},[`.${qt.root}`]:{[`.${ni.svgIconClasses.root}`]:{fontSize:"24px"}}}},Lt.default.createElement(ri,{sx:{width:"calc(100% + 32px)",left:-16,top:-16}}),Lt.default.createElement(Ia,null),Lt.default.createElement(ti,{onClick:o=>{o&&t&&r()}}),Lt.default.createElement(ii,null))},si=vs;var Cs=()=>{let{setShortCuts:e,runShortCuts:t,shortCutsEngineRef:r}=$t(),{t:o}=P(["prompt_library"]),{promptLibraryOpen:a,openPromptLibrary:n,closePromptLibrary:s,initPromptLibrary:l,selectedPromptLibraryCard:i,cancelSelectPromptLibraryCard:p}=Tt(),{updateSidebarConversationType:m}=k(),{isOpenPromptLibraryEditForm:g}=_e(),[d,f]=$.default.useState(!1),[T,L]=$.default.useState(null),[v,j]=$.default.useState(),N=Ne(),X=(0,$.useRef)(),ie=F=>ee=>{let I=q()?.querySelector("#maxAISidebarChatBox")||document.body,V=ee.currentTarget.getBoundingClientRect(),H=I.getBoundingClientRect();L({getBoundingClientRect:()=>{let z=N?document.body.offsetWidth/2+8:H.x+H.width/2;return{x:z,y:V.y-8,width:1,height:1,top:V.top-8,left:z,bottom:V.top+1,right:z+1}}}),setTimeout(()=>{X.current?.focus()},100),f(!0),n(),j(F)};return Ot(()=>{l({})}),(0,$.useEffect)(()=>{if(i){let F=hr(i);F&&r.current?.status==="idle"&&(m("Chat"),p(),e(F),t().then().catch())}},[i]),(0,$.useEffect)(()=>{!g&&a&&setTimeout(()=>{X.current?.focus()},100)},[g,a]),$.default.createElement($.default.Fragment,null,$.default.createElement(Se,{placement:"top",title:o("prompt_library:use_prompt_library__title__tooltip")},$.default.createElement(G,{"data-testid":"maxai-prompt-library-button",onClick:ie("top"),sx:{p:"5px",minWidth:"unset"},variant:a?"contained":"outlined"},$.default.createElement(Ht,{sx:{fontSize:"20px"}}))),a&&$.default.createElement(M,{onClick:()=>{s()},sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:1e3,bgcolor:"rgba(0,0,0,0.5)"}}),$.default.createElement(Co,{open:a,anchorEl:T,placement:v,transition:!0,keepMounted:!0},({TransitionProps:F})=>$.default.createElement(Ut,{...F,timeout:350},$.default.createElement("div",null,$.default.createElement(Te,{tabIndex:-1,onKeyDown:ee=>{a&&!g&&ee.key==="Escape"&&s()},ref:ee=>{ee&&(X.current=ee)},elevation:4,sx:{width:N?"calc(100vw - 128px)":"calc(100% - 48px)",height:"calc(100vh - 140px)",maxHeight:"1067px",minWidth:402,ml:N?0:1,p:2}},d&&$.default.createElement(si,null))))))},li=Cs;var Ts=e=>{let{onSendMessage:t}=e,{currentSidebarConversationType:r}=k(),{t:o}=P(["common","client"]),{currentMaxInputLength:a,isError:n}=zo("chatBoxInputMediator"),[s,l]=(0,Z.useState)(""),{smoothConversationLoading:i}=Jt(),p=Z.default.useRef(null),m=(0,Z.useRef)(!1),g=(0,Z.useRef)({});return(0,Z.useEffect)(()=>{let d=(f,T)=>{T&&(g.current=T),f.startsWith("``NO_HISTORY_&#``\n")&&(f=f.replace("``NO_HISTORY_&#``\n",""),m.current=!0),l(f)};return Dr("chatBoxInputMediator").subscribe(d),()=>{Dr("chatBoxInputMediator").unsubscribe(d)}},[]),(0,Z.useEffect)(()=>{m.current=!1,g.current={}},[i]),Z.default.createElement(c,{ref:p,p:1,pt:0,direction:"row",alignItems:"center",spacing:1,width:"100%"},Z.default.createElement(_,{component:"span",color:n?"rgb(239, 83, 80)":"text.secondary",fontSize:12,fontFamily:"Roboto,RobotoDraft,Helvetica,Arial,sans-serif!important"},i?0:kr(s.length,0),"/",kr(a,0)),Z.default.createElement(M,{component:"div",display:"flex",width:0,flex:1,alignItems:"center",justifyContent:"end",gap:1},r==="Search"&&!i&&Z.default.createElement(ca,null),r==="Chat"&&!i&&Z.default.createElement(li,null),r==="Chat"&&!i&&Z.default.createElement(ia,{onBeforeShowContextMenu:()=>({template:s||" ",target:q()?.querySelector(`#${Ft}`)?.parentElement||p.current})}),Z.default.createElement(Gt,{title:o("client:sidebar__button__send_to_ai"),TooltipProps:{description:"\u23CE"},sx:{minWidth:"unset",p:1},disableElevation:!0,variant:"contained",disabled:i,onClick:()=>{t&&t(s,{includeHistory:!m.current,meta:g.current}),g.current={},m.current=!1}},i?Z.default.createElement(Ie,{size:16}):Z.default.createElement(pi.default,{sx:{fontSize:"16px"}}))))},mi=Ts;var B=u(h()),Is=(e,t,r,o)=>{let[a,n]=(0,B.useState)(!1),s=(0,B.useRef)(null),l=(0,B.useRef)(null),i=(0,B.useRef)(0),p=(0,B.useRef)(0),[m,g]=(0,B.useState)(1),[d]=(0,B.useState)(o?.buffer||10),f=(0,B.useMemo)(()=>r.length,[r]),T=o?.buffer||0,L=()=>q()?.querySelector(`#${t}`),v=()=>q()?.querySelector(`#${e}`),j=(0,B.useCallback)(async()=>new Promise(I=>{let R=()=>{let V=null;V&&window.clearTimeout(V);let H=v(),z=L();if(H&&z){I(!0);return}V=window.setTimeout(()=>{R()},200)};R()}),[]);(0,B.useEffect)(()=>{j().then(()=>{setTimeout(()=>{n(!0)},1e3)})},[]);let N=(0,B.useCallback)(()=>{g(I=>I*d>=f?I:I+1)},[f,d]),X=(0,B.useRef)(N);(0,B.useEffect)(()=>X.current=kt(N,1e3),[N]);let ie=(0,B.useCallback)(()=>{s.current&&s.current.disconnect();let I=L();if(I){let R=null,V=()=>{R&&window.clearTimeout(R);let H=I.children[T];if(H){let z=ve=>{ve[0].isIntersecting&&X.current()};s.current=new IntersectionObserver(z),l.current=H,s.current.observe(H)}else R=window.setTimeout(()=>{V()},1e3)};V()}},[T]),F=(0,B.useCallback)(()=>{let I=L();if(s.current&&I){l.current&&s.current.unobserve(l.current);let R=I.children[T];R&&(l.current=R,s.current.observe(R))}},[T]),ee=(0,B.useMemo)(()=>d===-1?r:r.slice(-(m*d)),[r,m,d]);return(0,B.useEffect)(()=>{F()},[F,ee]),(0,B.useEffect)(()=>(a&&r.length>d&&ie(),()=>{s.current&&s.current.disconnect()}),[a,ie,r,d]),(0,B.useEffect)(()=>{if(!a||r.length<=d)return;let I=v(),V=kt(()=>{p.current=I?.scrollTop||0,i.current=I?.scrollHeight||0},200);return I?.addEventListener("scroll",V),()=>{I?.removeEventListener("scroll",V)}},[a,r]),(0,B.useEffect)(()=>{g(1)},[f]),(0,B.useEffect)(()=>{if(!a)return;let I=v();if(I&&p.current>0){let R=I?.scrollHeight;I.scrollTop=p.current+R-i.current}},[a,ee]),{slicedMessageList:ee,loadMore:N,changePageNumber:(0,B.useCallback)(I=>g(I),[])}},ui=Is;var E=u(h());var ci=u(ro()),Ls=e=>{let{onClick:t,disabledMainButton:r}=e,{currentSidebarConversationType:o}=k(),{t:a}=P(["common","client"]),[n,s]=(0,E.useState)(!1),l=()=>{s(!1),setTimeout(()=>{t&&t("focus")},100)};return E.default.createElement(M,{sx:{position:"absolute",left:0,bottom:0,width:40,height:40}},E.default.createElement(ea,{ariaLabel:"SpeedDial controlled open",sx:{position:"absolute",left:0,bottom:"0","& > button":{width:40,height:40}},FabProps:{sx:{"& + div":{marginBottom:"-40px!important",paddingBottom:"48px!important"}}},icon:E.default.createElement(M,{component:"div",onClick:()=>{if(r){t&&t("focus");return}t&&t("new")}},E.default.createElement(Se,{placement:"left",title:a(o==="Summary"?"client:sidebar__tabs__summary__action_btn__title":"client:sidebar__tabs__chat__action_btn__title")},E.default.createElement(c,{p:1,alignItems:"center",justifyContent:"center",component:"div"},E.default.createElement(Po,{sx:{color:"#fff",fontSize:"24px"}}))))},o!=="Summary"&&E.default.createElement(Qt,{icon:E.default.createElement(M,{component:"div",onClick:()=>{_o({url:ci.default.runtime.getURL("/pages/chat/index.html")})}},E.default.createElement(Se,{placement:"left",title:a("client:sidebar__speed_dial__chat_history__button")},E.default.createElement(c,{p:1,alignItems:"center",justifyContent:"center",component:"div"},E.default.createElement(Le,{icon:"History",sx:{fontSize:"24px",color:"primary.main"}})))),tooltipTitle:""}),E.default.createElement(Qt,{icon:E.default.createElement(M,{component:"div",onClick:i=>{i.stopPropagation();let p=q()?.querySelector('[data-testid="maxai-prompt-library-button"]');p&&p.click()}},E.default.createElement(Se,{placement:"left",title:a("client:sidebar__speed_dial__one_click_prompts__button")},E.default.createElement(c,{p:1,alignItems:"center",justifyContent:"center",component:"div"},E.default.createElement(Ht,{sx:{fontSize:"24px",color:"primary.main"}})))),tooltipTitle:""}),E.default.createElement(Qt,{icon:E.default.createElement(M,{component:"div",onClick:()=>{s(!0)}},E.default.createElement(Se,{placement:"left",title:a("client:sidebar__speed_dial__restart_extension__button")},E.default.createElement(c,{p:1,alignItems:"center",justifyContent:"center",component:"div"},E.default.createElement(Le,{icon:"Restart",sx:{fontSize:"24px"}})))),tooltipTitle:""})),E.default.createElement(qo,{open:n,onClose:()=>{l()},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},E.default.createElement(Qo,{id:"alert-dialog-title"},a("client:sidebar__speed_dial__restart_extension__tooltip__title")),E.default.createElement(Yo,null,E.default.createElement($o,{id:"alert-dialog-description"},a("client:sidebar__speed_dial__restart_extension__tooltip__description1"),E.default.createElement("br",null),a("client:sidebar__speed_dial__restart_extension__tooltip__description2"))),E.default.createElement(Ko,null,E.default.createElement(G,{sx:{},variant:"outlined",onClick:()=>{l()}},a("common:cancel")),E.default.createElement(G,{color:"primary",variant:"contained",onClick:()=>{t&&t("restart"),l()},autoFocus:!0},a("client:sidebar__speed_dial__restart_extension__tooltip__confirm")))))},di=Ls;var de=u(h());var Es=e=>{let{sx:t}=e,{currentSidebarConversationType:r}=k(),o=Me(dt),[a,n]=de.default.useState(null),s=(0,de.useRef)(null),l=(0,de.useRef)(!1),i=(0,de.useRef)(!1),p=d=>{i.current||n(d.currentTarget)},m=()=>{n(null)},g=!!a;return(0,de.useMemo)(()=>r!=="Chat"?null:de.default.createElement(M,{id:"max-ai__ai-provider-floating-button",sx:{width:"44px",height:"44px",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",border:"1px solid #EBEBEB",cursor:"pointer",borderColor:d=>d.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"#EBEBEB",bgcolor:d=>d.palette.mode==="dark"?"#333":"#fff",boxShadow:"0px 0px 0.5px 0px rgba(0, 0, 0, 0.40), 0px 1px 3px 0px rgba(0, 0, 0, 0.09), 0px 4px 8px 0px rgba(0, 0, 0, 0.09);",...t},"aria-owns":g?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:d=>{s.current&&clearTimeout(s.current),l.current=!0,s.current=setTimeout(()=>{l.current=!1},700),p(d)},onMouseLeave:()=>{m(),i.current=!1}},de.default.createElement(vo,{aiProviderType:o.sidebarSettings?.common?.currentAIProvider||"USE_CHAT_GPT_PLUS"}),de.default.createElement(jt,{open:g,anchorEl:a,id:"mouse-over-popover",anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},disableScrollLock:!0,PaperProps:{sx:{ml:Ne()?0:"8px"}}},de.default.createElement(Yt.default,{onClickAway:d=>{let f=q()?.querySelector("#MaxAIProviderSelectorCard");if(f){let T=f.getBoundingClientRect(),L=d.clientX,v=d.clientY;if(L>T.left&&L<T.right&&v>T.top&&v<T.bottom)return;m()}}},de.default.createElement(M,{onMouseEnter:p,onMouseLeave:m},de.default.createElement(Do,{closeAble:!0,onClose:()=>{l.current||(i.current=!0,m())}}))))),[o.sidebarSettings?.common?.currentAIProvider,g,r])},fi=Es;var fe=u(h());var qr=u(h());var gi=u(fo()),As=e=>{let{needSystemOrThirdMessage:t=!1}=e,{t:r}=P(["common","client"]),{currentSidebarConversationId:o,currentSidebarConversationMessages:a}=k();return a.filter(s=>t?!0:s.type!=="system"&&s.type!=="third").length===0||!o?null:qr.default.createElement(Uo,{title:r("client:sidebar__share__share_button__tooltip"),onClick:async()=>{let s=await ko(o);if(s?.title){let l=await la(s,t),i=new Blob([l],{type:"text/plain;charset=utf-8"}),p=URL.createObjectURL(i),m=document.createElement("a");m.href=p,m.download=`MaxAI_Chat_${(0,gi.default)().format("YYYY_MM_DD_HH:mm")}.txt`,m.click(),URL.revokeObjectURL(p)}}},qr.default.createElement(Le,{icon:"FileDownload",sx:{fontSize:"20px",color:"text.secondary"}}))},bi=As;var ws=[{label:"client:sidebar__tabs__chat__title",tooltip:()=>"client:sidebar__tabs__chat__tooltip",value:"Chat"},{label:"client:sidebar__tabs__summary__title",tooltip:()=>{switch(Mo()){case"DEFAULT_EMAIL_SUMMARY":return"client:sidebar__tabs__summary__tooltip__default_email";case"PAGE_SUMMARY":return"client:sidebar__tabs__summary__tooltip__page";case"PDF_CRX_SUMMARY":return"client:sidebar__tabs__summary__tooltip__pdf_crx";case"YOUTUBE_VIDEO_SUMMARY":return"client:sidebar__tabs__summary__tooltip__youtube_video";default:return"client:sidebar__tabs__summary__tooltip__page"}},value:"Summary"},{label:"client:sidebar__tabs__search__title",tooltip:()=>"client:sidebar__tabs__search__tooltip",value:"Search"}],Ms=()=>{let{t:e}=P(["common","client"]),{currentSidebarConversationType:t,updateSidebarConversationType:r}=k(),o=Me(zt);(0,fe.useEffect)(()=>{let n=s=>{let l=s?.detail?.type;l&&r(l)};return window.addEventListener("MaxAISwitchSidebarTab",n),()=>{window.removeEventListener("MaxAISwitchSidebarTab",n)}});let a=(0,fe.useMemo)(()=>ws.filter(n=>!(n.value==="Summary"&&Ne())),[]);return fe.default.createElement(fe.default.Fragment,null,fe.default.createElement(c,{direction:"row",height:36,alignItems:"center",width:"100%",borderBottom:"1px solid",borderColor:"customColor.borderColor",bgcolor:"background.paper",justifyContent:"space-between",sx:{position:"sticky",top:0,zIndex:1}},fe.default.createElement(Xt,{sx:{minHeight:"36px","& .use-chat-gpt-ai--MuiButtonBase-root":{height:"36px",minHeight:"36px",p:1}},value:t,onChange:async(n,s)=>{r(s)},textColor:"inherit",indicatorColor:"primary"},a.map(n=>fe.default.createElement(ht,{disabled:o.loading,key:n.value,value:n.value,label:fe.default.createElement(Se,{title:e(n.tooltip?.())},fe.default.createElement(_,{fontSize:"14px",color:"text.primary","data-testid":"max-ai__summary-tab"},e(n.label)))}))),fe.default.createElement(c,{direction:"row",alignItems:"center",pr:1},fe.default.createElement(bi,null))))},hi=Ms;var A=u(h());var vi=u(Vo());var Ci=u(Ho());var Pr=u(h());var yr=u(h()),Kr=[{label:"Default",value:""},{value:"Academic",label:"Academic"},{value:"Analytical",label:"Analytical"},{value:"Argumentative",label:"Argumentative"},{value:"Conversational",label:"Conversational"},{value:"Creative",label:"Creative"},{value:"Critical",label:"Critical"},{value:"Descriptive",label:"Descriptive"},{value:"Epigrammatic",label:"Epigrammatic"},{value:"Epistolary",label:"Epistolary"},{value:"Expository",label:"Expository"},{value:"Informative",label:"Informative"},{value:"Instructive",label:"Instructive"},{value:"Journalistic",label:"Journalistic"},{value:"Metaphorical",label:"Metaphorical"},{value:"Narrative",label:"Narrative"},{value:"Persuasive",label:"Persuasive"},{value:"Poetic",label:"Poetic"},{value:"Satirical",label:"Satirical"},{value:"Technical",label:"Technical"}];function ks(e,{inputValue:t}){return e.filter(r=>{let o=r.label.toLowerCase(),a=r.value.toLowerCase(),n=t.toLowerCase();return o.includes(n)||a.includes(n)})}var _i=e=>{let{label:t="Writing style",defaultValue:r="",onChange:o=i=>{},placeholder:a,sx:n}=e,[s,l]=yr.default.useState(()=>Kr.find(i=>i.value===r)||Kr[0]);return yr.default.createElement(bt,{componentsProps:{popper:{style:{width:160}}},placeholder:a,disableClearable:!0,value:s,size:"small",sx:{width:160,...n},autoHighlight:!0,getOptionLabel:i=>i.label,options:Kr,onChange:(i,p)=>{l(p),o(p.value)},filterOptions:ks,renderInput:i=>yr.default.createElement(me,{...i,label:t,InputLabelProps:{sx:{fontSize:"16px"},...i.InputLabelProps},inputProps:{sx:{fontSize:"16px"},...i.inputProps,autoComplete:"new-password"}})})};var xr=u(h()),Yr=[{language_code:"uk",value:"Ukrainian",label:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430"},{language_code:"so",value:"Somali",label:"Af Soomaali"},{language_code:"af",value:"Afrikaans",label:"Afrikaans"},{language_code:"az",value:"Azerbaijani",label:"Az\u0259rbaycan dili"},{language_code:"id",value:"Indonesian",label:"Bahasa Indonesia"},{language_code:"ms-MY",value:"Malaysian Malay",label:"Bahasa Malaysia"},{language_code:"ms",value:"Malay",label:"Bahasa Melayu"},{language_code:"jv",value:"Javanese",label:"Basa Jawa"},{language_code:"su",value:"Sundanese",label:"Basa Sunda"},{language_code:"bs",value:"Bosnian",label:"Bosanski jezik"},{language_code:"ca",value:"Catalan",label:"Catal\xE0"},{language_code:"cs",value:"Czech",label:"\u010Ce\u0161tina"},{language_code:"ny",value:"Chichewa",label:"Chichewa"},{language_code:"cy",value:"Welsh",label:"Cymraeg"},{language_code:"da",value:"Danish",label:"Dansk"},{language_code:"de",value:"German",label:"Deutsch"},{language_code:"et",value:"Estonian",label:"Eesti keel"},{language_code:"en",value:"English",label:"English"},{language_code:"en-GB",value:"English (UK)",label:"English (UK)"},{language_code:"en-US",value:"English (US)",label:"English (US)"},{language_code:"es",value:"Spanish",label:"Espa\xF1ol"},{language_code:"eo",value:"Esperanto",label:"Esperanto"},{language_code:"eu",value:"Basque",label:"Euskara"},{language_code:"fr",value:"French",label:"Fran\xE7ais"},{language_code:"ga",value:"Irish",label:"Gaeilge"},{language_code:"gl",value:"Galician",label:"Galego"},{language_code:"hr",value:"Croatian",label:"Hrvatski jezik"},{language_code:"xh",value:"Xhosa",label:"isiXhosa"},{language_code:"zu",value:"Zulu",label:"isiZulu"},{language_code:"is",value:"Icelandic",label:"\xCDslenska"},{language_code:"it",value:"Italian",label:"Italiano"},{language_code:"sw",value:"Swahili",label:"Kiswahili"},{language_code:"ht",value:"Haitian Creole",label:"Krey\xF2l Ayisyen"},{language_code:"ku",value:"Kurdish",label:"Kurd\xEE"},{language_code:"la",value:"Latin",label:"Lat\u012Bna"},{language_code:"lv",value:"Latvian",label:"Latvie\u0161u valoda"},{language_code:"lb",value:"Luxembourgish",label:"L\xEBtzebuergesch"},{language_code:"lt",value:"Lithuanian",label:"Lietuvi\u0173 kalba"},{language_code:"hu",value:"Hungarian",label:"Magyar"},{language_code:"mg",value:"Malagasy",label:"Malagasy"},{language_code:"mt",value:"Maltese",label:"Malti"},{language_code:"mi",value:"Maori",label:"M\u0101ori"},{language_code:"nl",value:"Dutch",label:"Nederlands"},{language_code:"no",value:"Norwegian",label:"Norsk"},{language_code:"uz",value:"Uzbek",label:"O'zbek tili"},{language_code:"pl",value:"Polish",label:"Polski"},{language_code:"pt",value:"Portuguese",label:"Portugu\xEAs"},{language_code:"ro",value:"Romanian",label:"Rom\xE2n\u0103"},{language_code:"st",value:"Sesotho",label:"Sesotho"},{language_code:"sq",value:"Albanian",label:"Shqip"},{language_code:"sk",value:"Slovak",label:"Sloven\u010Dina"},{language_code:"sl",value:"Slovenian",label:"Sloven\u0161\u010Dina"},{language_code:"fi",value:"Finnish",label:"Suomi"},{language_code:"sv",value:"Swedish",label:"Svenska"},{language_code:"tl",value:"Tagalog",label:"Tagalog"},{language_code:"tt",value:"Tatar",label:"Tatar\xE7a"},{language_code:"tr",value:"Turkish",label:"T\xFCrk\xE7e"},{language_code:"vi",value:"Vietnamese",label:"Vi\u1EC7t ng\u1EEF"},{language_code:"yo",value:"Yoruba",label:"Yor\xF9b\xE1"},{language_code:"el",value:"Greek",label:"\u0395\u03BB\u03BB\u03B7\u03BD\u03B9\u03BA\u03AC"},{language_code:"be",value:"Belarusian",label:"\u0411\u0435\u043B\u0430\u0440\u0443\u0441\u043A\u0430\u044F \u043C\u043E\u0432\u0430"},{language_code:"bg",value:"Bulgarian",label:"\u0411\u044A\u043B\u0433\u0430\u0440\u0441\u043A\u0438 \u0435\u0437\u0438\u043A"},{language_code:"ky",value:"Kyrgyz",label:"\u041A\u044B\u0440"},{language_code:"kk",value:"Kazakh",label:"\u049A\u0430\u0437\u0430\u049B \u0442\u0456\u043B\u0456"},{language_code:"mk",value:"Macedonian",label:"\u041C\u0430\u043A\u0435\u0434\u043E\u043D\u0441\u043A\u0438 \u0458\u0430\u0437\u0438\u043A"},{language_code:"mn",value:"Mongolian",label:"\u041C\u043E\u043D\u0433\u043E\u043B \u0445\u044D\u043B"},{language_code:"ru",value:"Russian",label:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439"},{language_code:"sr",value:"Serbian",label:"\u0421\u0440\u043F\u0441\u043A\u0438 \u0458\u0435\u0437\u0438\u043A"},{language_code:"tg",value:"Tajik",label:"\u0422\u043E\u04B7\u0438\u043A\u04E3"},{language_code:"ka",value:"Georgian",label:"\u10E5\u10D0\u10E0\u10D7\u10E3\u10DA\u10D8"},{language_code:"hy",value:"Armenian",label:"\u0540\u0561\u0575\u0565\u0580\u0565\u0576"},{language_code:"yi",value:"Yiddish",label:"\u05D9\u05D9\u05B4\u05D3\u05D9\u05E9"},{language_code:"he",value:"Hebrew",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{language_code:"ug",value:"Uyghur",label:"\u0626\u06C7\u064A\u063A\u06C7\u0631\u0686\u06D5"},{language_code:"ur",value:"Urdu",label:"\u0627\u0631\u062F\u0648"},{language_code:"ar",value:"Arabic",label:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"},{language_code:"ps",value:"Pashto",label:"\u067E\u069A\u062A\u0648"},{language_code:"fa",value:"Persian",label:"\u0641\u0627\u0631\u0633\u06CC"},{language_code:"ne",value:"Nepali",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{language_code:"mr",value:"Marathi",label:"\u092E\u0930\u093E\u0920\u0940"},{language_code:"hi",value:"Hindi",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{language_code:"bn",value:"Bengali",label:"\u09AC\u09BE\u0982\u09B2\u09BE"},{language_code:"pa",value:"Punjabi",label:"\u0A2A\u0A70\u0A1C\u0A3E\u0A2C\u0A40"},{language_code:"gu",value:"Gujarati",label:"\u0A97\u0AC1\u0A9C\u0AB0\u0ABE\u0AA4\u0AC0"},{language_code:"or",value:"Oriya",label:"\u0B13\u0B21\u0B3C\u0B3F\u0B06"},{language_code:"ta",value:"Tamil",label:"\u0BA4\u0BAE\u0BBF\u0BB4\u0BCD"},{language_code:"te",value:"Telugu",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{language_code:"kn",value:"Kannada",label:"\u0C95\u0CA8\u0CCD\u0CA8\u0CA1"},{language_code:"ml",value:"Malayalam",label:"\u0D2E\u0D32\u0D2F\u0D3E\u0D33\u0D02"},{language_code:"si",value:"Sinhala",label:"\u0DC3\u0DD2\u0D82\u0DC4\u0DBD"},{language_code:"th",value:"Thai",label:"\u0E44\u0E17\u0E22"},{language_code:"lo",value:"Lao",label:"\u0E9E\u0EB2\u0EAA\u0EB2\u0EA5\u0EB2\u0EA7"},{language_code:"my",value:"Burmese",label:"\u1017\u1019\u102C\u1005\u102C"},{language_code:"km",value:"Khmer",label:"\u1797\u17B6\u179F\u17B6\u1781\u17D2\u1798\u17C2\u179A"},{language_code:"ko",value:"Korean",label:"\uD55C\uAD6D\uC5B4"},{language_code:"zh",value:"Chinese",label:"\u4E2D\u6587"},{language_code:"zh-TW",value:"Traditional Chinese",label:"\u7E41\u9AD4\u4E2D\u6587"},{language_code:"ja",value:"Japanese",label:"\u65E5\u672C\u8A9E"}];function Os(e,{inputValue:t}){return e.filter(r=>{let o=r.label.toLowerCase(),a=r.value.toLowerCase(),n=t.toLowerCase();return o.includes(n)||a.includes(n)})}var yi=e=>{let{label:t="Output language",defaultValue:r="",onChange:o=i=>{},placeholder:a,sx:n}=e,[s,l]=xr.default.useState(()=>Yr.find(i=>i.value===r)||Yr[0]);return xr.default.createElement(bt,{componentsProps:{popper:{style:{width:160}}},placeholder:a,disableClearable:!0,value:s,size:"small",sx:{width:160,...n},autoHighlight:!0,getOptionLabel:i=>i.label,options:Yr,onChange:(i,p)=>{l(p),o(p.value)},filterOptions:Os,renderInput:i=>xr.default.createElement(me,{...i,label:t,InputLabelProps:{sx:{fontSize:"16px"},...i.InputLabelProps},inputProps:{sx:{fontSize:"16px"},...i.inputProps}})})};var Sr=u(h());var $r=[{label:"Default",value:""},{label:"Authoritative",value:"Authoritative"},{label:"Casual",value:"Casual"},{label:"Clinical",value:"Clinical"},{label:"Cold",value:"Cold"},{label:"Confident",value:"Confident"},{label:"Cynical",value:"Cynical"},{label:"Emotional",value:"Emotional"},{label:"Empathetic",value:"Empathetic"},{label:"Formal",value:"Formal"},{label:"Friendly",value:"Friendly"},{label:"Humorous",value:"Humorous"},{label:"Informal",value:"Informal"},{label:"Ironic",value:"Ironic"},{label:"Optimistic",value:"Optimistic"},{label:"Pessimistic",value:"Pessimistic"},{label:"Playful",value:"Playful"},{label:"Professional",value:"Professional"},{label:"Sarcastic",value:"Sarcastic"},{label:"Serious",value:"Serious"},{label:"Straightforward",value:"Straightforward"},{label:"Sympathetic",value:"Sympathetic"},{label:"Tentative",value:"Tentative"},{label:"Warm",value:"Warm"}];function Ds(e,{inputValue:t}){return e.filter(r=>{let o=r.label.toLowerCase(),a=r.value.toLowerCase(),n=t.toLowerCase();return o.includes(n)||a.includes(n)})}var xi=e=>{let{label:t="Tone",defaultValue:r="",onChange:o=i=>{},placeholder:a,sx:n}=e,[s,l]=Sr.default.useState(()=>$r.find(i=>i.value===r)||$r[0]);return Sr.default.createElement(bt,{componentsProps:{popper:{style:{width:160}}},placeholder:a,disableClearable:!0,value:s,size:"small",sx:{width:160,...n},autoHighlight:!0,getOptionLabel:i=>i.label,options:$r,onChange:(i,p)=>{l(p),o(p.value)},filterOptions:Ds,renderInput:i=>Sr.default.createElement(me,{...i,label:t,InputLabelProps:{sx:{fontSize:"16px"},...i.InputLabelProps},inputProps:{sx:{fontSize:"16px"},...i.inputProps,autoComplete:"new-password"}})})};var Bs=e=>{let{systemVariableSelectKey:t,...r}=e;switch(t){case"AI_RESPONSE_WRITING_STYLE":return Pr.default.createElement(_i,{...r});case"AI_RESPONSE_LANGUAGE":return Pr.default.createElement(yi,{...r});case"AI_RESPONSE_TONE":return Pr.default.createElement(xi,{...r});default:return null}},Si=Bs;var Qr=u(ro()),vr="CHROME_EXTENSION_SET_VARIABLES_MODAL_SELECT_KEY",Xr=async()=>{let e=await Qr.default.storage.local.get(vr);try{return e[vr]?JSON.parse(e[vr]):{}}catch{return{}}},Pi=async(e,t)=>{try{let r=await Xr();return r[e]=t,await Qr.default.storage.local.set({[vr]:JSON.stringify(r)}),!0}catch{return!1}};var Fs=e=>{let{title:t,variables:r,systemVariables:o,modelKey:a,onShow:n,onClose:s,actions:l,answerInsertMessageId:i}=e,{createConversation:p}=Oo(),{setShortCuts:m,runShortCuts:g,loading:d,shortCutsEngineRef:f}=$t(),{currentSidebarConversationType:T}=k(),{t:L}=P(["common","client"]),[v,j]=(0,A.useState)(!1),[N,X]=(0,A.useState)(!1),ie=Ee(),[F,ee]=(0,A.useState)(null),I=(0,A.useRef)(),[R,V]=(0,A.useState)([]),{control:H,getValues:z,setValue:ve,register:ct,trigger:C,reset:w,clearErrors:x,formState:{errors:J}}=er(),[be,Re]=(0,A.useState)({}),Ir=async S=>{R.forEach(W=>{W.resolve({data:z(),type:S?"cancel":"close",success:!1})}),w(),Re({}),j(!1),s?.()},Lr=async()=>{let S=await C();return S||v||j(!0),S},Jr=async S=>{if(Xe(S)){let W=I.current?.querySelectorAll("textarea[id]")?.[S+1];if(W){W.focus();return}}if(F?.waitForUserAction){if(!await Lr())return;R.forEach(W=>{W.resolve({data:z(),type:"confirm",success:!0})})}else await Bt(!1)},Bt=async S=>{let W=Object.values(z()).filter(xe=>String(xe||"").trim()==="").length>0;if(!await Lr()){S&&W&&x();return}if(S&&W){j(!0);return}if(Object.keys(z()).length===0)return;await p("Chat");let te=Mt(z());Re({}),w(),j(!1),s?.();let re=[];if(F?.template){let xe=z()?.TEMPLATE||F?.template||"",we="";te.AI_RESPONSE_TONE!=="Default"&&te.AI_RESPONSE_WRITING_STYLE!=="Default"?we=`

Please write in {{AI_RESPONSE_TONE}} tone, {{AI_RESPONSE_WRITING_STYLE}} writing style, using {{AI_RESPONSE_LANGUAGE}}.`:te.AI_RESPONSE_TONE!=="Default"?we=`

Please write in {{AI_RESPONSE_TONE}} tone, using {{AI_RESPONSE_LANGUAGE}}.`:te.AI_RESPONSE_WRITING_STYLE!=="Default"?we=`

Please write in {{AI_RESPONSE_WRITING_STYLE}} writing style, using {{AI_RESPONSE_LANGUAGE}}.`:we=`

Please write using {{AI_RESPONSE_LANGUAGE}}.`,xe+=`

---`+we,re.push({type:"SET_VARIABLE_MAP",parameters:{VariableMap:te}}),re.push(...l||F.actions||[]),re.push({type:"RENDER_TEMPLATE",parameters:{template:xe}});let qe=i||F.answerInsertMessageId||"";ao?re.push({type:"ASK_CHATGPT",parameters:{template:"{{LAST_ACTION_OUTPUT}}",AskChatGPTActionType:qe?"ASK_CHAT_GPT_HIDDEN":"ASK_CHAT_GPT_WITH_PREFIX",AskChatGPTInsertMessageId:qe,AskChatGPTActionMeta:{contextMenu:{id:F.contextMenuId||Qe(),droppable:!1,parent:Qe(),text:F.title,data:{editable:!1,type:"shortcuts",actions:[]}}}}}):re.push({type:"ASK_CHATGPT",parameters:{template:"{{LAST_ACTION_OUTPUT}}",AskChatGPTInsertMessageId:qe,AskChatGPTActionType:qe?"ASK_CHAT_GPT_HIDDEN":"ASK_CHAT_GPT_WITH_PREFIX"}}),await m(re),await g()}},je=(0,A.useMemo)(()=>{let S={},W=r||F?.variables||[],te=o||F?.systemVariables||[],re=t||F?.title||"",xe=[],we=[];te.concat(W).forEach(le=>{le.valueType==="Select"&&!le.hidden&&xe.push(le),le.valueType==="Text"&&!le.hidden&&we.push(le);let At=le.validates||[];S[le.VariableName]=ct(le.VariableName,{value:le.defaultValue?.trim(),validate:Ke=>{for(let Er=0;Er<At.length;Er++){let wt=At[Er];if(wt.required&&!Ke)return wt.message||`${le.label} is required`;if(wt.pattern&&(!Ke||!new RegExp(wt.pattern).test(Ke.toString())))return wt.message||`${le.label} is invalid`}return!0}})});let qe=xe.length+te.length,Ki=window.innerHeight*.6,Yi=36,eo=Math.ceil(qe/3),$i=eo*48+(eo-1)*16,to=we.length,Qi=(to-1)*16,Xi=16*3,Ji=Ki-Yi-$i-Qi-Xi,Zi=Math.floor(Ji/24/to)-1;return Xr().then(le=>{let At=Object.keys(S);At.length!==0&&(At.forEach(Ke=>{le[Ke]!==void 0&&ve(Ke,le[Ke])}),Re(S))}),{currentTitle:re,currentSelectTotalCount:qe,currentSystemVariables:te,selectTypeVariables:xe,textTypeVariables:we,maxTextareaMaxRows:Zi}},[r,t,o,a,F]);Ot(()=>{No.receive("SetVariablesModal",S=>new Promise((W,te)=>{S.task==="open"&&S.config?.modelKey===a&&(j(!1),setTimeout(()=>{ee(S.config),S.config.waitForUserAction?V([{resolve:W,reject:te}]):W({data:Mt(be),type:"confirm",success:!0})},0))}))});let Zr=(0,A.useRef)(Bt);return(0,A.useEffect)(()=>{Zr.current=Bt},[Bt]),Ot(()=>{f.current?.addListener((S,W)=>{S==="status"&&W.status==="complete"&&Zr.current(!0).then().catch()})}),(0,A.useEffect)(()=>{X(T!=="Chat")},[T]),(0,A.useEffect)(()=>{if(v)if(N)s?.();else{let S=()=>{let W=Array.from(I.current?.querySelectorAll("textarea")||[]).find(te=>te.value==="");W?W.focus():I.current?.querySelector("textarea")?.focus()};setTimeout(()=>{S()},0),setTimeout(()=>{S()},100),n?.()}else X(!1)},[v,N]),!v||N||Object.keys(be).length===0?null:A.default.createElement(c,{borderRadius:"8px",border:"1px solid",borderColor:"customColor.borderColor",sx:{width:"100%",p:1,gap:1},maxHeight:"60vh",onKeyPressCapture:S=>{S.stopPropagation()},onKeyPress:S=>{S.stopPropagation()}},A.default.createElement(c,{flexShrink:0,height:36,direction:"row",alignItems:"start",justifyContent:"space-between",width:"100%"},A.default.createElement(M,{width:0,flex:1,component:"div",sx:{borderRadius:"4px",p:"4px 8px",bgcolor:"rgba(0, 0, 0, 0.87)"}},A.default.createElement(_,{fontSize:"14px",color:"#fff",fontWeight:600,noWrap:!0},je.currentTitle)),A.default.createElement(ne,{onClick:async()=>await Ir(!0),sx:{flexShrink:0,position:"relative",top:"-8px",right:"-8px"}},A.default.createElement(vi.default,{sx:{fontSize:"24px"}}))),A.default.createElement(c,{flexShrink:0,flexWrap:"wrap",direction:"row",sx:{gap:"16px"}},je.selectTypeVariables.map((S,W)=>{let te=Vs(W,je.currentSelectTotalCount);return S.systemVariable?A.default.createElement(yt,{control:H,name:S.VariableName,defaultValue:S.defaultValue,render:({field:re})=>A.default.createElement(Si,{systemVariableSelectKey:S.VariableName,key:S.VariableName,defaultValue:re.value,onChange:async xe=>{await Pi(S.VariableName,xe),re.onChange(xe)},sx:{width:te}})}):null})),A.default.createElement(c,{direction:"row",flexWrap:"wrap",gap:2,paddingTop:1,ref:I,flex:1,height:0,sx:{overflowY:"auto"}},je.textTypeVariables.map((S,W)=>{let te=(ie==="lg"||ie==="xl")&&je.textTypeVariables.length>1?"calc(50% - 8px)":"100%";return A.default.createElement(me,{sx:{width:te},size:"small",key:S.VariableName,label:S.label||"Label",...be[S.VariableName],onKeyDown:async re=>{re.key==="Enter"&&!re.shiftKey?(re.stopPropagation(),re.preventDefault(),await Jr(W)):re.stopPropagation()},InputProps:{sx:{fontSize:"16px"}},error:!!J[S.VariableName],helperText:J[S.VariableName]?.message||"",FormHelperTextProps:{sx:{ml:0}},InputLabelProps:{shrink:!0,sx:{fontSize:"16px"}},multiline:!0,placeholder:S.placeholder,minRows:Math.min(je.maxTextareaMaxRows,2),maxRows:je.maxTextareaMaxRows})})),A.default.createElement(c,{direction:"row",alignItems:"center",justifyContent:"end",gap:1,flexShrink:0},A.default.createElement(G,{sx:{height:"32px"},onClick:async()=>await Ir(!0),variant:"secondary"},L("common:cancel")),A.default.createElement(Gt,{title:L("client:sidebar__button__send_to_ai"),TooltipProps:{description:"\u23CE"},disabled:d,onClick:async()=>await Jr(),variant:"contained",color:"primary",sx:{width:"32px",height:"32px",minWidth:"unset"}},d?A.default.createElement(Ie,{size:16,sx:{fontSize:"inherit",color:"#fff"}}):A.default.createElement(Ci.default,{sx:{fontSize:"16px"}}))))},Vs=(e,t)=>{let r=t%3,o=(t-r)/3;if(e<o*3)return"calc(33.33% - (2/3)*16px)";switch(r){case 1:if(e===t-1)return"100%";break;case 2:if(e>=t-2)return"calc(50% - 8px)";break}return null},Ti=Fs;var Fe=u(h());var pt=u(h());var Ns=()=>{let e="Access your chat history in immersive chat.";return pt.default.createElement(_,{width:"100%",component:"div",fontSize:12,color:"text.secondary",sx:{display:"flex",alignItems:"center",justifyContent:"end"}},pt.default.createElement(_,{fontSize:"inherit",color:"inherit",width:0,flex:1,textAlign:"right",noWrap:!0},pt.default.createElement(gt,{fontSize:"inherit",color:"inherit",href:no,target:"_blank",sx:{textDecoration:"underline!important"}},pt.default.createElement("span",null,"MaxAI.me v"),pt.default.createElement("span",null,`${oo}`),pt.default.createElement("span",null,` - ${e}`))))},Ii=Ns;var Li=u(mn()),{getOS:Hs}=new Li.UAParser,zs=()=>{let{width:e,scrollWidth:t}=pa(),{t:r}=P(["common"]),[o,a]=(0,Fe.useState)(!1);return(0,Fe.useEffect)(()=>{if(Xe(t)&&Xe(e)&&t>e){if(Hs().name==="Mac OS")return;a(!0)}},[e,t]),Fe.default.createElement(c,{direction:"row",alignItems:"center",sx:{width:"100%"},spacing:2,justifyContent:"space-between",pb:o?2:0},Fe.default.createElement(_,{sx:{flexShrink:0},fontSize:12},Fe.default.createElement(gt,{color:"text.primary",sx:{cursor:"pointer"},underline:"always",target:"_blank",href:io},r("common:contact_us"))),Fe.default.createElement(Ii,null))},Ei=zs;var U=u(h());var mt=u(h());var Ai=[{value:"sogou",label:"Sogou Search"},{value:"brave",label:"Brave Search"},{value:"yandex",label:"Yandex Search"},{value:"naver",label:"Naver Search"},{value:"bing",label:"Bing Search"},{value:"yahoo",label:"Yahoo Search"},{value:"baidu",label:"Baidu Search"},{value:"google",label:"Google Search"}],Gs=()=>{let{sidebarSettings:e,updateSidebarSettings:t}=k(),{t:r}=P(["common","client"]);return mt.default.createElement(et,{displayLoading:!1,MenuProps:{elevation:0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},MenuListProps:{sx:{border:"1px solid",borderColor:"customColor.borderColor"}}},sx:{width:"100%"},size:"small",label:r("client:sidebar__search_with_ai__advanced__search_engine__title"),labelSx:{fontSize:16},options:Ai,value:e?.search?.searchEngine||"google",onChange:async o=>{await t({search:{searchEngine:o}})},labelProp:{p:0,pointerEvents:"auto!important"},renderValue:o=>{let a=Ai.find(n=>n.value===o);return mt.default.createElement(c,{sx:{padding:"6px 0"},direction:"row",alignItems:"center",spacing:1,onClick:n=>{n.preventDefault(),n.stopPropagation()}},mt.default.createElement(_,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},a?.label))},renderLabel:(o,a)=>mt.default.createElement(ue,{placement:"left",PopperProps:{sx:{zIndex:2147483620}},componentsProps:{tooltip:{sx:{border:"1px solid rgb(224,224,224)",bgcolor:"background.paper",p:1}}},title:void 0},mt.default.createElement(c,{sx:{padding:"6px 16px"},width:"100%",direction:"row",alignItems:"center",spacing:1},mt.default.createElement(_,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},a.label)))})},wi=Gs;var ut=u(h());var Mi=Array.from({length:10},(e,t)=>t+1).map(e=>({value:e,label:`${e} result${e===1?"":"s"}`})),Ws=()=>{let{sidebarSettings:e,updateSidebarSettings:t}=k(),{t:r}=P(["common","client"]);return ut.default.createElement(et,{displayLoading:!1,MenuProps:{elevation:0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},MenuListProps:{sx:{border:"1px solid",borderColor:"customColor.borderColor"}}},sx:{width:"100%"},size:"small",label:r("client:sidebar__search_with_ai__advanced__search_results__title"),labelSx:{fontSize:16},options:Mi,value:e?.search?.maxResultsCount||6,onChange:async o=>{await t({search:{maxResultsCount:Xe(o)?o:6}})},labelProp:{p:0,pointerEvents:"auto!important"},renderValue:o=>{let a=Mi.find(n=>n.value===o);return ut.default.createElement(c,{sx:{padding:"6px 0"},direction:"row",alignItems:"center",spacing:1},ut.default.createElement(_,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},a?.label))},renderLabel:(o,a)=>ut.default.createElement(ue,{placement:"left",PopperProps:{sx:{zIndex:2147483620}},componentsProps:{tooltip:{sx:{border:"1px solid rgb(224,224,224)",bgcolor:"background.paper",p:1}}},title:void 0},ut.default.createElement(c,{sx:{padding:"6px 16px"},width:"100%",direction:"row",alignItems:"center",spacing:1},ut.default.createElement(_,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},a.label)))})},ki=Ws;var Us=e=>{let{sx:t}=e,{t:r}=P(["client","common"]),{currentSidebarConversationType:o}=k(),a=Me(dt),[n,s]=U.default.useState(null),l=(0,U.useRef)(null),i=(0,U.useRef)(!1),p=(0,U.useRef)(!1),m=f=>{p.current||s(f.currentTarget)},g=()=>{s(null)},d=!!n;return(0,U.useMemo)(()=>o!=="Search"?null:U.default.createElement(M,{id:"maxaiSearchWithAIAdvanced",sx:{width:"44px",height:"44px",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",border:"1px solid #EBEBEB",cursor:"pointer",borderColor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.16)":"#EBEBEB",bgcolor:f=>f.palette.mode==="dark"?"#333":"#fff",boxShadow:"0px 0px 0.5px 0px rgba(0, 0, 0, 0.40), 0px 1px 3px 0px rgba(0, 0, 0, 0.09), 0px 4px 8px 0px rgba(0, 0, 0, 0.09);",...t},"aria-owns":d?"mouse-over-popover":void 0,"aria-haspopup":"true",onMouseEnter:f=>{l.current&&clearTimeout(l.current),i.current=!0,l.current=setTimeout(()=>{i.current=!1},700),m(f)},onMouseLeave:()=>{g(),p.current=!1}},U.default.createElement(Le,{sx:{color:"text.primary",fontSize:"24px"},icon:"Tune"}),U.default.createElement(jt,{open:d,anchorEl:n,id:"mouse-over-popover",anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"bottom",horizontal:"right"},disableScrollLock:!0,PaperProps:{sx:{ml:Ne()?0:"8px"}}},U.default.createElement(Yt.default,{onClickAway:f=>{let T=q()?.querySelector("#maxaiSearchWithAIAdvancedCard");if(T){let L=T.getBoundingClientRect(),v=f.clientX,j=f.clientY;if(v>L.left&&v<L.right&&j>L.top&&j<L.bottom)return;g()}}},U.default.createElement(M,{onMouseEnter:m,onMouseLeave:g},U.default.createElement(M,{id:"maxaiSearchWithAIAdvancedCard",sx:{borderRadius:"4px",border:"1px solid #EBEBEB",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.16)",width:434,display:"flex",alignItems:"stretch",justifyContent:"center",flexDirection:"row"}},U.default.createElement(c,{spacing:1,p:1,width:"100%"},U.default.createElement(c,{direction:"row",mb:1},U.default.createElement(_,{fontSize:"16px",fontWeight:600,color:"text.primary"},r("client:sidebar__search_with_ai__advanced__title"))),U.default.createElement(c,{spacing:2,width:"100%"},U.default.createElement(wi,null),U.default.createElement(ki,null)),U.default.createElement(c,{sx:{minHeight:"28px"},width:"100%",spacing:1,alignItems:"center",direction:"row",justifyContent:"end",flexDirection:"row"},U.default.createElement(ne,{onClick:()=>{i.current||(p.current=!0,g())}},U.default.createElement(Le,{icon:"Close",sx:{fontSize:"24px"}}))))))))),[a.sidebarSettings?.common?.currentAIProvider,d,o])},Oi=Us;var Di=u(h());var Rs=()=>Di.default.createElement(c,{sx:{width:"100%",position:"sticky",top:0,transform:"translateY(0%)"}}),Bi=Rs;var Q=u(h());var Ni=u(Fi()),Hi=u(Vi());var Zs=()=>{let{currentSidebarAIProvider:e,currentSidebarConversationId:t,currentSidebarConversationType:r,currentSidebarConversation:o,sidebarSettings:a}=k(),n=Me(dt),s=Me(zt),[l]=Ve(So),[i,p]=(0,Q.useState)(!0),m=(0,Q.useMemo)(()=>{let g=Mt(o);return g&&(g.messages=[]),g},[o]);return Q.default.createElement(c,{sx:{position:"absolute",top:"0",maxWidth:i?"400px":"32px",maxHeight:i?"500px":"32px",overflowX:"auto",overflowY:"auto",zIndex:1,bgcolor:"background.paper",color:"text.primary",right:"100%",border:"1px solid",borderColor:"customColor.borderColor",borderRadius:"4px","& > pre, & > p":{p:0,m:0,fontSize:"12px"}}},i?Q.default.createElement(G,{variant:"contained",sx:{width:32,height:32,minWidth:"unset",position:"absolute",top:0,right:0,p:1},onClick:()=>p(!1)},Q.default.createElement(Ni.default,null)):Q.default.createElement(G,{variant:"contained",sx:{width:32,height:32,minWidth:"unset",position:"absolute",top:0,right:0,p:1},onClick:()=>p(!0)},Q.default.createElement(Hi.default,null)),Q.default.createElement(c,{direction:"row",spacing:1},Q.default.createElement(G,{onClick:async g=>{await ho()}},"Reset OnBoarding")),Q.default.createElement("p",null,"authStatus: ",l.status),Q.default.createElement("p",null,"loading: ",s.loading?"loading":"done"),Q.default.createElement("p",null,"currentSidebarConversationType: ",r),Q.default.createElement("p",null,"currentSidebarAIProvider: ",e),Q.default.createElement("p",null,"currentSidebarConversationId: ",t),Q.default.createElement("pre",null,JSON.stringify(m,null,2)),Q.default.createElement("pre",null,JSON.stringify(a,null,2)),Q.default.createElement("pre",null,JSON.stringify(n.thirdProviderSettings,null,2)))},zi=Zs;var Gi=y.default.lazy(()=>import("./DF3U6FFQ.js")),Wi="message-list-container",Ui="scroll-message-container",el=e=>{let{sx:t,aiAvatar:r,userAvatar:o,onCopy:a,onQuestionUpdate:n,editAble:s=!0,insertAble:l=!0,reGenerateAble:i=!0,onReGenerate:p,onStopGenerate:m,onSendMessage:g,writingMessage:d,messages:f,onRetry:T,onReset:L,loading:v}=e,[j,N]=(0,y.useState)(!1),{t:X}=P(["common","client"]),ie=(0,y.useRef)(null),[F,ee]=y.default.useState(!1),{slicedMessageList:I,changePageNumber:R}=ui(Ui,Wi,f),{currentSidebarConversationType:V}=k(),H=(0,y.useRef)(!0),z=(0,y.useCallback)((C,w)=>{R(1),g&&g(C,w)},[g,R]);(0,y.useEffect)(()=>{let C=ie.current;if(!C)return;let x=kt(J=>{if(J.deltaY<0){H.current=!1;return}let be=C.scrollTop,Re=C.scrollHeight;C.clientHeight+be>=Re&&(H.current=!0)},100);return C.addEventListener("wheel",x),()=>C.removeEventListener("wheel",x)},[]),(0,y.useEffect)(()=>{let C=ie.current;H.current&&C&&C.scrollTo(0,C.scrollHeight)},[d]),(0,y.useEffect)(()=>{if(v){let C=f[f.length-1];if(C&&C.type==="ai"){let w=C?.originalMessage;if(w&&(w.metadata?.shareType==="search"||w.metadata?.shareType==="summary")){let x=ie.current;H.current&&x&&x.scrollTo(0,x.scrollHeight)}}}},[v,f]);let ve=(0,y.useRef)("");(0,y.useEffect)(()=>{if(f.length>0){ee(f[f.length-1].type==="ai");for(let C=f.length-1;C>=0;C--){let w=f[C];if(w){let x=ie.current;ve.current&&ve.current!==w.messageId&&(H.current=!0,setTimeout(()=>{x&&x.scrollTo(0,x.scrollHeight)},0)),ve.current=w.messageId;break}}}},[f]),(0,y.useEffect)(()=>{let C=()=>{let w=ie.current;w&&(H.current&&w.scrollTo(0,w.scrollHeight),setTimeout(()=>{H.current&&w.scrollTo(0,w.scrollHeight)},1e3))};return C(),window.addEventListener("focus",C),()=>window.removeEventListener("focus",C)},[]);let ct=(0,y.useMemo)(()=>{if(V==="Chat"&&I.length>0){let C=I[f.length-1];if(C&&C.type==="ai"&&C?.originalMessage?.metadata?.shareType==="search")return!1}return!0},[I,V]);return y.default.createElement(c,{id:"maxAISidebarChatBox",position:"relative",sx:{height:0,flex:1,"& .MuiButton-root":{textTransform:"none"},...t}},y.default.createElement(M,{ref:ie,flex:1,height:0,sx:{textAlign:"left",overflowY:"auto"},id:Ui},y.default.createElement(hi,null),y.default.createElement(ma,null,y.default.createElement(zi,null)),y.default.createElement(Bi,null),y.default.createElement(M,{id:Wi},y.default.createElement(Ro,null,I.map((C,w)=>y.default.createElement(Gi,{className:`use-chat-gpt-ai__message-item use-chat-gpt-ai__message-item--${C.type}`,insertAble:l,replaceAble:!0,message:C,aiAvatar:r,editAble:s,userAvatar:o,useChatGPTAble:!0,key:C.messageId+"_sidebar_chat_message_"+String(w),onSave:x=>{n&&n(C.messageId,x)},onRetry:T,onCopy:a})),d&&y.default.createElement(Gi,{className:"use-chat-gpt-ai__writing-message-item",replaceAble:!1,insertAble:!1,message:d,useChatGPTAble:!1,aiAvatar:r,editAble:!1,userAvatar:o})))),y.default.createElement(c,{className:"use-chat-gpt-ai__chat-box__input-box",position:"relative",mt:"auto",justifyContent:"center",alignItems:"center",minHeight:60,spacing:1,p:1,flexShrink:0},y.default.createElement(c,{width:"100%",alignItems:"center",justifyContent:"center"},y.default.createElement(M,{sx:{width:"100%"},component:"div",display:"flex",width:0,flex:1,alignItems:"center",justifyContent:"center",gap:1,mb:1,position:"relative"},y.default.createElement(di,{disabledMainButton:v,onClick:async C=>{if(C==="focus"){let w=q()?.querySelector(`#${Ft}`);w&&w.focus()}else C==="new"?L&&L():C==="restart"&&await yo()}}),y.default.createElement(fi,{sx:{position:"absolute",bottom:0,right:0}}),y.default.createElement(Oi,{sx:{position:"absolute",bottom:0,right:0}}),!v&&I.length>0&&ct&&y.default.createElement(y.default.Fragment,null,i&&y.default.createElement(G,{disableElevation:!0,startIcon:y.default.createElement(Ri.default,null),variant:"outlined",disabled:v,onClick:()=>{p&&p()}},X("client:sidebar__button__regenerate")),F&&V!=="Search"&&y.default.createElement(G,{disableElevation:!0,startIcon:y.default.createElement(Le,{icon:"FastForward"}),variant:"outlined",disabled:v,onClick:()=>{z&&z("Continue",{includeHistory:!0,regenerate:!1})}},X("client:sidebar__button__continue"))),v&&y.default.createElement(G,{sx:{mb:1},disableElevation:!0,variant:"outlined",startIcon:y.default.createElement(ji.default,null),onClick:()=>{m&&m()}},X("client:sidebar__button__stop_generating"))),y.default.createElement(Ti,{onClose:()=>{N(!1)},onShow:()=>N(!0),modelKey:"Sidebar"}),y.default.createElement(Go,{sx:{minHeight:j?0:80,height:j?"0!important":"unset",visibility:j?"hidden":"visible"},stopPropagation:!0,loading:v,expandNode:V==="Chat"?y.default.createElement(jo,{direction:"column",size:"small"}):null,onEnter:z},y.default.createElement(mi,{onSendMessage:z}))),y.default.createElement(Ei,null)))},qi=el;var tl=()=>{let{currentSidebarConversationType:e}=k(),{createSearchWithAI:t,regenerateSearchWithAI:r}=Wo(),{sendQuestion:o,conversation:a,reGenerate:n,retryMessage:s,stopGenerateMessage:l,resetConversation:i}=Fo(""),{smoothConversationLoading:p}=Jt(),{currentSidebarConversationMessages:m}=k();return(0,Et.useEffect)(()=>{co()},[]),Et.default.createElement(c,{flex:1,height:0,position:"relative"},Et.default.createElement(Bo,null),Et.default.createElement(qi,{editAble:!1,insertAble:!1,onSendMessage:async(g,d)=>{e==="Search"?await t(g,!0):await o({question:g},{...d,regenerate:!1,includeHistory:d.includeHistory===!0})},writingMessage:a.writingMessage,messages:m,loading:p,title:"Chat Draft",onRetry:s,onReGenerate:async()=>{if(e==="Summary"&&m.length===1){await i();return}e==="Search"?await r():await n()},onStopGenerate:l,onReset:i}))},K_=tl;export{K_ as default};
/*! Bundled license information:

@mui/lab/index.js:
  (**
   * @mui/lab v5.0.0-alpha.153
   *
   * @license MIT
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
