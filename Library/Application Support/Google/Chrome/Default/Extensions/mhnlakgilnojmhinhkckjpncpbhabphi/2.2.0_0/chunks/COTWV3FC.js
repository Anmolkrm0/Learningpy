import{a as uo,b as fo}from"./MJNORM6I.js";import{a as so}from"./HSAMI7BK.js";import{a as On}from"./UWBZO3WW.js";import{a as ao,c as pr,d as co,e as dr,h as lo}from"./4NAB6M5G.js";import{b as zr}from"./AVRUINLW.js";import{$a as dt,A as Gr,Ab as io,B as $n,Ea as ro,Fa as no,G as Qn,O as qr,Q as Dt,R as lr,S as jn,T as Kn,X as fr,Z as Xn,aa as mr,b as Bn,ba as Jn,c as Vt,gb as ke,o as er,p as zn,q as De,r as Wn,s as Ue,za as eo}from"./QXSPNHGD.js";import{h as to}from"./3NC6GYYS.js";import{i as qn}from"./773OEKYN.js";import{d as Ri}from"./SH2AV755.js";import{a as Br}from"./PGNR3OFA.js";import{d as Hn}from"./BEC6NYYF.js";import{a as ur,b as Oi}from"./JUQUTDV2.js";import{j as Li}from"./QZVUH6Z4.js";import{$ as Zn,_ as Yn,fa as oo}from"./XNIWJ77D.js";import{c as cr,d as Nn,e as tr}from"./7ADITARJ.js";import{a as Vn}from"./GDFPIX4S.js";import{D as kn,E as ar,R as Fn,a as it,c as Rn,j as Dn,p as Re,t as Un,w as sr}from"./MT7GI5KY.js";import{c as Gn}from"./QPPETRF6.js";import{d as In,e as Sn,f as Zt,g as _n,i as wn,k as Pn,m as Hr,n as Mn,p as Ln,r as Jt,t as Je}from"./BIAAAE54.js";import{M as Ze,O as bn,P as Oe,e as vn,p as Nr}from"./T463YMPS.js";import{G as Cn,H as kr,K as Fr,S as ir,T as xn,c as yn,e as Tt,f as An,k as Tn,p as Rt,q as Yt,u as En}from"./LZHALC2F.js";import{a as Gt}from"./64D36THL.js";import{c as _t,f as Ct,h as z}from"./PQ35KENF.js";var Vi=_t(gr=>{"use strict";var Gi=Oi();Object.defineProperty(gr,"__esModule",{value:!0});gr.default=void 0;var qi=Gi(Ri()),zi=Li(),Wi=(0,qi.default)((0,zi.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");gr.default=Wi});var Go=_t(Tr=>{"use strict";Tr.byteLength=Ji;Tr.toByteArray=es;Tr.fromByteArray=os;var Nt=[],wt=[],Zi=typeof Uint8Array<"u"?Uint8Array:Array,Yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(he=0,Ho=Yr.length;he<Ho;++he)Nt[he]=Yr[he],wt[Yr.charCodeAt(he)]=he;var he,Ho;wt["-".charCodeAt(0)]=62;wt["_".charCodeAt(0)]=63;function Bo(s){var r=s.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=s.indexOf("=");o===-1&&(o=r);var e=o===r?0:4-o%4;return[o,e]}function Ji(s){var r=Bo(s),o=r[0],e=r[1];return(o+e)*3/4-e}function ts(s,r,o){return(r+o)*3/4-o}function es(s){var r,o=Bo(s),e=o[0],t=o[1],n=new Zi(ts(s,e,t)),i=0,a=t>0?e-4:e,f;for(f=0;f<a;f+=4)r=wt[s.charCodeAt(f)]<<18|wt[s.charCodeAt(f+1)]<<12|wt[s.charCodeAt(f+2)]<<6|wt[s.charCodeAt(f+3)],n[i++]=r>>16&255,n[i++]=r>>8&255,n[i++]=r&255;return t===2&&(r=wt[s.charCodeAt(f)]<<2|wt[s.charCodeAt(f+1)]>>4,n[i++]=r&255),t===1&&(r=wt[s.charCodeAt(f)]<<10|wt[s.charCodeAt(f+1)]<<4|wt[s.charCodeAt(f+2)]>>2,n[i++]=r>>8&255,n[i++]=r&255),n}function rs(s){return Nt[s>>18&63]+Nt[s>>12&63]+Nt[s>>6&63]+Nt[s&63]}function ns(s,r,o){for(var e,t=[],n=r;n<o;n+=3)e=(s[n]<<16&16711680)+(s[n+1]<<8&65280)+(s[n+2]&255),t.push(rs(e));return t.join("")}function os(s){for(var r,o=s.length,e=o%3,t=[],n=16383,i=0,a=o-e;i<a;i+=n)t.push(ns(s,i,i+n>a?a:i+n));return e===1?(r=s[o-1],t.push(Nt[r>>2]+Nt[r<<4&63]+"==")):e===2&&(r=(s[o-2]<<8)+s[o-1],t.push(Nt[r>>10]+Nt[r>>4&63]+Nt[r<<2&63]+"=")),t.join("")}});var Wo=_t((ef,zo)=>{function Pt(s,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(s)),this._timeouts=s,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}zo.exports=Pt;Pt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Pt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Pt.prototype.retry=function(s){if(this._timeout&&clearTimeout(this._timeout),!s)return!1;var r=new Date().getTime();if(s&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(s),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(s);var o=this._timeouts.shift();if(o===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),o=this._cachedTimeouts.slice(-1);else return!1;var e=this;return this._timer=setTimeout(function(){e._attempts++,e._operationTimeoutCb&&(e._timeout=setTimeout(function(){e._operationTimeoutCb(e._attempts)},e._operationTimeout),e._options.unref&&e._timeout.unref()),e._fn(e._attempts)},o),this._options.unref&&this._timer.unref(),!0};Pt.prototype.attempt=function(s,r){this._fn=s,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var o=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){o._operationTimeoutCb()},o._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Pt.prototype.try=function(s){this.attempt(s)};Pt.prototype.start=function(s){this.attempt(s)};Pt.prototype.start=Pt.prototype.try;Pt.prototype.errors=function(){return this._errors};Pt.prototype.attempts=function(){return this._attempts};Pt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var s={},r=null,o=0,e=0;e<this._errors.length;e++){var t=this._errors[e],n=t.message,i=(s[n]||0)+1;s[n]=i,i>=o&&(r=t,o=i)}return r}});var Vo=_t(ge=>{var us=Wo();ge.operation=function(s){var r=ge.timeouts(s);return new us(r,{forever:s&&(s.forever||s.retries===1/0),unref:s&&s.unref,maxRetryTime:s&&s.maxRetryTime})};ge.timeouts=function(s){if(s instanceof Array)return[].concat(s);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var o in s)r[o]=s[o];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],t=0;t<r.retries;t++)e.push(this.createTimeout(t,r));return s&&s.forever&&!e.length&&e.push(this.createTimeout(t,r)),e.sort(function(n,i){return n-i}),e};ge.createTimeout=function(s,r){var o=r.randomize?Math.random()+1:1,e=Math.round(o*Math.max(r.minTimeout,1)*Math.pow(r.factor,s));return e=Math.min(e,r.maxTimeout),e};ge.wrap=function(s,r,o){if(r instanceof Array&&(o=r,r=null),!o){o=[];for(var e in s)typeof s[e]=="function"&&o.push(e)}for(var t=0;t<o.length;t++){var n=o[t],i=s[n];s[n]=function(f){var p=ge.operation(r),c=Array.prototype.slice.call(arguments,1),u=c.pop();c.push(function(l){p.retry(l)||(l&&(arguments[0]=p.mainError()),u.apply(this,arguments))}),p.attempt(function(){f.apply(s,c)})}.bind(s,i),s[n].options=r}}});var Qo=_t((nf,$o)=>{$o.exports=Vo()});var Ko=_t((of,Cr)=>{"use strict";var ls=Qo(),fs=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],Er=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}},ms=(s,r,o)=>{let e=o.retries-(r-1);return s.attemptNumber=r,s.retriesLeft=e,s},ps=s=>fs.includes(s),jo=(s,r)=>new Promise((o,e)=>{r={onFailedAttempt:()=>{},retries:10,...r};let t=ls.operation(r);t.attempt(async n=>{try{o(await s(n))}catch(i){if(!(i instanceof Error)){e(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof Er)t.stop(),e(i.originalError);else if(i instanceof TypeError&&!ps(i.message))t.stop(),e(i);else{ms(i,n,r);try{await r.onFailedAttempt(i)}catch(a){e(a);return}t.retry(i)||e(t.mainError())}}})});Cr.exports=jo;Cr.exports.default=jo;Cr.exports.AbortError=Er});var Yo=_t((sf,tn)=>{"use strict";var ds=Object.prototype.hasOwnProperty,Et="~";function rr(){}Object.create&&(rr.prototype=Object.create(null),new rr().__proto__||(Et=!1));function hs(s,r,o){this.fn=s,this.context=r,this.once=o||!1}function Xo(s,r,o,e,t){if(typeof o!="function")throw new TypeError("The listener must be a function");var n=new hs(o,e||s,t),i=Et?Et+r:r;return s._events[i]?s._events[i].fn?s._events[i]=[s._events[i],n]:s._events[i].push(n):(s._events[i]=n,s._eventsCount++),s}function xr(s,r){--s._eventsCount===0?s._events=new rr:delete s._events[r]}function gt(){this._events=new rr,this._eventsCount=0}gt.prototype.eventNames=function(){var r=[],o,e;if(this._eventsCount===0)return r;for(e in o=this._events)ds.call(o,e)&&r.push(Et?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(o)):r};gt.prototype.listeners=function(r){var o=Et?Et+r:r,e=this._events[o];if(!e)return[];if(e.fn)return[e.fn];for(var t=0,n=e.length,i=new Array(n);t<n;t++)i[t]=e[t].fn;return i};gt.prototype.listenerCount=function(r){var o=Et?Et+r:r,e=this._events[o];return e?e.fn?1:e.length:0};gt.prototype.emit=function(r,o,e,t,n,i){var a=Et?Et+r:r;if(!this._events[a])return!1;var f=this._events[a],p=arguments.length,c,u;if(f.fn){switch(f.once&&this.removeListener(r,f.fn,void 0,!0),p){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,o),!0;case 3:return f.fn.call(f.context,o,e),!0;case 4:return f.fn.call(f.context,o,e,t),!0;case 5:return f.fn.call(f.context,o,e,t,n),!0;case 6:return f.fn.call(f.context,o,e,t,n,i),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];f.fn.apply(f.context,c)}else{var l=f.length,m;for(u=0;u<l;u++)switch(f[u].once&&this.removeListener(r,f[u].fn,void 0,!0),p){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,o);break;case 3:f[u].fn.call(f[u].context,o,e);break;case 4:f[u].fn.call(f[u].context,o,e,t);break;default:if(!c)for(m=1,c=new Array(p-1);m<p;m++)c[m-1]=arguments[m];f[u].fn.apply(f[u].context,c)}}return!0};gt.prototype.on=function(r,o,e){return Xo(this,r,o,e,!1)};gt.prototype.once=function(r,o,e){return Xo(this,r,o,e,!0)};gt.prototype.removeListener=function(r,o,e,t){var n=Et?Et+r:r;if(!this._events[n])return this;if(!o)return xr(this,n),this;var i=this._events[n];if(i.fn)i.fn===o&&(!t||i.once)&&(!e||i.context===e)&&xr(this,n);else{for(var a=0,f=[],p=i.length;a<p;a++)(i[a].fn!==o||t&&!i[a].once||e&&i[a].context!==e)&&f.push(i[a]);f.length?this._events[n]=f.length===1?f[0]:f:xr(this,n)}return this};gt.prototype.removeAllListeners=function(r){var o;return r?(o=Et?Et+r:r,this._events[o]&&xr(this,o)):(this._events=new rr,this._eventsCount=0),this};gt.prototype.off=gt.prototype.removeListener;gt.prototype.addListener=gt.prototype.on;gt.prefixed=Et;gt.EventEmitter=gt;typeof tn<"u"&&(tn.exports=gt)});var Jo=_t((af,Zo)=>{"use strict";Zo.exports=(s,r)=>(r=r||(()=>{}),s.then(o=>new Promise(e=>{e(r())}).then(()=>o),o=>new Promise(e=>{e(r())}).then(()=>{throw o})))});var ei=_t((cf,br)=>{"use strict";var gs=Jo(),vr=class extends Error{constructor(r){super(r),this.name="TimeoutError"}},ti=(s,r,o)=>new Promise((e,t)=>{if(typeof r!="number"||r<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(r===1/0){e(s);return}let n=setTimeout(()=>{if(typeof o=="function"){try{e(o())}catch(f){t(f)}return}let i=typeof o=="string"?o:`Promise timed out after ${r} milliseconds`,a=o instanceof Error?o:new vr(i);typeof s.cancel=="function"&&s.cancel(),t(a)},r);gs(s.then(e,t),()=>{clearTimeout(n)})});br.exports=ti;br.exports.default=ti;br.exports.TimeoutError=vr});var ri=_t(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});function ys(s,r,o){let e=0,t=s.length;for(;t>0;){let n=t/2|0,i=e+n;o(s[i],r)<=0?(e=++i,t-=n+1):t=n}return e}en.default=ys});var ni=_t(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});var As=ri(),rn=class{constructor(){this._queue=[]}enqueue(r,o){o=Object.assign({priority:0},o);let e={priority:o.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=o.priority){this._queue.push(e);return}let t=As.default(this._queue,e,(n,i)=>i.priority-n.priority);this._queue.splice(t,0,e)}dequeue(){let r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(o=>o.priority===r.priority).map(o=>o.run)}get size(){return this._queue.length}};nn.default=rn});var ii=_t(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});var Ts=Yo(),oi=ei(),Es=ni(),Ir=()=>{},Cs=new oi.TimeoutError,on=class extends Ts{constructor(r){var o,e,t,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Ir,this._resolveIdle=Ir,r=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:Es.default},r),!(typeof r.intervalCap=="number"&&r.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(e=(o=r.intervalCap)===null||o===void 0?void 0:o.toString())!==null&&e!==void 0?e:""}\` (${typeof r.intervalCap})`);if(r.interval===void 0||!(Number.isFinite(r.interval)&&r.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(n=(t=r.interval)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof r.interval})`);this._carryoverConcurrencyCount=r.carryoverConcurrencyCount,this._isIntervalIgnored=r.intervalCap===1/0||r.interval===0,this._intervalCap=r.intervalCap,this._interval=r.interval,this._queue=new r.queueClass,this._queueClass=r.queueClass,this.concurrency=r.concurrency,this._timeout=r.timeout,this._throwOnTimeout=r.throwOnTimeout===!0,this._isPaused=r.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Ir,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Ir,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let r=Date.now();if(this._intervalId===void 0){let o=this._intervalEnd-r;if(o<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},o)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let r=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let o=this._queue.dequeue();return o?(this.emit("active"),o(),r&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(r){if(!(typeof r=="number"&&r>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${r}\` (${typeof r})`);this._concurrency=r,this._processQueue()}async add(r,o={}){return new Promise((e,t)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&o.timeout===void 0?r():oi.default(Promise.resolve(r()),o.timeout===void 0?this._timeout:o.timeout,()=>{(o.throwOnTimeout===void 0?this._throwOnTimeout:o.throwOnTimeout)&&t(Cs)});e(await i)}catch(i){t(i)}this._next()};this._queue.enqueue(n,o),this._tryToStartAnother(),this.emit("add")})}async addAll(r,o){return Promise.all(r.map(async e=>this.add(e,o)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(r=>{let o=this._resolveEmpty;this._resolveEmpty=()=>{o(),r()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(r=>{let o=this._resolveIdle;this._resolveIdle=()=>{o(),r()}})}get size(){return this._queue.size}sizeBy(r){return this._queue.filter(r).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(r){this._timeout=r}};sn.default=on});var Q=Ct(Gt());var Wr=Ct(Gt());var mo=(s,r)=>{let o,e;return function(){let t=arguments,n=this;return o||(o=!0,setTimeout(()=>o=!1,r),e=s.apply(n,t)),e}};var te=Ct(Gt());var Di=s=>{let[r,o]=(0,te.useState)(""),{currentAIProviderModelDetail:e}=mr(),t=(0,te.useMemo)(()=>{let i=e?.maxTokens||4e3;return Math.floor(i/1e3)*1e3},[e]),n=(0,te.useMemo)(()=>r.length>t,[r,t]);return(0,te.useEffect)(()=>{let i=a=>{a.startsWith("``NO_HISTORY_&#``\n")&&(a=a.replace("``NO_HISTORY_&#``\n","")),o(a)};return dt(s).subscribe(i),()=>{dt(s).unsubscribe(i)}},[]),{currentMaxInputLength:t,isError:n}},po=Di;var Ui=()=>Math.max(Math.floor(window.innerHeight*.5/24)||5),Ne=24,Fe=(s,r=0,o=0)=>{let e=s?.parentElement?.parentElement;if(s&&e){let t=window.getComputedStyle(s),n=parseInt(t.paddingTop,10)+parseInt(t.paddingBottom,10);s.style.cssText="height:0px";let i=s.value?s.scrollHeight:Ne+n,a=Math.min(Ne*Ui(),i);o===0&&(o=s?.previousElementSibling?.offsetHeight||0);let f=Math.max(Ne,o||0);a=Math.max(f,a),s.style.cssText=`height: ${a}px`;let p=a+r;e.style.cssText=`height: ${p}px`}},ki=(s,r=0,o=0)=>{Fe(s,r,o),setTimeout(()=>{Fe(s,r,o);let e=s.value;s.focus(),s.setSelectionRange(e.length,e.length)},100)},ee=(s,r=0,o=0)=>{let e="",t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&(e="mui",t.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(e="linkedin",n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}s.isSameNode(In())||s.isSameNode(Sn())||ki(s,r,o)},Fi=s=>{},Ni=s=>{let r=Tt(ir),o=Tt(eo),e=Tt(Vt),{defaultValue:t,onChange:n,onEnter:i,onKeydown:a,loading:f,children:p,error:c=!1,InputId:u=Rt,stopPropagation:l=!0,placeholder:m="Ask AI...",expandNode:y,sx:x}=s,{isError:w}=po(Yt===u?"floatingMenuInputMediator":"chatBoxInputMediator"),C=(0,Q.useRef)(null),k=(0,Q.useRef)(!1),L=(0,Q.useRef)(!1),[M,D]=(0,Q.useState)(t||""),E=(0,Q.useRef)(0),O=(0,Q.useRef)(0),g=(0,Q.useRef)(null),h=(0,Q.useRef)(null),v=(0,Q.useMemo)(()=>mo(Fe,200),[]),b=T=>[E.current,O.current],I=(0,Q.useCallback)(T=>{let _=T.target.value;u===Rt?dt("chatBoxInputMediator").updateInputValue(_):u===Yt?dt("floatingMenuInputMediator").updateInputValue(_):D(_),n&&n(_,{includeHistory:!L.current})},[n]),S=(0,Q.useRef)({});return(0,Q.useEffect)(()=>{if(u===Rt){let T=(_,A)=>{A&&(S.current=A),_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),D(_)};return dt("chatBoxInputMediator").subscribe(T),()=>{dt("chatBoxInputMediator").unsubscribe(T)}}if(u===Yt){let T=_=>{_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),D(_)};return dt("floatingMenuInputMediator").subscribe(T),()=>{dt("floatingMenuInputMediator").unsubscribe(T)}}return()=>{}},[]),(0,Q.useEffect)(()=>{L.current=!1,S.current={}},[e.loading]),(0,Q.useEffect)(()=>{v(C.current,...b("inputValue1")),setTimeout(()=>{C.current&&Fe(C.current,...b("inputValue2"))},0)},[M]),(0,Q.useEffect)(()=>{let T=new ResizeObserver(A=>{for(let d of A)setTimeout(()=>{E.current=d.target?.offsetHeight||0,C.current&&Fe(C.current,...b("children"))},100)}),_=new ResizeObserver(A=>{for(let d of A)setTimeout(()=>{O.current=d.target?.offsetHeight||0,C.current&&Fe(C.current,...b("expand"))},100)});return h.current&&_.observe(h.current),g.current&&T.observe(g.current),()=>{T.disconnect(),_.disconnect()}},[]),(0,Q.useEffect)(()=>{o.open&&C.current&&u===Yt&&ee(C.current,...b("floatingDropdownMenu"))},[o.open]),(0,Q.useEffect)(()=>{r.open&&C.current&&u===Rt&&!ke()&&ee(C.current,...b("appState"))},[r.open,f]),ar(()=>{u===Rt&&On()&&setTimeout(()=>{ee(C.current,...b("appState"))},100)}),Q.default.createElement(Br,{component:"div",className:f?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${w||c?"rgb(239, 83, 80)":"customColor.borderColor"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{maxHeight:"30px",opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...x}},Q.default.createElement(Br,{component:"div",className:"chat-box__input-skeleton"},Q.default.createElement(Qn,{height:Ne})),Q.default.createElement(ur,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,color:T=>T.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",minHeight:Ne+"px",lineHeight:Ne+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},Q.default.createElement(ur,{ref:h,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"end"}},y),Q.default.createElement("textarea",{id:u,placeholder:m,disabled:f,ref:C,value:M,rows:1,onCopy:T=>{T.stopPropagation()},onCut:T=>{T.stopPropagation()},onPaste:T=>{T.stopPropagation()},onKeyUp:T=>{l&&T.stopPropagation()},onKeyPress:T=>{l&&T.stopPropagation()},onKeyDown:T=>{if(l){if(T.key==="ArrowUp"||T.key==="ArrowDown"||T.key==="ArrowLeft"||T.key==="ArrowRight"||T.key==="Escape")return;T.stopPropagation()}if(!k.current){if(!(T.key==="Enter"&&T.shiftKey)){if(T.key==="Enter")i&&i(T.currentTarget.value,{includeHistory:!L.current,meta:S.current}),L.current=!1,S.current={},T.preventDefault();else if(T.code==="Space"){T.stopPropagation();return}}a&&a(T)}},onClick:T=>{ee(T.currentTarget,...b("click"))},onCompositionUpdate:T=>{l&&T.stopPropagation()},onCompositionStart:T=>{l&&T.stopPropagation(),k.current=!0},onCompositionEnd:T=>{l&&T.stopPropagation(),k.current=!1,I(T)},onInput:T=>{l&&T.stopPropagation(),k.current?D(T.currentTarget.value):I(T)},onBlur:T=>{v(T.currentTarget,...b("blur")),Fi(T.currentTarget)}})),Q.default.createElement(ur,{ref:g,width:"100%"},p))},ua=Ni;var je=Ct(Gt());var Vr=class{constructor(r,o,e,t){this.id=r,this.type=o,this.status="idle",this.parameters=Object.assign({},e)||{},this.autoExecute=t}async execute(r,o){this.status="running",this.error="",this.output="",this.status="complete"}async pushMessageToChat(r,o){if(o&&o.getChartGPT()?.pushMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.pushMessage(r,e)}}async deleteMessageFromChat(r,o){if(o&&o.getChartGPT()?.deleteMessage){let e=this.getCurrentConversationId(o);await o.getChartGPT()?.deleteMessage(r,e)}}reset(){this.status="idle",this.error="",this.output=""}getCurrentConversationId(r){return r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||""}getCurrentSidebarType(r){return r.getChartGPT()?.getSidebarRef()?.currentSidebarSettingsRef?.current?.type||"Chat"}getNextAction(r){return r?.getShortCutsEngine()?.getNextAction()}getPrevAction(r){return r?.getShortCutsEngine()?.getPrevAction()}async getCurrentConversation(r){let o=r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||"";return o?await Jn(o):null}async updateConversation(r,o){let e=this.getCurrentConversationId(r);await Wn(e,o)}},B=Vr;var He=(s,r)=>{try{return{data:s.replace(/\{\{(.+?)\}\}/g,(e,t)=>{let n=t.trim().split("."),i=r;for(;n.length;){let a=n.shift();if(Object.prototype.hasOwnProperty.call(i,a))i=i[a];else{i="";break}}return i}),error:""}}catch{return{data:"",error:"parse template error"}}};function j(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;if(i.parameters?.template){let a=He(i.parameters?.template||"",n);a.error?(i.error=a.error,i.parameters.compliedTemplate=""):i.parameters.compliedTemplate=a.data}await e.apply(this,t)}}}function Be(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;zn(i.parameters,(a,f)=>{if(typeof f=="string"){let p=He(f,n).data;try{let c=JSON.parse(p);Re(i.parameters,a,c)}catch{Re(i.parameters,a,p)}}}),await e.apply(this,t)}}}function V({onlySuccess:s,onlyError:r}={onlySuccess:!1,onlyError:!1}){return function(o,e,t){let n=t.value;t.value=async function(...i){let[,a]=i,f=this,p=await n.apply(this,i),c=a.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;return f.error&&!s?a.getChartGPT()?.pushMessage({type:"system",text:f.error,messageId:it(),extra:{status:"error"},conversationId:c}):f.output&&!r&&a.getChartGPT()?.pushMessage({type:"system",text:f.output,messageId:it(),extra:{status:"success"}},c),p}}}function ht(){return function(s,r,o){let e=o.value;o.value=async function(...t){let[,n]=t;n.getChartGPT()?.showLoading();let i=await e.apply(this,t);return n.getChartGPT()?.hideLoading(),i}}}function hr(s=!0){return function(r,o,e){let t=e.value;e.value=async function(...n){let i=ke(),a="chatBoxInputMediator";if(i&&(a="floatingMenuInputMediator"),s)return dt(a).updateInputValue(""),await t.apply(this,n);{let f=await t.apply(this,n);return dt(a).updateInputValue(""),f}}}}var re=class extends B{static{this.type="GET_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=Yn(`<html>${document?.documentElement?.innerHTML}</html>`).document,t=Zn(e);t?t.success?this.output=t?.body||"":this.error=t?.body||"":this.error="No webpage contents",this.output||(this.output="",this.error="No webpage contents")}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],re.prototype,"execute",1);var ne=class extends B{static{this.type="SET_VARIABLE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableName||this.parameters.Variable||"";if(!e){this.error="Action no variable name!";return}let t=o.getShortCutsEngine();t&&t.setVariable&&(t.setVariable(e,this.parameters?.WFFormValues?.Value||r.LAST_ACTION_OUTPUT||"",!0),this.output=r.LAST_ACTION_OUTPUT||"")}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ne.prototype,"execute",1);var Ge=class extends B{static{this.type="OPERATION_ELEMENT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getBackgroundConversation(),t=this.parameters.OperationElementConfig||r.OperationElementConfig;if(!e||!t){this.error="Action cannot execute!";return}let n=this.parameters.OperationElementTabID||r.OperationElementTabID,a=(await e.postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:t,OperationElementTabID:n}})).data;a?.success?(t.successMessage&&await this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.successMessage,extra:{status:"info"}},o),t.actionType==="getText"?this.output=a.elementsInnerText:t.actionType==="getLink"&&(this.output=a.link)):t.errorMessage&&await this.pushMessageToChat({type:"system",messageId:it(),parentMessageId:"",text:t.errorMessage,extra:{status:"error"}},o)}catch(e){this.error=e.toString()}}};var qe=class extends B{static{this.type="SCRIPTS_CONDITIONAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=!1,t=this.parameters.WFCondition||r.WFCondition||void 0,n=this.parameters.WFMatchTextCaseSensitive!==!1,i=this.parameters.WFFormValues?.Value||"",a=r.LAST_ACTION_OUTPUT||"",f=this.parameters.WFConditionalIfTrueActions||[],p=this.parameters.WFConditionalIfFalseActions||[];switch(vn(i)?a=JSON.parse(a||"{}"):!n&&typeof i=="string"&&typeof a=="string"&&(i=i.toLocaleLowerCase(),a=a.toLocaleLowerCase()),t){case"Equals":e=Dn(i,a);break;case"Is Greater Than":e=Number(i)>Number(a);break;case"Is Less Than":e=Number(i)<Number(a);break;case"Contains":e=a.includes(String(i));break;case void 0:e=!a;break;default:break}if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(e?f:p,"after");else{this.error="no shortCutsEngine";return}}catch(e){this.error=e.toString()}}};var $r=class{constructor(){this.pending=new Map}async send(r,o,e=5*1e3){let t=it(),n={...o,uuid:t};return new Promise((i,a)=>{let f=setTimeout(()=>{this.pending.delete(t),a(new Error("Timeout Error"))},e);this.pending.set(t,p=>{clearTimeout(f),i(p)}),window.dispatchEvent(new CustomEvent(r,{detail:n}))})}receive(r,o){window.addEventListener(r,async e=>{if(e instanceof CustomEvent&&e.detail&&e.detail.uuid){let{uuid:t,...n}=e.detail,i,a=o(n);a instanceof Promise?i=await a:i=a;let f=this.pending.get(t);f&&(f(i),this.pending.delete(t))}})}},ho=new $r;var yo=(s,r,o,e)=>new Promise(t=>{let n=!1,i=setTimeout(()=>{n=!0,t(void 0)},e),a=setInterval(()=>{if(!n){let f=s.querySelector(r);f&&(clearInterval(a),clearTimeout(i),t(f))}},o)}),go=(s,r,o,e,t)=>new Promise(n=>{let i=!1,a=setTimeout(()=>{i=!0,n(void 0)},e),f=setInterval(()=>{if(!i){let p=Array.from(s.querySelectorAll(r));if(t){let c=t(p);c&&(clearInterval(f),clearTimeout(a),n(c))}else p.length>0&&(clearInterval(f),clearTimeout(a),n(p[0]))}},o)}),Hi=()=>new Promise(async s=>{let o=setTimeout(()=>{s({success:!1,error:"timeout"})},4e3),e=t=>{clearTimeout(o),s(t)};try{let t=document.getElementById(En)?.shadowRoot;if(t){let n=await go(t,".usechatgpt-ai__context-menu--handle-button",200,2e3,i=>i.find(a=>window.getComputedStyle(a).opacity!=="0"));if(n){setTimeout(()=>{n.click()},100);let i=await go(t,".floating-context-menu-item",50,2e3,a=>a.find(f=>f.innerText.startsWith("Run this prompt")));if(i){i.click(),e({success:!0,error:""});return}}}e({success:!1,error:"no context menu"})}catch(t){e({success:!1,error:t?.toString()||""})}}),Ba=Hi;var Eo=Ct(Gt());var Ao=Ct(Gt()),Bi=()=>{let{currentSidebarConversationMessages:s,currentSidebarConversationType:r}=Ue(),o=Tt(Vt),e=Tt(ro),t=[],n=e.lastAIMessageId;return(0,Ao.useMemo)(()=>{if(r==="Chat"){if(n||s.filter(a=>a.type==="ai").length===1&&(n="root"),n)for(let a=s.length-1;a>=0;a--){let f=s[a];if(f.messageId===n)break;f.type==="ai"&&t.unshift(f)}return o.writingMessage&&o.writingMessage.type==="ai"&&t.push(o.writingMessage),t.map(a=>a.text).join(`

`).replace(/\n{2,}/,`

`)}return""},[n,o.writingMessage,s,r])},To=Bi;var Qr=()=>{let s=Tt(ir),{currentSelection:r}=no(),{currentSidebarConversationMessages:o}=Ue(),e=To(),t=Tt(xn);return(0,Eo.useCallback)(()=>{let n="".replace(/<br\s*\/?>/gi,`
`).replace(/<\/?div[^>]*>/g,`
`).replace(/<[^>]+>/g,"").replace(/\u00ad/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/data:image\/(png|jpeg|gif);base64,\s?[A-Za-z0-9+/]+={0,2}/g,"").replace(/\n{3,}/g,`
`)||"",i=r?.selectionHTML||"",a=r?.selectionText||"",f=t.userSettings?.language||kr;f===Cn&&(f=kr);let p={GMAIL_EMAIL_CONTEXT:"",GMAIL_DRAFT_CONTEXT:n,SELECTED_HTML:i,SELECTED_TEXT:a,USER_INPUT:Zt()?.querySelector(`#${Rt}`)?.value||"",LAST_AI_OUTPUT:er(o,u=>u.type==="ai")?.text||"",AI_RESPONSE_LANGUAGE:f,AI_OUTPUT_LANGUAGE:f,CURRENT_WEBSITE_DOMAIN:typeof window<"u"?window.location.hostname:"",CURRENT_WEBPAGE_URL:typeof window<"u"?window.location.href:"",CURRENT_WEBPAGE_TITLE:typeof window<"u"?document.title:"",POPUP_DRAFT:e||""},c=[];return Object.keys(p).forEach(u=>{c.push({key:u,value:p[u],overwrite:!0})}),{builtInParameters:p,parameters:c,shortCutsParameters:Object.values(c)}},[s.env,r,t.userSettings,e])};var Co=Ct(Gt());var oe=class extends B{static{this.type="SET_VARIABLES_MODAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.SetVariablesModalConfig;if(!e){this.error="No config!";return}if(e.modelKey==="Sidebar"){let f=Zt();f&&await yo(f,"#max-ai__ai-provider-floating-button",100,5e3)}let t=o.getShortCutsEngine(),n=t.getVariables(),i=Ze(e);i.variables.map(f=>(f.defaultValue&&typeof f.defaultValue=="string"&&(f.defaultValue=He(f.defaultValue,n).data||""),f)),i.template=e.template||this.parameters?.compliedTemplate||"";let a=await ho.send("SetVariablesModal",{task:"open",config:i},5*60*1e3);a.success?Object.keys(a.data).forEach(f=>{a.data[f]!==void 0&&t?.setVariable(f,a.data[f],!0)}):(this.error="User cancel!",t?.reset()),this.output=JSON.stringify(a.data)}catch(e){this.error=e.toString()}}};z([j()],oe.prototype,"execute",1);var ie=class extends B{static{this.type="SET_VARIABLE_MAP"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableMap||{},t=o.getShortCutsEngine();t&&t.setVariable&&(Object.keys(e).forEach(n=>{e[n]!==void 0&&t?.setVariable(n,e[n],!0)}),this.output=JSON.stringify(e))}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ie.prototype,"execute",1);var ze=class extends B{static{this.type="URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.output=this.parameters.URLActionURL||this.parameters.LAST_ACTION_OUTPUT,this.output||(this.output="",this.error="No input url")}catch(e){this.error=e.toString()}}};var se=class extends B{static{this.type="GET_CONTENTS_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.URLActionURL||r.URLActionURL||r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(e&&t){await this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:it(),extra:{status:"info"}},o);let n=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:e}});n.success?this.output=n?.data?.body||"":this.error=n?.data?.body||""}else this.error=`Could not fetch the page.
Make sure the URL is correct.`;this.output||(this.output="",this.error=`Could not fetch the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],se.prototype,"execute",1);var ae=class extends B{static{this.type="GET_CONTENTS_OF_SEARCH_ENGINE"}constructor(r,o,e,t){super(r,"GET_CONTENTS_OF_SEARCH_ENGINE",e,t)}async execute(r,o){try{let e=r.compliedTemplate||this.parameters?.URLSearchEngineParams?.q||this.parameters?.URLSearchEngineParams?.query||r.LAST_ACTION_OUTPUT||"",t=o.getBackgroundConversation();if(e&&t){e=e.trim(),e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1));let n=this.parameters.URLSearchEngine||"yahoo",i=this.parameters.URLSearchEngineParams||{},a=this.getFullSearchURL(n,i,e),f=await t.postMessage({event:"ShortCuts_getContentOfSearchEngine",data:{URL:a}}),{status:p,html:c}=f.data||{};if(f.success&&p===200&&c){let u=so({html:c,searchEngine:n,limit:Number(i?.limit||3),fullSearchURL:a,query:e});if(u.length<=0){this.output="",this.error="No search results found. Please try again with a different search engine or search query.";return}else{this.output=JSON.stringify(u,null,2);return}}if(this.error="Failed to access the search page. Please try again.",p===301){this.output="",this.error=`<a href="${a}" target="_blank" style="color: inherit">Click here for ${n.replace(/^\w/,u=>u.toUpperCase())}</a>. Pass security checks and keep the tab open for stable web access.`;return}}this.output||(this.output="",this.error="No search results found. Please try again with a different search engine or search query.")}catch(e){this.error=e.toString()}}getFullSearchURL(r,o,e){let t=ji(r),n=Qi(r,o,e);return`${t}?${n.toString()}`}};z([Be(),V({onlyError:!0}),ht()],ae.prototype,"execute",1);function Qi(s,r,o){let e={...r};delete e.limit;let t=o||e.query;switch(delete e.query,delete e.q,e.site&&(t=`site:${e.site} ${t}`),delete e.site,e.region&&e.region!=="wt-wt"&&(s==="google"?t=`location:${e.region} ${t}`:t=`${e.region} ${t}`,delete e.region),s){case"yahoo":{e.p=t;break}case"baidu":{e.wd=t;break}case"naver":case"sogou":{e.query=t;break}case"yandex":{e.text=t;break}case"bing":case"duckduckgo":case"brave":case"google":default:e.q=t}return new URLSearchParams({...e})}function ji(s){switch(s){case"google":return"https://www.google.com/search";case"bing":return"https://www.bing.com/search";case"baidu":return"https://www.baidu.com/s";case"duckduckgo":return"https://duckduckgo.com/";case"yahoo":return"https://search.yahoo.com/search";case"naver":return"https://search.naver.com/search.naver";case"yandex":return"https://yandex.com/search/";case"sogou":return"https://www.sogou.com/web";case"brave":return"https://search.brave.com/search";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://search.yahoo.com/search"}}var We=class extends B{static{this.type="FETCH_ACTIONS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getShortCutsEngine(),t=await oo(this.parameters.template||"");e.pushActions(t,"after"),this.output=r.LAST_AI_OUTPUT||""}catch(e){this.error=e.toString()}}};var ce=class extends B{static{this.type="GET_YOUTUBE_TRANSCRIPT_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=window.location.href.includes("youtube.com")?window.location.href:"",t=this.parameters.URLActionURL||e||"";if(!t){this.error="Youtube URL is empty.";return}let n=await Dt.fetchTranscript(t);if((n.length<=10?n.map(a=>a.text).join("").trim()==="":!1)&&t&&t.startsWith("https://")){let a=await $n(t,{parse:"text"});a.success&&a.data&&(n=[{start:"",duration:"",text:await lr()}])}if(n.length>0){let a=await Dt.transcriptFormat(n),{getChartGPT:f,getShortCutsEngine:p}=o;if(p()?.getNextAction?.()?.type==="ASK_CHATGPT"){let c=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;await f()?.updateConversation({meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
\`\`\`
${a}
\`\`\``}},c)}this.output=a}}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),ht()],ce.prototype,"execute",1);var Ve=class extends B{static{this.type="OPEN_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",t=r.URLActionActiveTab||this.parameters.URLActionActiveTab;if(!e){this.error="No open url";return}e==="current_page"?this.output=await Hr({key:"current_page"})||void 0:this.output=await Hr({url:e,active:t})||void 0}catch(e){this.error=e.toString()}}};var $e=class extends B{static{this.type="CLOSE_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.OperationElementTabID||this.parameters.OperationElementTabID,t=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",n=await Mn({tabId:e,url:t});n?.success||(this.error=n?.message)}catch(e){this.error=e.toString()}}};var ue=class extends B{static{this.type="GET_READABILITY_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=await fr()||await lr();this.output=e}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),ht()],ue.prototype,"execute",1);var le=class extends B{static{this.type="GET_EMAIL_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await fr()||await Kn(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),ht()],le.prototype,"execute",1);var fe=class extends B{static{this.type="GET_EMAIL_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";if(e){let t=await jn(e);this.output=t}else this.output=""}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),ht()],fe.prototype,"execute",1);var Ki=s=>{if(s.length>0){let r=[];s.forEach((t,n)=>{let{content:i,author:a}=t;r.push({text:`[Comment ${n+1}]
**Author:** ${a}
**Comment:**
${i}`,data:t})});let o=r[r.length-1],e=r.slice(0,r.length-1);return{last:o,lastText:r[r.length-1].text,previous:e,previousText:e.map(t=>t.text).join(`

`),fullText:r.join(`

`)}}return null},K=class{constructor(r,o){this.commentList=[];let{postTitle:e="Post",postContentTagName:t="Post caption/description",meta:n={}}=o||{};this.config={postTitle:e,postContentTagName:t,meta:n},this.post=r}static get emptyData(){return{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",postText:""}}addCommentList(r){this.commentList.push(r)}get data(){let{content:r,author:o,title:e}=this.post,t=Ki(this.commentList?.[0]||[]),n="";return n+=`[${this.config.postTitle}]`,n+=`
**Post author:** ${o||"N/A"}`,n+=`
**Post title:** ${e||"N/A"}`,n+=`
**${this.config.postContentTagName}:**
${r||"N/A"}`,Object.keys(this.config.meta||{}).forEach(i=>{n+=`
**${i}:**
${this.config.meta?.[i]||"N/A"}`}),t?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.lastText,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.previousText?`${n}

${t.previousText}

${t.lastText}`:`${n}

${t.lastText}`,post:this.post,postText:n,replyCommentText:t.last.text,replyComment:t.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:t.previousText}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:n,post:this.post,postText:n,previousComments:this.commentList?.[0]||[],previousCommentsText:t?.previousText}}};var It=(s,r)=>new Promise(o=>setTimeout(()=>{if(r){let t=window.innerHeight/10;r.scrollIntoView(!1),window.scrollBy(0,t)}o(!0)},s)),rt=(s,r,o=20)=>{let e=r,t=0;for(;t<o&&!e.querySelector(s);)e=e?.parentElement,t++;return e.querySelector(s)||null},st=(s,r,o=20)=>{let e=r,t=0;for(;t<o&&!e?.matches(s);)e=e?.parentElement,t++;return e?.matches(s)?e:null};var xo=s=>{let r=s.querySelector('div[data-testid="User-Name"]'),[o,e]=Un(Array.from(r?.querySelectorAll("span")).map(i=>i.textContent||"").filter(i=>i&&i!=="\xB7")),t=s.querySelector("time")?.dateTime||"",n=s.querySelector('div[data-testid="tweetText"]').innerText;return{author:`${o}(${e})`,date:t,content:n,title:""}},vo=async s=>{let r=rt('article[data-testid="tweet"]',s);if(r){let o=[],e=st('div[data-testid="cellInnerDiv"]',r,5);for(;e;){if(e?.getAttribute("data-testid")==="cellInnerDiv"){let t=e.querySelector('article[data-testid="tweet"]');t&&o.splice(0,0,xo(t))}e=e.previousElementSibling}if(o.length>0){let t=o.shift(),n=new K(t);return n.addCommentList(o),n.data}else return new K(xo(r)).data}return K.emptyData},bo=s=>rt("div.DraftEditor-editorContainer",s,30)?.innerText||"",Fu=s=>{let r=Array.from(document.querySelectorAll('div[role="progressbar"]')),o=null;for(let e=0;e<r.length;e++){let t=r[e];if(t.parentElement?.contains(s)){o=t.parentElement;break}}return o};var Io=async s=>{let r=(s.querySelector("span.comments-post-meta__name span:not(.visually-hidden)")?.innerText||"").split(`
`)[0],o=s.querySelector("time")?.innerText||"",e=s.querySelector("& > .comments-reply-item-content-body button.see-more");e&&(e.click(),await It(100));let t=s.querySelector("& > div.comments-comment-item-content-body")?.innerText||s.querySelector("& > div.comments-reply-item-content-body")?.innerText;return{author:r||"",date:o||"",content:t||""}},So=async s=>{let r=rt(".comments-comment-box",s),o=rt(".social-details-social-activity",r);if(r&&o){let e=rt(".feed-shared-update-v2__description-wrapper",r);if(e){let t=e?.parentElement,n=t?.querySelector('button[role="button"].see-more');n&&(n.click(),await It(100,s));let i=t?.querySelector(".update-components-actor__name span:not(.visually-hidden)")?.textContent||"",a=e?.innerText||"",f=(t?.querySelector("div.ml4.mt2.text-body-xsmall")?.innerText||"").split("\u2022")?.[0],p=new K({author:i,content:a,title:"",date:f});if(r.parentElement?.classList.contains("comments-comment-item__nested-items")){let c=[],u=st("article.comments-comment-item",s),m=u?.querySelector('div.editor-content div[contenteditable="true"]')?.innerText||"";if(c.push(await Io(u)),m){let y=Array.from(u.querySelectorAll("article"));for(let x=0;x<y.length;x++){let w=y[x],C=await Io(w);if(m.startsWith(C.author)){c.push(C);break}}}await It(0,s),p.addCommentList(c)}return p.data}}return K.emptyData},_o=s=>rt("div.ql-editor",s,30)?.innerText||"";var jr=async s=>{let r=s?.querySelector("a > span > span")?.innerText||"",o=s?.querySelector("span[lang][dir]")?.innerText||"",e=Array.from(s?.querySelectorAll("a > span")),t=e[e.length-1]?.innerText||"";return{content:o,author:r,date:t}},wo=async s=>{let r=rt('form[role="presentation"]',s),o=rt('div[data-ad-preview="message"]',r,30),e=rt("span:has(h3 > span)",r,30),t=e||rt("span:has(h4 > div)",r,30),n=t?.innerText||"",i=e?t?.nextElementSibling?.querySelector("a")?.innerText:t?.parentElement?.nextElementSibling?.querySelectorAll("a")?.[1]?.innerText||"",a=o?.querySelector('div[dir] > div[role="button"]');a&&(a.click(),await It(100,s));let f=o?.innerText||"",p=[],c=new K({author:n,date:i,content:f,title:""});if(r){let l=r.querySelector('div[contenteditable="true"][role="textbox"]')?.innerText||"",m=st("li",r,10);for(;m;){let y=m.childNodes[0];if(y){let x=await jr(y);if(p.length===0&&!l.startsWith(x.author)&&m&&l){let w=Array.from(m.querySelectorAll("& > div > ul li > div"));for(let C=0;C<w.length;C++){let k=w[C],L=await jr(k);if(l.startsWith(L.author)){p.push(L);break}}}if(p.splice(0,0,x),m?.parentElement){m=st("li",m.parentElement,10);continue}}break}if(l.replace(`
`,"")&&!p.length){let y=rt('div[role="article"]',r),x=await jr(y);l.startsWith(x.author)&&p.push(x)}c.addCommentList(p)}return c.data},Po=s=>rt('div[contenteditable="true"]',s,30)?.innerText||"";var Kr=async s=>{let r=s.querySelector("#header-author #author-text > span")?.innerText||"",o=s.querySelector("#header-author > yt-formatted-string")?.innerText||"",e=s?.querySelector("tp-yt-paper-button#expand");e&&(e.click(),await It(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Mo=async s=>{try{let r=st("ytd-commentbox",s),o=Dt.retrieveVideoId(window.location.href),e=null;if(o){let t=await Dt.transcriptFormat(await Dt.fetchTranscript(window.location.href),2048),n=document.querySelector("ytd-watch-metadata"),i=n?.querySelector("#title > h1")?.innerText||document.title,a=document.querySelector("ytd-video-owner-renderer"),f=a?.querySelector("yt-formatted-string")?.textContent,p=n?.querySelector("tp-yt-paper-button#expand");p&&(p.click(),await It(100,s));let c=a?.querySelector("a")?.getAttribute("href")?.includes("@")&&a?.querySelector("a")?.getAttribute("href")?.split("/")[1],u=n?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",l=n?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||"";e=new K({title:i,author:`${f}(${c})`,date:u,content:l},{postTitle:"Video post",meta:{"Post video transcript":t}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let n=st("ytd-reel-video-renderer",s,50)?.querySelector("ytd-reel-player-header-renderer");if(n){let i=n?.querySelector(".title > yt-formatted-string")?.innerText||"",a=n?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";e=new K({title:i,author:a,date:"",content:""},{postTitle:"Video post"})}}if(r&&e){if(!st("ytd-comment-simplebox-renderer",r,5)){let t=st("ytd-comment-thread-renderer",r)?.querySelector("& > ytd-comment-renderer");if(t){let n=st("ytd-comment-renderer",r);n&&(rt("ytd-comment-replies-renderer",n,5)?.contains(n)&&!n.isSameNode(t)?e.addCommentList([await Kr(t),await Kr(n)]):e.addCommentList([await Kr(t)]))}}return e.data}}catch{}return K.emptyData},Lo=s=>rt('div#contenteditable-root[contenteditable="true"]',s,30)?.innerText||"";var Xr=async s=>{let r=s.querySelector("#badge-name")?.innerText||s.querySelector("#name")?.innerText||"",o=s.querySelector("yt-formatted-string.published-time-text")?.innerText||"",e=s?.querySelector("ytcp-button#more");e&&(e.click(),await It(100));let t=s.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Oo=async s=>{try{let r=st("ytcp-commentbox",s);if(!r)return K.emptyData;let o=st("ytcp-comment-thread",r),e=o?.querySelector("ytcp-comment-button > a[href]"),t=Dt.retrieveVideoId(e?.href||""),n=null;if(t){let i=await Dt.transcriptFormat(await Dt.fetchTranscript(window.location.href),2048),a=o?.querySelector("#video-title > yt-formatted-string")?.innerText||"",f=document.querySelector("#entity-name")?.innerText,p="";n=new K({title:a,author:`${f}`,date:p,content:""},{postTitle:"Video post",meta:{"Post video transcript":i}})}if(r&&n){let i=st("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(i){let a=st("ytcp-comment",r);a&&(rt("ytcp-comment-replies",a,5)?.contains(a)&&!a.isSameNode(i)?n.addCommentList([await Xr(i),await Xr(a)]):n.addCommentList([await Xr(i)]))}return n.data}}catch{}return K.emptyData},Ro=s=>rt("textarea#textarea",s,30)?.innerText||"";var yr=async s=>{let r=Array.from(s.querySelectorAll("a")).find(i=>i.innerText.trim()!=="")?.innerText||"",o=s.querySelector("time"),e="",t="",n=s.querySelector('div[role="button"][tabindex="0"]');return n&&n?.innerText==="more"&&(n.click(),await It(500)),o&&(t=o?.dateTime||"",e=st("div",o)?.nextElementSibling?.innerText||""),e||(e=(s.querySelector("h3")||s.querySelector("h2"))?.nextElementSibling?.innerText||""),e||(e=s.querySelector("span[dir] > span[dir]")?.innerText||""),{content:e,author:r.startsWith("@")?r:`${r?`@${r}`:""}`,date:t}},Do=async s=>{let r=st("section",s),o=r?.querySelector("textarea")?.value||"",e=r?.parentElement?.parentElement;if(e){let t=e.querySelector("hr")?Array.from(e?.querySelectorAll("hr + div > div > div > div")):Array.from(e?.querySelectorAll("section + div > ul > *")),[n,...i]=t;if(!n){let p=e.querySelector("div:has( > span[dir] > span[dir])");if(p){let c=await yr(p);return new K({author:c.author,content:c.content,title:"",date:c.date}).data}else return K.emptyData}let a=await yr(n),f=new K({author:a.author,content:a.content,title:"",date:a.date});if(o.startsWith("@")){let p=o.split(" ")?.[0],c=[];for(let u=0;u<i.length;u++){let l=!1,m=await yr(i[u]);p.startsWith(m.author)&&(c.push(m),l=!0);let y=Array.from(i[u+1]?.querySelectorAll("ul > div"));if(y.length>0)for(let x=0;x<y.length;x++){let w=await yr(y[x]);if(p.startsWith(w.author)){c.push(m),c.push(w),l=!0;break}}if(l)break}f.addCommentList(c)}return f.data}return K.emptyData},Uo=s=>{let r=rt('div[contenteditable="true"]',s,20);return r?r?.innerText||"":rt("form textarea",s,20)?.value};var ko=async s=>{let r=document.querySelector(s);if(!r)return K.emptyData;let o=Jt();return o==="twitter.com"?await vo(r):o==="linkedin.com"?await So(r):o==="facebook.com"?await wo(r):o==="youtube.com"?await Mo(r):o==="studio.youtube.com"?await Oo(r):o==="instagram.com"?await Do(r):K.emptyData},Fo=async s=>{let r=Jt(),o=document.querySelector(s);return o?r==="twitter.com"?bo(o):r==="linkedin.com"?_o(o):r==="facebook.com"?Po(o):r==="youtube.com"?Lo(o):r==="studio.youtube.com"?Ro(o):r==="instagram.com"?Uo(o):"":""};var me=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Fo(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),ht()],me.prototype,"execute",1);var pe=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_CONTENT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await ko(e),n=o.getShortCutsEngine();n&&n.pushActions([{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}}}],"after"),this.output=t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}catch(t){this.error=t.toString()}}};z([j(),V({onlyError:!0}),ht()],pe.prototype,"execute",1);var de=class extends B{static{this.type="WEBGPT_SEARCH_RESULTS_EXPAND"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(!e||!t){this.error="no search result";return}let n=this.parameters.SummarizeActionType||"NO_SUMMARIZE",i=JSON.parse(e),a="",f=[];for(let p=0;p<i.length;p++){let c=i[p];n==="NO_SUMMARIZE"&&(f.push({type:"RENDER_TEMPLATE",parameters:{template:c.body}}),f.push({type:"SET_VARIABLE",parameters:{VariableName:`SLICE_OF_TEXT_${p}`}}),a+=`NUMBER:${p+1}
URL: ${c.url}
TITLE: ${c.title}
CONTENT: {{SLICE_OF_TEXT_${p}}}

`)}if(f.push({type:"RENDER_TEMPLATE",parameters:{template:a}}),o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(f,"after");else{this.error="no shortCutsEngine";return}this.output=a}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],de.prototype,"execute",1);var Ar=class{constructor(r){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=r.pageContent?r.pageContent.toString():this.pageContent,this.metadata=r.metadata??{}}};var Xi=Object.defineProperty,Yi=(s,r,o)=>r in s?Xi(s,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[r]=o,No=(s,r,o)=>(Yi(s,typeof r!="symbol"?r+"":r,o),o);var qo=Ct(Go(),1);function is(s,r){let o=Array.from({length:s.length},(e,t)=>({start:t,end:t+1}));for(;o.length>1;){let e=null;for(let t=0;t<o.length-1;t++){let n=s.slice(o[t].start,o[t+1].end),i=r.get(n.join(","));i!=null&&(e==null||i<e[0])&&(e=[i,t])}if(e!=null){let t=e[1];o[t]={start:o[t].start,end:o[t+1].end},o.splice(t+1,1)}else break}return o}function ss(s,r){return s.length===1?[r.get(s.join(","))]:is(s,r).map(o=>r.get(s.slice(o.start,o.end).join(","))).filter(o=>o!=null)}function as(s){return s.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Zr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(s,r){this.patStr=s.pat_str;let o=s.bpe_ranks.split(`
`).filter(Boolean).reduce((e,t)=>{let[n,i,...a]=t.split(" "),f=Number.parseInt(i,10);return a.forEach((p,c)=>e[p]=f+c),e},{});for(let[e,t]of Object.entries(o)){let n=qo.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...s.special_tokens,...r},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(s,r=[],o="all"){let e=new RegExp(this.patStr,"ug"),t=Zr.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(r==="all"?Object.keys(this.specialTokens):r),a=new Set(o==="all"?Object.keys(this.specialTokens).filter(p=>!i.has(p)):o);if(a.size>0){let p=Zr.specialTokenRegex([...a]),c=s.match(p);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let f=0;for(;;){let p=null,c=f;for(;t.lastIndex=c,p=t.exec(s),!(p==null||i.has(p[0]));)c=p.index+1;let u=p?.index??s.length;for(let m of s.substring(f,u).matchAll(e)){let y=this.textEncoder.encode(m[0]),x=this.rankMap.get(y.join(","));if(x!=null){n.push(x);continue}n.push(...ss(y,this.rankMap))}if(p==null)break;let l=this.specialTokens[p[0]];n.push(l),f=p.index+p[0].length}return n}decode(s){let r=[],o=0;for(let n=0;n<s.length;++n){let i=s[n],a=this.textMap.get(i)??this.inverseSpecialTokens[i];a!=null&&(r.push(a),o+=a.length)}let e=new Uint8Array(o),t=0;for(let n of r)e.set(n,t),t+=n.length;return this.textDecoder.decode(e)}},Jr=Zr;No(Jr,"specialTokenRegex",s=>new RegExp(s.map(r=>as(r)).join("|"),"g"));var xs=Ct(Ko(),1),vs=Ct(ii(),1);var an=class{constructor(r){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),this.chunkSize=r?.chunkSize??this.chunkSize,this.chunkOverlap=r?.chunkOverlap??this.chunkOverlap,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async createDocuments(r,o=[],e={}){let t=o.length>0?o:new Array(r.length).fill({}),{chunkHeader:n="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:a=!1}=e,f=new Array;for(let p=0;p<r.length;p+=1){let c=r[p],u=1,l=null;for(let m of await this.splitText(c)){let y=n,x=0;if(l){let L=c.indexOf(m),M=c.indexOf(l)+l.length;x=(c.slice(M,L).match(/\n/g)||[]).length,a&&(y+=i)}u+=x;let w=(m.match(/\n/g)||[]).length,C=t[p].loc&&typeof t[p].loc=="object"?{...t[p].loc}:{};C.lines={from:u,to:u+w};let k={...t[p],loc:C};y+=m,f.push(new Ar({pageContent:y,metadata:k})),u+=w,l=m}}return f}async splitDocuments(r,o={}){let e=r.filter(i=>i.pageContent!==void 0),t=e.map(i=>i.pageContent),n=e.map(i=>i.metadata);return this.createDocuments(t,n,o)}joinDocs(r,o){let e=r.join(o).trim();return e===""?null:e}mergeSplits(r,o){let e=[],t=[],n=0;for(let a of r){let f=a.length;if(n+f+(t.length>0?o.length:0)>this.chunkSize&&(n>this.chunkSize,t.length>0)){let p=this.joinDocs(t,o);for(p!==null&&e.push(p);n>this.chunkOverlap||n+f>this.chunkSize&&n>0;)n-=t[0].length,t.shift()}t.push(a),n+=f}let i=this.joinDocs(t,o);return i!==null&&e.push(i),e}};var Sr=class extends an{constructor(r){super(r),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=r?.separators??this.separators}async splitText(r){let o=[],e=this.separators[this.separators.length-1];for(let i of this.separators){if(i===""){e=i;break}if(r.includes(i)){e=i;break}}let t;e?t=r.split(e):t=r.split("");let n=[];for(let i of t)if(i.length<this.chunkSize)n.push(i);else{if(n.length){let f=this.mergeSplits(n,e);o.push(...f),n=[]}let a=await this.splitText(i);o.push(...a)}if(n.length){let i=this.mergeSplits(n,e);o.push(...i)}return o}};var si=async(s,r=1e3)=>{try{let o=s;return{docs:await new Sr({chunkSize:r}).createDocuments([o])}}catch{return{docs:[]}}};var bs=6e3,Is=async(s,r,o)=>{let e=it(),t=[],{docs:n}=await si(s,o);(r==="STUFF"||r==="REFINE")&&n.splice(1);let i="",a=Math.ceil(o/n.length);return n.length===1?t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${n[0].pageContent}
"""`}}):(n.forEach(({pageContent:f},p)=>{let c=f||"";c&&(t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${a} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${c}
"""`}}),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_PART_${p}_ID_${e}`}}),i+=`{{SUMMARIZE_TEXT_PART_${p}_ID_${e}}}
`)}),t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (probably an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${o} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${i}
"""`}})),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_ID_${e}`}}),{variableName:`SUMMARIZE_TEXT_ID_${e}`,actions:t}},ye=class extends B{static{this.type="SUMMARIZE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"",t=this.parameters.SummarizeActionType||"STUFF";if(!e){this.error="No text to summarize";return}let{actions:n}=await Is(e,t,this.parameters.SliceTextActionType==="TOKENS"?await Nn(e,this.parameters.SliceTextActionTokens):this.parameters.SliceTextActionLength||bs);if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(n.map(i=>({...i,parameters:{...i.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=""}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ye.prototype,"execute",1);var Ss=6e3,Ae=class extends B{static{this.type="SLICE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"";if(!e){this.output="";return}if(this.parameters.SliceTextActionType==="TOKENS"||this.parameters.SliceTextActionTokens)this.output=await tr(e,this.parameters.SliceTextActionTokens||4096);else{let t=this.parameters.SliceTextActionLength||Ss;this.output=e.slice(0,t)}}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],Ae.prototype,"execute",1);var ai=new Oe,ci=async s=>(await ai.postMessage({event:"WebsiteContext_createWebsiteContext",data:{websiteContext:{url:window.location.href||location.href||document.location.href,host:Jt(),html:document.documentElement.outerHTML,...s}}})).data;var ui=async(s,r)=>s.id?(await ai.postMessage({event:"WebsiteContext_updateWebsiteContext",data:{query:s,websiteContext:r}})).success:!1;function _s(s,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in s)){var t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(s,e,t.get?t:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(s)}function fi(s,r){return new Promise(function(o,e){let t;return ws(s).then(function(n){try{return t=n,o(new Blob([r.slice(0,2),t,r.slice(2)],{type:"image/jpeg"}))}catch(i){return e(i)}},e)})}var ws=s=>new Promise((r,o)=>{let e=new FileReader;e.addEventListener("load",({target:{result:t}})=>{let n=new DataView(t),i=0;if(n.getUint16(i)!==65496)return o("not a valid JPEG");for(i+=2;;){let a=n.getUint16(i);if(a===65498)break;let f=n.getUint16(i+2);if(a===65505&&n.getUint32(i+4)===1165519206){let p=i+10,c;switch(n.getUint16(p)){case 18761:c=!0;break;case 19789:c=!1;break;default:return o("TIFF header contains invalid endian")}if(n.getUint16(p+2,c)!==42)return o("TIFF header contains invalid version");let u=n.getUint32(p+4,c),l=p+u+2+12*n.getUint16(p+u,c);for(let m=p+u+2;m<l;m+=12)if(n.getUint16(m,c)==274){if(n.getUint16(m+2,c)!==3)return o("Orientation data type is invalid");if(n.getUint32(m+4,c)!==1)return o("Orientation data count is invalid");n.setUint16(m+8,1,c);break}return r(t.slice(i,i+2+f))}i+=2+f}return r(new Blob)}),e.readAsArrayBuffer(s)}),wr={},Ps={get exports(){return wr},set exports(s){wr=s}};(function(s){var r,o,e={};Ps.exports=e,e.parse=function(t,n){for(var i=e.bin.readUshort,a=e.bin.readUint,f=0,p={},c=new Uint8Array(t),u=c.length-4;a(c,u)!=101010256;)u--;f=u,f+=4;var l=i(c,f+=4);i(c,f+=2);var m=a(c,f+=2),y=a(c,f+=4);f+=4,f=y;for(var x=0;x<l;x++){a(c,f),f+=4,f+=4,f+=4,a(c,f+=4),m=a(c,f+=4);var w=a(c,f+=4),C=i(c,f+=4),k=i(c,f+2),L=i(c,f+4);f+=6;var M=a(c,f+=8);f+=4,f+=C+k+L,e._readLocal(c,M,p,m,w,n)}return p},e._readLocal=function(t,n,i,a,f,p){var c=e.bin.readUshort,u=e.bin.readUint;u(t,n),c(t,n+=4),c(t,n+=2);var l=c(t,n+=2);u(t,n+=2),u(t,n+=4),n+=4;var m=c(t,n+=8),y=c(t,n+=2);n+=2;var x=e.bin.readUTF8(t,n,m);if(n+=m,n+=y,p)i[x]={size:f,csize:a};else{var w=new Uint8Array(t.buffer,n);if(l==0)i[x]=new Uint8Array(w.buffer.slice(n,n+a));else{if(l!=8)throw"unknown compression method: "+l;var C=new Uint8Array(f);e.inflateRaw(w,C),i[x]=C}}},e.inflateRaw=function(t,n){return e.F.inflate(t,n)},e.inflate=function(t,n){return t[0],t[1],e.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),n)},e.deflate=function(t,n){n==null&&(n={level:6});var i=0,a=new Uint8Array(50+Math.floor(1.1*t.length));a[i]=120,a[i+1]=156,i+=2,i=e.F.deflateRaw(t,a,i,n.level);var f=e.adler(t,0,t.length);return a[i+0]=f>>>24&255,a[i+1]=f>>>16&255,a[i+2]=f>>>8&255,a[i+3]=f>>>0&255,new Uint8Array(a.buffer,0,i+4)},e.deflateRaw=function(t,n){n==null&&(n={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),a=e.F.deflateRaw(t,i,a,n.level);return new Uint8Array(i.buffer,0,a)},e.encode=function(t,n){n==null&&(n=!1);var i=0,a=e.bin.writeUint,f=e.bin.writeUshort,p={};for(var c in t){var u=!e._noNeed(c)&&!n,l=t[c],m=e.crc.crc(l,0,l.length);p[c]={cpr:u,usize:l.length,crc:m,file:u?e.deflateRaw(l):l}}for(var c in p)i+=p[c].file.length+30+46+2*e.bin.sizeUTF8(c);i+=22;var y=new Uint8Array(i),x=0,w=[];for(var c in p){var C=p[c];w.push(x),x=e._writeHeader(y,x,c,C,0)}var k=0,L=x;for(var c in p)C=p[c],w.push(x),x=e._writeHeader(y,x,c,C,1,w[k++]);var M=x-L;return a(y,x,101010256),x+=4,f(y,x+=4,k),f(y,x+=2,k),a(y,x+=2,M),a(y,x+=4,L),x+=4,x+=2,y.buffer},e._noNeed=function(t){var n=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},e._writeHeader=function(t,n,i,a,f,p){var c=e.bin.writeUint,u=e.bin.writeUshort,l=a.file;return c(t,n,f==0?67324752:33639248),n+=4,f==1&&(n+=2),u(t,n,20),u(t,n+=2,0),u(t,n+=2,a.cpr?8:0),c(t,n+=2,0),c(t,n+=4,a.crc),c(t,n+=4,l.length),c(t,n+=4,a.usize),u(t,n+=4,e.bin.sizeUTF8(i)),u(t,n+=2,0),n+=2,f==1&&(n+=2,n+=2,c(t,n+=6,p),n+=4),n+=e.bin.writeUTF8(t,n,i),f==0&&(t.set(l,n),n+=l.length),n},e.crc={table:function(){for(var t=new Uint32Array(256),n=0;n<256;n++){for(var i=n,a=0;a<8;a++)1&i?i=3988292384^i>>>1:i>>>=1;t[n]=i}return t}(),update:function(t,n,i,a){for(var f=0;f<a;f++)t=e.crc.table[255&(t^n[i+f])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.adler=function(t,n,i){for(var a=1,f=0,p=n,c=n+i;p<c;){for(var u=Math.min(p+5552,c);p<u;)f+=a+=t[p++];a%=65521,f%=65521}return f<<16|a},e.bin={readUshort:function(t,n){return t[n]|t[n+1]<<8},writeUshort:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255},readUint:function(t,n){return 16777216*t[n+3]+(t[n+2]<<16|t[n+1]<<8|t[n])},writeUint:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255,t[n+2]=i>>16&255,t[n+3]=i>>24&255},readASCII:function(t,n,i){for(var a="",f=0;f<i;f++)a+=String.fromCharCode(t[n+f]);return a},writeASCII:function(t,n,i){for(var a=0;a<i.length;a++)t[n+a]=i.charCodeAt(a)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,n,i){for(var a,f="",p=0;p<i;p++)f+="%"+e.bin.pad(t[n+p].toString(16));try{a=decodeURIComponent(f)}catch{return e.bin.readASCII(t,n,i)}return a},writeUTF8:function(t,n,i){for(var a=i.length,f=0,p=0;p<a;p++){var c=i.charCodeAt(p);if(!(4294967168&c))t[n+f]=c,f++;else if(!(4294965248&c))t[n+f]=192|c>>6,t[n+f+1]=128|c>>0&63,f+=2;else if(!(4294901760&c))t[n+f]=224|c>>12,t[n+f+1]=128|c>>6&63,t[n+f+2]=128|c>>0&63,f+=3;else{if(4292870144&c)throw"e";t[n+f]=240|c>>18,t[n+f+1]=128|c>>12&63,t[n+f+2]=128|c>>6&63,t[n+f+3]=128|c>>0&63,f+=4}}return f},sizeUTF8:function(t){for(var n=t.length,i=0,a=0;a<n;a++){var f=t.charCodeAt(a);if(!(4294967168&f))i++;else if(!(4294965248&f))i+=2;else if(!(4294901760&f))i+=3;else{if(4292870144&f)throw"e";i+=4}}return i}},e.F={},e.F.deflateRaw=function(t,n,i,a){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],p=e.F.U,c=e.F._goodIndex;e.F._hash;var u=e.F._putsE,l=0,m=i<<3,y=0,x=t.length;if(a==0){for(;l<x;)u(n,m,l+(b=Math.min(65535,x-l))==x?1:0),m=e.F._copyExact(t,l,b,n,m+8),l+=b;return m>>>3}var w=p.lits,C=p.strt,k=p.prev,L=0,M=0,D=0,E=0,O=0,g=0;for(x>2&&(C[g=e.F._hash(t,0)]=0),l=0;l<x;l++){if(O=g,l+1<x-2){g=e.F._hash(t,l+1);var h=l+1&32767;k[h]=C[g],C[g]=h}if(y<=l){(L>14e3||M>26697)&&x-l>100&&(y<l&&(w[L]=l-y,L+=2,y=l),m=e.F._writeBlock(l==x-1||y==x?1:0,w,L,E,t,D,l-D,n,m),L=M=E=0,D=l);var v=0;l<x-2&&(v=e.F._bestMatch(t,l,k,O,Math.min(f[2],x-l),f[3]));var b=v>>>16,I=65535&v;if(v!=0){I=65535&v;var S=c(b=v>>>16,p.of0);p.lhst[257+S]++;var T=c(I,p.df0);p.dhst[T]++,E+=p.exb[S]+p.dxb[T],w[L]=b<<23|l-y,w[L+1]=I<<16|S<<8|T,L+=2,y=l+b}else p.lhst[t[l]]++;M++}}for(D==l&&t.length!=0||(y<l&&(w[L]=l-y,L+=2,y=l),m=e.F._writeBlock(1,w,L,E,t,D,l-D,n,m),L=0,M=0,L=M=E=0,D=l);7&m;)m++;return m>>>3},e.F._bestMatch=function(t,n,i,a,f,p){var c=32767&n,u=i[c],l=c-u+32768&32767;if(u==c||a!=e.F._hash(t,n-l))return 0;for(var m=0,y=0,x=Math.min(32767,n);l<=x&&--p!=0&&u!=c;){if(m==0||t[n+m]==t[n+m-l]){var w=e.F._howLong(t,n,l);if(w>m){if(y=l,(m=w)>=f)break;l+2<w&&(w=l+2);for(var C=0,k=0;k<w-2;k++){var L=n-l+k+32768&32767,M=L-i[L]+32768&32767;M>C&&(C=M,u=L)}}}l+=(c=u)-(u=i[c])+32768&32767}return m<<16|y},e.F._howLong=function(t,n,i){if(t[n]!=t[n-i]||t[n+1]!=t[n+1-i]||t[n+2]!=t[n+2-i])return 0;var a=n,f=Math.min(t.length,n+258);for(n+=3;n<f&&t[n]==t[n-i];)n++;return n-a},e.F._hash=function(t,n){return(t[n]<<8|t[n+1])+(t[n+2]<<4)&65535},e.saved=0,e.F._writeBlock=function(t,n,i,a,f,p,c,u,l){var m,y,x,w,C,k,L,M,D,E=e.F.U,O=e.F._putsF,g=e.F._putsE;E.lhst[256]++,y=(m=e.F.getTrees())[0],x=m[1],w=m[2],C=m[3],k=m[4],L=m[5],M=m[6],D=m[7];var h=32+(l+3&7?8-(l+3&7):0)+(c<<3),v=a+e.F.contSize(E.fltree,E.lhst)+e.F.contSize(E.fdtree,E.dhst),b=a+e.F.contSize(E.ltree,E.lhst)+e.F.contSize(E.dtree,E.dhst);b+=14+3*L+e.F.contSize(E.itree,E.ihst)+(2*E.ihst[16]+3*E.ihst[17]+7*E.ihst[18]);for(var I=0;I<286;I++)E.lhst[I]=0;for(I=0;I<30;I++)E.dhst[I]=0;for(I=0;I<19;I++)E.ihst[I]=0;var S=h<v&&h<b?0:v<b?1:2;if(O(u,l,t),O(u,l+1,S),l+=3,S==0){for(;7&l;)l++;l=e.F._copyExact(f,p,c,u,l)}else{var T,_;if(S==1&&(T=E.fltree,_=E.fdtree),S==2){e.F.makeCodes(E.ltree,y),e.F.revCodes(E.ltree,y),e.F.makeCodes(E.dtree,x),e.F.revCodes(E.dtree,x),e.F.makeCodes(E.itree,w),e.F.revCodes(E.itree,w),T=E.ltree,_=E.dtree,g(u,l,C-257),g(u,l+=5,k-1),g(u,l+=5,L-4),l+=4;for(var A=0;A<L;A++)g(u,l+3*A,E.itree[1+(E.ordr[A]<<1)]);l+=3*L,l=e.F._codeTiny(M,E.itree,u,l),l=e.F._codeTiny(D,E.itree,u,l)}for(var d=p,U=0;U<i;U+=2){for(var P=n[U],F=P>>>23,q=d+(8388607&P);d<q;)l=e.F._writeLit(f[d++],T,u,l);if(F!=0){var H=n[U+1],G=H>>16,N=H>>8&255,R=255&H;g(u,l=e.F._writeLit(257+N,T,u,l),F-E.of0[N]),l+=E.exb[N],O(u,l=e.F._writeLit(R,_,u,l),G-E.df0[R]),l+=E.dxb[R],d+=F}}l=e.F._writeLit(256,T,u,l)}return l},e.F._copyExact=function(t,n,i,a,f){var p=f>>>3;return a[p]=i,a[p+1]=i>>>8,a[p+2]=255-a[p],a[p+3]=255-a[p+1],p+=4,a.set(new Uint8Array(t.buffer,n,i),p),f+(i+4<<3)},e.F.getTrees=function(){for(var t=e.F.U,n=e.F._hufTree(t.lhst,t.ltree,15),i=e.F._hufTree(t.dhst,t.dtree,15),a=[],f=e.F._lenCodes(t.ltree,a),p=[],c=e.F._lenCodes(t.dtree,p),u=0;u<a.length;u+=2)t.ihst[a[u]]++;for(u=0;u<p.length;u+=2)t.ihst[p[u]]++;for(var l=e.F._hufTree(t.ihst,t.itree,7),m=19;m>4&&t.itree[1+(t.ordr[m-1]<<1)]==0;)m--;return[n,i,l,f,c,m,a,p]},e.F.getSecond=function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(t[i+1]);return n},e.F.nonZero=function(t){for(var n="",i=0;i<t.length;i+=2)t[i+1]!=0&&(n+=(i>>1)+",");return n},e.F.contSize=function(t,n){for(var i=0,a=0;a<n.length;a++)i+=n[a]*t[1+(a<<1)];return i},e.F._codeTiny=function(t,n,i,a){for(var f=0;f<t.length;f+=2){var p=t[f],c=t[f+1];a=e.F._writeLit(p,n,i,a);var u=p==16?2:p==17?3:7;p>15&&(e.F._putsE(i,a,c,u),a+=u)}return a},e.F._lenCodes=function(t,n){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var a=0;a<i;a+=2){var f=t[a+1],p=a+3<i?t[a+3]:-1,c=a+5<i?t[a+5]:-1,u=a==0?-1:t[a-1];if(f==0&&p==f&&c==f){for(var l=a+5;l+2<i&&t[l+2]==f;)l+=2;(m=Math.min(l+1-a>>>1,138))<11?n.push(17,m-3):n.push(18,m-11),a+=2*m-2}else if(f==u&&p==f&&c==f){for(l=a+5;l+2<i&&t[l+2]==f;)l+=2;var m=Math.min(l+1-a>>>1,6);n.push(16,m-3),a+=2*m-2}else n.push(f,0)}return i>>>1},e.F._hufTree=function(t,n,i){var a=[],f=t.length,p=n.length,c=0;for(c=0;c<p;c+=2)n[c]=0,n[c+1]=0;for(c=0;c<f;c++)t[c]!=0&&a.push({lit:c,f:t[c]});var u=a.length,l=a.slice(0);if(u==0)return 0;if(u==1){var m=a[0].lit;return l=m==0?1:0,n[1+(m<<1)]=1,n[1+(l<<1)]=1,1}a.sort(function(M,D){return M.f-D.f});var y=a[0],x=a[1],w=0,C=1,k=2;for(a[0]={lit:-1,f:y.f+x.f,l:y,r:x,d:0};C!=u-1;)y=w!=C&&(k==u||a[w].f<a[k].f)?a[w++]:a[k++],x=w!=C&&(k==u||a[w].f<a[k].f)?a[w++]:a[k++],a[C++]={lit:-1,f:y.f+x.f,l:y,r:x};var L=e.F.setDepth(a[C-1],0);for(L>i&&(e.F.restrictDepth(l,i,L),L=i),c=0;c<u;c++)n[1+(l[c].lit<<1)]=l[c].d;return L},e.F.setDepth=function(t,n){return t.lit!=-1?(t.d=n,n):Math.max(e.F.setDepth(t.l,n+1),e.F.setDepth(t.r,n+1))},e.F.restrictDepth=function(t,n,i){var a=0,f=1<<i-n,p=0;for(t.sort(function(u,l){return l.d==u.d?u.f-l.f:l.d-u.d}),a=0;a<t.length&&t[a].d>n;a++){var c=t[a].d;t[a].d=n,p+=f-(1<<i-c)}for(p>>>=i-n;p>0;)(c=t[a].d)<n?(t[a].d++,p-=1<<n-c-1):a++;for(;a>=0;a--)t[a].d==n&&p<0&&(t[a].d--,p++);p!=0},e.F._goodIndex=function(t,n){var i=0;return n[16|i]<=t&&(i|=16),n[8|i]<=t&&(i|=8),n[4|i]<=t&&(i|=4),n[2|i]<=t&&(i|=2),n[1|i]<=t&&(i|=1),i},e.F._writeLit=function(t,n,i,a){return e.F._putsF(i,a,n[t<<1]),a+n[1+(t<<1)]},e.F.inflate=function(t,n){var i=Uint8Array;if(t[0]==3&&t[1]==0)return n||new i(0);var a=e.F,f=a._bitsF,p=a._bitsE,c=a._decodeTiny,u=a.makeCodes,l=a.codes2map,m=a._get17,y=a.U,x=n==null;x&&(n=new i(t.length>>>2<<3));for(var w,C,k=0,L=0,M=0,D=0,E=0,O=0,g=0,h=0,v=0;k==0;)if(k=f(t,v,1),L=f(t,v+1,2),v+=3,L!=0){if(x&&(n=e.F._check(n,h+(1<<17))),L==1&&(w=y.flmap,C=y.fdmap,O=511,g=31),L==2){M=p(t,v,5)+257,D=p(t,v+5,5)+1,E=p(t,v+10,4)+4,v+=14;for(var b=0;b<38;b+=2)y.itree[b]=0,y.itree[b+1]=0;var I=1;for(b=0;b<E;b++){var S=p(t,v+3*b,3);y.itree[1+(y.ordr[b]<<1)]=S,S>I&&(I=S)}v+=3*E,u(y.itree,I),l(y.itree,I,y.imap),w=y.lmap,C=y.dmap,v=c(y.imap,(1<<I)-1,M+D,t,v,y.ttree);var T=a._copyOut(y.ttree,0,M,y.ltree);O=(1<<T)-1;var _=a._copyOut(y.ttree,M,D,y.dtree);g=(1<<_)-1,u(y.ltree,T),l(y.ltree,T,w),u(y.dtree,_),l(y.dtree,_,C)}for(;;){var A=w[m(t,v)&O];v+=15&A;var d=A>>>4;if(!(d>>>8))n[h++]=d;else{if(d==256)break;var U=h+d-254;if(d>264){var P=y.ldef[d-257];U=h+(P>>>3)+p(t,v,7&P),v+=7&P}var F=C[m(t,v)&g];v+=15&F;var q=F>>>4,H=y.ddef[q],G=(H>>>4)+f(t,v,15&H);for(v+=15&H,x&&(n=e.F._check(n,h+(1<<17)));h<U;)n[h]=n[h++-G],n[h]=n[h++-G],n[h]=n[h++-G],n[h]=n[h++-G];h=U}}}else{7&v&&(v+=8-(7&v));var N=4+(v>>>3),R=t[N-4]|t[N-3]<<8;x&&(n=e.F._check(n,h+R)),n.set(new i(t.buffer,t.byteOffset+N,R),h),v=N+R<<3,h+=R}return n.length==h?n:n.slice(0,h)},e.F._check=function(t,n){var i=t.length;if(n<=i)return t;var a=new Uint8Array(Math.max(i<<1,n));return a.set(t,0),a},e.F._decodeTiny=function(t,n,i,a,f,p){for(var c=e.F._bitsE,u=e.F._get17,l=0;l<i;){var m=t[u(a,f)&n];f+=15&m;var y=m>>>4;if(y<=15)p[l]=y,l++;else{var x=0,w=0;y==16?(w=3+c(a,f,2),f+=2,x=p[l-1]):y==17?(w=3+c(a,f,3),f+=3):y==18&&(w=11+c(a,f,7),f+=7);for(var C=l+w;l<C;)p[l]=x,l++}}return f},e.F._copyOut=function(t,n,i,a){for(var f=0,p=0,c=a.length>>>1;p<i;){var u=t[p+n];a[p<<1]=0,a[1+(p<<1)]=u,u>f&&(f=u),p++}for(;p<c;)a[p<<1]=0,a[1+(p<<1)]=0,p++;return f},e.F.makeCodes=function(t,n){for(var i,a,f,p,c=e.F.U,u=t.length,l=c.bl_count,m=0;m<=n;m++)l[m]=0;for(m=1;m<u;m+=2)l[t[m]]++;var y=c.next_code;for(i=0,l[0]=0,a=1;a<=n;a++)i=i+l[a-1]<<1,y[a]=i;for(f=0;f<u;f+=2)(p=t[f+1])!=0&&(t[f]=y[p],y[p]++)},e.F.codes2map=function(t,n,i){for(var a=t.length,f=e.F.U.rev15,p=0;p<a;p+=2)if(t[p+1]!=0)for(var c=p>>1,u=t[p+1],l=c<<4|u,m=n-u,y=t[p]<<m,x=y+(1<<m);y!=x;)i[f[y]>>>15-n]=l,y++},e.F.revCodes=function(t,n){for(var i=e.F.U.rev15,a=15-n,f=0;f<t.length;f+=2){var p=t[f]<<n-t[f+1];t[f]=i[p]>>>a}},e.F._putsE=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8},e.F._putsF=function(t,n,i){i<<=7&n;var a=n>>>3;t[a]|=i,t[a+1]|=i>>>8,t[a+2]|=i>>>16},e.F._bitsE=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8)>>>(7&n)&(1<<i)-1},e.F._bitsF=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)&(1<<i)-1},e.F._get17=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)},e.F._get25=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16|t[3+(n>>>3)]<<24)>>>(7&n)},e.F.U=(r=Uint16Array,o=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var t=e.F.U,n=0;n<32768;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[n]=(i>>>16|i<<16)>>>17}function a(f,p,c){for(;p--!=0;)f.push(0,c)}for(n=0;n<32;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];a(t.fltree,144,8),a(t.fltree,112,9),a(t.fltree,24,7),a(t.fltree,8,8),e.F.makeCodes(t.fltree,9),e.F.codes2map(t.fltree,9,t.flmap),e.F.revCodes(t.fltree,9),a(t.fdtree,32,5),e.F.makeCodes(t.fdtree,5),e.F.codes2map(t.fdtree,5,t.fdmap),e.F.revCodes(t.fdtree,5),a(t.itree,19,0),a(t.ltree,286,0),a(t.dtree,30,0),a(t.ttree,320,0)}()})();var Ms=_s({__proto__:null,default:wr},[wr]),Ut=function(){var s={nextZero(c,u){for(;c[u]!=0;)u++;return u},readUshort:(c,u)=>c[u]<<8|c[u+1],writeUshort(c,u,l){c[u]=l>>8&255,c[u+1]=255&l},readUint:(c,u)=>16777216*c[u]+(c[u+1]<<16|c[u+2]<<8|c[u+3]),writeUint(c,u,l){c[u]=l>>24&255,c[u+1]=l>>16&255,c[u+2]=l>>8&255,c[u+3]=255&l},readASCII(c,u,l){let m="";for(let y=0;y<l;y++)m+=String.fromCharCode(c[u+y]);return m},writeASCII(c,u,l){for(let m=0;m<l.length;m++)c[u+m]=l.charCodeAt(m)},readBytes(c,u,l){let m=[];for(let y=0;y<l;y++)m.push(c[u+y]);return m},pad:c=>c.length<2?`0${c}`:c,readUTF8(c,u,l){let m,y="";for(let x=0;x<l;x++)y+=`%${s.pad(c[u+x].toString(16))}`;try{m=decodeURIComponent(y)}catch{return s.readASCII(c,u,l)}return m}};function r(c,u,l,m){let y=u*l,x=n(m),w=Math.ceil(u*x/8),C=new Uint8Array(4*y),k=new Uint32Array(C.buffer),{ctype:L}=m,{depth:M}=m,D=s.readUshort;if(L==6){let P=y<<2;if(M==8)for(var E=0;E<P;E+=4)C[E]=c[E],C[E+1]=c[E+1],C[E+2]=c[E+2],C[E+3]=c[E+3];if(M==16)for(E=0;E<P;E++)C[E]=c[E<<1]}else if(L==2){let P=m.tabs.tRNS;if(P==null){if(M==8)for(E=0;E<y;E++){var O=3*E;k[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O]}if(M==16)for(E=0;E<y;E++)O=6*E,k[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O]}else{var g=P[0];let F=P[1],q=P[2];if(M==8)for(E=0;E<y;E++){var h=E<<2;O=3*E,k[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O],c[O]==g&&c[O+1]==F&&c[O+2]==q&&(C[h+3]=0)}if(M==16)for(E=0;E<y;E++)h=E<<2,O=6*E,k[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O],D(c,O)==g&&D(c,O+2)==F&&D(c,O+4)==q&&(C[h+3]=0)}}else if(L==3){let P=m.tabs.PLTE,F=m.tabs.tRNS,q=F?F.length:0;if(M==1)for(var v=0;v<l;v++){var b=v*w,I=v*u;for(E=0;E<u;E++){h=I+E<<2;var S=3*(T=c[b+(E>>3)]>>7-((7&E)<<0)&1);C[h]=P[S],C[h+1]=P[S+1],C[h+2]=P[S+2],C[h+3]=T<q?F[T]:255}}if(M==2)for(v=0;v<l;v++)for(b=v*w,I=v*u,E=0;E<u;E++)h=I+E<<2,S=3*(T=c[b+(E>>2)]>>6-((3&E)<<1)&3),C[h]=P[S],C[h+1]=P[S+1],C[h+2]=P[S+2],C[h+3]=T<q?F[T]:255;if(M==4)for(v=0;v<l;v++)for(b=v*w,I=v*u,E=0;E<u;E++)h=I+E<<2,S=3*(T=c[b+(E>>1)]>>4-((1&E)<<2)&15),C[h]=P[S],C[h+1]=P[S+1],C[h+2]=P[S+2],C[h+3]=T<q?F[T]:255;if(M==8)for(E=0;E<y;E++){var T;h=E<<2,S=3*(T=c[E]),C[h]=P[S],C[h+1]=P[S+1],C[h+2]=P[S+2],C[h+3]=T<q?F[T]:255}}else if(L==4){if(M==8)for(E=0;E<y;E++){h=E<<2;var _=c[A=E<<1];C[h]=_,C[h+1]=_,C[h+2]=_,C[h+3]=c[A+1]}if(M==16)for(E=0;E<y;E++){var A;h=E<<2,_=c[A=E<<2],C[h]=_,C[h+1]=_,C[h+2]=_,C[h+3]=c[A+2]}}else if(L==0)for(g=m.tabs.tRNS?m.tabs.tRNS:-1,v=0;v<l;v++){let P=v*w,F=v*u;if(M==1)for(var d=0;d<u;d++){var U=(_=255*(c[P+(d>>>3)]>>>7-(7&d)&1))==255*g?0:255;k[F+d]=U<<24|_<<16|_<<8|_}else if(M==2)for(d=0;d<u;d++)U=(_=85*(c[P+(d>>>2)]>>>6-((3&d)<<1)&3))==85*g?0:255,k[F+d]=U<<24|_<<16|_<<8|_;else if(M==4)for(d=0;d<u;d++)U=(_=17*(c[P+(d>>>1)]>>>4-((1&d)<<2)&15))==17*g?0:255,k[F+d]=U<<24|_<<16|_<<8|_;else if(M==8)for(d=0;d<u;d++)U=(_=c[P+d])==g?0:255,k[F+d]=U<<24|_<<16|_<<8|_;else if(M==16)for(d=0;d<u;d++)_=c[P+(d<<1)],U=D(c,P+(d<<1))==g?0:255,k[F+d]=U<<24|_<<16|_<<8|_}return C}function o(c,u,l,m){let y=n(c),x=Math.ceil(l*y/8),w=new Uint8Array((x+1+c.interlace)*m);return u=c.tabs.CgBI?t(u,w):e(u,w),c.interlace==0?u=i(u,c,0,l,m):c.interlace==1&&(u=function(k,L){let M=L.width,D=L.height,E=n(L),O=E>>3,g=Math.ceil(M*E/8),h=new Uint8Array(D*g),v=0,b=[0,0,4,0,2,0,1],I=[0,4,0,2,0,1,0],S=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1],_=0;for(;_<7;){let d=S[_],U=T[_],P=0,F=0,q=b[_];for(;q<D;)q+=d,F++;let H=I[_];for(;H<M;)H+=U,P++;let G=Math.ceil(P*E/8);i(k,L,v,P,F);let N=0,R=b[_];for(;R<D;){let W=I[_],tt=v+N*G<<3;for(;W<M;){var A;if(E==1&&(A=(A=k[tt>>3])>>7-(7&tt)&1,h[R*g+(W>>3)]|=A<<7-((7&W)<<0)),E==2&&(A=(A=k[tt>>3])>>6-(7&tt)&3,h[R*g+(W>>2)]|=A<<6-((3&W)<<1)),E==4&&(A=(A=k[tt>>3])>>4-(7&tt)&15,h[R*g+(W>>1)]|=A<<4-((1&W)<<2)),E>=8){let X=R*g+W*O;for(let $=0;$<O;$++)h[X+$]=k[(tt>>3)+$]}tt+=E,W+=U}N++,R+=d}P*F!=0&&(v+=F*(1+G)),_+=1}return h}(u,c)),u}function e(c,u){return t(new Uint8Array(c.buffer,2,c.length-6),u)}var t=function(){let c={H:{}};return c.H.N=function(u,l){let m=Uint8Array,y,x,w=0,C=0,k=0,L=0,M=0,D=0,E=0,O=0,g=0;if(u[0]==3&&u[1]==0)return l||new m(0);let h=c.H,v=h.b,b=h.e,I=h.R,S=h.n,T=h.A,_=h.Z,A=h.m,d=l==null;for(d&&(l=new m(u.length>>>2<<5));w==0;)if(w=v(u,g,1),C=v(u,g+1,2),g+=3,C!=0){if(d&&(l=c.H.W(l,O+(1<<17))),C==1&&(y=A.J,x=A.h,D=511,E=31),C==2){k=b(u,g,5)+257,L=b(u,g+5,5)+1,M=b(u,g+10,4)+4,g+=14;let P=1;for(var U=0;U<38;U+=2)A.Q[U]=0,A.Q[U+1]=0;for(U=0;U<M;U++){let H=b(u,g+3*U,3);A.Q[1+(A.X[U]<<1)]=H,H>P&&(P=H)}g+=3*M,S(A.Q,P),T(A.Q,P,A.u),y=A.w,x=A.d,g=I(A.u,(1<<P)-1,k+L,u,g,A.v);let F=h.V(A.v,0,k,A.C);D=(1<<F)-1;let q=h.V(A.v,k,L,A.D);E=(1<<q)-1,S(A.C,F),T(A.C,F,y),S(A.D,q),T(A.D,q,x)}for(;;){let P=y[_(u,g)&D];g+=15&P;let F=P>>>4;if(!(F>>>8))l[O++]=F;else{if(F==256)break;{let q=O+F-254;if(F>264){let W=A.q[F-257];q=O+(W>>>3)+b(u,g,7&W),g+=7&W}let H=x[_(u,g)&E];g+=15&H;let G=H>>>4,N=A.c[G],R=(N>>>4)+v(u,g,15&N);for(g+=15&N;O<q;)l[O]=l[O++-R],l[O]=l[O++-R],l[O]=l[O++-R],l[O]=l[O++-R];O=q}}}}else{7&g&&(g+=8-(7&g));let P=4+(g>>>3),F=u[P-4]|u[P-3]<<8;d&&(l=c.H.W(l,O+F)),l.set(new m(u.buffer,u.byteOffset+P,F),O),g=P+F<<3,O+=F}return l.length==O?l:l.slice(0,O)},c.H.W=function(u,l){let m=u.length;if(l<=m)return u;let y=new Uint8Array(m<<1);return y.set(u,0),y},c.H.R=function(u,l,m,y,x,w){let C=c.H.e,k=c.H.Z,L=0;for(;L<m;){let M=u[k(y,x)&l];x+=15&M;let D=M>>>4;if(D<=15)w[L]=D,L++;else{let E=0,O=0;D==16?(O=3+C(y,x,2),x+=2,E=w[L-1]):D==17?(O=3+C(y,x,3),x+=3):D==18&&(O=11+C(y,x,7),x+=7);let g=L+O;for(;L<g;)w[L]=E,L++}}return x},c.H.V=function(u,l,m,y){let x=0,w=0,C=y.length>>>1;for(;w<m;){let k=u[w+l];y[w<<1]=0,y[1+(w<<1)]=k,k>x&&(x=k),w++}for(;w<C;)y[w<<1]=0,y[1+(w<<1)]=0,w++;return x},c.H.n=function(u,l){let m=c.H.m,y=u.length,x,w,C,k,L=m.j;for(var M=0;M<=l;M++)L[M]=0;for(M=1;M<y;M+=2)L[u[M]]++;let D=m.K;for(x=0,L[0]=0,w=1;w<=l;w++)x=x+L[w-1]<<1,D[w]=x;for(C=0;C<y;C+=2)k=u[C+1],k!=0&&(u[C]=D[k],D[k]++)},c.H.A=function(u,l,m){let y=u.length,x=c.H.m.r;for(let w=0;w<y;w+=2)if(u[w+1]!=0){let C=w>>1,k=u[w+1],L=C<<4|k,M=l-k,D=u[w]<<M,E=D+(1<<M);for(;D!=E;)m[x[D]>>>15-l]=L,D++}},c.H.l=function(u,l){let m=c.H.m.r,y=15-l;for(let x=0;x<u.length;x+=2){let w=u[x]<<l-u[x+1];u[x]=m[w]>>>y}},c.H.M=function(u,l,m){m<<=7&l;let y=l>>>3;u[y]|=m,u[y+1]|=m>>>8},c.H.I=function(u,l,m){m<<=7&l;let y=l>>>3;u[y]|=m,u[y+1]|=m>>>8,u[y+2]|=m>>>16},c.H.e=function(u,l,m){return(u[l>>>3]|u[1+(l>>>3)]<<8)>>>(7&l)&(1<<m)-1},c.H.b=function(u,l,m){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16)>>>(7&l)&(1<<m)-1},c.H.Z=function(u,l){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16)>>>(7&l)},c.H.i=function(u,l){return(u[l>>>3]|u[1+(l>>>3)]<<8|u[2+(l>>>3)]<<16|u[3+(l>>>3)]<<24)>>>(7&l)},c.H.m=function(){let u=Uint16Array,l=Uint32Array;return{K:new u(16),j:new u(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new u(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new l(32),J:new u(512),_:[],h:new u(32),$:[],w:new u(32768),C:[],v:[],d:new u(32768),D:[],u:new u(512),Q:[],r:new u(32768),s:new l(286),Y:new l(30),a:new l(19),t:new l(15e3),k:new u(65536),g:new u(32768)}}(),function(){let u=c.H.m;for(var l=0;l<32768;l++){let y=l;y=(2863311530&y)>>>1|(1431655765&y)<<1,y=(3435973836&y)>>>2|(858993459&y)<<2,y=(4042322160&y)>>>4|(252645135&y)<<4,y=(4278255360&y)>>>8|(16711935&y)<<8,u.r[l]=(y>>>16|y<<16)>>>17}function m(y,x,w){for(;x--!=0;)y.push(0,w)}for(l=0;l<32;l++)u.q[l]=u.S[l]<<3|u.T[l],u.c[l]=u.p[l]<<4|u.z[l];m(u._,144,8),m(u._,112,9),m(u._,24,7),m(u._,8,8),c.H.n(u._,9),c.H.A(u._,9,u.J),c.H.l(u._,9),m(u.$,32,5),c.H.n(u.$,5),c.H.A(u.$,5,u.h),c.H.l(u.$,5),m(u.Q,19,0),m(u.C,286,0),m(u.D,30,0),m(u.v,320,0)}(),c.H.N}();function n(c){return[1,null,3,1,2,null,4][c.ctype]*c.depth}function i(c,u,l,m,y){let x=n(u),w=Math.ceil(m*x/8),C,k;x=Math.ceil(x/8);let L=c[l],M=0;if(L>1&&(c[l]=[0,0,1][L-2]),L==3)for(M=x;M<w;M++)c[M+1]=c[M+1]+(c[M+1-x]>>>1)&255;for(let D=0;D<y;D++)if(C=l+D*w,k=C+D+1,L=c[k-1],M=0,L==0)for(;M<w;M++)c[C+M]=c[k+M];else if(L==1){for(;M<x;M++)c[C+M]=c[k+M];for(;M<w;M++)c[C+M]=c[k+M]+c[C+M-x]}else if(L==2)for(;M<w;M++)c[C+M]=c[k+M]+c[C+M-w];else if(L==3){for(;M<x;M++)c[C+M]=c[k+M]+(c[C+M-w]>>>1);for(;M<w;M++)c[C+M]=c[k+M]+(c[C+M-w]+c[C+M-x]>>>1)}else{for(;M<x;M++)c[C+M]=c[k+M]+a(0,c[C+M-w],0);for(;M<w;M++)c[C+M]=c[k+M]+a(c[C+M-x],c[C+M-w],c[C+M-x-w])}return c}function a(c,u,l){let m=c+u-l,y=m-c,x=m-u,w=m-l;return y*y<=x*x&&y*y<=w*w?c:x*x<=w*w?u:l}function f(c,u,l){l.width=s.readUint(c,u),u+=4,l.height=s.readUint(c,u),u+=4,l.depth=c[u],u++,l.ctype=c[u],u++,l.compress=c[u],u++,l.filter=c[u],u++,l.interlace=c[u],u++}function p(c,u,l,m,y,x,w,C,k){let L=Math.min(u,y),M=Math.min(l,x),D=0,E=0;for(let _=0;_<M;_++)for(let A=0;A<L;A++)if(w>=0&&C>=0?(D=_*u+A<<2,E=(C+_)*y+w+A<<2):(D=(-C+_)*u-w+A<<2,E=_*y+A<<2),k==0)m[E]=c[D],m[E+1]=c[D+1],m[E+2]=c[D+2],m[E+3]=c[D+3];else if(k==1){var O=c[D+3]*.00392156862745098,g=c[D]*O,h=c[D+1]*O,v=c[D+2]*O,b=m[E+3]*(1/255),I=m[E]*b,S=m[E+1]*b,T=m[E+2]*b;let d=1-O,U=O+b*d,P=U==0?0:1/U;m[E+3]=255*U,m[E+0]=(g+I*d)*P,m[E+1]=(h+S*d)*P,m[E+2]=(v+T*d)*P}else if(k==2)O=c[D+3],g=c[D],h=c[D+1],v=c[D+2],b=m[E+3],I=m[E],S=m[E+1],T=m[E+2],O==b&&g==I&&h==S&&v==T?(m[E]=0,m[E+1]=0,m[E+2]=0,m[E+3]=0):(m[E]=g,m[E+1]=h,m[E+2]=v,m[E+3]=O);else if(k==3){if(O=c[D+3],g=c[D],h=c[D+1],v=c[D+2],b=m[E+3],I=m[E],S=m[E+1],T=m[E+2],O==b&&g==I&&h==S&&v==T)continue;if(O<220&&b>20)return!1}return!0}return{decode:function(u){let l=new Uint8Array(u),m=8,y=s,x=y.readUshort,w=y.readUint,C={tabs:{},frames:[]},k=new Uint8Array(l.length),L,M=0,D=0,E=[137,80,78,71,13,10,26,10];for(var O=0;O<8;O++)if(l[O]!=E[O])throw"The input is not a PNG file!";for(;m<l.length;){let _=y.readUint(l,m);m+=4;let A=y.readASCII(l,m,4);if(m+=4,A=="IHDR")f(l,m,C);else if(A=="iCCP"){for(var g=m;l[g]!=0;)g++;y.readASCII(l,m,g-m),l[g+1];let d=l.slice(g+2,m+_),U=null;try{U=e(d)}catch{U=t(d)}C.tabs[A]=U}else if(A=="CgBI")C.tabs[A]=l.slice(m,m+4);else if(A=="IDAT"){for(O=0;O<_;O++)k[M+O]=l[m+O];M+=_}else if(A=="acTL")C.tabs[A]={num_frames:w(l,m),num_plays:w(l,m+4)},L=new Uint8Array(l.length);else if(A=="fcTL"){D!=0&&((T=C.frames[C.frames.length-1]).data=o(C,L.slice(0,D),T.rect.width,T.rect.height),D=0);let d={x:w(l,m+12),y:w(l,m+16),width:w(l,m+4),height:w(l,m+8)},U=x(l,m+22);U=x(l,m+20)/(U==0?100:U);let P={rect:d,delay:Math.round(1e3*U),dispose:l[m+24],blend:l[m+25]};C.frames.push(P)}else if(A=="fdAT"){for(O=0;O<_-4;O++)L[D+O]=l[m+O+4];D+=_-4}else if(A=="pHYs")C.tabs[A]=[y.readUint(l,m),y.readUint(l,m+4),l[m+8]];else if(A=="cHRM")for(C.tabs[A]=[],O=0;O<8;O++)C.tabs[A].push(y.readUint(l,m+4*O));else if(A=="tEXt"||A=="zTXt"){C.tabs[A]==null&&(C.tabs[A]={});var h=y.nextZero(l,m),v=y.readASCII(l,m,h-m),b=m+_-h-1;if(A=="tEXt")S=y.readASCII(l,h+1,b);else{var I=e(l.slice(h+2,h+2+b));S=y.readUTF8(I,0,I.length)}C.tabs[A][v]=S}else if(A=="iTXt"){C.tabs[A]==null&&(C.tabs[A]={}),h=0,g=m,h=y.nextZero(l,g),v=y.readASCII(l,g,h-g);let d=l[g=h+1];var S;l[g+1],g+=2,h=y.nextZero(l,g),y.readASCII(l,g,h-g),g=h+1,h=y.nextZero(l,g),y.readUTF8(l,g,h-g),b=_-((g=h+1)-m),d==0?S=y.readUTF8(l,g,b):(I=e(l.slice(g,g+b)),S=y.readUTF8(I,0,I.length)),C.tabs[A][v]=S}else if(A=="PLTE")C.tabs[A]=y.readBytes(l,m,_);else if(A=="hIST"){let d=C.tabs.PLTE.length/3;for(C.tabs[A]=[],O=0;O<d;O++)C.tabs[A].push(x(l,m+2*O))}else if(A=="tRNS")C.ctype==3?C.tabs[A]=y.readBytes(l,m,_):C.ctype==0?C.tabs[A]=x(l,m):C.ctype==2&&(C.tabs[A]=[x(l,m),x(l,m+2),x(l,m+4)]);else if(A=="gAMA")C.tabs[A]=y.readUint(l,m)/1e5;else if(A=="sRGB")C.tabs[A]=l[m];else if(A=="bKGD")C.ctype==0||C.ctype==4?C.tabs[A]=[x(l,m)]:C.ctype==2||C.ctype==6?C.tabs[A]=[x(l,m),x(l,m+2),x(l,m+4)]:C.ctype==3&&(C.tabs[A]=l[m]);else if(A=="IEND")break;m+=_,y.readUint(l,m),m+=4}var T;return D!=0&&((T=C.frames[C.frames.length-1]).data=o(C,L.slice(0,D),T.rect.width,T.rect.height)),C.data=o(C,k,C.width,C.height),delete C.compress,delete C.interlace,delete C.filter,C},toRGBA8:function(u){let l=u.width,m=u.height;if(u.tabs.acTL==null)return[r(u.data,l,m,u).buffer];let y=[];u.frames[0].data==null&&(u.frames[0].data=u.data);let x=l*m*4,w=new Uint8Array(x),C=new Uint8Array(x),k=new Uint8Array(x);for(let M=0;M<u.frames.length;M++){let D=u.frames[M],E=D.rect.x,O=D.rect.y,g=D.rect.width,h=D.rect.height,v=r(D.data,g,h,u);if(M!=0)for(var L=0;L<x;L++)k[L]=w[L];if(D.blend==0?p(v,g,h,w,l,m,E,O,0):D.blend==1&&p(v,g,h,w,l,m,E,O,1),y.push(w.buffer.slice(0)),D.dispose!=0){if(D.dispose==1)p(C,g,h,w,l,m,E,O,0);else if(D.dispose==2)for(L=0;L<x;L++)w[L]=k[L]}}return y},_paeth:a,_copyTile:p,_bin:s}}();(function(){let{_copyTile:s}=Ut,{_bin:r}=Ut,o=Ut._paeth;var e={table:function(){let g=new Uint32Array(256);for(let h=0;h<256;h++){let v=h;for(let b=0;b<8;b++)1&v?v=3988292384^v>>>1:v>>>=1;g[h]=v}return g}(),update(g,h,v,b){for(let I=0;I<b;I++)g=e.table[255&(g^h[v+I])]^g>>>8;return g},crc:(g,h,v)=>4294967295^e.update(4294967295,g,h,v)};function t(g,h,v,b){h[v]+=g[0]*b>>4,h[v+1]+=g[1]*b>>4,h[v+2]+=g[2]*b>>4,h[v+3]+=g[3]*b>>4}function n(g){return Math.max(0,Math.min(255,g))}function i(g,h){let v=g[0]-h[0],b=g[1]-h[1],I=g[2]-h[2],S=g[3]-h[3];return v*v+b*b+I*I+S*S}function a(g,h,v,b,I,S,T){T==null&&(T=1);let _=b.length,A=[];for(var d=0;d<_;d++){let R=b[d];A.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(d=0;d<_;d++){let R=4294967295;for(var U=0,P=0;P<_;P++){var F=i(A[d],A[P]);P!=d&&F<R&&(R=F,U=P)}}let q=new Uint32Array(I.buffer),H=new Int16Array(h*v*4),G=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(d=0;d<G.length;d++)G[d]=255*((G[d]+.5)/16-.5);for(let R=0;R<v;R++)for(let W=0;W<h;W++){var N;d=4*(R*h+W),T!=2?N=[n(g[d]+H[d]),n(g[d+1]+H[d+1]),n(g[d+2]+H[d+2]),n(g[d+3]+H[d+3])]:(F=G[4*(3&R)+(3&W)],N=[n(g[d]+F),n(g[d+1]+F),n(g[d+2]+F),n(g[d+3]+F)]),U=0;let tt=16777215;for(P=0;P<_;P++){let Y=i(N,A[P]);Y<tt&&(tt=Y,U=P)}let X=A[U],$=[N[0]-X[0],N[1]-X[1],N[2]-X[2],N[3]-X[3]];T==1&&(W!=h-1&&t($,H,d+4,7),R!=v-1&&(W!=0&&t($,H,d+4*h-4,3),t($,H,d+4*h,5),W!=h-1&&t($,H,d+4*h+4,1))),S[d>>2]=U,q[d>>2]=b[U]}}function f(g,h,v,b,I){I==null&&(I={});let{crc:S}=e,T=r.writeUint,_=r.writeUshort,A=r.writeASCII,d=8,U=g.frames.length>1,P,F=!1,q=33+(U?20:0);if(I.sRGB!=null&&(q+=13),I.pHYs!=null&&(q+=21),I.iCCP!=null&&(P=pako.deflate(I.iCCP),q+=21+P.length+4),g.ctype==3){for(var H=g.plte.length,G=0;G<H;G++)g.plte[G]>>>24!=255&&(F=!0);q+=8+3*H+4+(F?8+1*H+4:0)}for(var N=0;N<g.frames.length;N++)U&&(q+=38),q+=(X=g.frames[N]).cimg.length+12,N!=0&&(q+=4);q+=12;let R=new Uint8Array(q),W=[137,80,78,71,13,10,26,10];for(G=0;G<8;G++)R[G]=W[G];if(T(R,d,13),d+=4,A(R,d,"IHDR"),d+=4,T(R,d,h),d+=4,T(R,d,v),d+=4,R[d]=g.depth,d++,R[d]=g.ctype,d++,R[d]=0,d++,R[d]=0,d++,R[d]=0,d++,T(R,d,S(R,d-17,17)),d+=4,I.sRGB!=null&&(T(R,d,1),d+=4,A(R,d,"sRGB"),d+=4,R[d]=I.sRGB,d++,T(R,d,S(R,d-5,5)),d+=4),I.iCCP!=null){let $=13+P.length;T(R,d,$),d+=4,A(R,d,"iCCP"),d+=4,A(R,d,"ICC profile"),d+=11,d+=2,R.set(P,d),d+=P.length,T(R,d,S(R,d-($+4),$+4)),d+=4}if(I.pHYs!=null&&(T(R,d,9),d+=4,A(R,d,"pHYs"),d+=4,T(R,d,I.pHYs[0]),d+=4,T(R,d,I.pHYs[1]),d+=4,R[d]=I.pHYs[2],d++,T(R,d,S(R,d-13,13)),d+=4),U&&(T(R,d,8),d+=4,A(R,d,"acTL"),d+=4,T(R,d,g.frames.length),d+=4,T(R,d,I.loop!=null?I.loop:0),d+=4,T(R,d,S(R,d-12,12)),d+=4),g.ctype==3){for(T(R,d,3*(H=g.plte.length)),d+=4,A(R,d,"PLTE"),d+=4,G=0;G<H;G++){let $=3*G,Y=g.plte[G],ot=255&Y,ut=Y>>>8&255,$t=Y>>>16&255;R[d+$+0]=ot,R[d+$+1]=ut,R[d+$+2]=$t}if(d+=3*H,T(R,d,S(R,d-3*H-4,3*H+4)),d+=4,F){for(T(R,d,H),d+=4,A(R,d,"tRNS"),d+=4,G=0;G<H;G++)R[d+G]=g.plte[G]>>>24&255;d+=H,T(R,d,S(R,d-H-4,H+4)),d+=4}}let tt=0;for(N=0;N<g.frames.length;N++){var X=g.frames[N];U&&(T(R,d,26),d+=4,A(R,d,"fcTL"),d+=4,T(R,d,tt++),d+=4,T(R,d,X.rect.width),d+=4,T(R,d,X.rect.height),d+=4,T(R,d,X.rect.x),d+=4,T(R,d,X.rect.y),d+=4,_(R,d,b[N]),d+=2,_(R,d,1e3),d+=2,R[d]=X.dispose,d++,R[d]=X.blend,d++,T(R,d,S(R,d-30,30)),d+=4);let $=X.cimg;T(R,d,(H=$.length)+(N==0?0:4)),d+=4;let Y=d;A(R,d,N==0?"IDAT":"fdAT"),d+=4,N!=0&&(T(R,d,tt++),d+=4),R.set($,d),d+=H,T(R,d,S(R,Y,d-Y)),d+=4}return T(R,d,0),d+=4,A(R,d,"IEND"),d+=4,T(R,d,S(R,d-4,4)),d+=4,R.buffer}function p(g,h,v){for(let b=0;b<g.frames.length;b++){let I=g.frames[b];I.rect.width;let S=I.rect.height,T=new Uint8Array(S*I.bpl+S);I.cimg=m(I.img,S,I.bpp,I.bpl,T,h,v)}}function c(g,h,v,b,I){let S=I[0],T=I[1],_=I[2],A=I[3],d=I[4],U=I[5],P=6,F=8,q=255;for(var H=0;H<g.length;H++){let mt=new Uint8Array(g[H]);for(var G=mt.length,N=0;N<G;N+=4)q&=mt[N+3]}let R=q!=255,W=function(et,Z,lt,yt,at,vt){let ct=[];for(var J=0;J<et.length;J++){let At=new Uint8Array(et[J]),Ot=new Uint32Array(At.buffer);var bt;let St=0,Bt=0,Ft=Z,jt=lt,Dr=yt?1:0;if(J!=0){let Pi=vt||yt||J==1||ct[J-2].dispose!=0?1:2,Ur=0,hn=1e9;for(let Xe=0;Xe<Pi;Xe++){var qt=new Uint8Array(et[J-1-Xe]);let Mi=new Uint32Array(et[J-1-Xe]),zt=Z,Wt=lt,Le=-1,Ye=-1;for(let Kt=0;Kt<lt;Kt++)for(let Xt=0;Xt<Z;Xt++)Ot[pt=Kt*Z+Xt]!=Mi[pt]&&(Xt<zt&&(zt=Xt),Xt>Le&&(Le=Xt),Kt<Wt&&(Wt=Kt),Kt>Ye&&(Ye=Kt));Le==-1&&(zt=Wt=Le=Ye=0),at&&((1&zt)==1&&zt--,(1&Wt)==1&&Wt--);let gn=(Le-zt+1)*(Ye-Wt+1);gn<hn&&(hn=gn,Ur=Xe,St=zt,Bt=Wt,Ft=Le-zt+1,jt=Ye-Wt+1)}qt=new Uint8Array(et[J-1-Ur]),Ur==1&&(ct[J-1].dispose=2),bt=new Uint8Array(Ft*jt*4),s(qt,Z,lt,bt,Ft,jt,-St,-Bt,0),Dr=s(At,Z,lt,bt,Ft,jt,-St,-Bt,3)?1:0,Dr==1?l(At,Z,lt,bt,{x:St,y:Bt,width:Ft,height:jt}):s(At,Z,lt,bt,Ft,jt,-St,-Bt,0)}else bt=At.slice(0);ct.push({rect:{x:St,y:Bt,width:Ft,height:jt},img:bt,blend:Dr,dispose:0})}if(yt)for(J=0;J<ct.length;J++){if((Qt=ct[J]).blend==1)continue;let At=Qt.rect,Ot=ct[J-1].rect,St=Math.min(At.x,Ot.x),Bt=Math.min(At.y,Ot.y),Ft={x:St,y:Bt,width:Math.max(At.x+At.width,Ot.x+Ot.width)-St,height:Math.max(At.y+At.height,Ot.y+Ot.height)-Bt};ct[J-1].dispose=1,J-1!=0&&u(et,Z,lt,ct,J-1,Ft,at),u(et,Z,lt,ct,J,Ft,at)}let or=0;if(et.length!=1)for(var pt=0;pt<ct.length;pt++){var Qt;or+=(Qt=ct[pt]).rect.width*Qt.rect.height}return ct}(g,h,v,S,T,_),tt={},X=[],$=[];if(b!=0){let mt=[];for(N=0;N<W.length;N++)mt.push(W[N].img.buffer);let et=function(at){let vt=0;for(var ct=0;ct<at.length;ct++)vt+=at[ct].byteLength;let J=new Uint8Array(vt),bt=0;for(ct=0;ct<at.length;ct++){let qt=new Uint8Array(at[ct]),or=qt.length;for(let pt=0;pt<or;pt+=4){let Qt=qt[pt],At=qt[pt+1],Ot=qt[pt+2],St=qt[pt+3];St==0&&(Qt=At=Ot=0),J[bt+pt]=Qt,J[bt+pt+1]=At,J[bt+pt+2]=Ot,J[bt+pt+3]=St}bt+=or}return J.buffer}(mt),Z=x(et,b);for(N=0;N<Z.plte.length;N++)X.push(Z.plte[N].est.rgba);let lt=0;for(N=0;N<W.length;N++){let yt=(ot=W[N]).img.length;var Y=new Uint8Array(Z.inds.buffer,lt>>2,yt>>2);$.push(Y);let at=new Uint8Array(Z.abuf,lt,yt);U&&a(ot.img,ot.rect.width,ot.rect.height,X,at,Y),ot.img.set(at),lt+=yt}}else for(H=0;H<W.length;H++){var ot=W[H];let mt=new Uint32Array(ot.img.buffer);var ut=ot.rect.width;for(G=mt.length,Y=new Uint8Array(G),$.push(Y),N=0;N<G;N++){let et=mt[N];if(N!=0&&et==mt[N-1])Y[N]=Y[N-1];else if(N>ut&&et==mt[N-ut])Y[N]=Y[N-ut];else{let Z=tt[et];if(Z==null&&(tt[et]=Z=X.length,X.push(et),X.length>=300))break;Y[N]=Z}}}let $t=X.length;for($t<=256&&d==0&&(F=$t<=2?1:$t<=4?2:$t<=16?4:8,F=Math.max(F,A)),H=0;H<W.length;H++){(ot=W[H]).rect.x,ot.rect.y,ut=ot.rect.width;let mt=ot.rect.height,et=ot.img;new Uint32Array(et.buffer);let Z=4*ut,lt=4;if($t<=256&&d==0){Z=Math.ceil(F*ut/8);var kt=new Uint8Array(Z*mt);let yt=$[H];for(let at=0;at<mt;at++){N=at*Z;let vt=at*ut;if(F==8)for(var nt=0;nt<ut;nt++)kt[N+nt]=yt[vt+nt];else if(F==4)for(nt=0;nt<ut;nt++)kt[N+(nt>>1)]|=yt[vt+nt]<<4-4*(1&nt);else if(F==2)for(nt=0;nt<ut;nt++)kt[N+(nt>>2)]|=yt[vt+nt]<<6-2*(3&nt);else if(F==1)for(nt=0;nt<ut;nt++)kt[N+(nt>>3)]|=yt[vt+nt]<<7-1*(7&nt)}et=kt,P=3,lt=1}else if(R==0&&W.length==1){kt=new Uint8Array(ut*mt*3);let yt=ut*mt;for(N=0;N<yt;N++){let at=3*N,vt=4*N;kt[at]=et[vt],kt[at+1]=et[vt+1],kt[at+2]=et[vt+2]}et=kt,P=2,lt=3,Z=3*ut}ot.img=et,ot.bpl=Z,ot.bpp=lt}return{ctype:P,depth:F,plte:X,frames:W}}function u(g,h,v,b,I,S,T){let _=Uint8Array,A=Uint32Array,d=new _(g[I-1]),U=new A(g[I-1]),P=I+1<g.length?new _(g[I+1]):null,F=new _(g[I]),q=new A(F.buffer),H=h,G=v,N=-1,R=-1;for(let tt=0;tt<S.height;tt++)for(let X=0;X<S.width;X++){let $=S.x+X,Y=S.y+tt,ot=Y*h+$,ut=q[ot];ut==0||b[I-1].dispose==0&&U[ot]==ut&&(P==null||P[4*ot+3]!=0)||($<H&&(H=$),$>N&&(N=$),Y<G&&(G=Y),Y>R&&(R=Y))}N==-1&&(H=G=N=R=0),T&&((1&H)==1&&H--,(1&G)==1&&G--),S={x:H,y:G,width:N-H+1,height:R-G+1};let W=b[I];W.rect=S,W.blend=1,W.img=new Uint8Array(S.width*S.height*4),b[I-1].dispose==0?(s(d,h,v,W.img,S.width,S.height,-S.x,-S.y,0),l(F,h,v,W.img,S)):s(F,h,v,W.img,S.width,S.height,-S.x,-S.y,0)}function l(g,h,v,b,I){s(g,h,v,b,I.width,I.height,-I.x,-I.y,2)}function m(g,h,v,b,I,S,T){let _=[],A,d=[0,1,2,3,4];S!=-1?d=[S]:(h*b>5e5||v==1)&&(d=[0]),T&&(A={level:0});let U=Ms;for(var P=0;P<d.length;P++){for(let H=0;H<h;H++)y(I,g,H,b,v,d[P]);_.push(U.deflate(I,A))}let F,q=1e9;for(P=0;P<_.length;P++)_[P].length<q&&(F=P,q=_[P].length);return _[F]}function y(g,h,v,b,I,S){let T=v*b,_=T+v;if(g[_]=S,_++,S==0)if(b<500)for(var A=0;A<b;A++)g[_+A]=h[T+A];else g.set(new Uint8Array(h.buffer,T,b),_);else if(S==1){for(A=0;A<I;A++)g[_+A]=h[T+A];for(A=I;A<b;A++)g[_+A]=h[T+A]-h[T+A-I]+256&255}else if(v==0){for(A=0;A<I;A++)g[_+A]=h[T+A];if(S==2)for(A=I;A<b;A++)g[_+A]=h[T+A];if(S==3)for(A=I;A<b;A++)g[_+A]=h[T+A]-(h[T+A-I]>>1)+256&255;if(S==4)for(A=I;A<b;A++)g[_+A]=h[T+A]-o(h[T+A-I],0,0)+256&255}else{if(S==2)for(A=0;A<b;A++)g[_+A]=h[T+A]+256-h[T+A-b]&255;if(S==3){for(A=0;A<I;A++)g[_+A]=h[T+A]+256-(h[T+A-b]>>1)&255;for(A=I;A<b;A++)g[_+A]=h[T+A]+256-(h[T+A-b]+h[T+A-I]>>1)&255}if(S==4){for(A=0;A<I;A++)g[_+A]=h[T+A]+256-o(0,h[T+A-b],0)&255;for(A=I;A<b;A++)g[_+A]=h[T+A]+256-o(h[T+A-I],h[T+A-b],h[T+A-I-b])&255}}}function x(g,h){let v=new Uint8Array(g),b=v.slice(0),I=new Uint32Array(b.buffer),S=w(b,h),T=S[0],_=S[1],A=v.length,d=new Uint8Array(A>>2),U;if(v.length<2e7)for(var P=0;P<A;P+=4)U=C(T,F=v[P]*(1/255),q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255)),d[P>>2]=U.ind,I[P>>2]=U.est.rgba;else for(P=0;P<A;P+=4){var F=v[P]*.00392156862745098,q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255);for(U=T;U.left;)U=k(U.est,F,q,H,G)<=0?U.left:U.right;d[P>>2]=U.ind,I[P>>2]=U.est.rgba}return{abuf:b.buffer,inds:d,plte:_}}function w(g,h,v){v==null&&(v=1e-4);let b=new Uint32Array(g.buffer),I={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};I.bst=D(g,I.i0,I.i1),I.est=E(I.bst);let S=[I];for(;S.length<h;){let _=0,A=0;for(var T=0;T<S.length;T++)S[T].est.L>_&&(_=S[T].est.L,A=T);if(_<v)break;let d=S[A],U=L(g,b,d.i0,d.i1,d.est.e,d.est.eMq255);if(d.i0>=U||d.i1<=U){d.est.L=0;continue}let P={i0:d.i0,i1:U,bst:null,est:null,tdst:0,left:null,right:null};P.bst=D(g,P.i0,P.i1),P.est=E(P.bst);let F={i0:U,i1:d.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:d.bst.N-P.bst.N},T=0;T<16;T++)F.bst.R[T]=d.bst.R[T]-P.bst.R[T];for(T=0;T<4;T++)F.bst.m[T]=d.bst.m[T]-P.bst.m[T];F.est=E(F.bst),d.left=P,d.right=F,S[A]=P,S.push(F)}for(S.sort((_,A)=>A.bst.N-_.bst.N),T=0;T<S.length;T++)S[T].ind=T;return[I,S]}function C(g,h,v,b,I){if(g.left==null)return g.tdst=function(P,F,q,H,G){let N=F-P[0],R=q-P[1],W=H-P[2],tt=G-P[3];return N*N+R*R+W*W+tt*tt}(g.est.q,h,v,b,I),g;let S=k(g.est,h,v,b,I),T=g.left,_=g.right;S>0&&(T=g.right,_=g.left);let A=C(T,h,v,b,I);if(A.tdst<=S*S)return A;let d=C(_,h,v,b,I);return d.tdst<A.tdst?d:A}function k(g,h,v,b,I){let{e:S}=g;return S[0]*h+S[1]*v+S[2]*b+S[3]*I-g.eMq}function L(g,h,v,b,I,S){for(b-=4;v<b;){for(;M(g,v,I)<=S;)v+=4;for(;M(g,b,I)>S;)b-=4;if(v>=b)break;let T=h[v>>2];h[v>>2]=h[b>>2],h[b>>2]=T,v+=4,b-=4}for(;M(g,v,I)>S;)v-=4;return v+4}function M(g,h,v){return g[h]*v[0]+g[h+1]*v[1]+g[h+2]*v[2]+g[h+3]*v[3]}function D(g,h,v){let b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=[0,0,0,0],S=v-h>>2;for(let T=h;T<v;T+=4){let _=g[T]*.00392156862745098,A=g[T+1]*(1/255),d=g[T+2]*(1/255),U=g[T+3]*(1/255);I[0]+=_,I[1]+=A,I[2]+=d,I[3]+=U,b[0]+=_*_,b[1]+=_*A,b[2]+=_*d,b[3]+=_*U,b[5]+=A*A,b[6]+=A*d,b[7]+=A*U,b[10]+=d*d,b[11]+=d*U,b[15]+=U*U}return b[4]=b[1],b[8]=b[2],b[9]=b[6],b[12]=b[3],b[13]=b[7],b[14]=b[11],{R:b,m:I,N:S}}function E(g){let{R:h}=g,{m:v}=g,{N:b}=g,I=v[0],S=v[1],T=v[2],_=v[3],A=b==0?0:1/b,d=[h[0]-I*I*A,h[1]-I*S*A,h[2]-I*T*A,h[3]-I*_*A,h[4]-S*I*A,h[5]-S*S*A,h[6]-S*T*A,h[7]-S*_*A,h[8]-T*I*A,h[9]-T*S*A,h[10]-T*T*A,h[11]-T*_*A,h[12]-_*I*A,h[13]-_*S*A,h[14]-_*T*A,h[15]-_*_*A],U=d,P=O,F=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,H=0;if(b!=0)for(let N=0;N<16&&(F=P.multVec(U,F),H=Math.sqrt(P.dot(F,F)),F=P.sml(1/H,F),!(N!=0&&Math.abs(H-q)<1e-9));N++)q=H;let G=[I*A,S*A,T*A,_*A];return{Cov:d,q:G,e:F,L:q,eMq255:P.dot(P.sml(255,G),F),eMq:P.dot(F,G),rgba:(Math.round(255*G[3])<<24|Math.round(255*G[2])<<16|Math.round(255*G[1])<<8|Math.round(255*G[0])<<0)>>>0}}var O={multVec:(g,h)=>[g[0]*h[0]+g[1]*h[1]+g[2]*h[2]+g[3]*h[3],g[4]*h[0]+g[5]*h[1]+g[6]*h[2]+g[7]*h[3],g[8]*h[0]+g[9]*h[1]+g[10]*h[2]+g[11]*h[3],g[12]*h[0]+g[13]*h[1]+g[14]*h[2]+g[15]*h[3]],dot:(g,h)=>g[0]*h[0]+g[1]*h[1]+g[2]*h[2]+g[3]*h[3],sml:(g,h)=>[g*h[0],g*h[1],g*h[2],g*h[3]]};Ut.encode=function(h,v,b,I,S,T,_){I==null&&(I=0),_==null&&(_=!1);let A=c(h,v,b,I,[!1,!1,!1,0,_,!1]);return p(A,-1),f(A,v,b,S,T)},Ut.encodeLL=function(h,v,b,I,S,T,_,A){let d={ctype:0+(I==1?0:2)+(S==0?0:4),depth:T,frames:[]},U=(I+S)*T,P=U*v;for(let F=0;F<h.length;F++)d.frames.push({rect:{x:0,y:0,width:v,height:b},img:new Uint8Array(h[F]),blend:0,dispose:1,bpp:Math.ceil(U/8),bpl:Math.ceil(P/8)});return p(d,0,!0),f(d,v,b,_,A)},Ut.encode.compress=c,Ut.encode.dither=a,Ut.quantize=x,Ut.quantize.getKDtree=w,Ut.quantize.getNearest=C})();var mi={toArrayBuffer(s,r){let o=s.width,e=s.height,t=o<<2,n=s.getContext("2d").getImageData(0,0,o,e),i=new Uint32Array(n.data.buffer),a=(32*o+31)/32<<2,f=a*e,p=122+f,c=new ArrayBuffer(p),u=new DataView(c),l=1<<20,m,y,x,w,C=l,k=0,L=0,M=0;function D(g){u.setUint16(L,g,!0),L+=2}function E(g){u.setUint32(L,g,!0),L+=4}function O(g){L+=g}D(19778),E(p),O(4),E(122),E(108),E(o),E(-e>>>0),D(1),D(32),E(3),E(f),E(2835),E(2835),O(8),E(16711680),E(65280),E(255),E(4278190080),E(1466527264),function g(){for(;k<e&&C>0;){for(w=122+k*a,m=0;m<t;)C--,y=i[M++],x=y>>>24,u.setUint32(w+m,y<<8|x),m+=4;k++}M<i.length?(C=l,setTimeout(g,mi._dly)):r(c)}()},toBlob(s,r){this.toArrayBuffer(s,o=>{r(new Blob([o],{type:"image/bmp"}))})},_dly:9},xt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Ls={[xt.CHROME]:16384,[xt.FIREFOX]:11180,[xt.DESKTOP_SAFARI]:16384,[xt.IE]:8192,[xt.IOS]:4096,[xt.ETC]:8192},un=typeof window<"u",pi=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Pr=un&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Os=(un||pi)&&(Pr&&Pr.getOriginalSymbol(window,"File")||typeof File<"u"&&File),di=(un||pi)&&(Pr&&Pr.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function ln(s,r,o=Date.now()){return new Promise(e=>{let t=s.split(","),n=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]),a=i.length,f=new Uint8Array(a);for(;a--;)f[a]=i.charCodeAt(a);let p=new Blob([f],{type:n});p.name=r,p.lastModified=o,e(p)})}function hi(s){return new Promise((r,o)=>{let e=new di;e.onload=()=>r(e.result),e.onerror=t=>o(t),e.readAsDataURL(s)})}function gi(s){return new Promise((r,o)=>{let e=new Image;e.onload=()=>r(e),e.onerror=t=>o(t),e.src=s})}function Te(){if(Te.cachedResult!==void 0)return Te.cachedResult;let s=xt.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?s=xt.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?s=xt.IOS:/Safari/i.test(r)?s=xt.DESKTOP_SAFARI:/Firefox/i.test(r)?s=xt.FIREFOX:(/MSIE/i.test(r)||document.documentMode)&&(s=xt.IE),Te.cachedResult=s,Te.cachedResult}function yi(s,r){let o=Te(),e=Ls[o],t=s,n=r,i=t*n,a=t>n?n/t:t/n;for(;i>e*e;){let f=(e+t)/2,p=(e+n)/2;f<p?(n=p,t=p*a):(n=f*a,t=f),i=t*n}return{width:t,height:n}}function Or(s,r){let o,e;try{if(o=new OffscreenCanvas(s,r),e=o.getContext("2d"),e===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{o=document.createElement("canvas"),e=o.getContext("2d")}return o.width=s,o.height=r,[o,e]}function Ai(s,r){let{width:o,height:e}=yi(s.width,s.height),[t,n]=Or(o,e);return r&&/jpe?g/.test(r)&&(n.fillStyle="white",n.fillRect(0,0,t.width,t.height)),n.drawImage(s,0,0,t.width,t.height),t}function _r(){return _r.cachedResult!==void 0||(_r.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),_r.cachedResult}function Mr(s,r={}){return new Promise(function(o,e){let t,n;var i=function(){try{return n=Ai(t,r.fileType||s.type),o([t,n])}catch(f){return e(f)}},a=function(f){try{var p=function(c){try{throw c}catch(u){return e(u)}};try{let c;return hi(s).then(function(u){try{return c=u,gi(c).then(function(l){try{return t=l,function(){try{return i()}catch(m){return e(m)}}()}catch(m){return p(m)}},p)}catch(l){return p(l)}},p)}catch(c){p(c)}}catch(c){return e(c)}};try{if(_r()||[xt.DESKTOP_SAFARI,xt.MOBILE_SAFARI].includes(Te()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(s).then(function(f){try{return t=f,i()}catch{return a()}},a)}catch{a()}})}function Lr(s,r,o,e,t=1){return new Promise(function(n,i){let a;if(r==="image/png"){let p,c,u;return p=s.getContext("2d"),{data:c}=p.getImageData(0,0,s.width,s.height),u=Ut.encode([c.buffer],s.width,s.height,4096*t),a=new Blob([u],{type:r}),a.name=o,a.lastModified=e,f.call(this)}{let p=function(){return f.call(this)};if(r==="image/bmp")return new Promise(c=>mi.toBlob(s,c)).then(function(c){try{return a=c,a.name=o,a.lastModified=e,p.call(this)}catch(u){return i(u)}}.bind(this),i);{let c=function(){return p.call(this)};if(typeof OffscreenCanvas=="function"&&s instanceof OffscreenCanvas)return s.convertToBlob({type:r,quality:t}).then(function(u){try{return a=u,a.name=o,a.lastModified=e,c.call(this)}catch(l){return i(l)}}.bind(this),i);{let u;return u=s.toDataURL(r,t),ln(u,o,e).then(function(l){try{return a=l,c.call(this)}catch(m){return i(m)}}.bind(this),i)}}}function f(){return n(a)}})}function Ht(s){s.width=0,s.height=0}function Qe(){return new Promise(function(s,r){let o,e,t,n,i;return Qe.cachedResult!==void 0?s(Qe.cachedResult):(o="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",ln("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(a){try{return e=a,Mr(e).then(function(f){try{return t=f[1],Lr(t,e.type,e.name,e.lastModified).then(function(p){try{return n=p,Ht(t),Mr(n).then(function(c){try{return i=c[0],Qe.cachedResult=i.width===1&&i.height===2,s(Qe.cachedResult)}catch(u){return r(u)}},r)}catch(c){return r(c)}},r)}catch(p){return r(p)}},r)}catch(f){return r(f)}},r))})}function Ti(s){return new Promise((r,o)=>{let e=new di;e.onload=t=>{let n=new DataView(t.target.result);if(n.getUint16(0,!1)!=65496)return r(-2);let i=n.byteLength,a=2;for(;a<i;){if(n.getUint16(a+2,!1)<=8)return r(-1);let f=n.getUint16(a,!1);if(a+=2,f==65505){if(n.getUint32(a+=2,!1)!=1165519206)return r(-1);let p=n.getUint16(a+=6,!1)==18761;a+=n.getUint32(a+4,p);let c=n.getUint16(a,p);a+=2;for(let u=0;u<c;u++)if(n.getUint16(a+12*u,p)==274)return r(n.getUint16(a+12*u+8,p))}else{if((65280&f)!=65280)break;a+=n.getUint16(a,!1)}}return r(-1)},e.onerror=t=>o(t),e.readAsArrayBuffer(s)})}function Ei(s,r){let{width:o}=s,{height:e}=s,{maxWidthOrHeight:t}=r,n,i=s;return isFinite(t)&&(o>t||e>t)&&([i,n]=Or(o,e),o>e?(i.width=t,i.height=e/o*t):(i.width=o/e*t,i.height=t),n.drawImage(s,0,0,i.width,i.height),Ht(s)),i}function Ci(s,r){let{width:o}=s,{height:e}=s,[t,n]=Or(o,e);switch(r>4&&r<9?(t.width=e,t.height=o):(t.width=o,t.height=e),r){case 2:n.transform(-1,0,0,1,o,0);break;case 3:n.transform(-1,0,0,-1,o,e);break;case 4:n.transform(1,0,0,-1,0,e);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,e,0);break;case 7:n.transform(0,-1,-1,0,e,o);break;case 8:n.transform(0,-1,1,0,0,o)}return n.drawImage(s,0,0,o,e),Ht(s),t}function li(s,r,o=0){return new Promise(function(e,t){let n,i,a,f,p,c,u,l,m,y,x,w,C,k,L,M,D,E,O,g;function h(b=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;n+=b,r.onProgress(Math.min(n,100))}function v(b){if(r.signal&&r.signal.aborted)throw r.signal.reason;n=Math.min(Math.max(b,n),100),r.onProgress(n)}return n=o,i=r.maxIteration||10,a=1024*r.maxSizeMB*1024,h(),Mr(s,r).then(function(b){try{return[,f]=b,h(),p=Ei(f,r),h(),new Promise(function(I,S){var T;if(!(T=r.exifOrientation))return Ti(s).then(function(A){try{return T=A,_.call(this)}catch(d){return S(d)}}.bind(this),S);function _(){return I(T)}return _.call(this)}).then(function(I){try{return c=I,h(),Qe().then(function(S){try{return u=S?p:Ci(p,c),h(),l=r.initialQuality||1,m=r.fileType||s.type,Lr(u,m,s.name,s.lastModified,l).then(function(T){try{{let A=function(){if(i--&&(L>a||L>C)){let U,P;return U=g?.95*O.width:O.width,P=g?.95*O.height:O.height,[D,E]=Or(U,P),E.drawImage(O,0,0,U,P),l*=m==="image/png"?.85:.95,Lr(D,m,s.name,s.lastModified,l).then(function(F){try{return M=F,Ht(O),O=D,L=M.size,v(Math.min(99,Math.floor((k-L)/(k-a)*100))),A}catch(q){return t(q)}},t)}return[1]},d=function(){return Ht(O),Ht(D),Ht(p),Ht(u),Ht(f),v(100),e(M)};if(y=T,h(),x=y.size>a,w=y.size>s.size,!x&&!w)return v(100),e(y);var _;return C=s.size,k=y.size,L=k,O=u,g=!r.alwaysKeepResolution&&x,(_=function(U){for(;U;){if(U.then)return void U.then(_,t);try{if(U.pop){if(U.length)return U.pop()?d.call(this):U;U=A}else U=U.call(this)}catch(P){return t(P)}}}.bind(this))(A)}}catch(A){return t(A)}}.bind(this),t)}catch(T){return t(T)}}.bind(this),t)}catch(S){return t(S)}}.bind(this),t)}catch(I){return t(I)}}.bind(this),t)})}var Rs=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`,cn;function Ds(s,r){return new Promise((o,e)=>{cn||(cn=function(i){let a=[];return typeof i=="function"?a.push(`(${i})()`):a.push(i),URL.createObjectURL(new Blob(a))}(Rs));let t=new Worker(cn);t.addEventListener("message",function(i){if(r.signal&&r.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return e(new Error(i.data.error)),void t.terminate();o(i.data.file),t.terminate()}else r.onProgress(i.data.progress)}),t.addEventListener("error",e),r.signal&&r.signal.addEventListener("abort",()=>{e(r.signal.reason),t.terminate()}),t.postMessage({file:s,imageCompressionLibUrl:r.libURL,options:{...r,onProgress:void 0,signal:void 0}})})}function ft(s,r){return new Promise(function(o,e){let t,n,i,a,f,p;if(t={...r},i=0,{onProgress:a}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,f=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=m=>{i=m,typeof a=="function"&&a(i)},!(s instanceof Blob||s instanceof Os))return e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(s.type))return e(new Error("The file given is not an image"));if(p=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!f||typeof Worker!="function"||p)return li(s,t).then(function(m){try{return n=m,l.call(this)}catch(y){return e(y)}}.bind(this),e);var c=function(){try{return l.call(this)}catch(m){return e(m)}}.bind(this),u=function(m){try{return li(s,t).then(function(y){try{return n=y,c()}catch(x){return e(x)}},e)}catch(y){return e(y)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Ds(s,t).then(function(m){try{return n=m,c()}catch{return u()}},u)}catch{u()}function l(){try{n.name=s.name,n.lastModified=s.lastModified}catch{}try{t.preserveExif&&s.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===s.type)&&(n=fi(s,n))}catch{}return o(n)}})}ft.getDataUrlFromFile=hi,ft.getFilefromDataUrl=ln,ft.loadImage=gi,ft.drawImageInCanvas=Ai,ft.drawFileInCanvas=Mr,ft.canvasToFile=Lr,ft.getExifOrientation=Ti,ft.handleMaxWidthOrHeight=Ei,ft.followExifOrientation=Ci,ft.cleanupCanvasMemory=Ht,ft.isAutoOrientationInBrowser=Qe,ft.approximateBelowMaximumCanvasSizeOfBrowser=yi,ft.copyExifWithoutOrientation=fi,ft.getBrowserName=Te,ft.version="2.0.2";var xi=async(s=window.location.href,r=!0)=>{let o=await Je("tabs","query",[{url:s}]);o?.length===0&&(o=await Je("tabs","query",[{active:!0}]));let e=o?.[0]?.windowId,t=o?.[0]?.id;if(e&&t){await Je("tabs","update",[t,{active:!0}]);let n=await Je("tabs","captureVisibleTab",[e,{format:"png",quality:80}]);if(await new Promise(i=>setTimeout(i,1e3)),r&&n){let i=new Date().getTime(),a=co(n,"screenshot.png");if(a){i=new Date().getTime();let f=await ft(a,{useWebWorker:!0,maxWidthOrHeight:1920});return pr(f)||n}}return n}return null};var Ee=class extends B{static{this.type="CREATE_WEBSITE_CONTEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.CreateWebsiteContextConfig||{},t={};e&&Object.keys(e).forEach(i=>{let a=e[i];typeof e[i]=="string"?Re(t,i,o.getShortCutsEngine()?.parseTemplate(a)||e[i]):typeof e[i]=="object"&&Object.keys(e[i]).forEach(f=>{let p=e[i][f];Re(t,`${i}.${f}`,o.getShortCutsEngine()?.parseTemplate(p)||e[i][f])})}),t.sidebarType=this.getCurrentSidebarType(o);let n=await ci(t);n?.id&&!n.meta?.screenshot&&xi().then(i=>{i&&ui({id:n.id},{meta:{screenshot:i}})}),this.output=t.id}catch(e){this.error=e.toString()}}};z([j()],Ee.prototype,"execute",1);var Ce=class extends B{static{this.type="TEXT_HANDLER"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||this.parameters.template||"";e?(this.output=uo(e,this.parameters.ActionTextHandleParameters),this.error=""):(this.output="",this.error="error: no text for handle")}catch(e){this.error=e.toString()}}};z([j()],Ce.prototype,"execute",1);var fn=Ct(Rn());var xe=class extends B{static{this.type="DATE_FORMAT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=typeof this.parameters.DateFormatStyle=="string"?this.parameters.DateFormatStyle:"YYYY-MM-DD",t=r.LAST_ACTION_OUTPUT||(0,fn.default)().format();this.output=(0,fn.default)(t).format(e)}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],xe.prototype,"execute",1);var mn=Ct(Rn());var ve=class extends B{static{this.type="DATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{(this.parameters.DateActionMode||"Current Date")==="Specified Date"?this.output=(0,mn.default)(this.parameters.DateActionDate).format():this.output=(0,mn.default)().format()}catch(e){this.error=e.toString()}}};z([V({onlyError:!0})],ve.prototype,"execute",1);var nr=400*1e3,Us=async(s,r)=>new Promise(o=>{fetch(`${Fr}/gpt/check_doc_exists`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({doc_id:r})}).then(e=>e.json()).then(e=>{if(Tn){o(e?.data?.exists||!1);return}o(!1)}).catch(e=>{o(!1)})}),pn=async(s,r)=>{let o=await Vn();return new Promise(async e=>{let t=qr(s);if(await Us(o,t)){e(t);return}let n=new File([s],r||"file.txt",{type:"text/plain"}),i=new FormData;i.append("file",n,n.name.replace(/\.pdf$/,".txt")),i.append("doc_id",qr(s)),fetch(`${Fr}/gpt/analyze_file`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i}).then(a=>a.json()).then(a=>{let f=a?.data?.doc_id||"";f||zr("[API] [/gpt/analyze_file] error",JSON.stringify({error:"response docId is empty"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e(f)}).catch(a=>{zr("[API] [/gpt/analyze_file] error",JSON.stringify({error:a?.message||a?.toString()||"unknown error"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e("")})})};var be=class extends B{static{this.type="GET_PDF_CONTENTS_OF_CRX"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{if(typeof window<"u"&&window.pdfjsLib&&window?.PDFViewerApplication?.url){let e=window.pdfjsLib,t=0,i=await(async()=>{try{let a=await e.getDocument(window?.PDFViewerApplication?.url).promise,f=a.numPages,p=async m=>{try{return(await(await a.getPage(m)).getTextContent()).items.map(w=>w.str).join("")}catch{return""}},c="",u="",l=0;for(let m=0;m<f;m++){let y="",x=!1;m%2===0?(x=!0,y=await p(f-m)):y=await p(m);let w=(await cr(y)).length;if(w+t>nr)break;l+=1,t+=w,x?u=y+u:c=c+y}return c+u}catch{return""}})();this.output=i}}catch(e){this.error=e.toString()}}};z([j(),V({onlyError:!0}),ht()],be.prototype,"execute",1);var ks=()=>{let s=Jt();return s==="mail.google.com"?"[Gmail] ":s==="outlook.office.com"||s==="outlook.live.com"||s==="outlook.office365.com"?"[Outlook] ":s==="twitter.com"?"[Twitter] ":s==="linkedin.com"?"[LinkedIn] ":s==="facebook.com"?"[Facebook] ":s==="instagram.com"?"[Instagram] ":""},vi=ks;var Ie=class extends B{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ask_chatgpt",n=this.parameters.AskChatGPTProvider,i=this.parameters.AskChatGPTWithHistory||!1,a=this.parameters.AskChatGPTInsertMessageId||"",f=this.getCurrentConversationId(e);t==="ASK_CHAT_GPT_WITH_PREFIX"&&this.parameters.AskChatGPTActionMeta?.contextMenu&&(this.parameters.AskChatGPTActionMeta.contextMenu.text=vi()+this.parameters.AskChatGPTActionMeta.contextMenu.text),this.question=this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT;let{success:p,answer:c,message:u,error:l}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.question,parentMessageId:""},{includeHistory:i,regenerate:!1,meta:{...this.parameters.AskChatGPTActionMeta},aiMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_ANSWER",userMessageVisible:t!=="ASK_CHAT_GPT_HIDDEN"&&t!=="ASK_CHAT_GPT_HIDDEN_QUESTION"},{onProcess:async m=>{a&&f&&(m.messageId=a,await De("update",f,0,[m]))},onEnd:async(m,y)=>{a&&f&&y&&(y.messageId=a,await De("update",f,0,[sr([y,{originalMessage:{metadata:{isComplete:!0}}}])]))}})||{success:!1,answer:"",error:""};p?(this.output=c,this.message=u):(this.output="",this.error=this.error=Gr(l||c||"ask chatgpt error"))}catch(t){this.error=Gr(t.toString())}}reset(){super.reset(),this.question="",this.message=void 0}};z([Be(),j(),hr(!1)],Ie.prototype,"execute",1);var Se=class extends B{static{this.type="INSERT_USER_INPUT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters?.compliedTemplate||r?.LAST_ACTION_OUTPUT||"",t=this.parameters.AskChatGPTActionMeta,n=ke(),i=await Ln(()=>{let a=null;return n?a=_n()?.querySelector(`#${Yt}`):a=Zt()?.querySelector(`#${Rt}`),a?Promise.resolve(a):Promise.reject("not found")},30,100);i&&(n?(dt("floatingMenuInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),ee(i,0)):(dt("chatBoxInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),ee(i,44.5))),i||n?this.output=e:this.error=""}catch{}}};z([j(),hr()],Se.prototype,"execute",1);var _e=class extends B{static{this.type="ANALYZE_CHAT_FILE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{await this.pushMessageToChat({type:"system",text:"Generating summary...",messageId:it(),extra:{status:"info"}},o);let e=this.parameters.AnalyzeChatFileName||r.AnalyzeChatFileName||"Content.txt",t=this.parameters.AnalyzeChatFileImmediateUpdateConversation||r.AnalyzeChatFileImmediateUpdateConversation||!1,n=r.LAST_ACTION_OUTPUT,i=(await cr(n)).length,a=i>12e3;i>nr&&(n=await tr(n,nr));let f=await tr(n,12e3);if(a)if(t){let p=await pn(n,e);await this.updateConversation(o,{meta:{docId:p}})}else pn(n,e).then(async p=>{await this.updateConversation(o,{meta:{docId:p}})});await this.updateConversation(o,{meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
            \`\`\`
            ${f}
            \`\`\``}}),this.output=f}catch(e){this.error=e.toString()}}};z([j()],_e.prototype,"execute",1);var we=class extends B{static{this.type="RENDER_CHATGPT_PROMPT"}constructor(r,o,e,t){super(r,"RENDER_CHATGPT_PROMPT",e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],we.prototype,"execute",1);var Pe=class extends B{static{this.type="CHAT_MESSAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.ActionChatMessageType||"system",t=this.parameters.ActionChatMessageOperationType||"add",n=this.parameters.ActionChatMessageConfig,i=o.getChartGPT(),a=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;if(!n||!a||!i){this.error="invalid parameters";return}n.type||(n.type=e),t==="add"?(n.messageId||(n.messageId=it()),await i.pushMessage(sr([n]),a)):t==="update"?await i.updateMessage(n,a):t==="delete"&&await i.deleteMessage(1,a),this.output=n.messageId}catch(e){this.error=e.message}}};z([Be()],Pe.prototype,"execute",1);var Me=class extends B{static{this.type="RENDER_TEMPLATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],Me.prototype,"execute",1);var Ii={[we.type]:we,[Me.type]:Me,[Ie.type]:Ie,[_e.type]:_e,[Pe.type]:Pe,[Se.type]:Se,[ne.type]:ne,[Ge.type]:Ge,[qe.type]:qe,[oe.type]:oe,[ie.type]:ie,[ze.type]:ze,[re.type]:re,[se.type]:se,[ae.type]:ae,[We.type]:We,[ce.type]:ce,[be.type]:be,[Ve.type]:Ve,[$e.type]:$e,[ue.type]:ue,[le.type]:le,[fe.type]:fe,[me.type]:me,[pe.type]:pe,[ve.type]:ve,[xe.type]:xe,[ye.type]:ye,[Ae.type]:Ae,[Ee.type]:Ee,[Ce.type]:Ce,[de.type]:de},Fs=s=>new Promise(r=>setTimeout(r,s)),dn=class{constructor(){this.status="idle";this.variables=new Map;this.stepIndex=-1;this.actions=[];this.listeners=[]}setActions(r){this.reset(),this.actions=[],r.map(o=>{let e=Ii[o.type];if(!e)throw new Error(`Action type ${o.type} not found`);let t=new e(o.id||it(),o.type,o.parameters||{},typeof o.autoExecute=="boolean"?o.autoExecute:!0);this.actions.push(t)})}pushActions(r,o){let e=[];r.map(t=>{let n=Ii[t.type];if(!n)throw new Error(`Action type ${t.type} not found`);let i=new n(t.id||it(),t.type,t.parameters||{},typeof t.autoExecute=="boolean"?t.autoExecute:!0);e.push(i)}),o==="after"?this.actions.splice(this.stepIndex+1,0,...e):this.actions.push(...e)}async executeAction(r,o){try{if(r.reset(),r.status="running",this.emit("action",r),await r.execute(this.getVariables(),o),r.error){r.status="error",this.emit("action",r);return}r.status="complete",this.emit("action",r)}catch{r.status="error",this.emit("action",r)}}async run(r){try{let{engine:o,parameters:e}=r;if(this.status==="idle"||this.status==="stop")for(this.status="running",this.emit("status",this);this.status==="running"&&this.status!=="stop";){if(this.stepIndex+=1,this.stepIndex>=this.actions.length){this.status="complete",this.emit("status",this),this.reset();break}e&&this.stepIndex===0&&this.setVariables(e);let t=this.getCurrentAction();if(t){if(this.emit("beforeRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),await this.executeAction(t,o),this.emit("afterRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),t.error){this.status="stop",this.emit("status",this),this.stepIndex=this.stepIndex-1;break}let n=t.output||"";if(this.setVariable("LAST_ACTION_OUTPUT",n,!0),this.getNextAction()?.autoExecute&&!t.error)continue}await Fs(100)}}catch{this.status="stop",this.emit("status",this)}}stop(){this.status="stop"}reset(){this.stepIndex=-1,this.variables=new Map,this.status="idle"}setVariable(r,o,e){this.variables.has(r)?e&&this.variables.set(r,o):this.variables.set(r,o)}setVariables(r){r.forEach(o=>{this.setVariable(o.key,o.value,o.overwrite)})}getVariable(r){return this.variables.get(r)}getVariables(){return Object.fromEntries(this.variables)}getCurrentAction(){return this.actions[this.stepIndex]}getNextAction(){return this.actions[this.stepIndex+1]||null}getPrevAction(){return this.actions[this.stepIndex-1]||null}get progress(){return Number((Math.max(this.stepIndex,0)/this.actions.length).toFixed(2))}addListener(r){this.listeners.push(r)}removeListener(r){let o=this.listeners.indexOf(r);o>-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}emit(r,o){this.listeners.forEach(e=>{e(r,o)})}parseTemplate(r){return He(r,this.getVariables()).data}},Si=dn;var _i=yn({key:"ShortCutsState",default:{status:"idle"}});var Rr=new Si,Ns=new Oe({runtime:"shortcut"}),$i=s=>{let{isLogin:r}=Xn(),o=Qr(),[e,t]=An(_i),{loading:n}=Tt(Vt),i=(0,je.useRef)(Rr),a=io(s||""),f=l=>i.current?(i.current?.setActions(l),!0):!1,p=(0,je.useCallback)(async(l=!1)=>{if(i.current){(!r||l&&!Pn())&&wn();try{await bn()&&(i.current?.stepIndex===-1||i.current.status==="stop")&&(i.current?.actions.find(x=>x.type==="ASK_CHATGPT")&&t({status:"running"}),await i.current.run({parameters:o().shortCutsParameters,engine:{getShortCutsEngine:()=>i.current,getChartGPT:()=>a,getBackgroundConversation:()=>Ns}}))}catch{}finally{t({status:Rr.status||"idle"})}}},[a,i,o,r]),c=(0,je.useCallback)(()=>{i.current&&(i.current.stop(),t({status:Rr.status||"idle"}))},[i]),u=(0,je.useCallback)(()=>{i.current&&(i.current.reset(),t({status:Rr.status||"idle"}))},[]);return{...a,shortCutsEngineRef:i,runShortCuts:p,setShortCuts:f,loading:e.status==="running"||n,status:e.status,stopShortCuts:c,resetShortCuts:u}};var Lt=Ct(Gt());var Mt=Ct(Gt());var Ke=new Oe({runtime:"client"}),Hs=()=>{let[s,r]=(0,Mt.useState)([]),{currentAIProviderModelDetail:o,aiProvider:e}=mr(),{currentSidebarConversationMessages:t,currentSidebarConversationId:n}=Ue(),i=(0,Mt.useRef)(!1),a=(0,Mt.useMemo)(()=>o?.uploadFileConfig,[o]),f=(0,Mt.useCallback)(async u=>{i.current=!0;let l=Ze(u).map(m=>(m.uploadStatus==="idle"&&(m.uploadStatus="uploading",m.uploadProgress=20),m));switch(r(l),e){case"OPENAI":await Ke.postMessage({event:"Client_chatUploadFiles",data:{files:l}});break;case"BING":{let m=await Promise.all(u.map(async y=>{if(y.file&&dr(y.file)){let x=await lo(y.file);x&&(y.base64Data=x)}return y}));await Ke.postMessage({event:"Client_chatUploadFiles",data:{files:m}})}break;default:{let m=await Promise.all(u.map(async y=>{let x=await ao(y.file),w=Ze(y);return w.file=x,w}));await Ke.postMessage({event:"Client_chatUploadFiles",data:{files:m}})}break}setTimeout(()=>{i.current=!1},1e3)},[a,e]),p=(0,Mt.useCallback)(async u=>{let l=await Ke.postMessage({event:"Client_chatRemoveFiles",data:{files:u}});return r(l.data||[]),l.success},[a]),c=(0,Mt.useMemo)(()=>{switch(e){case"OPENAI":return"File uploading. Please send your message once upload completes.";default:return"File uploading. Please send your message once upload completes."}return""},[e]);return(0,Mt.useEffect)(()=>{let u=s.find(l=>l.uploadStatus==="error");if(u){switch(e){case"OPENAI":n&&!er(t,l=>l.messageId===u.id)&&De("add",n,0,[{messageId:u.id,text:u.uploadErrorMessage||`File ${u.fileName} upload error.`,type:"system",extra:{status:u.uploadErrorMessage==="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again."?"info":"error"}}]);break;default:n&&!er(t,l=>l.messageId===u.id)&&De("add",n,0,[{messageId:u.id,text:u.uploadErrorMessage||`File ${u.fileName} upload error.`,type:"system",extra:{status:"error"}}])}p([u])}},[s,e]),kn(()=>{Ke.postMessage({event:"Client_chatGetFiles",data:{}}).then(u=>{i.current||Nr(u.data)&&r(u.data)})}),ar(()=>{Ke.postMessage({event:"Client_chatGetFiles",data:{}}).then(u=>{Nr(u.data)&&r(u.data)})}),Fn(async(u,l,m)=>{switch(u){case"Client_listenUploadFilesChange":{let{files:y}=l;return r(y),{success:!0,data:{},message:""}}default:break}}),{aiProviderUploadingTooltip:c,AIProviderConfig:a,aiProviderUploadFiles:f,aiProviderRemoveFiles:p,files:s}},wi=Hs;var Bs=s=>{let{disabled:r=!1,TooltipProps:o,onUpload:e,onDone:t,...n}=s,{t:i}=Gn(["common","client"]),{files:a,AIProviderConfig:f,aiProviderUploadFiles:p,aiProviderRemoveFiles:c,aiProviderUploadingTooltip:u}=wi(),l=Tt(Bn),m=Tt(Vt),y=(0,Lt.useRef)(null),x=f?.maxCount||1,w=f?.maxFileSize||5*1024*1024,C=(0,Lt.useMemo)(()=>a.length>=(f?.maxCount||1),[a]),k=async L=>{let M=a?.length||0,D=x-M,E=L.target.files;if(!E||D===0)return;let O=Array.from(E);if(O=O.slice(0,D),O.length===0)return;let g=await Promise.all(O.map(async h=>{let v=dr(h),b="file",I="";v&&(b="image",I=await pr(h)||"");let S={id:it(),file:h,fileName:h.name,fileSize:h.size,fileType:h.type,base64Data:I,blobUrl:URL.createObjectURL(h),uploadStatus:"idle",uploadErrorMessage:"",uploadProgress:0,icon:b};return w>0&&S.fileSize>w&&(S.uploadStatus="error",S.uploadErrorMessage=`Upload failed: ${S.fileName} exceeds the ${(w/1024/1024).toFixed(0)}MB limit. Please select a smaller file.`),S}));await p(a.concat(g)),y.current&&(y.current.value="")};return!f||l.status!=="success"||m.loading?Lt.default.createElement(Lt.default.Fragment,null):Lt.default.createElement(fo,{files:a,loadingTooltipTitle:u,onRemove:async L=>{await c([L])},TooltipProps:o,...n},!C&&Lt.default.createElement(qn,{placement:"top",title:f?.acceptTooltip?f.acceptTooltip(i):"Upload file",...o},Lt.default.createElement(Hn,{disabled:r,sx:{minWidth:"unset",p:0,my:"4px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{y.current&&y.current.click()}},Lt.default.createElement(to,{icon:"AddCircle",sx:{color:"inherit"}}))),Lt.default.createElement("input",{multiple:x>1,onChange:k,ref:y,accept:f?.accept||"",hidden:!0,style:{display:"none"},type:"file"}))},vd=Bs;export{Ba as a,ho as b,To as c,Vi as d,rt as e,st as f,Fu as g,po as h,ua as i,$i as j,vd as k};
