import{a as Sr}from"./SGC75SOE.js";import{a as Ir,c as yo,d as yi,e as Mr,g as wr,h as Se,i as Co,j as Ar}from"./GSUPQIG3.js";import{a as yr}from"./HWNYDEYB.js";import{a as vr}from"./BE4CJ3E4.js";import{c as Uo}from"./QBFJRALZ.js";import{a as ho,b as hr}from"./BOAB3GCK.js";import{a as hi}from"./JMRIPDH5.js";import{a as Cr}from"./UAB7UEHC.js";import{a as xn}from"./ZUYJ5ILI.js";import{b as Tr,c as Ci}from"./NJDNRIAY.js";import{g as zo}from"./4NAB6M5G.js";import{b as bt,c as Er}from"./R4DOVXS6.js";import{b as _r}from"./NQLC3B4W.js";import{a as br}from"./F4I56N5V.js";import{$ as Yt,$a as so,Aa as ge,Ab as dr,Ba as Jt,Bb as St,Ca as xt,Cb as fr,D as ft,Da as rt,Db as gr,Ea as Vn,Eb as xr,Fa as Qt,Ga as Pe,Ha as Zt,Ia as eo,Ja as to,Ka as oo,La as No,Ma as Gn,Na as $n,Oa as Kn,Pa as qn,Qa as jn,Ra as no,Sa as Yn,Ta as ro,Ua as io,V as On,Va as Xn,W as $t,Wa as Jn,X as Hn,Xa as Qn,Ya as Zn,Z as Kt,Za as er,_ as qt,_a as ht,ab as yt,b as Tn,ba as Nn,bb as tr,c as vn,ca as At,cb as or,d as ke,da as Wn,db as ao,e as Bn,ea as gt,eb as nr,fa as zn,gb as rr,hb as lo,i as Rn,ib as ir,jb as sr,kb as uo,lb as ar,mb as po,ob as mo,p as Dn,pb as pr,r as dt,t as Ce,u as Fn,ub as fo,v as We,vb as go,wb as kt,xb as Wo,yb as xo,za as Ye,zb as mr}from"./VAZXMTWI.js";import{h as ue}from"./3ULVSIIZ.js";import{c as Gt,d as vt}from"./VTSHHT45.js";import{a as Je}from"./XPQQBCXB.js";import{i as Re,j as mt}from"./GQJKJJWP.js";import{b as Ee,o as An,r as Ln}from"./NDBRMG4E.js";import{c as Vt}from"./QIXLAUXQ.js";import{c as Ut,f as Pn}from"./6KDU3L24.js";import{a as D,c as kn}from"./BXGPN2X7.js";import{d as K}from"./VMA5WMPP.js";import{a as U,b as _n,u as V}from"./SYZGD7UF.js";import{g as gn}from"./QZNWBGPK.js";import{c as ct,d as Bo,g as ot,h as Lo,j as fn}from"./QZVUH6Z4.js";import{ea as co,ga as Xe,ha as Ct,ia as lr,ja as ur,ka as cr,q as jt}from"./TN74TYZV.js";import{a as Ho}from"./6LS5XNTR.js";import{r as wn}from"./JBQIPS5C.js";import{a as Un,b as Xt}from"./AN4BH4LP.js";import{a as pt}from"./M6G54ME7.js";import{d as Mn,e as ne,g as Ne,i as En,k as Me}from"./DAZIVUKN.js";import{A as Sn,L as Oo,M as Le,R as bn,S as Tt,T as Wt,Y as zt,Z as In,a as Ht,d as yn,e as je,h as Nt,n as He,r as Cn}from"./OKNPJCGL.js";import{c as N}from"./QPPETRF6.js";import{d as Ae,e as hn}from"./OPO7MVAW.js";import{L as Do,O as Fo,T as qe,U as dn,a as Po,e as j,f as Q,g as le,k as nt,l as Ro,m as Ft,q as Ke,r as cn,s as pn,t as _t,u as Ot,v as mn}from"./2XMGLZMD.js";import{a as H}from"./64D36THL.js";import{a as un}from"./3JX3VARJ.js";import{c as ln,f as k}from"./PQ35KENF.js";var Kr=ln(bo=>{"use strict";var Bi=_n();Object.defineProperty(bo,"__esModule",{value:!0});bo.default=void 0;var Li=Bi(kn()),Ri=fn(),Di=(0,Li.default)((0,Ri.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");bo.default=Di});var qr=ln(Io=>{"use strict";var Fi=_n();Object.defineProperty(Io,"__esModule",{value:!0});Io.default=void 0;var Oi=Fi(kn()),Hi=fn(),Ni=(0,Oi.default)((0,Hi.jsx)("path",{d:"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"}),"KeyboardReturn");Io.default=Ni});var v=k(H());var Vo=k(hi()),re=k(H());Cr(Vo.default);Sr(Vo.default);var Qe=new pt("ContextMenu/Rangy"),Si=new Nt({runtime:"client"}),bi=()=>{let{show:n,initRangyCore:t,rangy:e,showRangy:o,hideRangy:r,saveTempSelection:i,currentSelection:a}=Pe(),s=j(qe).userSettings,{chatBoxShortCutKey:u}=Je(),[c,p]=Q(ge),{currentSidebarConversationMessages:m}=Ce(),[,x]=Q(Qt),h=le(Jt);mr();let[g,_]=Q(xt),f=(0,re.useRef)(null),y=(0,re.useRef)(null),{showFloatingContextMenuWithVirtualElement:M}=St();Le(()=>{Promise.all([import("./3VSRMID4.js"),import("./5FYG5HQB.js"),import("./PZGV7OON.js")]).then(([{default:E},{default:S},{default:O}])=>{let P=()=>{t(E)};S(E),O(E),E.init(),E.addInitListener(P)})});let d=(0,re.useRef)(n);(0,re.useEffect)(()=>{d.current=n},[n]);let A=(0,re.useCallback)(E=>{{if(d.current&&E instanceof KeyboardEvent&&E.key==="Escape"){Qe.info("Escape close floating button"),r(),fo(),go();return}let S=E.target,O=E instanceof MouseEvent,P=xo(),Z=(e.getSelection().toString()||document?.getSelection()?.toString()||"").trim().replace(/\u200B/g,"");if(S){if(S&&(S.id===Ft||S.id===Ot||S.id===pn))return;if(f.current&&(S=f.current),P){let Te=kt(P);Te.isEditableElement&&(S=Te.editableElement)}if(!S)return;let{editableElement:X}=kt(S);if(X&&(S=X),!X&&!Z){r(),y.current=null;return}y.current=Wo(S,{target:S,eventType:O?"mouseup":"keyup"}),Qe.info(`native selection [${O?"mouse":"keyboard"}]: 	`,y.current,S)}let z=!1,R=!1;y.current&&(y.current?.isEditableElement?(z=!0,(y.current?.editableElementSelectionText||e.getSelection()?.toString()||document.getSelection()?.toString())&&(R=!0)):y.current?.selectionText&&(z=!0,R=!0),z&&(i({selectionText:y.current?.editableElementSelectionText||y.current.selectionText,selectionHTML:y.current?.editableElementSelectionText||y.current.selectionHTML,selectionRect:y.current.selectionRect,activeElement:y.current.target,selectionInputAble:y.current?.isEditableElement,selectionElement:y.current}),Qe.info("save selection temp data",y.current?.isEditableElement,`
`,y.current?.editableElementSelectionText,`
`,y.current?.selectionText)),R?(Qe.info("show floating button"),o()):(Qe.info("hide floating button"),r()))}},[e,i,o,r]),Y=(0,re.useRef)(A);(0,re.useEffect)(()=>{Y.current=A},[A]);let F=(0,re.useRef)(()=>{});(0,re.useEffect)(()=>{let E=He(Y.current,200),S=He(Y.current,200),O=P=>{F.current(),F.current=dr(X=>{if(!X.selectionText&&(r(),!X.isEditableElement)){y.current=null;return}y.current=X,X.selectionText&&(X.eventType==="mouseup"?E({target:null}):S({target:null}))});let Z=P.target,{isEditableElement:z,editableElement:R}=kt(Z);if(z&&R){if(f.current?.isSameNode(R))return;f.current&&(f.current.removeEventListener("mouseup",E),f.current.removeEventListener("keyup",S)),Qe.info("save targetElement ref",R),f.current=R,R.addEventListener("mouseup",E),R.addEventListener("keyup",S)}else Qe.info("clear targetElement ref"),f.current=null};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O),f.current&&(f.current.removeEventListener("mouseup",E),f.current.removeEventListener("keyup",S))}},[e,u,s?.shortcutHintEnable]),(0,re.useEffect)(()=>{let E=He(Y.current,200),S=He(Y.current,200),O=()=>{};return e?.initialized&&(document.addEventListener("mouseup",E),document.addEventListener("keyup",S),O=br(P=>{if(!P.selectionText&&(r(),!P.isEditableElement)){y.current=null;return}y.current=P,P.selectionText&&(P.eventType==="mouseup"?E({target:null}):S({target:null})),P.isEmbedPage&&P.selectionText&&P?.tagName==="BUTTON"&&Ir(),P.selectionText||p(Z=>({...Z,open:!1}))})),()=>{document.removeEventListener("mouseup",E),document.removeEventListener("keyup",S),O()}},[e]),In(async(E,S,O)=>{switch(E){case"Client_listenOpenChatMessageBox":{let P=window.getSelection()?.rangeCount;if(P&&P>0){let R=window.getSelection()?.getRangeAt(0)?.cloneRange();h({range:R||null,selectionText:window?.getSelection()?.toString()||""})}let{command:Z}=S,z=Z==="show-floating-menu";if(!y.current){let R=xo(),{editableElement:X,isEditableElement:Te}=kt(R);Te&&X&&(y.current=Wo(X,{target:X,eventType:"keyup"}))}return Qe.info("Client_listenOpenChatMessageBox",y.current?.isEditableElement,y.current?.selectionText),M(y.current,{},z),y.current&&(y.current=null),{success:!0,data:{},message:""}}break}});let oe=(0,re.useRef)("");(0,re.useEffect)(()=>{oe.current=g.lastOutput},[g.lastOutput]);let fe=(0,re.useRef)(a?.selectionElement);(0,re.useEffect)(()=>{fe.current=a?.selectionElement},[a]),(0,re.useEffect)(()=>{let E=fe.current||y.current,S=["REPLACE_SELECTION","INSERT_BELOW","INSERT","INSERT_ABOVE","DISCARD","COPY"],O=uo(g.selectContextMenuId||"");if(O)switch(S.includes(O)&&(h({range:null,selectionText:""}),p({open:!1,rootRect:null}),_({selectContextMenuId:"",lastOutput:""}),r(),y.current=null),O){case"INSERT_BELOW":case"INSERT":case"INSERT_ABOVE":case"REPLACE_SELECTION":E&&Si.postMessage({event:"Client_updateIframeInput",data:{value:oe.current,type:O,startMarkerId:E.startMarkerId,endMarkerId:E.endMarkerId,caretOffset:E.caretOffset}});break;case"TRY_AGAIN":{let P="";if(m.length>0){let Z=!1;for(let z=m.length-1;z>=0;z--){let R=m[z];if(R.type==="user"&&(Z=!0),Z&&R.type==="ai"){P=R.messageId;break}}}x({lastAIMessageId:P})}break;case"COPY":try{let P=document.createElement("textarea");P.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,P.value=oe.current,document.body.appendChild(P),P.select(),document.execCommand("copy",!1,""),P.remove()}catch{}break;default:break}},[g.selectContextMenuId]),(0,re.useEffect)(()=>{c.open||h(E=>{if(E.range){window.getSelection()?.removeAllRanges(),window.getSelection()?.addRange(E.range);let S=xo();if(S&&(S.tagName==="INPUT"||S.tagName==="TEXTAREA")){let O=S,P=O.value.indexOf(E.selectionText||""),Z=P+(E.selectionText||"").length;O.focus(),O.setSelectionRange(P,Z)}setTimeout(()=>{let O=new KeyboardEvent("keyup",{key:" ",code:"Space",location:0,bubbles:!0,cancelable:!0,shiftKey:!1});(S||document.body).focus(),(S||document.body).dispatchEvent(O)},0)}return{...E,range:null}})},[c.open])},kr=bi;var xi=k(Po());var Pr=k(H()),Ii=()=>{let{setShortCuts:n,runShortCuts:t,loading:e}=Se("");(0,Pr.useEffect)(()=>{let o=async r=>{if(r.data?.id==="USECHATGPT_WEB_INJECT"){let{taskId:i,type:a,data:l}=r.data;switch(a){case"ping":window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"pong",taskId:i,data:{success:!0}},r.origin);break;case"runShortCutActions":{let{actions:s}=l;e?window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!1,error:"shortcuts is running"}},r.origin):(await n(s),await t(!0),window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!0,error:""}},r.origin));break}}}};return window.addEventListener("message",o),()=>{window.removeEventListener("message",o)}},[e,n,t])},Br=Ii;var De=k(H());var It=k(H());var Mi=()=>{let{updateSidebarSettings:n,currentSidebarConversationId:t,currentSidebarConversationType:e}=Ce(),o=le(ke),r=Yt(),{currentUserPlan:i}=We(),{setShortCuts:a,runShortCuts:l}=Se(""),[s,u]=(0,It.useState)([]),{createConversation:c}=gt(),p=(0,It.useRef)(!1),m=async()=>{if(p.current)return;await Tt("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0);let x=$t();if(o(h=>({...h,loading:!0})),x){let h=await At(x);if(h?.id)if(await n({summary:{conversationId:x}}),h.messages?.find(g=>g.type==="ai")){o(g=>({...g,loading:!1}));return}else await dt("clear",x,0,[]);try{if(await c(),o(_=>({..._,loading:!1})),i.name!=="pro"){let _=Number((await Wt()).ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES)||0;if(_>0)await Tt("ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES",_-1);else{await dt("clear",x,0,[]),await dt("add",x,0,[jt(r.PAGE_SUMMARY)]),Kt("show","PAGE_SUMMARY");return}}let g=On(Hn());u(g)}catch{}}};return(0,It.useEffect)(()=>{s.length>0&&!p.current&&e==="Summary"&&t&&(p.current=!0,a(s)?l().then().catch().finally(()=>{p.current=!1,u([])}):(u([]),p.current=!1))},[l,u,e,t,s]),{createPageSummary:m}},Lr=Mi;var it=k(H()),Ei=()=>{let[n,t]=(0,it.useState)(""),e=(0,it.useRef)(""),o=(0,it.useRef)(document.title),r=(0,it.useRef)(0),i=(0,it.useRef)(null),a=()=>{l(),i.current=setInterval(()=>{let s=window.location.href;if(!e.current){o.current=document.title,e.current=s;return}if(s===e.current){o.current=document.title;return}s!==e.current&&(r.current=0),o.current!==document.title?(r.current=0,o.current=document.title,e.current=s,t(s)):(r.current+=1,r.current>10&&(r.current=0,o.current=document.title,e.current=s,t(s)))},1e3)},l=()=>{i.current&&clearInterval(i.current)};return{pageUrl:n,startListen:a,stopListen:l}},Rr=Ei;var wi=()=>{let{createPageSummary:n}=Lr(),{pageUrl:t,startListen:e}=Rr(),{sidebarSettings:o,currentSidebarConversationType:r,currentSidebarConversationId:i,updateSidebarSettings:a,updateSidebarConversationType:l}=Ce(),s=le(vn),{switchBackgroundChatSystemAIProvider:u}=gt(),{continueInSearchWithAI:c}=Co(),p=(0,De.useRef)("Chat"),m=(0,De.useRef)(o),x=zn(o?.summary?.conversationId);(0,De.useEffect)(()=>{m.current=o},[o]),(0,De.useEffect)(()=>{if(r){switch(r){case"Chat":break;case"Summary":n().then().catch().finally(()=>{e()});break;case"Search":break}p.current=r}},[r]),(0,De.useEffect)(()=>{r==="Summary"&&x&&!i&&n().then().catch().finally()},[i,r]),Oo(()=>{p.current==="Summary"&&a({summary:{conversationId:$t()}})}),(0,De.useEffect)(()=>{p.current==="Summary"&&l("Chat")},[t]);let h=(0,De.useRef)(i);(0,De.useEffect)(()=>{let g=!1;return i&&At(i).then(async _=>{_?.meta.AIProvider&&(g||await u(_.meta.AIProvider,_.meta.AIModel))}),h.current=i,()=>{g=!0}},[i]),(0,De.useEffect)(()=>{let g=_=>{let f=_?.detail?.aiMessage;f&&c(f).then().catch()};return window.addEventListener("MaxAIContinueSearchWithAI",g),()=>{window.removeEventListener("MaxAIContinueSearchWithAI",g)}}),Oo(()=>{h.current&&At(h.current).then(g=>{g&&s(_=>({..._,[g.id]:g}))})})},Dr=wi;var nn=k(un());var Fr=()=>{zt(async(n,t,e)=>{switch(n){case"ShortCuts_ClientExecuteOperationPageElement":{let{taskId:o,OperationElementConfig:r}=t;return o?(await Tr(o,r),{success:!0,data:!0,message:"ok"}):{success:!1,message:"No taskId",data:null}}break;default:break}})};var Or=k(H());var _i={inviteLink:n=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText||"").trim()||`Sign up on MaxAI.me using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${n}`},st=_i;var Ti=()=>{let{userInfo:n}=We(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoTwitterReferral:(0,Or.useCallback)(async()=>{if(!o){let a=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:`https://twitter.com/intent/tweet?text=${a}`}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetButton"]'],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['a[data-testid="AppTabBar_Profile_Link"]'],actionType:"click",afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetText"]'],actionType:"getText",executeElementCount:10}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://twitter.com/MaxAI_HQ"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="1667007582270296064-follow"]'],actionType:"click",beforeDelay:2e3,afterDelay:3e3}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")l=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let m=p.parameters.WFFormValues?.Value===!0;bt(`[Referral] One-click button [Linkedin] ${m?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:m,shareLink:`[ ${l} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),m&&ft("/user/complete_referral",{referral_types:["TWITTER_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[o,e,t,n?.referral_code]),autoTwitterReferralLoading:o}},Hr=Ti;var Nr=k(H());var vi=()=>{let{userInfo:n}=We(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoFacebookReferral:(0,Nr.useCallback)(async()=>{if(!o){let a=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["textarea[title]"],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:st.inviteLink(n?.referral_code||"")},beforeDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[name="__CONFIRM__"]'],actionType:"click",afterDelay:3e3}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/profile.php"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-ad-preview="message"]','div[data-ad-comet-preview="message"]'],executeElementCount:10,actionType:"getText",beforeDelay:2e3}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l=(s,u)=>{let c=u?.action;if(s==="afterRunAction"&&c?.type==="SET_VARIABLE"&&c.parameters?.VariableName==="AutoTwitterReferralResult"){let p=c.parameters.WFFormValues?.Value===!0;bt(`[Referral] One-click button [Facebook] ${p?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:p},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),p&&ft("/user/complete_referral",{referral_types:["FACEBOOK_SHARE"]}).then()}};return r.current?.addListener(l),await e(),r.current?.removeListener(l),!0}return!1},[o,e,t,n?.referral_code]),autoFacebookReferralLoading:o}},Wr=vi;var zr=k(H());var Ai=()=>{let{userInfo:n}=We(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoLinkedinReferral:(0,zr.useCallback)(async()=>{if(!o){let a=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.artdeco-button"],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[contenteditable="true"]'],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:a},afterDelay:1e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.share-actions__primary-action"],actionType:"click",afterDelay:3e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__view-btn"],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__continue-btn"],actionType:"getText"}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:"linkedin",WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")l=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let m=p.parameters.WFFormValues?.Value===!0;bt(`[Referral] One-click button [Linkedin] ${m?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:m,shareLink:`[ ${l} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),m&&ft("/user/complete_referral",{referral_types:["LINKEDIN_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[o,e,t,n?.referral_code]),autoLinkedinReferralLoading:o}},Ur=Ai;var So=k(H());var ki=()=>{let{autoTwitterReferral:n}=Hr(),{autoFacebookReferral:t}=Wr(),{autoLinkedinReferral:e}=Ur(),o=(0,So.useRef)({});(0,So.useEffect)(()=>{o.current={twitter:n,linkedin:e,facebook:t}},[n,e,t]),Le(()=>{Do&&location.href.includes(Do)&&setInterval(()=>{let r=document.querySelector("#appMaxAIReferralShareOneClickContainer"),i=document.querySelector("#appMaxAIReferralShareOneClickButton");if(r&&i){if(!r.classList.contains("loaded"))r.classList.add("loaded");else return;i.addEventListener("click",async()=>{let a=Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));for(let c=0;c<a.length;c++){let m=a[c].getAttribute("data-name"),x=o.current?.[m];x&&await x()}await(c=>new Promise(p=>setTimeout(p,c)))(3e3);let s=new URL(window.location.href),u=new URLSearchParams(s.search);u.set("show_completed","true"),s.search=u.toString(),window.location.href=s.toString()})}},1e3)})},Vr=ki;var Gr=k(Ci());var Pi=()=>{let n=new Map,t=new Nt,e=async(o,r,i)=>{await t.postMessage({event:"Client_ListenProxyWebsocketResponse",data:{data:r,taskId:o,listenerType:i}})};zt(async(o,r)=>{switch(o){case"Client_ListenProxyWebsocket":{let{taskId:i,data:a,type:l}=r;switch(l){case"Open":{let s=a.mode,u=new Gr.default(a.url,s==="bing"?{packMessage:zo.packMessage,unpackMessage:zo.unpackMessage}:{});return u.onUnpackedMessage.addListener(c=>{e(i,c,"onUnpackedMessage")}),u.onMessage.addListener(async c=>{e(i,c,"onMessage")}),u.onClose.addListener(()=>{e(i,{},"onClose")}),await u.open(),n.set(i,u),{success:!0,data:"success",message:"ok"}}break;case"Close":{let s=n.get(i);return s?(s.removeAllListeners(),await s.close(),n.delete(i),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;case"SendPacked":{let s=n.get(i);return s?(s.sendPacked(a),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;default:return{success:!0,data:"success",message:"ok"}}}break}})},$r=Pi;var et=k(H());var $e=k(H()),ei=k(Po());Bo();Lo();var I=k(H());var ce=k(H());var b=k(H());var be=k(H());var Go=k(Kr()),Yr=k(qr());var pe=b.forwardRef(({label:n,icon:t,CustomRenderNode:e,onClick:o,isGroup:r,...i},a)=>{let l=i;return b.createElement(D,{...i,sx:{boxSizing:"border-box",borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:a,component:"div",role:"menuitem",onClick:s=>{o?.(s),l?.onClick?.(s)}},b.createElement(D,null,e||b.createElement(U,{direction:"row",spacing:1,px:1,alignItems:"center"},b.createElement(ue,{size:16,icon:t||"Empty",sx:{color:"primary.main",flexShrink:0}}),b.createElement(V,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n),r&&b.createElement(Go.default,{sx:{ml:"auto",mr:0,flexShrink:0,color:s=>s.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}))))}),$o=b.forwardRef(({label:n,disabled:t,menuItem:e,...o},r)=>{let i=o,{t:a}=N(["prompt"]),l=j(Vn),[s,u]=Q(rt),c=(0,be.useMemo)(()=>{let x=e.id.replace(Ct,""),h=`prompt:${x}`;return a(h)!==x?a(h):e.text},[e.text,a]),p=(0,be.useMemo)(()=>l.includes(e.id)||e.id===s.lastHoverContextMenuId,[l,s.lastHoverContextMenuId]),m=(0,be.useMemo)(()=>s.lastHoverContextMenuId===e.id&&p,[p,s.lastHoverContextMenuId]);return b.createElement(D,{...o,"data-id":e.id,className:`floating-context-menu-item ${p?"floating-context-menu-item--active":""}`,tabIndex:p?0:-1,sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1,boxSizing:"border-box",px:1,borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:x=>x.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:x=>x.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:r,component:"div",role:"menuitem",onKeyDown:x=>{i?.onKeyDown?.(x),x.code==="Enter"&&(u(h=>({...h,selectedContextMenuId:e.id})),x.stopPropagation())},onClick:x=>{u(h=>({...h,selectedContextMenuId:e.id})),i?.onClick?.(x)}},e?.data?.icon&&b.createElement(ue,{size:16,icon:e.data.icon,sx:{color:"primary.main",flexShrink:0}}),b.createElement(V,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},c),b.createElement("span",{className:"floating-context-menu-item__footer-icon "+(e.data.type==="group"?"floating-context-menu-item__footer-icon--active":"")},e.data.type==="group"?b.createElement(Go.default,{sx:{color:x=>x.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}):m&&b.createElement(Yr.default,{sx:{color:x=>x.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}})))}),jr=b.forwardRef(({referenceElement:n,referenceElementOpen:t,zIndex:e,children:o,label:r,root:i,hoverOpen:a=!0,customOpen:l=!1,needAutoUpdate:s=!1,menuSx:u,defaultPlacement:c,defaultFallbackPlacements:p,onClickContextMenu:m,onClickReferenceElement:x,menuWidth:h=400,...g},_)=>{let f=Gn(),y=$n(),M=No(),d=!M&&e===2147483601,[A,Y]=Q(rt),F=M!=null,[oe,fe]=b.useState(l?t:!1);(0,be.useEffect)(()=>{setTimeout(()=>{fe(t)},1)},[t]);let[E,S]=b.useState(d?1:null),O=j(ge),[P,Z]=b.useState(!1),z=(0,be.useRef)(null),R=(0,be.useRef)(null),X=b.useRef([]),Te=b.useRef(b.Children.map(o,w=>b.isValidElement(w)?w.props.label:null)),vo=c||(d?"bottom-start":"right-start"),Ao=p||(d?["bottom-start","top-start","right"]:["right","right-start","right-end","left","left-start","left-end"]),ze=()=>{S(null),R.current=null,z.current=null},{x:Et,y:ko,strategy:at,refs:lt,context:Oe}=ht({nodeId:y,open:oe,onOpenChange:w=>{w||ze(),!l&&fe(w)},placement:vo,middleware:[eo({mainAxis:d?4:0,alignmentAxis:d?0:-4}),Zt({fallbackPlacements:Ao}),to()],whileElementsMounted:s?oo:void 0}),tt=jn(Oe,{enabled:a&&P,delay:{open:75},handleClose:er({restMs:25,blockPointerEvents:!1})}),wt=ro(Oe,{event:"mousedown",toggle:!F||!P,ignoreMouse:F}),Bt=Qn(Oe,{role:"menu"}),Lt=io(Oe),Ue=(0,be.useRef)(null),C=Xn(Oe,{listRef:X,activeIndex:E,nested:F,onNavigate(w){let J=()=>{let $=ne()?.querySelector(`#${Ke}`);$&&$?.focus()},L=M?"[\u5B50\u7EA7]":"[\u6839\u7EA7]",ae=Ue.current?.key;if(ae){let $=!1,xe=null;R.current&&($=!0,xe=Mo(R.current));let ee=[];X.current?.forEach((ye,Dt)=>{let ve=ye?.getAttribute("data-id");ve&&ee.push({floatingUIId:ye?.id?.replace(/:/g,"\\:")||"",contextMenuId:ve,contextMenuIndex:Dt})}),Y(ye=>{let Dt=ye.hoverContextMenuIdMap[y]||ye.lastHoverContextMenuId||"";$&&xe?.contextMenuId&&(Dt=xe.contextMenuId);let ve=ee.findIndex(ut=>ut.contextMenuId===Dt);if(ae==="ArrowLeft")return S(null),J(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[y]:""}};if(ae==="ArrowRight")if(ee.length>0){let ut=ee[0];return S(ut.contextMenuIndex),J(),{...ye,lastHoverContextMenuId:ut.contextMenuId}}else return S(null),J(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[y]:""}};let rn=!1,sn=Ue.current?.target,an=sn?.getAttribute("data-lastid");if(an&&(ve=ee.findIndex(ut=>ut.floatingUIId===an),sn.removeAttribute("data-lastid"),rn=!0),ve===-1&&(M||(ve=0)),ve===-1)return J(),ye;let Ge=null;return ae==="ArrowDown"?rn||$?Ge=ee[ve]:ee[ve+1]?Ge=ee[ve+1]:Ge=ee[0]:ae==="ArrowUp"&&(ee[ve-1]?Ge=ee[ve-1]:Ge=ee[ee.length-1]),Ge?(S(Ge.contextMenuIndex),J(),{...ye,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[y||""]:Ge.contextMenuId},lastHoverContextMenuId:Ge.contextMenuId}):(J(),ye)}),Ue.current=null}},loop:!0,virtual:!0}),B=Zn(Oe,{enabled:oe,listRef:Te,onMatch:oe?S:void 0,activeIndex:E}),{getReferenceProps:G,getFloatingProps:Ie,getItemProps:se}=so([tt,wt,Bt,Lt,C,B]);b.useEffect(()=>{if(!f)return;function w(){l||fe(!1)}function J(L){L.nodeId!==y&&L.parentId===M&&fe(!1)}return f.events.on("click",w),f.events.on("menuopen",J),()=>{f.events.off("click",w),f.events.off("menuopen",J)}},[f,y,M,l]),b.useEffect(()=>{oe&&f&&f.events.emit("menuopen",{parentId:M,nodeId:y})},[f,oe,y,M]),b.useEffect(()=>{function w({pointerType:L}){L!=="touch"&&Z(!0)}function J(){Z(!1)}return window.addEventListener("pointermove",w,{once:!0,capture:!0}),window.addEventListener("keydown",J,!0),()=>{window.removeEventListener("pointermove",w,{capture:!0}),window.removeEventListener("keydown",J,!0)}},[P]),(0,be.useEffect)(()=>{let w=!1;return d&&A.lastHoverContextMenuId&&o&&setTimeout(()=>{w||S(J=>{let L=o.findIndex(ae=>ae?.key===A.lastHoverContextMenuId);return L!==-1&&J===null?L:J})},0),()=>{w=!0}},[A.lastHoverContextMenuId,o]);let Ve=Jn([lt.setReference,_]),Rt=(0,be.useCallback)(()=>{let w=A.lastHoverContextMenuId;if(w){let J=ne()?.querySelector(`[data-id="${w}"]`);J&&J.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0,code:"Enter",keyCode:13}))}},[A]);return(0,be.useEffect)(()=>{O.open||(ze(),Y(w=>({...w,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})))},[O.open]),b.createElement(Kn,{id:y},n?b.isValidElement(n)&&b.cloneElement(n,{...G({...g,className:`${F?"MenuItem":"RootMenu"}`,onClick(w){w.stopPropagation(),x?.(w)},onKeyDownCapture(w){if(w.key==="Enter"&&!M){Rt();return}if(w.key==="ArrowDown"||w.key==="ArrowUp"||w.key==="ArrowLeft"||w.key==="ArrowRight"){if(R.current=null,w.key==="ArrowLeft"){if(!M&&z.current){let L=Mo(z.current);L?.parentDropdownSelectedItem&&(L.dropdownSelectedItem.focus(),L.dropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0})),L.parentDropdownSelectedItem&&L.id&&(L.parentDropdownSelectedItem.setAttribute("data-lastid",L.id),L.parentDropdownSelectedItem.focus(),L.parentDropdownSelectedItem.classList.contains("RootMenu")?z.current=null:z.current=L.parentDropdownSelectedItem,L.parentDropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))))}return}else if(w.key==="ArrowRight"&&!M&&E!==null){let L=X.current[E];if(z.current){let ae=z.current?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),$=ne()?.querySelector(`#${ae}`);if($){let xe=$.getAttribute("aria-activedescendant")?.replace(/:/g,"\\:"),ee=$.querySelector(`#${xe}`);ee.id&&ee.getAttribute("aria-haspopup")&&(L=ee)}}L&&L.getAttribute("aria-haspopup")==="menu"&&(L.focus(),L.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0})),z.current=L);return}else if(z.current){z.current.focus(),z.current.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0}));return}ne()?.querySelector(`#${Ke}`)?.focus(),Ue.current=w}},...F&&{role:"menuitem"},ref:Ve})}):b.createElement(K,{ref:Ve,...G({...g,className:`${F?"MenuItem":"RootMenu"}`,onClick(w){w.stopPropagation()},...F&&{role:"menuitem"}}),startIcon:b.createElement(Ee,{sx:{fontSize:16,color:"inherit"}}),variant:"outlined"},r||"Use ChatGPT"),b.createElement(no,{root:i},oe&&b.Children.count(o)&&b.createElement(Yn,{context:Oe,modal:!1,initialFocus:-1,visuallyHiddenDismiss:!0},b.createElement(D,{sx:{zIndex:(e||0)+1,display:"flex",flexDirection:"column",p:.5,outline:"none!important",width:h,maxHeight:327,boxSizing:"border-box",overflowY:"auto",border:"1px solid",borderColor:"customColor.borderColor",bgcolor:"background.paper",borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px","& *":{outline:"none!important"},"&:has(.max-ai--popper-wrapper)":{overflowY:"unset"},...u},component:"div",ref:lt.setFloating,className:"Menu",style:{position:at,top:ko??0,left:Et??0},...Ie()},b.Children.map(o,(w,J)=>b.isValidElement(w)&&b.cloneElement(w,se({tabIndex:E===J?0:-1,ref(L){X.current[J]=L},onMouseDown(L){m&&(f?.events.emit("click"),w.props?.menuItem?.data?.type==="shortcuts"&&m?.(w.props.menuItem))},onClick(L){m||(w.props.onClick?.(L),f?.events.emit("click"))},onKeyDownCapture(L){Ue.current=L},onMouseEnter(L){L.stopPropagation(),L.preventDefault();let ae=L.currentTarget;if(ae.getAttribute("data-id")){z.current=ae;let $=Mo(ae);if(($?.id||$?.contextMenuId)&&$.expandedSiblingMenuItem){if($.expandedSiblingMenuItem?.getAttribute("data-id")===$.contextMenuId)return;let xe=Mo($.expandedSiblingMenuItem);if(xe?.dropdownSelectedItem){let ee=new KeyboardEvent("keydown",{key:"ArrowLeft",bubbles:!0,cancelable:!0});R.current=xe.dropdownSelectedItem,xe.dropdownSelectedItem.focus(),xe.dropdownSelectedItem.dispatchEvent(ee),$.expandedSiblingMenuItem.setAttribute("data-lastid",$.contextMenuId),$.expandedSiblingMenuItem.classList.contains("RootMenu")?z.current=null:z.current=xe.parentDropdownSelectedItem,$.expandedSiblingMenuItem.focus(),$.expandedSiblingMenuItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))}}if($?.id){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,$.keydownEmitElement?.dispatchEvent(xe);let ee=new KeyboardEvent("keydown",{key:"ArrowRight",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(ee)}else if($?.contextMenuId){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(xe)}}}})))))))}),Fe=b.forwardRef((n,t)=>No()===null?b.createElement(qn,null,b.createElement(jr,{...n,ref:t})):b.createElement(jr,{...n,ref:t})),Mo=n=>{let t=ne();if(!n||!t)return null;let e=n.getAttribute("id")?.replace(/:/g,"\\:")||"",o=n.getAttribute("data-id")||"",r=n.getAttribute("aria-haspopup")==="menu",i=t.querySelector(`div[aria-haspopup="menu"][aria-activedescendant="${e}"]`),a=i?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),l=a?t.querySelector(`#${a}`):null,s=n.getAttribute("aria-controls")?.replace(/:/g,"\\:"),u=s?t.querySelector(`#${s}`):null,c=null;u&&!c&&(c=u.querySelector('.floating-context-menu-item--active:not([aria-haspopup="menu"])'),c||(c=u.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')));let p=n.parentElement?.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])'),m=n.parentElement?.querySelector('.floating-context-menu-item[aria-expanded="true"]');return{id:e,contextMenuId:o,isMenu:r,parentDropdownSelectedItem:i,parentDropdown:l,dropdownMenu:u,dropdownSelectedItem:c,keydownEmitElement:p,expandedSiblingMenuItem:m}};var Ko=(0,ce.forwardRef)((n,t)=>{let{menuItem:e,root:o,referenceElement:r,referenceElementOpen:i,rootMenu:a,customOpen:l,onClickContextMenu:s,menuWidth:u,...c}=n,{t:p}=N(["prompt"]),m=(0,ce.useMemo)(()=>p(`prompt:${e.id}`)!==e.id?p(`prompt:${e.id}`):e.text,[e.text,p]),x=(0,ce.useCallback)(h=>p(`prompt:${h.id}`)!==h.id?p(`prompt:${h.id}`):h.text,[p]);return e.data.type==="group"?ce.default.createElement(Fe,{zIndex:n.zIndex,ref:t,root:o,label:m,menuWidth:u,onClickContextMenu:s,referenceElement:ce.default.createElement($o,{...c,label:m,menuItem:e})},e.children.map((h,g)=>ce.default.createElement(Ko,{...c,root:o,key:h.id,menuItem:h,label:x(h)}))):ce.default.createElement($o,{...c,menuItem:e,ref:t,label:m})}),Wi=n=>{let{root:t,referenceElement:e,referenceElementOpen:o,menuList:r,customOpen:i,needAutoUpdate:a,defaultPlacement:l,defaultFallbackPlacements:s,onClickContextMenu:u,menuWidth:c,onClickReferenceElement:p,hoverOpen:m,...x}=n,{t:h}=N(["prompt"]),g=(0,ce.useMemo)(()=>{let _=[];return r.forEach((f,y)=>{let M=h(`prompt:${f.id}`)!==f.id?h(`prompt:${f.id}`):f.text;f.data.type==="group"?(y>0&&_.push(ce.default.createElement(D,{key:f.id+"_group_spector","aria-disabled":!0,onClick:d=>{d.stopPropagation(),d.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:"customColor.borderColor",my:1}})),_.push(ce.default.createElement(D,{key:f.id+"_group_name",component:"div","aria-disabled":!0,sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",px:1,pointerEvents:"none"},onClick:d=>{d.stopPropagation(),d.preventDefault()}},ce.default.createElement(V,{textAlign:"left",fontSize:12,color:"text.secondary"},M))),f.children.forEach((d,A)=>{_.push(ce.default.createElement(Ko,{menuWidth:c,onClickContextMenu:u,zIndex:2147483602,...x,key:d.id,label:"",menuItem:d,root:t}))})):_.push(ce.default.createElement(Ko,{menuWidth:c,onClickContextMenu:u,key:f.id,label:"",menuItem:f,root:t}))}),_},[r,h]);return ce.default.createElement(Fe,{zIndex:2147483601,label:"",root:t,customOpen:i,needAutoUpdate:a,referenceElement:e,referenceElementOpen:o,defaultPlacement:l,defaultFallbackPlacements:s,onClickContextMenu:u,onClickReferenceElement:p,hoverOpen:m,menuWidth:c},g)},Eo=Wi;var me=k(H());var qo=n=>{let{sx:t}=n,{t:e}=N(["common","client"]),[o,r]=(0,me.useState)(!0),[i,a]=(0,me.useState)(null);return(0,me.useEffect)(()=>{if(i)return;let l=ne();l&&a(l),r(!1)},[]),me.default.createElement(vt,{loading:o},i&&me.default.createElement(Fe,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:i,menuSx:{width:240},referenceElement:me.default.createElement(D,{sx:{alignSelf:"end"}},me.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,color:"inherit",minWidth:"unset",...t}},me.default.createElement(ue,{icon:"More",sx:{color:"text.primary",fontSize:16}})))},me.default.createElement(pe,{onClick:()=>{Me({key:"options",query:"#/my-own-prompts"})},label:e("client:floating_menu__button__manage_my_own_prompt"),icon:"DefaultIcon"}),me.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:i,referenceElement:me.default.createElement(pe,{isGroup:!0,icon:"Delete",label:e("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},me.default.createElement(pe,{label:e("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),me.default.createElement(pe,{label:e("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),me.default.createElement(pe,{onClick:()=>{Me({key:"options"})},label:e("common:settings"),icon:"Settings"})))};var jo=k(H());var wo=k(H());var Yo=n=>{let{t}=N(["common","client"]),{sx:e,placement:o,ButtonProps:r,iconSize:i=16,icon:a="Close"}=n,[,l]=Q(ge),s=le(Ye);return wo.default.createElement(Re,{title:t("client:floating_menu__button__hide_menu__until_next_visit"),floatingMenuTooltip:!0,placement:o},wo.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,minWidth:"unset",color:"text.primary",...e},onClick:async()=>{l({open:!1,rootRect:null}),s(u=>({...u,closeBeforeRefresh:!0}))},...r},wo.default.createElement(ue,{icon:a,sx:{color:"inherit",fontSize:i}})))};var te=k(H());var _o=k(H());var Pt=n=>{let{t}=N(["common","client"]),{hideRangy:e}=Pe(),[,o]=Q(ge),{chatBoxShortCutKey:r}=Je();return _o.default.createElement(Re,{description:r,title:t("client:floating_menu__button__switch_to_sidebar"),placement:"bottom",...n.TooltipProps},_o.default.createElement(K,{sx:{ml:"0px!important",height:"24px",flexShrink:0,alignSelf:"end",minWidth:"unset",padding:"6px 5px"},className:"max-ai__actions__button--toggle-sidebar",variant:"text",onClick:()=>{ar(),e(),o({open:!1,rootRect:null}),En()||Ne()}},_o.default.createElement(An,{sx:{fontSize:"16px",color:"text.primary"}})))};var Xo=()=>{let n=j(ke),t=(0,te.useRef)(!1),e=(0,te.useMemo)(()=>!!(n.loading&&n.writingMessage?.text),[n.loading,n.writingMessage]),{stopGenerateMessage:o,reGenerate:r}=xr(),i=(0,te.useCallback)(async l=>{l==="s"&&(t.current=!1,await o()),l==="r"&&(t.current=!0,await o())},[o]),a=(0,te.useRef)(r);return(0,te.useEffect)(()=>{a.current=r},[r]),(0,te.useEffect)(()=>{if(!e)return;let l=async s=>{let u=s.key;lo()&&["r","s","o","c"].includes(u)&&(s.preventDefault(),s.stopPropagation(),await i(u))};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[e,i]),e?te.default.createElement(U,{direction:"row",spacing:1,sx:{ml:"auto!important","& .usechatgpt-floating-menu__button__shortcut":{fontSize:"12px",opacity:.7,ml:"4px"}}},te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("r")}},te.default.createElement(V,{component:"span",fontSize:"14px",color:"primary.main"},"Try again",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"R"))),te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("s")}},te.default.createElement(V,{component:"span",fontSize:"14px",color:"primary.main"},"Stop",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"S"))),te.default.createElement(Pt,null)):te.default.createElement(te.default.Fragment,null)};var T=k(H());var Ze=k(H());var zi=n=>{let t=ne()||document.body,{children:e,content:o,boxSx:r,onClick:i,PopperProps:a,hoverOpen:l,stopEvent:s=!0}=n,[u,c]=Ze.default.useState(null),p=(0,Ze.useRef)(Ht()),m=f=>{s&&(f.stopPropagation(),f.preventDefault()),c(u?null:f.currentTarget),i?.(f)},x=f=>{l&&c(f.currentTarget)},h=f=>{l&&c(null)},g=!!u,_=g?p.current:void 0;return Ze.default.createElement(Ze.default.Fragment,null,Ze.default.createElement(D,{component:"div",onMouseEnter:x,onMouseLeave:h,onClick:m,onMouseDown:f=>{s&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{s&&(f.stopPropagation(),f.preventDefault())},sx:{...r}},e),Ze.default.createElement(Ln,{disablePortal:!0,id:_,open:g,anchorEl:u,container:t,style:{zIndex:2147483630},className:"max-ai--popper-wrapper",...a},o))},Jo=zi;var we=k(H());var Ui=({liteMode:n})=>{let{t}=N(["common","client"]);return we.default.createElement(we.default.Fragment,null,n?we.default.createElement(D,{sx:{borderRadius:"4px",bgcolor:e=>e.palette.mode==="dark"?"rgb(7, 19, 24)":"rgb(229, 246, 253)",color:e=>e.palette.mode==="dark"?"rgb(184, 231, 251)":"rgb(1, 67, 97)",p:2,overflow:"hidden"}},we.default.createElement(U,{spacing:1,alignItems:"center"},we.default.createElement(V,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry-small.png",alt:"settings-entry",width:200,height:80}))):we.default.createElement(ho,{icon:we.default.createElement(we.default.Fragment,null),sx:{mt:1,mb:2}},we.default.createElement(U,{spacing:1},we.default.createElement(V,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry.png",alt:"settings-entry",width:466,height:121}))))},Qo=Ui;var Zo=n=>{let{sx:t,placement:e}=n,{t:o}=N(["common","client"]),[r,i]=(0,T.useState)(!0),a=le(Ye),{updateButtonSettingsWithDomain:l,toggleButtonSettings:s}=Un(),{hideRangy:u}=Pe(),[,c]=Q(ge),[p,m]=(0,T.useState)(null),[x,h]=(0,T.useState)(!1);return(0,T.useEffect)(()=>{if(p)return;let g=ne();g&&m(g),i(!1)},[]),T.default.createElement(vt,{loading:r},p&&T.default.createElement(Fe,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:p,menuSx:{width:240},referenceElement:T.default.createElement(D,{sx:{zIndex:2,alignSelf:"end",position:"relative",display:"flex",bgcolor:x?"background.paper":"transparent",borderRadius:x?0:"0 14px 14px 0",transition:x?"background-color 0s ease-out":"background-color 0.1s ease-in-out",width:"34px","&::before":{content:'""',position:"absolute",left:0,height:"28px",bgcolor:"background.paper",width:"21px"}}},T.default.createElement(K,{onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)},size:"small",variant:"text",sx:{padding:"5px 8px",color:"inherit",minWidth:"unset",...t}},T.default.createElement(ue,{icon:"More",sx:{color:g=>g.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)",fontSize:"18px"}})),T.default.createElement(Yo,{ButtonProps:{onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)}},icon:x?"Close":"More",iconSize:18,sx:{zIndex:1,left:x?"100%":0,transition:"left 0.1s ease-in-out",width:"34px",height:"28px",padding:"5px 8px",borderRadius:"0 14px 14px 0",right:"-100%",position:"absolute",bgcolor:"background.paper",color:g=>g.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)","&:hover":{bgcolor:g=>g.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}},placement:e}))},T.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:T.default.createElement(pe,{isGroup:!0,icon:"Delete",label:o("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},T.default.createElement(pe,{label:o("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),T.default.createElement(pe,{label:o("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),T.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:T.default.createElement(pe,{isGroup:!0,icon:"VisibilityOff",label:o("client:floating_menu__button__hide_menu")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},T.default.createElement(pe,{onClick:()=>{c({open:!1,rootRect:null}),a(g=>({...g,closeBeforeRefresh:!0}))},label:o("client:floating_menu__button__hide_menu__until_next_visit")}),T.default.createElement(pe,{CustomRenderNode:T.default.createElement(Jo,{PopperProps:{placement:"top"},onClick:g=>{g.stopPropagation(),g.preventDefault()},content:T.default.createElement(Uo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},T.default.createElement(U,{spacing:1},T.default.createElement(V,{textAlign:"center",fontWeight:"600",fontSize:"16px",color:"text.primary"},o("client:floating_menu__button__hide_menu__this_site__tooltip__title")),T.default.createElement(Qo,{liteMode:!0}),T.default.createElement(D,null),T.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await l("textSelectPopupButton"),c({open:!1,rootRect:null})}},o("client:floating_menu__button__hide_menu__this_site__tooltip__confirm")),T.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},o("common:cancel"))))},T.default.createElement(U,{direction:"row",spacing:1,px:1,alignItems:"center"},T.default.createElement(ue,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),T.default.createElement(V,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o("client:floating_menu__button__hide_menu__this_site"))))}),T.default.createElement(pe,{CustomRenderNode:T.default.createElement(Jo,{PopperProps:{placement:"top"},onClick:g=>{g.stopPropagation(),g.preventDefault()},content:T.default.createElement(Uo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},T.default.createElement(U,{spacing:1},T.default.createElement(V,{fontSize:"16px",color:"text.primary",textAlign:"center",fontWeight:"600"},o("client:floating_menu__button__hide_menu__all_sites__tooltip__title")),T.default.createElement(Qo,{liteMode:!0}),T.default.createElement(D,null),T.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await s("textSelectPopupButton",!1),c({open:!1,rootRect:null})}},o("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm")),T.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},o("common:cancel"))))},T.default.createElement(U,{direction:"row",spacing:1,px:1,alignItems:"center"},T.default.createElement(ue,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),T.default.createElement(V,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o("client:floating_menu__button__hide_menu__all_sites"))))}),T.default.createElement(pe,{label:o("client:floating_menu__button__menu_settings"),icon:"Settings",onClick:()=>{Me({key:"options",query:"#/mini-menu"})}})),T.default.createElement(pe,{onClick:()=>{Me({key:"options"})},label:o("common:settings"),icon:"Settings"})))};var q=k(H());var Vi=n=>{let t=xn(),{onChange:e}=n,{currentSidebarConversationMessages:o,currentSidebarConversationType:r}=Ce(),i=j(ge),[,a]=Q(xt),[,l]=Q(Qt),s=yo(),u=(0,q.useRef)("");(0,q.useEffect)(()=>{r==="Chat"&&(u.current=Dn(o,h=>h.type==="ai")?.messageId||"")},[o,r]),(0,q.useEffect)(()=>{i.open&&l({lastAIMessageId:u.current})},[i.open]),(0,q.useEffect)(()=>{a(h=>({...h,lastOutput:s})),e?.(s)},[s,i.open]);let c=(0,q.useRef)(null),p=q.default.useRef(null),m=(0,q.useCallback)(Sn(()=>{let h=c.current;h&&(h.style.minHeight=`${p.current?.offsetHeight||0}px`)},100),[]),x=(0,q.useCallback)(He(()=>{let h=c.current;h&&(h.style.minHeight=`${(p.current?.offsetHeight||0)+1}px`)},100),[]);return(0,q.useEffect)(()=>{setTimeout(()=>{p.current?.scrollTo({top:p.current.scrollHeight}),m(),x()},0)},[s]),(0,q.useEffect)(()=>{let h=g=>{if((g.metaKey||g.ctrlKey)&&(g.stopPropagation(),g.key==="C"||g.key==="c"||g.key==="x"||g.key==="X")){let _=window.getSelection();if(_&&_.rangeCount>0){let y=_.getRangeAt(0).toString()||_.toString();y&&(g.preventDefault(),navigator.clipboard.writeText(y))}}};p.current?.addEventListener("keydown",h,!0)},[]),q.default.createElement(U,{ref:c,className:"chat-message--text max-ai__writing-message-box",whiteSpace:"pre-wrap",width:"100%",sx:{wordBreak:"break-word",borderBottomLeftRadius:0,color:h=>h.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)","& .markdown-body":{userSelect:"text",maxHeight:"min(40vh, 320px)",overflowY:"auto","*":{fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important'},"& p:last-child":{mb:"1em"}}},component:"div"},yn(s)?q.default.createElement(Gi,null):null,q.default.createElement("div",{tabIndex:-1,ref:p,style:{textAlign:"left"},className:`markdown-body ${t.isDarkMode?"markdown-body-dark":""}`},q.default.createElement(vr,null,s.replace(/^\s+/,""))))},Gi=()=>{let{t:n}=N(["common","client"]),{currentSelection:t}=Pe(),e=(0,q.useMemo)(()=>{if(t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText){let o=t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText.trim().replace(/\u200B/g,"");return((i,a)=>{if(i.length<=a)return{start:i,end:""};let l=i.substring(i.length-a);return{start:i.substring(0,i.length-a),end:l}})(o,15)}return{start:"",end:""}},[t]);return!e.start&&!e.end?null:q.default.createElement(V,{sx:{width:"100%",display:"flex",flexDirection:"row"},fontSize:"12px",fontWeight:400,color:"text.secondary"},q.default.createElement("span",{style:{flexShrink:0}},n("client:floating_menu__draft_card__context__title"),":"," "),q.default.createElement("span",{style:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"}},e.start),q.default.createElement("span",{style:{flexShrink:0,whiteSpace:"nowrap"}},e.end))},Xr=Vi;var Qr=k(yi());var _e=k(H());var $i=({TooltipProps:n,...t})=>{let{currentSidebarConversationType:e}=Ce(),{currentAIProviderDetail:o,currentAIProviderModelDetail:r}=Nn(),{t:i}=N(["common","client"]),[a,l]=(0,_e.useState)(void 0);return(0,_e.useEffect)(()=>{if(e==="Chat"&&o&&r){let s=i(o.label)!==o.label?i(o.label):o.label,u=i(r.title)!==r.title?i(r.title):r.title;l({title:`${s} (${u})`,provider:o.value,model:r.value})}},[o,r,i,e]),_e.default.createElement(_e.default.Fragment,null,a?_e.default.createElement(Re,{...n,title:a.title},_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},a.provider?_e.default.createElement(Bn,{aiProviderType:a.provider,...t}):_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}}))):_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}})))},Jr=$i;var Ki=[],qi=!0,Zr=n=>{let{root:t}=n,{t:e}=N(["common","client"]),{palette:o}=gn(),{currentSelectionRef:r}=Pe(),i=j(ke),a=le(qe),{currentSidebarConversationType:l,updateSidebarConversationType:s}=Ce(),[u,c]=Q(ge),p=yo(),{isLogin:m}=qt(),x=j(Tn),[h,g]=Q(xt),_=(0,I.useCallback)(()=>{let C=r.current?.activeElement||r.current?.selectionElement?.target;return C&&Mn()?.contains(C)},[]),f=(0,I.useMemo)(()=>h.lastOutput,[h.lastOutput]),[y,M]=Q(rt),[d,A]=(0,I.useState)([]),Y=(0,I.useMemo)(()=>{if(u.rootRect){let C=Math.max(u.rootRect?.width||0,Fo-32);return C>1280?1280:C}return Fo-32},[u.rootRect]),F=(0,I.useMemo)(()=>{let C="bottom-start",B="bottom-start";if(u.rootRect&&Y){let G=or(u.rootRect,Y,400);G.y>u.rootRect.top?(C="bottom-start",B="bottom-start"):G.y<u.rootRect.top&&(C="top-start",B="top-start"),G.x>u.rootRect.left+300?C="right-start":G.x<u.rootRect.left-300&&(C="left-start")}return{inputPlacement:C,contextMenuPlacement:B}},[u.rootRect,Y]),{x:oe,y:fe,strategy:E,refs:S,context:O}=ht({open:u.open,onOpenChange:C=>{c(B=>({...B,open:C}))},placement:F.inputPlacement,middleware:rr,whileElementsMounted:oo}),P=ro(O),Z=io(O,{}),{getFloatingProps:z}=so([Z,P]),[R,X]=(0,I.useState)(""),Te=(0,I.useRef)(null),{setShortCuts:vo,runShortCuts:Ao,loading:ze,reGenerate:Et,shortCutsEngineRef:ko}=Se(""),{contextMenuList:at,originContextMenuList:lt}=po("textSelectPopupButton",R),Oe=fr(),tt=(0,I.useMemo)(()=>ze?Ki:f?Oe:at,[ze,at,f,Oe]);(0,I.useEffect)(()=>{},[tt]);let wt=(0,I.useMemo)(()=>R.length>0,[R]);(0,I.useEffect)(()=>{if(u.rootRect){let C=ao(u.rootRect);if(!qi){document.querySelector("#rangeBorderBox")?.remove();let B=document.createElement("div");B.id="rangeBorderBox",B.style.position="absolute",B.style.left=C.left+"px",B.style.top=C.top+window.scrollY+"px",B.style.width=C.width+"px",B.style.height=C.height+"px",B.style.border="1px solid green",B.style.zIndex="9999",B.style.pointerEvents="none",document.body.appendChild(B)}S.setPositionReference({getBoundingClientRect(){return C}})}},[u.rootRect]),(0,I.useEffect)(()=>{if(u.open&&tt.length>0){let C=null;tt.find(B=>{if(B.data.type==="group"){if(B.children.length>0)return C=B.children.find(G=>G.data.type==="shortcuts")||null,C!==null}else if(B.data.type==="shortcuts")return C=B,!0;return!1}),C&&M(B=>({...B,lastHoverContextMenuId:C?.id||""}))}},[tt,u.open]),(0,I.useEffect)(()=>{if(u.open){yt("floatingMenuInputMediator").updateInputValue("");let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1),co().then(B=>{a(B)})}else{let B=ne()?.querySelector(`#${Ke}`)?.value;B&&yt("chatBoxInputMediator").updateInputValue(B)}},[u.open]),(0,I.useEffect)(()=>{if(!i.loading&&lo()){let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1)}},[i.loading]);let Bt=async C=>{if(C.trim()){let B=p,G="",Ie=r.current?.selectionElement;Ie&&(Ie.isEditableElement?Ie.editableElementSelectionText?B?G=B:G="{{SELECTED_TEXT}}":B?G=B:G="":G="{{SELECTED_TEXT}}");let se=`${C}`;G&&(se+=`:
"""
${G}
"""`),_()||s("Chat"),A([{type:"RENDER_TEMPLATE",parameters:{template:se}},{type:"ASK_CHATGPT",parameters:{}}])}},Lt=(0,I.useRef)(Et);(0,I.useEffect)(()=>{Lt.current=Et},[Et]),(0,I.useEffect)(()=>{if(y.selectedContextMenuId&&lt.length>0&&u.open&&!ze){let C=y.selectedContextMenuId,B=!1,G=!1,Ie=!1,se=null;if(lr(C)&&(C=C.replace(Ct,""),B=!0),(!m||x.status!=="success")&&(G=!0),Ie=ir(C),Ie){let Ve=sr(C);Ve&&(se=Ve)}else se=lt.find(Ve=>Ve.id===C)||null;if(se&&se.id){if(se.data.type==="group")return;Ie||Xe.getMediator("textSelectPopupButton").favoriteContextMenu(se).then().catch(),B&&(se=ur(se)),Te.current=se;let Ve=se.id,Rt=se.data.actions||[];if(M(()=>({selectedContextMenuId:null,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})),_()||s("Chat"),Rt.length>0)A(Rt);else if(Ie){if(G){Ne(),c({open:!1,rootRect:null});return}g(w=>({...w,selectContextMenuId:se?.id||null})),uo(Ve)==="TRY_AGAIN"&&Lt.current(),setTimeout(()=>{g(w=>({...w,selectContextMenuId:null}))},100)}}}},[y.selectedContextMenuId,lt,u.open,ze,x.status,m]),(0,I.useEffect)(()=>{},[y.selectedContextMenuId]);let Ue=(0,I.useRef)(!1);return(0,I.useEffect)(()=>{let C=je(d);if(d.length>0&&(l==="Chat"||_())){if(Ue.current)return;Ue.current=!0,Te.current&&(Te.current=null),vo(C),A([]),Te.current||yt("floatingMenuInputMediator").updateInputValue("");let G=r.current?.selectionElement?.isEditableElement,Ie=!1;(!m||x.status!=="success")&&(Ie=!0),(!G||Ie)&&(c({open:!1,rootRect:null}),Ne()),X(""),Ao().then(()=>{(ko.current?.getNextAction()?.error||"")&&(c({open:!1,rootRect:null}),Ne())}).catch().finally(()=>{Ue.current=!1})}},[d,m,l]),(0,I.useEffect)(()=>{let C=(B,G)=>{G&&G?.contextMenu&&(Te.current=G.contextMenu),X(B)};return yt("floatingMenuInputMediator").subscribe(C),()=>{yt("floatingMenuInputMediator").unsubscribe(C)}},[X]),I.default.createElement(no,{root:t},I.default.createElement("div",{ref:S.setFloating,...z(),style:{position:E,zIndex:u.open?2147483601:-1,opacity:u.open?1:0,top:fe??0,left:oe??0,width:Y,maxWidth:"90vw"},onKeyUp:C=>{C.stopPropagation()},id:cn,"aria-hidden":u.open?"false":"true"},I.default.createElement(Eo,{customOpen:!0,defaultPlacement:F.contextMenuPlacement,needAutoUpdate:!0,hoverOpen:!1,menuList:tt,referenceElementOpen:u.open,referenceElement:I.default.createElement("div",{style:{boxSizing:"border-box",border:"1px solid",borderColor:o.customColor.borderColor,background:o.customColor.paperBackground,borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",overflow:"hidden",isolation:"isolate",display:"flex",flexDirection:"column",width:"100%",padding:"7px 12px"},onKeyPress:C=>{C.stopPropagation()}},I.default.createElement(Xr,null),I.default.createElement(U,{width:"100%",direction:"row",alignItems:"center",gap:1},I.default.createElement(Jr,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},size:16,sx:{flexShrink:0,p:"4px",alignSelf:"start"}}),I.default.createElement(U,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left"},ze?I.default.createElement(I.default.Fragment,null,I.default.createElement(V,{fontSize:"16px",color:"primary.main"},e("client:floating_menu__input__running_placeholder")),I.default.createElement(Gt,{size:"16px"})):I.default.createElement(wr,{expandNode:u.open&&I.default.createElement(Ar,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},sx:{alignSelf:"end"},direction:"column",size:"tiny"}),placeholder:u.open?e("client:floating_menu__input__placeholder"):"",InputId:Ke,sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:"24px"},onEnter:C=>{!f&&at.length>0||Bt(C)}}),!ze&&I.default.createElement(I.default.Fragment,null,I.default.createElement(Re,{floatingMenuTooltip:!0,title:e("client:floating_menu__button__send_to_ai"),description:"\u23CE",placement:F.contextMenuPlacement},I.default.createElement(Pn,{sx:{height:"24px",width:"24px",borderRadius:"4px",flexShrink:0,alignSelf:"end",alignItems:"center",p:0,m:0,cursor:wt?"pointer":"default",bgcolor:wt?"primary.main":"rgb(219,219,217)","&:hover":{bgcolor:wt?"primary.main":"rgb(219,219,217)"}},onClick:()=>{!f&&at.length>0||Bt(R)}},I.default.createElement(Qr.default,{sx:{color:"#fff",fontSize:16}}))),I.default.createElement(qo,{sx:{width:24,height:24,alignSelf:"end"}}),I.default.createElement(Pt,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0}})),I.default.createElement(Xo,null)))),root:t})))};var ti=k(un()),ji="USE_CHAT_GPT_AI".toLowerCase().replace(/_/g,"-"),Yi=({containerId:n="modal-root",children:t})=>{let[e,o]=(0,$e.useState)(null),r=(0,$e.useRef)(null);return(0,$e.useEffect)(()=>{let i=document.getElementById(n);if(i){let a=document.createElement("div");a.id=mn;let l=document.createElement("style"),s=document.createElement("link");if(s.rel="stylesheet",s.href=ti.default.runtime.getURL("content_style.css"),i.shadowRoot)i.shadowRoot.appendChild(a),i.shadowRoot.appendChild(l),i.shadowRoot.appendChild(s);else{let u=i.attachShadow({mode:"open"});u.appendChild(a),u.appendChild(l),u.appendChild(s)}r.current=ct({key:`${ji}-context-menu`,prepend:!0,container:l}),o(a)}},[n]),!e||!r.current?null:(0,ei.createPortal)($e.default.createElement(ot,{value:r.current},$e.default.createElement(Zr,{root:e}),t),e)},oi=Yi;var de=k(H());var Mt=k(H());var Xi=n=>{let{buttonSettingKey:t,placement:e,onClick:o}=n,{t:r}=N(["common","client","prompt"]),{favoriteContextMenuList:i}=cr(t);return Mt.default.createElement(U,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}}}},i?.map(a=>{let l=!a.data.icon,s=a.text,u=a.id.replace(Ct,""),c=`prompt:${u}`;r(c)!==u&&(s=r(c));let p=String(s[0]||"").toUpperCase();return Mt.default.createElement(mt,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom"},title:s,key:a.id,sx:{minWidth:"unset",p:l?"6px!important":"8px!important"},onMouseUp:m=>{m.stopPropagation(),m.preventDefault()},onMouseDown:m=>{m.stopPropagation(),m.preventDefault()},onClick:m=>{m.stopPropagation(),m.preventDefault(),o&&o(a)}},l?Mt.default.createElement(U,{className:"max-ai__click-menu-button--box__text-icon",alignItems:"center",justifyContent:"center",sx:{width:"22px",height:"22px",boxSizing:"border-box",borderRadius:"4px",bgcolor:m=>m.palette.mode==="dark"?"#4f4f4f":"#F5F6F7",color:m=>m.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}},Mt.default.createElement(V,{component:"span",fontSize:"13px",color:"inherit"},p)):Mt.default.createElement(ue,{icon:a.data.icon,sx:{fontSize:"18px",color:m=>m.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}}))}))},ni=Xi;var To=k(H());var ri=n=>{let{sx:t,placement:e,TooltipProps:o}=n,{t:r}=N(["common","client"]),{createSearchWithAI:i}=Co();return To.default.createElement(U,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}},...t}},To.default.createElement(mt,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom",...o},title:r("client:sidebar__tabs__search__tooltip"),sx:{minWidth:"unset",p:"8px!important"},onMouseUp:a=>{a.stopPropagation(),a.preventDefault()},onMouseDown:a=>{a.stopPropagation(),a.preventDefault()},onClick:async a=>{a.stopPropagation(),a.preventDefault();let l=window.getSelection()?.toString();l&&await i(l,!1)}},To.default.createElement(ue,{icon:"Search",sx:{fontSize:"18px",color:a=>a.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}})))};var Ji=n=>{let{t}=N(["common","client"]),{tempSelection:e,show:o,hideRangy:r}=Pe(),{chatBoxShortCutKey:i}=Je(),a=Xt("textSelectPopupButton"),l=le(rt),s=j(ke),u=le(Jt),{closeBeforeRefresh:c}=j(Ye),{showFloatingContextMenu:p}=St(),[m]=Q(ge),x=(0,de.useMemo)(()=>o&&a?.buttonVisible&&!c&&!m.open,[c,o,a,m]),{x:h,y:g,strategy:_,refs:f,placement:y}=ht({placement:"bottom-start",middleware:[Zt({fallbackPlacements:["top-start","right","left"]}),to({crossAxis:!0,padding:16}),eo(d=>{if(d.placement.indexOf("bottom")>-1){let A={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight+window.scrollY};return tr({top:d.y,left:d.x,bottom:d.y+d.rects.floating.height+50,right:d.rects.floating.width+d.x},A)?d.rects.reference.y-d.y-d.rects.floating.height-8:8}else return 8})]});(0,de.useEffect)(()=>{if(!e||!x)return;let d=ao(e.selectionRect);if(x&&d){if(d=nr(d),!nt){document.querySelector("#rangeBorderBox")?.remove();let A=document.createElement("div");A.id="rangeBorderBox",A.style.position="absolute",A.style.left=d.left+"px",A.style.top=d.top+window.scrollY+"px",A.style.width=d.width+"px",A.style.height=d.height+"px",A.style.border="2px solid red",A.style.zIndex="9999",A.style.pointerEvents="none",document.body.appendChild(A)}f.setPositionReference({getBoundingClientRect(){return{...d,x:d.left,y:d.top}}})}},[e,x]);let M=(0,de.useCallback)(()=>{if(f.floating.current){if(getComputedStyle(f.floating.current).opacity==="0")return;r(),fo(),go()}},[]);return(0,de.useEffect)(()=>{let d=A=>{A.key==="Escape"&&M()};return document.addEventListener("keydown",d,!0),()=>{document.removeEventListener("keydown",d,!0)}},[]),(0,de.useEffect)(()=>{s.loading&&(setTimeout(()=>{M()},1e3),M())},[s.loading]),de.default.createElement(Ut,{elevation:3,component:"div",ref:f.setFloating,className:`max-ai__click-context-menu ${x?"open":"close"}`,sx:{bgcolor:"transparent",borderRadius:"14px",zIndex:x?2147483600:-1,position:_,opacity:x?1:0,top:g??0,left:h??0,width:"max-content"}},de.default.createElement(U,{direction:"row",alignItems:"center",sx:{"& .max-ai__click-menu-button--box":{div:{display:"flex"},height:"28px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{"&:has(button)&::after":{display:"none"}},"& button":{bgcolor:"background.paper",minWidth:"unset",padding:"5px 8px!important",boxSizing:"border-box",borderRadius:"0","&:hover":{bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"},"&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 6px!important"}},"&:first-child":{"& button":{borderTopLeftRadius:"14px",borderBottomLeftRadius:"14px",borderTopRightRadius:0,borderBottomRightRadius:0}},"&:not(:last-child)":{"&::after":{content:'""',position:"absolute",right:0,top:"25%",transform:"scale(0.5) translateY(-50%)",width:"1px",height:"32px",bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}}}}},de.default.createElement(D,{component:"div",className:"max-ai__click-menu-button--box"},de.default.createElement(mt,{TooltipProps:{floatingMenuTooltip:!0,placement:y,description:i,sx:{maxWidth:360}},title:t("client:floating_menu__button__cta__tooltip"),className:"usechatgpt-ai__context-menu--handle-button",id:"max_ai__floating_context_menu__cta_button",size:"small",variant:"text",onMouseUp:d=>{d.stopPropagation(),d.preventDefault()},onMouseDown:d=>{d.stopPropagation(),d.preventDefault()},onClick:d=>{d.stopPropagation(),d.preventDefault();let A=window.getSelection()?.rangeCount;if(A&&A>0){let Y=window.getSelection()?.getRangeAt(0)?.cloneRange();u({range:Y||null,selectionText:window?.getSelection()?.toString()||""})}e&&p()}},de.default.createElement(Ee,{sx:{fontSize:"18px"}}))),de.default.createElement(ri,{placement:y}),de.default.createElement(ni,{placement:y,buttonSettingKey:"textSelectPopupButton",onClick:d=>{e&&p(),setTimeout(()=>{l(A=>({...A,selectedContextMenuId:d.id}))},100)}}),de.default.createElement(Zo,{placement:y})))},ii=Ji;var he=k(H());var Qi=()=>{let{closeBeforeRefresh:n}=j(Ye),{haveSelection:t,showFloatingContextMenu:e,floatingDropdownMenuOpen:o}=St(),r=Xt("textSelectPopupButton"),[i,a]=(0,he.useState)(16),[l,s]=(0,he.useState)(3),{chatBoxShortCutKey:u}=Je();return(0,he.useEffect)(()=>{if(!(r?.buttonVisible&&!n)&&t){let c=document.querySelector(`#${Ft}`);c&&c.classList.contains("open")?a((c.getBoundingClientRect().width||0)+16):a(16),s(1)}},[t,r,n]),(0,he.useEffect)(()=>{if(l===1)s(2);else if(l===2){let c=setTimeout(()=>{s(3)},2e3);return()=>{clearTimeout(c)}}return()=>{}},[l]),(0,he.useEffect)(()=>{s(3)},[o]),null;return he.default.createElement(he.default.Fragment,null,u?he.default.createElement(D,{className:"usechatgpt-ai__context-menu--handle-button",sx:{position:"fixed",bottom:16,right:i,zIndex:l!==3?2147483661:-1,backgroundColor:"rgba(98,98,105,1)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",overflow:"hidden",maxWidth:l!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(V,{fontSize:"24px",fontWeight:"bold",color:"#fff",noWrap:!0,sx:{px:"10px",py:"4px"}},u)):he.default.createElement(D,{sx:{position:"fixed",bottom:16,right:i,zIndex:l!==3?2147483661:-1,backgroundColor:"#fff",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",maxWidth:l!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(Ut,{elevation:3,sx:{padding:"8px 10px"}},he.default.createElement(Ee,{sx:{fontSize:24}}))))},si=Qi;var Be=k(H()),ci=k(Po());var W=k(H());var ie=k(H());Bo();Lo();var Zi=n=>{let{buttonKey:t,children:e,rootId:o,root:r,permissionWrapperCardSceneType:i}=n,[a,l]=(0,ie.useState)(null),{currentSidebarConversationType:s,updateSidebarConversationType:u}=Ce(),{currentUserPlan:c}=We(),p=Yt(),{createConversation:m}=gt(),{contextMenuList:x}=po(t,"",!1),{loading:h}=j(ke),{setShortCuts:g,runShortCuts:_}=Se(),f=(0,ie.useRef)(null),y=(0,ie.useMemo)(()=>!(i&&c.name==="free"),[i,c]),M=(0,ie.useCallback)(async F=>{if(!h&&F.data.actions){let oe=await Wt(),fe=`ON_BOARDING_RECORD_INPUT_ASSISTANT_BUTTON_${Ae()}_TIMES`,E=Number(oe[fe]||0);if(!y&&i)if(E>0)await Tt(fe,E-1);else{Ne(),Kt("show",i);let O=await m();await dt("add",O,0,[jt(p[i])]);return}let S=je(F.data.actions);S.splice(0,0,{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{OperationElementElementSelector:`[maxai-input-assistant-button-id="${o}"]`}}}),await g(S),await _(!0)}},[g,_,h,y,i]),d=(0,ie.useRef)(M);(0,ie.useEffect)(()=>{d.current=M},[M]);let A=(0,ie.useRef)(!1),Y=(0,ie.useRef)(s);return(0,ie.useEffect)(()=>{Y.current=s},[s]),(0,ie.useEffect)(()=>{!A.current&&a&&d.current&&Y.current==="Chat"&&(A.current=!0,l(null),d.current(a).then().catch().finally(()=>{A.current=!1}))},[a]),(0,ie.useEffect)(()=>{if(r&&o&&!f.current){let F=document.createElement("style");F.setAttribute("data-emotion-id",o),r.appendChild(F),f.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:F})}},[r,o]),!r||!f.current?null:ie.default.createElement(ot,{value:f.current},ie.default.createElement(Eo,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["bottom-end","bottom","top-start","top-end","top","right","left"],root:r,menuList:x,needAutoUpdate:!0,hoverOpen:!1,menuWidth:240,referenceElement:e,onClickContextMenu:async F=>{u("Chat"),l(F)},onClickReferenceElement:()=>{}}))},en=Zi;Bo();Lo();var es=n=>{let{rootId:t,InputAssistantBoxSx:e,DropdownButtonStyle:o,CTAButtonStyle:r,buttonGroup:i,shadowRoot:a,placement:l}=n,s=(0,W.useRef)(null),{t:u}=N(["client"]),[c,p]=(0,W.useState)(null),{loading:m}=j(ke),[x,h]=(0,W.useState)(!1),[g,_]=(0,W.useState)(!1),f=(0,W.useMemo)(()=>{let M=je(r),d=je(o),A={},Y={};if(i.forEach(F=>{F.CTAButtonStyle&&(M=Object.assign(M,{...F.CTAButtonStyle})),F.DropdownButtonStyle&&(d=Object.assign(d,{...F.DropdownButtonStyle}))}),A){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:fe="#fff",hoverColor:E="#fff",borderColor:S="rgb(77, 26, 137)",hoverBorderColor:O="rgb(77, 26, 137)",borderRadius:P="4px 0 0 4px",borderWidth:Z="0 1px 0 0",iconSize:z=20,padding:R="8px 12px"}=M||{};A={minWidth:"unset",backgroundColor:F,color:fe,borderColor:S,borderRadius:P,fontSize:`${z}px`,borderWidth:Z,borderStyle:"solid",position:"relative",padding:R,"&:hover":{color:E,backgroundColor:oe,borderColor:O}}}if(Y){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:fe="#fff",hoverColor:E="#fff",borderColor:S="transparent",hoverBorderColor:O="transparent",borderRadius:P="0 4px 4px 0",borderWidth:Z="0",iconSize:z=20,padding:R="8px 4px"}=d||{};Y={minWidth:"unset",backgroundColor:x?oe:F,color:x?E:fe,borderColor:x?O:S,borderRadius:P,fontSize:`${z}px`,borderWidth:Z,borderStyle:"solid",padding:R,"&:hover":{color:E,backgroundColor:oe,borderColor:O}}}return{ctaButtonSx:A,dropdownButtonSx:Y}},[r,o,x,i]),y=(0,W.useMemo)(()=>{let M=je(e)||{};i.forEach(A=>{A.InputAssistantBoxSx&&Object.assign(M,A.InputAssistantBoxSx)});let d={boxShadow:"0px 2px 3px 1px rgba(118, 1, 211, 0.16), 1px 0px 2px 0px rgba(118, 1, 211, 0.08), -1px 0px 2px 0px rgba(118, 1, 211, 0.08)",...M?.["&:hover"]};return d&&delete M["&:hover"],{...M,...g?d:{}}},[e,g,i]);return(0,W.useEffect)(()=>{if(a){let M=document.createElement("style");a.appendChild(M),s.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:M})}},[a]),(0,W.useEffect)(()=>{p(document.querySelector(`#${_t}`)?.shadowRoot?.querySelector("div"))},[]),W.default.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"4px",...y},onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1)},i[0]&&W.default.createElement(en,{rootId:t,buttonKey:i[0].buttonKey,permissionWrapperCardSceneType:i[0].permissionWrapperCardSceneType,root:c},W.default.createElement(D,null,W.default.createElement(Re,{placement:l,zIndex:2e6,PopperProps:{container:c},title:u(i[0].tooltip)},W.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"},onMouseEnter:()=>{h(!0)},onMouseLeave:()=>{h(!1)}},s.current&&W.default.createElement(ot,{value:s.current},W.default.createElement(D,{position:"absolute",top:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),W.default.createElement(K,{id:`maxAIInputAssistantCtaButton${t}`,"data-testid":"maxai-input-assistant-cta-button",disabled:m,sx:f.ctaButtonSx},m?W.default.createElement(Gt,{size:r?.iconSize||20,sx:{fontSize:"inherit",color:"#fff"}}):W.default.createElement(Ee,{sx:{fontSize:"inherit",color:"inherit"}})),W.default.createElement(D,{position:"absolute",bottom:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))),i[1]&&W.default.createElement(en,{rootId:t,buttonKey:i[1].buttonKey,permissionWrapperCardSceneType:i[1].permissionWrapperCardSceneType,root:c},W.default.createElement(D,null,W.default.createElement(Re,{placement:l,zIndex:2e6,PopperProps:{container:c},title:u(i[1].tooltip)},W.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"}},s.current&&W.default.createElement(ot,{value:s.current},W.default.createElement(D,{position:"absolute",top:`-${o?.transparentHeight||0}px`,width:"100%",height:`${o?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),W.default.createElement(K,{id:`maxAIInputAssistantDropdownButton${t}`,"data-testid":"maxai-input-assistant-dropdown-button",disabled:m,sx:f.dropdownButtonSx},W.default.createElement(ue,{icon:"ArrowDropDown",sx:{fontSize:"inherit",color:"inherit"}})),W.default.createElement(D,{position:"absolute",bottom:`-${o?.transparentHeight||0}px`,width:"100%",height:`${o?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))))},ai=es;var ts=n=>{let t=Ae();return t==="mail.google.com"?os(n):t==="outlook.office.com"||t==="outlook.live.com"||t==="outlook.office365.com"?ns(n):t==="twitter.com"?rs(n):t==="linkedin.com"?is(n):t==="facebook.com"?ss(n):t==="youtube.com"?[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]:t==="studio.youtube.com"?[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]:t==="instagram.com"?as(n):[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]},os=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=document.querySelectorAll("div[data-message-id]");for(let r=0;r<o.length;r++)if(o[r].nextElementSibling?.contains(t))return[e.composeReplyButton,e.refineDraftButton];return[e.composeNewButton,e.refineDraftButton]},ns=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=document.querySelector('div[data-app-section="ConversationContainer"]'),r=document.querySelector("#ReadingPaneContainerId"),i=r.querySelectorAll('div[role="textbox"]:has(#removeButton)').length,a=r.querySelector("#RplyFwdMsg")||r.querySelector("#divRplyFwdMsg"),l=Array.from(document.querySelectorAll('div[role="dialog"]')).find(u=>u.contains(t)),s=r.querySelector('input[maxlength="255"]')?.value||"";return!o?.contains(t)&&i===0&&!a&&!l&&!s?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},rs=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return Mr(t)?.querySelector('article[data-testid="tweet"]')?[e.composeReplyButton,e.refineDraftButton]:Array.from(document.querySelectorAll('article[data-testid="tweet"]')).find(i=>i.nextElementSibling?.contains(t))?[e.composeReplyButton,e.refineDraftButton]:[e.composeNewButton,e.refineDraftButton]},is=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return t.classList.contains("share-box_actions")?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},ss=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return mo('form[method="POST"]',t,20)?[e.composeNewButton,e.refineDraftButton]:mo('form[role="presentation"]',t)?.getBoundingClientRect().width<240?[]:[e.composeReplyButton,e.refineDraftButton]},as=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=mo('div[contenteditable="true"]',t,20),r=pr('div[aria-label][role="dialog"]',o);return o&&r?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},tn=ts;var li=new pt("ContextMenu/InputAssistantButtonManager"),on=class{constructor(){this.interval=1e3;this.stop=!1,this.host=Ae(),this.config=bn[this.host],this.observerMap=new Map}createInputAssistantButtonListener(t){this.timer=setInterval(()=>{if(!this.stop&&this.config){let{rootSelectors:e,rootSelectorStyle:o,rootParentDeep:r=0}=this.config,i=[];e.map(s=>i.push(...document.querySelectorAll(s)));let a=!1;i.forEach(s=>{let u=s,c=s,p=r;for(;p>0;)p--,c=c.parentElement;o&&(u.style.cssText=o);let m=this.attachInputAssistantButton(c);m&&(a=!0,li.info("newObserverData: ",m))}),(this.cleanObserverMap()||a)&&t(this.getAllObserverData(),this.config)}},this.interval)}attachInputAssistantButton(t){if(!this.config||t.querySelector("[maxai-input-assistant-button-id]"))return null;let{rootStyle:e,rootParentStyle:o,rootParentStyleDeep:r=1,rootNextElementSiblingStyle:i,rootPreviousElementSiblingStyle:a}=this.config;if(t&&e){if(a&&t.previousElementSibling){let M=t.previousElementSibling;M.style.cssText=a}if(t.style.cssText=e,i&&t.nextElementSibling){let M=t.nextElementSibling;M.style.cssText=i}}if(o){let M=0,d=t;for(;M<r;)M++,d=d?.parentElement;d&&(d.style.cssText=o)}let l=Ht(),{rootWrapperTagName:s,appendPosition:u,rootWrapperStyle:c}=this.config,p="customElements"in window,m=document.createElement(s);c&&(m.style.cssText=c);let x=document.createElement(p?"maxai-input-assistant-button":"div");if(x.setAttribute("maxai-input-assistant-button-id",l),m.appendChild(x),Cn(u)){let M=t.childNodes[u];M?t.insertBefore(m,M):t.appendChild(m)}else t.appendChild(m);x.attachShadow({mode:"open"});let h=x.shadowRoot,g=document.createElement("div");h?.appendChild(g),li.info("appendElement: ",m);let _=new MutationObserver(()=>{});if(_.observe(t,{childList:!0,subtree:!0}),tn({keyElement:t,buttonGroupConfig:this.config}).length===0)return _.disconnect(),m.remove(),null;let y={id:l,destroy:()=>{_.disconnect(),m.remove()},renderRootElement:g,observer:_,shadowRootElement:h,buttonGroup:tn({keyElement:t,buttonGroupConfig:this.config})};return this.observerMap.set(t,y),y}cleanObserverMap(){let t=!1;return this.observerMap.forEach((e,o)=>{let i=Array.from(e.shadowRootElement.querySelectorAll("style[data-emotion]")).find(a=>a.sheet?.cssRules.length===0&&a.innerHTML==="");document.body.contains(o)&&!i||(t=!0,e.destroy(),this.observerMap.delete(o))}),t}clearObserverMap(){this.observerMap.forEach((t,e)=>{t.destroy(),this.observerMap.delete(e)})}getAllObserverData(){let t=[];return this.observerMap.forEach(e=>t.push(e)),t}pause(){this.stop=!0,this.clearObserverMap()}continue(){this.stop=!1}},ui=on;var ls=()=>{let n=j(qe),[t,e]=(0,Be.useState)(null),[o,r]=(0,Be.useState)([]),i=Be.default.useRef(null);Le(()=>{i.current=new ui,i.current.createInputAssistantButtonListener((l,s)=>{r(l),e(s)})});let a=(0,Be.useMemo)(()=>{let l=Ae();return l==="mail.google.com"?n.userSettings?.inputAssistantButton?.gmail===!0:l==="outlook.live.com"||l==="outlook.office.com"||l==="outlook.office365.com"?n.userSettings?.inputAssistantButton?.outlook===!0:l==="twitter.com"?n.userSettings?.inputAssistantButton?.twitter===!0:l==="linkedin.com"?n.userSettings?.inputAssistantButton?.linkedIn===!0:l==="facebook.com"?n.userSettings?.inputAssistantButton?.facebook===!0:l==="youtube.com"||l==="studio.youtube.com"?n.userSettings?.inputAssistantButton?.youtube===!0:l==="instagram.com"?n.userSettings?.inputAssistantButton?.instagram===!0:!1},[n.userSettings?.inputAssistantButton]);return(0,Be.useEffect)(()=>{i.current&&(a?i.current?.continue():i.current?.pause())},[a]),Be.default.createElement(Be.default.Fragment,null,o.map(l=>(0,ci.createPortal)(Be.default.createElement(ai,{shadowRoot:l.shadowRootElement,rootId:l.id,buttonGroup:l.buttonGroup,root:l.renderRootElement,InputAssistantBoxSx:t?.InputAssistantBoxSx,CTAButtonStyle:t?.CTAButtonStyle,DropdownButtonStyle:t?.DropdownButtonStyle}),l.renderRootElement,l.id)))},pi=ls;var us=()=>et.default.createElement(et.default.Fragment,null,et.default.createElement(oi,{containerId:Ot},et.default.createElement(ii,null),et.default.createElement(si,null),et.default.createElement(di,null)),et.default.createElement(pi,null)),mi=us;var cs=He(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="relative"&&(document.documentElement.style.position="unset",document.querySelector(`#${Ro}`)?.classList.replace("open","close"));let t=document.querySelector(`#${_t}`);t&&(t.style.display="none")}},100),ps=He(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="unset"&&(document.documentElement.style.position="relative",document.querySelector(`#${Ro}`)?.classList.replace("close","open"));let t=document.querySelector(`#${_t}`);t&&(t.style.display="")}},100),ms=()=>{let n=Ae();Le(()=>{if(n==="youtube.com"){let t=new MutationObserver(o=>{o.forEach(r=>{r.target&&(r.target.hasAttribute("scrolling")?cs():ps())})}),e=document.querySelector("ytd-app");e&&t.observe(e,{attributes:!0,childList:!1,subtree:!1})}})},fi=ms;var gi=new pt("AppInit"),ds=()=>window.location.host!=="www.usechatgpt.ai"&&window.location.host!=="www.maxai.me"?v.default.createElement(v.default.Fragment,null):v.default.createElement(K,{onClick:()=>{Me({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}),fs=()=>{let n=le(qe),t=le(dn);return yr(),(0,v.useEffect)(()=>{let e=async()=>{let o=await co();o&&(n({...o}),gi.info("get db settings",o));let r=await wn();r&&(t({...r}),gi.info("get local settings",r))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),v.default.createElement(v.default.Fragment,null)},gs=()=>{let{t:n}=N(["common","client"]),[t,e]=v.default.useState(null),o=v.default.useRef(!1);Le(()=>{window.location.href.includes(nn.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")&&e(100)}),hr(()=>{let r=document.body.querySelector("#usechatgptPDFViewerErrorAlert");if(r){if(o.current)return;o.current=!0,e(null);let i=r.getAttribute("data-url");(0,xi.render)(v.default.createElement(U,{spacing:2,p:2,width:"100%",sx:{boxSizing:"border-box"}},v.default.createElement(U,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1.4,color:"#fff"},v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:48,width:48,src:"/assets/USE_CHAT_GPT_AI/icons/maxai_48_normal.png"}),v.default.createElement(V,{variant:"body1",fontSize:18,fontWeight:700},n("client:pdf__info_card__title"))),v.default.createElement(U,{alignItems:"center",spacing:0},v.default.createElement(V,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},n("client:pdf__info_card__access_permission__description1"),v.default.createElement(Vt,{color:"rgba(255,255,255,1)",href:"#",onClick:async a=>{a.preventDefault(),await Me({key:"manage_extension"}),window.close()}},"chrome://extensions"),` ${n("client:pdf__info_card__access_permission__description2")} `),v.default.createElement(V,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:2}},i),v.default.createElement(D,{mb:2},v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Ho("/images/pdf/guide-1.gif")})),v.default.createElement(K,{disableElevation:!0,size:"small",variant:"contained",onClick:async a=>{a.preventDefault(),await Me({key:"manage_extension"}),window.close()},sx:{height:"56px",backgroundColor:"#7601D3",color:"#fff",fontSize:"18px",textTransform:"none",px:3,"&:hover":{backgroundColor:"#7601D3",color:"#fff"}}},n("client:pdf__info_card__access_permission__button"))),v.default.createElement(Rn,{sx:{color:"#fff"}},n("common:or")),v.default.createElement(U,{spacing:2},v.default.createElement(V,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},n("client:pdf__info_card__disabled__description1"),v.default.createElement(Vt,{color:"rgba(255,255,255,1)",href:"#",onClick:async a=>{a.preventDefault(),a.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"}),window.close()}},n("client:pdf__info_card__disabled__description2")),n("client:pdf__info_card__disabled__description3")),v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Ho("/images/pdf/guide-2.gif")}))),r);return}},t)},di=()=>{let{t:n}=N(["client","common"]);return(0,v.useMemo)(()=>window.location.href.includes(nn.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")?document.body.querySelector("#usechatgpt-disabled-pdf")||window.localStorage.getItem("hide_usechatgptai_pdf_alert")==="true"?null:v.default.createElement(D,{position:"fixed",right:8,top:40,zIndex:1e4,id:"usechatgpt-disabled-pdf"},v.default.createElement(ho,{icon:v.default.createElement(v.default.Fragment,null),action:v.default.createElement(v.default.Fragment,null),sx:{p:"8px!important",bgcolor:"#fff",border:"1px solid #7601D3","& > div":{"&:first-of-type":{display:"none"},"&:nth-of-type(2)":{padding:"0!important"},"&:last-of-type":{margin:"0!important",padding:"0!important",position:"absolute",top:0,right:0}},"& *":{color:"#7601D3"}}},v.default.createElement(U,{spacing:1,maxWidth:320},v.default.createElement(U,{direction:"row",alignItems:"center",spacing:1},v.default.createElement(Ee,{sx:{fontSize:14}}),v.default.createElement(V,{variant:"body1",fontSize:14,fontWeight:700},n("client:pdf__floating_card__title"))),v.default.createElement(V,{fontSize:14},n("client:pdf__floating_card__description1"),v.default.createElement(Vt,{href:"#",onClick:async e=>{e.preventDefault(),e.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"})}},n("client:pdf__floating_card__description2")),n("client:pdf__floating_card__description3")),v.default.createElement(K,{size:"small",disableElevation:!0,sx:{bgcolor:"#7601D3",color:"#fff","&:hover":{bgcolor:"#7601D3"},textTransform:"none"},onClick:async()=>{window.localStorage.setItem("hide_usechatgptai_pdf_alert",JSON.stringify(!0)),ne()?.querySelector("#usechatgpt-disabled-pdf")?.remove()}},n("client:pdf__floating_card__button"))))):null,[n])},xs=()=>(fi(),gr(),qt(),Fn(),_r(),Br(),Wn(),gs(),Dr(),Le(()=>{hn()&&Ne(),Fr(),Er().then().catch(),$r()}),Vr(),kr(),v.default.createElement(v.default.Fragment,null,v.default.createElement(mi,null),v.default.createElement(fs,null),v.default.createElement(ds,null))),cf=xs;export{fs as a,cf as b};
