var C=async t=>{let a=t instanceof Blob,r=a?t:await new Response(t).blob(),n=new FileReader;return new Promise(c=>{n.onload=()=>c([n.result,r.type,a]),n.readAsDataURL(r)})},I=([t,a,r])=>{let n=atob(t.slice(t.indexOf(",")+1)),c=n.length,e=new Uint8Array(c);for(let o=0;o<c;o+=1)e[o]=n.charCodeAt(o);return r||(a=t.match(/^data:(.+?);base64/)?.[1].replace(/(boundary=)[^;]+/,(o,l)=>l+String.fromCharCode(...e.slice(2,e.indexOf(13))))||""),[e,a]},w=async t=>new Promise(a=>{let r=new FileReader;r.onload=()=>{let n=r.result;a(n)},r.onerror=()=>{a(void 0)},r.readAsDataURL(t)}),D=(t,a)=>{try{let r=t.split(","),n=r[0].match(/:(.*?);/)[1],c=atob(r[1]),e=c.length,o=new Uint8Array(e);for(;e>0;)e-=1,o[e]=c.charCodeAt(e);return new File([o],a,{type:n})}catch{return}};var P=t=>t.type.startsWith("image/");function N(t){if(t.messageType==="InternalSearchQuery")return t.text;if(t.messageType==="InternalLoaderMessage")return`_${t.text}_`;for(let a of t.adaptiveCards)for(let r of a.body)if(r.type==="TextBlock")return r.text;return""}var F=String.fromCharCode(30),O={packMessage(t){return`${JSON.stringify(t)}${F}`},unpackMessage(t){return t.toString().split(F).filter(Boolean).map(a=>JSON.parse(a))}},L=async t=>{let a=await w(t);return new Promise(r=>{let e=document.createElement("img");e.src=a||"",e.onload=async()=>{try{let o=e.width,l=e.height,f=36e4/(o*l),p=Math.sqrt(f);o*=p,l*=p;let h=await M(t),y=document.createElement("canvas");((b,i,g,d,A)=>{let u=i.style.width,m=i.style.height,s=i.getContext("2d");if(b>4?(i.width=d,i.height=g,i.style.width=m,i.style.height=u):(i.width=g,i.height=d,i.style.width=u,i.style.height=m),s){switch(b){case 2:s.translate(g,0),s.scale(-1,1);break;case 3:s.translate(g,d),s.rotate(Math.PI);break;case 4:s.translate(0,d),s.scale(1,-1);break;case 5:s.rotate(.5*Math.PI),s.scale(1,-1);break;case 6:s.rotate(.5*Math.PI),s.translate(0,-d);break;case 7:s.rotate(.5*Math.PI),s.translate(g,-d),s.scale(-1,1);break;case 8:s.rotate(-.5*Math.PI),s.translate(-g,0)}s.fillStyle="#FFFFFF",s.fillRect(0,0,g,d),s.drawImage(A,0,0,g,d)}})(h,y,o,l,e);let R=Math.min(1,.7),x=y.toDataURL("image/jpeg",R);r(x)}catch{r("")}},e.onerror=()=>{r("")}})},U=t=>new Promise((a,r)=>{let n=new FileReader;n.onabort=()=>{r("Load Aborted")},n.onerror=()=>{r(n.error)},n.onload=()=>{a(n.result)},n.readAsArrayBuffer(t)}),M=async t=>{let a={1:"Default",2:"HFlip",3:"R180",4:"HFlipR180",5:"HFlipR270",6:"R270",7:"HFlipR90",8:"R90",NotJpeg:-2,"-2":"NotJpeg",NotDefined:-1,"-1":"NotDefined",Default:1,HFlip:2,R180:3,HFlipR180:4,HFlipR270:5,R270:6,HFlipR90:7,R90:8},r=await U(t),n=new DataView(r);if(n.getUint16(0,!1)!==65496)return a.NotJpeg;let c=n.byteLength,e=2;for(;e<c;){let o=n.getUint16(e,!1);if(e+=2,o===65505){if(n.getUint32(e+=2,!1)!==1165519206)break;let l=n.getUint16(e+=6,!1)===18761;e+=n.getUint32(e+4,l);let f=n.getUint16(e,l);e+=2;for(let p=0;p<f;p++)if(n.getUint16(e+12*p,l)===274){let h=e+12*p+8;return n.getUint16(h,l)}}else{if((65280&o)!=65280)break;e+=n.getUint16(e,!1)}}return a.NotDefined};export{C as a,I as b,w as c,D as d,P as e,N as f,O as g,L as h};
