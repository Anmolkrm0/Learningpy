import{P as O,mb as _,nb as W,ob as B,pb as U,sb as V}from"./DLL62XWK.js";import{a as A}from"./RTDSIOP5.js";import{a as P,c as Y,d as F}from"./SCPIJ7ZW.js";import{k as N,w as L}from"./624UJDNS.js";import{a as z}from"./3JX3VARJ.js";import{f as H}from"./PQ35KENF.js";var k=H(z());var D=H(Y()),X=H(F());D.default.extend(X.default);var J=P(),C=n=>({left:n.left,right:n.right,top:n.top,bottom:n.bottom,width:n.width||n.right-n.left,height:n.height||n.bottom-n.top,x:n.x||n.left,y:n.y||n.top}),G=()=>{try{return window.self!==window.top}catch{return!0}},K=new A("Iframe"),Q=async()=>{if(!G())return;O();let n=null,h=[],u=!1,y=(e,m=0)=>{try{let o=n||e.target,c=W(),M="",{isEditableElement:d,editableElement:E}=V(o),g="",p="",I=0;if(d&&E){I=_(E);let s=B(E);g=s.startMarkerId,p=s.endMarkerId,c=s.selectionText,M=s.editableElementSelectionText}!c&&u&&o.tagName==="BUTTON"&&m<10&&setTimeout(()=>{y(e,m+1)},100),n=null;let a=C(document.body.getBoundingClientRect()),i=C(o.getBoundingClientRect()),t=window.getSelection()?.getRangeAt(0)?.getBoundingClientRect(),l=null;if(o.tagName==="INPUT"||o.tagName==="TEXTAREA"){let s=Math.max(i.left,0),x=Math.max(i.top,0),f=(document.documentElement.clientWidth||document.body.clientWidth||document.body.offsetWidth)-s,r=document.documentElement.clientHeight||document.body.clientHeight||document.body.offsetHeight,T=Math.max(i.left,0),R=Math.max(i.left,0),S=Math.min(x,r),v=Math.min(x,r),j=Math.min(i.left>0?i.width:i.width+i.left,f),q=Math.min(i.top>0?i.height:i.height+i.top,r);l={left:T,x:R,top:S,y:v,width:j,height:q,right:Math.max(Math.min(i.width,f),f),bottom:Math.min(i.bottom,r)},l.height=Math.min(r-l.top,l.height)}else if(t){let s=Math.max(t.left,0),x=Math.max(t.top,0),f=(document.documentElement.clientWidth||document.body.clientWidth||document.body.offsetWidth)-s,r=document.documentElement.clientHeight||document.body.clientHeight||document.body.offsetHeight,T=Math.max(t.left,0),R=Math.max(t.left,0),S=Math.min(x,r),v=Math.min(x,r);l={left:T,x:R,top:S,y:v,width:Math.min(t.width,f),height:Math.min(t.height,r),right:Math.max(Math.min(t.right,f),f),bottom:Math.min(t.bottom,r)},l.height=Math.min(r-l.top,l.height)}let b=[h[0]-window.screenLeft,h[1]-window.screenTop];window.parent.postMessage({id:L,type:"iframeSelection",data:{virtual:!0,iframeId:J,tagName:o.tagName,id:o.id,className:o.className,windowRect:a,targetRect:i,selectionRect:t,iframeSelectionRect:l,iframePosition:b,selectionText:c||"",selectionHTML:c||"",editableElementSelectionText:M,editableElementSelectionHTML:M,eventType:e instanceof MouseEvent?"mouseup":"keyup",isEmbedPage:u,isEditableElement:d,caretOffset:I,startMarkerId:g,endMarkerId:p}},"*")}catch(o){K.error(o)}},w=e=>{let m=e.target;(m.tagName==="INPUT"||m.tagName==="TEXTAREA")&&(n=m),h=[e.screenX,e.screenY]};if(document.addEventListener("mousedown",w),document.addEventListener("mouseup",y),document.addEventListener("keyup",y),window.location.href.indexOf("maxai.me/embed")>-1){let e=document.createElement("div");e.id="USE_CHAT_GPT_AI_ROOT",e.style.display="none",e.style.zIndex="-1",e.style.position="absolute",e.style.top="-10000px",e.style.left="-10000px",e.style.width="1px",e.style.height="1px",e.style.overflow="hidden",e.style.opacity="0",e.style.pointerEvents="none",document.body.appendChild(e),u=!0}k.default.runtime.onMessage.addListener((e,m)=>{if(m.id===k.default.runtime.id&&e.event==="Client_listenUpdateIframeInput"){let o=e.data;o.startMarkerId&&o.endMarkerId&&U(o.startMarkerId,o.endMarkerId,o.value,o.type)}})},ie=n=>{let h=u=>{let{id:y,type:w,data:e}=u.data;if(y===L&&w==="iframeSelection"){let{selectionText:m,iframeSelectionRect:o,iframePosition:c}=e;if(!G()){if(!n)return;let M=window.outerHeight-window.innerHeight,d=[c[0],Math.max(c[1]-M,0)],E=document.querySelectorAll("iframe"),g=0,p=0,I=Array.from(E).find(a=>{let i=a.getBoundingClientRect();if(i){let{left:t,top:l,width:b,height:s}=i;if(d[0]>=t&&d[0]<=t+b&&d[1]>=l&&d[1]<=l+s)return g=l,p=t,!0}return!1});if(I){let a=C(o);if(a.top+=g,a.y=g,a.left+=p,a.x+=p,K.info("currentSelection",I,m,d,a),a){if(m&&!N){let i=document.getElementById("a");i&&i.remove();let t=document.createElement("div");t.id="a",t.style.position="fixed",t.style.top=a.top+"px",t.style.left=a.left+"px",t.style.width=a.width+"px",t.style.height=a.height+"px",t.style.border="1px solid red",t.style.pointerEvents="none",document.body.appendChild(t)}n({...e,iframeSelectionRect:a,selectionRect:a,iframePosition:d,isEmbedPage:u.origin.indexOf("maxai.me")>-1&&e.isEmbedPage})}}}}};return window.addEventListener("message",h),()=>{window.removeEventListener("message",h)}};Q();export{ie as a};
