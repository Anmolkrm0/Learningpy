(function(t){var e={};function a(n){if(e[n]){return e[n].exports}var r=e[n]={i:n,l:false,exports:{}};t[n].call(r.exports,r,r.exports,a);r.l=true;return r.exports}a.m=t;a.c=e;a.d=function(t,e,n){if(!a.o(t,e)){Object.defineProperty(t,e,{enumerable:true,get:n})}};a.r=function(t){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(t,"__esModule",{value:true})};a.t=function(t,e){if(e&1)t=a(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var n=Object.create(null);a.r(n);Object.defineProperty(n,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n};a.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};a.d(e,"a",e);return e};a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};a.p="";return a(a.s=0)})([function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});const n=a(1);const r=a(3);const i=new n.ImageManipulatorLocalOffscreenCanvas;r((t=>{const e=JSON.parse(t);const{type:a,data:n,authHeader:r}=e;i.setAuthHeader(r);if(a==="highlightSelection"){const{imageDataUrl:t,imageRectangle:e,addBorder:a}=n;return i.highlightSelection(t,e,a)}if(a==="thumbnailFromArea"){const{imageDataUrl:t,elementRectangle:e,thumbnailSize:a,isInput:r,shouldHighlight:o}=n;return i.thumbnailFromArea(t,e,a,r,o)}if(a==="getEntireElementAreaInThumbnail"){const{imageDataUrl:t,elementRectangle:e,thumbnailSize:a}=n;return i.getEntireElementAreaInThumbnail(t,e,a)}return undefined}))},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.ImageManipulatorLocalOffscreenCanvas=void 0;const n=a(2);class r extends n.BaseImageManipulator{constructor(){super(...arguments);this._authHeader={}}setAuthHeader(t){this._authHeader=t}createCanvas(t,e){return new OffscreenCanvas(t,e)}drawImage(t,e,a,n=1){const r=this.createCanvas(e,a);const i=r.getContext("2d");i.globalAlpha=n;i.drawImage(t,0,0,e,a);return{canvas:r,ctx:i}}cropImage(t,e,a,n,r){const i=t.getImageData(e,a,r,n);const o=this.createCanvas(r,n);const s=o.getContext("2d");s.rect(0,0,r,n);s.fillStyle="white";s.fill();s.putImageData(i,0,0);return{canvas:o,ctx:s}}scaleToFit(t,e){const{width:a,height:n}=e;const r=Math.min(a/t.width,n/t.height);const i=a/2-t.width/2*r;const o=n/2-t.height/2*r;const s=this.createCanvas(a,n);const c=s.getContext("2d");c.drawImage(t,i,o,t.width*r,t.height*r);return{canvas:s,ctx:c}}addBorder(t,e,a="magenta",n=3){e.strokeStyle=a;e.lineWidth=n;e.strokeRect(0,0,t.width,t.height);return{canvas:t,ctx:e}}async getImageObject(t){const e=await fetch(t,{headers:this._authHeader});const a=await e.blob();return await createImageBitmap(a)}async convertImageDataUrlToBlob(t){const e=await this.getImageObject(t);const{width:a,height:n}=e;const{canvas:r}=this.drawImage(e,a,n);return r.convertToBlob({type:"image/jpeg",quality:1})}async makeThumbnailScale(t,e){const a=await this.getImageObject(t);const{canvas:n}=this.scaleToFit(a,e);return n.convertToBlob({type:"image/jpeg",quality:1})}async thumbnailFromArea(t,e,a,n,r){const i=this._roundRectangleSize(e);if(!i||i.width===0&&i.height===0){return this.makeThumbnailScale(t,a)}const o=i.pixelRatio||1;const s=i.width-10>=a.width*o?2:1;const c=n?{x:i.left-10+a.width*s/2*o,y:i.top+i.height/2}:{x:i.left+i.width/2,y:i.top+i.height/2};const h=await this.getImageObject(t);const{width:l,height:u}=h;const{ctx:g}=this.drawImage(h,l,u);let d=g;const m=this._createRectangleFromCenterAndSize(c,a,o);if(r){const{left:t,top:e,height:a,width:n}=i;const{canvas:r,ctx:o}=this.cropImage(g,t,e,a,n);const{ctx:s}=this.drawImage(h,l,u,.5);const c=o.getImageData(0,0,r.width,r.height);s.putImageData(c,t,e);d=s}const{left:f,top:p,height:v,width:y}=this._scaleRectangle(m,s);const{canvas:w}=this.cropImage(d,f,p,v,y);const{canvas:b}=this.scaleToFit(w.transferToImageBitmap(),m);return b.convertToBlob({type:"image/jpeg",quality:1})}async highlightSelection(t,e,a){if(!e){return this.convertImageDataUrlToBlob(t)}if(e.width===0){e.width=1}if(e.height===0){e.height=1}const n=await this.getImageObject(t);const{width:r,height:i}=n;const{ctx:o}=this.drawImage(n,r,i);const{canvas:s,ctx:c}=this.drawImage(n,r,i,.5);const{left:h,top:l,height:u,width:g}=e;const{canvas:d,ctx:m}=this.cropImage(o,h,l,u,g);if(a!==null&&a!==void 0?a:true){this.addBorder(d,m)}const f=m.getImageData(0,0,d.width,d.height);c.putImageData(f,h,l);return s.convertToBlob({type:"image/jpeg",quality:1})}async getEntireElementAreaInThumbnail(t,e,a){const n=this._roundRectangleSize(e);if(!n||n.width===0&&n.height===0){return this.convertImageDataUrlToBlob(t)}return this.thumbnailFromArea(t,e,a,false,true)}}e.ImageManipulatorLocalOffscreenCanvas=r},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.BaseImageManipulator=void 0;const n="https://res.cloudinary.com/testim/image/upload/remote_media/";class r{static isMigratedCloudinaryUrl(t){return Boolean(t.match(/(cloudinary\.com).*test-projects-assets|test-result-assets/))}static isTestimImage(t){return/image\.testim\.io/.test(t)}static getImageName(t){var e,a,n,r;const i=(e=t.match("remote_media/.*"))===null||e===void 0?void 0:e.at(-1);const o=(a=t.match("test-result-artifacts/.*"))===null||a===void 0?void 0:a.at(-1);const s=(n=t.match("test-projects-artifacts/.*"))===null||n===void 0?void 0:n.at(-1);const c=(r=t.match("media_by_project/.*"))===null||r===void 0?void 0:r.at(-1);return i||c||o||s||t.split("/").at(-1)}_getBaseUrl(t){return t.replace(new RegExp(`${r.getImageName(t)}$`),"")}static convertStorageToCloudinaryUrl(t){return r.isTestimImage(t)?n+r.getImageName(t):t}_cloudinaryRectangle(t){return`x_${t.left},y_${t.top},w_${t.width},h_${t.height}`}_cloudinarySize(t){return`w_${t.width},h_${t.height}`}_roundRectangleSize(t){if(!t){return null}return{top:Math.round(t.top),left:Math.round(t.left),width:Math.round(t.width),height:Math.round(t.height),pixelRatio:t.pixelRatio}}_createRectangleFromCenterAndSize(t,e,a){return{left:Math.round(t.x-a*e.width/2),top:Math.round(t.y-a*e.height/2),width:Math.round(e.width*a),height:Math.round(e.height*a)}}_createCenteredRectangle(t,e,a){return{left:Math.round(Math.max(t.left+.5*(t.width-e),0)),top:Math.round(Math.max(t.top+.5*(t.height-a),0)),width:Math.round(e),height:Math.round(a)}}_scaleRectangle(t,e){return this._createCenteredRectangle(t,t.width*e,t.height*e)}isCloudinaryImage(t){return/res\.cloudinary\.com/.test(t)}replaceWithJpeg(t){if(r.isMigratedCloudinaryUrl(t)){return t}t=r.convertStorageToCloudinaryUrl(t);return`${t.match(/^(.*)(\..*)$/)[1]}.jpg`}}e.BaseImageManipulator=r},function(t,e,a){"use strict";function n(t){return!!t&&(typeof t==="object"||typeof t==="function")&&typeof t.then==="function"}function r(t){function e(t,e,a,n){function r(e){if(typeof self.postMessage!=="function"){t.ports[0].postMessage(e)}else{self.postMessage(e)}}if(a){if(typeof console!=="undefined"&&"error"in console){console.error("Worker caught an error:",a)}r([e,{message:a.message}])}else{r([e,null,n])}}function a(t,e){try{return{res:t(e)}}catch(t){return{err:t}}}function r(t,r,i,o){var s=a(r,o);if(s.err){e(t,i,s.err)}else if(!n(s.res)){e(t,i,null,s.res)}else{s.res.then((function(a){e(t,i,null,a)}),(function(a){e(t,i,a)}))}}function i(a){var n=a.data;if(!Array.isArray(n)||n.length!==2){return}var i=n[0];var o=n[1];if(typeof t!=="function"){e(a,i,new Error("Please pass a function into register()."))}else{r(a,t,i,o)}}self.addEventListener("message",i)}t.exports=r}]);