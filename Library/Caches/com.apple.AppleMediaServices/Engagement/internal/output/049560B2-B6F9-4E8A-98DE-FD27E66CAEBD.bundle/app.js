(()=>{function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{}};return t[i].call(o.exports,o,o.exports,e),o.exports}var t={1169:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9010:(e,t)=>{function n(e,n){return{actionClass:t.badgingActionClass,topic:e,...n}}var i;Object.defineProperty(t,"__esModule",{value:!0}),t.createBadgingActionForTopic=t.createBadgingAction=t.BadgeClientIdentifier=t.badgingActionClass=void 0,t.badgingActionClass="BadgingAction",function(e){e[e.appStore=0]="appStore",e[e.news=1]="news"}(i=t.BadgeClientIdentifier||(t.BadgeClientIdentifier={})),t.createBadgingAction=function(e,t){return n(function(e){switch(e){case i.appStore:return{topic:"com.apple.AppStore"};case i.news:return{topic:"com.apple.news"};default:return{topic:""}}}(e).topic,t)},t.createBadgingActionForTopic=n},1542:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCacheDataAction=t.cacheDataActionClass=void 0,t.cacheDataActionClass="CacheDataAction",t.createCacheDataAction=function(e,n,i,o){return{actionClass:t.cacheDataActionClass,data:e,duration:o,filter:n,key:i}}},5350:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCarrierOfferRegistrationAction=t.carrierOfferRegistrationActionClass=void 0,t.carrierOfferRegistrationActionClass="CarrierOfferRegistrationAction",t.createCarrierOfferRegistrationAction=function(e={}){return{actionClass:t.carrierOfferRegistrationActionClass,throttleInterval:e.throttleInterval}}},8538:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createEnqueueAction=t.enqueueActionClass=void 0,t.enqueueActionClass="EnqueueAction",t.createEnqueueAction=function(e,n){return{actionClass:t.enqueueActionClass,events:e,schedule:null==n?void 0:n.schedule}}},5855:(e,t)=>{function n(e,n){const i=n;let o=!1;return"iOS"===host.platform?o=!host.isOSAtLeast(16,2,0):"macOS"===host.platform?o=!host.isOSAtLeast(13,1,0):"tvOS"===host.platform?o=!host.isOSAtLeast(16,2,0):"watchOS"===host.platform&&(o=!host.isOSAtLeast(9,2,0)),o&&"string"==typeof i.accountDSID&&(i.accountDSID=Number(i.accountDSID)),{actionClass:t.followUpNotificationActionClass,identifier:e,data:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.createFollowUpNotificationActionWithNativeContent=t.createFollowUpNotificationAction=t.followUpNotificationActionClass=void 0,t.followUpNotificationActionClass="FollowUpNotificationAction",t.createFollowUpNotificationAction=function(e,t){var i,o;const s=[];return null===(i=t.actions)||void 0===i||i.forEach((e=>{s.push({clientActionDeepLink:e.clientActionDeepLink,financeLink:e.financeURL,metrics:e.metrics,serverActionUrl:e.request,clear:e.shouldClear,title:e.title})})),n(e,{actions:s,clear:t.shouldClear,expirationDate:t.expirationDate,deviceGroup:t.deviceGroup,disableGrouping:!t.deviceGroup,footer:t.footer,hardwareOffer:t.isHardwareOffer,iconImageName:t.iconImageName,metrics:t.metrics,notification:t.shouldPostNotification,omitBadge:t.shouldOmitBadge,text:t.informativeText,title:t.title,zeroAction:t.zeroAction,priority:null!==(o=t.priority)&&void 0!==o?o:0,accountDSID:t.accountDSID})},t.createFollowUpNotificationActionWithNativeContent=n},3870:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(9010),t),o(n(1542),t),o(n(5350),t),o(n(8538),t),o(n(5855),t),o(n(5908),t),o(n(168),t),o(n(5984),t),o(n(447),t),o(n(714),t)},5908:(e,t)=>{var n,i,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageAction=t.PlacementActionType=t.ActionStyle=t.MessageImageStyle=t.MessageStyle=t.messageActionClass=void 0,t.messageActionClass="MessageAction",(s=t.MessageStyle||(t.MessageStyle={}))[s.default=0]="default",s[s.alert=1]="alert",s[s.sheet=2]="sheet",s[s.banner=3]="banner",s[s.bubbleTip=4]="bubbleTip",s[s.toast=5]="toast",s[s.dashboard=6]="dashboard",s[s.account=7]="account",s[s.bubbleTipCompact=8]="bubbleTipCompact",(o=t.MessageImageStyle||(t.MessageImageStyle={}))[o.automatic=0]="automatic",o[o.image=1]="image",o[o.artwork=2]="artwork",(i=t.ActionStyle||(t.ActionStyle={}))[i.default=0]="default",i[i.destructive=1]="destructive",i[i.cancel=2]="cancel",(n=t.PlacementActionType||(t.PlacementActionType={})).present="present",n.dismiss="dismiss",t.createMessageAction=function(e,n){return{actionClass:t.messageActionClass,serviceType:e,dialogRequest:null==n?void 0:n.dialogRequest,engagementRequest:null==n?void 0:n.engagementRequest,placements:null==n?void 0:n.placements}}},168:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOpenURLAction=t.deepLinkActionClass=void 0,t.deepLinkActionClass="DeepLinkAction",t.createOpenURLAction=function(e){return{actionClass:t.deepLinkActionClass,url:e}}},5984:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSyncAction=t.syncActionClass=void 0,t.syncActionClass="SyncAction",t.createSyncAction=function(e){return{actionClass:t.syncActionClass,context:null==e?void 0:e.context,schedule:null==e?void 0:e.schedule}}},447:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSystemEngagementAction=t.systemEngagementActionClass=void 0,t.systemEngagementActionClass="SystemEngagementAction",t.createSystemEngagementAction=function(e,n){return{actionClass:t.systemEngagementActionClass,request:e,account:null==n?void 0:n.account}}},714:(e,t)=>{var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.createUserNotificationAction=t.UserNotificationInterruptionLevel=t.UserNotificationClientId=t.userNotificationActionClass=void 0,t.userNotificationActionClass="UserNotificationAction",function(e){e[e.applemediaservices=0]="applemediaservices",e[e.appstore=1]="appstore",e[e.fitness=2]="fitness",e[e.ibooks=3]="ibooks",e[e.itunesstore=4]="itunesstore",e[e.music=5]="music",e[e.tv=6]="tv",e[e.news=7]="news",e[e.podcasts=8]="podcasts",e[e.wallet=9]="wallet"}(n=t.UserNotificationClientId||(t.UserNotificationClientId={})),(i=t.UserNotificationInterruptionLevel||(t.UserNotificationInterruptionLevel={}))[i.passive=0]="passive",i[i.active=1]="active",i[i.timeSensitive=2]="timeSensitive",i[i.critical=3]="critical",t.createUserNotificationAction=function(e,i){var o,s;const a=[];null===(o=i.buttons)||void 0===o||o.forEach((e=>{var t,n,i;a.push({_id:e.id,_gl:e.systemImageName,_mt:e.metrics,_rb:null===(t=e.request)||void 0===t?void 0:t.body,_rm:null===(n=e.request)||void 0===n?void 0:n.method,_ru:null===(i=e.request)||void 0===i?void 0:i.url,_tl:e.title,_url:e.url,_tp:e.defaultButton})}));const r=function(e){switch(e){case n.applemediaservices:return{bundleID:"com.apple.AppleMediaServicesUI.engagement.notifications",extensionID:"ams-notifications-extension"};case n.appstore:return{bundleID:"com.apple.AppStore",extensionID:"asd-notification-default"};case n.fitness:return{bundleID:"com.apple.Fitness",extensionID:"fitcored-engagement-category"};case n.ibooks:return{bundleID:"macos"===host.platform.toString()?"com.apple.iBooksX":"com.apple.iBooks",extensionID:"books-notification-extension"};case n.itunesstore:return{bundleID:"com.apple.MobileStore",extensionID:"mst-notification-category"};case n.music:return{bundleID:"com.apple.Music",extensionID:"music-notification-default"};case n.news:return{bundleID:"com.apple.news",extensionID:"extension-marketing"};case n.podcasts:return{bundleID:"com.apple.podcasts",extensionID:"com.apple.podcasts.announcement"};case n.tv:return{bundleID:"com.apple.tv",extensionID:"com.apple.tv-default"};case n.wallet:return{bundleID:"com.apple.Passbook",extensionID:"com.apple.passkit.engagement-notification-extension"};default:return{bundleID:"",extensionID:""}}}(e);return{actionClass:t.userNotificationActionClass,bundleID:r.bundleID,data:{_au:i.artworkURL,_ba:a,_del:i.delete,_delAll:i.deleteAll,_ex:i.explicit,_id:i.id,_mt:i.metrics,_ss:i.subsections,_vu:i.videoURL,alert:{body:i.message,level:i.interruptionLevel,title:i.title,subtitle:i.subtitle},category:r.extensionID,_an:null!==(s=i.anonymous)&&void 0!==s&&s}}}},5375:(e,t)=>{t.mS=void 0,new RegExp("#?([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])([0-9,a-f,A-F][0-9,a-f,A-F])"),t.mS=function(e){return{name:e,type:"named"}}},1470:(e,t,n)=>{t.wW=void 0;const i=n(2450),o=n(8890),s=n(9541),a=n(1917),r=n(3107);t.wW=function(e,t,n,c){const u=e.attributes.engagementArtwork,l=e.attributes.engagementAnimation;return 0!==Object.keys(u).length&&!host.deviceModel.includes("Simulator")&&("iOS"===host.platform&&host.isOSAtLeast(15,5,0)||"macOS"===host.platform&&(host.isOSAtLeast(13,2,0)||host.isOSAtLeast(12,4,0)&&!host.isOSAtLeast(13,0,0))||(0,r.isUnknownPlatform)()||((0,o.logInfo)("Unsupported build for artwork caching."),0))?e=function(e,t,n,i,c){const u=(0,r.getSizeClass)(),l={};return Object.keys(t).filter((e=>function(e,t){return!(e.includes("light")||(t!==r.SizeClass.small||!e.includes("Compact"))&&(t!==r.SizeClass.medium||!e.includes("Tall"))&&(t!==r.SizeClass.large||!e.includes("FullScreen")))}(e,u))).forEach((e=>{try{AMS.log.default("Caching artwork for: "+e),l[e]=t[e];const r=`${t[e].url.substring(0,t[e].url.lastIndexOf("/"))}/${t[e].width}x${t[e].height}.heic`,u=`${i}:${e}`,d=(0,a.makeContentURI)(n,u,t[e].url,r,c);if((0,o.logDebug)("Generated cached url: "+d),l[e].url=d,(0,a.extendContentLifeIfNeeded)(u,c))return void(0,o.logInfo)(`Content for cacheKey ${u} already exists`);{(0,o.logInfo)(`Content for cacheKey ${u} does not exist. Requesting to cache content.`),(0,o.logInfo)(`Making url with fields: ${r}`);const e={url:r,method:s.Method.get};AMS.content.download(u,c,e,{onTimeout:!0})}}catch(t){AMS.log.error(`Failed to cache ${e} image for engagement item: ${t}`)}})),Object.keys(l).forEach((t=>{e.attributes.engagementArtwork[t]=l[t]})),e}(e,u,t,n,c):!(0,i.isNothing)(l)&&0!==Object.keys(l).length&&("iOS"===host.platform&&host.isOSAtLeast(17,0,0)||((0,o.logInfo)("Unsupported build for animation caching."),0))?e=function(e,t,n,r,c){const u={};return Object.keys(t).forEach((e=>{try{AMS.log.default("Caching animation for: "+e),u[e]=t[e];const i=`${r}:${e}`,l=(0,a.makeContentURI)(n,i,t[e].url,t[e].url,c);if((0,o.logDebug)("Generated cached url: "+l),u[e].url=l,(0,a.extendContentLifeIfNeeded)(i,c))return void(0,o.logInfo)(`Content for cacheKey ${i} already exists`);{(0,o.logInfo)(`Content for cacheKey ${i} does not exist. Requesting to cache content.`);const n={url:t[e].url,method:s.Method.get};AMS.content.download(i,c,n,{onTimeout:!0})}}catch(t){AMS.log.error(`Failed to cache ${e} animation for engagement item: ${t}`)}})),Object.keys(u).forEach((t=>{(0,i.isNothing)(e.attributes.engagementAnimation)||(e.attributes.engagementAnimation[t]=u[t])})),e}(e,l,t,n,c):(AMS.log.default("Returning original engagement item."),e)}},1476:(e,t)=>{var n,i,o,s;t.GL=t.W=t.AA=t.UW=void 0,(s=t.UW||(t.UW={}))[s.other=0]="other",s[s.music=1]="music",s[s.tv=2]="tv",s[s.arcade=3]="arcade",s[s.fitness=4]="fitness",s[s.appstore=5]="appstore",s[s.podcasts=6]="podcasts",s[s.books=7]="books",s[s.news=8]="news",s[s.icloud=9]="icloud",s[s.wallet=10]="wallet",(o=t.AA||(t.AA={}))[o.automatic=0]="automatic",o[o.dynamic=1]="dynamic",o[o.web=2]="web",(i=t.W||(t.W={})).automatic="automatic",i.formSheet="formSheet",i.fullScreen="fullScreen",i.pageSheet="pageSheet",i.proxCard="proxCard",i.proxCardLarge="proxCardLarge",(n=t.GL||(t.GL={})).analytics="analytics",n.internal="internal",n.journeys="journeys",n.recommendations="recommendations"},4331:(e,t)=>{var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.makeSystemImageURL=t.ImageSymbolConfigurationStyle=t.ImageRenderingMode=t.systemImageScheme=void 0,t.systemImageScheme="systemimage",(i=t.ImageRenderingMode||(t.ImageRenderingMode={}))[i.automatic=0]="automatic",i[i.alwaysOriginal=1]="alwaysOriginal",i[i.alwaysTemplate=2]="alwaysTemplate",(n=t.ImageSymbolConfigurationStyle||(t.ImageSymbolConfigurationStyle={})).hierarchical="hierarchical",n.monochrome="monochrome",n.multicolor="multicolor",n.palette="palette",t.makeSystemImageURL=function(e,n){let i=t.systemImageScheme+"://"+e;return void 0!==(null==n?void 0:n.variableValue)&&(i+=`?variableValue=${n.variableValue.toString()}`),i.toString()}},3508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createURL=void 0,t.createURL=function(e){const t=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?"),n=e.match(t);return n?{url:e,scheme:n.length>1?n[1]:void 0,host:n.length>2?n[2]:void 0,path:n.length>3?n[3]:void 0,query:n.length>4?n[4]:void 0,fragment:n.length>5?n[5]:void 0}:{url:e}}},1846:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAccountChangedEvent=t.accountChangedEventType=void 0,t.accountChangedEventType="AccountChanged",t.isAccountChangedEvent=function(e){return e.eventType===t.accountChangedEventType}},3368:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isContentFailedEvent=t.isContentAvailableEvent=t.contentFailedEventType=t.contentAvailableEventType=void 0,t.contentAvailableEventType="ContentAvailable",t.contentFailedEventType="ContentFailed",t.isContentAvailableEvent=function(e){return e.eventType===t.contentAvailableEventType},t.isContentFailedEvent=function(e){return e.eventType===t.contentFailedEventType}},4094:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9550:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(3386),t),o(n(3368),t),o(n(4094),t),o(n(4126),t),o(n(4668),t),o(n(8064),t)},4126:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMessageRequestEvent=t.messageRequestEventType=void 0,t.messageRequestEventType="MessageRequest",t.isMessageRequestEvent=function(e){return e.eventType===t.messageRequestEventType}},4668:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.isSubscriptionChangedEvent=t.SubscriptionChangedSegment=t.subscriptionChangedEventType=void 0,t.subscriptionChangedEventType="SubscriptionChanged",(n=t.SubscriptionChangedSegment||(t.SubscriptionChangedSegment={}))[n.news=0]="news",n[n.appStore=1]="appStore",n[n.activity=2]="activity",n[n.music=3]="music",n[n.tv=4]="tv",n[n.icloud=5]="icloud",n[n.podcast=6]="podcast",t.isSubscriptionChangedEvent=function(e){return e.eventType===t.subscriptionChangedEventType}},8064:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUbiquitousStoreChangedEvent=t.ubiquitousStoreChangedEventType=void 0,t.ubiquitousStoreChangedEventType="UbiqutiousStoreChanged",t.isUbiquitousStoreChangedEvent=function(e){return e.eventType===t.ubiquitousStoreChangedEventType}},9089:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.exportEngagementService=t.actions=void 0,o(n(1169),t),t.actions=n(3870),o(n(1846),t),o(n(9550),t),o(n(8890),t),o(n(9615),t),t.exportEngagementService=function(e){exportService("EngagementService",e)}},6059:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.AccountMediaType=void 0,(n=t.AccountMediaType||(t.AccountMediaType={}))[n.appStore=100]="appStore",n[n.appStoreBeta=101]="appStoreBeta",n[n.appStoreSandbox=102]="appStoreSandbox",n[n.books=200]="books",n[n.iTunes=300]="iTunes",n[n.production=400]="production"},7776:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4056:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.PredicateType=void 0,(n=t.PredicateType||(t.PredicateType={})).and="and",n.app="app",n.greaterThan="greaterThan",n.lessThan="lessThan",n.like="like",n.or="or"},7090:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9541:(e,t)=>{var n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.getContentInfo=t.isContentFinishedEvent=t.Method=t.ContentState=void 0,(i=t.ContentState||(t.ContentState={}))[i.unknown=0]="unknown",i[i.downloading=1]="downloading",i[i.available=2]="available",(n=t.Method||(t.Method={})).delete="DELETE",n.get="GET",n.head="HEAD",n.options="OPTIONS",n.patch="PATCH",n.post="POST",n.put="PUT",n.trace="TRACE",n.update="UPDATE",t.isContentFinishedEvent=function(e){const t=e;return"ContentAvailable"===t.eventType&&"amsengagementd"===t.source},t.getContentInfo=function(e,t){let n=!1;switch(host.platform){case"iOS":case"tvOS":n=!host.isOSAtLeast(16,4,0);break;case"macOS":n=!host.isOSAtLeast(13,3,0);break;case"watchOS":n=!host.isOSAtLeast(9,4,0)}return n?AMS.content.info(e,null==t?void 0:t.version):AMS.content.info(e,t)}},7837:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6946:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},7839:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9169:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.FamilyEligibility=void 0,(n=t.FamilyEligibility||(t.FamilyEligibility={}))[n.unknown=0]="unknown",n[n.ineligible=1]="ineligible",n[n.eligible=2]="eligible"},9971:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8890:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(6059),t),o(n(7776),t),o(n(4056),t),o(n(7090),t),o(n(9541),t),o(n(7837),t),o(n(6946),t),o(n(7839),t),o(n(9169),t),o(n(9971),t),o(n(5069),t),o(n(5643),t),o(n(6091),t),o(n(721),t),o(n(73),t),o(n(4028),t),o(n(93),t),o(n(9681),t),o(n(8110),t),o(n(3049),t)},5069:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5643:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.LocationAuthorizationStatus=void 0,(n=t.LocationAuthorizationStatus||(t.LocationAuthorizationStatus={}))[n.notDetermined=0]="notDetermined",n[n.restricted=1]="restricted",n[n.denied=2]="denied",n[n.authorized=3]="authorized",n[n.authorizedWhenInUse=4]="authorizedWhenInUse"},6091:(e,t)=>{function n(){let e=!1;return"iOS"===host.platform?e=host.isOSAtLeast(16,0,0):"macOS"===host.platform?e=host.isOSAtLeast(13,0,0):"tvOS"===host.platform?e=host.isOSAtLeast(16,0,0):"watchOS"===host.platform&&(e=host.isOSAtLeast(9,0,0)),e}Object.defineProperty(t,"__esModule",{value:!0}),t.logInfo=t.logError=t.logDebug=t.logDefault=void 0,t.logDefault=function(e){AMS.log.default(e)},t.logDebug=function(e){n()?AMS.log.debug(e):AMS.log.default(e)},t.logError=function(e){AMS.log.error(e)},t.logInfo=function(e){n()?AMS.log.info(e):AMS.log.default(e)}},721:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.MediaType=void 0,(n=t.MediaType||(t.MediaType={}))[n.app=0]="app",n[n.appBundle=1]="appBundle",n[n.inApp=2]="inApp",n[n.arcadeApp=3]="arcadeApp",n[n.appRecommendation=4]="appRecommendation",n[n.audioBook=100]="audioBook",n[n.book=101]="book",n[n.bookSeries=102]="bookSeries",n[n.album=200]="album",n[n.musicVideo=201]="musicVideo",n[n.playlist=202]="playlist",n[n.song=203]="song",n[n.station=204]="station",n[n.podcast=300]="podcast",n[n.podcastEpisode=301]="podcastEpisode"},73:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.enqueue=void 0,t.enqueue=function(e){AMS.metrics.enqueue(e.topic,{...e.fields,clientOnlyProperties:{checkDU:e.checkDU,suppressEngagement:!0}},{personalized:e.personalized})}},4028:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},93:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ServerDataCacheNetworkPolicy=void 0,(n=t.ServerDataCacheNetworkPolicy||(t.ServerDataCacheNetworkPolicy={}))[n.returnCachedDataDontLoad=0]="returnCachedDataDontLoad",n[n.returnValidCachedDataDontLoad=1]="returnValidCachedDataDontLoad",n[n.returnCachedDataElseLoadFallbackCached=2]="returnCachedDataElseLoadFallbackCached",n[n.returnCachedDataElseLoadFallbackNone=3]="returnCachedDataElseLoadFallbackNone"},9681:(e,t)=>{var n,i,o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.lookUpSubscriptionStatus=t.SubscriptionResponseCarrierStatus=t.SubscriptionResponseStatus=t.SubscriptionResponseSource=t.SubscriptionMediaType=void 0,function(e){e[e.activity=0]="activity",e[e.appStore=1]="appStore",e[e.music=2]="music",e[e.news=3]="news",e[e.tv=4]="tv",e[e.icloud=5]="icloud",e[e.podcast=6]="podcast"}(n=t.SubscriptionMediaType||(t.SubscriptionMediaType={})),(s=t.SubscriptionResponseSource||(t.SubscriptionResponseSource={}))[s.unknown=0]="unknown",s[s.apple=1]="apple",s[s.carrier=2]="carrier",function(e){e[e.notEntitled=0]="notEntitled",e[e.entitled=1]="entitled"}(i=t.SubscriptionResponseStatus||(t.SubscriptionResponseStatus={})),(o=t.SubscriptionResponseCarrierStatus||(t.SubscriptionResponseCarrierStatus={}))[o.unknown=0]="unknown",o[o.eligible=1]="eligible",o[o.notEligible=2]="notEligible",o[o.requiresVerification=3]="requiresVerification",o[o.unlinked=4]="unlinked",t.lookUpSubscriptionStatus=async function(e){let t=await AMS.subscription.lookup(e),o=!1;if(e.type!==n.music)switch(AMS.log.debug("Attempting to correct subscription entitlement status"),host.platform){case"iOS":case"tvOS":o=!host.isOSAtLeast(16,3,0);break;case"macOS":o=!host.isOSAtLeast(13,2,0);break;case"watchOS":o=!host.isOSAtLeast(9,3,0)}return o&&(t=function(e){const t=e;return Object.keys(t.entitlements).forEach((e=>{const n=t.entitlements[e],o=new Date(0);o.setUTCSeconds(n.expiration),o<new Date&&(n.status=i.notEntitled)})),t}(t)),t}},8110:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Bucket=void 0,(n=t.Bucket||(t.Bucket={}))[n.explicit=-1]="explicit",n[n.implicit=-2]="implicit"},3049:(e,t)=>{var n,i,o,s,a,r;Object.defineProperty(t,"__esModule",{value:!0}),t.ShowPreviewsSetting=t.NotificationSetting=t.NotificationGroupingSetting=t.ExplicitContentSetting=t.AuthorizationStatus=t.AlertStyle=void 0,(r=t.AlertStyle||(t.AlertStyle={}))[r.none=0]="none",r[r.banner=1]="banner",r[r.alert=2]="alert",(a=t.AuthorizationStatus||(t.AuthorizationStatus={}))[a.notDetermined=0]="notDetermined",a[a.denied=1]="denied",a[a.authorized=2]="authorized",a[a.provisional=3]="provisional",a[a.ephemeral=4]="ephemeral",(s=t.ExplicitContentSetting||(t.ExplicitContentSetting={}))[s.unknown=-1]="unknown",s[s.disabled=0]="disabled",s[s.enabled=1]="enabled",(o=t.NotificationGroupingSetting||(t.NotificationGroupingSetting={}))[o.default=0]="default",o[o.source=1]="source",o[o.off=2]="off",(i=t.NotificationSetting||(t.NotificationSetting={}))[i.notSupported=0]="notSupported",i[i.disabled=1]="disabled",i[i.enabled=2]="enabled",(n=t.ShowPreviewsSetting||(t.ShowPreviewsSetting={}))[n.always=0]="always",n[n.whenAuthenticated=1]="whenAuthenticated",n[n.never=2]="never"},9615:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EventComponents=void 0,(n=t.EventComponents||(t.EventComponents={}))[n.none=0]="none",n[n.app=1]="app",n[n.backlog=2]="backlog",n[n.all=3]="all"},1917:(e,t,n)=>{function i(e,t,n,i,o){let s=`amsc://?app=${e}&version=${o}&cacheKey=${t}&fallbackURL=${encodeURIComponent(n)}`;const a=(0,r.createURL)(i);if(void 0!==a.path){const e=a.path.split("/").reverse()[0].split(".");e.length>1&&(e.reverse(),s+=`&contentExtension=${e[0]}`)}return s}function o(e,t){const n=(0,c.getContentInfo)(e,{version:t});if(!(0,s.isNothing)(n)){const i=n[t];if(null!=i&&i.state===c.ContentState.available){const n=432e6,o=i.expires,s=new Date(0);return s.setUTCMilliseconds(o),s.getTime()-(new Date).getTime()<=n&&(AMS.log.default(`Extending cache content (cacheKey: ${e},version: ${t})`),AMS.content.extend(e,{version:t})),!0}}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.extendContentLifeIfNeeded=t.makeContentURI=t.cacheMessageRequestContent=void 0;const s=n(2450),a=n(4331),r=n(3508),c=n(8890);t.cacheMessageRequestContent=function(e,t,n,s){if(void 0===n.iconURL)return n;if((0,r.createURL)(n.iconURL).scheme===a.systemImageScheme)return n;const u=n;if(u.iconURL=i(e,t,encodeURIComponent(n.iconURL),n.iconURL,s),o(t,s))AMS.log.default(`Content for cacheKey ${t} already exists`);else{AMS.log.default(`Content for cacheKey ${t} does not exist. Requesting to cache content.`);const e={url:n.iconURL,method:c.Method.get};AMS.content.download(t,s,e,{onTimeout:!0})}return u},t.makeContentURI=i,t.extendContentLifeIfNeeded=o},3107:(e,t)=>{function n(){return!("iPod touch"!==r&&!a.includes(c))}function i(){switch(r){case"iPhone":case"iPod touch":case"iPhone Simulator":return!0;default:return!1}}var o,s;Object.defineProperty(t,"__esModule",{value:!0}),t.isUnknownPlatform=t.isPhone=t.isCompactPhone=t.getSizeClass=t.SizeClass=void 0;const a=["iPhone8,1","iPhone8,2","iPhone8,4","iPhone9,1","iPhone9,2","iPhone9,3","iPhone9,4","iPhone10,1","iPhone10,2","iPhone10,4","iPhone10,5","iPhone12,8"],r=host.deviceModel,c=null!==(o=host.devicePhysicalModel)&&void 0!==o?o:"unknown",u=host.platform;!function(e){e.small="small",e.medium="medium",e.large="large"}(s=t.SizeClass||(t.SizeClass={})),t.getSizeClass=function(){return i()?n()?s.small:s.medium:s.large},t.isCompactPhone=n,t.isPhone=i,t.isUnknownPlatform=function(){return"macOS"!==u&&"iOS"!==u&&"watchOS"!==u&&"tvOS"!==u}},5542:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(1721),t),o(n(9031),t),o(n(1662),t),o(n(2024),t),o(n(2450),t)},1219:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8045:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9891:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1121:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1721:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof preprocessor&&(globalThis.preprocessor={PRODUCTION_BUILD:!1,CARRY_BUILD:!1,DEBUG_BUILD:!1,INTERNAL_BUILD:!1}),"undefined"==typeof testContent&&(globalThis.testContent={INCLUDE_TEST_CONTENT:!1}),o(n(1219),t),o(n(8045),t),o(n(9891),t),o(n(1121),t),o(n(3907),t),o(n(6534),t),o(n(5817),t),o(n(3043),t),o(n(5037),t),o(n(5937),t),o(n(1222),t)},3907:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},6534:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},3043:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5037:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5937:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1222:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.services=t.random=t.plist=t.platform=t.net=t.localizer=t.host=t.cryptography=t.bundle=t.bag=void 0;const i=n(900);t.bag=i.makeMetatype("jet-engine:bag"),t.bundle=i.makeMetatype("jet-engine:bundle"),t.cryptography=i.makeMetatype("jet-engine:cryptography"),t.host=i.makeMetatype("jet-engine:host"),t.localizer=i.makeMetatype("jet-engine:localizer"),t.net=i.makeMetatype("jet-engine:net"),t.platform=i.makeMetatype("jet-engine:platform"),t.plist=i.makeMetatype("jet-engine:plist"),t.random=i.makeMetatype("jet-engine:random"),t.services=i.makeMetatype("jet-engine:services")},2490:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9031:function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),o(n(2490),t)},1662:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.notInstrumented=t.PageInvocationPoint=t.EMPTY_LINTED_METRICS_EVENT=void 0,t.EMPTY_LINTED_METRICS_EVENT={fields:{},issues:[]},(n=t.PageInvocationPoint||(t.PageInvocationPoint={})).pageEnter="pageEnter",n.pageExit="pageExit",n.appExit="appExit",n.appEnter="appEnter",n.backButton="backButton",t.notInstrumented=function(e){switch(e){case 0:return{data:[],custom:{}};case 1:default:return{};case 2:return{instructions:[],custom:{}};case 3:return{id:{id:"",impressionIndex:NaN},fields:{},custom:{}}}}},2024:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},2450:(e,t)=>{function n(e){return null==e}function i(e){return null!=e}Object.defineProperty(t,"__esModule",{value:!0}),t.flatMapOptional=t.mapOptional=t.unsafeUnwrapOptional=t.unwrapOptional=t.isSome=t.isNothing=t.unsafeUninitialized=void 0,t.unsafeUninitialized=function(){},t.isNothing=n,t.isSome=i,t.unwrapOptional=function(e){if(n(e))throw new ReferenceError;return e},t.unsafeUnwrapOptional=function(e){return e},t.mapOptional=function(e,t){return i(e)?t(e):e},t.flatMapOptional=function(e,t){return i(e)?t(e):e}},900:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeMetatype=void 0,t.makeMetatype=function(e){return{name:e}}}},n={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{function t(e,t){var n;if(!xe){let e=AMS.database.create().result;xe=null!==(n=null==e?void 0:e.fetch(O.cachedBagValues))&&void 0!==n?n:{}}let i=xe[e];if(i)return i;let o="undefined"!=typeof bag?bag:null;return o?o[t](e):null}function n(e,n,s=null){var a,r,c;let u=o(e,null===(a=t(_.Language,k.String))||void 0===a?void 0:a.toLowerCase(),0);if(u||(u=o(e,null===(r=t(_.LanguageTag,k.String))||void 0===r?void 0:r.toLowerCase(),1)),u||(u=o(e,(null!==(c=AMS.client.locale)&&void 0!==c?c:"").replace("_","-").toLowerCase(),2)),u)return u;i("native",3);let l=n?AMS.localize.nativeString(n):null;return null!=l?l:s}function i(e,t){Ne!=e&&(Ne=e,AMS.log.default("Using language: "+e+" fallback: "+t))}function o(e,t,n){var o;let s=function(e,t,n){var i,o;let s=(null!==(o=(null!==(i=n.localizations)&&void 0!==i?i:{})[t])&&void 0!==o?o:{})[e],a=s&&s.startsWith("**")&&s.endsWith("**");return AMS.log.default(`Testing: ${e} Lang: ${t} Placeholder: ${a} Result: ${s}`),s&&!a?s:null}(e,t,null!==(o=function(){if(Le)return Le;let e=AMS.props;return Le=null!=e?e:{},Le}())&&void 0!==o?o:{});return s?(i(t,n),s):null}function s(){var e;let t=AMS.database.create().result;return null!==(e=null==t?void 0:t.fetch(O.messageOverrides))&&void 0!==e?e:{}}function a(e){AMS.database.create().result.set(O.messageOverrides,e)}function r(e,t){return{actions:[],data:{success:!1,data:{message:e,data:t}}}}function c(e,t){return{actions:e,data:{success:!0,data:t}}}function u(){return!0}function l(){return!0}function d(){return{title:"Billing Problem",subtitle:"To avoid interruptions to your subscriptions and purchases, update your payment method.",iconURL:"systemimage://exclamationmark.circle",style:w.MessageStyle.account,actions:[{deepLink:Re,style:w.ActionStyle.cancel},{deepLink:"https://finance-app.itunes.apple.com/account/manage-payments",style:w.ActionStyle.default,title:"Update Payment Method"}],appearance:{iconSymbolConfiguration:{style:I.ImageSymbolConfigurationStyle.palette,colors:[(0,j.mS)("red")]}}}}function p(){return{title:"Subscription Price Increase",subtitle:"If you don't agree to the new prices, your Apple TV+ subscription will end on December 31, 2021.",style:w.MessageStyle.account,iconURL:"systemimage://info.circle",actions:[{deepLink:Re,style:w.ActionStyle.cancel},{deepLink:"action://price.increase",style:w.ActionStyle.default,title:$}],appearance:{imageTintColor:(0,j.mS)("primaryText")}}}function m(){return!0}function v(){return!0}function f(e,t,n){AMS.log.default("Creating Engagement Item...");let i=function(e){var t;AMS.log.default("Fetching cached JSON for service: "+e);let n=AMS.database.create().result;return(null!==(t=null==n?void 0:n.fetch(O.cachedEngagementItems))&&void 0!==t?t:{})[e]||(AMS.log.default("Failed to fetch cached JSON for service: "+e),null)}(g(t));if(Array.isArray(i.attributes.actions)&&i.attributes.actions.length){AMS.log.default("Substituting task values for metrics overlay, authorization options, early dismissal, and bundle identifier.");const o=host.platform===Se;let s={kind:i.attributes.actions[0].kind,callToActionLabel:i.attributes.actions[0].callToActionLabel,dismissEarly:o,metricsOverlay:n,authorizationOptions:e,notificationBundleId:t,granularNotificationIds:i.attributes.actions[0].granularNotificationIds};i.attributes.actions[0]=s}return i}async function h(n,i){let o=function(n,i){let o=t(_.TCCEngagementItem,k.String),s="";e.g.host.platform===Se?s=ut:(0,U.isUnknownPlatform)()&&(s=dt);let a=`${o}${n}/${s}${e.g.host.platform===Ue&&e.g.host.isOSAtLeast(16,0,0)?"16/":""}${i}.json`;return(0,L.logDebug)("Using url: "+a),a}(n,i);AMS.log.default("Downloading JSON for service: "+n);const s={method:de,url:o.toString()},a=await net.fetch(s);if(200!==a.status||(0,P.isNothing)(a.body)){let e=`Failed to fetch engagementItem from url:${o.toString()}`;throw AMS.log.error(e),new Error(e)}let r=JSON.parse(a.body),c=await async function(e){let t=function(e){let t=host.platform===Se;switch(e){case we:return t?oe:Ie;case he:return se;case ge:return ae;case be:return t?re:ce;case Oe:return Me;case ye:return ue;default:return De}}(e);return AMS.userNotifications.getAuthorizationStatus(t)}(n);return c.authorizationStatus===L.AuthorizationStatus.notDetermined?(0,D.wW)(r.engagementItem,M.GL.internal,r.id,r.version+i):r.engagementItem}function g(e){switch(e){case Ie:case oe:return we;case se:return he;case ae:return ge;case ce:case re:return be;case Me:return Oe;case ue:return ye;default:return Oe}}function b(){return!0}function y(e,t){let n=!0;for(let i in t.filter){let o=e[i];if(!o){n=!1;break}let s=t.filter[i],a=s?new RegExp(s):null;if(!a){n=!1;break}if(!a.test(o)){n=!1;break}}return n}function S(e){return{data:{item:e}}}function A(){return!0}var M,w,O,_,k,T,j,I,D,P,U,C,R,x,L=e(9089);const N="command",E="xp_test2",B="https://podcasts.apple.com/us/podcast/planet-money/id290783428",q="LearnMore",F="link",$="Learn More",J="musicnotes",V="https://amsui.apple.com/dynamic/marketing#route=marketingItem&serviceType=arcade&placement=arcadeGeneric",z="testAccountMessage1",K="testAccountMessage2",G="testBanner1",Y="testBanner2",Z="testBubbleTipInline1",H="testBubbleTipInline2",W="testBubbleTipOverlay1",X="testBubbleTipOverlay2",Q="testToast1",ee="testToast2",te="testEngagementRequest1",ne="action://renew",ie="systemimage://note.text",oe="com.apple.TV",se="com.apple.Music",ae="com.apple.news",re="com.apple.iBooksX",ce="com.apple.iBooks",ue="com.apple.podcasts",le="https://amsui.apple.com/dynamic/marketing#route=engagementItem",de="GET",pe="ExternalLinkLaunch_Modal",me="ExternalLinkLaunch",ve="Modal",fe="Sheet",he="music",ge="news",be="books",ye="podcasts",Se="macOS",Ae="success",Me="com.apple.AppStore",we="appleTv",Oe="appStore",_e="MessageRequest",ke="xp_amp_appstore",Te="page",je="amsuid",Ie="com.apple.tv",De="unknown",Pe="options",Ue="iOS",Ce="Books User Notification Action",Re="action://close";M=e(1476),w=e(3870),(x=O||(O={})).cachedBagValues="cachedBagValues",x.cachedEngagementItems="cachedEngagementItems",x.messageOverrides="messageOverrides",(R=_||(_={})).Language="language",R.LanguageTag="language-tag",R.TCCEngagementItem="engagementItemTCCUrl",(C=k||(k={})).String="string",C.Url="url",C.Array="array",C.Boolean="boolean",C.Dictionary="dictionary",C.Number="number";let xe=null,Le=null,Ne="";const Ee="appstored",Be="Test whether user notifications presents correctly",qe="\n        Inspect the notification on the lock screen for:\n        1. It renders the title, subtitle and image icon in collapsed view\n        2. It renders title, subtitle, buttons and large image in expanded view\n        3. Tapping on a button dismisses the notification and launches the corresponding deep link",Fe=function(e){return(0,w.createUserNotificationAction)(e,{artworkURL:"https://images.defence.gov.au/fotoweb/cache/5003/DefenceImagery/2019/TS201907054/190714-N-CL027-1239.t5d2bb728.m2400.xMd45K38R.jpg",buttons:[{id:"buttonid-1",metrics:{topic:"xp_test1"},request:{body:'{"id": "{{followerSocialProfileId}}"}',method:"POST",url:"https://se2.itunes.apple.com/WebObjects/MZStoreElements2.woa/wa/followRequests"},title:"Open App Store",url:"itms-apps://"},{id:"buttonid-2",metrics:{topic:E},request:{method:de,url:"https://itun.es/YXKHhb?i=followerDsId"},title:"Open Podcast Show",url:B},{id:"buttonid-3",metrics:{topic:"xp_test3"},request:{method:de,url:"https://www.apple.com"},title:"Open Safari",url:"https://apple.com"},{id:"buttonid-4",url:B,defaultButton:!0}],explicit:!0,id:"ams_1234-1234-1234-1234",message:"This is a Test",metrics:{topic:E},title:"Test",videoURL:"https://www.apple.com/105/media/us/apple-arcade/2019/77394d94-8ea5-48ab-a9a5-6b79c141c58b/overview/trailers/thepathless/arcade-thepathless-tpl-cc-us-2019_1280x720h.mp4"})},$e="Test the subscription status for a given user",Je="\n        Inspect the response for subscription status and ensure that it matches the user's current state.",Ve=function(e){return(0,L.lookUpSubscriptionStatus)({type:e}).then((e=>{var t;let n=e;if(!n||0==n.length)return r("No Subscription Result (not subscribed)");let i=n[0];if(!i.serverResponse)return r("No Server Response",i);let o=Object.keys(null!==(t=i.entitlements)&&void 0!==t?t:{});return 0==o.length||i.entitlements[o[0]].status!=L.SubscriptionResponseStatus.entitled?r("Not Subscribed",i):c([],{response:i.serverResponse,appAdamId:i.appAdamId,appVersion:i.appVersion,entitlements:i.entitlements,message:"You Are Subscribed!"})})).catch((e=>r("Subscription Lookup Failed. (not subscribed)",e)))},ze="function"==typeof atob,Ke="function"==typeof Buffer,Ge="function"==typeof TextDecoder?new TextDecoder:void 0,Ye=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(("function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="))),Ze=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,He=String.fromCharCode.bind(String),We="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(e,t=(e=>e))=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),Xe=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),Qe=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,et=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return He(55296+(t>>>10))+He(56320+(1023&t));case 3:return He((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return He((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},tt=ze?e=>atob(Xe(e)):Ke?e=>Buffer.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!Ze.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,i,o="";for(let s=0;s<e.length;)t=Ye[e.charAt(s++)]<<18|Ye[e.charAt(s++)]<<12|(n=Ye[e.charAt(s++)])<<6|(i=Ye[e.charAt(s++)]),o+=64===n?He(t>>16&255):64===i?He(t>>16&255,t>>8&255):He(t>>16&255,t>>8&255,255&t);return o},nt=Ke?e=>We(Buffer.from(e,"base64")):e=>We(tt(e),(e=>e.charCodeAt(0))),it=Ke?e=>Buffer.from(e,"base64").toString("utf8"):Ge?e=>Ge.decode(nt(e)):e=>tt(e).replace(Qe,et);!function(e){e[e.default=0]="default",e[e.test=1]="test"}(T||(T={}));const ot={badge:function(){return{metadata:{title:"Badging Action",shortDescription:"Send test badging requests",instructions:"\n\tamstool engagement run badging <topic> <badge-id> <enabled>",showsUI:!1,type:T.default,minimumArgumentCount:2},run:async e=>{var t,n,i,o;const s=null!==(t=e[Pe])&&void 0!==t?t:[],a=s[0],r={badgeID:s[1],enabled:JSON.parse(null!==(n=s[2])&&void 0!==n?n:"true")};if(void 0!==s[3]){let e=s.length>1?s[3]:"{}",t=null!==(i=JSON.parse(e))&&void 0!==i?i:{};r.metricsEvent=t}if(void 0!==s[4]){let e=s.length>1?s[4]:"{}",t=null!==(o=JSON.parse(e))&&void 0!==o?o:{};r.actionMetricsEvent=t}return c([(0,w.createBadgingActionForTopic)(a,r)],void 0)}}},content:function(){return{metadata:{title:"Content Action",shortDescription:"Interact with engagement content manager",instructions:"amstool engagement run content <operation> <cache-id>",showsUI:!1,type:T.default,minimumArgumentCount:2},run:async e=>{var t;const n=null!==(t=e[Pe])&&void 0!==t?t:[],i=n[0],o=n[1],s=n[2];switch(i){case"download":AMS.log.default("Responding to download operation");const e={url:n[3],method:n[4]};return AMS.content.download(o,s,e,null),c([],{status:Ae});case"info":AMS.log.default(`Responding to info operation (cacheID: ${o}, version: ${s})`);const t=AMS.content.info(o,null);return c([],{status:Ae,content:t});case"remove":return AMS.log.default("Responding to remove operation"),AMS.content.remove(o),c([],{status:Ae});default:return r(`Unknown operation ${i}`,null)}}}},enqueueScheduled:function(){return{metadata:{title:"Schedule Enqueue Action",shortDescription:"Send enqueue requests",instructions:"\n\tamstool engagement run enqueueScheduled <event> <identifier> <delay>",showsUI:!1,type:T.default,minimumArgumentCount:3},run:async e=>{var t;const n=null!==(t=e[Pe])&&void 0!==t?t:[],i=JSON.parse(n[0]),o=n[1],s=JSON.parse(n[2]);if(void 0===o)return r("Missing identifier");if(void 0===s)return r("Missing delay");const a={delay:s,identifier:o,grace:0};return c([(0,w.createEnqueueAction)([i],{schedule:a})],void 0)}}},extension:function(){return{metadata:{title:"Extension Action",shortDescription:"Test responses from extensions/plugins",instructions:"\n\tamstool engagement run extension <extension-id> [<json-string-data>]",showsUI:!1,type:T.default,minimumArgumentCount:1},run:async e=>{var t,n;const i=null!==(t=e[Pe])&&void 0!==t?t:[];let o=i.length>0?i[0]:null;if(!o)return Promise.reject("No extension id provided");let s=i.length>1?i[1]:"{}",a=null!==(n=JSON.parse(s))&&void 0!==n?n:{};try{return c([],await AMS.plugin.request(o,a))}catch(e){return r("Error: "+JSON.stringify(e))}}}},messageOverride:function(){return{metadata:{title:"Message Override Command",shortDescription:"Override unified messages",instructions:"\n\tamstool engagement run messageOverride <serviceType> <placement> <placement-json>\n\n\t\t--clear to clear overrides",showsUI:!1,type:T.default,minimumArgumentCount:0},run:async e=>{var t,n,i,o;let u=null!==(t=e[Pe])&&void 0!==t?t:[];if(0==u.length)return c([],s());{let e=!1,t=!1,l=!1,d=!1,p=[];for(o of u)"--clear"==o?(AMS.log.default("Clearing overrides"),a(null),d=!0):"--open"==o?l=!0:"--item"==o?t=!0:"--base64"==o?e=!0:p.push(o);let m,v=p.length>0?p[0]:null,f=p.length>1?p[1]:null,h=p.length>2?p[2]:null;if(AMS.log.default("Args: "+p),e&&h&&(h=it(Xe(h.replace(/[-_]/g,(e=>"-"==e?"+":"/"))))),h&&(m=JSON.parse(h),t&&m&&(m={action:"present",engagementRequest:{url:le,clientData:{engagementItem:m}}})),null==v||null==f)return d?c([],{message:"Messages cleared"}):r("Error: missing serviceType or placement");let g={},b=[];if(null==m){AMS.log.default("Clearing overrides. "+v+" "+f);let e=s(),t=null!==(n=e[v])&&void 0!==n?n:{};t[f]=void 0,e[v]=t,a(e),g=e}else if(l){AMS.log.default("Test 1");let e=m.engagementRequest;if(AMS.log.default("Opening request..."+e),!e)return r("Invalid request");b.push((0,w.createSystemEngagementAction)({url:e.url,clientData:e.clientData}))}else{AMS.log.default("Setting overrides");let e=s(),t=null!==(i=e[v])&&void 0!==i?i:{};t[f]=m,e[v]=t,a(e),g=e}return c(b,g)}}}},schedule:function(){return{metadata:{title:"Schedule Action",shortDescription:"Run schedule requests",instructions:"\n\tamstool engagement run schedule command",showsUI:!1,type:T.default,minimumArgumentCount:2},run:async e=>{var t;const n=null!==(t=e[Pe])&&void 0!==t?t:[],i=n[0],o=AMS.database.scheduleDatabase().result;if(void 0===o)return r("Failed to fetch schedule database");if("fetch"===i){const e=n[1];return c([],o.fetch(e))}if("fetchSchedules"===i){const e=n.slice(1,n.length);return c([],o.fetchSchedules(e))}if("fetchIdentifiersMatching"===i){const e=n[1];return c([],o.fetchIdentifiersMatching(e))}if("removeIdentifiers"===i){const e=n.slice(1,n.length);return o.removeIdentifiers(e),c([],void 0)}return r("invalid command")}}},subscription:function(){return{metadata:{title:"Subscription Action",shortDescription:"View subscription entitlement data",instructions:"amstool engagement run subscription <media-type>",showsUI:!1,type:T.default,minimumArgumentCount:1},run:async e=>{var t;const n=(null!==(t=e[Pe])&&void 0!==t?t:[])[0],i={type:parseInt(n)},o=await(0,L.lookUpSubscriptionStatus)(i);return c([],{status:Ae,result:o})}}},userNotificationAppStore:function(){return{metadata:{title:"App Store User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.appstore)])}},userNotificationBooks:function(){return{metadata:{title:Ce,shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.ibooks)])}},userNotificationMobileStore:function(){return{metadata:{title:"Mobile Store User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.itunesstore)])}},userNotificationMusic:function(){return{metadata:{title:"Music User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.music)])}},userNotificationNews:function(){return{metadata:{title:"News User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.news)])}},userNotificationPodcasts:function(){return{metadata:{title:"Podcasts User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.podcasts)])}},userNotificationTV:function(){return{metadata:{title:"TV User Notification Action",shortDescription:Be,instructions:qe,showsUI:!0,type:T.test},run:async()=>c([Fe(w.UserNotificationClientId.tv)])}},subscriptionStatusAppStore:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.appStore)}},subscriptionStatusFitness:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.activity)}},subscriptionStatusiCloud:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.icloud)}},subscriptionStatusMusic:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.music)}},subscriptionStatusNews:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.news)}},subscriptionStatusPodcasts:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.podcast)}},subscriptionStatusTV:function(){return{metadata:{title:Ce,shortDescription:$e,instructions:Je,showsUI:!1,type:T.test},run:async()=>Ve(L.SubscriptionMediaType.tv)}}};j=e(5375),I=e(4331);const st=J,at=V,rt=J,ct=V;D=e(1470),P=e(5542),U=e(3107);const ut="mac/",lt=[we,he,ge,be,Oe,ye],dt="p0201/",pt=new RegExp("hw-bundle","i"),mt=[{eventAllowlist:()=>[{filter:{serviceType:Ee,eventType:_e},allowsResponse:!0}],respond:async e=>{var t,i;if(AMS.log.default("Responding to AppStoreDaemon placement request"),0==e.events.length)return{};const o=e.events[0];return i=[],null===(t=o.placements)||void 0===t||t.forEach((e=>{var t,o,s,a;if("ThirdPartyPurchaseAppLaunch"===e.placement){const r=null!==(t=e.context.adamId)&&void 0!==t?t:"",c=null!==(o=e.context.dsId)&&void 0!==o?o:"",u=null!==(s=e.context.isSignedIn)&&void 0!==s&&s,l="https://apps.apple.com/story/id1604959672",d={callToActionLabel:q,kind:F,url:l,metricsOverlay:{adamId:r,dsid:c,isSignedIn:u,page:pe,pageId:me,pageType:ve,pageContext:fe,actionType:"navigate",actionUrl:l,eventType:"click",targetId:q,targetType:F,topic:ke}},p=n("AMSEngagement.ASD.Third-party-purchase.Continue",null,"Continue"),m=n("AMSEngagement.ASD.Third-party-purchase.Link",null,$),v=n("AMSEngagement.ASD.Third-party-purchase.Title",null,"This app no longer supports the App\xa0Store\u2019s payment system.");let f=n("AMSEngagement.ASD.Third-party-purchase.Subtitle",null,"All purchases in this app will be managed by the developer \u201c@@developerName@@.\u201d Your App\xa0Store account, stored payment method, and related features, such as subscription management and refund requests, will not be available. Apple is not responsible for the privacy or security of transactions made with this developer.");f=f.replace("@@developerName@@",null!==(a=e.context.developerName)&&void 0!==a?a:"");const h={id:e.placement,meta:{metrics:{topic:ke,adamId:r,dsid:c,isSignedIn:u,page:pe,pageId:me,pageType:ve,pageContext:fe}},attributes:{subtitle:f,title:v,display:{template:"app-alert",templateParameters:{bundleID:Me,link:{text:m,textColor:"blue",url:l,metricsTopic:ke,metrics:{}},primaryButton:{action:"continue",backgroundColor:"secondaryBackground",targetId:"Ok",text:p,textColor:"blue",metricsTopic:ke,metrics:{}},titleFormat:"plain",subtitleFormat:"markdown"}},engagementArtwork:{},actions:[d]}},g={clientData:{style:M.W.formSheet,engagementItem:h},metricsOverlay:{adamId:r,dsid:c,isSignedIn:u,topic:ke,page:pe,pageId:me,pageType:ve,pageContext:fe},destinationStyle:M.AA.dynamic,url:le};i.push((0,w.createMessageAction)(Ee,{placements:{ThirdPartyPurchaseAppLaunch:{action:w.PlacementActionType.present,engagementRequest:g}}}))}})),{actions:i}},setup:async e=>{AMS.log.default("[AppStoreDaemonPlacementProvider] Provider setup")}},{eventAllowlist:()=>u?[{filter:{eventType:"BadgePushRequest"},allowsResponse:!0}]:[],respond:async e=>{var t,n;if(AMS.log.default("[BadgingProvider] Responding to BadgePushRequestEvent"),0==e.events.length)return{};const i=e.events[0];return t=[],n={badgeID:i.badgeID,enabled:i.enabled},t.push((0,w.createBadgingActionForTopic)(i.topic,n)),{actions:t}},setup:async e=>{u?AMS.log.default("[BadgingProvider] Provider setup"):AMS.log.default("[BadgingProvider] Not enabled")}},function(e=host){return{eventAllowlist:()=>e.platform===Ue&&e.isOSAtLeast(15,4,0)?[{filter:{app:Me,eventType:Te,xpSendMethod:je,pageUrl:".*(apps|one).apple.com/.*/carrier?.*"},allowsResponse:!0},{filter:{app:Ie,eventType:Te,xpSendMethod:je,pageUrl:".*tv.apple.com/.*/carrier?.*"},allowsResponse:!0},{filter:{eventType:Te,xpSendMethod:je,pageUrl:".*(tv|music|apps).apple.com/.*/subscription/link?.*ch=carrier"},allowsResponse:!0}]:[],respond:async e=>(AMS.log.default("Carrier offer registration: responding to request"),{actions:[L.actions.createCarrierOfferRegistrationAction({throttleInterval:7200})]}),setup:async e=>{AMS.log.default("Setting up carrier offer registration provider")}}}(),{eventAllowlist:()=>l?[{filter:{eventType:"FollowUpCommand"},allowsResponse:!0}]:[],respond:async e=>{AMS.log.default("Responding to Follow Up Command");let t=e.events[0];var n={};switch(t.data.dsid&&(n.account={dsid:t.data.dsid}),t.command){case"clear":return function(e,t){return null!=e.data.identifier?new Promise(((n,i)=>{let o=AMS.followUp.clearFollowUpWithIdentifier(e.data.identifier,t);o.then((e=>{n({data:{success:e}})})),o.catch((e=>{n({data:{success:!1,error:e}})}))})):null!=e.data.backingIdentifier?new Promise(((t,n)=>{let i=AMS.followUp.clearFollowUpWithBackingIdentifier(e.data.backingIdentifier);i.then((e=>{t({data:{success:!0,result:e}})})),i.catch((e=>{t({data:{success:!1,error:e}})}))})):new Promise(((e,t)=>{e({data:{success:!1,error:"Missing backingIdentifier or Identifier"}})}))}(t,n);case"pending":return function(e,t){return null!=e.data.identifier?new Promise(((n,i)=>{let o=AMS.followUp.pendingFollowUpWithIdentfier(e.data.identifier,t);o.then((e=>{n({data:{success:!0,result:e}})})),o.catch((e=>{n({data:{success:!1,error:e}})}))})):new Promise(((e,n)=>{let i=AMS.followUp.pendingFollowUps(t);i.then((t=>{e({data:{success:!0,result:t}})})),i.catch((t=>{e({data:{success:!1,error:t}})}))}))}(t,n);case"post":return function(e){const t=e.data.identifier,n=e.data.payload;if(void 0===t)return AMS.log.error("Identifier not provided"),new Promise(((e,t)=>{e({data:{success:!1}})}));if(void 0===n)return AMS.log.error("payload is not FollowUpNativeContent"),new Promise(((e,t)=>{e({data:{success:!1}})}));let i=(0,w.createFollowUpNotificationActionWithNativeContent)(t,n);return new Promise(((e,t)=>{e({actions:[i],data:{success:!0}})}))}(t);default:return{data:{success:!1,error:"No command provided"}}}},setup:async e=>{AMS.log.default("[FollowUpProvider] Provider setup"),async function(){AMS.log.default("[FollowUpProvider] Checking for expired follow ups to clear");const e=await AMS.followUp.pendingFollowUps(),t=new Date;for(const n of e)void 0!==n.expirationDate&&new Date(n.expirationDate)<=t&&AMS.followUp.clearFollowUpWithBackingIdentifier(n.backingIdentifier)}()}},{eventAllowlist:()=>{if(!A)return[];const e=s();let t=[];for(const n of Object.keys(e))t.push({filter:{serviceType:n,eventType:_e},allowsResponse:!0});return t},respond:async e=>{var t,n;if(AMS.log.default("Responding to Pull Override command"),0==e.events.length)return{};const i=e.events[0];n=[];let o=s()[i.serviceType];return o&&(AMS.log.default(`Found placements for serviceType: ${i.serviceType}`),null===(t=i.placements)||void 0===t||t.forEach((e=>{let t=e.placement,s=o[e.placement];if(s){AMS.log.default(`Overriding serviceType: ${i.serviceType} placement: ${t} response: ${s}`);let e={};e[t]=s,n.push((0,w.createMessageAction)(i.serviceType,{placements:e}))}}))),{actions:n}},setup:async e=>{A?AMS.log.default("[MessagingPullOverrideProvider] Provider setup"):AMS.log.default("[MessagingPullOverrideProvider] Not enabled")}},function(e=host){return{eventAllowlist:()=>[{filter:{kind:"AMSMarketingItemParser"},allowsResponse:!0}],respond:async t=>{var n;if(AMS.log.default(`Marketing responding to request ${n=t.events,JSON.stringify(n,void 0,2)}}`),0===t.events.length)return{};const i=t.events[0],o=i.items;if(0===o.length)return AMS.log.default("Marketing - no items"),{};const s=i.serviceType;return void 0!==s&&pt.test(s)?e.platform===Ue&&e.isOSAtLeast(16,0,0)?(AMS.log.default("Marketing - handling hardware marketing"),await async function(e){return S(e[0])}(o)):(AMS.log.default("Marketing - No handling for hardware marketing"),{}):(AMS.log.default("Marketing - handling marketing with default handler"),function(e){return S(e[0])}(o))},setup:async e=>{AMS.log.default("Setting up marketing hw provider")}}}(),{eventAllowlist:()=>m?[{filter:{serviceType:st,eventType:_e},allowsResponse:!0}]:[],respond:async e=>{var t,n,i,o,s,a,r;if(AMS.log.default("Responding to MessagingStore command"),0==e.events.length)return{};const c=e.events[0];return s=[],null===(t=c.placements)||void 0===t||t.forEach((e=>{var t,n,i,o,a;switch(e.placement){case z:s.push((0,w.createMessageAction)(st,{placements:{testAccountMessage1:{action:w.PlacementActionType.present,content:d()}}}));break;case K:s.push((0,w.createMessageAction)(st,{placements:{testAccountMessage2:{action:w.PlacementActionType.present,content:p()}}}));break;case G:s.push((0,w.createMessageAction)(st,{placements:{testBanner1:{action:w.PlacementActionType.present,content:{title:"Sing your heart out",subtitle:"Sing along to thousands of songs with on-screen lyrics. Search for a song now.",iconURL:"systemimage://music.mic.circle",style:w.MessageStyle.banner,actions:[{deepLink:"action://search",iconURL:"systemimage://magnifyingglass",style:w.ActionStyle.default}]}}}}));break;case Y:s.push((0,w.createMessageAction)(st,{placements:{testBanner2:{action:w.PlacementActionType.present,content:{title:'Ask Siri "Whats this song" while watching movies!',subtitle:"Find a song thats catchy in a movie? Siri can identify it!",iconURL:"systemimage://music.on.film",style:w.MessageStyle.banner,actions:[{deepLink:Re,style:w.ActionStyle.cancel}]}}}}));break;case Z:s.push((0,w.createMessageAction)(st,{placements:{testBubbleTipInline1:{action:w.PlacementActionType.present,content:{title:"Setup syncing sheet music across all your devices",subtitle:"Access all your sheet music by syncing all your sheet music through iCloud.",iconURL:"systemimage://arrow.clockwise.icloud",style:w.MessageStyle.bubbleTip,actions:[{deepLink:Re,style:w.ActionStyle.cancel},{deepLink:"action://setupCloudSyncing",style:w.ActionStyle.default,title:"Setup"}]}}}}));break;case H:s.push((0,w.createMessageAction)(st,{placements:{testBubbleTipInline2:{action:w.PlacementActionType.present,content:{title:"Watch performances on the big screen",subtitle:"Setup AirPlay to enjoy on the big screen always!",iconURL:"systemimage://airplayvideo",style:w.MessageStyle.bubbleTip,actions:[{deepLink:Re,style:w.ActionStyle.cancel},{deepLink:"action://airplay",style:w.ActionStyle.default,title:"Setup AirPlay"}]}}}}));break;case W:s.push((0,w.createMessageAction)(st,{placements:{testBubbleTipOverlay1:{action:w.PlacementActionType.present,content:{title:"Experience an augmented piano practice session",subtitle:"Try interactive guided practice sessions with Augmented Reality",iconURL:"systemimage://arkit",style:w.MessageStyle.bubbleTip,actions:[{deepLink:Re,style:w.ActionStyle.cancel}]}}}}));break;case X:s.push((0,w.createMessageAction)(st,{placements:{testBubbleTipOverlay2:{action:w.PlacementActionType.present,content:{title:"Print out your sheet music",subtitle:"Prefer a physical copy? Print out this sheet music through AirPrint.",iconURL:"systemimage://printer",style:w.MessageStyle.bubbleTip,actions:[{deepLink:Re,style:w.ActionStyle.cancel}]}}}}));break;case Q:s.push((0,w.createMessageAction)(st,{placements:{testToast1:{action:w.PlacementActionType.present,content:{title:"Shared this sheet music with John AppleSeed",iconURL:"systemimage://square.and.arrow.up",style:w.MessageStyle.toast}}}}));break;case ee:s.push((0,w.createMessageAction)(st,{placements:{testToast2:{action:w.PlacementActionType.present,content:{title:"Added Classical tag to this sheet music.",iconURL:"systemimage://tag",style:w.MessageStyle.toast}}}}));break;case te:o=null===(t=e.context)||void 0===t?void 0:t.variant,a=null!==(i=null===(n=e.context)||void 0===n?void 0:n.url)&&void 0!==i?i:at,s.push((0,w.createMessageAction)(st,{placements:{testEngagementRequest1:{action:w.PlacementActionType.present,engagementRequest:{clientData:{style:o},url:a}}}}))}})),null!=(null===(n=c.context)||void 0===n?void 0:n.url)&&(a=null===(i=c.context)||void 0===i?void 0:i.variant,r=null===(o=c.context)||void 0===o?void 0:o.url,s.push((0,w.createMessageAction)(st,{engagementRequest:{clientData:{style:a},url:r}}))),{actions:s}},setup:async e=>{m?AMS.log.default("[MessagingPullProvider] Provider setup"):AMS.log.default("[MessagingPullProvider] Not enabled")}},{eventAllowlist:()=>v?[{filter:{eventType:"MessagePushDemo"},allowsResponse:!1}]:[],respond:async e=>{var t,n,i,o,s,a,r,c;if(AMS.log.default("Responding to MessagePushDemo command"),0==e.events.length)return{};const u=e.events[0];s=w.PlacementActionType.present;const l=null!==(t=u.serviceType)&&void 0!==t?t:rt,m=null!==(n=u.effectivePlacement)&&void 0!==n?n:u.placement;if("dismiss"===u.presentationAction&&(s=w.PlacementActionType.dismiss),a=[],void 0!==u.payload){let e=JSON.parse(u.payload);a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:e}}}))}else switch(u.placement){case z:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:d()}}}));break;case K:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:p()}}}));break;case"testAlert1":a.push((0,w.createMessageAction)(l,{dialogRequest:{action:s,content:{title:"Music Sheets",subtitle:"Failed to purchase music sheet",style:w.MessageStyle.alert,actions:[{title:"Cancel",deepLink:Re,style:w.ActionStyle.cancel},{title:"Try Again",deepLink:"action://try-again",style:w.ActionStyle.default}]}}}));break;case G:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"Sheets+",subtitle:"Thousands of music sheets from Bach to Tchaikovsky",iconURL:"systemimage://music.note.list",style:w.MessageStyle.banner,actions:[{deepLink:ne,style:w.ActionStyle.cancel}]}}}}));break;case Y:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"Tabs+",subtitle:"Thousands of guitar tabs",iconURL:"systemimage://guitars",style:w.MessageStyle.banner,actions:[{deepLink:"action://sign.up.guitar",style:w.ActionStyle.default}]}}}}));break;case Z:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"It's time to practice!",subtitle:"It has been three weeks since you practiced.",iconURL:"systemimage://pianokeys.inverse",style:w.MessageStyle.bubbleTip,actions:[{deepLink:ne,style:w.ActionStyle.default}]}}}}));break;case H:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"Cast your guitar tabs to your TV",subtitle:"View them on the big screen",iconURL:"systemimage://tv.music.note.fill",style:w.MessageStyle.bubbleTip,actions:[{deepLink:Re,style:w.ActionStyle.cancel},{title:"Cast to TV",deepLink:"action://cast",style:w.ActionStyle.default}]}}}}));break;case W:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"Try Home Sharing",subtitle:"Stream all your movies and music from your Mac to your iPhone",style:w.MessageStyle.bubbleTip,iconURL:"systemimage://music.note.house",actions:[{deepLink:Re,style:w.ActionStyle.cancel}]}}}}));break;case X:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{title:"Try markup with Apple Pencil",subtitle:"Draw and make notes directly on your sheets with your Apple Pencil",style:w.MessageStyle.bubbleTip,iconURL:"systemimage://pencil",actions:[{deepLink:Re,style:w.ActionStyle.cancel}]}}}}));break;case Q:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{iconURL:ie,title:"Favorited Luna - Yoko Shimomura",subtitle:"Piano Collections: Final Fantasy XV",style:w.MessageStyle.toast,actions:[{iconURL:ie,deepLink:"action://view.page",style:w.ActionStyle.default}]}}}}));break;case ee:a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s,content:{iconURL:"systemimage://checkmark.circle.fill",title:"You've reached your daily goal",subtitle:"Played 30 minutes today.",style:w.MessageStyle.toast}}}}));break;case te:r=null!==(i=u.style)&&void 0!==i?i:"automatic",c=null!==(o=u.url)&&void 0!==o?o:ct,a.push((0,w.createMessageAction)(l,{engagementRequest:{clientData:{style:r},url:c}}));break;default:s===w.PlacementActionType.dismiss&&void 0!==m&&a.push((0,w.createMessageAction)(l,{placements:{[m]:{action:s}}}))}return{actions:a}},setup:async()=>{v?AMS.log.default("[MessagingPushProvider] Provider setup"):AMS.log.default("[MessagingPushProvider] Not enabled")}},{eventAllowlist:()=>[{filter:{serviceType:"com.apple.notificationAuthorization",eventType:_e},allowsResponse:!0}],respond:async e=>{let t=e.events[0];AMS.log.default("Responding to Message Request");const n=t.placements[0].context.authorizationOptions,i=t.placements[0].context.bundleIdentifier;let o=t.placements[0].context.metricsOverlay;const s=t.placements[0].context.userInitiated;if((0,U.isUnknownPlatform)()&&g(i)!==we||s)return AMS.log.default("Skipping sheet presentation."),{data:{forceTCC:!0}};{const e={clientData:{style:M.W.formSheet,engagementItem:f(n,i,o)},metricsOverlay:o,destinationStyle:M.AA.dynamic,url:le};return{actions:[(0,w.createMessageAction)(t.serviceType,{engagementRequest:e})]}}},setup:async e=>{var n;if("watchOS"!=host.platform&&"tvOS"!=host.platform){AMS.log.default("[NotificationAuthorizationProvider] Provider setup");let e=AMS.database.create().result,i=null!==(n=null==e?void 0:e.fetch(O.cachedEngagementItems))&&void 0!==n?n:{},o=function(){var e,n,i;let o=null===(e=t(_.Language,k.String))||void 0===e?void 0:e.toLowerCase();return o||(AMS.log.default("Falling back to language tag"),o=null===(n=t(_.LanguageTag,k.String))||void 0===n?void 0:n.toLowerCase()),o||(AMS.log.default("Falling back to client locale"),o=(null!==(i=AMS.client.locale)&&void 0!==i?i:"").replace("_","-").toLowerCase()),o?(AMS.log.default("Fetched locale sucessfully: "+o),o):(AMS.log.default("Falling back to en-us"),"en-us")}();for(let e of lt){AMS.log.default("Caching engagement item for: "+e);let t=await h(e,o);i[e]=t}e.set(O.cachedEngagementItems,i),e.set(O.cachedEngagementItems+"lastSyncedLanguage",o)}else AMS.log.default("[NotificationAuthorizationProvider] Not enabled")}},{eventAllowlist:()=>[{filter:{source:"InternalTools"},allowsResponse:!0}],respond:async e=>{AMS.log.default("Responding to tool");let t=e.events;if(!t||0==t.length)return Promise.reject("Error, no events!");let n=t[0],i=n.action;return"runCommand"==i?async function(e){let t=e[N];if(t){let n=ot[t];if(n)return n().run(e)}return{}}(n):"metadata"==i?async function(e){let t=e[N];if(t){let e=ot[t];return e?{data:{identifier:e().metadata}}:{}}let n={};for(var i in ot){let e=ot[i];e&&(n[i]=e().metadata)}return{data:n}}(n):(AMS.log.default("Unknown event: "+JSON.stringify(n)),Promise.reject({error:De}))},setup:async e=>{AMS.log.default("Setting up tool")}},{eventAllowlist:()=>b?[{filter:{eventType:"UbiquitousStoreCommand"},allowsResponse:!0}]:[],respond:async e=>{AMS.log.default("Responding to Ubiquitous Storage Command");let t=e.events[0],n=AMS.database.ubiquitousDatabase();if(null==n.result)throw AMS.log.default("Database error: "+n.error),n.error;let i=n.result;switch(t.command){case"delete":return i.set(t.data.key,null),{data:{success:!0}};case"read":return"all"===t.data.key?{data:{value:i.fetchMatchingKeys("*")}}:{data:{key:t.data.key,value:i.fetch(t.data.key)}};case"write":return i.set(t.data.key,t.data.value),{data:{success:!0}};default:return{data:{success:!1}}}},setup:async e=>{b?AMS.log.default("[UbiquitousStorageProvider] Provider setup"):AMS.log.default("[UbiquitousStorageProvider] Not enabled")}}];(0,L.exportEngagementService)(function(e=mt){return{async enqueue(t){var n;let i,o=function(e,t){let n=[];for(const i of t){let t=[],o=i.eventAllowlist();0!=o.length&&(e.events.forEach((e=>{for(const n of o)if(y(e,n)){t.push(e);break}})),t.length>0&&n.push({provider:i,client:e.client,events:t}))}return n}(t,e),s=[];for(let e=0;e<o.length;e++){let t=o[e],a={client:t.client,events:t.events},r=await t.provider.respond(a);i=null!=i?i:r.data,s=s.concat(null!==(n=r.actions)&&void 0!==n?n:[])}return{data:i,actions:s}},async sync(t){let n=[];for(let i=0;i<e.length;i++){let o=e[i];await o.setup(t),n=n.concat(o.eventAllowlist())}return{whitelistedEvents:n,allowedEvents:n}}}}())})()})();
//# sourceMappingURL=main.js.map