function onError(e){}window.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB,"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange);var DB={db:null,log:function(){var e=Array.prototype.slice.apply(arguments);e.unshift("[DB]: ")},init:function(){return new Promise((function(e,r){var n=indexedDB.open("AwesomeScreenshot",1);n.onupgradeneeded=function(e){var r=e.target.result;e.target.transaction.onerror=onError,r.objectStoreNames.contains("recordings")&&r.deleteObjectStore("recordings"),r.createObjectStore("recordings",{autoIncrement:!0}).createIndex("by_id","id",{unique:!0})},n.onsuccess=function(r){DB.db=r.target.result,e(r.target.result)},n.onerror=function(e){onError(e),r(e)}}))},save:function(e){var r=this.db;return new Promise((function(n,t){var o=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=(new Date).getTime(),c=o.put({id:i,fileUrl:e.fileUrl,detail:{title:e.title,youtubeUrl:"",gDriveUrl:"",size:e.size,duration:e.duration,timeStamp:i,thumbnailUrl:"",recordType:e.recordType}});c.onsuccess=function(){n({id:i,fileUrl:e.fileUrl,detail:{title:e.title,youtubeUrl:"",gDriveUrl:"",size:e.size,duration:e.duration,timeStamp:i,thumbnailUrl:"",recordType:e.recordType}})},c.onerror=t}))},get:function(e){var r=this.db;return new Promise((function(n,t){var o=r.transaction(["recordings"],"readwrite").objectStore("recordings").index("by_id").get(e);o.onsuccess=function(e){var r=e.target.result;n(r)},o.onerror=t}))},getAll:function(){var e=this.db;return new Promise((function(r,n){var t=e.transaction(["recordings"],"readwrite").objectStore("recordings").getAll();t.onsuccess=function(e){var n=e.target.result;r(n)},t.onerror=n}))},_getCursor:function(e){var r=this.db;return new Promise((function(n,t){var o=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(e),c=o.index("by_id").openCursor(i);c.onsuccess=function(e){var r=e.target.result;r&&n(r)},c.onerror=t}))},updateYoutubeUrl:function(e,r){var n=this;return new Promise((function(t,o){n._getCursor(e).then((function(e){e.value.detail.youtubeUrl=r;var n=e.update(e.value);n.onsuccess=t,n.onerror=o}))}))},update:function(e,r){var n=this.db;return new Promise((function(t,o){var i=n.transaction(["recordings"],"readwrite").objectStore("recordings"),c=IDBKeyRange.only(e),s=i.index("by_id").openCursor(c);s.onsuccess=function(e){var n=e.target.result;n&&(n.update(r).onsuccess=function(){t()})},s.onerror=o}))},deleteAll:function(){var e=this.db;return new Promise((function(r,n){var t=e.transaction(["recordings"],"readwrite").objectStore("recordings").clear();t.onsuccess=function(e){var n=e.target.result;r(n)},t.onerror=n}))},delete:function(e){var r=this.db;return new Promise((function(n,t){var o=r.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(e),c=o.index("by_id").openCursor(i);c.onsuccess=function(e){var r=e.target.result;r&&(r.delete().onsuccess=function(){n()})},c.onerror=t}))}};