(self.webpackChunk=self.webpackChunk||[]).push([[2812],{14454:(e,t,n)=>{n.d(t,{t:()=>s});var r=n(57050),i=n(40154);n(83257);function o(e,t){return{decode:e.decode,encode:t.encode}}function a(e){return{decode:e.decode,encode:r.yR}}i.Z_,i.Rx,i.O7,i.dX,i.mI;var s,u,c,d,l,p,f=n(85384),v=n(73915),h=n(73975),y=n(95195),m=n(22232),g=n(66268),I=n(98992);u=s||(s={}),c=u.Type=g.lY.Type.sduiCardAction,d=v.n(f.z2)(I.eX),u.eq=h.f7((function(e,t){return e.type===c&&e.type===t.type&&e.cardId===t.cardId&&d.equals(e.actions,t.actions)&&e.scope===t.scope})),l=o(v.n(i.z2)(I.eX),{encode:function(e){return e}}),p=(0,r.ls)(l.decode,y.mapLeft((function(e){return new Error(i.ii(e))}))),u.isSduiCardAction=function(e){return e.type===s.Type&&(n=e.actions,y.isRight(p(n)))&&"object"==typeof(t=e.scope)&&null!=t&&Object.keys(t).every((function(e){var n=t[e];return"alertRefs"===e?Array.isArray(n):((0,m.L0)(e),!1)}));var t,n}},72812:(e,t,n)=>{n.d(t,{X:()=>x,x:()=>z});var r=n(57050),i=n(5114),o=n(22232),a=n(71249),s=n(83078),u=n(95195),c=n(64015),d=n(81531),l=n(46680),p=n(33678),f=n(14454),v=n(9922),h=n(32952),y=n(41398),m=n(85985),g=n(77176),I=n(16118),A=n(60797),_=n(2834),b=n(19751),w=n(50628),C=n(28811),S=n(78929),F=n(21038),R=n(12054),E=n(31668),M=n(26393);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){G(e,t,n[t])}))}return e}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var z=function(){function e(t,n,r,i,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new p.A;P(this,e),this._sduiService=t,this._sduiManager=n,this._sduiFeedManager=r,this._capiClient=i,this._focusedItem=o,this._platformEnvironment=a,this._log=d.C8.Logging.getLogger("SduiViewModelImpl",l.i.DEBUG),this._subs=new v.w.Keeper,this.sduiActionEvents=new h.xQ,this._sduiAlertIdResolver=x(this._sduiManager.alertIdResolver,this._log),this._subs.push(this._handleSduiActions(),this._handleSduiCardOnFocus(),this._handleSduiCardOnBlur(),this._handleSduiFeedRemove(),this._handleSduiFeedEmpty(),this._handleSduiOnEmptyEvents())}var t,n,c;return t=e,(n=[{key:"onAssistantClose",value:function(){var e=this;(0,r.zG)(this._sduiFeedManager.currentFeed,i.map((function(e){return e.feedId})),i.chain((function(t){return C.a.get(t)(e._sduiManager.state.get())})),i.chain((function(e){return(0,r.zG)(M.ab.findFirst(e.content,"assistantFeed"),i.filter((function(e){return Array.isArray(e.onAssistantClose)&&e.onAssistantClose.length>0})),i.map((function(t){return[t,e]})))})),i.map((function(t){var n=T(t,2),r=n[0],i=n[1];return e.sduiActionEvents.next({type:f.t.Type,sourceId:r.id,cardId:i.id,actions:r.onAssistantClose,scope:{alertRefs:i.alertIds}})})))}},{key:"_handleSduiOnEmptyEvents",value:function(){var e=this;return this._sduiManager.onAlertsRefEmpty.pipe(y.M(this._focusedItem),m.h((function(e){var t=T(e,2),n=t[0].sduiRootId,o=t[1];return(0,r.zG)(o,i.filter((function(e){return e===n})),i.isSome)})),g.U((function(e){return T(e,1)[0]}))).subscribe((function(t){var n=t.sduiId,r=t.sduiRootId,i=t.emptyStrongAlertRef;return e.sduiActionEvents.next({type:f.t.Type,sourceId:n,cardId:r,actions:i.onEmpty,scope:{alertRefs:i.alertIds}})}))}},{key:"_handleSduiFeedRemove",value:function(){var e=this;return this._sduiFeedManager.onFeedRemove.subscribe((function(t){(0,o.kG)("assistantFeed"===t.content.type),e.sduiActionEvents.next({type:f.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onRemove,scope:{alertRefs:[]}})}))}},{key:"_handleSduiFeedEmpty",value:function(){var e=this;return this._sduiFeedManager.onFeedEmpty.subscribe((function(t){(0,o.kG)("assistantFeed"===t.content.type),t.content.onEmpty&&e.sduiActionEvents.next({type:f.t.Type,sourceId:t.id,cardId:t.id,actions:t.content.onEmpty,scope:{alertRefs:[]}})}))}},{key:"_handleSduiCardOnBlur",value:function(){var e=this;return this._focusedItem.pipe(I.G(),g.U((function(t){var n=T(t,1)[0];return(0,r.zG)(n,i.chain((function(t){return(0,r.zG)(e._sduiManager.findFirstCardWithContent(t),i.filter(S.E.isAssistantCardContent),i.map((function(e){return[e,t]})))})))})),A.oA,_.b((function(t){var n=T(t,2),o=n[0],s=o.card,u=o.parentStrongAlertRef,c=n[1];e.sduiActionEvents.next({type:f.t.Type,sourceId:s.id,cardId:c,actions:s.onBlur,scope:{alertRefs:(0,r.zG)(u,i.map((function(e){return e.alertIds})),i.getOrElse((0,r.a9)(a.cS)))}})}))).subscribe()}},{key:"_handleSduiCardOnFocus",value:function(){var e=this;return this._focusedItem.pipe(A.oA,g.U((function(t){return(0,r.zG)(e._sduiManager.findFirstCardWithContent(t),i.map((function(e){return[e,t]})))})),A.oA).subscribe((function(t){var n=T(t,2),o=n[0],a=o.card,s=o.parentStrongAlertRef,u=n[1];e._sduiFeedManager.notifyCardFocused(u),e.sduiActionEvents.next({type:f.t.Type,sourceId:a.id,cardId:u,actions:a.onFocus,scope:{alertRefs:(0,r.zG)(s,i.map((function(e){return e.alertIds})),i.getOrElse((function(){return[]})))}})}))}},{key:"_handleSduiActions",value:function(){var e=this;return this.sduiActionEvents.pipe(b.skipBy(f.t.eq),_.b((function(t){var n=t.cardId,a=t.sourceId,c=t.actions,d=t.scope,l=e;e._log.info("sdui card action:",{cardId:n,actions:c,scope:d}),c.forEach((function(e){switch(e.type){case"notify":return void l._sduiService.sendUserAction(e.sourceId||a,e.userAction);case"removeRoot":var t=l;return void requestAnimationFrame((function(){t._sduiManager.pushRemovedRoot([F.j.Item.Id.from(n),R.i5.RemoveRootSDUIAction])}));case"applyAlerts":case"closeCard":case"highlightAlert":case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"upgradeToPremium":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"showHighlights":case"hideHighlights":case"stopApplyingAlerts":case"selectAlternative":case"copyToClipboard":case"newRevision":case"openGrammarlyGo":case"openPerformanceScore":return;case"removeAlerts":var c=l;return void(0,r.zG)(l._sduiAlertIdResolver(d.alertRefs),s.bw((function(){var e=c;requestAnimationFrame((function(){e._sduiManager.pushRemovedAlerts([d.alertRefs.map(F.j.AlertId.from),R.i5.RemoveAlertsSDUIAction])}))})));case"openLink":return void l._platformEnvironment.actions.openPopup(new E.Z(e.url));case"pushAssistantFeed":var p=l;return void requestAnimationFrame((function(){return(0,r.zG)(p._sduiFeedManager.pushFeed(F.j.Item.Id.from(e.feedId),e.cardId),u.mapLeft((function(e){return p._log.error(e),e})))}));case"popAssistantFeed":var v=l;return void requestAnimationFrame((function(){return v._sduiFeedManager.popFeed(i.fromNullable(e.fallbackFeed))}));case"focusAssistantCard":var h=l;return void requestAnimationFrame((function(){return h._sduiFeedManager.focusCard(e.cardId)}));case"switchView":var y={where:e.where,selected:e.selected,sduiRootId:F.j.Item.Id.from(n)};return l._switchCallerCard(y),l._switchActiveCard(y),l._switchActiveFeed(y),void l._switchActivePopover(y);case"interactPopover":var m=l._sduiManager.popoverManager.getInteractionActions(e.rootPopoverId,e.popoverViewId,e.interaction);return void(m.length>0&&l.sduiActionEvents.next({type:f.t.Type,sourceId:e.rootPopoverId,cardId:e.popoverViewId,actions:m,scope:d}));case"closePopover":return l._sduiManager.popoverManager.removePopover(e.rootPopoverId),void l.sduiActionEvents.next({type:f.t.Type,sourceId:e.rootPopoverId,cardId:e.rootPopoverId,actions:[{type:"removeRoot"}],scope:d});case"enablePlagiarismCheck":return void l._capiClient.enablePlagiarismSearch();case"disablePlagiarismCheck":return void l._capiClient.disablePlagiarismSearch();default:(0,o.L0)(e)}}))}))).subscribe()}},{key:"_switchCallerCard",value:function(e){this._sduiManager.pushSwitchView(e)}},{key:"_switchActiveCard",value:function(e){var t=this;(0,r.zG)(this._focusedItem.get(),i.filter((function(t){return e.sduiRootId!==t})),s.bw((function(n){return t._sduiManager.pushSwitchView(j({},e,{sduiRootId:F.j.Item.Id.from(n)}))})))}},{key:"_switchActiveFeed",value:function(e){var t=this;(0,r.zG)(this._sduiFeedManager.currentFeed,i.filter((function(t){return t.feedId!==e.sduiRootId})),s.bw((function(n){var r=n.feedId;return t._sduiManager.pushSwitchView(j({},e,{sduiRootId:r}))})))}},{key:"_switchActivePopover",value:function(e){var t=this;this._sduiManager.popoverManager.activePopoverView.pipe(w.P()).subscribe(s.bw((function(n){var r=n.rootPopoverId;t._sduiManager.pushSwitchView(j({},e,{sduiRootId:r}))})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&O(t.prototype,n),c&&O(t,c),e}();function x(e,t){return function(n){return(0,r.zG)(n,c.UI(e),c.vP(i.option),s.ew((function(){return t.error("Could not resolve strong alert ref for ".concat(JSON.stringify(n)))})),i.filter(c.Od),s.ew((function(){return t.error("Strong alert refs are empty")})))}}}}]);