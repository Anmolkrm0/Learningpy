import{a as xr}from"./SGC75SOE.js";import{a as yr,c as ho,d as fi,e as yo,f as Cr,g as Sr,i as Ir,j as Se,k as _r}from"./JYOYXT6F.js";import{a as fr}from"./LQZRW7GW.js";import{a as wr}from"./36Q52SMG.js";import{c as No}from"./3ODFTVHN.js";import{a as xo,b as dr}from"./ZB6GXO2V.js";import{a as di}from"./JMRIPDH5.js";import{a as gr}from"./UAB7UEHC.js";import{a as xn}from"./UWBZO3WW.js";import{a as dn}from"./VPMHFK4Q.js";import{b as Er,c as gi}from"./MJ5FSNMU.js";import{g as Ho}from"./4NAB6M5G.js";import{b as St,c as br}from"./KQJRQHMC.js";import{b as Mr}from"./KBNLKYJD.js";import{a as hr}from"./TT2UTYSE.js";import{$a as ht,Aa as Jt,Ab as mr,Ba as gt,C as dt,Ca as rt,Da as Wn,Ea as Qt,Fa as Pe,Ga as Zt,Ha as eo,Ia as to,Ja as oo,Ka as Fo,La as zn,Ma as Un,Na as Vn,Oa as Gn,Pa as $n,Qa as no,Ra as Kn,Sa as ro,Ta as io,U as Rn,Ua as qn,V as Gt,Va as jn,W as Dn,Wa as Yn,Xa as Xn,Y as $t,Ya as Jn,Z as Kt,Za as xt,_ as jt,_a as so,aa as Fn,ab as Qn,b as wn,ba as Yt,bb as Zn,c as ke,ca as On,cb as ao,d as An,da as ft,db as er,ea as Hn,fb as tr,gb as lo,h as Pn,hb as or,ib as nr,jb as uo,kb as rr,lb as po,o as Bn,q as mt,qb as mo,rb as fo,s as Ce,sb as vt,t as Ln,tb as Oo,u as Ne,ub as go,vb as lr,wb as ur,xb as Ct,ya as Ye,yb as cr,za as fe,zb as pr}from"./DLL62XWK.js";import{h as de}from"./N4UDF6UL.js";import{c as Vt,d as Tt}from"./NOAAR5HV.js";import{a as Je}from"./GM542M4T.js";import{i as Re,j as Ut}from"./NR3V5KOB.js";import{b as Ee,o as _n,r as kn}from"./JD5AR4GV.js";import{c as zt}from"./J2TC32MO.js";import{c as Wt,d as Tn,g as vn}from"./FRVVUPC6.js";import{a as D}from"./ASGB7G5Y.js";import{d as K}from"./N4UUWNH5.js";import{a as V,b as En,u as z}from"./6WBNMCV2.js";import{g as mn}from"./QZNWBGPK.js";import{c as ct,d as ko,g as ot,h as Po,j as pn}from"./QZVUH6Z4.js";import{ea as co,ga as Xe,ha as yt,ia as ir,ja as sr,ka as ar,q as qt}from"./OL2SPMMG.js";import{a as Do}from"./6LS5XNTR.js";import{r as Mn}from"./R2C2S5UK.js";import{a as Nn,b as Xt}from"./PQ3LRSVC.js";import{a as pt}from"./RTDSIOP5.js";import{D as Sn,E as Le,J as bn,K as _t,L as Ht,Q as Nt,R as In,a as Ot,b as hn,g as He,k as yn,s as Cn}from"./SCPIJ7ZW.js";import{c as U}from"./QPPETRF6.js";import{f as fn,g as ne,i as Oe,k as gn,m as Me,r as Ae}from"./YUSYB6UW.js";import{M as je,P as Ft}from"./H676AVPS.js";import{L as Lo,O as Ro,T as qe,U as cn,a as Ao,e as j,f as Q,g as me,k as nt,l as Bo,m as Rt,q as Ke,r as an,s as ln,t as wt,u as Dt,v as un}from"./624UJDNS.js";import{a as W}from"./64D36THL.js";import{a as sn}from"./3JX3VARJ.js";import{c as rn,f as P}from"./PQ35KENF.js";var Vr=rn(So=>{"use strict";var vi=En();Object.defineProperty(So,"__esModule",{value:!0});So.default=void 0;var Ai=vi(Tn()),ki=pn(),Pi=(0,Ai.default)((0,ki.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");So.default=Pi});var Gr=rn(bo=>{"use strict";var Bi=En();Object.defineProperty(bo,"__esModule",{value:!0});bo.default=void 0;var Li=Bi(Tn()),Ri=pn(),Di=(0,Li.default)((0,Ri.jsx)("path",{d:"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"}),"KeyboardReturn");bo.default=Di});var T=P(W());var Wo=P(di()),re=P(W());gr(Wo.default);xr(Wo.default);var Qe=new pt("ContextMenu/Rangy"),xi=new Ft({runtime:"client"}),hi=()=>{let{show:n,initRangyCore:t,rangy:e,showRangy:o,hideRangy:r,saveTempSelection:i,currentSelection:l}=Pe(),s=j(qe).userSettings,{chatBoxShortCutKey:u}=Je(),[c,m]=Q(fe),{currentSidebarConversationMessages:p}=Ce(),[,f]=Q(Qt),x=me(Jt);lr();let[y,B]=Q(gt),g=(0,re.useRef)(null),h=(0,re.useRef)(null),{showFloatingContextMenuWithVirtualElement:M}=Ct();Le(()=>{Promise.all([import("./3VSRMID4.js"),import("./5FYG5HQB.js"),import("./PZGV7OON.js")]).then(([{default:E},{default:S},{default:O}])=>{let A=()=>{t(E)};S(E),O(E),E.init(),E.addInitListener(A)})});let d=(0,re.useRef)(n);(0,re.useEffect)(()=>{d.current=n},[n]);let v=(0,re.useCallback)(E=>{{if(d.current&&E instanceof KeyboardEvent&&E.key==="Escape"){Qe.info("Escape close floating button"),r(),mo(),fo();return}let S=E.target,O=E instanceof MouseEvent,A=go(),Z=(e.getSelection().toString()||document?.getSelection()?.toString()||"").trim().replace(/\u200B/g,"");if(S){if(S&&(S.id===Rt||S.id===Dt||S.id===ln))return;if(g.current&&(S=g.current),A){let Te=vt(A);Te.isEditableElement&&(S=Te.editableElement)}if(!S)return;let{editableElement:X}=vt(S);if(X&&(S=X),!X&&!Z){r(),h.current=null;return}h.current=Oo(S,{target:S,eventType:O?"mouseup":"keyup"}),Qe.info(`native selection [${O?"mouse":"keyboard"}]: 	`,h.current,S)}let N=!1,R=!1;h.current&&(h.current?.isEditableElement?(N=!0,(h.current?.editableElementSelectionText||e.getSelection()?.toString()||document.getSelection()?.toString())&&(R=!0)):h.current?.selectionText&&(N=!0,R=!0),N&&(i({selectionText:h.current?.editableElementSelectionText||h.current.selectionText,selectionHTML:h.current?.editableElementSelectionText||h.current.selectionHTML,selectionRect:h.current.selectionRect,activeElement:h.current.target,selectionInputAble:h.current?.isEditableElement,selectionElement:h.current}),Qe.info("save selection temp data",h.current?.isEditableElement,`
`,h.current?.editableElementSelectionText,`
`,h.current?.selectionText)),R?(Qe.info("show floating button"),o()):(Qe.info("hide floating button"),r()))}},[e,i,o,r]),Y=(0,re.useRef)(v);(0,re.useEffect)(()=>{Y.current=v},[v]);let F=(0,re.useRef)(()=>{});(0,re.useEffect)(()=>{let E=He(Y.current,200),S=He(Y.current,200),O=A=>{F.current(),F.current=ur(X=>{if(!X.selectionText&&(r(),!X.isEditableElement)){h.current=null;return}h.current=X,X.selectionText&&(X.eventType==="mouseup"?E({target:null}):S({target:null}))});let Z=A.target,{isEditableElement:N,editableElement:R}=vt(Z);if(N&&R){if(g.current?.isSameNode(R))return;g.current&&(g.current.removeEventListener("mouseup",E),g.current.removeEventListener("keyup",S)),Qe.info("save targetElement ref",R),g.current=R,R.addEventListener("mouseup",E),R.addEventListener("keyup",S)}else Qe.info("clear targetElement ref"),g.current=null};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O),g.current&&(g.current.removeEventListener("mouseup",E),g.current.removeEventListener("keyup",S))}},[e,u,s?.shortcutHintEnable]),(0,re.useEffect)(()=>{let E=He(Y.current,200),S=He(Y.current,200),O=()=>{};return e?.initialized&&(document.addEventListener("mouseup",E),document.addEventListener("keyup",S),O=hr(A=>{if(!A.selectionText&&(r(),!A.isEditableElement)){h.current=null;return}h.current=A,A.selectionText&&(A.eventType==="mouseup"?E({target:null}):S({target:null})),A.isEmbedPage&&A.selectionText&&A?.tagName==="BUTTON"&&yr(),A.selectionText||m(Z=>({...Z,open:!1}))})),()=>{document.removeEventListener("mouseup",E),document.removeEventListener("keyup",S),O()}},[e]),In(async(E,S,O)=>{switch(E){case"Client_listenOpenChatMessageBox":{let A=window.getSelection()?.rangeCount;if(A&&A>0){let R=window.getSelection()?.getRangeAt(0)?.cloneRange();x({range:R||null,selectionText:window?.getSelection()?.toString()||""})}let{command:Z}=S,N=Z==="show-floating-menu";if(!h.current){let R=go(),{editableElement:X,isEditableElement:Te}=vt(R);Te&&X&&(h.current=Oo(X,{target:X,eventType:"keyup"}))}return Qe.info("Client_listenOpenChatMessageBox",h.current?.isEditableElement,h.current?.selectionText),M(h.current,{},N),h.current&&(h.current=null),{success:!0,data:{},message:""}}break}});let oe=(0,re.useRef)("");(0,re.useEffect)(()=>{oe.current=y.lastOutput},[y.lastOutput]);let pe=(0,re.useRef)(l?.selectionElement);(0,re.useEffect)(()=>{pe.current=l?.selectionElement},[l]),(0,re.useEffect)(()=>{let E=pe.current||h.current,S=["REPLACE_SELECTION","INSERT_BELOW","INSERT","INSERT_ABOVE","DISCARD","COPY"],O=uo(y.selectContextMenuId||"");if(O)switch(S.includes(O)&&(x({range:null,selectionText:""}),m({open:!1,rootRect:null}),B({selectContextMenuId:"",lastOutput:""}),r(),h.current=null),O){case"INSERT_BELOW":case"INSERT":case"INSERT_ABOVE":case"REPLACE_SELECTION":E&&xi.postMessage({event:"Client_updateIframeInput",data:{value:oe.current,type:O,startMarkerId:E.startMarkerId,endMarkerId:E.endMarkerId,caretOffset:E.caretOffset}});break;case"TRY_AGAIN":{let A="";if(p.length>0){let Z=!1;for(let N=p.length-1;N>=0;N--){let R=p[N];if(R.type==="user"&&(Z=!0),Z&&R.type==="ai"){A=R.messageId;break}}}f({lastAIMessageId:A})}break;case"COPY":try{let A=document.createElement("textarea");A.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,A.value=oe.current,document.body.appendChild(A),A.select(),document.execCommand("copy",!1,""),A.remove()}catch{}break;default:break}},[y.selectContextMenuId]),(0,re.useEffect)(()=>{c.open||x(E=>{if(E.range){window.getSelection()?.removeAllRanges(),window.getSelection()?.addRange(E.range);let S=go();if(S&&(S.tagName==="INPUT"||S.tagName==="TEXTAREA")){let O=S,A=O.value.indexOf(E.selectionText||""),Z=A+(E.selectionText||"").length;O.focus(),O.setSelectionRange(A,Z)}setTimeout(()=>{let O=new KeyboardEvent("keyup",{key:" ",code:"Space",location:0,bubbles:!0,cancelable:!0,shiftKey:!1});(S||document.body).focus(),(S||document.body).dispatchEvent(O)},0)}return{...E,range:null}})},[c.open])},Tr=hi;var mi=P(Ao());var vr=P(W()),yi=()=>{let{setShortCuts:n,runShortCuts:t,loading:e}=Se("");(0,vr.useEffect)(()=>{let o=async r=>{if(r.data?.id==="USECHATGPT_WEB_INJECT"){let{taskId:i,type:l,data:a}=r.data;switch(l){case"ping":window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"pong",taskId:i,data:{success:!0}},r.origin);break;case"runShortCutActions":{let{actions:s}=a;e?window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!1,error:"shortcuts is running"}},r.origin):(await n(s),await t(!0),window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:i,data:{success:!0,error:""}},r.origin));break}}}};return window.addEventListener("message",o),()=>{window.removeEventListener("message",o)}},[e,n,t])},Ar=yi;var Ge=P(W());var bt=P(W());var Ci=()=>{let{updateSidebarSettings:n,currentSidebarConversationId:t,currentSidebarConversationType:e}=Ce(),o=me(ke),r=jt(),{currentUserPlan:i}=Ne(),{setShortCuts:l,runShortCuts:a}=Se(""),[s,u]=(0,bt.useState)([]),{createConversation:c}=ft(),m=(0,bt.useRef)(!1),p=async()=>{if(m.current)return;await _t("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0);let f=Gt();if(o(x=>({...x,loading:!0})),f){let x=await Yt(f);if(x?.id)if(await n({summary:{conversationId:f}}),x.messages?.find(y=>y.type==="ai")){o(y=>({...y,loading:!1}));return}else await mt("clear",f,0,[]);try{if(await c(),o(B=>({...B,loading:!1})),i.name!=="pro"){let B=Number((await Ht()).ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES)||0;if(B>0)await _t("ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES",B-1);else{await mt("clear",f,0,[]),await mt("add",f,0,[qt(r.PAGE_SUMMARY)]),$t("show","PAGE_SUMMARY");return}}let y=Rn(Dn());u(y)}catch{}}};return(0,bt.useEffect)(()=>{s.length>0&&!m.current&&e==="Summary"&&t&&(m.current=!0,l(s)?a().then().catch().finally(()=>{m.current=!1,u([])}):(u([]),m.current=!1))},[a,u,e,t,s]),{createPageSummary:p}},kr=Ci;var it=P(W()),Si=()=>{let[n,t]=(0,it.useState)(""),e=(0,it.useRef)(""),o=(0,it.useRef)(document.title),r=(0,it.useRef)(0),i=(0,it.useRef)(null),l=()=>{a(),i.current=setInterval(()=>{let s=window.location.href;if(!e.current){o.current=document.title,e.current=s;return}if(s===e.current){o.current=document.title;return}s!==e.current&&(r.current=0),o.current!==document.title?(r.current=0,o.current=document.title,e.current=s,t(s)):(r.current+=1,r.current>10&&(r.current=0,o.current=document.title,e.current=s,t(s)))},1e3)},a=()=>{i.current&&clearInterval(i.current)};return{pageUrl:n,startListen:l,stopListen:a}},Pr=Si;var bi=()=>{let{createPageSummary:n}=kr(),{pageUrl:t,startListen:e}=Pr(),{sidebarSettings:o,currentSidebarConversationType:r,currentSidebarConversationId:i,updateSidebarSettings:l,updateSidebarConversationType:a}=Ce(),{switchBackgroundChatSystemAIProvider:s}=ft(),u=(0,Ge.useRef)("Chat"),c=(0,Ge.useRef)(o),m=Hn(o?.summary?.conversationId);(0,Ge.useEffect)(()=>{c.current=o},[o]),(0,Ge.useEffect)(()=>{if(r){switch(r){case"Chat":break;case"Summary":n().then().catch().finally(()=>{e()});break;case"Search":break}u.current=r}},[r]),(0,Ge.useEffect)(()=>{r==="Summary"&&m&&!i&&n().then().catch().finally()},[i,r]),Sn(()=>{u.current==="Summary"&&l({summary:{conversationId:Gt()}})}),(0,Ge.useEffect)(()=>{u.current==="Summary"&&a("Chat")},[t]),(0,Ge.useEffect)(()=>{let p=!1;return i&&Yt(i).then(async f=>{f?.meta.AIProvider&&(p||await s(f.meta.AIProvider,f.meta.AIModel))}),()=>{p=!0}},[i])},Br=bi;var en=P(sn());var Lr=()=>{Nt(async(n,t,e)=>{switch(n){case"ShortCuts_ClientExecuteOperationPageElement":{let{taskId:o,OperationElementConfig:r}=t;return o?(await Er(o,r),{success:!0,data:!0,message:"ok"}):{success:!1,message:"No taskId",data:null}}break;default:break}})};var Rr=P(W());var Ii={inviteLink:n=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText||"").trim()||`Sign up on MaxAI.me using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${n}`},st=Ii;var Mi=()=>{let{userInfo:n}=Ne(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoTwitterReferral:(0,Rr.useCallback)(async()=>{if(!o){let l=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:`https://twitter.com/intent/tweet?text=${l}`}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetButton"]'],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['a[data-testid="AppTabBar_Profile_Link"]'],actionType:"click",afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetText"]'],actionType:"getText",executeElementCount:10}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:l.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://twitter.com/MaxAI_HQ"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="1667007582270296064-follow"]'],actionType:"click",beforeDelay:2e3,afterDelay:3e3}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a="",s=(u,c)=>{let m=c?.action;if(u==="afterRunAction"&&m?.type==="SET_VARIABLE"){if(m.parameters?.VariableName==="SHARE_POST_LINK")a=m.output;else if(m.parameters?.VariableName==="AutoTwitterReferralResult"){let p=m.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Linkedin] ${p?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:p,shareLink:`[ ${a} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),p&&dt("/user/complete_referral",{referral_types:["TWITTER_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[o,e,t,n?.referral_code]),autoTwitterReferralLoading:o}},Dr=Mi;var Fr=P(W());var Ei=()=>{let{userInfo:n}=Ne(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoFacebookReferral:(0,Fr.useCallback)(async()=>{if(!o){let l=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["textarea[title]"],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:st.inviteLink(n?.referral_code||"")},beforeDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[name="__CONFIRM__"]'],actionType:"click",afterDelay:3e3}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/profile.php"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-ad-preview="message"]','div[data-ad-comet-preview="message"]'],executeElementCount:10,actionType:"getText",beforeDelay:2e3}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:l.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a=(s,u)=>{let c=u?.action;if(s==="afterRunAction"&&c?.type==="SET_VARIABLE"&&c.parameters?.VariableName==="AutoTwitterReferralResult"){let m=c.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Facebook] ${m?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:m},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),m&&dt("/user/complete_referral",{referral_types:["FACEBOOK_SHARE"]}).then()}};return r.current?.addListener(a),await e(),r.current?.removeListener(a),!0}return!1},[o,e,t,n?.referral_code]),autoFacebookReferralLoading:o}},Or=Ei;var Hr=P(W());var wi=()=>{let{userInfo:n}=Ne(),{setShortCuts:t,runShortCuts:e,loading:o,shortCutsEngineRef:r}=Se();return{autoLinkedinReferral:(0,Hr.useCallback)(async()=>{if(!o){let l=st.inviteLink(n?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.artdeco-button"],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[contenteditable="true"]'],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:l},afterDelay:1e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.share-actions__primary-action"],actionType:"click",afterDelay:3e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__view-btn"],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__continue-btn"],actionType:"getText"}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:"linkedin",WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let a="",s=(u,c)=>{let m=c?.action;if(u==="afterRunAction"&&m?.type==="SET_VARIABLE"){if(m.parameters?.VariableName==="SHARE_POST_LINK")a=m.output;else if(m.parameters?.VariableName==="AutoTwitterReferralResult"){let p=m.parameters.WFFormValues?.Value===!0;St(`[Referral] One-click button [Linkedin] ${p?"Success":"Fail"}`,JSON.stringify({email:n?.email||"unknown",success:p,shareLink:`[ ${a} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),p&&dt("/user/complete_referral",{referral_types:["LINKEDIN_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[o,e,t,n?.referral_code]),autoLinkedinReferralLoading:o}},Nr=wi;var Co=P(W());var _i=()=>{let{autoTwitterReferral:n}=Dr(),{autoFacebookReferral:t}=Or(),{autoLinkedinReferral:e}=Nr(),o=(0,Co.useRef)({});(0,Co.useEffect)(()=>{o.current={twitter:n,linkedin:e,facebook:t}},[n,e,t]),Le(()=>{Lo&&location.href.includes(Lo)&&setInterval(()=>{let r=document.querySelector("#appMaxAIReferralShareOneClickContainer"),i=document.querySelector("#appMaxAIReferralShareOneClickButton");if(r&&i){if(!r.classList.contains("loaded"))r.classList.add("loaded");else return;i.addEventListener("click",async()=>{let l=Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));for(let c=0;c<l.length;c++){let p=l[c].getAttribute("data-name"),f=o.current?.[p];f&&await f()}await(c=>new Promise(m=>setTimeout(m,c)))(3e3);let s=new URL(window.location.href),u=new URLSearchParams(s.search);u.set("show_completed","true"),s.search=u.toString(),window.location.href=s.toString()})}},1e3)})},Wr=_i;var zr=P(gi());var Ti=()=>{let n=new Map,t=new Ft,e=async(o,r,i)=>{await t.postMessage({event:"Client_ListenProxyWebsocketResponse",data:{data:r,taskId:o,listenerType:i}})};Nt(async(o,r)=>{switch(o){case"Client_ListenProxyWebsocket":{let{taskId:i,data:l,type:a}=r;switch(a){case"Open":{let s=l.mode,u=new zr.default(l.url,s==="bing"?{packMessage:Ho.packMessage,unpackMessage:Ho.unpackMessage}:{});return u.onUnpackedMessage.addListener(c=>{e(i,c,"onUnpackedMessage")}),u.onMessage.addListener(async c=>{e(i,c,"onMessage")}),u.onClose.addListener(()=>{e(i,{},"onClose")}),await u.open(),n.set(i,u),{success:!0,data:"success",message:"ok"}}break;case"Close":{let s=n.get(i);return s?(s.removeAllListeners(),await s.close(),n.delete(i),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;case"SendPacked":{let s=n.get(i);return s?(s.sendPacked(l),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;default:return{success:!0,data:"success",message:"ok"}}}break}})},Ur=Ti;var et=P(W());var $e=P(W()),Jr=P(Ao());ko();Po();var I=P(W());var le=P(W());var b=P(W());var be=P(W());var zo=P(Vr()),Kr=P(Gr());var ue=b.forwardRef(({label:n,icon:t,CustomRenderNode:e,onClick:o,isGroup:r,...i},l)=>{let a=i;return b.createElement(D,{...i,sx:{boxSizing:"border-box",borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:l,component:"div",role:"menuitem",onClick:s=>{o?.(s),a?.onClick?.(s)}},b.createElement(D,null,e||b.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},b.createElement(de,{size:16,icon:t||"Empty",sx:{color:"primary.main",flexShrink:0}}),b.createElement(z,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n),r&&b.createElement(zo.default,{sx:{ml:"auto",mr:0,flexShrink:0,color:s=>s.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}))))}),Uo=b.forwardRef(({label:n,disabled:t,menuItem:e,...o},r)=>{let i=o,{t:l}=U(["prompt"]),a=j(Wn),[s,u]=Q(rt),c=(0,be.useMemo)(()=>{let f=e.id.replace(yt,""),x=`prompt:${f}`;return l(x)!==f?l(x):e.text},[e.text,l]),m=(0,be.useMemo)(()=>a.includes(e.id)||e.id===s.lastHoverContextMenuId,[a,s.lastHoverContextMenuId]),p=(0,be.useMemo)(()=>s.lastHoverContextMenuId===e.id&&m,[m,s.lastHoverContextMenuId]);return b.createElement(D,{...o,"data-id":e.id,className:`floating-context-menu-item ${m?"floating-context-menu-item--active":""}`,tabIndex:m?0:-1,sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1,boxSizing:"border-box",px:1,borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:f=>f.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:r,component:"div",role:"menuitem",onKeyDown:f=>{i?.onKeyDown?.(f),f.code==="Enter"&&(u(x=>({...x,selectedContextMenuId:e.id})),f.stopPropagation())},onClick:f=>{u(x=>({...x,selectedContextMenuId:e.id})),i?.onClick?.(f)}},e?.data?.icon&&b.createElement(de,{size:16,icon:e.data.icon,sx:{color:"primary.main",flexShrink:0}}),b.createElement(z,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},c),b.createElement("span",{className:"floating-context-menu-item__footer-icon "+(e.data.type==="group"?"floating-context-menu-item__footer-icon--active":"")},e.data.type==="group"?b.createElement(zo.default,{sx:{color:f=>f.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}):p&&b.createElement(Kr.default,{sx:{color:f=>f.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}})))}),$r=b.forwardRef(({referenceElement:n,referenceElementOpen:t,zIndex:e,children:o,label:r,root:i,hoverOpen:l=!0,customOpen:a=!1,needAutoUpdate:s=!1,menuSx:u,defaultPlacement:c,defaultFallbackPlacements:m,onClickContextMenu:p,onClickReferenceElement:f,menuWidth:x=400,...y},B)=>{let g=zn(),h=Un(),M=Fo(),d=!M&&e===2147483601,[v,Y]=Q(rt),F=M!=null,[oe,pe]=b.useState(a?t:!1);(0,be.useEffect)(()=>{setTimeout(()=>{pe(t)},1)},[t]);let[E,S]=b.useState(d?1:null),O=j(fe),[A,Z]=b.useState(!1),N=(0,be.useRef)(null),R=(0,be.useRef)(null),X=b.useRef([]),Te=b.useRef(b.Children.map(o,w=>b.isValidElement(w)?w.props.label:null)),_o=c||(d?"bottom-start":"right-start"),To=m||(d?["bottom-start","top-start","right"]:["right","right-start","right-end","left","left-start","left-end"]),We=()=>{S(null),R.current=null,N.current=null},{x:Mt,y:vo,strategy:at,refs:lt,context:Fe}=xt({nodeId:h,open:oe,onOpenChange:w=>{w||We(),!a&&pe(w)},placement:_o,middleware:[eo({mainAxis:d?4:0,alignmentAxis:d?0:-4}),Zt({fallbackPlacements:To}),to()],whileElementsMounted:s?oo:void 0}),tt=$n(Fe,{enabled:l&&A,delay:{open:75},handleClose:Jn({restMs:25,blockPointerEvents:!1})}),Et=ro(Fe,{event:"mousedown",toggle:!F||!A,ignoreMouse:F}),kt=Yn(Fe,{role:"menu"}),Pt=io(Fe),ze=(0,be.useRef)(null),C=qn(Fe,{listRef:X,activeIndex:E,nested:F,onNavigate(w){let J=()=>{let $=ne()?.querySelector(`#${Ke}`);$&&$?.focus()},L=M?"[\u5B50\u7EA7]":"[\u6839\u7EA7]",ae=ze.current?.key;if(ae){let $=!1,xe=null;R.current&&($=!0,xe=Io(R.current));let ee=[];X.current?.forEach((ye,Lt)=>{let ve=ye?.getAttribute("data-id");ve&&ee.push({floatingUIId:ye?.id?.replace(/:/g,"\\:")||"",contextMenuId:ve,contextMenuIndex:Lt})}),Y(ye=>{let Lt=ye.hoverContextMenuIdMap[h]||ye.lastHoverContextMenuId||"";$&&xe?.contextMenuId&&(Lt=xe.contextMenuId);let ve=ee.findIndex(ut=>ut.contextMenuId===Lt);if(ae==="ArrowLeft")return S(null),J(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[h]:""}};if(ae==="ArrowRight")if(ee.length>0){let ut=ee[0];return S(ut.contextMenuIndex),J(),{...ye,lastHoverContextMenuId:ut.contextMenuId}}else return S(null),J(),{...ye,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[h]:""}};let tn=!1,on=ze.current?.target,nn=on?.getAttribute("data-lastid");if(nn&&(ve=ee.findIndex(ut=>ut.floatingUIId===nn),on.removeAttribute("data-lastid"),tn=!0),ve===-1&&(M||(ve=0)),ve===-1)return J(),ye;let Ve=null;return ae==="ArrowDown"?tn||$?Ve=ee[ve]:ee[ve+1]?Ve=ee[ve+1]:Ve=ee[0]:ae==="ArrowUp"&&(ee[ve-1]?Ve=ee[ve-1]:Ve=ee[ee.length-1]),Ve?(S(Ve.contextMenuIndex),J(),{...ye,hoverContextMenuIdMap:{...ye.hoverContextMenuIdMap,[h||""]:Ve.contextMenuId},lastHoverContextMenuId:Ve.contextMenuId}):(J(),ye)}),ze.current=null}},loop:!0,virtual:!0}),k=Xn(Fe,{enabled:oe,listRef:Te,onMatch:oe?S:void 0,activeIndex:E}),{getReferenceProps:G,getFloatingProps:Ie,getItemProps:se}=so([tt,Et,kt,Pt,C,k]);b.useEffect(()=>{if(!g)return;function w(){a||pe(!1)}function J(L){L.nodeId!==h&&L.parentId===M&&pe(!1)}return g.events.on("click",w),g.events.on("menuopen",J),()=>{g.events.off("click",w),g.events.off("menuopen",J)}},[g,h,M,a]),b.useEffect(()=>{oe&&g&&g.events.emit("menuopen",{parentId:M,nodeId:h})},[g,oe,h,M]),b.useEffect(()=>{function w({pointerType:L}){L!=="touch"&&Z(!0)}function J(){Z(!1)}return window.addEventListener("pointermove",w,{once:!0,capture:!0}),window.addEventListener("keydown",J,!0),()=>{window.removeEventListener("pointermove",w,{capture:!0}),window.removeEventListener("keydown",J,!0)}},[A]),(0,be.useEffect)(()=>{let w=!1;return d&&v.lastHoverContextMenuId&&o&&setTimeout(()=>{w||S(J=>{let L=o.findIndex(ae=>ae?.key===v.lastHoverContextMenuId);return L!==-1&&J===null?L:J})},0),()=>{w=!0}},[v.lastHoverContextMenuId,o]);let Ue=jn([lt.setReference,B]),Bt=(0,be.useCallback)(()=>{let w=v.lastHoverContextMenuId;if(w){let J=ne()?.querySelector(`[data-id="${w}"]`);J&&J.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0,code:"Enter",keyCode:13}))}},[v]);return(0,be.useEffect)(()=>{O.open||(We(),Y(w=>({...w,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})))},[O.open]),b.createElement(Vn,{id:h},n?b.isValidElement(n)&&b.cloneElement(n,{...G({...y,className:`${F?"MenuItem":"RootMenu"}`,onClick(w){w.stopPropagation(),f?.(w)},onKeyDownCapture(w){if(w.key==="Enter"&&!M){Bt();return}if(w.key==="ArrowDown"||w.key==="ArrowUp"||w.key==="ArrowLeft"||w.key==="ArrowRight"){if(R.current=null,w.key==="ArrowLeft"){if(!M&&N.current){let L=Io(N.current);L?.parentDropdownSelectedItem&&(L.dropdownSelectedItem.focus(),L.dropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0})),L.parentDropdownSelectedItem&&L.id&&(L.parentDropdownSelectedItem.setAttribute("data-lastid",L.id),L.parentDropdownSelectedItem.focus(),L.parentDropdownSelectedItem.classList.contains("RootMenu")?N.current=null:N.current=L.parentDropdownSelectedItem,L.parentDropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))))}return}else if(w.key==="ArrowRight"&&!M&&E!==null){let L=X.current[E];if(N.current){let ae=N.current?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),$=ne()?.querySelector(`#${ae}`);if($){let xe=$.getAttribute("aria-activedescendant")?.replace(/:/g,"\\:"),ee=$.querySelector(`#${xe}`);ee.id&&ee.getAttribute("aria-haspopup")&&(L=ee)}}L&&L.getAttribute("aria-haspopup")==="menu"&&(L.focus(),L.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0})),N.current=L);return}else if(N.current){N.current.focus(),N.current.dispatchEvent(new KeyboardEvent("keydown",{key:w.key,bubbles:!0,cancelable:!0}));return}ne()?.querySelector(`#${Ke}`)?.focus(),ze.current=w}},...F&&{role:"menuitem"},ref:Ue})}):b.createElement(K,{ref:Ue,...G({...y,className:`${F?"MenuItem":"RootMenu"}`,onClick(w){w.stopPropagation()},...F&&{role:"menuitem"}}),startIcon:b.createElement(Ee,{sx:{fontSize:16,color:"inherit"}}),variant:"outlined"},r||"Use ChatGPT"),b.createElement(no,{root:i},oe&&b.Children.count(o)&&b.createElement(Kn,{context:Fe,modal:!1,initialFocus:-1,visuallyHiddenDismiss:!0},b.createElement(D,{sx:{zIndex:(e||0)+1,display:"flex",flexDirection:"column",p:.5,outline:"none!important",width:x,maxHeight:327,boxSizing:"border-box",overflowY:"auto",border:"1px solid",borderColor:"customColor.borderColor",bgcolor:"background.paper",borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px","& *":{outline:"none!important"},"&:has(.max-ai--popper-wrapper)":{overflowY:"unset"},...u},component:"div",ref:lt.setFloating,className:"Menu",style:{position:at,top:vo??0,left:Mt??0},...Ie()},b.Children.map(o,(w,J)=>b.isValidElement(w)&&b.cloneElement(w,se({tabIndex:E===J?0:-1,ref(L){X.current[J]=L},onMouseDown(L){p&&(g?.events.emit("click"),w.props?.menuItem?.data?.type==="shortcuts"&&p?.(w.props.menuItem))},onClick(L){p||(w.props.onClick?.(L),g?.events.emit("click"))},onKeyDownCapture(L){ze.current=L},onMouseEnter(L){L.stopPropagation(),L.preventDefault();let ae=L.currentTarget;if(ae.getAttribute("data-id")){N.current=ae;let $=Io(ae);if(($?.id||$?.contextMenuId)&&$.expandedSiblingMenuItem){if($.expandedSiblingMenuItem?.getAttribute("data-id")===$.contextMenuId)return;let xe=Io($.expandedSiblingMenuItem);if(xe?.dropdownSelectedItem){let ee=new KeyboardEvent("keydown",{key:"ArrowLeft",bubbles:!0,cancelable:!0});R.current=xe.dropdownSelectedItem,xe.dropdownSelectedItem.focus(),xe.dropdownSelectedItem.dispatchEvent(ee),$.expandedSiblingMenuItem.setAttribute("data-lastid",$.contextMenuId),$.expandedSiblingMenuItem.classList.contains("RootMenu")?N.current=null:N.current=xe.parentDropdownSelectedItem,$.expandedSiblingMenuItem.focus(),$.expandedSiblingMenuItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))}}if($?.id){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,$.keydownEmitElement?.dispatchEvent(xe);let ee=new KeyboardEvent("keydown",{key:"ArrowRight",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(ee)}else if($?.contextMenuId){let xe=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(xe)}}}})))))))}),De=b.forwardRef((n,t)=>Fo()===null?b.createElement(Gn,null,b.createElement($r,{...n,ref:t})):b.createElement($r,{...n,ref:t})),Io=n=>{let t=ne();if(!n||!t)return null;let e=n.getAttribute("id")?.replace(/:/g,"\\:")||"",o=n.getAttribute("data-id")||"",r=n.getAttribute("aria-haspopup")==="menu",i=t.querySelector(`div[aria-haspopup="menu"][aria-activedescendant="${e}"]`),l=i?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),a=l?t.querySelector(`#${l}`):null,s=n.getAttribute("aria-controls")?.replace(/:/g,"\\:"),u=s?t.querySelector(`#${s}`):null,c=null;u&&!c&&(c=u.querySelector('.floating-context-menu-item--active:not([aria-haspopup="menu"])'),c||(c=u.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')));let m=n.parentElement?.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])'),p=n.parentElement?.querySelector('.floating-context-menu-item[aria-expanded="true"]');return{id:e,contextMenuId:o,isMenu:r,parentDropdownSelectedItem:i,parentDropdown:a,dropdownMenu:u,dropdownSelectedItem:c,keydownEmitElement:m,expandedSiblingMenuItem:p}};var Vo=(0,le.forwardRef)((n,t)=>{let{menuItem:e,root:o,referenceElement:r,referenceElementOpen:i,rootMenu:l,customOpen:a,onClickContextMenu:s,menuWidth:u,...c}=n,{t:m}=U(["prompt"]),p=(0,le.useMemo)(()=>m(`prompt:${e.id}`)!==e.id?m(`prompt:${e.id}`):e.text,[e.text,m]),f=(0,le.useCallback)(x=>m(`prompt:${x.id}`)!==x.id?m(`prompt:${x.id}`):x.text,[m]);return e.data.type==="group"?le.default.createElement(De,{zIndex:n.zIndex,ref:t,root:o,label:p,menuWidth:u,onClickContextMenu:s,referenceElement:le.default.createElement(Uo,{...c,label:p,menuItem:e})},e.children.map((x,y)=>le.default.createElement(Vo,{...c,root:o,key:x.id,menuItem:x,label:f(x)}))):le.default.createElement(Uo,{...c,menuItem:e,ref:t,label:p})}),Fi=n=>{let{root:t,referenceElement:e,referenceElementOpen:o,menuList:r,customOpen:i,needAutoUpdate:l,defaultPlacement:a,defaultFallbackPlacements:s,onClickContextMenu:u,menuWidth:c,onClickReferenceElement:m,hoverOpen:p,...f}=n,{t:x}=U(["prompt"]),y=(0,le.useMemo)(()=>{let B=[];return r.forEach((g,h)=>{let M=x(`prompt:${g.id}`)!==g.id?x(`prompt:${g.id}`):g.text;g.data.type==="group"?(h>0&&B.push(le.default.createElement(D,{key:g.id+"_group_spector","aria-disabled":!0,onClick:d=>{d.stopPropagation(),d.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:"customColor.borderColor",my:1}})),B.push(le.default.createElement(D,{key:g.id+"_group_name",component:"div","aria-disabled":!0,sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",px:1,pointerEvents:"none"},onClick:d=>{d.stopPropagation(),d.preventDefault()}},le.default.createElement(z,{textAlign:"left",fontSize:12,color:"text.secondary"},M))),g.children.forEach((d,v)=>{B.push(le.default.createElement(Vo,{menuWidth:c,onClickContextMenu:u,zIndex:2147483602,...f,key:d.id,label:"",menuItem:d,root:t}))})):B.push(le.default.createElement(Vo,{menuWidth:c,onClickContextMenu:u,key:g.id,label:"",menuItem:g,root:t}))}),B},[r,x]);return le.default.createElement(De,{zIndex:2147483601,label:"",root:t,customOpen:i,needAutoUpdate:l,referenceElement:e,referenceElementOpen:o,defaultPlacement:a,defaultFallbackPlacements:s,onClickContextMenu:u,onClickReferenceElement:m,hoverOpen:p,menuWidth:c},y)},Mo=Fi;var ce=P(W());var Go=n=>{let{sx:t}=n,{t:e}=U(["common","client"]),[o,r]=(0,ce.useState)(!0),[i,l]=(0,ce.useState)(null);return(0,ce.useEffect)(()=>{if(i)return;let a=ne();a&&l(a),r(!1)},[]),ce.default.createElement(Tt,{loading:o},i&&ce.default.createElement(De,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:i,menuSx:{width:240},referenceElement:ce.default.createElement(D,{sx:{alignSelf:"end"}},ce.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,color:"inherit",minWidth:"unset",...t}},ce.default.createElement(de,{icon:"More",sx:{color:"text.primary",fontSize:16}})))},ce.default.createElement(ue,{onClick:()=>{Me({key:"options",query:"#/my-own-prompts"})},label:e("client:floating_menu__button__manage_my_own_prompt"),icon:"DefaultIcon"}),ce.default.createElement(De,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:i,referenceElement:ce.default.createElement(ue,{isGroup:!0,icon:"Delete",label:e("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},ce.default.createElement(ue,{label:e("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),ce.default.createElement(ue,{label:e("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),ce.default.createElement(ue,{onClick:()=>{Me({key:"options"})},label:e("common:settings"),icon:"Settings"})))};var $o=P(W());var Eo=P(W());var Ko=n=>{let{t}=U(["common","client"]),{sx:e,placement:o,ButtonProps:r,iconSize:i=16,icon:l="Close"}=n,[,a]=Q(fe),s=me(Ye);return Eo.default.createElement(Re,{title:t("client:floating_menu__button__hide_menu__until_next_visit"),floatingMenuTooltip:!0,placement:o},Eo.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,minWidth:"unset",color:"text.primary",...e},onClick:async()=>{a({open:!1,rootRect:null}),s(u=>({...u,closeBeforeRefresh:!0}))},...r},Eo.default.createElement(de,{icon:l,sx:{color:"inherit",fontSize:i}})))};var te=P(W());var wo=P(W());var At=n=>{let{t}=U(["common","client"]),{hideRangy:e}=Pe(),[,o]=Q(fe),{chatBoxShortCutKey:r}=Je();return wo.default.createElement(Re,{description:r,title:t("client:floating_menu__button__switch_to_sidebar"),placement:"bottom",...n.TooltipProps},wo.default.createElement(K,{sx:{ml:"0px!important",height:"24px",flexShrink:0,alignSelf:"end",minWidth:"unset",padding:"6px 5px"},className:"max-ai__actions__button--toggle-sidebar",variant:"text",onClick:()=>{rr(),e(),o({open:!1,rootRect:null}),gn()||Oe()}},wo.default.createElement(_n,{sx:{fontSize:"16px",color:"text.primary"}})))};var qo=()=>{let n=j(ke),t=(0,te.useRef)(!1),e=(0,te.useMemo)(()=>!!(n.loading&&n.writingMessage?.text),[n.loading,n.writingMessage]),{stopGenerateMessage:o,reGenerate:r}=mr(),i=(0,te.useCallback)(async a=>{a==="s"&&(t.current=!1,await o()),a==="r"&&(t.current=!0,await o())},[o]),l=(0,te.useRef)(r);return(0,te.useEffect)(()=>{l.current=r},[r]),(0,te.useEffect)(()=>{if(!e)return;let a=async s=>{let u=s.key;lo()&&["r","s","o","c"].includes(u)&&(s.preventDefault(),s.stopPropagation(),await i(u))};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[e,i]),e?te.default.createElement(V,{direction:"row",spacing:1,sx:{ml:"auto!important","& .usechatgpt-floating-menu__button__shortcut":{fontSize:"12px",opacity:.7,ml:"4px"}}},te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("r")}},te.default.createElement(z,{component:"span",fontSize:"14px",color:"primary.main"},"Try again",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"R"))),te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("s")}},te.default.createElement(z,{component:"span",fontSize:"14px",color:"primary.main"},"Stop",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"S"))),te.default.createElement(At,null)):te.default.createElement(te.default.Fragment,null)};var _=P(W());var Ze=P(W());var Oi=n=>{let t=ne()||document.body,{children:e,content:o,boxSx:r,onClick:i,PopperProps:l,hoverOpen:a,stopEvent:s=!0}=n,[u,c]=Ze.default.useState(null),m=(0,Ze.useRef)(Ot()),p=g=>{s&&(g.stopPropagation(),g.preventDefault()),c(u?null:g.currentTarget),i?.(g)},f=g=>{a&&c(g.currentTarget)},x=g=>{a&&c(null)},y=!!u,B=y?m.current:void 0;return Ze.default.createElement(Ze.default.Fragment,null,Ze.default.createElement(D,{component:"div",onMouseEnter:f,onMouseLeave:x,onClick:p,onMouseDown:g=>{s&&(g.stopPropagation(),g.preventDefault())},onMouseUp:g=>{s&&(g.stopPropagation(),g.preventDefault())},sx:{...r}},e),Ze.default.createElement(kn,{disablePortal:!0,id:B,open:y,anchorEl:u,container:t,style:{zIndex:2147483630},className:"max-ai--popper-wrapper",...l},o))},jo=Oi;var we=P(W());var Hi=({liteMode:n})=>{let{t}=U(["common","client"]);return we.default.createElement(we.default.Fragment,null,n?we.default.createElement(D,{sx:{borderRadius:"4px",bgcolor:e=>e.palette.mode==="dark"?"rgb(7, 19, 24)":"rgb(229, 246, 253)",color:e=>e.palette.mode==="dark"?"rgb(184, 231, 251)":"rgb(1, 67, 97)",p:2,overflow:"hidden"}},we.default.createElement(V,{spacing:1,alignItems:"center"},we.default.createElement(z,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry-small.png",alt:"settings-entry",width:200,height:80}))):we.default.createElement(xo,{icon:we.default.createElement(we.default.Fragment,null),sx:{mt:1,mb:2}},we.default.createElement(V,{spacing:1},we.default.createElement(z,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry.png",alt:"settings-entry",width:466,height:121}))))},Yo=Hi;var Xo=n=>{let{sx:t,placement:e}=n,{t:o}=U(["common","client"]),[r,i]=(0,_.useState)(!0),l=me(Ye),{updateButtonSettingsWithDomain:a,toggleButtonSettings:s}=Nn(),{hideRangy:u}=Pe(),[,c]=Q(fe),[m,p]=(0,_.useState)(null),[f,x]=(0,_.useState)(!1);return(0,_.useEffect)(()=>{if(m)return;let y=ne();y&&p(y),i(!1)},[]),_.default.createElement(Tt,{loading:r},m&&_.default.createElement(De,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:m,menuSx:{width:240},referenceElement:_.default.createElement(D,{sx:{zIndex:2,alignSelf:"end",position:"relative",display:"flex",bgcolor:f?"background.paper":"transparent",borderRadius:f?0:"0 14px 14px 0",transition:f?"background-color 0s ease-out":"background-color 0.1s ease-in-out",width:"34px","&::before":{content:'""',position:"absolute",left:0,height:"28px",bgcolor:"background.paper",width:"21px"}}},_.default.createElement(K,{onMouseEnter:()=>{x(!0)},onMouseLeave:()=>{x(!1)},size:"small",variant:"text",sx:{padding:"5px 8px",color:"inherit",minWidth:"unset",...t}},_.default.createElement(de,{icon:"More",sx:{color:y=>y.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)",fontSize:"18px"}})),_.default.createElement(Ko,{ButtonProps:{onMouseEnter:()=>{x(!0)},onMouseLeave:()=>{x(!1)}},icon:f?"Close":"More",iconSize:18,sx:{zIndex:1,left:f?"100%":0,transition:"left 0.1s ease-in-out",width:"34px",height:"28px",padding:"5px 8px",borderRadius:"0 14px 14px 0",right:"-100%",position:"absolute",bgcolor:"background.paper",color:y=>y.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)","&:hover":{bgcolor:y=>y.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}},placement:e}))},_.default.createElement(De,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:m,referenceElement:_.default.createElement(ue,{isGroup:!0,icon:"Delete",label:o("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},_.default.createElement(ue,{label:o("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),_.default.createElement(ue,{label:o("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),_.default.createElement(De,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:m,referenceElement:_.default.createElement(ue,{isGroup:!0,icon:"VisibilityOff",label:o("client:floating_menu__button__hide_menu")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},_.default.createElement(ue,{onClick:()=>{c({open:!1,rootRect:null}),l(y=>({...y,closeBeforeRefresh:!0}))},label:o("client:floating_menu__button__hide_menu__until_next_visit")}),_.default.createElement(ue,{CustomRenderNode:_.default.createElement(jo,{PopperProps:{placement:"top"},onClick:y=>{y.stopPropagation(),y.preventDefault()},content:_.default.createElement(No,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},_.default.createElement(V,{spacing:1},_.default.createElement(z,{textAlign:"center",fontWeight:"600",fontSize:"16px",color:"text.primary"},o("client:floating_menu__button__hide_menu__this_site__tooltip__title")),_.default.createElement(Yo,{liteMode:!0}),_.default.createElement(D,null),_.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await a("textSelectPopupButton"),c({open:!1,rootRect:null})}},o("client:floating_menu__button__hide_menu__this_site__tooltip__confirm")),_.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},o("common:cancel"))))},_.default.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},_.default.createElement(de,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),_.default.createElement(z,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o("client:floating_menu__button__hide_menu__this_site"))))}),_.default.createElement(ue,{CustomRenderNode:_.default.createElement(jo,{PopperProps:{placement:"top"},onClick:y=>{y.stopPropagation(),y.preventDefault()},content:_.default.createElement(No,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},_.default.createElement(V,{spacing:1},_.default.createElement(z,{fontSize:"16px",color:"text.primary",textAlign:"center",fontWeight:"600"},o("client:floating_menu__button__hide_menu__all_sites__tooltip__title")),_.default.createElement(Yo,{liteMode:!0}),_.default.createElement(D,null),_.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await s("textSelectPopupButton",!1),c({open:!1,rootRect:null})}},o("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm")),_.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},o("common:cancel"))))},_.default.createElement(V,{direction:"row",spacing:1,px:1,alignItems:"center"},_.default.createElement(de,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),_.default.createElement(z,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o("client:floating_menu__button__hide_menu__all_sites"))))}),_.default.createElement(ue,{label:o("client:floating_menu__button__menu_settings"),icon:"Settings",onClick:()=>{Me({key:"options",query:"#/mini-menu"})}})),_.default.createElement(ue,{onClick:()=>{Me({key:"options"})},label:o("common:settings"),icon:"Settings"})))};var q=P(W());var Ni=n=>{let t=dn(),{onChange:e}=n,{currentSidebarConversationMessages:o,currentSidebarConversationType:r}=Ce(),i=j(fe),[,l]=Q(gt),[,a]=Q(Qt),s=ho(),u=(0,q.useRef)("");(0,q.useEffect)(()=>{r==="Chat"&&(u.current=Bn(o,x=>x.type==="ai")?.messageId||"")},[o,r]),(0,q.useEffect)(()=>{i.open&&a({lastAIMessageId:u.current})},[i.open]),(0,q.useEffect)(()=>{l(x=>({...x,lastOutput:s})),e?.(s)},[s,i.open]);let c=(0,q.useRef)(null),m=q.default.useRef(null),p=(0,q.useCallback)(Cn(()=>{let x=c.current;x&&(x.style.minHeight=`${m.current?.offsetHeight||0}px`)},100),[]),f=(0,q.useCallback)(He(()=>{let x=c.current;x&&(x.style.minHeight=`${(m.current?.offsetHeight||0)+1}px`)},100),[]);return(0,q.useEffect)(()=>{setTimeout(()=>{m.current?.scrollTo({top:m.current.scrollHeight}),p(),f()},0)},[s]),(0,q.useEffect)(()=>{let x=y=>{if((y.metaKey||y.ctrlKey)&&(y.stopPropagation(),y.key==="C"||y.key==="c"||y.key==="x"||y.key==="X")){let B=window.getSelection();if(B&&B.rangeCount>0){let h=B.getRangeAt(0).toString()||B.toString();h&&(y.preventDefault(),navigator.clipboard.writeText(h))}}};m.current?.addEventListener("keydown",x,!0)},[]),q.default.createElement(V,{ref:c,className:"chat-message--text max-ai__writing-message-box",whiteSpace:"pre-wrap",width:"100%",sx:{wordBreak:"break-word",borderBottomLeftRadius:0,color:x=>x.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)","& .markdown-body":{userSelect:"text",maxHeight:"min(40vh, 320px)",overflowY:"auto","*":{fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important'},"& p:last-child":{mb:"1em"}}},component:"div"},hn(s)?q.default.createElement(Wi,null):null,q.default.createElement("div",{tabIndex:-1,ref:m,style:{textAlign:"left"},className:`markdown-body ${t.isDarkMode?"markdown-body-dark":""}`},q.default.createElement(wr,null,s.replace(/^\s+/,""))))},Wi=()=>{let{t:n}=U(["common","client"]),{currentSelection:t}=Pe(),e=(0,q.useMemo)(()=>{if(t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText){let o=t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText.trim().replace(/\u200B/g,"");return((i,l)=>{if(i.length<=l)return{start:i,end:""};let a=i.substring(i.length-l);return{start:i.substring(0,i.length-l),end:a}})(o,15)}return{start:"",end:""}},[t]);return!e.start&&!e.end?null:q.default.createElement(z,{sx:{width:"100%",display:"flex",flexDirection:"row"},fontSize:"12px",fontWeight:400,color:"text.secondary"},q.default.createElement("span",{style:{flexShrink:0}},n("client:floating_menu__draft_card__context__title"),":"," "),q.default.createElement("span",{style:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"}},e.start),q.default.createElement("span",{style:{flexShrink:0,whiteSpace:"nowrap"}},e.end))},qr=Ni;var Yr=P(fi());var _e=P(W());var zi=({TooltipProps:n,...t})=>{let{currentSidebarConversationType:e}=Ce(),{currentAIProviderDetail:o,currentAIProviderModelDetail:r}=Fn(),{t:i}=U(["common","client"]),[l,a]=(0,_e.useState)(void 0);return(0,_e.useEffect)(()=>{if(e==="Chat"&&o&&r){let s=i(o.label)!==o.label?i(o.label):o.label,u=i(r.title)!==r.title?i(r.title):r.title;a({title:`${s} (${u})`,provider:o.value,model:r.value})}},[o,r,i,e]),_e.default.createElement(_e.default.Fragment,null,l?_e.default.createElement(Re,{...n,title:l.title},_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},l.provider?_e.default.createElement(An,{aiProviderType:l.provider,...t}):_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}}))):_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}})))},jr=zi;var Ui=[],Vi=!0,Xr=n=>{let{root:t}=n,{t:e}=U(["common","client"]),{palette:o}=mn(),{currentSelectionRef:r}=Pe(),i=j(ke),l=me(qe),{currentSidebarConversationType:a,updateSidebarConversationType:s}=Ce(),[u,c]=Q(fe),m=ho(),{isLogin:p}=Kt(),f=j(wn),[x,y]=Q(gt),B=(0,I.useCallback)(()=>{let C=r.current?.activeElement||r.current?.selectionElement?.target;return C&&fn()?.contains(C)},[]),g=(0,I.useMemo)(()=>x.lastOutput,[x.lastOutput]),[h,M]=Q(rt),[d,v]=(0,I.useState)([]),Y=(0,I.useMemo)(()=>{if(u.rootRect){let C=Math.max(u.rootRect?.width||0,Ro-32);return C>1280?1280:C}return Ro-32},[u.rootRect]),F=(0,I.useMemo)(()=>{let C="bottom-start",k="bottom-start";if(u.rootRect&&Y){let G=Zn(u.rootRect,Y,400);G.y>u.rootRect.top?(C="bottom-start",k="bottom-start"):G.y<u.rootRect.top&&(C="top-start",k="top-start"),G.x>u.rootRect.left+300?C="right-start":G.x<u.rootRect.left-300&&(C="left-start")}return{inputPlacement:C,contextMenuPlacement:k}},[u.rootRect,Y]),{x:oe,y:pe,strategy:E,refs:S,context:O}=xt({open:u.open,onOpenChange:C=>{c(k=>({...k,open:C}))},placement:F.inputPlacement,middleware:tr,whileElementsMounted:oo}),A=ro(O),Z=io(O,{}),{getFloatingProps:N}=so([Z,A]),[R,X]=(0,I.useState)(""),Te=(0,I.useRef)(null),{setShortCuts:_o,runShortCuts:To,loading:We,reGenerate:Mt,shortCutsEngineRef:vo}=Se(""),{contextMenuList:at,originContextMenuList:lt}=po("textSelectPopupButton",R),Fe=cr(),tt=(0,I.useMemo)(()=>We?Ui:g?Fe:at,[We,at,g,Fe]);(0,I.useEffect)(()=>{},[tt]);let Et=(0,I.useMemo)(()=>R.length>0,[R]);(0,I.useEffect)(()=>{if(u.rootRect){let C=ao(u.rootRect);if(!Vi){document.querySelector("#rangeBorderBox")?.remove();let k=document.createElement("div");k.id="rangeBorderBox",k.style.position="absolute",k.style.left=C.left+"px",k.style.top=C.top+window.scrollY+"px",k.style.width=C.width+"px",k.style.height=C.height+"px",k.style.border="1px solid green",k.style.zIndex="9999",k.style.pointerEvents="none",document.body.appendChild(k)}S.setPositionReference({getBoundingClientRect(){return C}})}},[u.rootRect]),(0,I.useEffect)(()=>{if(u.open&&tt.length>0){let C=null;tt.find(k=>{if(k.data.type==="group"){if(k.children.length>0)return C=k.children.find(G=>G.data.type==="shortcuts")||null,C!==null}else if(k.data.type==="shortcuts")return C=k,!0;return!1}),C&&M(k=>({...k,lastHoverContextMenuId:C?.id||""}))}},[tt,u.open]),(0,I.useEffect)(()=>{if(u.open){ht("floatingMenuInputMediator").updateInputValue("");let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1),co().then(k=>{l(k)})}else{let k=ne()?.querySelector(`#${Ke}`)?.value;k&&ht("chatBoxInputMediator").updateInputValue(k)}},[u.open]),(0,I.useEffect)(()=>{if(!i.loading&&lo()){let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1)}},[i.loading]);let kt=async C=>{if(C.trim()){let k=m,G="",Ie=r.current?.selectionElement;Ie&&(Ie.isEditableElement?Ie.editableElementSelectionText?k?G=k:G="{{SELECTED_TEXT}}":k?G=k:G="":G="{{SELECTED_TEXT}}");let se=`${C}`;G&&(se+=`:
"""
${G}
"""`),B()||s("Chat"),v([{type:"RENDER_TEMPLATE",parameters:{template:se}},{type:"ASK_CHATGPT",parameters:{}}])}},Pt=(0,I.useRef)(Mt);(0,I.useEffect)(()=>{Pt.current=Mt},[Mt]),(0,I.useEffect)(()=>{if(h.selectedContextMenuId&&lt.length>0&&u.open&&!We){let C=h.selectedContextMenuId,k=!1,G=!1,Ie=!1,se=null;if(ir(C)&&(C=C.replace(yt,""),k=!0),(!p||f.status!=="success")&&(G=!0),Ie=or(C),Ie){let Ue=nr(C);Ue&&(se=Ue)}else se=lt.find(Ue=>Ue.id===C)||null;if(se&&se.id){if(se.data.type==="group")return;Ie||Xe.getMediator("textSelectPopupButton").favoriteContextMenu(se).then().catch(),k&&(se=sr(se)),Te.current=se;let Ue=se.id,Bt=se.data.actions||[];if(M(()=>({selectedContextMenuId:null,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})),B()||s("Chat"),Bt.length>0)v(Bt);else if(Ie){if(G){Oe(),c({open:!1,rootRect:null});return}y(w=>({...w,selectContextMenuId:se?.id||null})),uo(Ue)==="TRY_AGAIN"&&Pt.current(),setTimeout(()=>{y(w=>({...w,selectContextMenuId:null}))},100)}}}},[h.selectedContextMenuId,lt,u.open,We,f.status,p]),(0,I.useEffect)(()=>{},[h.selectedContextMenuId]);let ze=(0,I.useRef)(!1);return(0,I.useEffect)(()=>{let C=je(d);if(d.length>0&&(a==="Chat"||B())){if(ze.current)return;ze.current=!0,Te.current&&(Te.current=null),_o(C),v([]),Te.current||ht("floatingMenuInputMediator").updateInputValue("");let G=r.current?.selectionElement?.isEditableElement,Ie=!1;(!p||f.status!=="success")&&(Ie=!0),(!G||Ie)&&(c({open:!1,rootRect:null}),Oe()),X(""),To().then(()=>{(vo.current?.getNextAction()?.error||"")&&(c({open:!1,rootRect:null}),Oe())}).catch().finally(()=>{ze.current=!1})}},[d,p,a]),(0,I.useEffect)(()=>{let C=(k,G)=>{G&&G?.contextMenu&&(Te.current=G.contextMenu),X(k)};return ht("floatingMenuInputMediator").subscribe(C),()=>{ht("floatingMenuInputMediator").unsubscribe(C)}},[X]),I.default.createElement(no,{root:t},I.default.createElement("div",{ref:S.setFloating,...N(),style:{position:E,zIndex:u.open?2147483601:-1,opacity:u.open?1:0,top:pe??0,left:oe??0,width:Y,maxWidth:"90vw"},onKeyUp:C=>{C.stopPropagation()},id:an,"aria-hidden":u.open?"false":"true"},I.default.createElement(Mo,{customOpen:!0,defaultPlacement:F.contextMenuPlacement,needAutoUpdate:!0,hoverOpen:!1,menuList:tt,referenceElementOpen:u.open,referenceElement:I.default.createElement("div",{style:{boxSizing:"border-box",border:"1px solid",borderColor:o.customColor.borderColor,background:o.customColor.paperBackground,borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",overflow:"hidden",isolation:"isolate",display:"flex",flexDirection:"column",width:"100%",padding:"7px 12px"},onKeyPress:C=>{C.stopPropagation()}},I.default.createElement(qr,null),I.default.createElement(V,{width:"100%",direction:"row",alignItems:"center",gap:1},I.default.createElement(jr,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},size:16,sx:{flexShrink:0,p:"4px",alignSelf:"start"}}),I.default.createElement(V,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left"},We?I.default.createElement(I.default.Fragment,null,I.default.createElement(z,{fontSize:"16px",color:"primary.main"},e("client:floating_menu__input__running_placeholder")),I.default.createElement(Vt,{size:"16px"})):I.default.createElement(Ir,{expandNode:u.open&&I.default.createElement(_r,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},sx:{alignSelf:"end"},direction:"column",size:"tiny"}),placeholder:u.open?e("client:floating_menu__input__placeholder"):"",InputId:Ke,sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:"24px"},onEnter:C=>{!g&&at.length>0||kt(C)}}),!We&&I.default.createElement(I.default.Fragment,null,I.default.createElement(Re,{floatingMenuTooltip:!0,title:e("client:floating_menu__button__send_to_ai"),description:"\u23CE",placement:F.contextMenuPlacement},I.default.createElement(vn,{sx:{height:"24px",width:"24px",borderRadius:"4px",flexShrink:0,alignSelf:"end",alignItems:"center",p:0,m:0,cursor:Et?"pointer":"default",bgcolor:Et?"primary.main":"rgb(219,219,217)","&:hover":{bgcolor:Et?"primary.main":"rgb(219,219,217)"}},onClick:()=>{!g&&at.length>0||kt(R)}},I.default.createElement(Yr.default,{sx:{color:"#fff",fontSize:16}}))),I.default.createElement(Go,{sx:{width:24,height:24,alignSelf:"end"}}),I.default.createElement(At,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0}})),I.default.createElement(qo,null)))),root:t})))};var Qr=P(sn()),Gi="USE_CHAT_GPT_AI".toLowerCase().replace(/_/g,"-"),$i=({containerId:n="modal-root",children:t})=>{let[e,o]=(0,$e.useState)(null),r=(0,$e.useRef)(null);return(0,$e.useEffect)(()=>{let i=document.getElementById(n);if(i){let l=document.createElement("div");l.id=un;let a=document.createElement("style"),s=document.createElement("link");if(s.rel="stylesheet",s.href=Qr.default.runtime.getURL("content_style.css"),i.shadowRoot)i.shadowRoot.appendChild(l),i.shadowRoot.appendChild(a),i.shadowRoot.appendChild(s);else{let u=i.attachShadow({mode:"open"});u.appendChild(l),u.appendChild(a),u.appendChild(s)}r.current=ct({key:`${Gi}-context-menu`,prepend:!0,container:a}),o(l)}},[n]),!e||!r.current?null:(0,Jr.createPortal)($e.default.createElement(ot,{value:r.current},$e.default.createElement(Xr,{root:e}),t),e)},Zr=$i;var ge=P(W());var It=P(W());var Ki=n=>{let{buttonSettingKey:t,placement:e,onClick:o}=n,{t:r}=U(["common","client","prompt"]),{favoriteContextMenuList:i}=ar(t);return It.default.createElement(V,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}}}},i?.map(l=>{let a=!l.data.icon,s=l.text,u=l.id.replace(yt,""),c=`prompt:${u}`;r(c)!==u&&(s=r(c));let m=String(s[0]||"").toUpperCase();return It.default.createElement(Ut,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom"},title:s,key:l.id,sx:{minWidth:"unset",p:a?"6px!important":"8px!important"},onMouseUp:p=>{p.stopPropagation(),p.preventDefault()},onMouseDown:p=>{p.stopPropagation(),p.preventDefault()},onClick:p=>{p.stopPropagation(),p.preventDefault(),o&&o(l)}},a?It.default.createElement(V,{className:"max-ai__click-menu-button--box__text-icon",alignItems:"center",justifyContent:"center",sx:{width:"22px",height:"22px",boxSizing:"border-box",borderRadius:"4px",bgcolor:p=>p.palette.mode==="dark"?"#4f4f4f":"#F5F6F7",color:p=>p.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}},It.default.createElement(z,{component:"span",fontSize:"13px",color:"inherit"},m)):It.default.createElement(de,{icon:l.data.icon,sx:{fontSize:"18px",color:p=>p.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}}))}))},ei=Ki;var qi=n=>{let{t}=U(["common","client"]),{tempSelection:e,show:o,hideRangy:r}=Pe(),{chatBoxShortCutKey:i}=Je(),l=Xt("textSelectPopupButton"),a=me(rt),s=j(ke),u=me(Jt),{closeBeforeRefresh:c}=j(Ye),{showFloatingContextMenu:m}=Ct(),[p]=Q(fe),f=(0,ge.useMemo)(()=>o&&l?.buttonVisible&&!c&&!p.open,[c,o,l,p]),{x,y,strategy:B,refs:g,placement:h}=xt({placement:"bottom-start",middleware:[Zt({fallbackPlacements:["top-start","right","left"]}),to({crossAxis:!0,padding:16}),eo(d=>{if(d.placement.indexOf("bottom")>-1){let v={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight+window.scrollY};return Qn({top:d.y,left:d.x,bottom:d.y+d.rects.floating.height+50,right:d.rects.floating.width+d.x},v)?d.rects.reference.y-d.y-d.rects.floating.height-8:8}else return 8})]});(0,ge.useEffect)(()=>{if(!e||!f)return;let d=ao(e.selectionRect);if(f&&d){if(d=er(d),!nt){document.querySelector("#rangeBorderBox")?.remove();let v=document.createElement("div");v.id="rangeBorderBox",v.style.position="absolute",v.style.left=d.left+"px",v.style.top=d.top+window.scrollY+"px",v.style.width=d.width+"px",v.style.height=d.height+"px",v.style.border="2px solid red",v.style.zIndex="9999",v.style.pointerEvents="none",document.body.appendChild(v)}g.setPositionReference({getBoundingClientRect(){return{...d,x:d.left,y:d.top}}})}},[e,f]);let M=(0,ge.useCallback)(()=>{if(g.floating.current){if(getComputedStyle(g.floating.current).opacity==="0")return;r(),mo(),fo()}},[]);return(0,ge.useEffect)(()=>{let d=v=>{v.key==="Escape"&&M()};return document.addEventListener("keydown",d,!0),()=>{document.removeEventListener("keydown",d,!0)}},[]),(0,ge.useEffect)(()=>{s.loading&&(setTimeout(()=>{M()},1e3),M())},[s.loading]),ge.default.createElement(Wt,{elevation:3,component:"div",ref:g.setFloating,className:`max-ai__click-context-menu ${f?"open":"close"}`,sx:{bgcolor:"transparent",borderRadius:"14px",zIndex:f?2147483600:-1,position:B,opacity:f?1:0,top:y??0,left:x??0,width:"max-content"}},ge.default.createElement(V,{direction:"row",alignItems:"center",sx:{"& .max-ai__click-menu-button--box":{div:{display:"flex"},height:"28px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{"&:has(button)&::after":{display:"none"}},"& button":{bgcolor:"background.paper",minWidth:"unset",padding:"5px 8px!important",boxSizing:"border-box",borderRadius:"0","&:hover":{bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"},"&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 6px!important"}},"&:first-child":{"& button":{borderTopLeftRadius:"14px",borderBottomLeftRadius:"14px",borderTopRightRadius:0,borderBottomRightRadius:0}},"&:not(:last-child)":{"&::after":{content:'""',position:"absolute",right:0,top:"25%",transform:"scale(0.5) translateY(-50%)",width:"1px",height:"32px",bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}}}}},ge.default.createElement(D,{component:"div",className:"max-ai__click-menu-button--box"},ge.default.createElement(Ut,{TooltipProps:{floatingMenuTooltip:!0,placement:h,description:i,sx:{maxWidth:360}},title:t("client:floating_menu__button__cta__tooltip"),className:"usechatgpt-ai__context-menu--handle-button",id:"max_ai__floating_context_menu__cta_button",size:"small",variant:"text",onMouseUp:d=>{d.stopPropagation(),d.preventDefault()},onMouseDown:d=>{d.stopPropagation(),d.preventDefault()},onClick:d=>{d.stopPropagation(),d.preventDefault();let v=window.getSelection()?.rangeCount;if(v&&v>0){let Y=window.getSelection()?.getRangeAt(0)?.cloneRange();u({range:Y||null,selectionText:window?.getSelection()?.toString()||""})}e&&m()}},ge.default.createElement(Ee,{sx:{fontSize:"18px"}}))),ge.default.createElement(ei,{placement:h,buttonSettingKey:"textSelectPopupButton",onClick:d=>{e&&m(),setTimeout(()=>{a(v=>({...v,selectedContextMenuId:d.id}))},100)}}),ge.default.createElement(Xo,{placement:h})))},ti=qi;var he=P(W());var ji=()=>{let{closeBeforeRefresh:n}=j(Ye),{haveSelection:t,showFloatingContextMenu:e,floatingDropdownMenuOpen:o}=Ct(),r=Xt("textSelectPopupButton"),[i,l]=(0,he.useState)(16),[a,s]=(0,he.useState)(3),{chatBoxShortCutKey:u}=Je();return(0,he.useEffect)(()=>{if(!(r?.buttonVisible&&!n)&&t){let c=document.querySelector(`#${Rt}`);c&&c.classList.contains("open")?l((c.getBoundingClientRect().width||0)+16):l(16),s(1)}},[t,r,n]),(0,he.useEffect)(()=>{if(a===1)s(2);else if(a===2){let c=setTimeout(()=>{s(3)},2e3);return()=>{clearTimeout(c)}}return()=>{}},[a]),(0,he.useEffect)(()=>{s(3)},[o]),null;return he.default.createElement(he.default.Fragment,null,u?he.default.createElement(D,{className:"usechatgpt-ai__context-menu--handle-button",sx:{position:"fixed",bottom:16,right:i,zIndex:a!==3?2147483661:-1,backgroundColor:"rgba(98,98,105,1)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",overflow:"hidden",maxWidth:a!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(z,{fontSize:"24px",fontWeight:"bold",color:"#fff",noWrap:!0,sx:{px:"10px",py:"4px"}},u)):he.default.createElement(D,{sx:{position:"fixed",bottom:16,right:i,zIndex:a!==3?2147483661:-1,backgroundColor:"#fff",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",maxWidth:a!==3?"100%":0,display:"grid"},component:"div",onClick:e},he.default.createElement(Wt,{elevation:3,sx:{padding:"8px 10px"}},he.default.createElement(Ee,{sx:{fontSize:24}}))))},oi=ji;var Be=P(W()),si=P(Ao());var H=P(W());var ie=P(W());ko();Po();var Yi=n=>{let{buttonKey:t,children:e,rootId:o,root:r,permissionWrapperCardSceneType:i}=n,[l,a]=(0,ie.useState)(null),{currentSidebarConversationType:s,updateSidebarConversationType:u}=Ce(),{currentUserPlan:c}=Ne(),m=jt(),{createConversation:p}=ft(),{contextMenuList:f}=po(t,"",!1),{loading:x}=j(ke),{setShortCuts:y,runShortCuts:B}=Se(),g=(0,ie.useRef)(null),h=(0,ie.useMemo)(()=>!(i&&c.name==="free"),[i,c]),M=(0,ie.useCallback)(async F=>{if(!x&&F.data.actions){let oe=await Ht(),pe=`ON_BOARDING_RECORD_INPUT_ASSISTANT_BUTTON_${Ae()}_TIMES`,E=Number(oe[pe]||0);if(!h&&i)if(E>0)await _t(pe,E-1);else{Oe(),$t("show",i);let O=await p();await mt("add",O,0,[qt(m[i])]);return}let S=je(F.data.actions);S.splice(0,0,{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{OperationElementElementSelector:`[maxai-input-assistant-button-id="${o}"]`}}}),await y(S),await B(!0)}},[y,B,x,h,i]),d=(0,ie.useRef)(M);(0,ie.useEffect)(()=>{d.current=M},[M]);let v=(0,ie.useRef)(!1),Y=(0,ie.useRef)(s);return(0,ie.useEffect)(()=>{Y.current=s},[s]),(0,ie.useEffect)(()=>{!v.current&&l&&d.current&&Y.current==="Chat"&&(v.current=!0,a(null),d.current(l).then().catch().finally(()=>{v.current=!1}))},[l]),(0,ie.useEffect)(()=>{if(r&&o&&!g.current){let F=document.createElement("style");F.setAttribute("data-emotion-id",o),r.appendChild(F),g.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:F})}},[r,o]),!r||!g.current?null:ie.default.createElement(ot,{value:g.current},ie.default.createElement(Mo,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["bottom-end","bottom","top-start","top-end","top","right","left"],root:r,menuList:f,needAutoUpdate:!0,hoverOpen:!1,menuWidth:240,referenceElement:e,onClickContextMenu:async F=>{u("Chat"),a(F)},onClickReferenceElement:()=>{}}))},Jo=Yi;ko();Po();var Xi=n=>{let{rootId:t,InputAssistantBoxSx:e,DropdownButtonStyle:o,CTAButtonStyle:r,buttonGroup:i,shadowRoot:l,placement:a}=n,s=(0,H.useRef)(null),{t:u}=U(["client"]),[c,m]=(0,H.useState)(null),{loading:p}=j(ke),[f,x]=(0,H.useState)(!1),[y,B]=(0,H.useState)(!1),g=(0,H.useMemo)(()=>{let M=je(r),d=je(o),v={},Y={};if(i.forEach(F=>{F.CTAButtonStyle&&(M=Object.assign(M,{...F.CTAButtonStyle})),F.DropdownButtonStyle&&(d=Object.assign(d,{...F.DropdownButtonStyle}))}),v){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:pe="#fff",hoverColor:E="#fff",borderColor:S="rgb(77, 26, 137)",hoverBorderColor:O="rgb(77, 26, 137)",borderRadius:A="4px 0 0 4px",borderWidth:Z="0 1px 0 0",iconSize:N=20,padding:R="8px 12px"}=M||{};v={minWidth:"unset",backgroundColor:F,color:pe,borderColor:S,borderRadius:A,fontSize:`${N}px`,borderWidth:Z,borderStyle:"solid",position:"relative",padding:R,"&:hover":{color:E,backgroundColor:oe,borderColor:O}}}if(Y){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:pe="#fff",hoverColor:E="#fff",borderColor:S="transparent",hoverBorderColor:O="transparent",borderRadius:A="0 4px 4px 0",borderWidth:Z="0",iconSize:N=20,padding:R="8px 4px"}=d||{};Y={minWidth:"unset",backgroundColor:f?oe:F,color:f?E:pe,borderColor:f?O:S,borderRadius:A,fontSize:`${N}px`,borderWidth:Z,borderStyle:"solid",padding:R,"&:hover":{color:E,backgroundColor:oe,borderColor:O}}}return{ctaButtonSx:v,dropdownButtonSx:Y}},[r,o,f,i]),h=(0,H.useMemo)(()=>{let M=je(e)||{};i.forEach(v=>{v.InputAssistantBoxSx&&Object.assign(M,v.InputAssistantBoxSx)});let d={boxShadow:"0px 2px 3px 1px rgba(118, 1, 211, 0.16), 1px 0px 2px 0px rgba(118, 1, 211, 0.08), -1px 0px 2px 0px rgba(118, 1, 211, 0.08)",...M?.["&:hover"]};return d&&delete M["&:hover"],{...M,...y?d:{}}},[e,y,i]);return(0,H.useEffect)(()=>{if(l){let M=document.createElement("style");l.appendChild(M),s.current=ct({key:"max-ai-input-assistant-context-menu",prepend:!0,container:M})}},[l]),(0,H.useEffect)(()=>{m(document.querySelector(`#${wt}`)?.shadowRoot?.querySelector("div"))},[]),H.default.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"4px",...h},onMouseEnter:()=>B(!0),onMouseLeave:()=>B(!1)},i[0]&&H.default.createElement(Jo,{rootId:t,buttonKey:i[0].buttonKey,permissionWrapperCardSceneType:i[0].permissionWrapperCardSceneType,root:c},H.default.createElement(D,null,H.default.createElement(Re,{placement:a,zIndex:2e6,PopperProps:{container:c},title:u(i[0].tooltip)},H.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"},onMouseEnter:()=>{x(!0)},onMouseLeave:()=>{x(!1)}},s.current&&H.default.createElement(ot,{value:s.current},H.default.createElement(D,{position:"absolute",top:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),H.default.createElement(K,{id:`maxAIInputAssistantCtaButton${t}`,"data-testid":"maxai-input-assistant-cta-button",disabled:p,sx:g.ctaButtonSx},p?H.default.createElement(Vt,{size:r?.iconSize||20,sx:{fontSize:"inherit",color:"#fff"}}):H.default.createElement(Ee,{sx:{fontSize:"inherit",color:"inherit"}})),H.default.createElement(D,{position:"absolute",bottom:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))),i[1]&&H.default.createElement(Jo,{rootId:t,buttonKey:i[1].buttonKey,permissionWrapperCardSceneType:i[1].permissionWrapperCardSceneType,root:c},H.default.createElement(D,null,H.default.createElement(Re,{placement:a,zIndex:2e6,PopperProps:{container:c},title:u(i[1].tooltip)},H.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"}},s.current&&H.default.createElement(ot,{value:s.current},H.default.createElement(D,{position:"absolute",top:`-${o?.transparentHeight||0}px`,width:"100%",height:`${o?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),H.default.createElement(K,{id:`maxAIInputAssistantDropdownButton${t}`,"data-testid":"maxai-input-assistant-dropdown-button",disabled:p,sx:g.dropdownButtonSx},H.default.createElement(de,{icon:"ArrowDropDown",sx:{fontSize:"inherit",color:"inherit"}})),H.default.createElement(D,{position:"absolute",bottom:`-${o?.transparentHeight||0}px`,width:"100%",height:`${o?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))))},ni=Xi;var Ji=n=>{let t=Ae();return t==="mail.google.com"?Qi(n):t==="outlook.office.com"||t==="outlook.live.com"||t==="outlook.office365.com"?Zi(n):t==="twitter.com"?es(n):t==="linkedin.com"?ts(n):t==="facebook.com"?os(n):t==="youtube.com"?[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]:t==="studio.youtube.com"?[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]:t==="instagram.com"?ns(n):[n.buttonGroupConfig.composeReplyButton,n.buttonGroupConfig.refineDraftButton]},Qi=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=document.querySelectorAll("div[data-message-id]");for(let r=0;r<o.length;r++)if(o[r].nextElementSibling?.contains(t))return[e.composeReplyButton,e.refineDraftButton];return[e.composeNewButton,e.refineDraftButton]},Zi=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=document.querySelector('div[data-app-section="ConversationContainer"]'),r=document.querySelector("#ReadingPaneContainerId"),i=r.querySelectorAll('div[role="textbox"]:has(#removeButton)').length,l=r.querySelector("#RplyFwdMsg")||r.querySelector("#divRplyFwdMsg"),a=Array.from(document.querySelectorAll('div[role="dialog"]')).find(u=>u.contains(t)),s=r.querySelector('input[maxlength="255"]')?.value||"";return!o?.contains(t)&&i===0&&!l&&!a&&!s?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},es=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return Sr(t)?.querySelector('article[data-testid="tweet"]')?[e.composeReplyButton,e.refineDraftButton]:Array.from(document.querySelectorAll('article[data-testid="tweet"]')).find(i=>i.nextElementSibling?.contains(t))?[e.composeReplyButton,e.refineDraftButton]:[e.composeNewButton,e.refineDraftButton]},ts=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return t.classList.contains("share-box_actions")?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},os=n=>{let{keyElement:t,buttonGroupConfig:e}=n;return yo('form[method="POST"]',t,20)?[e.composeNewButton,e.refineDraftButton]:yo('form[role="presentation"]',t)?.getBoundingClientRect().width<240?[]:[e.composeReplyButton,e.refineDraftButton]},ns=n=>{let{keyElement:t,buttonGroupConfig:e}=n,o=yo('div[contenteditable="true"]',t,20),r=Cr('div[aria-label][role="dialog"]',o);return o&&r?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},Qo=Ji;var ri=new pt("ContextMenu/InputAssistantButtonManager"),Zo=class{constructor(){this.interval=1e3;this.stop=!1,this.host=Ae(),this.config=bn[this.host],this.observerMap=new Map}createInputAssistantButtonListener(t){this.timer=setInterval(()=>{if(!this.stop&&this.config){let{rootSelectors:e,rootSelectorStyle:o,rootParentDeep:r=0}=this.config,i=[];e.map(s=>i.push(...document.querySelectorAll(s)));let l=!1;i.forEach(s=>{let u=s,c=s,m=r;for(;m>0;)m--,c=c.parentElement;o&&(u.style.cssText=o);let p=this.attachInputAssistantButton(c);p&&(l=!0,ri.info("newObserverData: ",p))}),(this.cleanObserverMap()||l)&&t(this.getAllObserverData(),this.config)}},this.interval)}attachInputAssistantButton(t){if(!this.config||t.querySelector("[maxai-input-assistant-button-id]"))return null;let{rootStyle:e,rootParentStyle:o,rootParentStyleDeep:r=1,rootNextElementSiblingStyle:i,rootPreviousElementSiblingStyle:l}=this.config;if(t&&e){if(l&&t.previousElementSibling){let M=t.previousElementSibling;M.style.cssText=l}if(t.style.cssText=e,i&&t.nextElementSibling){let M=t.nextElementSibling;M.style.cssText=i}}if(o){let M=0,d=t;for(;M<r;)M++,d=d?.parentElement;d&&(d.style.cssText=o)}let a=Ot(),{rootWrapperTagName:s,appendPosition:u,rootWrapperStyle:c}=this.config,m="customElements"in window,p=document.createElement(s);c&&(p.style.cssText=c);let f=document.createElement(m?"maxai-input-assistant-button":"div");if(f.setAttribute("maxai-input-assistant-button-id",a),p.appendChild(f),yn(u)){let M=t.childNodes[u];M?t.insertBefore(p,M):t.appendChild(p)}else t.appendChild(p);f.attachShadow({mode:"open"});let x=f.shadowRoot,y=document.createElement("div");x?.appendChild(y),ri.info("appendElement: ",p);let B=new MutationObserver(()=>{});if(B.observe(t,{childList:!0,subtree:!0}),Qo({keyElement:t,buttonGroupConfig:this.config}).length===0)return B.disconnect(),p.remove(),null;let h={id:a,destroy:()=>{B.disconnect(),p.remove()},renderRootElement:y,observer:B,shadowRootElement:x,buttonGroup:Qo({keyElement:t,buttonGroupConfig:this.config})};return this.observerMap.set(t,h),h}cleanObserverMap(){let t=!1;return this.observerMap.forEach((e,o)=>{let i=Array.from(e.shadowRootElement.querySelectorAll("style[data-emotion]")).find(l=>l.sheet?.cssRules.length===0&&l.innerHTML==="");document.body.contains(o)&&!i||(t=!0,e.destroy(),this.observerMap.delete(o))}),t}clearObserverMap(){this.observerMap.forEach((t,e)=>{t.destroy(),this.observerMap.delete(e)})}getAllObserverData(){let t=[];return this.observerMap.forEach(e=>t.push(e)),t}pause(){this.stop=!0,this.clearObserverMap()}continue(){this.stop=!1}},ii=Zo;var rs=()=>{let n=j(qe),[t,e]=(0,Be.useState)(null),[o,r]=(0,Be.useState)([]),i=Be.default.useRef(null);Le(()=>{i.current=new ii,i.current.createInputAssistantButtonListener((a,s)=>{r(a),e(s)})});let l=(0,Be.useMemo)(()=>{let a=Ae();return a==="mail.google.com"?n.userSettings?.inputAssistantButton?.gmail===!0:a==="outlook.live.com"||a==="outlook.office.com"||a==="outlook.office365.com"?n.userSettings?.inputAssistantButton?.outlook===!0:a==="twitter.com"?n.userSettings?.inputAssistantButton?.twitter===!0:a==="linkedin.com"?n.userSettings?.inputAssistantButton?.linkedIn===!0:a==="facebook.com"?n.userSettings?.inputAssistantButton?.facebook===!0:a==="youtube.com"||a==="studio.youtube.com"?n.userSettings?.inputAssistantButton?.youtube===!0:a==="instagram.com"?n.userSettings?.inputAssistantButton?.instagram===!0:!1},[n.userSettings?.inputAssistantButton]);return(0,Be.useEffect)(()=>{i.current&&(l?i.current?.continue():i.current?.pause())},[l]),Be.default.createElement(Be.default.Fragment,null,o.map(a=>(0,si.createPortal)(Be.default.createElement(ni,{shadowRoot:a.shadowRootElement,rootId:a.id,buttonGroup:a.buttonGroup,root:a.renderRootElement,InputAssistantBoxSx:t?.InputAssistantBoxSx,CTAButtonStyle:t?.CTAButtonStyle,DropdownButtonStyle:t?.DropdownButtonStyle}),a.renderRootElement,a.id)))},ai=rs;var is=()=>et.default.createElement(et.default.Fragment,null,et.default.createElement(Zr,{containerId:Dt},et.default.createElement(ti,null),et.default.createElement(oi,null),et.default.createElement(ui,null)),et.default.createElement(ai,null)),li=is;var ss=He(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="relative"&&(document.documentElement.style.position="unset",document.querySelector(`#${Bo}`)?.classList.replace("open","close"));let t=document.querySelector(`#${wt}`);t&&(t.style.display="none")}},100),as=He(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="unset"&&(document.documentElement.style.position="relative",document.querySelector(`#${Bo}`)?.classList.replace("close","open"));let t=document.querySelector(`#${wt}`);t&&(t.style.display="")}},100),ls=()=>{let n=Ae();Le(()=>{if(n==="youtube.com"){let t=new MutationObserver(o=>{o.forEach(r=>{r.target&&(r.target.hasAttribute("scrolling")?ss():as())})}),e=document.querySelector("ytd-app");e&&t.observe(e,{attributes:!0,childList:!1,subtree:!1})}})},ci=ls;var pi=new pt("AppInit"),us=()=>window.location.host!=="www.usechatgpt.ai"&&window.location.host!=="www.maxai.me"?T.default.createElement(T.default.Fragment,null):T.default.createElement(K,{onClick:()=>{Me({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}),cs=()=>{let n=me(qe),t=me(cn);return fr(),(0,T.useEffect)(()=>{let e=async()=>{let o=await co();o&&(n({...o}),pi.info("get db settings",o));let r=await Mn();r&&(t({...r}),pi.info("get local settings",r))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),T.default.createElement(T.default.Fragment,null)},ps=()=>{let{t:n}=U(["common","client"]),[t,e]=T.default.useState(null),o=T.default.useRef(!1);Le(()=>{window.location.href.includes(en.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")&&e(100)}),dr(()=>{let r=document.body.querySelector("#usechatgptPDFViewerErrorAlert");if(r){if(o.current)return;o.current=!0,e(null);let i=r.getAttribute("data-url");(0,mi.render)(T.default.createElement(V,{spacing:2,p:2,width:"100%",sx:{boxSizing:"border-box"}},T.default.createElement(V,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1.4,color:"#fff"},T.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:48,width:48,src:"/assets/USE_CHAT_GPT_AI/icons/maxai_48_normal.png"}),T.default.createElement(z,{variant:"body1",fontSize:18,fontWeight:700},n("client:pdf__info_card__title"))),T.default.createElement(V,{alignItems:"center",spacing:0},T.default.createElement(z,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},n("client:pdf__info_card__access_permission__description1"),T.default.createElement(zt,{color:"rgba(255,255,255,1)",href:"#",onClick:async l=>{l.preventDefault(),await Me({key:"manage_extension"}),window.close()}},"chrome://extensions"),` ${n("client:pdf__info_card__access_permission__description2")} `),T.default.createElement(z,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:2}},i),T.default.createElement(D,{mb:2},T.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Do("/images/pdf/guide-1.gif")})),T.default.createElement(K,{disableElevation:!0,size:"small",variant:"contained",onClick:async l=>{l.preventDefault(),await Me({key:"manage_extension"}),window.close()},sx:{height:"56px",backgroundColor:"#7601D3",color:"#fff",fontSize:"18px",textTransform:"none",px:3,"&:hover":{backgroundColor:"#7601D3",color:"#fff"}}},n("client:pdf__info_card__access_permission__button"))),T.default.createElement(Pn,{sx:{color:"#fff"}},n("common:or")),T.default.createElement(V,{spacing:2},T.default.createElement(z,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},n("client:pdf__info_card__disabled__description1"),T.default.createElement(zt,{color:"rgba(255,255,255,1)",href:"#",onClick:async l=>{l.preventDefault(),l.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"}),window.close()}},n("client:pdf__info_card__disabled__description2")),n("client:pdf__info_card__disabled__description3")),T.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Do("/images/pdf/guide-2.gif")}))),r);return}},t)},ui=()=>{let{t:n}=U(["client","common"]);return(0,T.useMemo)(()=>window.location.href.includes(en.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")?document.body.querySelector("#usechatgpt-disabled-pdf")||window.localStorage.getItem("hide_usechatgptai_pdf_alert")==="true"?null:T.default.createElement(D,{position:"fixed",right:8,top:40,zIndex:1e4,id:"usechatgpt-disabled-pdf"},T.default.createElement(xo,{icon:T.default.createElement(T.default.Fragment,null),action:T.default.createElement(T.default.Fragment,null),sx:{p:"8px!important",bgcolor:"#fff",border:"1px solid #7601D3","& > div":{"&:first-of-type":{display:"none"},"&:nth-of-type(2)":{padding:"0!important"},"&:last-of-type":{margin:"0!important",padding:"0!important",position:"absolute",top:0,right:0}},"& *":{color:"#7601D3"}}},T.default.createElement(V,{spacing:1,maxWidth:320},T.default.createElement(V,{direction:"row",alignItems:"center",spacing:1},T.default.createElement(Ee,{sx:{fontSize:14}}),T.default.createElement(z,{variant:"body1",fontSize:14,fontWeight:700},n("client:pdf__floating_card__title"))),T.default.createElement(z,{fontSize:14},n("client:pdf__floating_card__description1"),T.default.createElement(zt,{href:"#",onClick:async e=>{e.preventDefault(),e.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"})}},n("client:pdf__floating_card__description2")),n("client:pdf__floating_card__description3")),T.default.createElement(K,{size:"small",disableElevation:!0,sx:{bgcolor:"#7601D3",color:"#fff","&:hover":{bgcolor:"#7601D3"},textTransform:"none"},onClick:async()=>{window.localStorage.setItem("hide_usechatgptai_pdf_alert",JSON.stringify(!0)),ne()?.querySelector("#usechatgpt-disabled-pdf")?.remove()}},n("client:pdf__floating_card__button"))))):null,[n])},ms=()=>(ci(),pr(),Kt(),Ln(),Mr(),Ar(),On(),ps(),Br(),Le(()=>{xn()&&Oe(),Lr(),br().then().catch(),Ur()}),Wr(),Tr(),T.default.createElement(T.default.Fragment,null,T.default.createElement(li,null),T.default.createElement(cs,null),T.default.createElement(us,null))),qd=ms;export{cs as a,qd as b};
