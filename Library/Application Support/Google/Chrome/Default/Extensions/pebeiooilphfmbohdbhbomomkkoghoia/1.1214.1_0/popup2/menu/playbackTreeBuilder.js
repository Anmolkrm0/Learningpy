(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{1e3:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.validateCheckboxCode=void 0;const o=s(865);t.validateCheckboxCode=`\nvar getLocatedElement = ${o.getLocatedElementCode};\nfunction closest(element, selector) {\n    var matches = Element.prototype.matches ||\n        Element.prototype.msMatchesSelector ||\n        Element.prototype.webkitMatchesSelector;\n\n    do {\n        if (matches.apply(element, [selector])) return element;\n        element = element.parentElement || element.parentNode;\n    } while (element !== null && element.nodeType === 1);\n    return null;\n};\n\nfunction locateInputElement(locatedElement, inputType) {\n    var element = getLocatedElement(locatedElement);\n    if(!element) {\n        return { error: { foundElements: 0 } };\n    }\n    var type = element.type;\n    var tagName = element.tagName;\n    \n    if(tagName === "INPUT" && type === inputType) {\n        return { element: element };\n    } else if (tagName === "LABEL" && element.getAttribute('for')) {\n        return { element: element.control || document.getElementById(element.getAttribute('for')) };\n    } else if (element.querySelectorAll('label[for]').length === 1) {\n        element = element.querySelector('label[for]');\n        return { element: element.control || document.getElementById(element.getAttribute('for')) };\n    } else if (closest(element, "label[for]")) {\n        element = closest(element, "label[for]");\n        return { element: element.control || document.getElementById(element.getAttribute('for')) };\n    }\n    \n    var inputs = element.querySelectorAll('input[type=' + inputType + ']');\n    \n    if (inputs.length !== 1) {\n        return { error: { foundElements: inputs.length }  }\n    }\n    \n    return { element: inputs[0] };\n}\n\nfunction isElementChecked(locatedElement, inputType) {\n    var result = locateInputElement(locatedElement, inputType);\n    if (result.error) {\n        return result;\n    }\n    \n    return { checked: result.element.checked };\n}\n`},1001:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.EmptyStepPlayback=void 0;const o=s(818);class n extends o.StepPlayback{execute(){return Promise.resolve({success:true})}}t.EmptyStepPlayback=n},1002:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ScreensShotStepPlayback=void 0;const o=s(993);const n=s(818);const a=s(1003);const i=s(5);const r=s(281);const c=s(292);class l extends Error{constructor(){super("This step can run only in ‘extension’ run mode with either Chrome or Edge Chromium”");Object.setPrototypeOf(this,l.prototype)}}class u extends Error{constructor(e){super("Error capturing screenshot. Device not ready for screenshot capture. Please try again.");this.originalError=e;Object.setPrototypeOf(this,u.prototype)}get shouldRetry(){return true}}class d extends n.StepPlayback{async getImage(){var e,t,s;const o=this.context.getCurrentTabIdOrMainTabId();const n=this.context.getTabUtilsByTabId(o);const{imageCaptureUtils:i,debuggerApiUtils:r,windowUtils:c}=n;const d=this.step;if(d.screenshotType===a.ScreenshotType.ELEMENT){const t=(e=this.context.data[this.step.targetId||"targetId"])===null||e===void 0?void 0:e.rect;const s=await i.takeAreaDataUrl({elementRect:t});return s.elementImage}if(d.screenshotType===a.ScreenshotType.VIEWPORT){return await i.takeImageForComparison()}if(d.screenshotType===a.ScreenshotType.STITCH){return await i.takeStitchedDataUrl()}if(d.screenshotType===a.ScreenshotType.DEBUGGER_FULL_PAGE){if(!(r===null||r===void 0?void 0:r.screenshot)){throw new l}await c.focusTab();const e=(t=this.context.config)===null||t===void 0?void 0:t.isMobileWeb;try{const{data:t}=await r.screenshot(n,{format:"jpeg",fullPage:true,isMobile:e});return`data:image/jpeg;base64,${t}`}catch(e){const t=-32e3;if((e===null||e===void 0?void 0:e.code)===t||((s=e===null||e===void 0?void 0:e.message)===null||s===void 0?void 0:s.includes(`"code":${t}`))){throw new u(e)}throw e}}throw new TypeError(`screenshot type action: ${d.screenshotType} is unknown`)}uploadImage(e){const t=this.context.servicesApi.storage;const{projectId:s,testId:o,testResultId:n}=this.context.getRunContext(this.getStepResultId());if(this.context.shouldCreateNewBaseline(this.step)){return this.context.stepResultUploader.uploadImageAndSaveAsBaseline(e,this.step).imgUrl}return r.assetService.uploadImageArtifactApi({projectId:s,imageDataUrl:e,storageApi:t,testId:o,testResultId:n})}async execute(){var e;if((e=this.context.lightweightMode)===null||e===void 0?void 0:e.disableAssets){return{success:"skipped",reason:`Skipped in ${(0,o.noCase)(this.context.lightweightMode.type)} mode`}}try{const e=await this.getImage();const t=this.uploadImage(e);const s=(0,c.convertTestResultArtifactUrlToCloudinaryOrMinio)(t,Boolean(this.context.company.onprem),this.context.company.storageBaseUrl);return{success:true,data:{stepScreenshot:t,stepReturn:s}}}catch(e){if(e instanceof l){return{success:"skipped",reason:e.message}}if(e instanceof u){return{success:false,shouldRetry:true,errorType:i.commonConstants.stepResult.CAPTURE_SCREENSHOT_FAILURE,reason:e.message}}return{success:false,shouldRetry:false,errorType:i.commonConstants.stepResult.CAPTURE_SCREENSHOT_FAILURE,reason:e&&(e.reason||e.message)||i.commonConstants.stepResult.CAPTURE_SCREENSHOT_FAILURE}}}}t.ScreensShotStepPlayback=d},1003:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ScreenshotStep=t.ScreenshotType=void 0;const o=s(68);const n=s(5);const a=s(59);t.ScreenshotType={ELEMENT:"element",VIEWPORT:"viewport",STITCH:"stitch",DEBUGGER_FULL_PAGE:"debugger-full-page"};class i extends o.Step{constructor(){super(...arguments);this.screenshotType=t.ScreenshotType.VIEWPORT}getIcon(){return"screenshot"}getDisplayName(){if(this.screenshotType===t.ScreenshotType.DEBUGGER_FULL_PAGE){return"Full-page screenshot"}return`Take screenshot ${this.screenshotType}`}getFriendlyName(){return this.getDisplayName()}getTestimDocsUrl(){return n.commonConstants.documentationUrls.PIXEL_VALIDATION_STEP}hasTimeoutOverrideOption(){return true}getSerializableObject(e){var t;return{...super.getSerializableObject(e),element:(t=this.element)===null||t===void 0?void 0:t.getSerializableObject(e),screenshotType:this.screenshotType}}_update(e){if(e.screenshotType!==undefined){this.screenshotType=e.screenshotType}this.updateElement(e.element);return super._update(e)}updateElement(e){if(e){if(this.element){this.element.update(e)}else{e.location||(e.location=this.location);e.tabInfo||(e.tabInfo=this.tabInfo);this.element=a.stepBuilder.buildStepFromData(e)}}}}t.ScreenshotStep=i},1004:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GetCookieStepPlayback=void 0;const o=s(8);const n=s(5);const a=s(879);const i=s(823);const{stepResult:r,exportScopes:c}=n.commonConstants;const l=o.Logger.getLogger("get-cookie-step-playback");function u(e){return{name:e.name,value:e.value,httpOnly:e.httpOnly,hostOnly:e.hostOnly,url:e.url,secure:e.secure,...e.domain&&{domain:e.domain}}}class d extends a.NoElementStepPlayback{async execute(){const{context:e,step:t,exportsGlobal:s,exportsTest:o}=this;const n=await(0,i.computeExpressionPromise)(t.cookieName,e,s,o);const a=await e.stepActionFactory.stepActionUtils.getCookie(n.evaluatedText,e.frameHandler);if(a.length>1){l.warn("Found more than one matching cookie to get")}if(a.length===0){return{errorType:r.GET_COOKIE_FAILURE,success:false,resultInfo:{error:`${n.evaluatedText} doesn't exist`}}}const d=t.exportScope||c.LOCAL;const p=Object.assign(u(a[0]),{url:e.frameHandler.url});const m=t.variableName;return this.reportExecuteResultWithExport(m,p,d)}}t.GetCookieStepPlayback=d},1005:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SetCookieStepPlayback=void 0;const o=s(879);const n=s(5);const a=s(823);const i=s(855);const{stepResult:r}=n.commonConstants;class c extends TypeError{constructor(e,t){super(`No name or value in Cookie ${e} : ${t}`);this.cookie={name:e,value:t}}}function l(e){return e.cookie}class u extends o.NoElementStepPlayback{async execute(){const{step:e,context:t,exportsGlobal:s,exportsTest:o}=this;let n;let u;if(!e.isNewCookie){const a=new i.StepParamsBuilder(e,t,s,o);const r=a.getStepInputs();const c=r.final[e.cookieParamName];u=e.cookieParamName;n=Promise.resolve(c)}else{n=Promise.all([(0,a.computeExpressionPromise)(e.cookieName,t,s,o),(0,a.computeExpressionPromise)(e.value,t,s,o),(0,a.computeExpressionPromise)(e.domain,t,s,o),(0,a.computeExpressionPromise)(e.path,t,s,o)]).then((([s,o,n,a])=>{if(!s.evaluatedText||!o.evaluatedText){throw new c(s.evaluatedText,o.evaluatedText)}u=s.evaluatedText;const i={name:s.evaluatedText,value:o.evaluatedText,httpOnly:e.httpOnly,url:t.frameHandler.url,secure:e.secure};if(n===null||n===void 0?void 0:n.evaluatedText){i.domain=n.evaluatedText}if(a===null||a===void 0?void 0:a.evaluatedText){i.path=a.evaluatedText}if(e.expires>-1){i.expirationDate=Date.now()/1e3+e.expires}return i}))}try{const e=await n;await t.stepActionFactory.stepActionUtils.setCookie(e,t.frameHandler);return{success:true}}catch(t){if(l(t)){if(!t.cookie.name&&!t.cookie.value){return{success:false,errorType:r.MISSING_COOKIE_NAME_AND_VALUE}}if(!t.cookie.name){return{success:false,errorType:r.MISSING_COOKIE_NAME}}return{success:false,errorType:r.MISSING_COOKIE_VALUE}}return{success:false,errorType:r.COULDNT_SET_COOKIE,resultInfo:e.cookieParamName||u}}}}t.SetCookieStepPlayback=u},1006:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DebuggerProtocolStepPlayback=void 0;const o=s(818);class n extends o.StepPlayback{shouldAttachDebugger(){return true}}t.DebuggerProtocolStepPlayback=n},1007:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NetworkValidationStepPlayback=void 0;const o=s(6);const n=s(849);class a extends n.JSStepPlayback{getStepSpecificParams(){return{networkRequests:this.context.getRequestsData()}}cleanStepSpecificParams(e){if(e.networkRequests){e.networkRequests=e.networkRequests.map((e=>o.omit(e,["requestBody","responseBody"])))}return e}shouldAttachDebugger(){return true}}t.NetworkValidationStepPlayback=a},1008:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.PixelValidationStepPlayback=void 0;const o=s(6);const n=s(993);const a=s(818);const i=s(135);class r extends a.StepPlayback{getFrameLocators(){return super.getFrameLocators()||[]}getElementLocators(){var e;return((e=this.step.element)===null||e===void 0?void 0:e.elementLocator)?[this.step.element]:[]}getFinalParamsFromContext(e){var t;return((t=e===null||e===void 0?void 0:e.incomingParams)===null||t===void 0?void 0:t.final)||{}}async onBeforeExecute(e){var t,s,o;await super.onBeforeExecute(e);const n=e=>({isPixelValidationExecutionResult:true,success:"skipped",shouldRetry:false,reason:e});const{context:a}=this;const{skipPixelValidationSteps:i}=this.getFinalParamsFromContext(a);const r="Visual validation";if(i){throw n(`${r} was disabled using the 'skipPixelValidationSteps' flag`)}const c=a.getRunContext(this.getStepResultId());if(!((o=(s=(t=c.company)===null||t===void 0?void 0:t.activePlan)===null||s===void 0?void 0:s.premiumFeatures)===null||o===void 0?void 0:o.applitools)){throw n(`${r} is not enabled in your current plan`)}if(!c.applitoolsConnected){throw n("Applitools integration is not configured, please check the integration tab")}}async execute(){var e;const{context:t,step:s,parentStep:a,exportsGlobal:r,exportsTest:c}=this;if((e=t.lightweightMode)===null||e===void 0?void 0:e.disablePixelValidation){return this.onExecuteResult({success:"skipped",reason:`Skipped in ${(0,n.noCase)(t.lightweightMode.type)} mode`})}const l=!o.isEmpty(t.config.applitoolsEnvironments)||!o.isEmpty(s.applitoolsData.additionalEnvironments);t.shouldUseVisualGrid=s.type!=="wait-for-simple-ui-verification"&&l;t.stepPlayerParentStep=a;const{config:u,loggerConfig:d}=(0,i.buildApplitoolsSdkConfig)(t,s);t.applitoolsSdkConfig=u;t.applitoolsSdkLogger=d;const p=await t.stepActionFactory.executeStep({stepData:s,context:t,frameHandler:t.frameHandler,exportsGlobal:r,locateElementPlayer:null,exportsTest:c});return this.onExecuteResult(p)}async onResult(e){if(e===null||e===void 0?void 0:e.isApplitoolsSdkResult){const t=await(0,i.handleApplitoolsSdkResult)(this.context,e,this.step);return super.onResult(t)}return super.onResult(e)}}t.PixelValidationStepPlayback=r},1009:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CssPropertyValidationPlayback=void 0;const o=s(818);const n=s(1010);const a=s(5);const i=s(823);class r extends o.StepPlayback{async execute(){const{step:e,context:t,exportsGlobal:s,exportsTest:o}=this;const r=t.data[this.step.targetId||"targetId"];const c=(0,i.computeExpression)(e.cssPropName,t,s,o);const l=(0,i.computeExpression)(e.expectedCssPropValue,t,s,o);const u=`${c.evaluatedText}`.replace(/"/g,'\\"');const d=`${l.evaluatedText}`.replace(/"/g,'\\"');const p=await t.stepActionFactory.stepActionUtils.executeInAut(this.context,`\n            ${n.getCssPropertyValue}\n            return getCssPropertyValue(${JSON.stringify(r.locatedElement)}, "${u}", "${d}");\n        `);if(p.error){if(p.error===a.commonConstants.stepResult.ELEMENT_NOT_FOUND){return this.onExecuteResult({success:false,errorType:a.commonConstants.stepResult.ELEMENT_NOT_FOUND})}if(p.error===a.commonConstants.stepResult.CSS_PROPERTY_NOT_FOUND){return this.onExecuteResult({success:false,resultInfo:{propName:c.evaluatedText},errorType:a.commonConstants.stepResult.CSS_PROPERTY_NOT_FOUND})}return this.onExecuteResult({success:false,reason:p.error,errorType:a.commonConstants.stepResult.UNWRAPPED_AUT_REJECT})}if(p.cssPropValue!==p.normalizedOutput){return this.onExecuteResult({success:false,resultInfo:{expected:l.evaluatedText,actual:p.cssPropValue},errorType:a.commonConstants.stepResult.CSS_PROPERTY_COMPARE_FAILURE})}return this.onExecuteResult({success:true})}}t.CssPropertyValidationPlayback=r},1010:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getCssPropertyValue=void 0;const o=s(865);const n=s(5);t.getCssPropertyValue=`\nvar getLocatedElement = ${o.getLocatedElementCode};\n\nfunction getCssPropertyValue(locatedElement, cssPropName, expectedCssValue) {\n    var element = getLocatedElement(locatedElement);\n    if (!element) {\n        return { error: '${n.commonConstants.stepResult.ELEMENT_NOT_FOUND}' };\n    }\n    var compStyles = window.getComputedStyle(element);\n    var currentValue = compStyles[cssPropName];\n    var normalizedOutput = expectedCssValue;\n    if (!currentValue) {\n        return { error: '${n.commonConstants.stepResult.CSS_PROPERTY_NOT_FOUND}' };\n    }\n    if (currentValue !== expectedCssValue) {\n        var elmParent = element.parentNode || document.body;\n        var fakeElement = document.createElement('div');\n        fakeElement.style[cssPropName] = expectedCssValue;\n        // managed to set value, or value is empty\n        if (fakeElement.style[cssPropName] !== '' || expectedCssValue === '') {\n            elmParent.appendChild(fakeElement);\n            var fakeComputed = window.getComputedStyle(fakeElement);\n            normalizedOutput = fakeComputed[cssPropName] || normalizedOutput;\n            elmParent.removeChild(fakeElement);\n        }\n    }\n\n    return { cssPropValue: currentValue, normalizedOutput: normalizedOutput };\n}\n`},1011:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.HtmlAttributeValidationPlayback=void 0;const o=s(818);const n=s(1012);const a=s(5);const i=s(823);const r=s(7);class c extends o.StepPlayback{async execute(){const{step:e,context:t,exportsGlobal:s,exportsTest:o}=this;const c=t.data[this.step.targetId||"targetId"];const l=(0,i.computeExpression)(e.htmlAttrName,t,s,o);const u=(0,i.computeExpression)(e.expectedHtmlAttrValue,t,s,o);const d=await t.stepActionFactory.stepActionUtils.executeInAut(this.context,`\n            ${n.getHtmlAttributeValue}\n            return getHtmlAttributeValue(${JSON.stringify(c.locatedElement)}, "${l.evaluatedText}")\n        `);if(d.error){if(d.error===a.commonConstants.stepResult.ELEMENT_NOT_FOUND){return this.onExecuteResult({success:false,errorType:a.commonConstants.stepResult.ELEMENT_NOT_FOUND})}if(d.error===a.commonConstants.stepResult.HTML_ATTRIBUTE_NOT_FOUND){return this.onExecuteResult({success:false,resultInfo:{attrName:l.evaluatedText},errorType:a.commonConstants.stepResult.HTML_ATTRIBUTE_NOT_FOUND})}return this.onExecuteResult({success:false,reason:d.error,errorType:a.commonConstants.stepResult.UNWRAPPED_AUT_REJECT})}if(!r.utils.compareOrMatch(u.evaluatedText,d.htmlAttributeValue)){return this.onExecuteResult({success:false,resultInfo:{expected:u.evaluatedText,actual:d.htmlAttributeValue},errorType:a.commonConstants.stepResult.HTML_ATTRIBUTE_COMPARE_FAILURE})}return this.onExecuteResult({success:true})}}t.HtmlAttributeValidationPlayback=c},1012:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getHtmlAttributeValue=void 0;const o=s(865);const n=s(5);t.getHtmlAttributeValue=`\nvar getLocatedElement = ${o.getLocatedElementCode};\n\nfunction getHtmlAttributeValue(locatedElement, htmlAttrName) {\n    var element = getLocatedElement(locatedElement);\n    if (!element) {\n        return { error: '${n.commonConstants.stepResult.ELEMENT_NOT_FOUND}' };\n    }\n\n    if (!element.hasAttribute || !element.hasAttribute(htmlAttrName)) {\n        return { error: '${n.commonConstants.stepResult.HTML_ATTRIBUTE_NOT_FOUND}' };\n    }\n\n    var currentValue = element.getAttribute && element.getAttribute(htmlAttrName);\n    return { htmlAttributeValue: currentValue };\n}\n`},1013:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.AccessibilityValidationPlayback=t.removeTestimItems=t.removeTestimElementIdsFromTarget=t.removeTestimAttributes=t.removeTestimElementIds=void 0;const o=s(6);const n=s(818);const a=s(1014);const i=s(5);const r=s(1015);const{TESTIM_ID_FIELD_NAME:c,DYNAMIC_PARENT_FIELD_NAME:l,DYNAMIC_CHILD_FIELD_NAME:u,TESTIM_FRAME_ID:d,CONTEXT_ATTR:p,CONTEXT_POINTER_ATTR:m,TESTIM_SHADOW_ROOT_ID:f}=i.commonConstants.locators;const h=[c,l,d,p,m,u,f];const g=e=>e.map((e=>({...e,...{impactValue:a.impacts[e.impact]}})));const y=h.map((e=>o.escapeRegExp(e))).join("|");const b=new RegExp(`\\[\\b(?:${y})\\b=".*?"\\]`,"gm");const v=new RegExp(`\\b(?:${y})\\b=".*?"`,"gm");const x=e=>e.map((e=>e.replace(b,"")));t.removeTestimElementIds=x;const S=e=>e.replace(v,"");t.removeTestimAttributes=S;const E=e=>e.map((e=>(0,t.removeTestimElementIds)(e)));t.removeTestimElementIdsFromTarget=E;const T=e=>{const s=e=>Array.isArray(e)&&e.every(Array.isArray);const o=e=>{e.html=(0,t.removeTestimAttributes)(e.html);e.target=s(e.target)?(0,t.removeTestimElementIdsFromTarget)(e.target):(0,t.removeTestimElementIds)(e.target)};e.forEach((e=>{e.nodes.forEach((e=>{var t;o(e);(t=e===null||e===void 0?void 0:e.any)===null||t===void 0?void 0:t.forEach((e=>{var t;return(t=e.relatedNodes)===null||t===void 0?void 0:t.forEach(o)}))}))}))};t.removeTestimItems=T;const P=(e,s)=>{if(!e||!e.data||!e.success){return{success:false,errorType:i.commonConstants.stepResult.ACCESSIBILITY_VALIDATION_EXCEPTION,resultInfo:{error:(e===null||e===void 0?void 0:e.reason)||"failed to run script"}}}const{violations:o,incomplete:n,passes:r}=e.data;if(o.length>0||n.length>0){(0,t.removeTestimItems)(r);(0,t.removeTestimItems)(n);(0,t.removeTestimItems)(o);const e=g(r);const c=g(n);const l=g(o);const u=l.filter((e=>a.impacts[s]>=e.impactValue));const d=c.filter((e=>a.impacts[s]>=e.impactValue));if(u.length>0||d.length>0){return{success:false,errorType:i.commonConstants.stepResult.ACCESSIBILITY_VALIDATION_VIOLATIONS,resultInfo:{violations:u.length,incomplete:d.length},accessibilityResult:{violations:l,incomplete:c,passes:e,impactLevel:s}}}}return{success:true}};class w extends n.StepPlayback{getElementLocators(){var e;return((e=this.step.element)===null||e===void 0?void 0:e.elementLocator)?[this.step.element]:[]}async injectAxe(){const{context:e}=this;const t=await e.stepActionFactory.stepActionUtils.executeInAut(e,"return Boolean(window.axe);");if(!t){await e.stepActionFactory.stepActionUtils.executeInAut(e,(0,r.injectAxe)())}}async execute(e){var t,s;const{step:o,context:n}=this;const a=n.company.followL2CPlan;if(a&&!((s=(t=n.company.activePlan)===null||t===void 0?void 0:t.premiumFeatures)===null||s===void 0?void 0:s.accessabilityStep)){return{success:"skipped",reason:"Accessibility validation step is not enabled in your current plan."}}const{impactLevel:c,ruleTags:l,excludedRuleIds:u}=o;if(!this.context.stepActionFactory.stepActionUtils.runCodeInFrameAsync){return{success:"skipped",reason:"This step can run only in ‘extension’ run mode with either Chrome or Edge Chromium"}}try{if(o.mode==="page"){await this.injectAxe();const{tabId:t}=n.frameHandler;const s=await this.context.stepActionFactory.stepActionUtils.runCodeInFrameAsync(t,(0,r.accessibilityPage)(l,u),undefined,e);return P(s,c)}if(o.mode==="element"){const t=this.context.data[o.targetId||"targetId"];const{frameId:s,tabId:a}=n.frameHandler;await this.injectAxe();const i=await n.stepActionFactory.stepActionUtils.runCodeInFrameAsync(a,`async () => {\n                        ${(0,r.accessibilityElement)(l,u)}\n                        return runAccessibilityOnElement(${JSON.stringify(t.locatedElement)});\n                    }`,s,e);return P(i,c)}return{success:true}}catch(e){return{success:false,errorType:i.commonConstants.stepResult.ACCESSIBILITY_VALIDATION_EXCEPTION,resultInfo:{error:e.message}}}}}t.AccessibilityValidationPlayback=w},1014:function(e,t,s){"use strict";var o=this&&this.__decorate||function(e,t,s,o){var n=arguments.length,a=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,s):o,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;r>=0;r--)if(i=e[r])a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a;return n>3&&a&&Object.defineProperty(t,s,a),a};var n=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:true});t.AccessibilityValidationStep=t.impacts=t.axeRuleTagFriendlyNames=t.axeRuleTags=t.AXE_RULE_IDS=t.axeRuleTagsMap=void 0;const a=s(2);const i=s(5);const r=s(110);const c=s(59);t.axeRuleTagsMap={"best-practice":"Accessibility best practices","cat.keyboard":"Keyboard category","cat.text-alternatives":"Text alternatives category",wcag2a:"WCAG 2.0 level a",wcag111:"WCAG 1.1.1",wcag244:"WCAG 2.4.4",wcag412:"WCAG 4.1.2",section508:"Old section 508 rules","section508.22.a":"Old section 508.22.a rules","cat.aria":"Aria category","cat.name-role-value":"Name role value category",wcag131:"WCAG 1.3.1","cat.time-and-media":"Time and media category",wcag121:"WCAG 1.2.1","cat.forms":"Forms category",wcag21aa:"WCAG 2.1 level aa",wcag135:"WCAG 1.3.5",wcag1412:"WCAG 1.4.12",wcag222:"WCAG 2.2.2","section508.22.j":"Old section 508.22.a rules",wcag241:"WCAG 2.4.1","section508.22.o":"Old section 508.22.o rules","cat.color":"Color category",wcag2aa:"WCAG 2.0 level aa",wcag143:"WCAG 1.4.3","cat.structure":"Structure category",wcag134:"WCAG 1.3.4",wcag242:"WCAG 2.4.2",ACT:"ACT","cat.parsing":"Parsing category",wcag411:"WCAG 4.1.1",wcag332:"WCAG 3.3.2","section508.22.i":"Old section 508.22.i rules","cat.semantics":"Semantics category","cat.language":"Language category",wcag311:"WCAG 3.1.1",wcag2aaa:"WCAG 2.0 level aaa",wcag249:"WCAG 2.4.9","section508.22.n":"Old section 508.22.n rules",wcag21a:"WCAG 2.1 level a",wcag253:"WCAG 2.5.3",wcag141:"WCAG 1.4.1",wcag221:"WCAG 2.2.1",wcag224:"WCAG 2.2.4",wcag325:"WCAG 3.2.5","cat.sensory-and-visual-cues":"Sensory and visual cues category",wcag142:"WCAG 1.4.2","cat.tables":"Tables category",wcag211:"WCAG 2.1.1","section508.22.f":"Old section 508.22.f rules","section508.22.g":"Old section 508.22.g rules",wcag312:"WCAG 3.1.2",wcag122:"WCAG 1.2.2"};t.AXE_RULE_IDS=["accesskeys","area-alt","aria-allowed-attr","aria-allowed-role","aria-command-name","aria-dialog-name","aria-hidden-body","aria-hidden-focus","aria-input-field-name","aria-meter-name","aria-progressbar-name","aria-required-attr","aria-required-children","aria-required-parent","aria-roledescription","aria-roles","aria-text","aria-toggle-field-name","aria-tooltip-name","aria-treeitem-name","aria-valid-attr-value","aria-valid-attr","audio-caption","autocomplete-valid","avoid-inline-spacing","blink","button-name","bypass","color-contrast","css-orientation-lock","definition-list","dlitem","document-title","duplicate-id-active","duplicate-id-aria","duplicate-id","empty-heading","empty-table-header","focus-order-semantics","form-field-multiple-labels","frame-focusable-content","frame-tested","frame-title-unique","frame-title","heading-order","hidden-content","html-has-lang","html-lang-valid","html-xml-lang-mismatch","identical-links-same-purpose","image-alt","image-redundant-alt","input-button-name","input-image-alt","label-content-name-mismatch","label-title-only","label","landmark-banner-is-top-level","landmark-complementary-is-top-level","landmark-contentinfo-is-top-level","landmark-main-is-top-level","landmark-no-duplicate-banner","landmark-no-duplicate-contentinfo","landmark-no-duplicate-main","landmark-one-main","landmark-unique","link-in-text-block","link-name","list","listitem","marquee","meta-refresh","meta-viewport-large","meta-viewport","nested-interactive","no-autoplay-audio","object-alt","p-as-heading","page-has-heading-one","presentation-role-conflict","region","role-img-alt","scope-attr-valid","scrollable-region-focusable","select-name","server-side-image-map","skip-link","svg-img-alt","tabindex","table-duplicate-name","table-fake-caption","td-has-header","td-headers-attr","th-has-data-cells","valid-lang","video-caption"];t.axeRuleTags=Object.keys(t.axeRuleTagsMap);t.axeRuleTagFriendlyNames=Object.values(t.axeRuleTagsMap);t.impacts={critical:1,serious:2,moderate:3,minor:4};class l extends r.ParameterStep{constructor(){super(...arguments);this.mode="page";this.impactLevel="minor";this.ruleTags=[];this.excludedRuleIds=[]}_update(e){if(e.mode){this.mode=e.mode}if(e.impactLevel){this.impactLevel=e.impactLevel}if(e.ruleTags){this.ruleTags=e.ruleTags}if(e.excludedRuleIds){this.excludedRuleIds=e.excludedRuleIds}if(e.element){if(this.element){this.element.update(e.element)}else{this.element=c.stepBuilder.buildStepFromData(e.element)}}return super._update(e)}getIcon(){return"a11y-step"}getDisplayName(){let e="";if(this.mode==="element"){e="Accessibility validation"}if(this.mode==="page"){e="Page accessibility validation"}return this.targetName?`${e} - ${this.targetName}`:e}getFriendlyName(){return"Accessibility validation"}getTestimDocsUrl(){return this.mode==="element"?i.commonConstants.documentationUrls.ELEMENT_ACCESSIBILITY_STEP:i.commonConstants.documentationUrls.PAGE_ACCESSIBILITY_STEP}hasAutoScrollOption(){if(this.mode==="element"){return true}return false}hasTimeoutOverrideOption(){return true}getThumbnailElement(){return this.element}getSerializableObject(e){var t;return{...super.getSerializableObject(e),mode:this.mode,impactLevel:this.impactLevel,ruleTags:this.ruleTags,excludedRuleIds:this.excludedRuleIds,element:(t=this.element)===null||t===void 0?void 0:t.getSerializableObject(e)}}}t.AccessibilityValidationStep=l;o([a.observable,n("design:type",Object)],l.prototype,"impactLevel",void 0)},1015:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.accessibilityElement=t.accessibilityPage=t.injectAxe=void 0;const o=s(865);const n=s(5);const a=()=>{const e=s(1016).default;return`\nif (!window.axe) {\n  ${e}\n  axe.configure({ branding: { application: 'testim' } });\n}\n`};t.injectAxe=a;const i=e=>{if(!e||e.length===0){return"{}"}return`{\n        runOnly: {\n            type: 'tag',\n            values: ['${e.join("', '")}']\n        }\n    }`};const r=e=>{if(!e||e.length===0){return"{}"}const t={};e.forEach((e=>{t[e]={enabled:false}}));return`{\n        rules: ${JSON.stringify(t)}\n    }\n    `};const c=(e,t)=>`async () => {\n  const runOnly = ${i(e)};\n  const rules = ${r(t)};\n  return await axe.run(\n        {\n            exclude: [['body', 'testim-shadow-container']],\n        },\n        {\n        absolutePaths: true,\n        xpath: true,\n        ancestry: true,\n        ...runOnly,\n        ...rules\n        }\n    );\n}`;t.accessibilityPage=c;const l=(e,t)=>`\nvar getLocatedElement = ${o.getLocatedElementCode};\n\nfunction runAccessibilityOnElement(locatedElement) {\n    const element = getLocatedElement(locatedElement);\n    if (!element) {\n        return { error: '${n.commonConstants.stepResult.ELEMENT_NOT_FOUND}' };\n    }\n    const runOnly = ${i(e)};\n    const rules = ${r(t)};\n    \n    return axe.run(element, {\n      absolutePaths: true,\n      xpath: true,\n      ancestry: true,\n      resultTypes: ['violations'],\n      ...runOnly, \n      ...rules\n    });\n}\n`;t.accessibilityElement=l},1017:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DateGeneratorStepPlayback=void 0;const o=s(97);const n=s(180);const a=s(5);const i=s(818);const r=s(1018);o.extend(n);class c extends i.StepPlayback{async getDateValue(){var e,t,s;const{step:{browserTimezone:n},context:a}=this;const i=(s=(t=(e=a.playback).isMobileProject)===null||t===void 0?void 0:t.call(e))!==null&&s!==void 0?s:false;if(i||!n){return o.utc()}const r=await a.stepActionFactory.stepActionUtils.executeInAut(a,"return (new Date()).toString();");return o(r)}formatDate(e){const{step:{dateFormat:t=r.DEFAULT_DATE_FORMAT,timeDiffAmount:s,timeDiffUnit:o}}=this;if(!s){return e.format(t)}return e.add(s,o||"second").format(t)}async execute(){const{step:{exportScope:e=a.commonConstants.exportScopes.LOCAL,paramName:t}}=this;const s=this.formatDate(await this.getDateValue());return this.reportExecuteResultWithExport(t,s,e)}getFrameLocators(){return[]}}t.DateGeneratorStepPlayback=c},1018:function(e,t,s){"use strict";var o=this&&this.__decorate||function(e,t,s,o){var n=arguments.length,a=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,s):o,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;r>=0;r--)if(i=e[r])a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a;return n>3&&a&&Object.defineProperty(t,s,a),a};var n=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var a;Object.defineProperty(t,"__esModule",{value:true});t.DateGeneratorStep=t.DEFAULT_DATE_FORMAT=void 0;const i=s(68);const r=s(97);const c=s(5);const l=s(2);t.DEFAULT_DATE_FORMAT="YYYY-MM-DD";class u extends i.Step{constructor(){super(...arguments);this.dateFormat=t.DEFAULT_DATE_FORMAT;this.paramName="dateValue";this.exportScope="test";this.browserTimezone=true;this.timeDiffAmount=0;this.timeDiffUnit="second"}_update(e){if(e.dateFormat){this.dateFormat=e.dateFormat}if(e.paramName){this.paramName=e.paramName}if(e.exportScope){this.exportScope=e.exportScope}if(Object.hasOwn(e,"browserTimezone")){this.browserTimezone=Boolean(e.browserTimezone)}if(Object.hasOwn(e,"timeDiffAmount")){this.timeDiffAmount=e.timeDiffAmount}if(Object.hasOwn(e,"timeDiffUnit")){this.timeDiffUnit=e.timeDiffUnit}return super._update(e)}getIcon(){return"date-generator-step"}getDisplayName(){return"Generate Date"}getFriendlyName(){return"Generate Date"}getTestimDocsUrl(){return c.commonConstants.documentationUrls.GENERATE_DATE_STEP}getSerializableObject(e){return{...super.getSerializableObject(e),dateFormat:this.dateFormat,paramName:this.paramName,exportScope:this.exportScope,browserTimezone:this.browserTimezone,timeDiffAmount:this.timeDiffAmount,timeDiffUnit:this.timeDiffUnit}}}t.DateGeneratorStep=u;o([l.observable,n("design:type",Object)],u.prototype,"dateFormat",void 0);o([l.observable,n("design:type",Object)],u.prototype,"paramName",void 0);o([l.observable,n("design:type",Object)],u.prototype,"browserTimezone",void 0);o([l.observable,n("design:type",Object)],u.prototype,"timeDiffAmount",void 0);o([l.observable,n("design:type",typeof(a=typeof r.UnitType!=="undefined"&&r.UnitType)==="function"?a:Object)],u.prototype,"timeDiffUnit",void 0)},1019:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GenerateRandomFieldStepPlayback=void 0;const o=s(1020);const n=s(818);const a=s(5);const{exportScopes:i}=a.commonConstants;class r extends n.StepPlayback{async execute(){const{step:e}=this;const{exportScope:t=i.LOCAL,paramName:s,fieldType:o,fieldOptions:n}=e;const a=this.generateData(o,n);return this.reportExecuteResultWithExport(s,a,t)}getFrameLocators(){return[]}generateData(e,t){return(new o.Chance)[e](t)}}t.GenerateRandomFieldStepPlayback=r},1021:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DebugLabFeatureStepPlayback=void 0;const o=s(818);const n=s(5);const a="debugLabFeatureForTestimDevsMigrated";class i extends o.StepPlayback{async execute(){const{step:e}=this;const{expectedLabFeatureState:t}=e;try{const e=this.isLabFeatureAvailable(a);if(e===t){return this.onExecuteResult({success:true})}return this.onExecuteResult({success:false,resultInfo:{error:`expected: ${t}, actual: ${e}`},errorType:n.commonConstants.stepResult.DEBUG_LAB_FEATURE_FAILURE})}catch(e){if(e instanceof o.MissingLabFeaturesError){return this.onExecuteResult({success:false,resultInfo:{error:"LabFeaturesService is missing"},errorType:n.commonConstants.stepResult.DEBUG_LAB_FEATURE_FAILURE})}throw e}}getFrameLocators(){return[]}}t.DebugLabFeatureStepPlayback=i},1022:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.EmailGeneratorPlayback=void 0;const o=s(5);const n=s(879);const a=s(831);const i=s(936);class r extends n.NoElementStepPlayback{async execute(){var e,t,s;const{step:n,context:r}=this;const c=a.playbackLogger.getLogger(this.context.loggerKey);if(!((s=(t=(e=r.company)===null||e===void 0?void 0:e.activePlan)===null||t===void 0?void 0:t.premiumFeatures)===null||s===void 0?void 0:s.emailValidation)){return{success:"skipped",reason:"Generate email address is not enabled in your current plan."}}const l=n.emailParamName;if(!l){throw new i.EvaluateExpressionError}const u=n.exportScope||o.commonConstants.exportScopes.LOCAL;try{const e=await this.testimServicesApi.emailValidation.generateTempEmail(r.projectId);if(e.success){const t=e.data.email;c.log("generate email successfully",t,u);return this.reportExecuteResultWithExport(l,t,u)}throw Object.assign(new Error(""),{success:false,code:e.code,errorType:o.commonConstants.stepResult.EMAIL_GENERATE_FAILURE})}catch(e){return{success:false,reason:e.message,exception:e,errorType:o.commonConstants.stepResult.EMAIL_GENERATE_FAILURE}}}}t.EmailGeneratorPlayback=r},1023:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ExtractTextStepPlayback=void 0;const o=s(818);const n=s(5);const a=s(937);const{stepResult:i,exportScopes:r}=n.commonConstants;class c extends o.StepPlayback{async execute(){const{context:e,step:t}=this;const s=e.data[t.targetId||"targetId"];const o=t.extractTextParamName;let n;try{const i=await e.stepActionFactory.stepActionUtils.extractTargetText(s,e);const c=t.exportScope||r.LOCAL;const l=t.getExtractMode();const u=t.trimSpaces;const d={mode:l,setting:this.step.getModeSetting(),trimSpaces:Boolean(u)};if(d.mode==="regex"){d.regex=this.step.getRegex()}const p=(0,a.extractText)(i,d);n=this.reportExecuteResultWithExport(o,p,c)}catch(e){n={success:false,exception:e,errorType:i.EXTRACT_TEXT_FAILURE,resultInfo:{error:e.message}}}return await super.onExecuteResult(n)}}t.ExtractTextStepPlayback=c},1118:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MouseStepPlayback=void 0;const o=s(818);class n extends o.StepPlayback{init(){this.step.addMissingEventsForSimpleClick();return super.init()}}t.MouseStepPlayback=n},1119:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.TextValidationStepPlayback=void 0;const o=s(7);const n=s(823);const a=s(818);class i extends a.StepPlayback{init(e){this.innerSteps=this.step.expression2&&this.step.element?Promise.resolve([this.buildStepPlayer(e,this.step.expression2),this.buildStepPlayer(e,this.step.element)]):Promise.resolve([])}runExpressionStep(e){return o.utils.isRegExp(e.step.expression)?{evaluatedText:e.step.expression}:(0,n.computeExpression)(e.step,this.context,this.exportsGlobal,this.exportsTest)}async runPreLocateActions(){const e=await this.innerSteps;const t=e[0];if(!t){throw Object.assign(new Error("Text validation cannot be run without selected element"),{success:false,reason:"Text validation cannot be run without selected element",shouldRetry:false})}const s=this.runExpressionStep(t);const{element:o}=this.step.getSerializableObject();this.step._updateElementTextSelector(o,String(s.evaluatedText))}}t.TextValidationStepPlayback=i},1120:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileTextValidationStepPlayback=void 0;const o=s(7);const n=s(823);const a=s(818);const i=s(5);const r=s(941);const c=s(872);class l extends a.StepPlayback{init(e){this.innerSteps=this.step.expression2&&this.step.element?Promise.resolve([this.buildStepPlayer(e,this.step.expression2),this.buildStepPlayer(e,this.step.element)]):Promise.resolve([])}async execute(){const{context:e,step:t}=this;let s;const a=this.locateElementPlayer;const l=new a(e);try{if(!e.appiumApi){return{success:false}}const a=new c.AlgoUtils.IncrementLogger("Mobile Text Validation Playback");const{locatedElement:u}=await l.locate({locatorStep:this.step.element,addVisibilityInfo:true,allowScrollSearch:false,retryIndex:null,incrementLogger:a});if(!u){return{success:false}}s=Object.fromEntries(u.selectorsScores.entries());const d=await(0,r.getLocatedElementText)(u,e);const p=(0,n.computeExpression)(t.expression2,e,this.exportsGlobal,this.exportsTest);const m=p.evaluatedText;const f=o.utils.compareOrMatch(m,d);if(f){return{success:true,selectorsScores:s}}return{errorType:i.stepResult.TEXT_COMPARE_FAILURE,resultInfo:{expected:String(m),actual:d},success:false,selectorsScores:s}}catch(e){const t=(e===null||e===void 0?void 0:e.status)===404;return{errorType:t?i.stepResult.ELEMENT_NOT_FOUND:i.stepResult.UNKNOWN_ERROR,exception:e,success:false,resultInfo:{error:e.message},selectorsScores:s}}}}t.MobileTextValidationStepPlayback=l},1121:function(e,t,s){"use strict";const o=s(5);const{FAILED_OPACITY:n,FRAME_NOT_VISIBLE:a,GENERIC_ELEMENT_HIDDEN:i,ELEMENT_OUTSIDE_OF_VIEWPORT:r,ELEMENT_HAS_ZERO_HEIGHT_OR_WIDTH:c,VISIBILITY_IS_HIDDEN:l}=o.stepResult;const u={playback:{START:"playback:start",UPDATE_RUN_CONFIG:"playback:update-run-config",STEP:"playback:step",STEP_DONE:"playback:step_done",START_CONDITION:"playback:start:condition",CONDITION:"playback:condition",WHILE_LOOP_NEXT_ITERATION:"playback:while_loop:next_iteration",WHILE_ITERATION_DONE:"playback:while_loop:iteration_done",WHILE_LOOP_DONE:"playback:while_loop:done",RESULT:"playback:result",DONE:"playback:done",SETUP_STEP:"playback:setup",SETUP_DONE:"playback:setup_finished",PAUSE:"playback:pause",RESUME:"playback:resume",LOCATE_START:"playback:locate:start",LOCATE_END:"playback:locate:done"},window:{POPUP_CREATED:"window:popup_created",TAB_REPLACED:"window:tab_replaced",TAB_DELETED:"window:tab_deleted"},navigation:{DOM_CONTENT_LOADED:"navigation:dom_content_loaded",COMMITTED:"navigation:committed"},verboseStepResultProperties:["parentResult","step","data","exportsTest","exportsGlobal","incomingParams","outgoingParams","responseBodyRaw","responseHeaders","requestHeaders","requestBody","accessibilityResult","tstConsoleLogs","incomingParamsMetadata"],visibilityState:{VISIBLE:"visible",FAILED_OPACITY:n,FRAME_NOT_VISIBLE:a,ELEMENT_OUTSIDE_OF_VIEWPORT:r,ELEMENT_HAS_ZERO_HEIGHT_OR_WIDTH:c,GENERIC_ELEMENT_HIDDEN:i,VISIBILITY_IS_HIDDEN:l},VISIBILITY_REASON_MESSAGE_MAPPING:{[n]:"Element is not visible: opacity is too low",[a]:"Element is not visible: frame is not visible",[l]:'Element is not visible: visibility is "hidden"',[r]:"Element is not visible: out of viewport",[c]:"Element is not visible: zero width or height",[i]:"Element is not visible"}};e.exports=u},1123:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NavigationStepPlayback=void 0;const o=s(7);const n=s(5);const a=s(823);const i=s(831);const r=s(818);class c extends r.StepPlayback{calculateExpression(e){e.targetName=Date.now();return(0,a.computeExpressionPromise)(e,this.context,this.exportsGlobal,this.exportsTest)}async getUrl(){const e=await this.calculateExpression(this.step.expressionData);return e.evaluatedText}get openInNewTab(){var e;return(e=this.step)===null||e===void 0?void 0:e.openInNewTab}executionAction(){return this.context.stepActionFactory.executeStep({stepData:this.step,context:this.context,frameHandler:this.context.frameHandler,exportsGlobal:this.exportsGlobal,locateElementPlayer:null,exportsTest:this.exportsTest})}async execute(){const e=i.playbackLogger.getLogger(this.context.loggerKey);try{const e=await this.getUrl();this.context.data.testimNavigationStepDestination=o.utils.fixUrlSlash(e);await this.executionAction();return await this.onExecuteResult({success:true})}catch(t){const s="Navigate action failed on retry";e.log(s,this.retryIndex);throw Object.assign(new Error(s),{errorType:n.stepResult.NAVIGATION_FAILURE,success:false,resultInfo:{error:t.message}})}}}t.NavigationStepPlayback=c},1124:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SalesforceApexActionStepPlayback=void 0;const o=s(6);const n=s(823);const a=s(850);const i=s(947);const r=s(5);const c=s(8);const l=s(7);const u=s(981);const d=c.Logger.getLogger("apex-step");class p extends a.ParameterStepPlayback{constructor(){super(...arguments);this.apexExecutionTimeoutElapsed=false}calculateExpression(e,t){if(t){e.targetName=t}return(0,n.computeExpressionPromise)(e,this.context,this.exportsGlobal,this.exportsTest)}async getApexCodeWithParams(){var e;if(!((e=this.step.code)===null||e===void 0?void 0:e.trim())){throw new Error("No Apex code to run")}const t=await Promise.all(this.step.parameterValues.map((async e=>{const t=await this.calculateExpression(e);const s=o.isObject(t.evaluatedText)?JSON.stringify(t.evaluatedText):t.evaluatedText;return o.isString(s)?`String ${e.targetName} = ${(0,u.textToJsString)(s)};`:null})));return[...t.filter(Boolean),this.step.code].join("\n")}async getSalesforceCredentials(){const{step:e}=this;let t;try{t=await Promise.all(e.credentialFieldsNameAndDescription.map((t=>this.calculateExpression(e[t[0]],t[0]))))}catch(e){throw new Error("Missing Salesforce credentials")}const[s,o,n,a]=e.validateAndGetCredentials(t);return{salesforceApiUrl:s,salesforceApiUsername:o,salesforceApiPassword:`${n}${a}`}}getApexExecutionAsStepResults(e){if(!e.compiled){return{success:false,errorType:r.stepResult.SALESFORCE_APEX_COMPILE_ERROR,reason:`Apex compilation error: ${e.compileProblem}`,shouldRetry:false}}if(!e.success){return{success:false,errorType:r.stepResult.SALESFORCE_APEX_RUNTIME_ERROR,reason:`Apex runtime error: ${e.exceptionMessage} at ${e.exceptionStackTrace}`,shouldRetry:false}}return{success:true}}async execute(e){Object.assign(this.context.data,{timeToPlayStep:e});let t;let s;try{[t,s]=await Promise.all([this.getSalesforceCredentials(),this.getApexCodeWithParams()])}catch(e){return{success:false,errorType:r.stepResult.SALESFORCE_STEP_INPUT_ERROR,reason:e.message,shouldRetry:false,resultInfo:{error:e.message}}}try{const o=t=>{if(this.apexExecutionTimeoutElapsed){d.warn("received Apex log after execution timed-out",{timeToPlayStep:e,stepId:this.step.id,logLength:t.length,log:t})}};const{result:n,log:a,startTimestamp:r}=await l.utils.promiseTimeout((0,i.executeApexCode)({...t,apexCode:s,debugLevelLabel:"TestimApexActionStep",asyncLogHandler:o}),e);if(!n.success){return this.getApexExecutionAsStepResults(n)}return{...this.getApexExecutionAsStepResults(n),tstConsoleLogs:(0,i.parseApexExecutionLog)(a,r),data:this.context.data}}catch(e){d.error("failed to execute apex step",{err:e});const t=e instanceof l.TimeoutError?"Apex execution timeout":e===null||e===void 0?void 0:e.message;this.apexExecutionTimeoutElapsed=true;return{success:false,errorType:r.stepResult.SALESFORCE_APEX_FAILURE,reason:t,shouldRetry:false,resultInfo:{error:t}}}}}t.SalesforceApexActionStepPlayback=p},1130:function(e,t){},1132:function(e,t){},1185:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SharedStepInstancePlayback=void 0;const o=s(6);const n=s(823);const a=s(850);const i=s(177);class r extends a.ParameterStepPlayback{constructor(e,t,s){super(e,t,s);if((t===null||t===void 0?void 0:t[0])&&e.id!==t[0].id){this.path=[]}this.pendingStepResults=[];this.firstFailedResult=null}async getAllInnerSteps(){const[e]=await this.innerSteps;const t=await e.getAllInnerSteps();return[...t,this.step]}fixParamValuesTargetNames(e){if(!e.parameterNames){return this.step.parameterValues}return this.step.parameterValues.map((t=>{const s=e.parameterNames.find((e=>e.parameterId===t.targetId));if(s){t.targetName=s.displayName}return t}))}init(e){super.init(e);this.innerSteps=this.step.syncWithSharedStepClass(e).then((()=>{const t=this.playbackTreeBuilder.cloneSharedStepClass(this.step.sharedStepClass);t.parameterValues=this.fixParamValuesTargetNames(t);t.tabInfo=this.step.tabInfo||t.tabInfo;t.location=this.step.location||t.location;t.whileLoop=this.step.getStepWhileLoop();t.emailParamName=this.step.emailParamName;const s=this.playbackTreeBuilder.buildStepPlayer(e,t,this.path);this.step.stepTimeout=t.stepTimeout;this.step.useStepTimeout=t.useStepTimeout;return[s]}))}async getWhileLoop(){const[e]=await this.innerSteps;return e.step.getStepWhileLoop()}async getCondition(){const[e]=await this.innerSteps;return e.step.getStepCondition()}getExpressionParameters(){return this.step.parameterValues.filter((e=>e.type==="evaluate-expression"))}async onBeforeExecute(e){const t=this.getExpressionParameters();const s=t.map((e=>(0,n.calculateStepParam)(e,this.context,this.exportsGlobal,this.exportsTest)));await Promise.all(s);return await super.onBeforeExecute(e)}execute(){return super.onExecuteResult({success:true})}async getPendingStepResults(e){if(this.pendingStepResults.length===0){const t=()=>{if(!e.success){return this.context.captureDomAndScreenshot(this.step)}return this.context.captureScreenshot(this.step)};const s=await t();return[{stepResult:s}]}return Promise.all(this.pendingStepResults)}async setAssetsStateOnContext(e){if(this.context._assetsState){const e=await this.context._assetsState;const t=["stepDOM","stepScreenshot"];if(t.every((t=>e[t]))){return}}const t=await this.getPendingStepResults(e);const s=t.map((e=>e.stepResult)).filter(Boolean);const n=o.findLast(s,(e=>e.stepScreenshot))||{};this.context._elementRectangle=n.screenImageHighlight;this.context._assetsState=Promise.resolve({tabsImage:n.tabsImage,stepDOM:n.stepDOM,isDomBlackList:n.isDomBlackList,stepScreenshot:n.stepScreenshot})}setFirstFailedResult(e){if(!this.firstFailedResult&&!e.success){this.firstFailedResult=e}}async cleanLoopTempVariables(e){const t=await this.innerSteps;const s=t[0].step;if(s.whileLoop&&e.whileLoopEvaluated&&s.whileLoop.subType===i.conditionSubType.DYNAMIC_PARENT_LOOP_CONDITION){delete s.whileLoop.parameterValues[0].previouslyLocatedDynamicParentData}}async onResult(e){var t;await this.setAssetsStateOnContext(e);await this.cleanLoopTempVariables(e);const s=await super.onResult(e);this.setFirstFailedResult(s);Object.assign(this.exportsGlobal,s.exportsGlobal||{});Object.assign(this.exportsTest,s.exportsTest||{});Object.assign(this.context.data,((t=s.data)===null||t===void 0?void 0:t.exports)||{});return s}}t.SharedStepInstancePlayback=r},1186:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NodePackagePlayer=void 0;const o=s(6);const n=s(5);const a=s(831);class i{constructor(e,t,s,o){this.context=e;this.stepResultId=t;this.retryIndex=s;this.stepId=o}async installPackages(e=[],t){if(e.length===0){return}const s=a.playbackLogger.getLogger(this.context.loggerKey);const i=e.map((e=>(0,o.pick)(e,["packageName","packageVersion","targetId","targetName"])));const{context:r,retryIndex:c,stepResultId:l,stepId:u}=this;const{resultId:d}=r;const p={...r.getRunContext(l),stepId:u,packageData:i,resultId:d,retryIndex:c,timeToPlayBeforeExec:t};const m=await r.stepActionFactory.executeStep({stepData:{type:"node-package",id:u},context:p,frameHandler:r.frameHandler});if(m.success){const{data:e}=m;if(!Array.isArray(e)){s.warn("npm package installation failed, data wasn't an array",{data:e});throw Object.assign(new Error(""),{success:false,errorType:n.stepResult.NODE_PACKAGE_EXCEPTION,resultInfo:{error:m.message}})}e.forEach((e=>{const t=r.getStepParamsContainer();t[e.targetId]={testimPackageFullName:e.packageFullName,testimPackageLocalLocation:e.packageLocalLocation};r.internalParams.add(e.targetId)}));return}if(m.code==="invalid-node-package"){s.warn("npm package installation failed, invalid package",{res:m});throw Object.assign(new Error(""),{success:false,errorType:n.stepResult.INVALID_NODE_PACKAGE,resultInfo:{error:m.message},shouldRetry:false})}if(m.code==="timeout"){s.warn("npm package installation failed, timeout");throw Object.assign(new Error(""),{success:false,errorType:n.stepResult.ACTION_TIMEOUT,shouldRetry:false})}s.warn("npm package installation failed",{res:m});throw Object.assign(new Error(""),{success:false,errorType:n.stepResult.NODE_PACKAGE_EXCEPTION,resultInfo:{error:m.message}})}}t.NodePackagePlayer=i},1187:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.EmailValidationStepPlayback=void 0;const o=s(1188);const n=s(823);const a=s(5);const i=s(831);const r=s(849);const c=s(855);class l extends Error{constructor(e,t){super(e);this.errorType=t;this.success=false}}class u extends r.JSStepPlayback{constructor(){super(...arguments);this.emailDataToExport={}}init(e){const{emailParamName:t}=this.step;const s=t?[this.buildStepPlayer(e,t)]:[];this.innerSteps=Promise.resolve(s)}async execute(e){var t,s,r,u;const{step:d,context:p,retryIndex:m,exportsGlobal:f,exportsTest:h}=this;if(!((r=(s=(t=p.company)===null||t===void 0?void 0:t.activePlan)===null||s===void 0?void 0:s.premiumFeatures)===null||r===void 0?void 0:r.emailValidation)){return{success:"skipped",reason:"Email validation is not enabled in your current plan."}}const[g]=await this.innerSteps;if(!(g===null||g===void 0?void 0:g.step.expression.trim())){throw Object.assign(new Error(""),{reason:"Email address is empty",errorType:a.stepResult.EMAIL_FAILURE,success:false})}const y=(0,n.computeExpression)(g.step,p,f,h);if(!y.success){return{success:false,errorType:a.stepResult.EMAIL_FAILURE}}const b=y.evaluatedText;const v=i.playbackLogger.getLogger(this.context.loggerKey);const{frameHandler:x,stepActionFactory:S,projectId:E}=p;const T=await this.testimServicesApi.emailValidation.getInboxEmails(E,b);const{success:P,data:w,code:I}=T;if(!P){if(I===a.serverResponses.EMAIL_NOT_FOUND){throw Object.assign(new Error(""),{success:false,errorType:a.stepResult.EMAIL_NOT_FOUND,resultInfo:{emailAddress:b},shouldRetry:false})}if(I===a.serverResponses.INVALID_EMAIL){throw Object.assign(new Error(""),{success:false,shouldRetry:false,errorType:a.stepResult.INVALID_EMAIL,resultInfo:{emailAddress:b}})}v.error("failed to get email inbox from server");return{success:false,errorType:a.stepResult.EMAIL_FAILURE}}if(d.validationType===a.commonConstants.EMAIL_VALIDATION_TYPE.CODELESS){if(!(w===null||w===void 0?void 0:w.length)){throw new l("Inbox is empty",a.stepResult.INBOX_EMPTY)}const e=this.context.getRunContext(this.getStepResultId());const{finalWithHardwiredParams:t}=c.StepParamsBuilder.getStepInputs(d,e,f,h);const s=(0,o.getFilteredEmail)(w,d,t);if(!s){throw new l("No matched email",a.stepResult.FILTERED_EMAIL_NOT_FOUND)}this.emailDataToExport=(0,o.getEmailDataToExport)(s,d);return{success:true}}if(!((u=d.postCode)===null||u===void 0?void 0:u.code)){return{success:true}}const A=this.context.getRunContext(this.getStepResultId());A.retryIndex=m;Object.assign(A.data,{messages:w,timeToPlayStep:e});A.incomingParams=c.StepParamsBuilder.getStepInputs(d,A,f,h);d.postCode.id=d.id;return S.executeStep({stepData:d.postCode,context:A,frameHandler:x,exportsGlobal:f,locateElementPlayer:null,exportsTest:h,isDebuggingCodeStep:p.isDebuggingCodeStep})}onResult(e){e.exportsTest={...e.exportsTest||{},...this.emailDataToExport};return super.onResult(e)}}t.EmailValidationStepPlayback=u},1188:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getFilteredEmail=t.getEmailDataToExport=t.validateCodelessEmail=void 0;const o=s(6);const n=s(983);const a=s(5);async function i(e,t,s,o){const n=await s.emailValidation.getInboxEmails(o,t);const{success:a,data:i}=n;if(!a){return{errorMessage:"Failed to get email messages from server"}}if(!(i===null||i===void 0?void 0:i.length)){return{errorMessage:"Inbox is empty"}}const l=c(i,e);if(!l){return{errorMessage:"No emails met the filter criteria"}}return r(l,e)}t.validateCodelessEmail=i;function r(e,t){var s;const o={};o.emailData=e;if(!e.text&&!e.html){return o}const n=e.text||g(e.html);if(n&&((s=t.textExtraction)===null||s===void 0?void 0:s.type)){const e=u(n,t.textExtraction);if(e){o.emailExtractedText=e}}const a=m(n,e.html);if(a.length>0){o.emailExtractedLinks=a}return o}t.getEmailDataToExport=r;function c(e,t,s={}){let o=t.timeRangeInMinutes?t.timeRangeInMinutes*a.MINUTE_IN_MS:undefined;const i=t.expectedSubject?(0,n.render)(t.expectedSubject,s):undefined;const r=t.expectedBody?(0,n.render)(t.expectedBody,s):undefined;if(!o&&!i&&!r){o=a.MINUTE_IN_MS}return e.findLast((({created_at:e,subject:t,text:s,html:n})=>{if(o){const t=Date.now()-new Date(e).getTime()<o;if(!t){return false}}if(i&&!l(i,t)){return false}if(r&&!l(r,s||g(n))){return false}return true}))}t.getFilteredEmail=c;function l(e,t){if(!t){return false}return new RegExp((0,o.escapeRegExp)(e),"i").test(t)}function u(e,t,s={}){var o,i,r;const{type:c,start:l,end:u,regex:m}=t;if(c===a.commonConstants.TEXT_EXTRACTION_TYPE.REGEX&&m){return(o=e.match(m))===null||o===void 0?void 0:o[0]}let f="";let h="";if(c===a.commonConstants.TEXT_EXTRACTION_TYPE.BETWEEN&&l&&u){f=(0,n.render)(l,s);h=(0,n.render)(u,s)}else if(c===a.commonConstants.TEXT_EXTRACTION_TYPE.FROM&&l){f=(0,n.render)(l,s)}else if(c===a.commonConstants.TEXT_EXTRACTION_TYPE.TO&&u){h=(0,n.render)(u,s)}if(!f&&!h){return undefined}return(r=(i=e.match(`${d(f)}((?:.|\n|\r)*${h?"?":""})${p(h)}`))===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.trim()}function d(e){return e?`(?<=${(0,o.escapeRegExp)(e)})`:""}function p(e){return e?`(?=${(0,o.escapeRegExp)(e)})`:""}function m(e,t){let s=[];if(e){const t=/https?:\/\/[^\s<>]+|www\.[^\s<>]+/g;s=s.concat(e.match(t)||[])}if(t){s=s.concat(y(t)||[])}return s.filter((e=>!e.endsWith("/")||!s.includes(e.replace(/.$/,"")))).filter(f)}function f(e,t,s){return s.indexOf(e)===t}function h(e){const t=document.createElement("textarea");t.innerHTML=e;return t.textContent}function g(e){var t;if(!e){return undefined}return(t=h(e))===null||t===void 0?void 0:t.replace(/<(script|style)([\s\S]*?)<\/\1>/g,"").replace(/<br\s?\/?>/g,"\n").replace(/<[^>]*>?/g,"")}function y(e){const t=document.createElement("div");t.innerHTML=e;return[...t.getElementsByTagName("a")].map((e=>e.href)).filter(Boolean)}},1189:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GroupStepPlayback=void 0;const o=s(6);const n=s(831);const a=s(5);const i=s(850);function r(e=[],t={}){return e.reduce(((e,s)=>{if(Object.hasOwn(t,s)){e[s]=t[s]}return e}),{})}class c extends i.ParameterStepPlayback{constructor(){super(...arguments);this.accumulatedResult={success:true,reason:""}}async getAllInnerSteps(){const e=await Promise.all(this.steps.map((e=>e.getAllInnerSteps())));return e.concat([this.step])}resetAccumulatedResult(){this.accumulatedResult={success:true,reason:""}}getFinalAccumulatedResult(e){return this.accumulatedResult.reason||e.reason||""}onAllInnerStepsCompleted(e){const{COMPLETED:t}=a.commonConstants.stepStatus;const s=e||{};s.isStopped=this.accumulatedResult.isStopped;s.success=this.accumulatedResult.success;s.errorType=this.accumulatedResult.errorType;s.parentResult=this.accumulatedResult.parentResult;s.reason=this.getFinalAccumulatedResult(s);s.iteration=this.iteration;s.iterationId=this.iterationId;s.status=t;s.data=this.context.data;s.warn=false;s.step=this.step;return Promise.resolve(s)}calcAccumulateResult(e){const{isStopped:t,treatAsWarning:s,errorType:n,parentResult:a,success:i,reason:r,warn:c}=e;const{success:l,reason:u}=this.accumulatedResult;this.accumulatedResult={isStopped:t,success:!l||s?l:i,reason:o.isEmpty(u)&&!o.isEmpty(r)?String(r):d(),errorType:n,parentResult:a||this.accumulatedResult.parentResult};function d(){return s||c||o.isEmpty(r)?u:String(r)}}onChildStepResult(e,t){if(this.context.isFailedResult(t.success)||!o.isEmpty(t.errorType)){this.calcAccumulateResult(t)}if(t.shouldContinueRunning){const s=t.data||{};const o=r(this.step.parameterValues,s);Object.assign(this.innerContext.data,o,s.exports);if(!e||e.id!==t.id){n.playbackLogger.getLogger(this.context.loggerKey).error("childStepResult: current step does not match result");return{isStopped:t.isStopped,whileLoopEvaluated:t.whileLoopEvaluated,iteration:t.iteration,iterationId:t.iterationId,success:false,reason:`internal error, wrong id, got [${t.id}] but expected [${e.id}]. result object is: ${JSON.stringify(t,null,2)}`,shouldContinueRunning:false,resultInfo:t.resultInfo}}return undefined}return{errorType:t.errorType,isStopped:t.isStopped,whileLoopEvaluated:t.whileLoopEvaluated,iteration:t.iteration,iterationId:t.iterationId,success:false,reason:String(t.reason),shouldContinueRunning:t.shouldContinueRunning,resultInfo:t.resultInfo}}}t.GroupStepPlayback=c},1190:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.TextStepPlayback=void 0;const o=s(6);const n=s(823);const a=s(818);function i(e){let t="";function s(e,s){const o={key:e,location:0,keyCode:e.charCodeAt(0),charCode:0,modifiers:{ctrl:false,alt:false,shift:false}};t+=e;return["keydown","keypress","text","keyup"].map((e=>({event:e,eventData:e!=="text"?o:{text:t},timeStamp:10*s})))}const o=e?e.split(""):[""];return o.flatMap(s)}async function r(e,t,s,a){if(e.expression){const o=await(0,n.computeExpressionPromise)(e.expression,t,s,a);let r=(o===null||o===void 0?void 0:o.evaluatedText)||"";if(typeof r!=="string"){r=r.toString()}return Promise.all([i(r),r])}return Promise.all([o.clone(e.events),e.calcText()])}class c extends a.StepPlayback{async runPreLocateActions(){const e=this.step;this.buildIncomingParameters();const t=this.context.getRunContext(this.getStepResultId());const s=this.exportsGlobal;const[o,n]=await r(e,t,s,this.exportsTest);this.context.stepEvents=o;this.context.stepText=n}}t.TextStepPlayback=c},1191:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MfaStepPlayback=void 0;const o=s(849);const n=s(831);const a=s(5);const{stepResult:i}=a.commonConstants;class r extends o.JSStepPlayback{async execute(){let e="";try{const{token:t}=await this.testimServicesApi.secrets.getSecretAuthenticator(this.context.projectId,this.step.mfaSecret);e=t}catch(e){n.playbackLogger.getLogger(this.context.loggerKey).warn("failed to retrieve mfa token from server",{err:e,mfaSecret:this.step.mfaSecret});return this.onExecuteResult({success:false,exception:e,errorType:i.MFA_RETRIEVE_ERROR})}const t=this.step.exportScope;const s=this.step.paramName;return this.reportExecuteResultWithExport(s,e,t)}}t.MfaStepPlayback=r},1192:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NegativeElementValidationStepPlayback=void 0;const o=s(12);const n=s(5);const a=s(52);const i=s(831);const r=s(818);const c=s(1193);const l=n.commonConstants.stepResult;function u(e){const t=o.default.flags.disableEdgeVisibilityChecks.isEnabled();return t&&(e.edgeVisibilityCheckSkipped||e.visibilityCheckSkipped)}class d extends r.StepPlayback{getElementLocators(){return[]}async execute(){const e=this.step;const t=this.step.element;const s=new c.WebLocateElementPlayer(this.context);let o;try{await s.findElements({locatorSteps:[t],retryIndex:this.retryIndex,step:this.step,frameHandler:this.context.frameHandler,dynamicParent:this.context.dynamicParent});const n=this.context.data[e.targetId||"targetId"];o=(()=>{if(!n||a.locatorBuilderUtils.isEmptyResult(n.locatedElement)){return{success:true}}if(n.isVisible===true&&!u(n)){return{success:false,errorType:l.ELEMENT_VISIBLE,resultInfo:{},reason:"Element is visible"}}return{success:true}})()}catch(e){i.playbackLogger.getLogger(this.context.loggerKey).log("findElements failed",{err:e});if(!e.errorType){throw e}o={success:true}}return this.onExecuteResult(o)}}t.NegativeElementValidationStepPlayback=d},1193:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.WebLocateElementPlayer=void 0;const o=s(6);const n=s(12);const a=s(7);const i=s(945);const r=s(5);const c=s(52);const l=s(278);const u=s(286);const d=s(865);const p=s(182);const m=s(831);const f=s(1194);const{EMPTY_RESULT:h,TESTIM_SHADOW_ROOT_ID:g,strategy:y}=r.locators;const b=e=>{const t={top:0,left:0};return e.reduce(((e,t)=>{e.top+=t.top;e.left+=t.left;return e}),t)};class v{constructor(e,t,s){this.context=e;this.exportsGlobal=t;this.exportsTest=s}ignoreVisibilityBySpec(e,t,s){try{if(!(t===null||t===void 0?void 0:t.length)){return false}const o=s||new p.SelectorMatcher([]);const n=e.elementLocator.document;for(const s of t){let t=n;if(s.targetOnly){t=[n[e.elementLocator.index]]}for(const{selectors:e}of t){const t=[s];if(e===null||e===void 0?void 0:e.some((e=>o.matchesData({...e,dom:this.context.currentDom},t)))){return true}}}return false}catch(e){this.logger.error("failed to run match spec filter",e);return false}}get logger(){return m.playbackLogger.getLogger(this.context.loggerKey)}getLocateStepActionUtils(){return this.context.stepActionFactory.getLocateStepActionUtils()}getRectAndOffsets(e,t,s){const o=this.getLocateStepActionUtils();const n=o.getElementRectangle(t,e);const a=o.getOffsets(e,s);return Promise.all([a,n])}addFrameDataToContext(e,t){var s;if(!e||!t){this.logger.warn("addFrameDataToContext called with no targetId or frameLocateResult");return}(s=this.context).frameLocateResult||(s.frameLocateResult={});this.context.frameLocateResult[e]=t}_isResultPassed(e,t,s,o,n){var a;const i=e.isVisible||t.shouldSkipWaitForVisibility()||((a=this.context.lightweightMode)===null||a===void 0?void 0:a.disableVisibilityCheck);const r=o===0&&!i;const c=Number(e.score)<n;if(!e.success||c){return{passed:false,isInternalRetry:false}}if(r){return{passed:false,isInternalRetry:true}}return{passed:s(i),isInternalRetry:false}}_getFailureErrorType(e,t,s,o,n){const a=t<c.locatorBuilderUtils.MINIMAL_SCORE_THRESHOLD;const i=t<=s;const l=c.locatorBuilderUtils.isEmptyResult(e.locatedElement);const u=e.isVisible||o.shouldSkipWaitForVisibility();if(a||l){return{errorType:r.stepResult.ELEMENT_NOT_FOUND,invisibleReason:undefined}}if(!e.isVisible&&(!i||!n(u))){return{errorType:r.stepResult.ELEMENT_NOT_VISIBLE,invisibleReason:e.invisibleReason}}if(i){return{errorType:r.stepResult.ELEMENT_SCORE_BELOW_THRESHOLD,invisibleReason:undefined}}return{}}async handleLocateResult(e,t,s,o,n){var a;const i=o===0;const c=e.locatorScoreThreshold;let l=c;let u=false;if(i){l=Math.max(c,t.getFirstRetryMinimalThreshold());u=l!==c}const p=Number(e.score);if(e.foundElementStr){this.logger.debug("locator found element for step",{retryIndex:o,isVisible:e.isVisible,totalRuntime:(a=e.locateResult)===null||a===void 0?void 0:a.totalRuntime,stepId:t.id,foundElementStr:e.foundElementStr})}const{selectorVisibilityFilterSpec:m=[]}=this.context.project.defaults||{};const f=this.ignoreVisibilityBySpec(s,m);n||(n=e=>e||f||!s.forceVisibility);if(!e.locatorId){e.locatorId=s.id}const{passed:h,isInternalRetry:g}=this._isResultPassed(e,t,n,o,l);if(h){if(e.success&&p<.01&&c!==-.1){this.logger.warn(`passed locate with 0 score, step = ${t.id}`)}e.id=s.id;e.targetName=s.targetName||"";return e}if(t.isOptionalLocator(s.targetId)){const t=this.context.data[s.targetId];t.locatedElement=(0,d.buildLocatedElement)(x());t.elementSymbol="";t.tagName="";return e}if(!e.targetName){e.targetName=s.targetName||""}const{errorType:y,invisibleReason:b}=this._getFailureErrorType(e,p,l,t,n);throw Object.assign(new Error("LocateElementPlayer.handleLocateResult"),{success:false,errorType:y,invisibleReason:b,scoreThreshold:l,isForcedThreshold:u,locateResult:e.locateResult,locatedElement:e.locatedElement,testimSessionId:e.testimSessionId,locateScore:e.score,foundElementStr:e.foundElementStr,id:s.id,locatorId:s.id,targetName:s.targetName||"",targetId:s.targetId||"targetId",isInternalRetry:g||u&&y===r.stepResult.ELEMENT_SCORE_BELOW_THRESHOLD})}isDraftEditor(e){const t=c.locatorBuilderUtils.getElementsPath(e.ownerDocument.body,e);return t.some((e=>{var t;return(t=e.classList)===null||t===void 0?void 0:t.contains("public-DraftEditor-content")}))||undefined}getElementToFocusLocatedElement(e,t,s){var o;function i(e){return Boolean(e.getAttribute&&e.getAttribute("contenteditable")==="true")}function r(e){var t;if(i(e)){return true}if(!n.default.flags.enableFullFocusableTest.isEnabled()){if(a.utils.isTextElement(e)){return true}return["BUTTON","SELECT"].includes(e.tagName)}const s=["INPUT","SELECT","TEXTAREA","BUTTON","OBJECT","DETAILS","SUMMARY"].includes(e.tagName);if(s){return!e.disabled}if(e.tagName==="A"&&e.hasAttribute("href")){return true}return(t=e.hasAttribute)===null||t===void 0?void 0:t.call(e,"tabindex")}if(!s||(((o=s.quirks)===null||o===void 0?void 0:o.dontForceFocus)||s.type==="wheel")){return false}const l=c.locatorBuilderUtils.getElementsPath(t.ownerDocument.body,t);const u=l.find((e=>r(e)));if(!u){return false}return(0,d.buildLocatedElement)({element:u})}setDomDataOnContext(e,t,s,o,n,i,r){const l=i.locatedElement;const u=i.element;const d=this.context.getTabUtilsByTabId(n);const p=d.imageCaptureUtils.getCurrentDevicePixelRatio()||e.devicePixelRatio||1;const m=c.locatorBuilderUtils.isEmptyResult(u);const f=m?"":a.utils.getElementTags(u,["testim_dom_element_id"]);this.context.data[s]={pixelRatio:p,locatorId:o,isRoot:typeof u!=="string"&&(u===null||u===void 0?void 0:u.ownerDocument)&&u.ownerDocument.documentElement===u,locatedElement:l,testimSessionId:c.locatorBuilderUtils.getTestimId(u),elementSymbol:f,tagName:a.utils.getTagName(u,true)};if(!m){this.context.data[s].elementToFocusLocatedElement=this.getElementToFocusLocatedElement(l,u,r);this.context.data[s].isDraftEditor=this.isDraftEditor(u)}this.context.setHtmlString(o,e.html);this.context.internalParams.add(s);this.context.runLocation=e.runLocation;this.context.currentDom=t}async locate(e,t,s,a,r,p){var m,h,b,v,x;if((m=this.context.lightweightMode)===null||m===void 0?void 0:m.disableLocators){const o={success:true,targetId:s,locatedElement:{shadowPath:[e.selector]},isVisible:false};this.setDomDataOnContext({},null,s,e.id,t.tabId,o,a);return o}const S=this.getLocateStepActionUtils();try{const m=Date.now();const E=await this.context.stepActionFactory.executeStep({stepData:e,context:this.context,frameHandler:t,exportsGlobal:this.exportsGlobal,locateElementPlayer:null,exportsTest:this.exportsTest});const P=Date.now()-m;if(P>5e3){this.logger.warn(`get dom took ${P}, stepId = ${a===null||a===void 0?void 0:a.id}`)}const w=n.default.flags.useLinkedomToParseHtml.isEnabled();const I=S.htmlStringToDom(E.html,E.runLocation,E.nonBodyElements,E.bodyTagName,w);Object.entries(E.shadowRoots||{}).forEach((([e,t])=>{const s=I.querySelector(c.locatorBuilderUtils.getSelector(e));if(s){s.setAttribute(g,e);s.innerHTML=t}}));const A=new i.SelectorParamEvaluator(e,this.context);let R;let L;if(u.LocateStep.locateStrategy(e)===y.LOCATOR){const t=this.context.project.defaults||{};const s=new f.LocatorRunner(I,r,t.selectorFilterSpec);const i={salesForceSelectrorFix:n.default.flags.salesForceSelectrorFix.isEnabled(),customTagScore:n.default.flags.customTagScore.isEnabled(),ignoreHiddenTagsText:Boolean((v=(b=(h=this.context.company)===null||h===void 0?void 0:h.activePlan)===null||b===void 0?void 0:b.premiumFeatures)===null||v===void 0?void 0:v.ignoreHiddenTagsText)};L=new l.LocatorDeserializer(I,t.selectorFilterSpec,i).deserialize(o.cloneDeep(e.elementLocator),A);R=s.locate(L);if(n.default.flags.loadLocatorFromCollection.isEnabled()||n.default.flags.demoAutoImprove.isEnabled()){try{if(a===null||a===void 0?void 0:a.id){let s=this.context.playback.locatorsMap.get(`${e.id}:${a.id}`);if(!s){const t=[a.parentStep,(x=a.parentStep)===null||x===void 0?void 0:x.parentStep].filter(Boolean);if(t.length){s=t.find((t=>this.context.playback.locatorsMap.get(`${e.id}:${t.id}`)))}}if(s&&p){const e=new f.LocatorRunner(I,r,t.selectorFilterSpec);const a=new l.LocatorDeserializer(I,t.selectorFilterSpec).deserialize(o.cloneDeep(s),A);const i=e.locate(a);this.context.playback.locateResultDiffLogger.analyzeLocateResultDiff(L,a,i.totalRuntime,p);if(n.default.flags.useLocatorFromCollection.isEnabled()||n.default.flags.demoAutoImprove.isEnabled()){R=i}}}}catch(e){this.logger.error("failed to execute improved locator")}}}else if(u.LocateStep.locateStrategy(e)===y.SELECTOR){[R,L]=T(I,e.selector)}else{this.logger.error("Should not get here - no selector or locator on the element")}const O=R.element;const k={dom:I,success:!c.locatorBuilderUtils.isEmptyResult(O),element:O,targetId:s,locateResult:R,locatedElement:(0,d.buildLocatedElement)(R),foundElementStr:R&&e.elementLocator&&R.elementLocatorResults[e.elementLocator.index].foundElementStr,isVisible:false,testimSessionId:c.locatorBuilderUtils.getTestimId(O),score:L.score,locatorScoreThreshold:L.getScoreThreshold()};this.setDomDataOnContext(E,I,s,e.id,t.tabId,k,a);await S.setElementResultDataOnContext(this.context.data[s],k);return k}catch(e){return Promise.reject({exception:e instanceof Error?e:undefined,success:false,reason:e.message})}}async addRectangleAndVisibilityInfo(e,t,s,a){var i;if(!a.success){return a}const r=this.context.data[s];const[c=[],l={top:0,left:0,width:0,height:0,bottom:0,right:0}]=await this.getRectAndOffsets(e,r,t);const u=b(c);r.rect=o.clone(l);r.rect.top+=u.top;r.rect.left+=u.left;r.rect.bottom+=u.top;r.rect.right+=u.left;r.rectWithoutFrameOffset=o.clone(l);if((i=this.context.lightweightMode)===null||i===void 0?void 0:i.disableVisibilityCheck){return undefined}const d=await this.getLocateStepActionUtils().isVisible(r,a.element,l,t,e,c,a.dom,n.default.flags.ignoreMissingClickOffsetVisibleCheck.isEnabled());let p;let m;if(typeof d!=="boolean"&&(d===null||d===void 0?void 0:d.invisibleReason)){p=d.visible;m=d.invisibleReason}else{p=d}a.isVisible=p;a.element=null;a.dom=null;a.invisibleReason=m;r.isVisible=p;return a}async findElements({locatorSteps:e,retryIndex:t,step:s,frameHandler:o,dynamicParent:n}){if(e.length===0){return{success:true}}try{const a=await Promise.all(e.map((async e=>{const a=e.targetId||"targetId";const i={projectId:this.context.project.id,testId:this.context.testId,branch:this.context.currentBranch,path:this.context.path||"",stepId:s.id,locatorId:e.id,iterationId:this.context.data.iterationId||"",sharedStepInstance:"",retryIndex:t};if(!o){this.logger.warn("Missing frameHandler for step",{stepId:s.id,stepType:s.type,retryIndex:t})}const r=await this.locate(e,o,a,s,n,i);const c=await this.addRectangleAndVisibilityInfo(o,e,a,r);return await this.handleLocateResult(c,s,e,t)})));this.context.setLocateResults(a,this.context.data.htmlStrings);const i=this.context.data[a[0].targetId||"targetId"];if(!i){this.context.logger.warn("Missing target from playback context data");return{success:false}}this.context.setElementRectangle(i.rect,i.pixelRatio);return{success:true}}catch(e){this.context.setLocateResults([e],this.context.data.htmlStrings);throw e}}scrollStepElementIntoView(e,t){const s=this.getLocateStepActionUtils();if(typeof s.scrollToElement!=="function"){return Promise.resolve()}return s.scrollToElement(e,t)}}t.WebLocateElementPlayer=v;function x(e){return{element:e||h,elementLocatorResults:[],href:"",type:"web-locate-result",totalRuntime:null,isLocatorEdited:false}}function S(e){return{score:e?1:0,getScoreThreshold(){return 0}}}function E(e){return[x(e),S(e)]}function T(e,t){const s=e.querySelector(t);return E(s)}},1194:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LocatorRunner=void 0;const o=s(6);const n=s(1195);const a=s(52);const i=s(178);const r=s(289);const c=s(278);class l{constructor(e,t,s=[]){this.dom=e;this.dynamicParent=t;this.selectorFilterSpec=s}deserializeAndLocate(e,t=new i.NoEnvironmentParamEvaluator){const s=new c.LocatorDeserializer(this.dom,this.selectorFilterSpec);const o=s.deserialize(e,t);return this.locate(o)}locate(e){var t;const s=this._overrideLocatorWithDynamicParent(e);const n=Date.now();e.setTargetElement();const a=e.locate();const i=Date.now();const r=a.element||null;const c=e.getDocument().getElementLocators();const l=c.map((({locatorCache:e})=>o.omit(e,"element")));return{type:"web-locate-result",element:r,elementLocatorResults:l,totalRuntime:i-n,href:typeof window!=="undefined"?window.location.href:"",dynamicParentData:s,isLocatorEdited:e.getDocument().isEdited(),...a.frameId&&{frameId:a.frameId||undefined},...((t=this.dom)===null||t===void 0?void 0:t.body)&&{documentLengthAtPlayback:this.dom.body.querySelectorAll("*").length}}}_overrideLocatorWithDynamicParent(e){const{dynamicParent:t}=this;if(!t||o.isEmpty(t)){return undefined}const{index:s,matchScore:a}=(0,n.getDynamicParentIndex)(t,e,this.selectorFilterSpec);if(s<0){r.locatorLogger.log("Not looking under dynamic parent, low match score",{index:s,matchScore:a});return undefined}this._overrideParentsWithDynamicParent(e,t.element,s);return{parentStepId:t.parentStepId,parentStepName:t.parentStepName,score:t.element.score,dynamicParentIndex:s,dynamicParentMatchScore:a}}_overrideParentsWithDynamicParent(e,t,s){const o=(0,n.getDynamicParent)(this.dom,t.uid);if(!o){r.locatorLogger.log("Not looking under dynamic parent, context was removed from page!");return}const i=e.document.elementLocators[s];i.locatorCache={locatorIndex:s,score:t.score,foundElementScore:Number(t.score),element:o,foundElementID:a.locatorBuilderUtils.getTestimId(o),foundElementStr:a.locatorBuilderUtils.domElementToStr(o),selectorResults:[],isTargetElement:false};const c=e.document.elementLocators.slice(0,s).filter((e=>!e.isChildLocator));c.forEach((e=>e.selectors=[]))}}t.LocatorRunner=l},1195:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.shouldUseDynamicParent=t.getDynamicParentIndex=t.getDynamicParent=void 0;const o=s(6);const n=s(5);const a=s(288);const i=s(278);function r(e){return`[${n.commonConstants.locators.DYNAMIC_PARENT_FIELD_NAME}='${e}']`}function c(e,t){const s=r(t);return e.querySelector(s)}t.getDynamicParent=c;function l(e,t,s=[]){if(o.isEmpty(e)){return{index:-1,matchScore:0}}const n=new a.LocatorsComparator;const r=new i.LocatorDeserializer({},s).deserialize(o.cloneDeep(e.elementLocator));const c=r.getIndexInDocument();const l=.5;const{index:u,matchScore:d}=n.findMatchIndexForSingleElement(r,c,t,l);return{index:u,matchScore:d}}t.getDynamicParentIndex=l;function u(e,t,s=[]){const n=new i.LocatorDeserializer({},s).deserialize(o.cloneDeep(t));return l(e,n,s).index>=0}t.shouldUseDynamicParent=u},1196:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ResizeWindowStepPlayback=void 0;const o=s(831);const n=s(818);const a=s(5);class i extends n.StepPlayback{getFrameLocators(){return[]}async execute(){const e=this.context.getTabUtils(this.step.tabInfo);let t;try{await e.windowUtils.setViewportSize({width:this.step.innerWidth,height:this.step.innerHeight});t={success:true}}catch(e){const{actualSize:s,expectedSize:n}=e;o.playbackLogger.getLogger(this.context.loggerKey).log("Failed to resize:",s,n);t={errorType:a.stepResult.RESIZE_WINDOW_FAILURE,success:false,resultInfo:{error:`Failed to resize to: ${this.step.innerWidth}x${this.step.innerHeight}.`}}}return await this.onExecuteResult(t)}}t.ResizeWindowStepPlayback=i},1197:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.WheelStepPlayback=void 0;const o=s(6);const n=s(818);function a(e){return{deltaX:e.getDeltaX(),deltaY:e.getDeltaY(),deltaZ:e.getDeltaZ(),pointerPosition:e.events[0].pointerPosition,timestamp:e.events[0].timeStamp}}function i(e){if(e.deltaX||e.deltaY||e.deltaZ){return[a(e)]}return o.clone(e.events)}class r extends n.StepPlayback{runPreLocateActions(){this.context.stepEvents=i(this.step)}}t.WheelStepPlayback=r},1198:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ApiStepPlayback=void 0;const o=s(6);const n=s(831);const a=s(855);const i=s(849);const r=s(823);const c=s(1199);const l=(e,t,s)=>{if(s){return`Expected: '${e}' Found: '${t}'`}return`Actual value was equal: '${e}'`};const u=(e,t,s,o,n)=>{if(!e.value.expression.trim()){return{success:false,reason:`${e.matchType==="range"?"From":"Value"} was not set`}}const a=(0,r.computeExpression)(e.value,s,o,n);const i=Number(a.evaluatedText);if(e.matchType==="range"){if(!e.upperRange.expression.trim()){return{success:false,reason:"To was not set"}}const a=(0,r.computeExpression)(e.upperRange,s,o,n);const c=Number(a.evaluatedText);if(Number.isNaN(i)||Number.isNaN(c)){return{success:false,reason:"One or more of the range values is not a number"}}if(i>=c){return{success:false,reason:`Invalid range requested: (${i} to ${c})`}}const l=t.statusCode<i;const u=t.statusCode>c;return{success:!l&&!u,reason:`Status code is out of range. Actual: ${t.statusCode}`}}const c=t.statusCode===i;const u=e.matchType==="equals"?c:!c;return{success:u,reason:u?undefined:l(i,t.statusCode,e.matchType==="equals")}};const d=(e,t,s,o,n)=>{if(!e.value.expression.trim()){return{success:false,reason:"Value was not set"}}if(!e.name.expression.trim()){return{success:false,reason:"Name was not set"}}const a=(0,r.computeExpression)(e.value,s,o,n);const i=(0,r.computeExpression)(e.name,s,o,n);const c=t.responseHeaders.find((e=>e.key===i.evaluatedText));if(!c){return{success:false,reason:`'${i.evaluatedText}' doesn't exist`}}if(e.matchType==="contains"){const e=c.value.includes(a.evaluatedText);return{success:e,reason:e?undefined:`Expected '${c.value}' to contain: '${a.evaluatedText}'`}}const u=c.value===a.evaluatedText;const d=e.matchType==="equals"?u:!u;return{success:d,reason:d?undefined:l(a.evaluatedText,c.value,e.matchType==="equals")}};const p=(e,t,s,n,a)=>{if(!e.value.expression.trim()){return{success:false,reason:"Value was not set"}}if(!e.path.expression.trim()){return{success:false,reason:"Path was not set"}}const i=(0,r.computeExpression)(e.value,s,n,a);const c=(0,r.computeExpression)(e.path,s,n,a);if(!o.has(t.responseBody,c.evaluatedText)){return{success:false,reason:`"${c.evaluatedText}" doesn't exist`}}const u=o.get(t.responseBody,c.evaluatedText);const d=o.isEqual(u,i.evaluatedText);const p=e.matchType==="equals"?d:!d;return{success:p,reason:p?undefined:l(i.evaluatedText,u,e.matchType==="equals")}};const m=(e,t,s,o,n)=>{if(!e.value.expression.trim()){return{success:false,reason:"Value was not set"}}const a=(0,r.computeExpression)(e.value,s,o,n);if(e.matchType==="contains"){const e=t.responseBodyRaw.includes(a.evaluatedText);return{success:e,reason:e?undefined:`Expected response body to contain: '${a.evaluatedText}'`}}const i=t.responseBodyRaw===a.evaluatedText;const c=e.matchType==="equals"?i:!i;return{success:c,reason:c?undefined:`Expected response body to ${e.matchType==="equals"?"":"not "}equal ${a.evaluatedText}`}};const f={statusCode:u,responseHeader:d,responseBodyJSON:p,responseBodyText:m};class h extends i.JSStepPlayback{get stepParams(){var e,t;if((t=(e=this.context.project)===null||e===void 0?void 0:e.defaults)===null||t===void 0?void 0:t.disableNewApiStepParamEvalOrder){return Object.assign({},this.exportsGlobal,this.exportsTest,this.context.userParamsData,this.context.customTestData,this.context.data)}return a.StepParamsBuilder.getStepInputs(this.step,this.context,this.exportsGlobal,this.exportsTest).finalWithHardwiredParams}setStepValuesForRunnerBackwardsCompatibility(e,t,s,o,n){const{step:a}=this;this.originalUrl||(this.originalUrl=a.url);this.originalHeaders||(this.originalHeaders=a.headers);this.originalBody||(this.originalBody=a.body);a.body=s;a.headers=t;a.url=e;a.formData=o;a.fileUrls=n}resetStepValues(){const{step:e}=this;e.body=this.originalBody;e.headers=this.originalHeaders;e.url=this.originalUrl;delete this.originalBody;delete this.originalHeaders;delete this.originalUrl}getResponseSize(e){var t,s,o;const n=(s=(t=e.responseHeaders)===null||t===void 0?void 0:t.find((e=>e.key.toLowerCase()==="content-length")))===null||s===void 0?void 0:s.value;return!n&&((o=e.responseBodyRaw)===null||o===void 0?void 0:o.length)?e.responseBodyRaw.length:Number(n||0)}cleanResult(e){const t=o.cloneDeep(e);delete t.result;delete t.responseBody;if(t.responseBodyRaw&&this.getResponseSize(t)>2e6){t.responseBodyRaw="Response body is over 2MB and therefore cannot be displayed"}return t}async prepareRequestData(){var e;const{requestUrl:t,requestHeaders:s,requestBody:o,requestFormData:n}=(0,c.prepareApiRequestData)(this.step,this.stepParams);const a=await(0,c.buildFormDataUrl)(((e=this.step)===null||e===void 0?void 0:e.formData)||[],this.context.project.id,this.testimServicesApi);this.context.setApiStepValues(t,s,o,n,(0,c.renderFileURLS)(a,this.stepParams));this.setStepValuesForRunnerBackwardsCompatibility(t,s,o,n,(0,c.renderFileURLS)(a,this.stepParams));return{requestUrl:t,requestHeaders:s,requestBody:o,requestFormData:n}}async executeAndParseApiResult(e,t,s,o,a){const i=this.apiResult||await super.execute(e);const r=await(0,c.parseApiResult)(i,{requestBody:o,requestHeaders:s,requestUrl:t,requestFormData:a},n.playbackLogger.getLogger(this.context.loggerKey));this.apiResult=i;return{resultExtraInfo:r,apiResult:i}}async handlePostCode(e,t,s){const{frameHandler:o,stepActionFactory:n}=this.context;const i=this.context.getRunContext(this.getStepResultId());i.retryIndex=this.retryIndex;Object.assign(i.data,e,{timeToPlayStep:t});i.incomingParams=a.StepParamsBuilder.getStepInputs(this.step,i,this.exportsGlobal,this.exportsTest);let r;try{r=await n.executeStep({stepData:Object.assign(this.step.postCode,{id:this.step.id}),context:i,frameHandler:o,exportsGlobal:this.exportsGlobal,locateElementPlayer:null,exportsTest:this.exportsTest,isDebuggingCodeStep:this.context.isDebuggingCodeStep})}catch(e){if(e instanceof RangeError){return this.onExecuteResult({success:false,reason:"RangeError: Response body too large."})}throw e}return this.onExecuteResult(this.cleanResult(Object.assign({},r,e,{assertionResults:s})))}runApiAssertions(e){const{step:t,context:s,exportsGlobal:o,exportsTest:a}=this;const i=(t.assertions||[]).reduce(((t,i)=>{if(!i.enabled){return t}try{const n=f[i.assertedProperty];if(!n){throw new Error("Unknown property asserted!")}return{...t,[i.id]:n(i,e,s,o,a)}}catch(e){if(e.errorType){return{...t,[i.id]:{...e,success:false}}}n.playbackLogger.getLogger(this.context.loggerKey).warn("failed to run an assertion",{err:e,assertion:i});return{...t,[i.id]:{success:false,reason:(e===null||e===void 0?void 0:e.reason)||(e===null||e===void 0?void 0:e.message)||"Error"}}}}),{});const r=Object.values(i).some((e=>!e.success));return{hasFailedAssertions:r,assertionResults:i}}async execute(e){var t;const{requestUrl:s,requestHeaders:n,requestBody:a,requestFormData:i}=await this.prepareRequestData();const{apiResult:r,resultExtraInfo:c}=await this.executeAndParseApiResult(e,s,n,a,i);const l=o.pick(c,["statusCode","responseBody","responseHeaders"]);const u=this.cleanResult(Object.assign({data:{stepReturn:l}},r,c));if(!r.success){return this.onExecuteResult(u)}const{hasFailedAssertions:d,assertionResults:p}=this.runApiAssertions(c)||{};if(d||!this.step.enablePostCode||!((t=this.step.postCode)===null||t===void 0?void 0:t.code)){Object.assign(u,{assertionResults:p,success:!d,...d&&{reason:"API assertions have failed"}});return this.onExecuteResult(u)}return await this.handlePostCode(c,e,p)}onResult(e){this.resetStepValues();return super.onResult(e)}}t.ApiStepPlayback=h},1199:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:true});t.parseApiResult=t.prepareApiRequestData=t.renderFileURLS=t.buildFormDataUrl=t.shouldUploadFileByHeader=t.ContentTypeApplicationFormData=t.ContentTypeApplicationHTML=t.ContentTypeApplicationXML=t.ContentTypeApplicationJavascript=t.ContentTypeApplicationJson=t.ContentTypeText=void 0;const o=s(983);const n=s(1200);const a=s(7);const i=s(8);const r=i.Logger.getLogger("apiStepUtils");t.ContentTypeText="";t.ContentTypeApplicationJson="application/json";t.ContentTypeApplicationJavascript="application/javascript";t.ContentTypeApplicationXML="application/xml";t.ContentTypeApplicationHTML="text/html";t.ContentTypeApplicationFormData="multipart/form-data";function c(e){return e.find((({key:e,value:s})=>e==="Content-Type"&&s===t.ContentTypeApplicationFormData))}t.shouldUploadFileByHeader=c;async function l(e,t,s){const o={};const n=e.filter((({valueType:e,status:t})=>e==="file"&&t));for await(const e of n){const{file:n,keyName:i}=e;if(!n){continue}const{name:c,path:l}=n;if(!c||!l){continue}const[u]=await a.utils.addTokenToFileUrl(t,[{name:c,url:l||""}],s,false,r);o[i]=u.url}return o}t.buildFormDataUrl=l;function u(e="",t){if(Array.isArray(e)){const s=e=>Object.entries(e).reduce(((e,[s,o])=>({...e,[s]:u(o,t)})),{});return e.map(s)}return(0,o.render)(e,t)}function d(e){if(!Array.isArray(e)){return e}return e.reduce(((e,{disabled:t,...s})=>t?e:[...e,s]),[])}function p(t,s,o){if((t===null||t===void 0?void 0:t.type)==="none"||!(t===null||t===void 0?void 0:t.enabled)){return s}let n="Unsupported method";if(t.type==="bearer"){n=`Bearer ${u(t.token,o)}`}const a=typeof btoa==="function"?btoa:t=>e.from(t).toString("base64");if(t.type==="basic"){const e=u(t.username,o);const s=u(t.password,o);const i=a(`${e}:${s}`);n=`Basic ${i}`}const i=s.filter((({key:e})=>e.toLowerCase()!=="authorization"));i.push({key:"Authorization",value:n});return i}function m(e,t){if(!e){return[]}return e.map((({status:e,keyName:s,value:o,valueType:n,file:a})=>{if(!e){return null}s=u(s,t);o=n==="file"?a===null||a===void 0?void 0:a.path:u(o,t);return{keyName:s,metadata:{valueType:n,value:o,type:a===null||a===void 0?void 0:a.type,name:a===null||a===void 0?void 0:a.name}}})).filter(Boolean)}function f(e,t){const s=Object.entries(e).map((([e,s])=>[u(e,t),s]));return Object.fromEntries(s)}t.renderFileURLS=f;function h(e,t){const s=a.utils.fixUrlSlash(u(e.url,t));const o=u(d(e.headers||[]),t);let n=u(e.body,t);const i=p(e.authorization,o,t);const r=e.formData?m(e.formData,t):[];if(c(i)){n=JSON.stringify(Object.fromEntries(r.map((e=>{const{keyName:t,metadata:{valueType:s,value:o,type:n,name:a}}=e;const i=s==="file"?{[t]:{name:a,mimeType:n}}:o;return[t,i]}))))}return{requestUrl:s,requestHeaders:i,requestBody:n,requestFormData:r}}t.prepareApiRequestData=h;const g={0:"Not Connected",100:"Continue",101:"Switching Protocol",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Multi-Status",226:"IM Used",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"};async function y(e,t,s){var o;const a=(o=e===null||e===void 0?void 0:e.find((e=>e.key.toLowerCase()==="content-type")))===null||o===void 0?void 0:o.value;if(a===null||a===void 0?void 0:a.includes("application/json")){try{return JSON.parse(t)}catch(e){s.warn("failed to parse body to JSON",{err:e})}}if((a===null||a===void 0?void 0:a.includes("application/xml"))||(a===null||a===void 0?void 0:a.includes("text/xml"))){try{const e=await(0,n.parseStringPromise)(t);return e}catch(e){s.warn("failed to parse body to XML",{err:e})}}return t}function b(e){if(!(e===null||e===void 0?void 0:e.responseHeaders)){return[]}return e.responseHeaders.split(/\r?\n/).map((e=>{let[t="",s=""]=e.split(":");t=t.trim();s=s.trim();if(!t&&!s){return undefined}return{key:t,value:s}})).filter(Boolean)}async function v(e,{requestBody:t,requestHeaders:s,requestUrl:o,requestFormData:n},a=i.Logger.getLogger("apiStepUtils")){const r=e.result||{};const c=b(r)||[];const l=r.response;const u=await y(c,l,a);const d=g[r.status||-1]||"";const p={requestBody:t,requestHeaders:s,requestUrl:o,responseBody:u,responseBodyRaw:l,responseHeaders:c,statusText:`${r.status} ${d}`,statusCode:r.status,requestDuration:r.requestDuration,requestFormData:n};return p}t.parseApiResult=v}).call(this,s(63).Buffer)},1204:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CliDownloadFileStepPlayback=void 0;const o=s(6);const n=s(982);const a=s(831);const i=s(855);class r extends n.CliJsStepPlayback{constructor(){super(...arguments);this.downloadFileResult=null}convertBlobToDataUrl(e){return new Promise(((t,s)=>{const o=new FileReader;o.onload=e=>t(e.target.result);o.onerror=e=>s(e);o.readAsDataURL(e)}))}cleanDownloadFileResult(){this.downloadFileResult=null}onResult(e){this.cleanDownloadFileResult();return super.onResult(e)}onBeforeExecute(){return Promise.resolve()}async execute(e){var t;const{step:s,context:n,retryIndex:r,exportsGlobal:c,exportsTest:l}=this;const u=a.playbackLogger.getLogger(this.context.loggerKey);const{frameHandler:d,stepActionFactory:p}=n;const m=await(this.downloadFileResult||super.execute(e));const{fileBlob:f,sizeInBytes:h,fileType:g,fileName:y,success:b}=m;const v={sizeInBytes:h,fileType:g,fileName:y,nodePackageNames:undefined};const x=o.pick(m,["fileName","fileType","sizeInBytes","fileBlob"]);if(b!==true||!((t=s.postCode)===null||t===void 0?void 0:t.code)){return Object.assign({data:{stepReturn:x}},m,v)}this.downloadFileResult=m;let S;try{S=await this.convertBlobToDataUrl(f)}catch(e){const t="Failed to load file";u.error(t,e);throw Object.assign(new Error(t),{success:false,reason:t,err:e})}await Promise.all([this.executeNodePackageParameters(e),this.evaluateParams()]);const E=Object.assign(this.context.getRunContext(this.getStepResultId()),{retryIndex:r,fileDataUrl:S});Object.assign(E.data,{fileName:y,sizeInBytes:h,timeToPlayStep:e});const T=i.StepParamsBuilder.getStepInputs(s,E,c,l);E.incomingParams=T;v.nodePackageNames=T.nodePackageNames;s.postCode.id=s.id;const P=await p.executeStep({stepData:s.postCode,context:E,frameHandler:d,exportsGlobal:c,locateElementPlayer:null,exportsTest:l});return Object.assign(P,v)}}t.CliDownloadFileStepPlayback=r},1205:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileTapStepPlayback=void 0;const o=s(12);const n=s(818);const a=s(108);class i extends n.StepPlayback{async execute(e){const{context:t}=this;if(!t.data.targetId){return{success:false,reason:"Couldn't find target element",errorType:"Failed device interaction - tap",shouldRetry:true}}try{const s=t.data.targetId.locatedElement;if(s.elementId!==""){await(0,a.promiseTimeout)(t.appiumApi.tap(s.elementId),e);return{success:true}}const n=this.step.element.elementPositionInfoAtRecording;let i;let r;if(o.default.flags.mobileRelativeTapBasedOnRecordedSize.isEnabled()&&n){const e=n.elementAbsoluteWidth/s.rect.width;const t=n.elementAbsoluteHeight/s.rect.height;i=n.elementRelativeTapX*e+s.rect.left;r=n.elementRelativeTapY*t+s.rect.top}else{i=s.rect.left+s.rect.width/2;r=s.rect.top+s.rect.height/2}const c={x:i,y:r};await(0,a.promiseTimeout)(t.appiumApi.tapOnPoint(c),e);return{success:true,stepSpecificData:c}}catch(e){return{success:false,reason:e.message,exception:e,errorType:"Failed device interaction - tap",shouldRetry:false}}}}t.MobileTapStepPlayback=i},1206:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileExtractTextStepPlayback=void 0;const o=s(818);const n=s(5);const a=s(937);const i=s(941);class r extends o.StepPlayback{async execute(){const{context:e,step:t}=this;const s=e.data[t.targetId||"targetId"];const o=t.extractTextParamName;try{const r=s.locatedElement;const c=await(0,i.getLocatedElementText)(r,e);const l=t.exportScope||n.commonConstants.exportScopes.LOCAL;const u=t.getExtractMode();const d=t.trimSpaces;const p={mode:u,setting:this.step.getModeSetting(),trimSpaces:Boolean(d)};if(p.mode==="regex"){p.regex=this.step.getRegex()}const m=(0,a.extractText)(c,p);const f=this.reportExecuteResultWithExport(o,m,l);return this.onExecuteResult(f)}catch(e){return{success:false,exception:e,errorType:n.commonConstants.stepResult.EXTRACT_TEXT_FAILURE,resultInfo:{error:e.message}}}}}t.MobileExtractTextStepPlayback=r},1207:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SfdcApexActionStepPlayback=void 0;const o=s(6);const n=s(823);const a=s(850);const i=s(947);const r=s(5);const c=s(8);const l=s(7);const u=s(981);const d=s(108);const p=c.Logger.getLogger("sfdc-apex-step");const m=9e4;const f=0;const h=`\nquery ExecuteApex($code: String!, $credentialId: String!) {\n    executeApex(code: $code, credentialId: $credentialId) {\n        success\n        results\n        logs\n        errorType\n        reason\n        shouldRetry\n    }\n}`;class g extends a.ParameterStepPlayback{async getApexCodeWithParams(){var e;if(!((e=this.step.code)===null||e===void 0?void 0:e.trim())){throw new Error("No Apex code to run")}const t=await(0,d.promiseMap)(this.step.parameterValues,(async e=>{const t=await(0,n.computeExpressionPromise)(e,this.context,this.exportsGlobal,this.exportsTest);const s=(0,o.isObject)(t.evaluatedText)?JSON.stringify(t.evaluatedText):t.evaluatedText;return typeof s==="string"?`String ${e.targetName} = ${(0,u.textToJsString)(s)};`:null}));return[...t.filter(Boolean),this.step.code].join("\n")}parseResults(e){if(!e){return{}}try{return JSON.parse(e)}catch(t){p.error("failed to parse apex results",{err:t,results:e});return{}}}async execute(e){var t;Object.assign(this.context.data,{timeToPlayStep:e});const{testimServicesApi:s,context:{projectId:o,config:{sfdcCredential:n}}}=this;try{const e=await s.dropbear.post({query:h,variables:{code:await this.getApexCodeWithParams(),credentialId:n}},o,m,f);if(!e){throw new Error("Apex execution failed")}const a=(t=e.data)===null||t===void 0?void 0:t.executeApex;const r=this.parseResults(a===null||a===void 0?void 0:a.results);const c=r===null||r===void 0?void 0:r.exportsGlobal;const l=r===null||r===void 0?void 0:r.exportsTest;if(c){Object.entries(c).forEach((([e,t])=>{this.reportExecuteResultWithExport(e,t,"global")}))}if(l){Object.entries(l).forEach((([e,t])=>{this.reportExecuteResultWithExport(e,t,"test")}))}if(r===null||r===void 0?void 0:r.exports){Object.entries(r.exports).forEach((([e,t])=>{this.reportExecuteResultWithExport(e,t,"local")}));this.context.data.exports=r.exports}if((a===null||a===void 0?void 0:a.success)&&(a===null||a===void 0?void 0:a.logs)){return await this.onExecuteResult({success:true,tstConsoleLogs:(0,i.parseApexExecutionLog)(a.logs[0]||"",new Date),context:this.context.data,exportsGlobal:c,exportsTest:l})}if((a===null||a===void 0?void 0:a.success)===false){return a}throw new Error("Apex execution returned empty payload")}catch(e){p.error("failed to execute apex step",{err:e});const t=e instanceof l.TimeoutError?"Apex execution timeout":e===null||e===void 0?void 0:e.message;return{success:false,errorType:r.stepResult.SALESFORCE_APEX_FAILURE,reason:t,shouldRetry:false,resultInfo:{error:t}}}}}t.SfdcApexActionStepPlayback=g},1277:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SfdcStepPlayback=void 0;const o=s(831);const n=s(985);const a=e=>e.error!==undefined;class i extends n.SfdcBaseStepPlayback{async execute(e){var t;const{step:s,context:n,testimServicesApi:i}=this;try{const e=o.playbackLogger.getLogger(n.loggerKey);e.log("dropbear execute");const{sfdcData:r}=s;await this.preEvaluate(r);e.log("dropbear execute compiling",r,n.projectId);const c=await i.dropbear.compile(r,n.projectId,n.config.sfdcCredential);if(Array.isArray(c)&&((t=c[0])===null||t===void 0?void 0:t.type)!=="login"){e.log("cformat",c)}if(a(c)){throw new Error(`bFormat validation failed: ${c.error}`)}n.sfdcTestActions=c}catch(e){return{success:false,reason:e.reason||e.message,exception:e,shouldRetry:false}}return await super.execute(e)}async preEvaluate(e){switch(e.type){case"loginAs":if(e.username!==undefined){e.username=await this.evaluateExpression({expression:e.username})}break;default:break}}}t.SfdcStepPlayback=i},1278:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileSetTextStepPlayback=void 0;const o=s(818);const n=s(5);const a=s(823);const i=s(12);const r=s(7);class c extends o.StepPlayback{async execute(){const{context:e,step:t,exportsGlobal:s,exportsTest:o}=this;const c=e.data[t.targetId||"targetId"];const{appiumApi:l}=e;if(!l){return{success:false,errorType:n.commonConstants.stepResult.UNKNOWN_ERROR}}try{if(!(c===null||c===void 0?void 0:c.locatedElement)){return{success:false,errorType:n.commonConstants.stepResult.ELEMENT_NOT_FOUND}}const u=c.locatedElement;let d="";if(t.expression){const n=await(0,a.computeExpressionPromise)(t.expression,e,s,o);d=(n===null||n===void 0?void 0:n.evaluatedText)||"";d=d.toString()}let p=u.elementId;if(p===""){let e=false;if(u.xpath){const t=await l.getElementsIdsByXpath(u.xpath);if(t.length===1){e=true;p=t[0]}}if(!e){return{success:false,resultInfo:{error:"Element Id not found"}}}}if(i.default.flags.mobileOpenKeyboardOnSetText.isEnabled()){await l.tap(p)}await l.clear(p);await l.typeKeys(p,d);if(e.project.type===n.commonConstants.test.IOS&&i.default.flags.mobileCloseKeyboardOnSetTextInIos.isEnabled()){await r.utils.delay(500);const e=await l.isKeyboardShown();if(e){await l.typeKeys(p,"\n")}}if(e.project.type!==n.commonConstants.test.IOS&&i.default.flags.mobileOpenKeyboardOnSetText.isEnabled()){await l.hideKeyboard();await r.utils.delay(500)}return{success:true}}catch(e){return{success:false,exception:e,errorType:n.commonConstants.stepResult.TEXT_ACTION_FAILURE,resultInfo:{error:e.message}}}}}t.MobileSetTextStepPlayback=c},1279:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileSwipePlayback=void 0;const o=s(818);const n=s(96);class a extends o.StepPlayback{async execute(){var e,t,s,o,a,i,r;const{context:c,step:l}=this;try{let e=l.from;let t=l.to;if(l.pointsRatio){const{width:s,height:o}=await c.deviceDimensions;e={x:l.pointsRatio.xFromRatio*s,y:l.pointsRatio.yFromRatio*o};t={x:l.pointsRatio.xToRatio*s,y:l.pointsRatio.yToRatio*o}}await c.appiumApi.touchPerform([{action:"press",options:e},{action:"wait",options:{ms:l.duration}},{action:"moveTo",options:t},{action:"release"}]);this.context.prevSwipesData.push({appiumScaled:{from:e,to:t},pointsRatio:l.pointsRatio});return{success:true}}catch(c){if(c instanceof n.TypedHttpError){if(((t=(e=c.response)===null||e===void 0?void 0:e.value)===null||t===void 0?void 0:t.error)==="invalid argument"){const e=(s=c.response)===null||s===void 0?void 0:s.value;if(e===null||e===void 0?void 0:e.message.startsWith("Coordinate")){return{success:false,reason:e.message,exception:c,errorType:"Failed device interaction - swipe",shouldRetry:false}}}if(c.status===400&&((a=(o=c.response)===null||o===void 0?void 0:o.value)===null||a===void 0?void 0:a.error)==="invalid element state"&&((r=(i=c.response)===null||i===void 0?void 0:i.value)===null||r===void 0?void 0:r.message)==="Swipe action cannot be performed"){return{success:false,reason:c.message,exception:c,errorType:"Failed device interaction - swipe",shouldRetry:true}}}return{success:false,reason:c.message,exception:c,errorType:"Failed device interaction - swipe",shouldRetry:false}}}}t.MobileSwipePlayback=a},1280:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileResetAppStepPlayback=void 0;const o=s(818);const n=s(181);const a=s(7);class i extends o.StepPlayback{async execute(){var e;try{await((e=this.context.appiumApi)===null||e===void 0?void 0:e.resetApp());if(!a.utils.isNode()){await this.remoteRecordingService.abortPendingDomRequest({}).catch((()=>{}))}return{success:true}}catch(e){return{success:false,reason:e.message,exception:e,errorType:"App data reset failed",shouldRetry:false}}}get remoteRecordingService(){const{context:e}=this;const t=e.playback.id;return n.switchboard.scoped(t).getRemote("recordingService",{ignoreTimeoutByDefault:true})}}t.MobileResetAppStepPlayback=i},1281:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SfdcPermissionValidationStepPlayback=void 0;const o=s(850);const n=s(5);const a=s(8);const i=a.Logger.getLogger("sfdc-permission-validation-step");const r=`\nquery SalesforceProfilePermissions($credentialId: String, $userName: String!, $profileName: String!,$sobjectNames: [String!]) {\n    profilePermissions(credentialId: $credentialId, userName: $userName, profileName:$profileName, sobjectNames:$sobjectNames) {\n        apiName,\n        objectPermissions {\n            edit\n            read\n            create\n            delete\n            viewAll\n            modifyAll\n        }\n        fieldPermissions {\n            apiName\n            label\n            edit\n            read\n        }\n    }\n}`;const c=`\nquery PermissionValidationPersonaUsername($profileName: String, $uuid: String, $credentialId: String) {\n    testProfile(profileName: $profileName, uuid: $uuid, credentialId: $credentialId) {\n        username\n    }\n}`;const l=["edit","read","create","delete","viewAll","modifyAll"];const u=function(e,t,s){let o=true;const n=[];if(e===t)return{success:o,logs:n};if(!(e instanceof Object)||!(t instanceof Object))return{success:false,logs:["Invalid Object"]};Object.keys(e).forEach((a=>{if(l.includes(a)){if(!Object.hasOwn(t,a)){o=false;n.push(`${s}.'${a}' does not exist`)}if(e[a]!==t[a]){o=false;n.push(`${s}.'${a}' Expected: '${e[a]}; Actual '${t[a]}' `)}}}));return{success:o,logs:n}};class d extends o.ParameterStepPlayback{isUserPermissionValidation(){if(this.step.sfdcData.type!=="permissionValidationAction"){throw new Error("Invalid Step Type")}return this.step.sfdcData.validationType==="persona"}getProfileOrPersonaName(){if(this.step.sfdcData.type!=="permissionValidationAction"){throw new Error("Invalid Step Type")}return this.step.sfdcData.name||""}getPersonaUuid(){if(this.step.sfdcData.type!=="permissionValidationAction"){throw new Error("Invalid Step Type")}return this.step.sfdcData.profilePath||""}getSobjectApiNames(){var e;if(this.step.sfdcData.type!=="permissionValidationAction"){throw new Error("Invalid Step Type")}if(!((e=this.step.sfdcData.sobjectPermissions)===null||e===void 0?void 0:e.length)){throw new Error("No sObjects to validate")}return this.step.sfdcData.sobjectPermissions.map((e=>e.apiName))}validatePermissionSet(e){var t,s;let o=true;const n=[];if(this.step.sfdcData.type==="permissionValidationAction"){const a=(t=this.step.sfdcData.sobjectPermissions)===null||t===void 0?void 0:t.find((t=>t.apiName===e.apiName));const i=(a===null||a===void 0?void 0:a.sObjectLabel)||"";const{success:r,logs:c}=u(a===null||a===void 0?void 0:a.objectPermissions,e.objectPermissions,i);o&&(o=r);n.push(...c);(s=a===null||a===void 0?void 0:a.fieldPermissions)===null||s===void 0?void 0:s.forEach((t=>{var s;const a=(s=e.fieldPermissions)===null||s===void 0?void 0:s.find((e=>e.apiName===t.apiName));const{success:r,logs:c}=u(t,a,`${i}.${t===null||t===void 0?void 0:t.label}`);o&&(o=r);n.push(...c)}))}return{success:o,logs:n}}validatePermissionSets(e){let t=true;const s=[];e.forEach((e=>{const{success:o,logs:n}=this.validatePermissionSet(e);t&&(t=o);s.push(...n)}));if(t){return{success:t,context:this.context.data}}if(s.length){this.context.playback.sfdcAddLog("error",`Permission validation for profile '${this.getProfileOrPersonaName()}' failed`)}s.forEach((e=>{this.context.playback.sfdcAddLog("error",e)}));return{success:t,reason:"Permission Validation Failed: Check Salesforce logs for more information",context:this.context.data,shouldRetry:false,resultInfo:{error:s.join("\n")}}}async execute(e){Object.assign(this.context.data,{timeToPlayStep:e});const{testimServicesApi:t,context:{projectId:s,config:{sfdcCredential:o}}}=this;try{let e=this.getProfileOrPersonaName();if(this.isUserPermissionValidation()){const{data:{testProfile:{username:n}}}=await t.dropbear.post({query:c,variables:{profileName:e,uuid:this.getPersonaUuid(),credentialId:o}},s);e=n}if(!e){throw new Error("Invalid Profile or Persona name")}const{data:{profilePermissions:n}}=await t.dropbear.post({query:r,variables:{profileName:this.isUserPermissionValidation()?"":e,sobjectNames:this.getSobjectApiNames(),credentialId:o,userName:this.isUserPermissionValidation()?e:""}},s);return this.validatePermissionSets(n)}catch(e){i.error("Failed to execute permission validation step",{err:e});const t=e===null||e===void 0?void 0:e.message;return{success:false,errorType:n.stepResult.SALESFORCE_STEP_INPUT_ERROR,reason:t,shouldRetry:false,resultInfo:{error:t}}}}}t.SfdcPermissionValidationStepPlayback=d},1282:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileCodeVerificationStepPlayback=void 0;const o=s(818);const n=s(5);const a=s(823);const i=s(136);const r=s(7);class c extends o.StepPlayback{async execute(){var e;const{context:t,step:s,exportsGlobal:o,exportsTest:c}=this;try{let n="";const l=s.delayBetweenCharacters||0;if(s.expression){const i=await(0,a.computeExpressionPromise)(s.expression,t,o,c);n=((e=i===null||i===void 0?void 0:i.evaluatedText)===null||e===void 0?void 0:e.toString())||""}for(const e of n){const s=i.ANDROID_KEYCODES_MAP[Number(e)];await Promise.all([t.appiumApi.pressKeyCode(s),r.utils.delay(l)])}return{success:true}}catch(e){return{success:false,exception:e,errorType:n.commonConstants.stepResult.TEXT_ACTION_FAILURE,resultInfo:{error:e.message}}}}}t.MobileCodeVerificationStepPlayback=c},1283:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileAndroidBackStepPlayback=void 0;const o=s(818);const n=s(8);const a=4;const i=n.Logger.getLogger("stepPlayback");class r extends o.StepPlayback{async execute(){var e;const{context:t}=this;try{await((e=t.appiumApi)===null||e===void 0?void 0:e.pressKey(a));return{success:true}}catch(e){const t="Android Back Failed";i.warn(t);return{success:false,reason:e.message,exception:e,errorType:t,shouldRetry:false}}}}t.MobileAndroidBackStepPlayback=r},1284:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileScrollToTextStepPlayback=void 0;const o=s(818);const n=s(7);const a=s(823);const i=s(946);const r=s(291);const c=s(108);const l=s(277);const u=100;const d=1.2;const p=.8;class m extends o.StepPlayback{async execute(){const{step:e,context:t}=this;try{if(!e.element){throw new Error("Element is not set, please reassign")}const s=e.expression2;if(!(s===null||s===void 0?void 0:s.expression)){throw new Error("No expression to match")}const{evaluatedText:o}=this.getExpression(s);const n=o.replace(/[\\"']/g,"\\$&");const a=t.project.type==="android"?await this.androidScrollToText(n):await this.iosScrollToText(n);if(!a){throw new Error(`Could not find ${e.matchTextMode} expression: ${n}`)}return{success:true}}catch(e){return{success:false,reason:e.message||e.reason,exception:e,errorType:"Failed to execute MobileScrollToTextStep",shouldRetry:false}}}getExpression(e){return n.utils.isRegExp(e.expression)?{evaluatedText:e.expression}:(0,a.computeExpression)(e,this.context,this.exportsGlobal,this.exportsTest)}async iosScrollToText(e){const{context:t,step:s}=this;let o=await t.appiumApi.ios.isTextVisible(e,s.matchTextMode);if(o){return true}let n=s.maxNumberOfSwipes;while(!o&&n>0&&t.playback.isRunning){await t.appiumApi.ios.applicationScroll(s.scrollDirection);o=await t.appiumApi.ios.isTextVisible(e,s.matchTextMode);if(!o){await t.appiumApi.ios.applicationSwipe(s.scrollDirection);o=await t.appiumApi.ios.isTextVisible(e,s.matchTextMode)}n-=1}return o}async androidScrollToText(e){var t;const{context:s,step:o}=this;const n=(t=o.element.mobileLocator.attributes)===null||t===void 0?void 0:t.text.currentValue;let a=await s.appiumApi.android.isTextVisible(e,o.matchTextMode,n);if(a){return true}let r=o.maxNumberOfSwipes;while(!a&&r>0&&s.playback.isRunning){const t=await this.getElementToScrollOn();const l=this.calculateTouchPoints(t.bounds);await s.appiumApi.touchPerform([{action:"press",options:l.from},{action:"wait",options:{ms:i.DEFAULT_SWIPE_WAIT}},{action:"moveTo",options:l.to},{action:"release"}]);await(0,c.delay)(1e3);a=await s.appiumApi.android.isTextVisible(e,o.matchTextMode,n);r-=1}return a}async getElementToScrollOn(){let e;const t=await this.getAllScrollableElements();if(!t.length){throw new Error("No scrollable element on the screen, cannot scroll")}const s=await this.getRecordedScrollableParent();if(!s){e=this.getLargestScrollableElement(t)}else if(t.length===1){e=t[0]}else{const o=s.resourceId;const n=t.filter((e=>e.resourceId===o&&o.length));if(!n.length){e=this.matchByBounds(s.bounds,t)}else if(n.length===1){e=n[0]}else{e=this.matchByBounds(s.bounds,n)}}return e}androidGetScrollableElementsOnScreen(){const{context:e}=this;return e.appiumApi.requestElementsIds("-android uiautomator","new UiSelector().scrollable(true)")}async buildScrollableParents(e){const{context:t}=this;const s=async e=>{const[s,o]=await Promise.all([t.appiumApi.getElementAttribute(e,"bounds"),t.appiumApi.getElementAttribute(e,"resource-id")]);const n=this.getBoundRectangleArea(s);return{elementId:e,bounds:s,resourceId:o,size:n}};return await Promise.all(e.map((e=>s(e))))}async waitForScrollableParents(){const{context:e}=this;const t=await this.androidGetScrollableElementsOnScreen();if(!t.length&&e.playback.isRunning){await n.utils.delay(500);return this.waitForScrollableParents()}return this.buildScrollableParents(t)}async getAllScrollableElements(){const e=await this.androidGetScrollableElementsOnScreen();const t=await this.buildScrollableParents(e);if(!t.length){return this.waitForScrollableParents()}return t}async getRecordedScrollableParent(){var e,t;const{step:s}=this;let o;if(s.element instanceof r.MobileLocateStep){const{parents:e}=s.element.mobileLocator;o=e.find((e=>{var t;return((t=e.attributes.scrollable)===null||t===void 0?void 0:t.currentValue)==="true"}))}if(o){const s=(e=o.attributes["resource-id"])===null||e===void 0?void 0:e.currentValue;const n=(t=o.attributes.bounds)===null||t===void 0?void 0:t.currentValue;const a=this.getBoundRectangleArea(n);return{resourceId:s,bounds:n,size:a}}return o}getLargestScrollableElement(e){return e.sort(((e,t)=>e.size-t.size)).pop()}matchByBounds(e,t){const s=this.getBoundRectangleArea(e);const o=t.reduce(((e,t)=>{const o=this.getBoundRectangleArea(t.bounds);const n=Math.abs(s-o);if(!e.sizeDiff||n<e.sizeDiff){e.sizeDiff=n;e.scrollableElement=t}return e}),{});return o.scrollableElement}getBoundRectangleArea(e){const{width:t,height:s}=(0,l.parseBounds)(e);return t*s}calculateTouchPoints(e){const{step:t}=this;const{left:s,top:o,width:n,height:a}=(0,l.parseBounds)(e);const i=s+n;const r=o+a;const c=(i+s)/2;let m=o;if(o===0){m=u}const f=d*m;const h=p*r;if(t.scrollDirection==="down"){const e={from:{x:c,y:h},to:{x:c,y:f}};if(e.from.y<e.to.y){e.from.y=(r+m)/2;e.to.y=m/2}return e}return{from:{x:c,y:f},to:{x:c,y:h}}}}t.MobileScrollToTextStepPlayback=m},1285:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileHomeButtonStepPlayback=void 0;const o=s(818);const n=s(1286);const a=s(5);class i extends o.StepPlayback{get isAndroidProject(){return this.context.project.type===a.commonConstants.test.ANDROID}async execute(){const{context:e}=this;try{if(this.isAndroidProject){await e.appiumApi.pressKeyCode(n.ANDROID_HOME_BUTTON)}else{await e.appiumApi.pressOnHomeButton()}return{success:true}}catch(e){const t=this.getReason(e);return{success:false,reason:t,exception:e,errorType:"Pressing on the home button failed",shouldRetry:false}}}getReason(e){let t=e.message;if(!this.isAndroidProject&&e.status===404){t="Your TMA version doesn't support this action, please update"}return t}}t.MobileHomeButtonStepPlayback=i},1286:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.AppiumApi=t.ANDROID_HOME_BUTTON=void 0;const o=s(6);const n=s(49);const a=s(96);const i=s(872);const r=s(279);const c=s(8);const l=c.Logger.getLogger("appiumApi");const u={0:"notInstalled",1:"notRunning",2:"backgroundOrSuspended",3:"background",4:"foreground"};t.ANDROID_HOME_BUTTON=3;class d{constructor(e,t,s=(window===null||window===void 0?void 0:window.DOMParser)){this.baseUrl=e;this.sessionId=t;this.DOMParserCtor=s;this.android={isTextVisible:async(e,t,s)=>{const o=t==="exact"?"text":"textContains";const n=`new UiSelector().${o}("${e}")`;const a=this.requestElementsIds("-android uiautomator",n);const i=[a];if(!s){const s=t==="exact"?"description":"descriptionContains";const o=`new UiSelector().${s}("${e}")`;const n=this.requestElementsIds("-android uiautomator",o);i.push(n)}const r=(await Promise.all(i)).flat();return Boolean(r.length)}};this.ios={isTextVisible:async(e,t)=>{const s=t==="exact"?`value == '${e}'`:`value contains '${e}'`;const o=await this.requestElementsIds("-ios predicate string",s);const n=await Promise.all(o.map((e=>this.getElementAttribute(e,"visible"))));return n.includes("true")},applicationSwipe:async(e,t=250)=>{await this.executeSync("mobile: swipe",[{direction:e,velocity:t}])},applicationScroll:e=>this.executeSync("mobile: scroll",[{direction:e}]),getSource:async e=>{const t=await this.executeSync("mobile: source",[{format:"xml",excludedAttributes:e.excludedAttributes}],e.abortSignal);return(new this.DOMParserCtor).parseFromString(t.value,"text/xml")}};if(typeof localStorage!=="undefined"&&localStorage.getItem("appiumUrl")){this.baseUrl=localStorage.getItem("appiumUrl")}if(this.baseUrl.endsWith("/")){this.baseUrl=this.baseUrl.slice(0,-1)}}async getDeviceSize(){const{value:e}=await n.httpRequest.getJson(`${this.baseUrl}/session/${this.sessionId}/window/current/size`);return e}async getDom(e){const t=await n.httpRequest.getJson(`${this.baseUrl}/session/${this.sessionId}/source`,undefined,e);return(new this.DOMParserCtor).parseFromString(t.value,"text/xml")}async getScreenshot(){const{value:e}=await n.httpRequest.getJson(`${this.baseUrl}/session/${this.sessionId}/screenshot`);return e}async endSession(){try{await n.httpRequest.delete(`${this.baseUrl}/session/${this.sessionId}`)}catch(e){if(e instanceof a.TypedHttpError&&e.status!==404){l.warn("Failed to delete session",{sessionId:this.sessionId,...e})}}}async requestElementsIds(e,t){const s=await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/elements`,{using:e,value:t});return s.value.map((e=>e.ELEMENT))}async requestsElementsIdsByAndroidUISelector(e,t){const s=typeof t==="string"?`"${t}"`:t;const o=`new UiSelector().${e}(${s})`;return this.requestElementsIds("-android uiautomator",o)}async getElementsIdsByAttributeId(e,t,s){if(t===r.MobileSelectorMatchMethod.Equals){return this.requestElementsIds("id",e)}switch(s){case"ios":return this.getElementsIdsByXpathAttributeMatch("name",e,t);case"android":return this.requestsElementsIdsByAndroidUISelectorMatch("resourceId",e,t);default:throw new Error(`device: ${s} is not supported.`)}}async getElementsIdsByText(e,t,s,o){var n;switch(s){case"ios":return((n=t.label)===null||n===void 0?void 0:n.currentValue)?this.getElementsIdsByXpathAttributeMatch("label",e,o):this.getElementsIdsByXpathAttributeMatch("value",e,o);case"android":return this.requestsElementsIdsByAndroidUISelectorMatch("text",e,o);default:throw new Error(`device: ${s} is not supported.`)}}async getElementsIdsByIndex(e,t){switch(t){case"ios":return this.getElementsIdsByXpathAttributeMatch("index",e.toString(),r.MobileSelectorMatchMethod.Equals);case"android":return this.requestsElementsIdsByAndroidUISelector("index",e);default:throw new Error(`device: ${t} is not supported.`)}}async getElementsIdsByClassName(e,t,s){if(t===r.MobileSelectorMatchMethod.Equals){return this.requestElementsIds("class name",e)}switch(s){case"ios":return this.getElementsIdsByXpathAttributeMatch("type",e,t);case"android":return this.requestsElementsIdsByAndroidUISelectorMatch("class",e,t);default:throw new Error(`device: ${s} is not supported.`)}}async getElementsIdsByContentDesc(e,t,s){switch(s){case"ios":return[];case"android":return this.requestsElementsIdsByAndroidUISelectorMatch("content-desc",e,t);default:throw new Error(`device: ${s} is not supported.`)}}async getElementsIdsByXpath(e){return this.requestElementsIds("xpath",e)}async requestsElementsIdsByAndroidUISelectorMatch(e,t,s){if(!(e==="text"||e==="class"||e==="resourceId"))return[];if(e==="class")e="className";let n;let a;switch(s){case r.MobileSelectorMatchMethod.Equals:n=`new UiSelector().${e}(${`"${t}"`})`;break;case r.MobileSelectorMatchMethod.Contains:a=`".*${o.escapeRegExp(t)}.*"`;n=`new UiSelector().${e}Matches(${a})`;break;case r.MobileSelectorMatchMethod.StartsWith:a=`"^${o.escapeRegExp(t)}.*"`;n=`new UiSelector().${e}Matches(${a})`;break;case r.MobileSelectorMatchMethod.EndsWith:a=`".*${o.escapeRegExp(t)}$"`;n=`new UiSelector().${e}Matches(${a})`;break;default:return[]}return this.requestElementsIds("-android uiautomator",n)}async getElementsIdsByXpathAttributeMatch(e,t,s){let o;switch(s){case r.MobileSelectorMatchMethod.Equals:o=`//*[@${e} = '${t}']`;break;case r.MobileSelectorMatchMethod.Contains:o=`//*[contains(@${e}, '${t}')]`;break;case r.MobileSelectorMatchMethod.StartsWith:o=`//*[starts-with(@${e}, '${t}')]`;break;case r.MobileSelectorMatchMethod.EndsWith:o=`//*[substring(@${e}, string-length(@${e}) - string-length('${t}') + 1) = '${t}']`;break;default:return[]}return this.requestElementsIds("xpath",o)}async getElementsIdsByImage(e){return this.requestElementsIds("-image",e)}async getElementsIdsBySelector(e,t,s,o,n){switch(e){case"id":return await this.getElementsIdsByAttributeId(t,n,o);case"text":case"label":case"value":return await this.getElementsIdsByText(t,s,o,n);case"class":case"type":return await this.getElementsIdsByClassName(t,n,o);case"index":return await this.getElementsIdsByIndex(t,o);case"xpath":case"closestParentIndexOnlyXpath":case"indexOnlyXpath":case"xpathWithoutIndices":return await this.getElementsIdsByXpath(t);case"closestText":return[];case"contentDesc":return await this.getElementsIdsByContentDesc(t,n,o);default:break}return[]}async isElementsEquals(e,t,s){let o=false;const n=await this.getCacheElementLocation(e,s);const a=await this.getCacheElementLocation(t,s);if(n.x===-1&&n.y===-1||(a.x===-1||a.x===-1)){o=false}else{o=n.x===a.x&&n.y===a.y}return o}async verifyElementsLocationCache(e,t){i.AlgoUtils.Logging.log(`**** Elements size is ${e.length} before verification.`);for(let s=0;s<e.length;s++){const o=e[s];try{await this.getElementLocation(o)}catch(n){i.AlgoUtils.Logging.log("Verify location not found, deleting from Elements.");t.delete(o);e.splice(s,1);s--}}i.AlgoUtils.Logging.log(`**** Elements size is ${e.length} after verification.`)}async getCacheElementLocation(e,t){let s=t.get(e);if(s){return s}try{s=await this.getElementLocation(e);t.set(e,s);return s}catch(e){i.AlgoUtils.Logging.log("Location not found");return{x:-1,y:-1}}}async getElementLocation(e){const{value:t}=await n.httpRequest.getJson(`${this.baseUrl}/session/${this.sessionId}/element/${e}/location`);return t}async getElementId(e){const t=await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/element`,{using:"xpath",value:e});return t.value.ELEMENT}async getElementAttribute(e,t){const{value:s}=await n.httpRequest.get(`${this.baseUrl}/session/${this.sessionId}/element/${e}/attribute/${t}`);return s}async getElementText(e){const{value:t}=await n.httpRequest.get(`${this.baseUrl}/session/${this.sessionId}/element/${e}/text`);return t}async tapOnPoint(e,t=50){const s={actions:[]};const o={type:"pointer",id:"finger1",parameters:{pointerType:"touch"},actions:[{type:"pointerMove",duration:0,x:e.x,y:e.y},{type:"pointerDown",button:1},{type:"pause",duration:t},{type:"pointerUp",button:1}]};s.actions.push(o);await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/actions`,s)}async tap(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/element/${e}/click`,{})}async doubleTap(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/doubleclick`,{element:e})}async longPress(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/longclick`,{element:e})}async scroll(e,t){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/scroll`,{x:e,y:t})}async swipe(e,t,s){return await this.touchPerform([{action:"press",options:e},{action:"wait",options:{ms:s}},{action:"moveTo",options:t},{action:"release"}])}async flick(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/flick`,e)}async multiTouchPerform(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/multi/perform`,{actions:e})}async touchPerform(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/perform`,{actions:e})}async actions(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/actions`,e)}async move(e,t){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/touch/move`,{x:e,y:t})}async clear(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/element/${e}/clear`,{})}async typeKeys(e,t){const s=typeof t==="string"?{text:t}:{value:t};await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/element/${e}/value`,s)}async hideKeyboard(e,t={}){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/hide_keyboard`,t,[],e)}async isKeyboardShown(){const{value:e}=await n.httpRequest.get(`${this.baseUrl}/session/${this.sessionId}/appium/device/is_keyboard_shown`);return e}async pressKeyCode(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/press_keycode`,{keycode:e})}async updateDeviceSettings(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/settings`,e)}async isDeviceLocked(){const{value:e}=await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/is_locked`);return e}async resetApp(){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/app/reset`,{})}async pressOnHomeButton(){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/execute`,{script:"mobile: pressButton",args:{name:"home"}})}async activateApp(e){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/activate_app`,e)}async pressKey(e,t,s){await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/press_keycode`,{keycode:e,metastate:t,flags:s})}async getAppState({bundleId:e,appPackage:t}){const{value:s}=await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/device/app_state`,{bundleId:e,appId:t});return u[s]}async executeSync(e,t,s){return n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/execute/sync`,{script:e,args:t},undefined,undefined,undefined,s)}async executeDriverScript(e,t){const{value:s}=await n.httpRequest.postJson(`${this.baseUrl}/session/${this.sessionId}/appium/execute_driver`,{script:e,timeout:t,type:"webdriverio"});return s}async getSessionDeviceLogsUntilNow(){const{value:e}=await n.httpRequest.postForm(`${this.baseUrl}/session/${this.sessionId}/log`,{type:"logcat"});return e}}t.AppiumApi=d},1287:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileAttributeValidationStepPlayback=void 0;const o=s(823);const n=s(818);const a=s(944);const i=s(5);const r=s(96);const c=s(7);class l extends n.StepPlayback{async execute(){const{step:e,context:t,exportsGlobal:s,exportsTest:n}=this;let l;let u;try{if(!t.appiumApi){return{success:false}}const r=new a.MobileLocateElement(t.appiumApi,t.project.type,t.servicesApi,this.context.loggerKey);const d=await r.locateElement(e.element.mobileLocator,t.project.id,this.context.testId,e.id,t.device,t.playback.testResult.resultId);if(!d){return{success:false}}const p=d.elementId;u=(0,o.computeExpression)(e.attrName,t,s,n).evaluatedText;l=Object.fromEntries(d.selectorsScores.entries());const m=await t.appiumApi.getElementAttribute(p,u);const f=(0,o.computeExpression)(e.expectedAttrValue,t,s,n);const h=f.evaluatedText;const g=c.utils.compareOrMatch(h,m);if(g){return{success:true,selectorsScores:l}}return{errorType:i.stepResult.TEXT_COMPARE_FAILURE,resultInfo:{expected:String(h),actual:m},success:false,selectorsScores:l}}catch(e){let t=i.stepResult.UNKNOWN_ERROR;let s=e.message;if(e instanceof r.TypedHttpError){const{message:o}=e.response.value||{};if(typeof o==="string"&&u&&(/The attribute '.*' is unknown/g.test(o)||/'.*' attribute is unknown for the element/g.test(o))){s=`Unknown ${JSON.stringify(u)} attribute`;t=i.stepResult.UNKNOWN_MOBILE_ATTRIBUTE}else if(e.status===404){t=i.stepResult.ELEMENT_NOT_FOUND}}return{errorType:t,exception:e,success:false,reason:s,resultInfo:{error:e.message},selectorsScores:l}}}}t.MobileAttributeValidationStepPlayback=l},1288:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ExecuteDriverScriptStepPlayback=void 0;const o=s(849);const n=s(5);class a extends o.JSStepPlayback{overrideConsoleFunctions(e){const t=["log","info","warn","error","debug"];const s=(...e)=>{let t=`${e.shift()}`;if(!e.length){return t}t=t.replace(/%([odifs])/g,((t,s)=>{let o;if(!e.length){return""}o=e.shift();if(s==="o"){return`${o}`}if(s==="d"||s==="i"){const e=o?1:0;o=typeof o==="boolean"?e:parseInt(o,10);return Number.isNaN(o)?"0":`${o}`}if(s==="f"){const e=o?1:0;o=typeof o==="boolean"?e:parseFloat(o);return Number.isNaN(o)?"0.000000":`${o.toFixed(6)}`}if(s==="s"){return`${o}`}return""}));if(t){e.unshift(t)}return e.join(" ").replace(/\\s*$/," ")};const o=(t,...o)=>{const n=s(o);e.push({method:t,msg:n,timestamp:Date.now()})};return Object.fromEntries(t.map((e=>[e,(...t)=>o(e,...t)])))}constructWithArguments(e){const t=Object.getPrototypeOf((async()=>null)).constructor;function s(){return t.apply(null,e)}s.prototype=t.prototype;return new s}async execute(){var e,t,s;const{context:{data:o,appiumApi:a,incomingParams:i={}},step:{code:r}}=this;const c=["driver","console","context"].concat(((e=i.as)===null||e===void 0?void 0:e.functionParameters)||[]).concat(["exports","exportsTest","exportsGlobal"]);try{this.constructWithArguments(c.concat(r))}catch(e){return{success:false,shouldRetry:false,reason:`JavaScript syntax error: ${e.message}`,errorType:n.commonConstants.stepResult.JS_SYNTAX_ERROR}}const l={incomingParams:i,context:{},exportedData:{},exportedTestData:{},exportedGlobalData:{}};const u=`\n            const tstConsoleLogs = [];\n            function ${this.overrideConsoleFunctions.toString()}\n\n            const { incomingParams, context, exportedData, exportedTestData, exportedGlobalData } = ${JSON.stringify(l)};\n\n            const incomingParamsFunctionArgumentsPromise = (incomingParams.as?.functionArguments || []).map(fnArg => {\n                if (fnArg.locatorId && fnArg.selector) {\n                    return driver.$(fnArg.selector);\n                }\n                return fnArg;\n            });\n\n            const args = [driver, overrideConsoleFunctions(tstConsoleLogs), context]\n                .concat(await Promise.all(incomingParamsFunctionArgumentsPromise))\n                .concat([exportedData, exportedTestData, exportedGlobalData]);\n\n            const functionToRun = async function codeStep(${c.join(",")}) {\n                ${r}\n            };\n\n            try {\n                const result = await functionToRun.apply(null, args);\n                return {\n                    success: true,\n                    tstConsoleLogs,\n                    result: {\n                        resultValue: result,\n                        exports: exportedData,\n                        exportsTest: exportedTestData,\n                        exportsGlobal: exportedGlobalData,\n                    },\n                };\n            } catch (err) {\n                return {\n                    success: false,\n                    tstConsoleLogs,\n                    result: {\n                        resultValue: err?.toString(),\n                        exports: exportedData,\n                        exportsTest: exportedTestData,\n                        exportsGlobal: exportedGlobalData,\n                    },\n                };\n            }\n    `;try{const{result:e}=await a.executeDriverScript(u);const t=e;if(!("success"in t)){throw new Error("unknown error")}const{result:{exports:s,exportsGlobal:i,exportsTest:r,resultValue:c},success:l,tstConsoleLogs:d}=t;if(l){o.exports=s}return{data:o,success:l,exportsTest:r,exportsGlobal:i,tstConsoleLogs:d,...!l&&{reason:c,errorType:n.commonConstants.stepResult.UNWRAPPED_AUT_REJECT,resultInfo:{error:c}}}}catch(e){const o=(s=(t=e.response)===null||t===void 0?void 0:t.value)===null||s===void 0?void 0:s.message;return{success:false,reason:o||e.message,exception:e,errorType:n.commonConstants.stepResult.UNKNOWN_ERROR,shouldRetry:false}}}}t.ExecuteDriverScriptStepPlayback=a},1289:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DocumentValidationStepPlayback=void 0;const o=s(6);const n=s(831);const a=s(850);const i=s(823);class r extends Error{}class c extends a.ParameterStepPlayback{constructor(){super(...arguments);this.downloadFileResult=null}clearDownloadFileResult(){this.downloadFileResult=null}async evaluateExpression(e){this.buildIncomingParameters();if(Array.isArray(e.expression)){return Promise.all(e.expression.map((async e=>this.computeExpression({expression:e}))))}return this.computeExpression(e)}async computeExpression(e){var t;if(e.expression===""||e.expression===undefined){throw new Error("Invalid Value")}const s=await(0,i.computeExpressionPromise)(e,this.context,this.exportsGlobal,this.exportsTest);const o=s.success?s.evaluatedText:e.expression;return(t=o===null||o===void 0?void 0:o.toString())!==null&&t!==void 0?t:""}onResult(e){this.clearDownloadFileResult();return super.onResult(e)}onBeforeExecute(){return Promise.resolve()}async evaluateIndex(e,t){const s=await this.evaluateExpression({expression:e});const o=parseInt(s,10);if(!Number.isInteger(o)||o<=0){throw new Error(`Invalid ${t} number - '${e}'`)}return o}async execute(e){var t,s,a,i;if(this.step.sfdcData.type!=="documentValidationAction"){throw new Error("Invalid Step Type")}const c=this.step.sfdcData;const l=n.playbackLogger.getLogger(this.context.loggerKey);const u=await(this.downloadFileResult||super.execute(e));const{fileBlob:d,sizeInBytes:p,fileType:m,fileName:f,success:h}=u;const g={sizeInBytes:p,fileType:m,fileName:f,nodePackageNames:undefined};const y=o.pick(u,["fileName","fileType","sizeInBytes","fileBlob"]);if(h!==true){return Object.assign({data:{stepReturn:y}},u,g)}this.downloadFileResult=u;try{const e=await this.testimServicesApi.textract.parseDocument({fileName:f,fileBlob:d,projectId:this.context.projectId});const{content:o="",tables:n=[],keyValuePairs:l={},error:u}=e;if(u){throw new Error(`Failed to parse the document - ${u}`)}for(const e of c.contentActions||[]){const t=await this.evaluateExpression({expression:e.value});const s=e.action==="exists"?o.includes(t):!o.includes(t);if(!s){throw new r(`Content '${t}' was ${e.action==="exists"?"not ":""}found in the document.`)}}const p=Object.keys(l);for(const e of c.kvps||[]){const t=await this.evaluateExpression({expression:e.key});const s=e.action;if(!p.includes(t)){throw new r(`No key-value pair found for key '${t}'`)}if(s.mode==="verify"){const s=await this.evaluateExpression({expression:e.value});if(l[t]!==s){throw new r(`Value '${l[t]}' for the key '${t}' does not match expected value '${s}'`)}}else if(s.mode==="store"){if(s.param.scope==="test")this.exportsTest[e.value]=l[t];if(s.param.scope==="global")this.exportsGlobal[e.value]=l[t]}}for(const e of c.tableActions||[]){const o=e.identifier?await this.evaluateIndex(e.identifier,"table"):1;if(o>n.length){throw new r(`Could not find table number '${o}' - there were '${n.length}' tables detected`)}const c=n[o-1];for(const o of e.actions||[]){const e=await this.evaluateIndex(o.rowNumber,"row");const n=await this.evaluateIndex(o.columnNumber,"column");const l=c.cells.find((t=>t.row===e&&t.column===n));if(!l){throw new r(`No cell found for row '${e}' and column '${n}'`)}if(((t=o.action)===null||t===void 0?void 0:t.mode)==="verify"){const t=await this.evaluateExpression({expression:o.value});if(l.text!==t){throw new r(`Cell[${e},${n}] value '${l.text}' does not match expected value '${t}'`)}}else if(((s=o.action)===null||s===void 0?void 0:s.mode)==="store"){if(o.value===undefined){throw new r(`Invalid value for store operation - Cell[${e},${n}]`)}if(((a=o.action)===null||a===void 0?void 0:a.param.scope)==="test")this.exportsTest[o.value]=l.text;if(((i=o.action)===null||i===void 0?void 0:i.param.scope)==="global")this.exportsGlobal[o.value]=l.text}}}}catch(e){let t=e.message;if(e instanceof r){t=`Validation failed - ${t}`}else{t=`Step execution failed - ${t}`;l.error("Document validation step failed",e)}return{success:false,reason:t,shouldRetry:false}}return{success:true}}}t.DocumentValidationStepPlayback=c},1290:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MobileHideKeyboardStepPlayback=void 0;const o=s(818);const n=s(5);class a extends o.StepPlayback{async execute(){try{const e=this.context.project.type===n.commonConstants.test.IOS?{keyName:this.step.keyName}:{};await this.context.appiumApi.hideKeyboard(undefined,e);return{success:true}}catch(e){return{success:false,reason:"Failed to hide keyboard - the keyboard may not be visible or you selected the wrong submit button label",exception:e,errorType:"Failed to hide keyboard",shouldRetry:false}}}}t.MobileHideKeyboardStepPlayback=a},1291:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.buildCurrentRevisionStatus=void 0;const o=s(6);const n=s(7);const a=s(8);const i=s(111);const r=s(59);const c=a.Logger.getLogger("revision status");const l=async(e,t)=>{var s;const a=new i.RevisionsService;a.sharedStepService=e;const r={test:{revisionId:t.revisions.current,stepId:(s=t.scenario)===null||s===void 0?void 0:s.id}};try{await n.utils.promiseTimeout(e.onReady(),1e4);await a.synchronizeAllStep(t.scenario);const[s]=await a.getAllSharedSteps(t.scenario);const i=await u(e,a,t.testConfig.hooks);const c=o.uniqBy(s.concat(i),"step.sharedStepInfoId");const l=await Promise.all(c.map((async({step:t})=>{var s,o,n,a;return{revisionId:((o=(s=e.getInfoById(t.sharedStepInfoId))===null||s===void 0?void 0:s.revisions)===null||o===void 0?void 0:o.current)||((n=await e.getSharedStepRevision(t.sharedStepInfoId))===null||n===void 0?void 0:n.id),stepId:(a=t.sharedStepClass)===null||a===void 0?void 0:a.id,sharedStepInfoId:t.sharedStepInfoId}})));const d=o.chain(l).keyBy("sharedStepInfoId").mapValues((({revisionId:e,stepId:t})=>({revisionId:e,stepId:t}))).assign(r).value();return{revisionStatus:d,revisions:o.mapValues(d,"revisionId")}}catch(e){c.error("failed to get revision status",e);return r}};t.buildCurrentRevisionStatus=l;async function u(e,t,s){let n=[];if(o.isEmpty(s)){return n}for(const o of Object.values(s)){if(o){const s=await e.loadSharedStepClass(o.infoId);const a=r.stepBuilder.buildStepFromData({type:"scenario",name:"hook scenario",steps:[{type:"shared-step-instance",sharedStepInfoId:o.infoId,name:s.name,classType:s.type}]});await t.synchronizeAllStep(a);const[i]=await t.getAllSharedSteps(a);n=n.concat(i)}}return n}},294:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.playbackTreeBuilder=void 0;const o=s(8);const n=s(7);const a=s(994);const i=s(1291);const r=s(59);const c=s(818);const l=s(85);const u=o.Logger.getLogger("playback tree builder");class d{buildStepPlayback(e,t,s){return(0,a.buildStepPlayback)(e,t,s,this)}buildStepPlayer(e,t,s=[],o=[]){const n=this.buildStepPlayback(e,t,s);let a=[];let i=[];if(s){[,...a]=s}if(o){[,...i]=o}if(t instanceof l.GroupStep){const s=(e,t,s)=>{let o=s;if(t&&t.length>0){o=e.findIndex((e=>e.id===t[0].id));o=o===-1?s:o}return o};const o=s(t.steps,a,0);const r=s(t.steps,i,t.steps.length);const c=t.steps.slice(o,r+1);n.steps=c.map((t=>this.buildStepPlayer(e,t,a,i)))}return n}cloneSharedStepClass(e){return r.stepBuilder.buildStepFromData(e.getSerializableObject())}getRecordedBaseUrl(e){const t=e.testConfig.getSerializableObject();return e.baseUrl||t.baseUrl}buildBaseUrl(e,t){const s=this.getRecordedBaseUrl(e);const o=e.testConfig.getSerializableObject();const n=this._transformRecordedUrl(s,t,o.isMobile||false);u.debug(`_transformRecordedUrl(${s}, ${t}) returned ${n}`);return n}_transformRecordedUrl(e,t,s=false){const o=["http","https"];if(!t||t===e){if(!s){return n.utils.fixUrl(e,o)}return e}if(!s){t=n.utils.fixUrl(t,o);e=n.utils.fixUrl(e,o)}let a;try{a=new URL(t)}catch(e){throw new Error(`Invalid initialization URL: ${t}`)}const i=(a.pathname||"").split("/").filter(Boolean).length;const r=(a.hash||"").split("/").filter(Boolean).length;const c=(a.search||a.query||"").split("&").filter(Boolean).length;if(i>0||r>0||c>0){return t}let l;try{l=new URL(e)}catch(t){throw new Error(`Invalid initialization URL: ${e}`)}l.host=a.host;if(!a.port){if(a.protocol==="https:"){l.port="443"}else if(a.protocol==="http:"){l.port="80"}else{l.port=null}}else{l.port=a.port}l.protocol=a.protocol;l.username=a.username;l.password=a.password;return l.toString()}async prepareHooks(e,t){const s=Object.entries(e||{}).filter((([,e])=>Boolean(e)));const o={};for(const[e,{infoId:n,condition:a}]of s){try{const s=await t.loadSharedStepClass(n);const i=r.stepBuilder.buildStepFromData({type:"scenario",name:"hook scenario",steps:[{type:"shared-step-instance",sharedStepInfoId:n,name:s.name,classType:s.type}]});const c=this.buildStepPlayer(t,i);const l=await c.serialize();o[e]={playback:l,condition:a}}catch(e){o.warn=true}}return o}async prepareMockNetwork(e,t,s){var o;const{mockNetworkRules:n=[],disableMockNetwork:a=false}=e||{};if(a){return{ruleList:[],error:""}}const i={ruleList:[...n],error:""};const r=(t===null||t===void 0?void 0:t.mockNetworkOptions)||{};if(r.isEnabledForPlayback!==true){return i}const c=async(e,t)=>{if(!e){return undefined}try{const t=await s.storage.downloadJSONFile(e);if(typeof t==="string"){return JSON.parse(t)}return t}catch(s){u.error("failed to prepare mock network rules",{type:t,location:e,mockNetworkOptions:r,error:s});throw s}};try{const[e,t]=await Promise.all([c(r.harFileLocationForPlayback,"har"),c(r.customMappingFileLocation,"map")]);if(t===null||t===void 0?void 0:t.entries){i.ruleList=[...i.ruleList,...t.entries]}if((o=e===null||e===void 0?void 0:e.log)===null||o===void 0?void 0:o.entries){e.log.entries.forEach((e=>{e.maxHits=1}));i.ruleList=[...i.ruleList,...e.log.entries]}return i}catch(e){i.error=`failed to prepare mock network rules: ${e.message}`;return i}}buildTestConfig(e,t){return{...e.testConfig.getSerializableObject(),baseUrl:this.buildBaseUrl(e,t),networkCaptureOptions:e.scenario.networkCaptureOptions,sfdcOptions:e.scenario.sfdcOptions}}buildCustomTestData(e){try{const t=(e===null||e===void 0?void 0:e.code)&&e.enable?new Function(e.code).apply():{};return t&&Array.isArray(t)&&t.length>0?t[0]:t}catch(e){u.error("failed to build custom test data",{err:e});return{}}}async buildPlaybackTreeForTest({sharedStepService:e,testimServices:t,test:s,instancePath:o,baseUrl:n,runParamsOverride:a,branch:r,mockNetworkRunOptions:c,codeCoverageUrlFilter:l,endPath:u,incognito:d=false,remoteRunId:p}){const[m,f,h]=await Promise.all([(0,i.buildCurrentRevisionStatus)(e,s),this.prepareHooks(s.testConfig.hooks,e),this.prepareMockNetwork(c,s.scenario,t)]);const g=this.buildStepPlayer(e,s.scenario,o,u);return{player:g,testId:s.id,testName:s.name,resultId:s.resultId,scenarioId:s.scenario.id,labels:s.labels,config:this.buildTestConfig(s,n),customTestData:a||this.buildCustomTestData(s.customTestData),hooks:f,revisions:m.revisions,revisionStatus:m.revisionStatus,currentBranch:r,remoteRunId:p,baseUrl:this.buildBaseUrl(s,n),recordedBaseUrl:this.getRecordedBaseUrl(s),mockNetworkData:h,codeCoverageUrlFilter:l,incognito:d,nativeApp:s.scenario.nativeApp||undefined}}buildStepPlayerFromData(e){const t=a.STEP_TO_PLAYBACK_MAPPING[e.type]||c.StepPlayback;const s=r.stepBuilder.buildStepFromData(e.stepData);const o=new t(s,e.path,this);o.buildFromData(e);return o}buildHookPlayerFromData(e,t){const s=this.buildStepPlayerFromData(e);s.isHookPlayer=true;s.hookType=t;s.iteration=null;s.iterationId=null;return s}async serializePlaybackTree(e,t){const s=await e.player.serialize();return{playerData:s,testId:e.testId,testName:e.testName,resultId:e.resultId,scenarioId:e.scenarioId,labels:e.labels,config:e.config,hooks:e.hooks,customTestData:e.customTestData,revisions:e.revisions,revisionStatus:e.revisionStatus,isDirty:e.isDirty,currentBranch:e.currentBranch,firstStepIncomingParams:t,baseUrl:e.baseUrl,recordedBaseUrl:e.recordedBaseUrl,incognito:e.incognito,mockNetworkData:e.mockNetworkData,nativeApp:e.nativeApp}}*buildFlatPlaybackTree(e){if(e.stepData.type==="shared-step-instance"){for(const t of e.innerSteps){yield*this.buildFlatPlaybackTree(t)}return}if(e.steps&&e.steps.length>0){if(e.stepData.type!=="scenario"){yield e}for(const t of e.steps){yield*this.buildFlatPlaybackTree(t)}return}yield e}deserializePlaybackTree(e,{isSuggestionPlayback:t=false}={}){return{flatPlaybackTree:t?[...this.buildFlatPlaybackTree(e.playerData)]:undefined,player:this.buildStepPlayerFromData(e.playerData),isSuggestionPlayback:t,testId:e.testId,testName:e.testName,resultId:e.resultId,scenarioId:e.scenarioId,labels:e.labels,config:e.config,hooks:e.hooks,customTestData:e.customTestData,revisions:e.revisions,revisionStatus:e.revisionStatus,isDirty:e.isDirty,currentBranch:e.currentBranch,firstStepIncomingParams:e.firstStepIncomingParams,baseUrl:e.baseUrl,recordedBaseUrl:e.recordedBaseUrl,incognito:!!e.incognito,mockNetworkData:e.mockNetworkData,nativeApp:e.nativeApp}}}t.playbackTreeBuilder=new d},818:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.StepPlayback=t.MissingLabFeaturesError=void 0;const o=s(6);const n=s(831);const a=s(5);const i=s(997);const r=s(998);const c=s(8);const l=s(59);const u=s(855);const d=s(7);const p=c.Logger.getLogger("stepPlayback");class m extends Error{}t.MissingLabFeaturesError=m;class f{constructor(e,t,s){this.playbackTreeBuilder=s;this.path=t;this.step=e;this.shouldNotifyResult=true;this.startTimestamp=null;this.isAborted=false;this.isHookPlayer=false;this.hookType=null;this.abortController=new AbortController}get id(){return this.step.id}get stepType(){var e;return((e=this.step)===null||e===void 0?void 0:e.type)||"no step"}init(){this.innerSteps=Promise.resolve([])}getAllInnerSteps(){return Promise.resolve([this.step])}setStartTimestamp(){this.startTimestamp||(this.startTimestamp=Date.now())}resetStartTimestamp(){this.startTimestamp=null}resetRetryIndex(){this.retryIndex=null}getStepResultId(){this.stepResultId||(this.stepResultId=d.utils.guid());return this.stepResultId}setNewStepResultId(){this.stepResultId=d.utils.guid()}getStepResultPath(){if(this.stepResultPath){return this.stepResultPath}return this.generateStepResultPath()}generateStepResultPath(){if(!this.parentStep){return[]}const e=this.parentStep.getStepResultPath();this.stepResultPath=[...e,this.parentStep.getStepResultId()];return this.stepResultPath}shouldContinueRunning(e){if(e.isStopped){return false}const t=typeof e.stopOnError==="boolean"?e.stopOnError:true;const s=!!e.treatAsWarning;const o=e.success===true||e.success==="partial"||e.success==="skipped";const n=!t||s;return o||n}getResultsHandler(){return this.context.playback.resultsHandler}assignCustomMouseOffsetIfExists(){const e=(0,r.extractMouseOffsetOverrideFromStep)(this);if(!e){return}this.step.element.clickOffset=e}getFrameLocators(){var e;const t=(e=this.step.element)===null||e===void 0?void 0:e.frameLocators;const s=this.step.frameLocators||t||[];return s.map((e=>l.stepBuilder.buildStepFromData(e)))}buildStepPlayer(e,t){return this.playbackTreeBuilder.buildStepPlayer(e,t)}initParamsBuilder(){this.paramsBuilder=new u.StepParamsBuilder(this.step,this.context,this.exportsGlobal,this.exportsTest)}cleanStepSpecificParams(e){return e}getStepSpecificParams(){return{}}buildIncomingParameters(){this.context.incomingParams=this.paramsBuilder.getStepInputs(this.getStepSpecificParams());this.paramsMetadataManager.mergeContexts(this.paramsBuilder.exportsGlobal,this.paramsBuilder.exportsTest,this.paramsBuilder.context.data)}getIncomingParams(e){var t;if(this.context.incomingParams&&(e.success||!o.isEmpty(this.context.incomingParams.final))){return this.context.incomingParams.final}return((t=this.paramsBuilder)===null||t===void 0?void 0:t.getStepInputs(this.getStepSpecificParams()).final)||{}}getParamsForResult(e){var t;let s;if(this.paramsMetadataManager){s=o.cloneDeep(this.paramsMetadataManager.metadata)}else{p.error(`No ParamsMetadataManager found in stepPlayback object for step ${this.step.id}`)}let n;if(e.nodePackageNames){n=e.nodePackageNames}else if((t=this.context.incomingParams)===null||t===void 0?void 0:t.nodePackageNames){n=this.context.incomingParams.nodePackageNames}let a;if(e.success){a=u.StepParamsBuilder.getStepOutputs(e)}return{incomingParams:this.cleanStepSpecificParams(this.getIncomingParams(e)),incomingParamsMetadata:s,nodePackageNames:n,outgoingParams:a}}async onBeforeExecute(){this.buildIncomingParameters();this.assignCustomMouseOffsetIfExists()}reportExecuteResultWithExport(e,t,s){const{exportsGlobal:o,exportsTest:n}=this;const{exportScopes:i}=a.commonConstants;const r={success:true};switch(s){case i.GLOBAL:o[e]=t;r.exportsGlobal={[e]:t};break;case i.TEST:n[e]=t;r.exportsTest={[e]:t};break;case i.LOCAL:r.data={exports:{[e]:t}};break;default:throw new Error(`Unexpected exportScope type '${s}'`)}return r}async onExecuteResult(e){const t=n.playbackLogger.getLogger(this.context.loggerKey);if(!e.success&&!e.errorType){t.warn("Playback failed, but no error type reported in result",{stepType:this.stepType,stepId:this.step.id,result:e})}return{...e,resultInfo:{id:this.step.id,recordLocation:this.step.location,runLocation:this.context.runLocation||{},runTabInfo:this.context.runTabInfo,...e.resultInfo},...!e.success&&{success:false,reason:e.reason||this.getResultsHandler().getFailureString(e.errorType,e.resultInfo)||"execute action failed",id:this.step.id,shouldRetry:e.shouldRetry===undefined?true:e.shouldRetry}}}async execute(e){try{const t=await this.context.executeOnTarget(this.step,e,this.retryIndex,this.exportsGlobal,this.exportsTest,this.getStepResultId(),this.abortController.signal,this.context.isDebuggingCodeStep);return await this.onExecuteResult(t)}catch(e){throw this.getResultsHandler().getBgExceptionFailureObject(e)}}getCondition(){return Promise.resolve(this.step.getStepCondition())}getWhileLoop(){return Promise.resolve(this.step.getStepWhileLoop())}clearStepCache(){}loadElementLocators(){if(!this.cachedElementLocators){this.cachedElementLocators=this.getElementLocators()}return this.cachedElementLocators}getElementLocators(){return this.step.getElementLocators()}abort(){this.abortController.abort();this.buildIncomingParameters();this.isAborted=true}onResult(e){var t;const s=n.playbackLogger.getLogger(this.context.loggerKey);const{COMPLETED:o}=a.commonConstants.stepStatus;const r=this.step;if(!e){s.error("onResult: Missing result for step",{stepType:r.type,stepId:r.id,stepResult:e});e={success:false,reason:"Error: step failed to run"}}if(!e.success){e.reason||(e.reason=this.getResultsHandler().getFailureString(e.errorType,e.resultInfo)||"Step failed")}if(e.success&&this.accumulatedResult){e.reason=this.accumulatedResult.reason||e.reason}if(this.isHookPlayer){e.isHookResult=true;e.hookType=this.hookType}e.startTimestamp=this.startTimestamp||Date.now();e.endTimestamp=Date.now();e.totalRunTime=e.endTimestamp-e.startTimestamp;e.status||(e.status=o);e.treatAsWarning=!!r.treatAsWarning;e.stopOnError=!!r.stopOnError;if(e.forceTreatAsWarning){e.treatAsWarning=true}e.iterationId=this.iterationId;e.iteration=this.iteration;e.path=this.context.path;e.type=r.type;e.stepResultId=this.getStepResultId();e.id=r.id;if(e.errorType&&e.reason){s.logAnalytics("single step error",{errorType:e.errorType,failureReason:e.reason,stepType:r.type,stepId:r.id,projectId:this.context.playback._projectId,testId:this.context.playback._testId,resultId:this.context.resultId,failureSubReason:(t=e.resultInfo)===null||t===void 0?void 0:t.invisibleReason})}const c=u.StepParamsBuilder.getInvalidParameters(e);if(c.length){e.success=false;e.reason=`Invalid ${d.utils.pluralize(c.length,"parameter")} exported: ${c.join(", ")}`;e.shouldRetry=false;e.errorType=a.commonConstants.stepResult.JS_INVALID_PARAMETER}Object.assign(e,this.getParamsForResult(e));e.mostDiscrepantDocumentLengthComparison=i.DocumentLengthComparison.mostSignificantDiscrepancy(this.context.locateResult,this.getElementLocators());if(this.shouldNotifyResult){this.context.supplementResult(e,r);this.context.notifyResult(e,r)}e.shouldContinueRunning||(e.shouldContinueRunning=this.shouldContinueRunning(e));if(e.isStopped){e.shouldContinueRunning=false}this.context.deleteStepData();return Promise.resolve(e)}isNativeEvent(){return this.step.nativeEvents||this.context.stepActionFactory.isForceNative(this.step.type,this.context)}shouldAttachDebugger(){return this.step.hasNativeEventsOption()&&this.isNativeEvent()}isLabFeatureAvailable(e){const t=this.context.labFeaturesService;if(!t){throw new m}return t.isFeatureAvailableForProject(e)}async serialize(){var e;const t=await this.innerSteps;const[s,o]=await Promise.all([Promise.all(t.map((e=>e.serialize()))),Promise.all((this.steps||[]).map((e=>e.serialize())))]);return{type:this.step.type,path:(e=this.path)===null||e===void 0?void 0:e.map((e=>e.id)),stepData:this.step.getSerializableObject(),shouldNotifyResult:this.shouldNotifyResult,innerSteps:s,steps:o}}buildFromData(e){this.path=e.path;this.shouldNotifyResult=e.shouldNotifyResult;this.innerSteps=Promise.resolve(e.innerSteps).then((e=>e.map((e=>this.playbackTreeBuilder.buildStepPlayerFromData(e)))));this.steps=(e.steps||[]).map((e=>this.playbackTreeBuilder.buildStepPlayerFromData(e)))}get testimServicesApi(){return this.context.stepActionFactory.stepActionUtils.testimServicesApi}}t.StepPlayback=f},823:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.calculateStepParam=t.computeExpressionPromise=t.computeExpression=void 0;const o=s(6);const n=s(935);const a=s(855);const i=s(177);const r=s(936);function c(e,t,s,c){try{let r=t.incomingParams||{};if(o.isEmpty(r)){r=a.StepParamsBuilder.getStepInputs(e,t,s,c)}const l=e.subType===i.expressionSubType.TEXT?`'${e.expression.replace(/'/g,"\\'")}'`:e.expression;const u=(0,n.executeExpression)(t,r,l);return{evaluatedText:u,success:true,data:t.data}}catch(e){if(e===null||e===void 0?void 0:e.reason){throw e}throw new r.EvaluateExpressionError(e.toString())}}t.computeExpression=c;function l(e,t,s,o){return new Promise((n=>{n(c(e,t,s,o))}))}t.computeExpressionPromise=l;async function u(e,t,s,o){const n=await l(e,t,s,o);const a=t.getStepParamsContainer();a[e.targetName]=n.evaluatedText;a[e.targetId]=n.evaluatedText;t.internalParams.add(e.targetId);return n}t.calculateStepParam=u},831:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.playbackLogger=void 0;const o=s(8);class n{constructor(){this.loggers=new Map}addLogger(e,t={}){const s=o.Logger.getLogger("playback-logger");s.setInfo(t);this.loggers.set(e,s)}getLogger(e="default"){if(!this.loggers.has(e)){this.addLogger(e)}return this.loggers.get(e)}}t.playbackLogger=new n},849:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.JSStepPlayback=void 0;const o=s(823);const n=s(5);const a=s(850);const i=s(7);class r extends a.ParameterStepPlayback{abort(e){super.abort(e);this.context.stepActionFactory.abortStep(e)}clearStepCache(){const e=this.context.data||{};const t=this.context.stepParameters||{};this.step.parameterValues.forEach((s=>{delete e[s.targetId];delete t[s.targetId]}))}evaluateParams(){const e=this.step.parameterValues.filter((e=>e.type==="locate")).filter((e=>!Object.keys(this.context.data).includes(e.targetId)));const t=this.step.parameterValues.filter((e=>e.type==="evaluate-expression")).filter((e=>!Object.keys(this.context.getStepParamsContainer()).includes(e.targetId)));const s=Promise.all(t.map((e=>(0,o.calculateStepParam)(e,this.context,this.exportsGlobal,this.exportsTest))));const n=new this.locateElementPlayer(this.context);const a=n.findElements({locatorSteps:e,retryIndex:this.retryIndex,step:this.step,frameHandler:this.context.frameHandler,dynamicParent:this.context.dynamicParent,allowScrollSearch:true});return Promise.all([s,a])}async onBeforeExecute(e){await this.evaluateParams();await super.onBeforeExecute(e);const t=e=>{throw{success:false,shouldRetry:false,errorType:n.commonConstants.stepResult.JS_INVALID_PARAMETER,resultInfo:{reason:`${e} and cannot be used as a parameter`}}};const s=this.context.incomingParams.as.functionParameters;const o=s.find((e=>i.utils.jsVarNameValidator.hasInvalidFirstLetter(e)));if(o){t(`"${o}" starts with an invalid character`)}const a=s.find((e=>i.utils.jsVarNameValidator.isReservedWord(e)));if(a){t(`"${a}" is a JS reserved word`)}}}t.JSStepPlayback=r},850:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ParameterStepPlayback=void 0;const o=s(818);class n extends o.StepPlayback{getFrameLocators(){return this.step.getFrameLocators()}}t.ParameterStepPlayback=n},855:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.StepParamsBuilder=void 0;const o=s(6);const n=s(7);const a=s(52);const i=s(5);const r="Captured HTML Element";class c{constructor(){this.locators={}}static isLocator(e){return Boolean(e===null||e===void 0?void 0:e.locatedElement)}save(e){this.locators[e.locatedElement.testimId]=e}get(e){return this.locators[e.testimId]}getElementSymbol(e){const t=this.locators[e.testimId];return t===null||t===void 0?void 0:t.elementSymbol}}class l{constructor(e,t,s,o){this.step=e;this.context=t;this.exportsGlobal=s;this.exportsTest=o}static getNodePackageParameters(e,t){return(e.parameterNames||[]).map((s=>{const o=e.parameterValues.find((e=>e.targetId===s.parameterId));if(!o){return undefined}if(o.type==="node-package"){return{name:s.displayName,packageData:t[s.parameterId]}}return undefined})).filter(Boolean)}static getStepParameters(e,t,s){return(e.parameterNames||[]).map((o=>{const n=e.parameterValues.find((e=>e.targetId===o.parameterId));if(n&&n.type==="node-package"){return undefined}const i={name:o.displayName};if(!n){i.value=null}else if(n.type==="locate"&&!!s[o.parameterId]){i.locatedElement=s[o.parameterId].locatedElement;i.selector=a.locatorBuilderUtils.getSelector(s[o.parameterId].testimSessionId)}else if(n.type==="mobile-locate"&&!!s[o.parameterId]){const e=s[o.parameterId].locatedElement;i.locatedElement=e;i.selector=e.xpath}else{i.value=t[o.displayName]}return i})).filter(Boolean)}static getStepInputs(e,t,s,a,u={}){var d,p,m,f,h,g,y;const b=new c;const v=n.utils.clone(s);const x=n.utils.clone(a);const S=t.data;const E=t.getStepParamsContainer();const T=t.data;const P=l.getStepParameters(e,E,T);const w=l.getNodePackageParameters(e,E);const I={};if([i.commonConstants.test.MOBILE_WEB,i.commonConstants.test.DESKTOP_WEB].includes(t.project.type)){I.BASE_URL=t.config.baseUrl}if([i.commonConstants.test.ANDROID,i.commonConstants.test.IOS].includes(t.project.type)){const{capabilities:e,appInfo:s}=t.appiumSessionData||{};const{nativeApp:o}=t.config;const{device:n}=t;const a=e&&("deviceModel"in e?e.deviceModel:e["appium:deviceModel"])||(n===null||n===void 0?void 0:n.model);const i=e&&("platformVersion"in e?e.platformVersion:e["appium:platformVersion"])||(n===null||n===void 0?void 0:n.osVersion);I.DEVICE={...e&&{apiVersion:"deviceApiLevel"in e?e.deviceApiLevel:e["appium:deviceApiLevel"]},model:a,osVersion:i,virtual:(d=n===null||n===void 0?void 0:n.isVirtual)!==null&&d!==void 0?d:false,minApiVersion:n===null||n===void 0?void 0:n.minApiVersion};I.APP={name:(s===null||s===void 0?void 0:s.name)||((o===null||o===void 0?void 0:o.name)||((p=o===null||o===void 0?void 0:o.appMetadata)===null||p===void 0?void 0:p.name)),version:(s===null||s===void 0?void 0:s.version)||((o&&"version"in o?o.version:undefined)||((m=o===null||o===void 0?void 0:o.appMetadata)===null||m===void 0?void 0:m.version)),minOsVersion:o&&"appMetadata"in o?(f=o.appMetadata)===null||f===void 0?void 0:f.minOsVersion:undefined,identifiers:e&&{appActivity:"appActivity"in e?e.appActivity:e["appium:appActivity"],appPackage:"appPackage"in e?e.appPackage:e["appium:appPackage"],bundleId:"bundleId"in e?e.bundleId:e["appium:bundleId"]}}}if((y=(g=(h=t.company)===null||h===void 0?void 0:h.activePlan)===null||g===void 0?void 0:g.premiumFeatures)===null||y===void 0?void 0:y.exportLabelsAtTestRuntime){I.TEST_LABELS=t.labels}const A=Object.keys(S).filter((e=>!c.isLocator(S[e]))).filter(n.utils.isValidParamName).reduce(((e,t)=>{e[t]=S[t];return e}),{});const R=Array.from(t.internalParams||[]).reduce(((e,t)=>{delete e[t];return e}),o.clone(A));Object.keys(S).forEach((e=>{if(c.isLocator(S[e])){b.save(S[e])}}));function L(e,s=true){return Object.assign({},s?I:{},t.customTestData,t.userParamsData,v,x,R,P.filter((e=>!e.packageData)).reduce(((t,s)=>{if(s.locatedElement){t[s.name]=e(s);return t}t[s.name]=s.value;return t}),{}),u)}const O=L((({locatedElement:e,selector:t})=>Object.assign(b.get(e)||{},{locatedElement:e,selector:t})));const k=w.map((e=>Object.assign({},e===null||e===void 0?void 0:e.packageData,{paramName:e===null||e===void 0?void 0:e.name}))).filter(Boolean);const D=k.reduce(((e,t)=>{e[t.paramName]=t.testimPackageFullName;return e}),{});const _=P.some((e=>!e.packageData));const M={functionParameters:Object.keys(O),functionArguments:Object.keys(O).map((e=>O[e]))};const C=L((({locatedElement:e})=>b.getElementSymbol(e)||r),false);const N=L((({locatedElement:e})=>b.getElementSymbol(e)||r));return{as:M,final:C,finalWithHardwiredParams:N,nodePackageParams:k,nodePackageNames:D,hasStepSpecificParams:_||Object.keys(u).length>0}}static getStepOutputs(e){var t;return{local:((t=e===null||e===void 0?void 0:e.data)===null||t===void 0?void 0:t.exports)||{},test:(e===null||e===void 0?void 0:e.exportsTest)||{},global:(e===null||e===void 0?void 0:e.exportsGlobal)||{}}}static getInvalidParameters(e){const t=l.getStepOutputs(e);return Object.keys({...t.local,...t.test,...t.global}).filter((e=>!n.utils.isValidJavaScriptIdentifier(e)))}getStepParameters(){const e=this.context.getStepParamsContainer();return l.getStepParameters(this.step,e,this.context.data)}getStepInputs(e){return l.getStepInputs(this.step,this.context,this.exportsGlobal,this.exportsTest,e)}}t.StepParamsBuilder=l},865:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getLocatedElementCode=t.getLocatedElement=t.buildLocatedElementCode=t.buildLocatedElement=void 0;const o=s(287);const n=s(52);const a=s(5);const{TESTIM_ID_FIELD_NAME:i}=a.locators;const{getElementsPath:r,isShadowRoot:c,getSelector:l,getCSSSelector:u}=n.locatorBuilderUtils;const d=e=>n.locatorBuilderUtils.getTestimId(e);const p=(e=i,t=o.ShadowRootSelector.elementIsShadowRoot,s=r,n=l,a=d,p=c,m=u)=>e=>{const o=(e,t,s)=>s.indexOf(e)===t;let i=e.element;if(i&&i.tagName==="HTML"){i=i.ownerDocument.body}const r=a(i);const c=s(i.ownerDocument,i,p);const l=c.filter(t).map(a).concat(r).filter(o);let u;try{const e=m(i);u=c.filter(t).map(m).concat(e).filter(o)}catch(e){}return{shadowPath:l.map(n),testimId:r,shadowPathSelectors:u}};t.buildLocatedElement=p();t.buildLocatedElementCode=`(function() {\n    var TESTIM_ID_FIELD_NAME = ${JSON.stringify(i)};\n    var getSelector = function(id) { return "[" + TESTIM_ID_FIELD_NAME + "='" + id + "']" };\n    var buildLocatedElement = ${p.toString()};\n    var isShadowRoot = ${c.toString()};\n    var getElementsPath = function(from, to) { return ${r.toString()}(from, to, isShadowRoot) };\n    var elementIsShadowRoot = function (element) { return Boolean(element.shadowRoot) };\n    var getTestimId = function (element) { return element.getAttribute(TESTIM_ID_FIELD_NAME) };\n    var getCSSSelector = ${u.toString()};\n    return buildLocatedElement(TESTIM_ID_FIELD_NAME, elementIsShadowRoot, getElementsPath, getSelector, getTestimId, isShadowRoot, getCSSSelector);\n})();`;const m=(e=(0,n.shimSafeQuerySelector)(),t=i)=>function(s){let o;const n=typeof navigator!=="undefined"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(typeof s==="string"&&s.includes(t)){o=[s]}else if(typeof s==="string"){o=[`[${t}='${s}']`]}else{o=(s===null||s===void 0?void 0:s.shadowPath)||[]}const a=typeof s==="string"?[]:(s===null||s===void 0?void 0:s.shadowPathSelectors)||[];let i=document;let r;o.forEach(((t,s)=>{var o;r=i&&(i.shadowRoot||((o=i.getRootNode)===null||o===void 0?void 0:o.call(i)));const n=s===0?`body ${t}, body${t}`:t;const c=i;i=r&&e.querySelector(r,n)||c&&e.querySelector(c,n);if(!i&&s===0){i=r&&e.querySelector(r,t)||c&&e.querySelector(c,t)}if(!i&&a[s]){i=r&&e.querySelector(r,a[s])||c&&e.querySelector(c,a[s])}}));if(n&&i&&!(i instanceof Node)){const e=i.ownerSVGElement!==undefined?document.createElementNS("http://www.w3.org/2000/svg",i.tagName):document.createElement(i.tagName);Object.setPrototypeOf(i,e)}return i};t.getLocatedElement=m();t.getLocatedElementCode=`(function() {\n    var shimSafeQuerySelector = ${n.shimSafeQuerySelector.toString()};\n    var TESTIM_ID_FIELD_NAME = ${JSON.stringify(i)};\n    var getLocatedElement = ${m.toString()};\n    return getLocatedElement(shimSafeQuerySelector(), TESTIM_ID_FIELD_NAME);\n})();`},872:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:true});t.cropImageIntoPieces=t.measureSync=t.measureAsync=t.AlgoUtils=void 0;var o;(function(e){e.getDebugMode=()=>typeof localStorage!=="undefined"&&localStorage.getItem("algo_logs")==="verbose";e.Logging={log(...t){if(e.getDebugMode()){console.log(...t)}else{}},warn(...t){if(e.getDebugMode()){console.warn(...t)}else{}},error(...t){if(e.getDebugMode()){console.error(...t)}else{}}};class t{constructor(e="",t=0){this.logCounter=0;this.identifier=t;this.prefixLog=e}log(t){this.logCounter++;const s=`${this.prefixLog}${this.identifier.toString()}`;e.Logging.log(s,this.logCounter,t)}setIdentifier(e){this.identifier=e}}e.IncrementLogger=t;function s(t,...s){const o=performance.now();const n=t(...s);const a=performance.now();e.Logging.log(`${t.name}: time - ${(a-o).toFixed(2)} milliseconds`);return n}e.logFunctionExecutionTime=s;async function o(t,...s){const o=performance.now();const n=await t(...s);const a=performance.now();e.Logging.log(`${t.name}: time - ${(a-o).toFixed(2)} milliseconds`);return n}e.logAsyncFunctionExecutionTime=o})(o||(t.AlgoUtils=o={}));const n=(e,t,s)=>{const n=s.value;s.value=async function(...e){const s=performance.now();const a=await n.apply(this,e);const i=performance.now();o.Logging.log(`${t}: time - ${(i-s).toFixed(2)} milliseconds`);return a};return s};t.measureAsync=n;const a=(e,t,s)=>{const n=s.value;s.value=function(...e){const s=performance.now();const a=n.apply(this,e);const i=performance.now();o.Logging.log(`${t}: time - ${(i-s).toFixed(2)} milliseconds`);return a};return s};t.measureSync=a;async function i(t,n){const a=s(1122);if(!(n===null||n===void 0?void 0:n.length)){o.Logging.warn("No candidate list areas in cropImageIntoPieces");return[]}o.Logging.log(`Number of image areas to crop: ${n.length}`);const i=e.from(t,"base64");const r=await a.default.read(i);let c=[];const l=n.map((async e=>{try{const t=await r.clone().crop(e.left,e.top,e.width,e.height);const s=await t.getBufferAsync(a.default.AUTO);const o=s.toString("base64");return o}catch(e){o.Logging.warn("Error while cropping image: ",e);return null}}));c=(await Promise.all(l)).filter((e=>e!==null));o.Logging.log(`Number of image cropped candidates: ${c.length}`);return c}t.cropImageIntoPieces=i}).call(this,s(63).Buffer)},879:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.NoElementStepPlayback=void 0;const o=s(818);class n extends o.StepPlayback{getFrameLocators(){return[]}getElementLocators(){return[]}}t.NoElementStepPlayback=n},935:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.executeExpression=void 0;const o=s(7);const n=s(5);function a(e,t,s){const a=["context"].concat(t.as.functionParameters);const i=a.find((e=>(e===null||e===void 0?void 0:e.trim)&&!o.utils.isValidJavaScriptIdentifier(e.trim())));if(i){const e=`Invalid parameter name detected: "${i}", parameter names must be valid JavaScript identifiers`;throw Object.assign(new TypeError,{success:false,errorType:n.commonConstants.stepResult.EVALUATE_EXPRESSION_EXCEPTION,reason:e,shouldRetry:false,resultInfo:{exception:e}})}const r=`return ${s}`.replace(/\n/g,"\\n");const c=Function.apply(Function,a.concat([r]));const l=[e].concat(t.as.functionArguments);return c(...l)}t.executeExpression=a},936:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MissingFramesError=t.StopConditionError=t.EvaluateExpressionError=t.HookFailedError=t.WhileConditionMaxIterationsExceededError=t.WhileConditionDoneError=t.ConditionParsingError=t.ConditionFailedError=void 0;class o extends Error{constructor(e){super();if(e){this.reason=e}Object.setPrototypeOf(this,o.prototype)}}t.ConditionFailedError=o;class n extends Error{constructor(e){super();this.shouldRetry=false;if(e){this.reason=e}Object.setPrototypeOf(this,n.prototype)}}t.ConditionParsingError=n;class a extends Error{constructor(){super();Object.setPrototypeOf(this,a.prototype)}}t.WhileConditionDoneError=a;class i extends Error{constructor(){super();Object.setPrototypeOf(this,i.prototype)}}t.WhileConditionMaxIterationsExceededError=i;class r extends Error{constructor(e){super();Object.setPrototypeOf(this,r.prototype);this.hookResult=e;this.message=e.reason}}t.HookFailedError=r;class c extends Error{constructor(e){super();this.reason=e}}t.EvaluateExpressionError=c;class l extends Error{constructor(e){super();this.conditionResult=e;Object.setPrototypeOf(this,l.prototype)}}t.StopConditionError=l;class u extends Error{constructor(e){super(e);Object.setPrototypeOf(this,u.prototype)}}t.MissingFramesError=u},937:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.extractRegex=t.extractNumber=t.extractDate=t.extractText=void 0;const o=s(1024);const n=s(827);function a(e,t,s){if(e==="all"){return t.map(s)}const o=e==="first"?0:t.length-1;return t.length===0?null:s(t[o])}function i(e,t=false){if(!e||!t){return e}if(typeof e==="string"){return e.trim()}if(Array.isArray(e)){return e.map((e=>{if(typeof e==="string"){return e.trim()}return e}))}return e}function r(e,t){const{setting:s,trimSpaces:o}=t;switch(t.mode){case"date":{return c(e,s,o)}case"number":{return l(e,s,o)}case"regex":{return u(e,s,t.regex,o)}case"entireString":default:{return i(e,o)}}}t.extractText=r;function c(e,t,s=false){const o=n.parse(e);return i(a(t,o,(e=>e.text.trim())),s)}t.extractDate=c;function l(e,t,s=false){const n=e.replace(/[^\d.,]+/g," ").replace(/[,.][,.]+/g," ").replace(/[,.]( |$)+/g," ").replace(/(^|(\D))+,+(?=\d)/g," ").trim().replace(/  +/g," ").split(" ");const r=n.map((e=>({val:e,format:o.unformat(e)}))).filter((e=>e.format!==undefined));return i(a(t,r,(e=>e.val)),s)}t.extractNumber=l;function u(e,t,s,o=false){const n=e.match(s)||[];return i(a(t,n,(e=>e)),o)}t.extractRegex=u},941:function(e,t,s){"use strict";var o=this&&this.__decorate||function(e,t,s,o){var n=arguments.length,a=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,s):o,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;r>=0;r--)if(i=e[r])a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a;return n>3&&a&&Object.defineProperty(t,s,a),a};var n=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var a,i,r,c,l,u,d,p,m,f,h;Object.defineProperty(t,"__esModule",{value:true});t.getElementRectAttributes=t.getLocatedElementText=t.MobileLocateElementPlayer=void 0;const g=s(12);const y=s(176);const b=s(53);const v=s(281);const x=s(7);const S=s(5);const E=s(1121);const T=s(872);const P=s(942);const w=s(943);const I=s(944);const A=s(945);const R=s(946);const L=s(277);const{guid:O}=b.injectorUtils;const k=5;const D=500;const _={success:false,reason:"default fail message."};const M={height:200,limitCountForLocateSearch:4,direction:"down",afterSwipeWaitTime:1500,minIterationForScrollSearch:4,marginFromTopAndBottom:500};class C{constructor(e){this.context=e;this._allowedScrollUpLength=0}saveDom({domToSave:e,generatedUniqueId:t}){if(!g.default.flags.saveMobilePlaybackDataToS3.isEnabled()||e==="")return;const s="application/xml";const o=`${t}_DOM`;const n=this.context.servicesApi.storage.getStorageRelativePath(`Playback/${o}`,v.TEST_RESULT_ARTIFACTS_BUCKET,this.context.projectId);this.context.servicesApi.storage.uploadProjectArtifact(n,o,e,s)}saveFoundElementMobileLocator(e,t){if(!g.default.flags.saveMobilePlaybackDataToS3.isEnabled()||!e)return;const s=`${t}_ML`;const o=this.context.servicesApi.storage.getStorageRelativePath(`Playback/${s}`,v.TEST_RESULT_ARTIFACTS_BUCKET,this.context.projectId);this.context.servicesApi.storage.uploadProjectJsonArtifact(o,s,e)}async _verticalScrollOnceInDirection(e,t,s,o,n=0){o===null||o===void 0?void 0:o.log(`Performing search swipe in direction ${e}`);const a=M.marginFromTopAndBottom;if(e==="up"){t=Math.min(t,this._allowedScrollUpLength+2*a);this._allowedScrollUpLength-=t}if(t<=a)return;const i={x:n,y:e==="up"?a:t-a};const r={x:n,y:e==="up"?t-a:a};try{await this.context.appiumApi.swipe(i,r,M.afterSwipeWaitTime)}catch{o===null||o===void 0?void 0:o.log("Error swiping target.")}}async _scrollToLocateElementByDirection(e,t,s,o,n,a,i){let r={success:false,reason:""};try{if(!n)return r;const c=t>0?t-1:M.height;const l=Math.floor(s/2);const u=e==="down"?"up":"down";const d=this._getTargetId(o);if(n===M.minIterationForScrollSearch){await this._verticalScrollOnceInDirection(u,c,d,a,l);r=await this._locateInViewPort(o,n,i);if(r.success)return r;await this._verticalScrollOnceInDirection(e,c,d,a,l)}else if(n<=M.minIterationForScrollSearch+M.limitCountForLocateSearch){await this._verticalScrollOnceInDirection(e,c,d,a,l);r=await this._locateInViewPort(o,n,i);if(r.success)return r}return r}catch{const e="Error swiping to search element";r.reason+=e;a===null||a===void 0?void 0:a.log(e);return r}}_initAllowedScrollUpLength(){const e=this.context.prevSwipesData;const t=e.map((e=>{const t=(0,R.getSwipeDataVerticalLength)(e);return(0,R.getSwipeDataVerticalDirection)(e)==="down"?t:-t}));this._allowedScrollUpLength=t.reduce(((e,t)=>e+t),0)}async autoScrollSearchToLocateElement(e,t,s,o){this.context.appiumApi.hideKeyboard();this._initAllowedScrollUpLength();const n=this.context.prevSwipesData;let a;if(n.length>0)a=n.at(-1);let i=a?(0,R.getSwipeDataVerticalDirection)(a):M.direction;if(!i)i=M.direction;const{width:r,height:c}=await this.context.deviceDimensions;return this._scrollToLocateElementByDirection(i,c,r,e,t,s,o)}_getTargetId(e){return e.targetId||"targetId"}async locate({locatorStep:e,addVisibilityInfo:t,allowScrollSearch:s,retryIndex:o,incrementLogger:n}){let a=_;let i;if(this.context.appiumApi){i=await(0,I.getDom)(this.context.appiumApi,this.context.project.type);const e=i.documentElement.innerHTML===this.context.prevIterDomHtml;const t=!o||o%k===0;if(!t&&e){await x.utils.delay(D);return _}}const r=!s||!g.default.flags.enableAutoSwipeToLocateElement.isEnabled()||this.context.project.type!=="android";if(r||!o||o<M.minIterationForScrollSearch){a=await this._locateInViewPort(e,o,i)}else{a=await this.autoScrollSearchToLocateElement(e,o,n,i)}if(a.success){this.context.prevSwipesData=[]}if(a.success===false||!t)return a;return await this.addVisibilityInfo(e,this._getTargetId(e),a)}async _locateInViewPort(e,t,s){var o;try{if(!this.context.appiumApi){T.AlgoUtils.Logging.log("Appium Api is undefined. return element not found");return{success:false,reason:"Appium error."}}if(!(e===null||e===void 0?void 0:e.mobileLocator)){T.AlgoUtils.Logging.log("Mobile locator is undefined. return element not found");return{success:false,reason:"element not found."}}const n=new I.MobileLocateElement(this.context.appiumApi,this.context.project.type,this.context.servicesApi,this.context.loggerKey);const{isDomStable:a,stableDOM:i,domForComparison:r}=await T.AlgoUtils.logAsyncFunctionExecutionTime(I.waitForDomToStable,this.context.appiumApi,this.context.project.type,s);this.context.prevIterDomHtml=r===null||r===void 0?void 0:r.documentElement.innerHTML;T.AlgoUtils.Logging.log("Result DOM",i);if(a&&i){T.AlgoUtils.Logging.log("Dom is stable.");n.setStableDOM(i)}else{T.AlgoUtils.Logging.log("Dom is not stable.")}const c=new A.SelectorParamEvaluator(e,this.context);const l=await n.locateElement(e.mobileLocator,this.context.project.id,this.context.testId,e.id,this.context.device,this.context.playback.testResult.resultId,t,c);if(!l)return _;(o=this.context).locateResult||(o.locateResult={});for(const[e,t]of l.selectorsScores){this.context.locateResult[e]={type:"mobile-locate-result",selectorRelativeScore:t}}const u=await this.getFoundElementRectAttributes(a,l,e);l.rect=u;if(g.default.flags.saveMobilePlaybackDataToS3.isEnabled()&&i){this.ExtractAndSavePlaybackData(e.id,u,i,l.domElement)}const d=this._getTargetId(e);this.context.data[d]={locatorId:e.id,testimSessionId:null,locatedElement:l,pixelRatio:u.pixelRatio,rect:u};return{success:true,targetId:d,locatedElement:l}}catch(e){return{success:false,reason:e.message}}}async getFoundElementRectAttributes(e,t,s){var o,n,a,i;let r=0;if(this.context.project.type==="android"){r=1}else if(this.context.project.type==="ios"){r=(n=(o=this.context.device)===null||o===void 0?void 0:o.scaleFactor)!==null&&n!==void 0?n:2}if(r===0){r=((i=(a=s.thumbnailInfo)===null||a===void 0?void 0:a.elementArea)===null||i===void 0?void 0:i.pixelRatio)||1}let c;if(e&&t.domElement){c=(0,L.parseBoundsFromElement)(t.domElement)}else{c=await F(t.elementId,this.context)}return{...c,pixelRatio:r}}ExtractAndSavePlaybackData(e,t,s,o){var n,a,i;const r=((i=(a=(n=this.context)===null||n===void 0?void 0:n.playback)===null||a===void 0?void 0:a.testResult)===null||i===void 0?void 0:i.resultId)||`guid_${O()}`;const c=`locator_${e}_testResult_${r}`;const l=s.innerHTML;this.context.setHtmlString(e,l);this.saveDom({domToSave:l,generatedUniqueId:c});if(o){const e=y.MobileLocatorFactory.createMobileLocatorFromElement(o,undefined);this.saveFoundElementMobileLocator(e,c)}else{this.saveMobileLocatorFromELementId(t,s,c)}}saveMobileLocatorFromELementId(e,t,s){const o=new DOMRect;o.height=e.height;o.width=e.width;o.x=e.left;o.y=e.top;let n;T.AlgoUtils.Logging.log("Searching element with pruning in DOM.");n=(0,w.findElementByBoundsInDOM)({root:t,targetElementBounds:o,projectType:this.context.project.type,pruneByBounds:true});if(!n){T.AlgoUtils.Logging.log("Element not found, searching element without pruning in DOM.");n=(0,w.findElementByBoundsInDOM)({root:t,targetElementBounds:o,projectType:this.context.project.type,pruneByBounds:false})}if(n){const e=y.MobileLocatorFactory.createMobileLocatorFromElement(n,undefined);T.AlgoUtils.Logging.log("Found element mobile locator: ",e);this.saveFoundElementMobileLocator(e,s)}else{T.AlgoUtils.Logging.log("Element not found in DOM.")}}async addVisibilityInfo(e,t,s){if(!s.success){return s}const{rect:o}=this.context.data[t];if((o===null||o===void 0?void 0:o.height)===0||(o===null||o===void 0?void 0:o.width)===0){Object.assign(s,{isVisible:false,invisibleReason:E.visibilityState.ELEMENT_HAS_ZERO_HEIGHT_OR_WIDTH})}if(s.locatedElement.confidenceLevel===P.MobileLocatedElementConfidenceLevel.VeryLow){Object.assign(s,{success:false,invisibleReason:E.visibilityState.GENERIC_ELEMENT_HIDDEN})}if(s.isVisible===false&&e.forceVisibility){Object.assign(s,{success:false})}if(s.success&&s.isVisible!==false){s.isVisible=true}return s}async findElements({locatorSteps:e,retryIndex:t,step:s,addVisibilityInfo:o,allowScrollSearch:n}){if(!e||e.length===0)return{success:true};const a=new T.AlgoUtils.IncrementLogger(`findElements retry #${(t===null||t===void 0?void 0:t.toString())||""}`);try{const i=o||false;const r=await x.utils.promiseMap(e,(async e=>{const s=await this.locate({locatorStep:e,addVisibilityInfo:i,allowScrollSearch:n,retryIndex:t,incrementLogger:a});return this.handleLocateResult(s)}));await this.context.captureScreenshot(s);this.context.setLocateResults(r,this.context.data.htmlStrings);const c=this.context.data[r[0].targetId||"targetId"];if(!c){this.context.logger.warn("Missing target from playback context data");return{success:false}}this.context.setElementRectangle(c.rect,c.pixelRatio);return{success:true}}catch(e){this.context.setLocateResults([e],this.context.data.htmlStrings);throw e}}scrollStepElementIntoView(){}getFailureErrorType(e){if(!e.locatedElement){return{errorType:S.stepResult.ELEMENT_NOT_FOUND,invisibleReason:undefined}}if(!e.isVisible){return{errorType:S.stepResult.ELEMENT_NOT_VISIBLE,invisibleReason:e.invisibleReason}}return{}}async handleLocateResult(e){if(e.success){return e}const{errorType:t,invisibleReason:s}=this.getFailureErrorType(e);throw Object.assign(new Error("Unable to locate mobile element"),{success:false,errorType:t,invisibleReason:s})}}t.MobileLocateElementPlayer=C;o([T.measureAsync,n("design:type",Function),n("design:paramtypes",[typeof(a=typeof R.ScrollDirection!=="undefined"&&R.ScrollDirection)==="function"?a:Object,Number,Number,Object,Object,typeof(i=typeof T.AlgoUtils!=="undefined"&&T.AlgoUtils.IncrementLogger)==="function"?i:Object,typeof(r=typeof Document!=="undefined"&&Document)==="function"?r:Object]),n("design:returntype",typeof(c=typeof Promise!=="undefined"&&Promise)==="function"?c:Object)],C.prototype,"_scrollToLocateElementByDirection",null);o([T.measureAsync,n("design:type",Function),n("design:paramtypes",[Object,Object,typeof(l=typeof T.AlgoUtils!=="undefined"&&T.AlgoUtils.IncrementLogger)==="function"?l:Object,typeof(u=typeof Document!=="undefined"&&Document)==="function"?u:Object]),n("design:returntype",typeof(d=typeof Promise!=="undefined"&&Promise)==="function"?d:Object)],C.prototype,"autoScrollSearchToLocateElement",null);o([T.measureAsync,n("design:type",Function),n("design:paramtypes",[Object,Object,typeof(p=typeof Document!=="undefined"&&Document)==="function"?p:Object]),n("design:returntype",typeof(m=typeof Promise!=="undefined"&&Promise)==="function"?m:Object)],C.prototype,"_locateInViewPort",null);o([T.measureSync,n("design:type",Function),n("design:paramtypes",[String,Object,typeof(f=typeof HTMLElement!=="undefined"&&HTMLElement)==="function"?f:Object,Object]),n("design:returntype",void 0)],C.prototype,"ExtractAndSavePlaybackData",null);async function N(e,t){if(e.domElement){return(0,w.getDomElementText)(e.domElement,t.project.type)}if(e.elementId===""||!t.appiumApi)return"";const s=await t.appiumApi.getElementText(e.elementId);let o="";if(t.project.type===S.commonConstants.test.ANDROID&&g.default.flags.locateMobileElementsUsingContentDesc.isEnabled()){o=await t.appiumApi.getElementAttribute(e.elementId,"content-desc")}return s||o||""}t.getLocatedElementText=N;async function F(e,t){let s;if(t.project.type===S.commonConstants.test.ANDROID){s=await t.appiumApi.getElementAttribute(e,"bounds").catch((()=>undefined))}else if(t.project.type===S.commonConstants.test.IOS){s=await t.appiumApi.getElementAttribute(e,"rect").catch((()=>undefined))}return(0,L.parseBounds)(s)}t.getElementRectAttributes=F},942:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.confidenceLevelToString=t.getMobileLocatedElementConfidenceLevel=t.MobileLocatedElementConfidenceLevel=void 0;var o;(function(e){e[e["NotFound"]=0]="NotFound";e[e["VeryLow"]=.01]="VeryLow";e[e["Low"]=.1]="Low";e[e["Medium"]=.4]="Medium";e[e["High"]=.6]="High";e[e["VeryHigh"]=.8]="VeryHigh";e[e["Strict"]=1]="Strict"})(o||(t.MobileLocatedElementConfidenceLevel=o={}));const n=new Map([[o.NotFound,"not-found"],[o.VeryLow,"very-low"],[o.Low,"low"],[o.Medium,"medium"],[o.High,"high"],[o.VeryHigh,"very-high"],[o.Strict,"strict"]]);function a(e){const t=o.NotFound;const s=o.VeryLow;const n=o.Low;const a=o.Medium;const i=o.High;const r=o.VeryHigh;if(e>=t&&e<s){return o.NotFound}if(e>=s&&e<n){return o.VeryLow}if(e>=n&&e<a){return o.Low}if(e>=a&&e<i){return o.Medium}if(e>=i&&e<r){return o.High}if(e>=r){return o.VeryHigh}return o.NotFound}t.getMobileLocatedElementConfidenceLevel=a;function i(e){const t=n.get(e);return t||"Undefined confidence level."}t.confidenceLevelToString=i},943:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getDomElementText=t.findElementByBoundsInDOM=t.findElementByXPathInDOM=t.extractElementCandidatesInDOM=void 0;const o=s(12);const n=s(5);const a=s(872);const i=s(176);const r=s(277);const c=s(279);function l(e,t,s,o){const n=new Map(c.selectorLocateOrder.map((e=>[e,new Set])));let i=0;e=e.children[0];if(!e)return n;const r=[];r.push({node:e,xpath:g("/",e)});while(r.length>0){const{node:e,xpath:a}=r.pop();y({selectorsCandidates:n,mobileLocator:t,projectType:s,currentNode:e,currentXpath:a,selectorParamEvaluator:o});for(let t=e.children.length-1;t>=0;t--){const s=e.children[t];const o=g(a,s);r.push({node:s,xpath:o})}i++}a.AlgoUtils.Logging.log(`Elements in DOM: ${i}`);return n}t.extractElementCandidatesInDOM=l;function u(e,t){if(!e||t===""){return null}if(e.tagName==="hierarchy"||e.tagName==="AppiumAUT"){e=e.children[0];if(!e)return null}const s=(0,r.getElementTag)(e);let o=false;let n=e;const a=t.split("/");for(let e=0;e<a.length;e++){const t=a[e];const i=t.split("[")[0];if(i===""){continue}if(!o&&i===s){o=true;continue}const r=t.match(/\[(.*)\]/);const c=m(n,i);if(!c.length){return null}if(r){n=c[parseInt(r[1],10)-1]}else{n=c[0]}if(!n){return null}}return n}t.findElementByXPathInDOM=u;function d({root:e,targetElementBounds:t,projectType:s,pruneByBounds:o}){const n=[];n.push(e);let i=0;while(n.length>0){const e=n.pop();const s=(0,r.parseBoundsFromElement)(e);if(s&&f(s,t)){a.AlgoUtils.Logging.log(`expended nodes: ${i}`);return e}if(s&&o&&!h({container:s,contained:t})){continue}for(let t=e.children.length-1;t>=0;t--){n.push(e.children[t])}i++}a.AlgoUtils.Logging.log(`expended nodes: ${i}`);return null}t.findElementByBoundsInDOM=d;function p(e,t){if(t===n.commonConstants.test.ANDROID){if(o.default.flags.locateMobileElementsUsingContentDesc.isEnabled())return e.getAttribute("text")||e.getAttribute("content-desc")||"";return e.getAttribute("text")||""}return e.getAttribute("label")||e.getAttribute("value")||e.getAttribute("text")||""}t.getDomElementText=p;function m(e,t){const s=e.children;const o=[];for(let e=0;e<s.length;e++){const n=s[e];const a=(0,r.getElementTag)(n);if(a===t){o.push(n)}}return o}function f(e,t){const s=7;return Math.abs(e.left-t.left)<s&&Math.abs(e.top-t.top)<s&&Math.abs(e.width-t.width)<s&&Math.abs(e.height-t.height)<s}function h({container:e,contained:t}){return e.left<=t.left&&e.top<=t.top&&e.left+e.width>=t.left+t.width&&e.top+e.height>=t.top+t.height}function g(e,t){if(t&&t.nodeType===1){const s=(0,r.getElementTag)(t);const o=(0,r.xpathOne)(t);return`${e}/${s}${o}`}return e}function y({selectorsCandidates:e,mobileLocator:t,projectType:s,currentNode:n,currentXpath:a,selectorParamEvaluator:i}){for(let r=0;r<c.selectorLocateOrder.length;r++){const l=c.selectorLocateOrder[r];const u=t[l];let d;const p=b(n,a,l,s);const m=e.get(l);let f="";if(!u||(u===null||u===void 0?void 0:u.disabled)||!m){continue}f=u.currentValue;if(u instanceof c.ManualSelector){d=u.matchMethod;if(u.isExpression){f=i.execute(f)}}if(!f||f===""){continue}if(l==="imageLocation"){if(!o.default.flags.locateMobileElementsUsingImage.isEnabled())continue;const e=x(n,s);if(!(e===null||e===void 0?void 0:e.toLocaleLowerCase().includes("image")))continue;m.add(a);continue}if(!p)continue;if(S(p,f,d)){m.add(a)}}}function b(e,t,s,o){switch(s){case"id":return v(e,o);case"text":return p(e,o);case"class":return x(e,o);case"index":return e.getAttribute("index");case"xpath":return t;case"xpathWithoutIndices":return c.xpathManipulations.removeXpathIndices(t);case"closestParentIndexOnlyXpath":return c.xpathManipulations.getXpathFromIndexType(t,c.IndexXpathType.Last);case"indexOnlyXpath":return c.xpathManipulations.getXpathFromIndexType(t,c.IndexXpathType.First);case"closestText":return i.MobileLocatorFactory.getClosestText(i.MobileLocatorFactory.getElementClosestTextCandidatesInBfsBounds(e,o));case"contentDesc":return e.getAttribute("content-desc");default:return null}}function v(e,t){if(t===n.commonConstants.test.ANDROID){return e.getAttribute("resource-id")||""}if(t===n.commonConstants.test.IOS){return e.getAttribute("name")||""}return""}function x(e,t){if(t===n.commonConstants.test.ANDROID){return e.getAttribute("class")||""}if(t===n.commonConstants.test.IOS){return e.getAttribute("type")||e.getAttribute("class")||""}return""}function S(e,t,s){if(!s){return e===t}switch(s){case c.MobileSelectorMatchMethod.Equals:return e===t;case c.MobileSelectorMatchMethod.StartsWith:return e.startsWith(t);case c.MobileSelectorMatchMethod.EndsWith:return e.endsWith(t);case c.MobileSelectorMatchMethod.Contains:return e.includes(t);default:return false}}},944:function(e,t,s){"use strict";var o=this&&this.__decorate||function(e,t,s,o){var n=arguments.length,a=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,s):o,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;r>=0;r--)if(i=e[r])a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a;return n>3&&a&&Object.defineProperty(t,s,a),a};var n=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};var a,i,r,c,l,u,d,p,m;Object.defineProperty(t,"__esModule",{value:true});t.getDom=t.waitForDomToStable=t.MobileLocateElement=void 0;const f=s(12);const h=s(7);const g=s(178);const y=s(942);const b=s(872);const v=s(943);const x=s(176);const S=s(279);const E=s(831);const T=s(277);const P=2;const w=8e4;const I=4e4;const A=15e3;const R=15e3;class L{constructor(e,t,s,o,n){this.appiumApi=e;this.projectType=t;this.iterationLogger=new b.AlgoUtils.IncrementLogger("Locate retry #");this.isDomStable=false;this.stableDOM=undefined;this.testimServicesApi=s;this.localCoralogixLogger=E.playbackLogger.getLogger(o);if(n){this.setStableDOM(n)}}setStableDOM(e){if(!f.default.flags.locateMobileElementsUsingDom.isEnabled()){this.iterationLogger.log("Using DOM feature flag is disable.");return}this.stableDOM=e;this.isDomStable=true}async setStableDomUsingAppium(){if(!f.default.flags.locateMobileElementsUsingDom.isEnabled()){this.iterationLogger.log("Using DOM feature flag is disable.");return}const e=await b.AlgoUtils.logAsyncFunctionExecutionTime(O,this.appiumApi,this.projectType);this.isDomStable=e.isDomStable;this.stableDOM=e.stableDOM;if(this.isDomStable){this.iterationLogger.log("Dom is stable.");return}this.iterationLogger.log("Dom is not stable.")}async locateElement(e,t,s,o,n,a,i,r=new g.NoEnvironmentParamEvaluator){var c;if(i){this.iterationLogger.setIdentifier(i)}b.AlgoUtils.Logging.log("Searching element: ",e);if(this.isDomStable){this.iterationLogger.log("Dom is stable, using DOM to locate element.")}else{this.iterationLogger.log("Dom is not stable, using Appium to locate element.")}const l=e.computedLocatorStrategy==="fallback"||!f.default.flags.locateMobileElementsUsingML.isEnabled()||!this.isDomStable||!this.stableDOM;b.AlgoUtils.Logging.log("StrateUsing fallback strategy: ",l);let u;const d=F(t,s,o,a);if(l){const s=performance.now();u=await this.fallbackLocate(e,r,t,d);const o=performance.now();const n=(o-s).toFixed(2);if(u.confidenceLevel===y.MobileLocatedElementConfidenceLevel.NotFound||u.confidenceLevel===y.MobileLocatedElementConfidenceLevel.VeryLow){this.iterationLogger.log("Element not found using fallback intersection.");return undefined}b.AlgoUtils.Logging.log("Element found using fallback intersection: ",u,"Run time:",n)}else if(this.stableDOM){const i=performance.now();u=await this.LocateElementUsingML(e,this.stableDOM,n,t,d);const l=performance.now();const p=(l-i).toFixed(2);b.AlgoUtils.Logging.log("ML run time: ",p);if(u.confidenceLevel===y.MobileLocatedElementConfidenceLevel.NotFound){this.iterationLogger.log("Element not found using ML.");if(f.default.flags.locateOnImageIfElemNotFoundByML.isEnabled()&&((c=e.imageLocation)===null||c===void 0?void 0:c.currentValue)&&this.isDomStable&&this.stableDOM){u=await this.locateElementUsingImage(e,r,t,d);if(u.confidenceLevel<y.MobileLocatedElementConfidenceLevel.High){this.iterationLogger.log("Element not found using ML and image.");return undefined}b.AlgoUtils.Logging.log("Element was not found using ML, but found using image: score=",u.confidenceLevel);this.localCoralogixLogger.logAnalytics("ml-locate-found-by-image-only",{projectId:t,testId:s,stepId:o,resultId:a})}else{b.AlgoUtils.Logging.log("Element not found using ML.");return undefined}}}this.iterationLogger.log("Element found.");return u}async locateElementUsingImage(e,t,s,o){var n;const a={elementId:"",selectorsScores:new Map,confidenceLevel:y.MobileLocatedElementConfidenceLevel.NotFound,testimId:null,shadowPath:[],rect:{left:0,top:0,width:0,height:0,pixelRatio:1}};if(!((n=e.imageLocation)===null||n===void 0?void 0:n.currentValue))return a;if(!this.isDomStable||!this.stableDOM)return a;try{const n=b.AlgoUtils.logFunctionExecutionTime(v.extractElementCandidatesInDOM,this.stableDOM,e,this.projectType,t);const i=n.get("imageLocation")||new Set;const{score:r,locatedElementXpath:c}=await this.getMostSimilarImage(i,e.imageLocation.currentValue,s,o);if(!c){return a}const l=(0,v.findElementByXPathInDOM)(this.stableDOM,c);if(!l){return a}this.populateElement(a,c,l,r);return a}catch(e){this.iterationLogger.log(e.message);return a}}async LocateElementUsingML(e,t,s,o,n){const a={elementId:"",selectorsScores:new Map,confidenceLevel:y.MobileLocatedElementConfidenceLevel.NotFound,testimId:null,shadowPath:[],rect:{left:0,top:0,width:0,height:0,pixelRatio:1}};const i=t.innerHTML;const r=this.getMobileLocatorAttributesForML(e);const c={high:.9,medium:.4,low:.2};const l=c[e.threshold||"medium"];const u=await b.AlgoUtils.logAsyncFunctionExecutionTime(N,this.testimServicesApi,r,i,s,o,n);if((u===null||u===void 0?void 0:u.confidence_score)<l){return a}const{element_xpath:d,confidence_score:p}=u;const m=(0,v.findElementByXPathInDOM)(t,d);if(!m){return a}this.populateElement(a,d,m,p);return a}populateElement(e,t,s,o){e.xpath=t;e.domElement=s;e.confidenceLevel=(0,y.getMobileLocatedElementConfidenceLevel)(o)}getMobileLocatorAttributesForML(e){const t={};for(const s of Object.keys(e.attributes)){t[s]=e.attributes[s].currentValue}t.xpath=e.xpath.currentValue;t.closest_text=e.closestText.currentValue;if(e.device){t.resolution_width=e.device.width.toString();t.resolution_height=e.device.height.toString();t.os_type=e.device.osType}return t}async fallbackLocate(e,t,s,o){var n;const a={elementId:"",selectorsScores:new Map,confidenceLevel:y.MobileLocatedElementConfidenceLevel.NotFound,testimId:null,shadowPath:[],rect:{left:0,top:0,width:0,height:0,pixelRatio:1}};const i=a;let r=0;let c=0;let l=new Map;if(this.isDomStable&&this.stableDOM){l=b.AlgoUtils.logFunctionExecutionTime(v.extractElementCandidatesInDOM,this.stableDOM,e,this.projectType,t);l.forEach(((e,t)=>{this.iterationLogger.log(`Candidates length for ${t} is ${e.size}`)}))}let u=new Set;const d=new Map;for(let a=0;a<S.selectorLocateOrder.length;a++){const p=S.selectorLocateOrder[a];if(p==="closestText"&&!f.default.flags.locateMobileElementsUsingClosestText.isEnabled()||p==="contentDesc"&&!f.default.flags.locateMobileElementsUsingContentDesc.isEnabled()){this.iterationLogger.log(`${p} feature flag is disabled. Continue to next selector.`);continue}try{const t=e[p];if(t===null||t===void 0?void 0:t.disabled){this.iterationLogger.log(`${p} is disabled. Continue to next selector.`);continue}}catch(e){this.iterationLogger.log(e.message)}if(((n=e[p])===null||n===void 0?void 0:n.currentValue)||S.selectorsConfig[p].selectorType==="AutoGenerated"){c+=S.selectorsConfig[p].confidenceWeight||0}const m=await this.findElementsBySelector(e,p,l,u,d,i.selectorsScores,t,s,o);this.iterationLogger.log(`Find element results: \n            candidateElementsIds size - ${m.candidateElements.size}, \n            confidenceScore - ${m.selectorConfidenceScore}.`);if(!m.selectorConfidenceScore){continue}u=m.candidateElements;r+=m.selectorConfidenceScore;if(u.size===1){this.iterationLogger.log("Possible element found.");if(this.isDomStable&&this.stableDOM){const e=u.values().next().value;const t=b.AlgoUtils.logFunctionExecutionTime(v.findElementByXPathInDOM,this.stableDOM,e);if(t){i.domElement=t;i.xpath=e;this.iterationLogger.log(`Found DOM element: ${i.domElement}`)}else{this.iterationLogger.log("Element not found in DOM.")}}else{i.elementId=u.values().next().value}this.iterationLogger.log(`Sum of non empty selectors ${c}.`);r/=c;i.confidenceLevel=(0,y.getMobileLocatedElementConfidenceLevel)(r);this.logLocatedElementConfidence(r,i,this.iterationLogger);return i}}this.iterationLogger.log("Element not found.");return a}async findElementsBySelector(e,t,s,o,n,a,i,r,c){var l;let u=new Set;this.iterationLogger.log(`Try to find by: ${t}`);const d={candidateElements:new Set};try{if(this.isDomStable){u=s.get(t)||new Set}else{u=new Set(await this.getElementsBySelector(e,t,i))}}catch(e){this.iterationLogger.log(e.message)}if(f.default.flags.locateMobileElementsUsingImage.isEnabled()&&t==="imageLocation"&&((l=e.imageLocation)===null||l===void 0?void 0:l.currentValue)&&this.isDomStable){try{u=await this.compareElementSavedImageToImageCandidates(u,e.imageLocation.currentValue,r,c)}catch(e){u.clear();this.iterationLogger.log(e.message)}}this.iterationLogger.log(`Got result for: ${t}, number of elements found: ${u.size}`);const p=u===null||u===void 0?void 0:u.size;if(p===0){this.iterationLogger.log(`No element found by: ${t}, continue to next selector`);return d}if(p>30&&t==="class"){this.iterationLogger.log(`Too many elements ${p} found by: ${t}, continue to next selector`);return d}let m=false;if(o.size===0){o=u}else{this.iterationLogger.log(`Performing intersection. lists size: ${o.size}, ${u.size}`);let e;if(this.isDomStable){e=D(o,u)}else{e=await _(o,u,n,this.appiumApi)}if(e.size!==0){o=e;this.iterationLogger.log(`Intersection size is: ${e.size}.`)}else{m=true;this.iterationLogger.log("Intersection is empty.")}}if(!m){const e=S.selectorsConfig[t].confidenceWeight||0;const s=e/p;a.set(t,s);const n=s;return{candidateElements:o,selectorConfidenceScore:n}}return d}async compareElementSavedImageToImageCandidates(e,t,s,o){const n=await this.prepareImagesAndGetScores(e,t,s,o);const a=new Set;if(!n)return a;const i=n.scores;const r=n.xPaths;const c=.8;let l=0;i===null||i===void 0?void 0:i.forEach((e=>{if(e>c){a.add(r[l])}l++}));return a}async getMostSimilarImage(e,t,s,o){if(e.size===0)return{score:0,locatedElementXpath:undefined};const n=await this.prepareImagesAndGetScores(e,t,s,o);if(!n)return{score:0,locatedElementXpath:undefined};const a=n.scores;const i=n.xPaths;let r=-Infinity;const c=.7;let l;a===null||a===void 0?void 0:a.forEach(((e,t)=>{if(e>c&&e>r){r=e;l=i[t]}}));return{score:r,locatedElementXpath:l}}async prepareImagesAndGetScores(e,t,s,o){if(e.size===0)return undefined;const n=Array.from(e);const a=[];n.forEach((e=>{const t=(0,v.findElementByXPathInDOM)(this.stableDOM,e);if(!t)return;const s=(0,T.parseBoundsFromElement)(t);if(!s)return;a.push(s)}));if(n.length!==a.length){b.AlgoUtils.Logging.warn("In prepareImagesAndGetScores length is not the same length as currentElementsAreas. Skipping image selector");return undefined}const i=await this.appiumApi.getScreenshot();const r=await b.AlgoUtils.logAsyncFunctionExecutionTime(b.cropImageIntoPieces,i,a);const c=await b.AlgoUtils.logAsyncFunctionExecutionTime(C,this.testimServicesApi,t,r,s,o);if(!c||c.length===0)return undefined;return{scores:c,xPaths:n}}async getElementsBySelector(e,t,s){var o,n;let a="";let i=S.MobileSelectorMatchMethod.Equals;if(!((o=e[t])===null||o===void 0?void 0:o.currentValue)){if(!M(t,e)){this.iterationLogger.log(`${t} is invalid selector.`)}else if(((n=e[t])===null||n===void 0?void 0:n.currentValue)===""){this.logSelectorEmpty(t)}return[]}const r=e[t];const c=S.selectorsConfig[t];a=c.overrideValueWithDefaultInUI?c.defaultValue:r.currentValue;if(r instanceof S.ManualSelector){i=r.matchMethod;if(r.isExpression){a=s.execute(a)}}return await this.appiumApi.getElementsIdsBySelector(t,a,e.attributes,this.projectType,i)}logSelectorEmpty(e){this.iterationLogger.log(`Recorded selector ${e} is empty`)}logLocatedElementConfidence(e,t,s){s.log(`Confidence score: ${e}`);s.log(`Confidence level: ${(0,y.confidenceLevelToString)(t.confidenceLevel)}`);s.log("Selectors scores: ");for(const[e,o]of t.selectorsScores.entries()){s.log(`   selector: ${e}, score: ${o}`)}}}t.MobileLocateElement=L;o([b.measureAsync,n("design:type",Function),n("design:paramtypes",[typeof(a=typeof x.MobileLocator!=="undefined"&&x.MobileLocator)==="function"?a:Object,Object,String,typeof(i=typeof Record!=="undefined"&&Record)==="function"?i:Object]),n("design:returntype",typeof(r=typeof Promise!=="undefined"&&Promise)==="function"?r:Object)],L.prototype,"fallbackLocate",null);o([b.measureAsync,n("design:type",Function),n("design:paramtypes",[typeof(c=typeof Set!=="undefined"&&Set)==="function"?c:Object,String,String,typeof(l=typeof Record!=="undefined"&&Record)==="function"?l:Object]),n("design:returntype",typeof(u=typeof Promise!=="undefined"&&Promise)==="function"?u:Object)],L.prototype,"compareElementSavedImageToImageCandidates",null);o([b.measureAsync,n("design:type",Function),n("design:paramtypes",[typeof(d=typeof Set!=="undefined"&&Set)==="function"?d:Object,String,String,typeof(p=typeof Record!=="undefined"&&Record)==="function"?p:Object]),n("design:returntype",typeof(m=typeof Promise!=="undefined"&&Promise)==="function"?m:Object)],L.prototype,"getMostSimilarImage",null);async function O(e,t,s){let o;let n=false;try{let a=true;let i=w;const r=performance.now();o=s||await k(e,t);if(performance.now()-r>w/2)i=I;setTimeout((()=>{a=false;b.AlgoUtils.Logging.log("Waiting for Dom to be stable max time reached.")}),i);let c;let l;do{c=o===null||o===void 0?void 0:o.querySelectorAll("*").length;o=await k(e,t);l=o===null||o===void 0?void 0:o.querySelectorAll("*").length;n=c>0&&l>0&&Math.abs(c-l)<=P}while(a&&!n)}catch(e){b.AlgoUtils.Logging.log("Failed waiting to Dom to be stable, continue anyway")}return{isDomStable:n,stableDOM:(o===null||o===void 0?void 0:o.documentElement)||undefined,domForComparison:o}}t.waitForDomToStable=O;async function k(e,t){if(t==="ios"){return await e.ios.getSource({excludedAttributes:["accessible","visible"]})}return await e.getDom()}t.getDom=k;function D(e,t){const s=new Set;if(e.size>t.size){return D(t,e)}e.forEach((e=>{if(t.has(e)){s.add(e)}}));return s}async function _(e,t,s,o){const n=new Set;if(e.size>t.size){return _(t,e,s,o)}for(const a of e){for(const e of t){const t=await o.isElementsEquals(a,e,s);if(t){n.add(a);break}}}return n}function M(e,t){return e in t&&Boolean(t[e])}async function C(e,t,s,o,n){let a=[];let i;try{i=await h.utils.promiseTimeout(e.locators.getImagesSimilarityScore(t,s,o,n),A)}catch(e){b.AlgoUtils.Logging.error("Failed to get similarity score",e)}if(i===null||i===void 0?void 0:i.similarities){a=i.similarities;b.AlgoUtils.Logging.log("Image similarity scores results: ",a)}return a}async function N(e,t,s,o,n,a){let i;try{i=await h.utils.promiseTimeout(e.locators.getLocateMl(t,s,o,n,a),R)}catch(e){b.AlgoUtils.Logging.error("Failed to call ML locate",e)}return i}function F(e,t,s,o){const n={};n.projectId=e;n.testId=t;n.stepId=s;n.resultId=o;if(f.default.flags.enableDockerDebugMode.isEnabled()){n.debugLocate=true}return n}},945:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SelectorParamEvaluator=void 0;const o=s(74);const n=s(935);const a=s(855);class i{constructor(e,t){this.step=e;this.context=t}executeOrDefault(e,t){if(!t)return e;return this.execute(t)}execute(e){const{exportsGlobal:t,exportsTest:s}=this.context.playback.player;const i=a.StepParamsBuilder.getStepInputs(this.step,this.context,t,s);try{return(0,n.executeExpression)(this.context,i,e)}catch(e){throw new o.SelectorParamEvaluationError(e)}}}t.SelectorParamEvaluator=i},946:function(e,t,s){"use strict";var o=this&&this.__decorate||function(e,t,s,o){var n=arguments.length,a=n<3?t:o===null?o=Object.getOwnPropertyDescriptor(t,s):o,i;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,s,o);else for(var r=e.length-1;r>=0;r--)if(i=e[r])a=(n<3?i(a):n>3?i(t,s,a):i(t,s))||a;return n>3&&a&&Object.defineProperty(t,s,a),a};var n=this&&this.__metadata||function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:true});t.MobileSwipeStep=t.DEFAULT_SWIPE_WAIT=t.getSwipeDataVerticalLength=t.getSwipeDataVerticalDirection=void 0;const a=s(290);const i=s(2);const r=e=>{if(e.appiumScaled.from.y===e.appiumScaled.to.y)return undefined;return e.appiumScaled.from.y<e.appiumScaled.to.y?"up":"down"};t.getSwipeDataVerticalDirection=r;const c=e=>Math.abs(e.appiumScaled.from.y-e.appiumScaled.to.y);t.getSwipeDataVerticalLength=c;t.DEFAULT_SWIPE_WAIT=1500;class l extends a.MobileStep{_update(e){if(Object.hasOwn(e,"from")&&e.from){this.from=e.from}if(Object.hasOwn(e,"to")&&e.to){this.to=e.to}if(Object.hasOwn(e,"duration")&&e.duration){this.duration=e.duration}if(Object.hasOwn(e,"pointsRatio")&&e.pointsRatio){this.pointsRatio=e.pointsRatio}return super._update(e)}getThumbnailElement(){return this.element}getDisplayName(){return"Swipe"}getFriendlyName(){return"Swipe"}getIcon(){return"swipe-2"}getSerializableObject(e){return{...super.getSerializableObject(e),from:this.from,to:this.to,duration:this.duration,pointsRatio:this.pointsRatio}}hasTimeoutOverrideOption(){return true}getTestimDocsUrl(){return"https://www.example.com/"}}t.MobileSwipeStep=l;o([i.observable,n("design:type",Object)],l.prototype,"from",void 0);o([i.observable,n("design:type",Object)],l.prototype,"to",void 0);o([i.observable,n("design:type",Number)],l.prototype,"duration",void 0);o([i.observable,n("design:type",Object)],l.prototype,"pointsRatio",void 0)},947:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.executeApexCode=t.parseApexExecutionLog=void 0;const o=s(1125);try{globalThis._.noConflict()}catch(e){}const n="Log unavailable";const a=/(?<time>^\d\d:\d\d:\d\d\.\d) (?<msg>.*)/;async function i({salesforceApiUrl:e,salesforceApiPassword:t,salesforceApiUsername:s}){try{const n=new o.Connection({version:"52.0",loginUrl:e});await n.login(s,t);return n}catch(e){throw Error(`Salesforce authentication failure, check your login URL and credentials. Error received from Salesforce: ${e}`)}}async function r(e,t){try{const s=await e.tooling.sobject("DebugLevel");const o=await s.findOne({MasterLabel:t})||{};if(o===null||o===void 0?void 0:o.Id){return o.Id}const n=await s.create({ApexCode:"Finest",ApexProfiling:"INFO",Callout:"INFO",Database:"INFO",Validation:"INFO",Visualforce:"INFO",Workflow:"INFO",System:"INFO",DeveloperName:t,MasterLabel:t});if(n.success){return n.id}}catch(e){}return undefined}async function c(e,t){var s;try{await e.tooling.sobject("traceFlag").create({ApexCode:"Finest",ApexProfiling:"INFO",Callout:"INFO",Database:"INFO",ExpirationDate:new Date(Date.now()+20*1e3),StartDate:new Date(Date.now()),TracedEntityId:(s=e.userInfo)===null||s===void 0?void 0:s.id,Validation:"INFO",Visualforce:"INFO",System:"INFO",LogType:"DEVELOPER_LOG",DebugLevelId:t})}catch(e){}}async function l(e,t,s=0){var o,n;const a=await e.query(t);const i=(n=(o=a.records)===null||o===void 0?void 0:o[s])===null||n===void 0?void 0:n.Id;return await e.request({url:`/sobjects/ApexLog/${i}/Body/`,method:"GET"})}async function u(e,t=""){try{const s=`SELECT Id FROM ApexLog WHERE Request = 'API' AND Operation like '%executeAnonymous%' AND LogUserId='${t}' ORDER BY StartTime DESC, Id DESC LIMIT 1`;return await l(e,s)||n}catch{return n}}function d(e,t){const s=t.getTime();if(!e.length||e===n){return[{timestamp:s,method:"",msg:e}]}return e.split("\n").map((e=>{const t=e===null||e===void 0?void 0:e.match(a);if(t){return{timestamp:s,method:"",msg:t.groups.msg}}return{timestamp:s,method:"",msg:e}}))}t.parseApexExecutionLog=d;async function p({salesforceApiUrl:e,salesforceApiUsername:t,salesforceApiPassword:s,apexCode:o,debugLevelLabel:n,asyncLogHandler:a}){var l;const d=await i({salesforceApiUrl:e,salesforceApiUsername:t,salesforceApiPassword:s});const p=await r(d,n);if(p){await c(d,p)}let m={};try{m=await d.tooling.executeAnonymous(o)}catch(e){throw Error(`Apex execution error: ${e}`)}const f=new Date;const h=m.compiled?await u(d,(l=d.userInfo)===null||l===void 0?void 0:l.id):"";a===null||a===void 0?void 0:a(h);return{result:m,startTimestamp:f,log:h}}t.executeApexCode=p},981:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.parseJsString=t.textToJsString=t.jsStringToText=t.isEditableJsString=void 0;const o={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\v","'":"\\'","\\":"\\\\"};const n=/[\\'\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function a(e){const t=c(e);return t.valid&&!t.nonEditableChars}t.isEditableJsString=a;function i(e){const t=c(e);return t.valid?t.text:e}t.jsStringToText=i;function r(e){return n.test(e)?`'${e.replace(n,(e=>{const t=o[e];return typeof t==="string"?t:`\\u${`0000${e.charCodeAt(0).toString(16)}`.slice(-4)}`}))}'`:`'${e}'`}t.textToJsString=r;function c(e){if(e===undefined||e.length===0){return{valid:false}}e=e.trim();const t=e[0];if(t!=='"'&&t!=="'"&&!e.endsWith(t)){return{valid:false}}let s=false;let o="";for(let n=1;n<e.length;n++){let a=e[n];if(a==="\n"||a==="\r"){return{valid:false}}if(a===t){if(n===e.length-1){return{valid:true,text:o,nonEditableChars:s}}return{valid:false}}if(a==="\\"){n++;a=e[n];switch(a){case"b":a="\b";break;case"f":a="\f";break;case"n":a="\n";break;case"r":a="\r";break;case"t":a="\t";break;case"v":a="\v";break;case"u":{const t=e.substring(n+1,n+5);if(/^[0-9a-fA-F]{4}/.test(t)){a=String.fromCharCode(parseInt(t,16));n+=4}break}case"x":{const t=e.substring(n+1,n+3);if(/^[0-9a-fA-F]{2}/.test(t)){a=String.fromCharCode(parseInt(t,16));n+=2}break}case"\n":s=true;continue;case"\r":if(e[n+1]==="\n"){n++}s=true;continue;case undefined:return{valid:false};default:{const t=/^[0-3]?[0-7]?[0-7]/.exec(e.substring(n));if(t!==null){a=String.fromCharCode(parseInt(t[0],8));n+=t[0].length-1}break}}}if(a.charCodeAt(0)<32)s=true;o+=a}return{valid:false}}t.parseJsString=c},982:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CliJsStepPlayback=void 0;const o=s(849);const n=s(1186);class a extends o.JSStepPlayback{getNodePackageParameters(){const e=this.step.parameterValues.filter((e=>e.type==="node-package")).filter((e=>!Object.keys(this.context.getStepParamsContainer()).includes(e.targetId)));return e}executeNodePackageParameters(e){const t=this.getNodePackageParameters();const{context:s,retryIndex:o,id:a}=this;const i=this.getStepResultId();const r=new n.NodePackagePlayer(s,i,o,a);return r.installPackages(t,e)}async onBeforeExecute(e){await this.executeNodePackageParameters(e);await super.onBeforeExecute(e)}}t.CliJsStepPlayback=a},985:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SfdcBaseStepPlayback=void 0;const o=s(850);const n=s(823);const a=s(1208);const i=s(891);const r=s(5);const c=s(1276);class l extends o.ParameterStepPlayback{async execute(e){var t,s,o;const{step:n,context:a,exportsGlobal:l,exportsTest:u}=this;this.buildIncomingParameters();const d=(s=(t=a.data.maxTotalStepTime)!==null&&t!==void 0?t:e)!==null&&s!==void 0?s:n.defaultTimeout;this.timeoutTimestamp=((o=this.startTimestamp)!==null&&o!==void 0?o:Date.now())+d;a.exportsGlobal=l;a.exportsTest=u;a.evaluateExpression=async e=>this.evaluateExpression(e);a.getMfaAuthenticatorCode=e=>this.getMfaAuthenticatorCode(e);a.stepStatus=()=>this.stepStatus();a.sfdcLogHandler=new c.SfdcLogHandler(this.logMessage.bind(this),this.logScreenshot.bind(this));const p=await a.stepActionFactory.executeStep({stepData:n,context:a,frameHandler:a.frameHandler,exportsGlobal:l,locateElementPlayer:null,exportsTest:u});if(p.exception instanceof i.SfdcTimeoutError){p.isTimeout=true;p.errorType=r.commonConstants.stepResult.ACTION_TIMEOUT}return this.onExecuteResult(p)}logMessage(e,t){this.context.playback.sfdcAddLog(e,t)}async logScreenshot(e,t){var s,o,n,a,i,r;if(!((s=this.context.playback.sfdcOptions)===null||s===void 0?void 0:s.saveLogScreenshots)){return}const c=(a=(n=(o=this.context.playback).isMobileProject)===null||n===void 0?void 0:n.call(o))!==null&&a!==void 0?a:false;const l=Date.now();let u;if(t===null||t===void 0?void 0:t.locationElementId){if(t.highlightRect&&!t.locationRect){throw new Error("Must specify locationRect if specifying locationElementId and hilightRect")}u=await this.context.takeElementImage(t.locationElementId,c)}else if(t===null||t===void 0?void 0:t.locationRect){u=await this.context.takeViewPortImageArea(t.locationRect,c)}else{u=await this.context.takeViewPortImage(c)}let d=t===null||t===void 0?void 0:t.highlightRect;if(d&&(t===null||t===void 0?void 0:t.locationRect)){d={...d};d.left-=t.locationRect.left;d.top-=t.locationRect.top}let p=null;if(u){p=(i=this.context.stepResultUploader.uploadImageAndDom({imageDataUrl:u,step:this.step}).imgUrl)!==null&&i!==void 0?i:null;const s={imageUrl:p,imageHighlight:d,imageSize:(t===null||t===void 0?void 0:t.locationRect)?{width:t.locationRect.width,height:t.locationRect.height}:undefined,pixelRatio:(r=t===null||t===void 0?void 0:t.pixelRatio)!==null&&r!==void 0?r:1};this.context.playback.sfdcAddScreenshot(`${e} (${Date.now()-l}ms)`,s)}}async evaluateExpression(e){this.buildIncomingParameters();if(Array.isArray(e.expression)){return Promise.all(e.expression.map((async e=>this.computeExpression({expression:e}))))}return this.computeExpression(e)}async getMfaAuthenticatorCode(e){if(!e){return undefined}const{token:t}=await this.testimServicesApi.secrets.getSecretAuthenticator(this.context.projectId,e);return t}async computeExpression(e){var t;if(e.expression===""||e.expression===undefined){throw new i.SfdcInvalidValue}const s=await(0,n.computeExpressionPromise)(e,this.context,this.exportsGlobal,this.exportsTest);const o=s.success?s.evaluatedText:e.expression;return(t=o===null||o===void 0?void 0:o.toString())!==null&&t!==void 0?t:""}stepStatus(){if(this.isAborted){return a.StepStatus.Aborted}if(Date.now()>this.timeoutTimestamp){return a.StepStatus.TimedOut}return a.StepStatus.Running}}t.SfdcBaseStepPlayback=l},994:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.buildStepPlayback=t.STEP_TO_PLAYBACK_MAPPING=void 0;const o=s(995);const n=s(999);const a=s(1001);const i=s(1002);const r=s(879);const c=s(1004);const l=s(1005);const u=s(1006);const d=s(1007);const p=s(1008);const m=s(1009);const f=s(1011);const h=s(1013);const g=s(1017);const y=s(1019);const b=s(1021);const v=s(1022);const x=s(1023);const S=s(818);const E=s(1118);const T=s(1119);const P=s(1120);const w=s(849);const I=s(1123);const A=s(1124);const R=s(1185);const L=s(982);const O=s(1187);const k=s(1189);const D=s(1190);const _=s(1191);const M=s(1192);const C=s(1196);const N=s(1197);const F=s(1198);const U=s(1204);const j=s(1205);const $=s(1206);const B=s(1207);const V=s(985);const G=s(1277);const H=s(109);const q=s(1278);const W=s(1279);const z=s(1280);const J=s(1281);const X=s(1282);const K=s(1283);const Y=s(1284);const Z=s(1285);const Q=s(1287);const ee=s(1288);const te=s(1289);const se=s(1290);const oe=p.PixelValidationStepPlayback;t.STEP_TO_PLAYBACK_MAPPING={scenario:k.GroupStepPlayback,group:k.GroupStepPlayback,mouse:E.MouseStepPlayback,"text-validation":T.TextValidationStepPlayback,"ios-text-validation":P.MobileTextValidationStepPlayback,"android-text-validation":P.MobileTextValidationStepPlayback,"wait-for-text-validation":T.TextValidationStepPlayback,"ios-wait-for-text-validation":P.MobileTextValidationStepPlayback,"android-wait-for-text-validation":P.MobileTextValidationStepPlayback,"shared-step-instance":R.SharedStepInstancePlayback,"marketplace-wrapper":R.SharedStepInstancePlayback,"simple-ui-verification":oe,"wait-for-simple-ui-verification":oe,"custom-validation":oe,"select-option":S.StepPlayback,submit:S.StepPlayback,scroll:S.StepPlayback,navigation:I.NavigationStepPlayback,"element-validation":S.StepPlayback,"wait-for-element-validation":S.StepPlayback,"negative-element-validation":M.NegativeElementValidationStepPlayback,"wait-for-negative-element-validation":M.NegativeElementValidationStepPlayback,"checkbox-validation":n.CheckboxStepPlayback,"radio-validation":n.CheckboxStepPlayback,"user-code":w.JSStepPlayback,"validation-code-step":w.JSStepPlayback,"action-code-step":w.JSStepPlayback,"wait-for-code-step":w.JSStepPlayback,[H.ConditionType.CUSTOM]:w.JSStepPlayback,[H.ConditionType.NEVER]:w.JSStepPlayback,[H.ConditionType.ELEMENT]:w.JSStepPlayback,"network-validation-step":d.NetworkValidationStepPlayback,text:D.TextStepPlayback,"special-key":S.StepPlayback,"input-file":S.StepPlayback,"drop-file":S.StepPlayback,"resize-window":C.ResizeWindowStepPlayback,"debug-lab-feature":b.DebugLabFeatureStepPlayback,hover:u.DebuggerProtocolStepPlayback,annotation:a.EmptyStepPlayback,wheel:N.WheelStepPlayback,sleep:r.NoElementStepPlayback,refresh:r.NoElementStepPlayback,"api-validation":F.ApiStepPlayback,"api-action":F.ApiStepPlayback,"extract-text":x.ExtractTextStepPlayback,"random-value-generator":o.RandomValueStepPlayback,mfa:_.MfaStepPlayback,"date-generator":g.DateGeneratorStepPlayback,"generate-random-field":y.GenerateRandomFieldStepPlayback,"set-cookie":l.SetCookieStepPlayback,"get-cookie":c.GetCookieStepPlayback,"css-prop-validation":m.CssPropertyValidationPlayback,"html-attr-validation":f.HtmlAttributeValidationPlayback,"accessibility-validation-step":h.AccessibilityValidationPlayback,"salesforce-apex-action":A.SalesforceApexActionStepPlayback,"accessibility-validation-shared-step":h.AccessibilityValidationPlayback,"android-tap":j.MobileTapStepPlayback,"android-extract-text":$.MobileExtractTextStepPlayback,"android-set-text":q.MobileSetTextStepPlayback,"android-code-verification":X.MobileCodeVerificationStepPlayback,"android-device-key":r.NoElementStepPlayback,"android-swipe":W.MobileSwipePlayback,"android-key-board-special-keys":r.NoElementStepPlayback,"ios-tap":j.MobileTapStepPlayback,"ios-extract-text":$.MobileExtractTextStepPlayback,"ios-set-text":q.MobileSetTextStepPlayback,"ios-swipe":W.MobileSwipePlayback,"ios-device-key":r.NoElementStepPlayback,"ios-key-board-special-keys":r.NoElementStepPlayback,"ios-attr-validation":Q.MobileAttributeValidationStepPlayback,"android-attr-validation":Q.MobileAttributeValidationStepPlayback,"ios-reset-app":z.MobileResetAppStepPlayback,"android-reset-app":z.MobileResetAppStepPlayback,"ios-mobile-home-button":Z.MobileHomeButtonStepPlayback,"android-mobile-home-button":Z.MobileHomeButtonStepPlayback,"mobile-hide-keyboard":se.MobileHideKeyboardStepPlayback,"android-back-button":K.MobileAndroidBackStepPlayback,"android-scroll-to-text":Y.MobileScrollToTextStepPlayback,"ios-scroll-to-text":Y.MobileScrollToTextStepPlayback,"execute-driver-script":ee.ExecuteDriverScriptStepPlayback,"cli-validation-download-file":U.CliDownloadFileStepPlayback,"cli-wait-for-download-file":U.CliDownloadFileStepPlayback,"cli-validation-code-step":L.CliJsStepPlayback,"cli-wait-for-code-step":L.CliJsStepPlayback,"cli-action-code-step":L.CliJsStepPlayback,"email-generator":v.EmailGeneratorPlayback,"email-validation-step":O.EmailValidationStepPlayback,assertion:a.EmptyStepPlayback,screenshot:i.ScreensShotStepPlayback,"sfdc-internal-test-step":V.SfdcBaseStepPlayback,"sfdc-recorded-step":V.SfdcBaseStepPlayback,"sfdc-step-apex-action":B.SfdcApexActionStepPlayback,"sfdc-step-login":G.SfdcStepPlayback,"sfdc-step-loginas":G.SfdcStepPlayback,"sfdc-step-logout":G.SfdcStepPlayback,"sfdc-step-findrecord":G.SfdcStepPlayback,"sfdc-step-sobjectcreate":G.SfdcStepPlayback,"sfdc-step-sobjectdelete":G.SfdcStepPlayback,"sfdc-step-quickaction":G.SfdcStepPlayback,"sfdc-step-sobjectvalidate":G.SfdcStepPlayback,"sfdc-step-launchapp":G.SfdcStepPlayback,"sfdc-step-wait-for-page-load":G.SfdcStepPlayback,"sfdc-step-closeconsoletabs":G.SfdcStepPlayback,"sfdc-step-sobjectedit":G.SfdcStepPlayback,"sfdc-step-relatedlistaction":G.SfdcStepPlayback,"sfdc-step-convert-lead-to-opportunity":G.SfdcStepPlayback,"sfdc-step-permission-validation":J.SfdcPermissionValidationStepPlayback,"sfdc-step-quotelineeditor":G.SfdcStepPlayback,"sfdc-document-validation":te.DocumentValidationStepPlayback};function ne(e,s,o,n){let a=t.STEP_TO_PLAYBACK_MAPPING[s.type];if(!a){a=s.isGroupStep?k.GroupStepPlayback:S.StepPlayback}const i=new a(s,o,n);i.init(e);return i}t.buildStepPlayback=ne},995:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.RandomValueStepPlayback=void 0;const o=s(996);const n=s(8);const a=s(5);const i=s(823);const r=s(849);const c=n.Logger.getLogger("RandomValueStepPlayback");const{exportScopes:l}=a.commonConstants;const u=e=>Math.floor(Math.random()*e);const d={[o.GeneratedValueTypes.LettersOnly]:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",[o.GeneratedValueTypes.NumbersOnly]:"12345678901234567890123456789012345678901234567890"};class p extends r.JSStepPlayback{init(e){if(!e){c.error("No Shared Step Service given, defaulting to nothing-to-initialize");this.innerSteps=Promise.resolve([])}const t=this.step;this.innerSteps=Promise.resolve([this.buildStepPlayer(e,t.prefixExpression),this.buildStepPlayer(e,t.suffixExpression)])}async execute(){const e=this.step;const t=await this.calcPrefixExpression(e.prefixExpression.expression);const s=await this.calcSuffixExpression(e.suffixExpression.expression);if(t===undefined){return{success:false,reason:"Failed to evaluate JS value-prefix"}}if(s===undefined){return{success:false,reason:"Failed to evaluate JS value-suffix"}}const o=t+this.getGeneratedValue(e)+s;const n=e.exportScope||l.LOCAL;const a=e.paramName;return this.reportExecuteResultWithExport(a,o,n)}getFrameLocators(){return[]}getGeneratedValue(e){let t;let s="";let n=-1;let a=-1;if(e.valueType===o.GeneratedValueTypes.Mixed){t=d[o.GeneratedValueTypes.LettersOnly]+d[o.GeneratedValueTypes.NumbersOnly];if(e.generatedLength===1){return t[u(t.length)]}n=u(e.generatedLength);a=u(e.generatedLength);if(a===n){a=(a+1)%e.generatedLength}}else{t=d[e.valueType]}for(let i=0;i<e.generatedLength;++i){if(i===n){const e=u(d[o.GeneratedValueTypes.NumbersOnly].length);s+=d[o.GeneratedValueTypes.NumbersOnly][e]}else if(i===a){const e=u(d[o.GeneratedValueTypes.LettersOnly].length);s+=d[o.GeneratedValueTypes.LettersOnly][e]}else{const e=u(t.length);s+=t[e]}}return s}async calcExpression(e,t=0){if(!e){return""}if(!this.innerSteps){return undefined}const s=(await this.innerSteps)[t].step;const{context:o,exportsTest:n,exportsGlobal:a}=this;const r=(0,i.computeExpression)(s,o,a,n);return r.evaluatedText}async calcSuffixExpression(e){return this.calcExpression(e,1)}async calcPrefixExpression(e){return this.calcExpression(e,0)}}t.RandomValueStepPlayback=p},996:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.GeneratedValueTypes=void 0;var o;(function(e){e["LettersOnly"]="Letters Only";e["NumbersOnly"]="Numbers Only";e["Mixed"]="Mixed"})(o||(t.GeneratedValueTypes=o={}))},997:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.DocumentLengthComparison=void 0;class o{static mostSignificantDiscrepancy(e,t=[]){if(!e){return null}const s=t.filter((({documentLengthAtRecording:e})=>e&&e>0)).filter((({id:t})=>e[t]&&e[t].hasOwnProperty("documentLengthAtPlayback"))).map((({id:t,documentLengthAtRecording:s})=>e[t].documentLengthAtPlayback/s));return Math.min(...s)}}t.DocumentLengthComparison=o},998:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.extractMouseOffsetOverrideFromStep=void 0;const o=s(8);const n=s(823);const a=o.Logger.getLogger("step-playback-utils");function i({context:e,exportsGlobal:t,exportsTest:s,step:o}){if(!o.overrideMouseOffsetExpression){return undefined}const i={...o,expression:o.overrideMouseOffsetExpression};const{evaluatedText:r}=(0,n.computeExpression)(i,e,t,s);if(!r||typeof r.x!=="number"||typeof r.y!=="number"){a.warn("invalid mouse offset override detected, failing step",{overrideOffset:r});throw new Error("invalid overrideOffset: expected to have x and y properties")}a.log("found mouse offset using evaluated value",{overrideOffset:r});return r}t.extractMouseOffsetOverrideFromStep=i},999:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CheckboxStepPlayback=void 0;const o=s(818);const n=s(1e3);const a=s(5);class i extends o.StepPlayback{async execute(){const e=this.context.data[this.step.targetId||"targetId"];const t=await this.context.stepActionFactory.stepActionUtils.executeInAut(this.context,`\n            ${n.validateCheckboxCode}\n            return isElementChecked(${JSON.stringify(e.locatedElement)}, "${this.step.inputType}")\n        `);let s;if(t.error){s={errorType:a.commonConstants.stepResult.CHECKBOX_VALIDATION_ELEMENTS_FAILURE,resultInfo:{foundElements:t.error.foundElements,inputType:this.step.inputDisplayName.toLowerCase()},success:false}}else if(t.checked===this.step.checkedStatus){s={success:true}}else{s={errorType:a.commonConstants.stepResult.CHECKBOX_VALIDATION_FAILURE,resultInfo:{expected:this.step.checkedStatus,inputType:this.step.inputDisplayName},success:false}}return await this.onExecuteResult(s)}}t.CheckboxStepPlayback=i}}]);