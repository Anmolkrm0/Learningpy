import{a as lo}from"./WPI52SV7.js";import{a as On}from"./6MDJIXWZ.js";import{a as so,c as ur,d as ao,e as fr,h as co}from"./4NAB6M5G.js";import{a as Gr}from"./X52TO7MR.js";import{b as qr}from"./KIFV56CW.js";import{A as Br,B as Xn,Ba as eo,Eb as io,Ha as ro,Ia as no,P as Xe,X as Zn,b as Bn,cb as dt,d as Le,e as qn,ea as Jn,g as sr,h as Nr,jb as Oe,m as Hr,n as Vn,p as Rt,q as ar,r as Wn,s as $n,w as cr,x as Qn,z as lr}from"./BSEQX7JW.js";import{g as to}from"./TAMQTRNZ.js";import{O as jn,P as Kn,fa as oo}from"./PEYNS6YO.js";import{c as Dr,d as Nn,e as nr,f as or,g as Ke}from"./OQCOQ46A.js";import{i as Yn}from"./ZAZJKFJ6.js";import{d as _i}from"./BQGQFNDN.js";import{a as Fr}from"./M3D6HDXF.js";import{d as Hn}from"./PC5JBKQI.js";import{a as ir,b as Si}from"./FIOVDIPM.js";import{j as Ii}from"./QZVUH6Z4.js";import{a as zn}from"./SHNRUDHL.js";import{D as Dn,E as rr,R as Fn,a as ot,c as Rn,j as Un,p as kr,t as kn}from"./SVGE6UYD.js";import{c as Gn}from"./QPPETRF6.js";import{d as In,e as Sn,f as Yt,g as _n,i as wn,k as Pn,m as Ur,n as Mn,p as Ln,r as Zt,t as je}from"./AA7KRV4Y.js";import{M as Qe,O as bn,P as Me,e as vn,p as Rr}from"./LVENEOJP.js";import{F as xn,G as Lr,J as Or,S as er,T as Cn,c as yn,e as ft,f as An,k as Tn,o as Ot,p as Xt,t as En}from"./CIA73AT4.js";import{a as Vt}from"./64D36THL.js";import{c as St,f as bt,h as z}from"./PQ35KENF.js";var Bi=St(pr=>{"use strict";var Di=Si();Object.defineProperty(pr,"__esModule",{value:!0});pr.default=void 0;var Fi=Di(_i()),Ni=Ii(),Hi=(0,Fi.default)((0,Ni.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");pr.default=Hi});var Do=St(hr=>{"use strict";hr.byteLength=ji;hr.toByteArray=Xi;hr.fromByteArray=Ji;var Nt=[],Pt=[],Qi=typeof Uint8Array<"u"?Uint8Array:Array,Xr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(me=0,Uo=Xr.length;me<Uo;++me)Nt[me]=Xr[me],Pt[Xr.charCodeAt(me)]=me;var me,Uo;Pt["-".charCodeAt(0)]=62;Pt["_".charCodeAt(0)]=63;function ko(a){var r=a.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=a.indexOf("=");o===-1&&(o=r);var e=o===r?0:4-o%4;return[o,e]}function ji(a){var r=ko(a),o=r[0],e=r[1];return(o+e)*3/4-e}function Ki(a,r,o){return(r+o)*3/4-o}function Xi(a){var r,o=ko(a),e=o[0],t=o[1],n=new Qi(Ki(a,e,t)),i=0,s=t>0?e-4:e,f;for(f=0;f<s;f+=4)r=Pt[a.charCodeAt(f)]<<18|Pt[a.charCodeAt(f+1)]<<12|Pt[a.charCodeAt(f+2)]<<6|Pt[a.charCodeAt(f+3)],n[i++]=r>>16&255,n[i++]=r>>8&255,n[i++]=r&255;return t===2&&(r=Pt[a.charCodeAt(f)]<<2|Pt[a.charCodeAt(f+1)]>>4,n[i++]=r&255),t===1&&(r=Pt[a.charCodeAt(f)]<<10|Pt[a.charCodeAt(f+1)]<<4|Pt[a.charCodeAt(f+2)]>>2,n[i++]=r>>8&255,n[i++]=r&255),n}function Yi(a){return Nt[a>>18&63]+Nt[a>>12&63]+Nt[a>>6&63]+Nt[a&63]}function Zi(a,r,o){for(var e,t=[],n=r;n<o;n+=3)e=(a[n]<<16&16711680)+(a[n+1]<<8&65280)+(a[n+2]&255),t.push(Yi(e));return t.join("")}function Ji(a){for(var r,o=a.length,e=o%3,t=[],n=16383,i=0,s=o-e;i<s;i+=n)t.push(Zi(a,i,i+n>s?s:i+n));return e===1?(r=a[o-1],t.push(Nt[r>>2]+Nt[r<<4&63]+"==")):e===2&&(r=(a[o-2]<<8)+a[o-1],t.push(Nt[r>>10]+Nt[r>>4&63]+Nt[r<<2&63]+"=")),t.join("")}});var Ho=St((sf,No)=>{function Mt(a,r){typeof r=="boolean"&&(r={forever:r}),this._originalTimeouts=JSON.parse(JSON.stringify(a)),this._timeouts=a,this._options=r||{},this._maxRetryTime=r&&r.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}No.exports=Mt;Mt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Mt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Mt.prototype.retry=function(a){if(this._timeout&&clearTimeout(this._timeout),!a)return!1;var r=new Date().getTime();if(a&&r-this._operationStart>=this._maxRetryTime)return this._errors.push(a),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(a);var o=this._timeouts.shift();if(o===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),o=this._cachedTimeouts.slice(-1);else return!1;var e=this;return this._timer=setTimeout(function(){e._attempts++,e._operationTimeoutCb&&(e._timeout=setTimeout(function(){e._operationTimeoutCb(e._attempts)},e._operationTimeout),e._options.unref&&e._timeout.unref()),e._fn(e._attempts)},o),this._options.unref&&this._timer.unref(),!0};Mt.prototype.attempt=function(a,r){this._fn=a,r&&(r.timeout&&(this._operationTimeout=r.timeout),r.cb&&(this._operationTimeoutCb=r.cb));var o=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){o._operationTimeoutCb()},o._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Mt.prototype.try=function(a){this.attempt(a)};Mt.prototype.start=function(a){this.attempt(a)};Mt.prototype.start=Mt.prototype.try;Mt.prototype.errors=function(){return this._errors};Mt.prototype.attempts=function(){return this._attempts};Mt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var a={},r=null,o=0,e=0;e<this._errors.length;e++){var t=this._errors[e],n=t.message,i=(a[n]||0)+1;a[n]=i,i>=o&&(r=t,o=i)}return r}});var Bo=St(he=>{var os=Ho();he.operation=function(a){var r=he.timeouts(a);return new os(r,{forever:a&&(a.forever||a.retries===1/0),unref:a&&a.unref,maxRetryTime:a&&a.maxRetryTime})};he.timeouts=function(a){if(a instanceof Array)return[].concat(a);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var o in a)r[o]=a[o];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var e=[],t=0;t<r.retries;t++)e.push(this.createTimeout(t,r));return a&&a.forever&&!e.length&&e.push(this.createTimeout(t,r)),e.sort(function(n,i){return n-i}),e};he.createTimeout=function(a,r){var o=r.randomize?Math.random()+1:1,e=Math.round(o*Math.max(r.minTimeout,1)*Math.pow(r.factor,a));return e=Math.min(e,r.maxTimeout),e};he.wrap=function(a,r,o){if(r instanceof Array&&(o=r,r=null),!o){o=[];for(var e in a)typeof a[e]=="function"&&o.push(e)}for(var t=0;t<o.length;t++){var n=o[t],i=a[n];a[n]=function(f){var m=he.operation(r),c=Array.prototype.slice.call(arguments,1),l=c.pop();c.push(function(u){m.retry(u)||(u&&(arguments[0]=m.mainError()),l.apply(this,arguments))}),m.attempt(function(){f.apply(a,c)})}.bind(a,i),a[n].options=r}}});var qo=St((cf,Go)=>{Go.exports=Bo()});var Vo=St((lf,gr)=>{"use strict";var is=qo(),ss=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"],dr=class extends Error{constructor(r){super(),r instanceof Error?(this.originalError=r,{message:r}=r):(this.originalError=new Error(r),this.originalError.stack=this.stack),this.name="AbortError",this.message=r}},as=(a,r,o)=>{let e=o.retries-(r-1);return a.attemptNumber=r,a.retriesLeft=e,a},cs=a=>ss.includes(a),zo=(a,r)=>new Promise((o,e)=>{r={onFailedAttempt:()=>{},retries:10,...r};let t=is.operation(r);t.attempt(async n=>{try{o(await a(n))}catch(i){if(!(i instanceof Error)){e(new TypeError(`Non-error was thrown: "${i}". You should only throw errors.`));return}if(i instanceof dr)t.stop(),e(i.originalError);else if(i instanceof TypeError&&!cs(i.message))t.stop(),e(i);else{as(i,n,r);try{await r.onFailedAttempt(i)}catch(s){e(s);return}t.retry(i)||e(t.mainError())}}})});gr.exports=zo;gr.exports.default=zo;gr.exports.AbortError=dr});var $o=St((uf,Jr)=>{"use strict";var ls=Object.prototype.hasOwnProperty,Tt="~";function Ze(){}Object.create&&(Ze.prototype=Object.create(null),new Ze().__proto__||(Tt=!1));function us(a,r,o){this.fn=a,this.context=r,this.once=o||!1}function Wo(a,r,o,e,t){if(typeof o!="function")throw new TypeError("The listener must be a function");var n=new us(o,e||a,t),i=Tt?Tt+r:r;return a._events[i]?a._events[i].fn?a._events[i]=[a._events[i],n]:a._events[i].push(n):(a._events[i]=n,a._eventsCount++),a}function yr(a,r){--a._eventsCount===0?a._events=new Ze:delete a._events[r]}function gt(){this._events=new Ze,this._eventsCount=0}gt.prototype.eventNames=function(){var r=[],o,e;if(this._eventsCount===0)return r;for(e in o=this._events)ls.call(o,e)&&r.push(Tt?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(o)):r};gt.prototype.listeners=function(r){var o=Tt?Tt+r:r,e=this._events[o];if(!e)return[];if(e.fn)return[e.fn];for(var t=0,n=e.length,i=new Array(n);t<n;t++)i[t]=e[t].fn;return i};gt.prototype.listenerCount=function(r){var o=Tt?Tt+r:r,e=this._events[o];return e?e.fn?1:e.length:0};gt.prototype.emit=function(r,o,e,t,n,i){var s=Tt?Tt+r:r;if(!this._events[s])return!1;var f=this._events[s],m=arguments.length,c,l;if(f.fn){switch(f.once&&this.removeListener(r,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,o),!0;case 3:return f.fn.call(f.context,o,e),!0;case 4:return f.fn.call(f.context,o,e,t),!0;case 5:return f.fn.call(f.context,o,e,t,n),!0;case 6:return f.fn.call(f.context,o,e,t,n,i),!0}for(l=1,c=new Array(m-1);l<m;l++)c[l-1]=arguments[l];f.fn.apply(f.context,c)}else{var u=f.length,p;for(l=0;l<u;l++)switch(f[l].once&&this.removeListener(r,f[l].fn,void 0,!0),m){case 1:f[l].fn.call(f[l].context);break;case 2:f[l].fn.call(f[l].context,o);break;case 3:f[l].fn.call(f[l].context,o,e);break;case 4:f[l].fn.call(f[l].context,o,e,t);break;default:if(!c)for(p=1,c=new Array(m-1);p<m;p++)c[p-1]=arguments[p];f[l].fn.apply(f[l].context,c)}}return!0};gt.prototype.on=function(r,o,e){return Wo(this,r,o,e,!1)};gt.prototype.once=function(r,o,e){return Wo(this,r,o,e,!0)};gt.prototype.removeListener=function(r,o,e,t){var n=Tt?Tt+r:r;if(!this._events[n])return this;if(!o)return yr(this,n),this;var i=this._events[n];if(i.fn)i.fn===o&&(!t||i.once)&&(!e||i.context===e)&&yr(this,n);else{for(var s=0,f=[],m=i.length;s<m;s++)(i[s].fn!==o||t&&!i[s].once||e&&i[s].context!==e)&&f.push(i[s]);f.length?this._events[n]=f.length===1?f[0]:f:yr(this,n)}return this};gt.prototype.removeAllListeners=function(r){var o;return r?(o=Tt?Tt+r:r,this._events[o]&&yr(this,o)):(this._events=new Ze,this._eventsCount=0),this};gt.prototype.off=gt.prototype.removeListener;gt.prototype.addListener=gt.prototype.on;gt.prefixed=Tt;gt.EventEmitter=gt;typeof Jr<"u"&&(Jr.exports=gt)});var jo=St((ff,Qo)=>{"use strict";Qo.exports=(a,r)=>(r=r||(()=>{}),a.then(o=>new Promise(e=>{e(r())}).then(()=>o),o=>new Promise(e=>{e(r())}).then(()=>{throw o})))});var Xo=St((pf,Tr)=>{"use strict";var fs=jo(),Ar=class extends Error{constructor(r){super(r),this.name="TimeoutError"}},Ko=(a,r,o)=>new Promise((e,t)=>{if(typeof r!="number"||r<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(r===1/0){e(a);return}let n=setTimeout(()=>{if(typeof o=="function"){try{e(o())}catch(f){t(f)}return}let i=typeof o=="string"?o:`Promise timed out after ${r} milliseconds`,s=o instanceof Error?o:new Ar(i);typeof a.cancel=="function"&&a.cancel(),t(s)},r);fs(a.then(e,t),()=>{clearTimeout(n)})});Tr.exports=Ko;Tr.exports.default=Ko;Tr.exports.TimeoutError=Ar});var Yo=St(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});function ps(a,r,o){let e=0,t=a.length;for(;t>0;){let n=t/2|0,i=e+n;o(a[i],r)<=0?(e=++i,t-=n+1):t=n}return e}tn.default=ps});var Zo=St(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});var ms=Yo(),en=class{constructor(){this._queue=[]}enqueue(r,o){o=Object.assign({priority:0},o);let e={priority:o.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=o.priority){this._queue.push(e);return}let t=ms.default(this._queue,e,(n,i)=>i.priority-n.priority);this._queue.splice(t,0,e)}dequeue(){let r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(o=>o.priority===r.priority).map(o=>o.run)}get size(){return this._queue.length}};rn.default=en});var ti=St(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});var hs=$o(),Jo=Xo(),ds=Zo(),Er=()=>{},gs=new Jo.TimeoutError,nn=class extends hs{constructor(r){var o,e,t,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Er,this._resolveIdle=Er,r=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:ds.default},r),!(typeof r.intervalCap=="number"&&r.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(e=(o=r.intervalCap)===null||o===void 0?void 0:o.toString())!==null&&e!==void 0?e:""}\` (${typeof r.intervalCap})`);if(r.interval===void 0||!(Number.isFinite(r.interval)&&r.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(n=(t=r.interval)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:""}\` (${typeof r.interval})`);this._carryoverConcurrencyCount=r.carryoverConcurrencyCount,this._isIntervalIgnored=r.intervalCap===1/0||r.interval===0,this._intervalCap=r.intervalCap,this._interval=r.interval,this._queue=new r.queueClass,this._queueClass=r.queueClass,this.concurrency=r.concurrency,this._timeout=r.timeout,this._throwOnTimeout=r.throwOnTimeout===!0,this._isPaused=r.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Er,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Er,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let r=Date.now();if(this._intervalId===void 0){let o=this._intervalEnd-r;if(o<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},o)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let r=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let o=this._queue.dequeue();return o?(this.emit("active"),o(),r&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(r){if(!(typeof r=="number"&&r>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${r}\` (${typeof r})`);this._concurrency=r,this._processQueue()}async add(r,o={}){return new Promise((e,t)=>{let n=async()=>{this._pendingCount++,this._intervalCount++;try{let i=this._timeout===void 0&&o.timeout===void 0?r():Jo.default(Promise.resolve(r()),o.timeout===void 0?this._timeout:o.timeout,()=>{(o.throwOnTimeout===void 0?this._throwOnTimeout:o.throwOnTimeout)&&t(gs)});e(await i)}catch(i){t(i)}this._next()};this._queue.enqueue(n,o),this._tryToStartAnother(),this.emit("add")})}async addAll(r,o){return Promise.all(r.map(async e=>this.add(e,o)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(r=>{let o=this._resolveEmpty;this._resolveEmpty=()=>{o(),r()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(r=>{let o=this._resolveIdle;this._resolveIdle=()=>{o(),r()}})}get size(){return this._queue.size}sizeBy(r){return this._queue.filter(r).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(r){this._timeout=r}};on.default=nn});var Q=bt(Vt());var zr=bt(Vt());var uo=(a,r)=>{let o,e;return function(){let t=arguments,n=this;return o||(o=!0,setTimeout(()=>o=!1,r),e=a.apply(n,t)),e}};var Jt=bt(Vt());var wi=a=>{let[r,o]=(0,Jt.useState)(""),{currentAIProviderModelDetail:e}=lr(),t=(0,Jt.useMemo)(()=>{let i=e?.maxTokens||4e3;return Math.floor(i/1e3)*1e3},[e]),n=(0,Jt.useMemo)(()=>r.length>t,[r,t]);return(0,Jt.useEffect)(()=>{let i=s=>{s.startsWith("``NO_HISTORY_&#``\n")&&(s=s.replace("``NO_HISTORY_&#``\n","")),o(s)};return dt(a).subscribe(i),()=>{dt(a).unsubscribe(i)}},[]),{currentMaxInputLength:t,isError:n}},fo=wi;var Pi=()=>Math.max(Math.floor(window.innerHeight*.5/24)||5),Ue=24,Re=(a,r=0,o=0)=>{let e=a?.parentElement?.parentElement;if(a&&e){let t=window.getComputedStyle(a),n=parseInt(t.paddingTop,10)+parseInt(t.paddingBottom,10);a.style.cssText="height:0px";let i=a.value?a.scrollHeight:Ue+n,s=Math.min(Ue*Pi(),i);o===0&&(o=a?.previousElementSibling?.offsetHeight||0);let f=Math.max(Ue,o||0);s=Math.max(f,s),a.style.cssText=`height: ${s}px`;let m=s+r;e.style.cssText=`height: ${m}px`}},Mi=(a,r=0,o=0)=>{Re(a,r,o),setTimeout(()=>{Re(a,r,o);let e=a.value;a.focus(),a.setSelectionRange(e.length,e.length)},100)},te=(a,r=0,o=0)=>{let e="",t=document.querySelector('div[data-testid=sentinelStart][tabindex="0"]');if(t?.nextElementSibling&&t.nextElementSibling.getAttribute("tabindex")==="-1"&&(e="mui",t.nextElementSibling.removeAttribute("tabindex")),window.location.host==="www.linkedin.com"){let n=document.querySelector('div[tabindex="-1"][role="dialog"]');n&&(e="linkedin",n.removeAttribute("tabindex"),document.activeElement?.blur(),setTimeout(()=>{n.setAttribute("tabindex","-1")},100))}a.isSameNode(In())||a.isSameNode(Sn())||Mi(a,r,o)},Li=a=>{},Oi=a=>{let r=ft(er),o=ft(eo),e=ft(Le),{defaultValue:t,onChange:n,onEnter:i,onKeydown:s,loading:f,children:m,error:c=!1,InputId:l=Ot,stopPropagation:u=!0,placeholder:p="Ask AI...",expandNode:A,sx:C}=a,{isError:w}=fo(Xt===l?"floatingMenuInputMediator":"chatBoxInputMediator"),x=(0,Q.useRef)(null),D=(0,Q.useRef)(!1),L=(0,Q.useRef)(!1),[M,U]=(0,Q.useState)(t||""),E=(0,Q.useRef)(0),O=(0,Q.useRef)(0),g=(0,Q.useRef)(null),d=(0,Q.useRef)(null),v=(0,Q.useMemo)(()=>uo(Re,200),[]),b=T=>[E.current,O.current],I=(0,Q.useCallback)(T=>{let _=T.target.value;l===Ot?dt("chatBoxInputMediator").updateInputValue(_):l===Xt?dt("floatingMenuInputMediator").updateInputValue(_):U(_),n&&n(_,{includeHistory:!L.current})},[n]),S=(0,Q.useRef)({});return(0,Q.useEffect)(()=>{if(l===Ot){let T=(_,y)=>{y&&(S.current=y),_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),U(_)};return dt("chatBoxInputMediator").subscribe(T),()=>{dt("chatBoxInputMediator").unsubscribe(T)}}if(l===Xt){let T=_=>{_.startsWith("``NO_HISTORY_&#``\n")&&(_=_.replace("``NO_HISTORY_&#``\n",""),L.current=!0),U(_)};return dt("floatingMenuInputMediator").subscribe(T),()=>{dt("floatingMenuInputMediator").unsubscribe(T)}}return()=>{}},[]),(0,Q.useEffect)(()=>{L.current=!1,S.current={}},[e.loading]),(0,Q.useEffect)(()=>{v(x.current,...b("inputValue1")),setTimeout(()=>{x.current&&Re(x.current,...b("inputValue2"))},0)},[M]),(0,Q.useEffect)(()=>{let T=new ResizeObserver(y=>{for(let h of y)setTimeout(()=>{E.current=h.target?.offsetHeight||0,x.current&&Re(x.current,...b("children"))},100)}),_=new ResizeObserver(y=>{for(let h of y)setTimeout(()=>{O.current=h.target?.offsetHeight||0,x.current&&Re(x.current,...b("expand"))},100)});return d.current&&_.observe(d.current),g.current&&T.observe(g.current),()=>{T.disconnect(),_.disconnect()}},[]),(0,Q.useEffect)(()=>{o.open&&x.current&&l===Xt&&te(x.current,...b("floatingDropdownMenu"))},[o.open]),(0,Q.useEffect)(()=>{r.open&&x.current&&l===Ot&&!Oe()&&te(x.current,...b("appState"))},[r.open,f]),rr(()=>{l===Ot&&On()&&setTimeout(()=>{te(x.current,...b("appState"))},100)}),Q.default.createElement(Fr,{component:"div",className:f?"chat-box__input--loading":"",borderRadius:"8px",border:"1px solid",borderColor:`${w||c?"rgb(239, 83, 80)":"customColor.borderColor"}`,width:"100%",minHeight:34,sx:{display:"flex",alignItems:"center",flexDirection:"row",flexWrap:"wrap",overflow:"hidden","& .chat-box__input-skeleton":{opacity:0,zIndex:-1,position:"absolute",top:0,padding:"8px",left:0,width:"100%",display:"none"},"&.chat-box__input--loading":{maxHeight:"106.5px",overflow:"hidden",position:"relative","& textarea":{maxHeight:"30px",opacity:0},"& .chat-box__input-skeleton":{opacity:1,zIndex:1,display:"block"}},...C}},Q.default.createElement(Fr,{component:"div",className:"chat-box__input-skeleton"},Q.default.createElement(Zn,{height:Ue})),Q.default.createElement(ir,{alignItems:"start",width:"100%",direction:"row",sx:{"& > textarea":{p:1,color:T=>T.palette.mode==="dark"?"#fff":"rgba(0,0,0,.87)!important",my:1.5,fontSize:"16px",minHeight:Ue+"px",lineHeight:Ue+"px",background:"transparent!important",borderColor:"transparent!important",margin:"0!important",border:"0!important",outline:"0!important",boxShadow:"none!important",width:"100%",resize:"none",overflow:"hidden",overflowY:"auto",fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important',"&::-webkit-scrollbar":{width:0,background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"transparent"}}}},Q.default.createElement(ir,{ref:d,className:"max-ai-user-input__expand",sx:{"&:has(> div)":{py:1,pl:1},alignSelf:"end"}},A),Q.default.createElement("textarea",{id:l,placeholder:p,disabled:f,ref:x,value:M,rows:1,onCopy:T=>{T.stopPropagation()},onCut:T=>{T.stopPropagation()},onPaste:T=>{T.stopPropagation()},onKeyUp:T=>{u&&T.stopPropagation()},onKeyPress:T=>{u&&T.stopPropagation()},onKeyDown:T=>{if(u){if(T.key==="ArrowUp"||T.key==="ArrowDown"||T.key==="ArrowLeft"||T.key==="ArrowRight"||T.key==="Escape")return;T.stopPropagation()}if(!D.current){if(!(T.key==="Enter"&&T.shiftKey)){if(T.key==="Enter")i&&i(T.currentTarget.value,{includeHistory:!L.current,meta:S.current}),L.current=!1,S.current={},T.preventDefault();else if(T.code==="Space"){T.stopPropagation();return}}s&&s(T)}},onClick:T=>{te(T.currentTarget,...b("click"))},onCompositionUpdate:T=>{u&&T.stopPropagation()},onCompositionStart:T=>{u&&T.stopPropagation(),D.current=!0},onCompositionEnd:T=>{u&&T.stopPropagation(),D.current=!1,I(T)},onInput:T=>{u&&T.stopPropagation(),D.current?U(T.currentTarget.value):I(T)},onBlur:T=>{v(T.currentTarget,...b("blur")),Li(T.currentTarget)}})),Q.default.createElement(ir,{ref:g,width:"100%"},m))},ea=Oi;var wt=bt(Vt());var _t=bt(Vt());var ke=new Me({runtime:"client"}),Ri=()=>{let[a,r]=(0,_t.useState)([]),{currentAIProviderModelDetail:o,aiProvider:e}=lr(),{chatConversationId:t}=ft(qn),n=ft(sr),i=(0,_t.useRef)(!1),s=(0,_t.useMemo)(()=>o?.uploadFileConfig,[o]),f=(0,_t.useCallback)(async l=>{i.current=!0;let u=Qe(l).map(p=>(p.uploadStatus==="idle"&&(p.uploadStatus="uploading",p.uploadProgress=20),p));switch(r(u),e){case"OPENAI":await ke.postMessage({event:"Client_chatUploadFiles",data:{files:u}});break;case"BING":{let p=await Promise.all(l.map(async A=>{if(A.file&&fr(A.file)){let C=await co(A.file);C&&(A.base64Data=C)}return A}));await ke.postMessage({event:"Client_chatUploadFiles",data:{files:p}})}break;default:{let p=await Promise.all(l.map(async A=>{let C=await so(A.file),w=Qe(A);return w.file=C,w}));await ke.postMessage({event:"Client_chatUploadFiles",data:{files:p}})}break}setTimeout(()=>{i.current=!1},1e3)},[s,e]),m=(0,_t.useCallback)(async l=>{let u=await ke.postMessage({event:"Client_chatRemoveFiles",data:{files:l}});return r(u.data||[]),u.success},[s]),c=(0,_t.useMemo)(()=>{switch(e){case"OPENAI":return"File uploading. Please send your message once upload completes.";default:return"File uploading. Please send your message once upload completes."}return""},[e]);return(0,_t.useEffect)(()=>{let l=a.find(u=>u.uploadStatus==="error");if(l){switch(e){case"OPENAI":t&&!Xe(n,u=>u.messageId===l.id)&&Br("add",t,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:l.uploadErrorMessage==="Your previous upload didn't go through as the Code Interpreter was initializing. It's now ready for your file. Please try uploading it again."?"info":"error"}}]);break;default:t&&!Xe(n,u=>u.messageId===l.id)&&Br("add",t,0,[{messageId:l.id,text:l.uploadErrorMessage||`File ${l.fileName} upload error.`,type:"system",extra:{status:"error"}}])}m([l])}},[a,e]),Dn(()=>{ke.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{i.current||Rr(l.data)&&r(l.data)})}),rr(()=>{ke.postMessage({event:"Client_chatGetFiles",data:{}}).then(l=>{Rr(l.data)&&r(l.data)})}),Fn(async(l,u,p)=>{switch(l){case"Client_listenUploadFilesChange":{let{files:A}=u;return r(A),{success:!0,data:{},message:""}}default:break}}),{aiProviderUploadingTooltip:c,AIProviderConfig:s,aiProviderUploadFiles:f,aiProviderRemoveFiles:m,files:a}},po=Ri;var Ui=a=>{let{disabled:r=!1,TooltipProps:o,onUpload:e,onDone:t,...n}=a,{t:i}=Gn(["common","client"]),{files:s,AIProviderConfig:f,aiProviderUploadFiles:m,aiProviderRemoveFiles:c,aiProviderUploadingTooltip:l}=po(),u=ft(Bn),p=ft(Le),A=(0,wt.useRef)(null),C=f?.maxCount||1,w=f?.maxFileSize||5*1024*1024,x=(0,wt.useMemo)(()=>s.length>=(f?.maxCount||1),[s]),D=async L=>{let M=s?.length||0,U=C-M,E=L.target.files;if(!E||U===0)return;let O=Array.from(E);if(O=O.slice(0,U),O.length===0)return;let g=await Promise.all(O.map(async d=>{let v=fr(d),b="file",I="";v&&(b="image",I=await ur(d)||"");let S={id:ot(),file:d,fileName:d.name,fileSize:d.size,fileType:d.type,base64Data:I,blobUrl:URL.createObjectURL(d),uploadStatus:"idle",uploadErrorMessage:"",uploadProgress:0,icon:b};return w>0&&S.fileSize>w&&(S.uploadStatus="error",S.uploadErrorMessage=`Upload failed: ${S.fileName} exceeds the ${(w/1024/1024).toFixed(0)}MB limit. Please select a smaller file.`),S}));await m(s.concat(g)),A.current&&(A.current.value="")};return!f||u.status!=="success"||p.loading?wt.default.createElement(wt.default.Fragment,null):wt.default.createElement(lo,{files:s,loadingTooltipTitle:l,onRemove:async L=>{await c([L])},TooltipProps:o,...n},!x&&wt.default.createElement(Yn,{placement:"top",title:f?.acceptTooltip?f.acceptTooltip(i):"Upload file",...o},wt.default.createElement(Hn,{disabled:r,sx:{minWidth:"unset",p:0,my:"4px",color:"text.primary","&:hover":{color:"primary.main"}},onClick:()=>{A.current&&A.current.click()}},wt.default.createElement(to,{icon:"AddCircle",sx:{color:"inherit"}}))),wt.default.createElement("input",{multiple:C>1,onChange:D,ref:A,accept:f?.accept||"",hidden:!0,style:{display:"none"},type:"file"}))},Ma=Ui;var ho=(a,r,o,e)=>new Promise(t=>{let n=!1,i=setTimeout(()=>{n=!0,t(void 0)},e),s=setInterval(()=>{if(!n){let f=a.querySelector(r);f&&(clearInterval(s),clearTimeout(i),t(f))}},o)}),mo=(a,r,o,e,t)=>new Promise(n=>{let i=!1,s=setTimeout(()=>{i=!0,n(void 0)},e),f=setInterval(()=>{if(!i){let m=Array.from(a.querySelectorAll(r));if(t){let c=t(m);c&&(clearInterval(f),clearTimeout(s),n(c))}else m.length>0&&(clearInterval(f),clearTimeout(s),n(m[0]))}},o)}),ki=()=>new Promise(async a=>{let o=setTimeout(()=>{a({success:!1,error:"timeout"})},4e3),e=t=>{clearTimeout(o),a(t)};try{let t=document.getElementById(En)?.shadowRoot;if(t){let n=await mo(t,".usechatgpt-ai__context-menu--handle-button",200,2e3,i=>i.find(s=>window.getComputedStyle(s).opacity!=="0"));if(n){setTimeout(()=>{n.click()},100);let i=await mo(t,".floating-context-menu-item",50,2e3,s=>s.find(f=>f.innerText.startsWith("Run this prompt")));if(i){i.click(),e({success:!0,error:""});return}}}e({success:!1,error:"no context menu"})}catch(t){e({success:!1,error:t?.toString()||""})}}),Ra=ki;var Vr=class{constructor(){this.pending=new Map}async send(r,o,e=5*1e3){let t=ot(),n={...o,uuid:t};return new Promise((i,s)=>{let f=setTimeout(()=>{this.pending.delete(t),s(new Error("Timeout Error"))},e);this.pending.set(t,m=>{clearTimeout(f),i(m)}),window.dispatchEvent(new CustomEvent(r,{detail:n}))})}receive(r,o){window.addEventListener(r,async e=>{if(e instanceof CustomEvent&&e.detail&&e.detail.uuid){let{uuid:t,...n}=e.detail,i,s=o(n);s instanceof Promise?i=await s:i=s;let f=this.pending.get(t);f&&(f(i),this.pending.delete(t))}})}},go=new Vr;var Ve=bt(Vt());var Wr=class{constructor(r,o,e,t){this.id=r,this.type=o,this.status="idle",this.parameters=Object.assign({},e)||{},this.autoExecute=t}async execute(r,o){this.status="running",this.error="",this.output="",this.status="complete"}pushMessageToChat(r,o){if(o&&o.getChartGPT()?.pushMessage){let e=this.getCurrentConversationId(o);o.getChartGPT()?.pushMessage(r,e)}}reset(){this.status="idle",this.error="",this.output=""}getCurrentConversationId(r){return r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||""}getCurrentSidebarType(r){return r.getChartGPT()?.getSidebarRef()?.currentSidebarSettingsRef?.current?.type||"Chat"}getNextAction(r){return r?.getShortCutsEngine()?.getNextAction()}getPrevAction(r){return r?.getShortCutsEngine()?.getPrevAction()}async getCurrentConversation(r){let o=r.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current||"";return o?await Qn(o):null}async updateConversation(r,o){let e=this.getCurrentConversationId(r);await Xn(e,o)}},B=Wr;var Ye=(a,r)=>{try{return{data:a.replace(/\{\{(.+?)\}\}/g,(e,t)=>{let n=t.trim().split("."),i=r;for(;n.length;){let s=n.shift();if(Object.prototype.hasOwnProperty.call(i,s))i=i[s];else{i="";break}}return i}),error:""}}catch{return{data:"",error:"parse template error"}}};function j(){return function(a,r,o){let e=o.value;o.value=async function(...t){let[n]=t,i=this;if(i.parameters?.template){let s=Ye(i.parameters?.template||"",n);s.error?(i.error=s.error,i.parameters.compliedTemplate=""):i.parameters.compliedTemplate=s.data}await e.apply(this,t)}}}function W({onlySuccess:a,onlyError:r}={onlySuccess:!1,onlyError:!1}){return function(o,e,t){let n=t.value;t.value=async function(...i){let[,s]=i,f=this,m=await n.apply(this,i),c=s.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;return f.error&&!a?s.getChartGPT()?.pushMessage({type:"system",text:f.error,messageId:ot(),extra:{status:"error"},conversationId:c}):f.output&&!r&&s.getChartGPT()?.pushMessage({type:"system",text:f.output,messageId:ot(),extra:{status:"success"}},c),m}}}function Et(){return function(a,r,o){let e=o.value;o.value=async function(...t){let[,n]=t;n.getChartGPT()?.showLoading();let i=await e.apply(this,t);return n.getChartGPT()?.hideLoading(),i}}}function De(a=!0){return function(r,o,e){let t=e.value;e.value=async function(...n){let i=Oe(),s="chatBoxInputMediator";if(i&&(s="floatingMenuInputMediator"),a)return dt(s).updateInputValue(""),await t.apply(this,n);{let f=await t.apply(this,n);return dt(s).updateInputValue(""),f}}}}var ee=class extends B{static{this.type="GET_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=jn(`<html>${document?.documentElement?.innerHTML}</html>`).document,t=Kn(e);t?t.success?this.output=t?.body||"":this.error=t?.body||"":this.error="No webpage contents",this.output||(this.output="",this.error="No webpage contents")}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],ee.prototype,"execute",1);var re=class extends B{static{this.type="SET_VARIABLE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableName||this.parameters.Variable||"";if(!e){this.error="Action no variable name!";return}let t=o.getShortCutsEngine();t&&t.setVariable&&(t.setVariable(e,this.parameters?.WFFormValues?.Value||r.LAST_ACTION_OUTPUT||"",!0),this.output=r.LAST_ACTION_OUTPUT||"")}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],re.prototype,"execute",1);var Fe=class extends B{static{this.type="OPERATION_ELEMENT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getBackgroundConversation(),t=this.parameters.OperationElementConfig||r.OperationElementConfig;if(!e||!t){this.error="Action cannot execute!";return}let n=this.parameters.OperationElementTabID||r.OperationElementTabID,s=(await e.postMessage({event:"ShortCuts_OperationPageElement",data:{OperationElementConfig:t,OperationElementTabID:n}})).data;s?.success?(t.successMessage&&this.pushMessageToChat({type:"system",messageId:ot(),parentMessageId:"",text:t.successMessage,extra:{status:"info"}},o),t.actionType==="getText"?this.output=s.elementsInnerText:t.actionType==="getLink"&&(this.output=s.link)):t.errorMessage&&this.pushMessageToChat({type:"system",messageId:ot(),parentMessageId:"",text:t.errorMessage,extra:{status:"error"}},o)}catch(e){this.error=e.toString()}}};var Ne=class extends B{static{this.type="SCRIPTS_CONDITIONAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=!1,t=this.parameters.WFCondition||r.WFCondition||void 0,n=this.parameters.WFMatchTextCaseSensitive!==!1,i=this.parameters.WFFormValues?.Value||"",s=r.LAST_ACTION_OUTPUT||"",f=this.parameters.WFConditionalIfTrueActions||[],m=this.parameters.WFConditionalIfFalseActions||[];switch(vn(i)?s=JSON.parse(s||"{}"):!n&&typeof i=="string"&&typeof s=="string"&&(i=i.toLocaleLowerCase(),s=s.toLocaleLowerCase()),t){case"Equals":e=Un(i,s);break;case"Is Greater Than":e=Number(i)>Number(s);break;case"Is Less Than":e=Number(i)<Number(s);break;case"Contains":e=s.includes(String(i));break;case void 0:e=!s;break;default:break}if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(e?f:m,"after");else{this.error="no shortCutsEngine";return}}catch(e){this.error=e.toString()}}};var yo=bt(Vt());var $r=()=>{let a=ft(er),{currentSelection:r}=no(),o=ft(sr),e=ft(ro),t=ft(Cn);return(0,yo.useCallback)(()=>{let n="".replace(/<br\s*\/?>/gi,`
`).replace(/<\/?div[^>]*>/g,`
`).replace(/<[^>]+>/g,"").replace(/\u00ad/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/data:image\/(png|jpeg|gif);base64,\s?[A-Za-z0-9+/]+={0,2}/g,"").replace(/\n{3,}/g,`
`)||"",i=r?.selectionHTML||"",s=r?.selectionText||"",f=t.userSettings?.language||Lr;f===xn&&(f=Lr);let m={GMAIL_EMAIL_CONTEXT:"",GMAIL_DRAFT_CONTEXT:n,SELECTED_HTML:i,SELECTED_TEXT:s,USER_INPUT:Yt()?.querySelector(`#${Ot}`)?.value||"",LAST_AI_OUTPUT:Xe(o,l=>l.type==="ai")?.text||"",AI_RESPONSE_LANGUAGE:f,AI_OUTPUT_LANGUAGE:f,CURRENT_WEBSITE_DOMAIN:typeof window<"u"?window.location.hostname:"",CURRENT_WEBPAGE_URL:typeof window<"u"?window.location.href:"",CURRENT_WEBPAGE_TITLE:typeof window<"u"?document.title:"",POPUP_DRAFT:e||""},c=[];return Object.keys(m).forEach(l=>{c.push({key:l,value:m[l],overwrite:!0})}),{builtInParameters:m,parameters:c,shortCutsParameters:Object.values(c)}},[a.env,r,t.userSettings,e])};var Ao=bt(Vt());var ne=class extends B{static{this.type="SET_VARIABLES_MODAL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.SetVariablesModalConfig;if(!e){this.error="No config!";return}if(e.modelKey==="Sidebar"){let f=Yt();f&&await ho(f,"#max-ai__ai-provider-floating-button",100,5e3)}let t=o.getShortCutsEngine(),n=t.getVariables(),i=Qe(e);i.variables.map(f=>(f.defaultValue&&typeof f.defaultValue=="string"&&(f.defaultValue=Ye(f.defaultValue,n).data||""),f)),i.template=e.template||this.parameters?.compliedTemplate||"";let s=await go.send("SetVariablesModal",{task:"open",config:i},5*60*1e3);s.success?Object.keys(s.data).forEach(f=>{s.data[f]!==void 0&&t?.setVariable(f,s.data[f],!0)}):(this.error="User cancel!",t?.reset()),this.output=JSON.stringify(s.data)}catch(e){this.error=e.toString()}}};z([j()],ne.prototype,"execute",1);var oe=class extends B{static{this.type="SET_VARIABLE_MAP"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.VariableMap||{},t=o.getShortCutsEngine();t&&t.setVariable&&(Object.keys(e).forEach(n=>{e[n]!==void 0&&t?.setVariable(n,e[n],!0)}),this.output=JSON.stringify(e))}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],oe.prototype,"execute",1);var He=class extends B{static{this.type="URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.output=this.parameters.URLActionURL||this.parameters.LAST_ACTION_OUTPUT,this.output||(this.output="",this.error="No input url")}catch(e){this.error=e.toString()}}};var ie=class extends B{static{this.type="GET_CONTENTS_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.URLActionURL||r.URLActionURL||r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(e&&t){this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:ot(),extra:{status:"info"}},o);let n=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:e}});n.success?this.output=n?.data?.body||"":this.error=n?.data?.body||""}else this.error=`Could not fetch the page.
Make sure the URL is correct.`;this.output||(this.output="",this.error=`Could not fetch the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],ie.prototype,"execute",1);var se=class extends B{static{this.type="GET_CONTENTS_OF_SEARCH_ENGINE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.compliedTemplate||r.LAST_ACTION_OUTPUT||this.parameters?.URLSearchEngineParams?.q||this.parameters?.URLSearchEngineParams?.query||"",t=o.getBackgroundConversation();if(e&&t){this.pushMessageToChat({type:"system",text:`MaxAI.me extension is crawling this page: ${e}. Note that if the crawled text is too long, it'll be trimmed to the first 7,000 characters to fit the context limit.`,messageId:ot(),extra:{status:"info"}},o),e.startsWith('"')&&e.endsWith('"')&&(e=e.slice(1,-1));let n=this.parameters.URLSearchEngine||"yahoo",i=this.parameters.URLSearchEngineParams||{},s=this.getFullSearchURL(n,i,e),f=await t.postMessage({event:"ShortCuts_getContentOfSearchEngine",data:{URL:s}}),{status:m,html:c}=f.data||{};if(f.success&&m===200&&c){let l=this.getSearchResults({html:c,limit:Number(i?.limit||3),searchEngine:n});if(l.length<=0){this.output="",this.error="No search results found. Please try a different query.";return}else{this.output=JSON.stringify(l,null,2);return}}if(this.error="Failed to access the search page. Please try again.",m===301){this.output="",this.error=`<a href="${s}" target="_blank" style="color: inherit">Click here to pass the security check</a> and try again.`;return}}this.output||(this.output="",this.error=`Could not search the page.
Make sure the URL is correct.`)}catch(e){this.error=e.toString()}}getFullSearchURL(r,o,e){let t=zi(r,o?.region),n=qi(r,o,e);return`${t}?${n.toString()}`}getSearchResults({html:r,limit:o,searchEngine:e}){try{switch(e){case"yahoo":{let t=Gr.load(r),n=[],i=t("#right .searchRightTop");if(i.length){let s=i.find(".compText a").first(),m=i.find(".compInfo li").map((c,l)=>t(l).text().trim()).get().join(`
`);n.push({title:s.text().trim(),body:`${i.find(".compText").text().trim()}${m?`

${m}`:""}`,url:this.extractRealUrl(s.attr("href")??"")})}return t('.algo-sr:not([class*="ad"])').slice(0,o).each((s,f)=>{let m=t(f),c=m.find("h3.title a");n.push({title:c.attr("aria-label")??"",body:m.find(".compText").text().trim(),url:this.extractRealUrl(c.attr("href")??"")})}),n}case"google":{let t=Gr.load(r),n=[],i=t("#rhs");if(i&&i.length){let s=i.find('h2[data-attrid="title"]').text().trim(),f=i.find(".kno-rdesc a[href]"),m=i.find("div.wp-ms").text().trim();n.push({title:s,body:m,url:this.extractRealUrl(f.attr("href")??"")})}return t("#search #rso > div").filter((s,f)=>!!t(f).find("a > h3").text()).slice(0,o).each((s,f)=>{let m=t(f),c=m.find("a > h3");n.push({title:c.text().trim()??"",body:m.find("div.MUxGbd").text().trim(),url:this.extractRealUrl(c.closest("a").attr("href")??"")})}),n}default:return[]}}catch{return[]}}extractRealUrl(r){let o=r.match(/RU=([^/]+)/);return o&&o[1]?decodeURIComponent(o[1]):r}};z([W({onlyError:!0})],se.prototype,"execute",1);function qi(a,r,o){let e={...r};delete e.limit;let t=o||e.query;return e.region&&e.region!=="wt-wt"&&(a==="google"?t=`location:${e.region} ${t}`:t=`${e.region} ${t}`,delete e.region),a==="yahoo"&&(e.p=t),new URLSearchParams({...e,q:t})}function zi(a,r="wt-wt"){switch(a){case"google":return"https://www.google.com/search";case"yahoo":return"https://search.yahoo.com/search";case"baidu":return"https://www.baidu.com/s";case"bing":return"https://www.bing.com/search";case"duckduckgo":return"https://duckduckgo.com";case"reddit":return"https://www.reddit.com/search";case"twitter":return"https://twitter.com/search";case"youtube":return"https://www.youtube.com/results";case"amazon":return"https://www.amazon.com/s";default:return"https://search.yahoo.com/search"}}var Be=class extends B{static{this.type="FETCH_ACTIONS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=o.getShortCutsEngine(),t=await oo(this.parameters.template||"");e.pushActions(t,"after"),this.output=r.LAST_AI_OUTPUT||""}catch(e){this.error=e.toString()}}};var ae=class extends B{static{this.type="GET_YOUTUBE_TRANSCRIPT_OF_URL"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=window.location.href.includes("youtube.com")?window.location.href:"",t=this.parameters.URLActionURL||e||"";if(!t){this.error="Youtube URL is empty.";return}let n=await Rt.fetchTranscript(t);if((n.length<=10?n.map(s=>s.text).join("").trim()==="":!1)&&t&&t.startsWith("https://")){let s=await Vn(t,{parse:"text"});s.success&&s.data&&(n=[{start:"",duration:"",text:await ar()}])}if(n.length>0){let s=await Rt.transcriptFormat(n),{getChartGPT:f,getShortCutsEngine:m}=o;if(m()?.getNextAction?.()?.type==="ASK_CHATGPT"){let c=o.getChartGPT()?.getSidebarRef()?.currentConversationIdRef?.current;await f()?.updateConversation({meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
\`\`\`
${s}
\`\`\``}},c)}this.output=s}}catch(e){this.error=e.toString()}}};z([j(),W({onlyError:!0}),Et()],ae.prototype,"execute",1);var Ge=class extends B{static{this.type="OPEN_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",t=r.URLActionActiveTab||this.parameters.URLActionActiveTab;if(!e){this.error="No open url";return}e==="current_page"?this.output=await Ur({key:"current_page"})||void 0:this.output=await Ur({url:e,active:t})||void 0}catch(e){this.error=e.toString()}}};var qe=class extends B{static{this.type="CLOSE_URLS"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.OperationElementTabID||this.parameters.OperationElementTabID,t=r.URLActionURL||this.parameters.URLActionURL||r.LAST_ACTION_OUTPUT||"",n=await Mn({tabId:e,url:t});n?.success||(this.error=n?.message)}catch(e){this.error=e.toString()}}};var ce=class extends B{static{this.type="GET_READABILITY_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=await cr()||await ar();this.output=e}catch(e){this.error=e.toString()}}};z([j(),W({onlyError:!0}),Et()],ce.prototype,"execute",1);var le=class extends B{static{this.type="GET_EMAIL_CONTENTS_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await cr()||await $n(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),W({onlyError:!0}),Et()],le.prototype,"execute",1);var ue=class extends B{static{this.type="GET_EMAIL_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";if(e){let t=await Wn(e);this.output=t}else this.output=""}catch(e){this.error=e.toString()}}};z([j(),W({onlyError:!0}),Et()],ue.prototype,"execute",1);var Vi=a=>{if(a.length>0){let r=[];a.forEach((t,n)=>{let{content:i,author:s}=t;r.push({text:`[Comment ${n+1}]
**Author:** ${s}
**Comment:**
${i}`,data:t})});let o=r[r.length-1],e=r.slice(0,r.length-1);return{last:o,lastText:r[r.length-1].text,previous:e,previousText:e.map(t=>t.text).join(`

`),fullText:r.join(`

`)}}return null},et=class{constructor(r,o){this.commentList=[];let{postTitle:e="Post",postContentTagName:t="Post caption/description",meta:n={}}=o||{};this.config={postTitle:e,postContentTagName:t,meta:n},this.post=r}static get emptyData(){return{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:"",SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:"",postText:""}}addCommentList(r){this.commentList.push(r)}get data(){let{content:r,author:o,title:e}=this.post,t=Vi(this.commentList?.[0]||[]),n="";return n+=`[${this.config.postTitle}]`,n+=`
**Post author:** ${o||"N/A"}`,n+=`
**Post title:** ${e||"N/A"}`,n+=`
**${this.config.postContentTagName}:**
${r||"N/A"}`,Object.keys(this.config.meta||{}).forEach(i=>{n+=`
**${i}:**
${this.config.meta?.[i]||"N/A"}`}),t?.lastText?{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.lastText,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.previousText?`${n}

${t.previousText}

${t.lastText}`:`${n}

${t.lastText}`,post:this.post,postText:n,replyCommentText:t.last.text,replyComment:t.last.data,previousComments:this.commentList?.[0]||[],previousCommentsText:t.previousText}:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:n,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:n,post:this.post,postText:n,previousComments:this.commentList?.[0]||[],previousCommentsText:t?.previousText}}};var Ut=(a,r)=>new Promise(o=>setTimeout(()=>{if(r){let t=window.innerHeight/10;r.scrollIntoView(!1),window.scrollBy(0,t)}o(!0)},a)),it=(a,r,o=20)=>{let e=r,t=0;for(;t<o&&!e.querySelector(a);)e=e?.parentElement,t++;return e.querySelector(a)||null},lt=(a,r,o=20)=>{let e=r,t=0;for(;t<o&&!e.matches(a);)e=e?.parentElement,t++;return e.matches(a)?e:null};var To=a=>{let r=a.querySelector('div[data-testid="User-Name"]'),[o,e]=kn(Array.from(r?.querySelectorAll("span")).map(i=>i.textContent||"").filter(i=>i&&i!=="\xB7")),t=a.querySelector("time")?.dateTime||"",n=a.querySelector('div[data-testid="tweetText"]').innerText;return{author:`${o}(${e})`,date:t,content:n,title:""}},Eo=async a=>{let r=it('article[data-testid="tweet"]',a);if(r){let o=[],e=lt('div[data-testid="cellInnerDiv"]',r,5);for(;e;){if(e?.getAttribute("data-testid")==="cellInnerDiv"){let t=e.querySelector('article[data-testid="tweet"]');t&&o.splice(0,0,To(t))}e=e.previousElementSibling}if(o.length>0){let t=o.shift(),n=new et(t);return n.addCommentList(o),n.data}else return new et(To(r)).data}return et.emptyData},xo=a=>it("div.DraftEditor-editorContainer",a,30)?.innerText||"",Zl=a=>{let r=Array.from(document.querySelectorAll('div[role="progressbar"]')),o=null;for(let e=0;e<r.length;e++){let t=r[e];if(t.parentElement?.contains(a)){o=t.parentElement;break}}return o};var Co=async a=>{let r=(a.querySelector("span.comments-post-meta__name span:not(.visually-hidden)")?.innerText||"").split(`
`)[0],o=a.querySelector("time")?.innerText||"",e=a.querySelector("& > .comments-reply-item-content-body button.see-more");e&&(e.click(),await Ut(100));let t=a.querySelector("& > div.comments-comment-item-content-body")?.innerText||a.querySelector("& > div.comments-reply-item-content-body")?.innerText;return{author:r||"",date:o||"",content:t||""}},vo=async a=>{let r=it(".comments-comment-box",a),o=it(".social-details-social-activity",r);if(r&&o){let e=it(".feed-shared-update-v2__description-wrapper",r);if(e){let t=e?.parentElement,n=t?.querySelector('button[role="button"].see-more');n&&(n.click(),await Ut(100,a));let i=t?.querySelector(".update-components-actor__name span:not(.visually-hidden)")?.textContent||"",s=e?.innerText||"",f=(t?.querySelector("div.ml4.mt2.text-body-xsmall")?.innerText||"").split("\u2022")?.[0],m=new et({author:i,content:s,title:"",date:f});if(r.parentElement?.classList.contains("comments-comment-item__nested-items")){let c=[],l=lt("article.comments-comment-item",a),p=l?.querySelector('div.editor-content div[contenteditable="true"]')?.innerText||"";if(c.push(await Co(l)),p){let A=Array.from(l.querySelectorAll("article"));for(let C=0;C<A.length;C++){let w=A[C],x=await Co(w);if(p.startsWith(x.author)){c.push(x);break}}}await Ut(0,a),m.addCommentList(c)}return m.data}}return et.emptyData},bo=a=>it("div.ql-editor",a,30)?.innerText||"";var Qr=async a=>{let r=a?.querySelector("a > span > span")?.innerText||"",o=a?.querySelector("span[lang][dir]")?.innerText||"",e=Array.from(a?.querySelectorAll("a > span")),t=e[e.length-1]?.innerText||"";return{content:o,author:r,date:t}},Io=async a=>{let r=it('form[role="presentation"]',a),o=it('div[data-ad-preview="message"]',r,30),e=it("span:has(h3 > span)",r,30),t=e||it("span:has(h4 > div)",r,30),n=t?.innerText||"",i=e?t?.nextElementSibling?.querySelector("a")?.innerText:t?.parentElement?.nextElementSibling?.querySelectorAll("a")?.[1]?.innerText||"",s=o?.querySelector('div[dir] > div[role="button"]');s&&(s.click(),await Ut(100,a));let f=o?.innerText||"",m=[],c=new et({author:n,date:i,content:f,title:""});if(r){let u=r.querySelector('div[contenteditable="true"][role="textbox"]')?.innerText||"",p=lt("li",r,10);for(;p;){let A=p.childNodes[0];if(A){let C=await Qr(A);if(m.length===0&&!u.startsWith(C.author)&&p&&u){let w=Array.from(p.querySelectorAll("& > div > ul li > div"));for(let x=0;x<w.length;x++){let D=w[x],L=await Qr(D);if(u.startsWith(L.author)){m.push(L);break}}}if(m.splice(0,0,C),p?.parentElement){p=lt("li",p.parentElement,10);continue}}break}if(u.replace(`
`,"")&&!m.length){let A=it('div[role="article"]',r),C=await Qr(A);u.startsWith(C.author)&&m.push(C)}c.addCommentList(m)}return c.data},So=a=>it('div[contenteditable="true"]',a,30)?.innerText||"";var jr=async a=>{let r=a.querySelector("#header-author #author-text > span")?.innerText||"",o=a.querySelector("#header-author > yt-formatted-string")?.innerText||"",e=a?.querySelector("tp-yt-paper-button#expand");e&&(e.click(),await Ut(100));let t=a.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},_o=async a=>{try{let r=lt("ytd-commentbox",a),o=Rt.retrieveVideoId(window.location.href),e=null;if(o){let t=await Rt.transcriptFormat(await Rt.fetchTranscript(window.location.href),2048),n=document.querySelector("ytd-watch-metadata"),i=n?.querySelector("#title > h1")?.innerText||document.title,s=document.querySelector("ytd-video-owner-renderer"),f=s?.querySelector("yt-formatted-string")?.textContent,m=n?.querySelector("tp-yt-paper-button#expand");m&&(m.click(),await Ut(100,a));let c=s?.querySelector("a")?.getAttribute("href")?.includes("@")&&s?.querySelector("a")?.getAttribute("href")?.split("/")[1],l=n?.querySelector("#description #info-container yt-formatted-string > span:nth-child(3)")?.innerText||"",u=n?.querySelector("#description ytd-text-inline-expander yt-attributed-string")?.innerText||"";e=new et({title:i,author:`${f}(${c})`,date:l,content:u},{postTitle:"Video post",meta:{"Post video transcript":t}})}else if(window.location.href.startsWith("https://www.youtube.com/shorts")){let n=lt("ytd-reel-video-renderer",a,50)?.querySelector("ytd-reel-player-header-renderer");if(n){let i=n?.querySelector(".title > yt-formatted-string")?.innerText||"",s=n?.querySelector("ytd-channel-name #text-container yt-formatted-string")?.innerText||"";e=new et({title:i,author:s,date:"",content:""},{postTitle:"Video post"})}}if(r&&e){if(!lt("ytd-comment-simplebox-renderer",r,5)){let t=lt("ytd-comment-thread-renderer",r)?.querySelector("& > ytd-comment-renderer");if(t){let n=lt("ytd-comment-renderer",r);n&&(it("ytd-comment-replies-renderer",n,5)?.contains(n)&&!n.isSameNode(t)?e.addCommentList([await jr(t),await jr(n)]):e.addCommentList([await jr(t)]))}}return e.data}}catch{}return et.emptyData},wo=a=>it('div#contenteditable-root[contenteditable="true"]',a,30)?.innerText||"";var Kr=async a=>{let r=a.querySelector("#badge-name")?.innerText||a.querySelector("#name")?.innerText||"",o=a.querySelector("yt-formatted-string.published-time-text")?.innerText||"",e=a?.querySelector("ytcp-button#more");e&&(e.click(),await Ut(100));let t=a.querySelector("#content-text")?.innerText||"";return{author:r.replace(/\n/g,"").trim(),date:o,content:t}},Po=async a=>{try{let r=lt("ytcp-commentbox",a);if(!r)return et.emptyData;let o=lt("ytcp-comment-thread",r),e=o?.querySelector("ytcp-comment-button > a[href]"),t=Rt.retrieveVideoId(e?.href||""),n=null;if(t){let i=await Rt.transcriptFormat(await Rt.fetchTranscript(window.location.href),2048),s=o?.querySelector("#video-title > yt-formatted-string")?.innerText||"",f=document.querySelector("#entity-name")?.innerText,m="";n=new et({title:s,author:`${f}`,date:m,content:""},{postTitle:"Video post",meta:{"Post video transcript":i}})}if(r&&n){let i=lt("ytcp-comment-thread",r)?.querySelector("& > ytcp-comment");if(i){let s=lt("ytcp-comment",r);s&&(it("ytcp-comment-replies",s,5)?.contains(s)&&!s.isSameNode(i)?n.addCommentList([await Kr(i),await Kr(s)]):n.addCommentList([await Kr(i)]))}return n.data}}catch{}return et.emptyData},Mo=a=>it("textarea#textarea",a,30)?.innerText||"";var Lo=async a=>{let r=document.querySelector(a);if(!r)return et.emptyData;let o=Zt();return o==="twitter.com"?await Eo(r):o==="linkedin.com"?await vo(r):o==="facebook.com"?await Io(r):o==="youtube.com"?await _o(r):o==="studio.youtube.com"?await Po(r):et.emptyData},Oo=async a=>{let r=Zt(),o=document.querySelector(a);return o?r==="twitter.com"?xo(o):r==="linkedin.com"?bo(o):r==="facebook.com"?So(o):r==="youtube.com"?wo(o):r==="studio.youtube.com"?Mo(o):"":""};var fe=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_DRAFT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Oo(e);this.output=t}catch(t){this.error=t.toString()}}};z([j(),W({onlyError:!0}),Et()],fe.prototype,"execute",1);var pe=class extends B{static{this.type="GET_SOCIAL_MEDIA_POST_CONTENT_OF_WEBPAGE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){let e=this.parameters.OperationElementElementSelector||r.OperationElementElementSelector||"";try{let t=await Lo(e),n=o.getShortCutsEngine();n&&n.pushActions([{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{SOCIAL_MEDIA_TARGET_POST_OR_COMMENT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT,SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT:t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}}}],"after"),this.output=t.SOCIAL_MEDIA_TARGET_POST_OR_COMMENT_CONTEXT}catch(t){this.error=t.toString()}}};z([j(),W({onlyError:!0}),Et()],pe.prototype,"execute",1);var mr=class{constructor(r){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=r.pageContent?r.pageContent.toString():this.pageContent,this.metadata=r.metadata??{}}};var Wi=Object.defineProperty,$i=(a,r,o)=>r in a?Wi(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o,Ro=(a,r,o)=>($i(a,typeof r!="symbol"?r+"":r,o),o);var Fo=bt(Do(),1);function ts(a,r){let o=Array.from({length:a.length},(e,t)=>({start:t,end:t+1}));for(;o.length>1;){let e=null;for(let t=0;t<o.length-1;t++){let n=a.slice(o[t].start,o[t+1].end),i=r.get(n.join(","));i!=null&&(e==null||i<e[0])&&(e=[i,t])}if(e!=null){let t=e[1];o[t]={start:o[t].start,end:o[t+1].end},o.splice(t+1,1)}else break}return o}function es(a,r){return a.length===1?[r.get(a.join(","))]:ts(a,r).map(o=>r.get(a.slice(o.start,o.end).join(","))).filter(o=>o!=null)}function rs(a){return a.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Yr=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(a,r){this.patStr=a.pat_str;let o=a.bpe_ranks.split(`
`).filter(Boolean).reduce((e,t)=>{let[n,i,...s]=t.split(" "),f=Number.parseInt(i,10);return s.forEach((m,c)=>e[m]=f+c),e},{});for(let[e,t]of Object.entries(o)){let n=Fo.default.toByteArray(e);this.rankMap.set(n.join(","),t),this.textMap.set(t,n)}this.specialTokens={...a.special_tokens,...r},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,n])=>(e[n]=this.textEncoder.encode(t),e),{})}encode(a,r=[],o="all"){let e=new RegExp(this.patStr,"ug"),t=Yr.specialTokenRegex(Object.keys(this.specialTokens)),n=[],i=new Set(r==="all"?Object.keys(this.specialTokens):r),s=new Set(o==="all"?Object.keys(this.specialTokens).filter(m=>!i.has(m)):o);if(s.size>0){let m=Yr.specialTokenRegex([...s]),c=a.match(m);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let f=0;for(;;){let m=null,c=f;for(;t.lastIndex=c,m=t.exec(a),!(m==null||i.has(m[0]));)c=m.index+1;let l=m?.index??a.length;for(let p of a.substring(f,l).matchAll(e)){let A=this.textEncoder.encode(p[0]),C=this.rankMap.get(A.join(","));if(C!=null){n.push(C);continue}n.push(...es(A,this.rankMap))}if(m==null)break;let u=this.specialTokens[m[0]];n.push(u),f=m.index+m[0].length}return n}decode(a){let r=[],o=0;for(let n=0;n<a.length;++n){let i=a[n],s=this.textMap.get(i)??this.inverseSpecialTokens[i];s!=null&&(r.push(s),o+=s.length)}let e=new Uint8Array(o),t=0;for(let n of r)e.set(n,t),t+=n.length;return this.textDecoder.decode(e)}},Zr=Yr;Ro(Zr,"specialTokenRegex",a=>new RegExp(a.map(r=>rs(r)).join("|"),"g"));var ys=bt(Vo(),1),As=bt(ti(),1);var sn=class{constructor(r){if(Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),this.chunkSize=r?.chunkSize??this.chunkSize,this.chunkOverlap=r?.chunkOverlap??this.chunkOverlap,this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async createDocuments(r,o=[],e={}){let t=o.length>0?o:new Array(r.length).fill({}),{chunkHeader:n="",chunkOverlapHeader:i="(cont'd) ",appendChunkOverlapHeader:s=!1}=e,f=new Array;for(let m=0;m<r.length;m+=1){let c=r[m],l=1,u=null;for(let p of await this.splitText(c)){let A=n,C=0;if(u){let L=c.indexOf(p),M=c.indexOf(u)+u.length;C=(c.slice(M,L).match(/\n/g)||[]).length,s&&(A+=i)}l+=C;let w=(p.match(/\n/g)||[]).length,x=t[m].loc&&typeof t[m].loc=="object"?{...t[m].loc}:{};x.lines={from:l,to:l+w};let D={...t[m],loc:x};A+=p,f.push(new mr({pageContent:A,metadata:D})),l+=w,u=p}}return f}async splitDocuments(r,o={}){let e=r.filter(i=>i.pageContent!==void 0),t=e.map(i=>i.pageContent),n=e.map(i=>i.metadata);return this.createDocuments(t,n,o)}joinDocs(r,o){let e=r.join(o).trim();return e===""?null:e}mergeSplits(r,o){let e=[],t=[],n=0;for(let s of r){let f=s.length;if(n+f+(t.length>0?o.length:0)>this.chunkSize&&(n>this.chunkSize,t.length>0)){let m=this.joinDocs(t,o);for(m!==null&&e.push(m);n>this.chunkOverlap||n+f>this.chunkSize&&n>0;)n-=t[0].length,t.shift()}t.push(s),n+=f}let i=this.joinDocs(t,o);return i!==null&&e.push(i),e}};var xr=class extends sn{constructor(r){super(r),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=r?.separators??this.separators}async splitText(r){let o=[],e=this.separators[this.separators.length-1];for(let i of this.separators){if(i===""){e=i;break}if(r.includes(i)){e=i;break}}let t;e?t=r.split(e):t=r.split("");let n=[];for(let i of t)if(i.length<this.chunkSize)n.push(i);else{if(n.length){let f=this.mergeSplits(n,e);o.push(...f),n=[]}let s=await this.splitText(i);o.push(...s)}if(n.length){let i=this.mergeSplits(n,e);o.push(...i)}return o}};var ei=async(a,r=1e3)=>{try{let o=a;return{docs:await new xr({chunkSize:r}).createDocuments([o])}}catch{return{docs:[]}}};var Ts=6e3,an=async(a,r,o)=>{let e=ot(),t=[],{docs:n}=await ei(a,o);(r==="STUFF"||r==="REFINE")&&n.splice(1);let i="",s=Math.ceil(o/n.length);return n.length===1?t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${s} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${n[0].pageContent}
"""`}}):(n.forEach(({pageContent:f},m)=>{let c=f||"";c&&(t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (potentially just a portion of an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${s} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${c}
"""`}}),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_PART_${m}_ID_${e}`}}),i+=`{{SUMMARIZE_TEXT_PART_${m}_ID_${e}}}
`)}),t.push({type:"ASK_CHATGPT",parameters:{template:`Disregard any previous instructions.

I will give you text content (probably an article), you will write a concise summary of the text content. Keep the meaning the same. The summary must be ${o} characters (characters, not words) or less.
 
In your response, do not remind me of what I asked, do not explain, do not self reference, do not apologize, do not use variables or placeholders, do not include any generic filler phrases, do not quote your response, just output the summary be and nothing else.

Now, using the concepts above, summarize the following text in the same language variety or dialect as the original text:
"""
${i}
"""`}})),t.push({type:"SET_VARIABLE",parameters:{VariableName:`SUMMARIZE_TEXT_ID_${e}`}}),{variableName:`SUMMARIZE_TEXT_ID_${e}`,actions:t}},de=class extends B{static{this.type="SUMMARIZE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"",t=this.parameters.SummarizeActionType||"STUFF";if(!e){this.error="No text to summarize";return}let{actions:n}=await an(e,t,this.parameters.SliceTextActionType==="TOKENS"?await or(e,this.parameters.SliceTextActionTokens):this.parameters.SliceTextActionLength||Ts);if(o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(n.map(i=>({...i,parameters:{...i.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=""}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],de.prototype,"execute",1);var ge=class extends B{static{this.type="WEBGPT_SEARCH_RESULTS_EXPAND"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT,t=o.getBackgroundConversation();if(!e||!t){this.error="no search result";return}let n=JSON.parse(e),i=this.parameters.SummarizeActionType||"STUFF",s=await Promise.all(n.map(async c=>{try{let l=await t.postMessage({event:"ShortCuts_getContentOfURL",data:{URL:c.url}});return{...c,body:l?.data?.body||c.body||"",title:l?.data?.title||c.title||""}}catch{return{...c}}})),f="",m=[];for(let c=0;c<s.length;c++){let l=s[c];if(i==="NO_SUMMARIZE")m.push({type:"RENDER_TEMPLATE",parameters:{template:l.body}}),m.push({type:"SLICE_OF_TEXT",parameters:{SliceTextActionType:"TOKENS",SliceTextActionTokens:Math.ceil(Dr*Nn/s.length)}}),m.push({type:"SET_VARIABLE",parameters:{VariableName:`SLICE_OF_TEXT_${c}`}}),f+=`NUMBER:${c+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: {{SLICE_OF_TEXT_${c}}}

`;else{let u=await or(l.body,Dr/s.length),{actions:p,variableName:A}=await an(l.body,i,u);m.push(...p),f+=`NUMBER:${c+1}
URL: ${l.url}
TITLE: ${l.title}
CONTENT: {{${A}}}

`}}if(m.push({type:"RENDER_TEMPLATE",parameters:{template:f}}),o.getShortCutsEngine())o.getShortCutsEngine()?.pushActions(m.map(c=>({...c,parameters:{...c.parameters,AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}})),"after");else{this.error="no shortCutsEngine";return}this.output=f}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],ge.prototype,"execute",1);var ye=class extends B{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="WEBGPT_ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ASK_CHAT_GPT";this.question=o.LAST_ACTION_OUTPUT;let n=t==="ASK_CHAT_GPT_REPLACEMENT",i;n&&e.getShortCutsEngine()?.actions.find(c=>c.message?.messageId?(i=c.message,!0):!1);let{success:s,answer:f,message:m}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT,parentMessageId:""},{includeHistory:!1,regenerate:!1,hiddenInChat:t==="ASK_CHAT_GPT_HIDDEN",replaceMessage:i})||{success:!1,answer:""};s?(this.output=f,this.message=m):(this.output="",this.error=f||"ask chatgpt error")}catch(t){this.error=t.toString()}}reset(){super.reset(),this.question="",this.message=void 0}};z([j(),De(!1)],ye.prototype,"execute",1);var Es=6e3,Ae=class extends B{static{this.type="SLICE_OF_TEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=r.LAST_ACTION_OUTPUT||"";if(!e){this.output="";return}if(this.parameters.SliceTextActionType==="TOKENS"||this.parameters.SliceTextActionTokens)this.output=await Ke(e,this.parameters.SliceTextActionTokens||4096);else{let t=this.parameters.SliceTextActionLength||Es;this.output=e.slice(0,t)}}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],Ae.prototype,"execute",1);var ri=new Me,ni=async a=>(await ri.postMessage({event:"WebsiteContext_createWebsiteContext",data:{websiteContext:{url:window.location.href||location.href||document.location.href,host:Zt(),html:document.documentElement.outerHTML,...a}}})).data;var oi=async(a,r)=>a.id?(await ri.postMessage({event:"WebsiteContext_updateWebsiteContext",data:{query:a,websiteContext:r}})).success:!1;function xs(a,r){return r.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(e){if(e!=="default"&&!(e in a)){var t=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(a,e,t.get?t:{enumerable:!0,get:function(){return o[e]}})}})}),Object.freeze(a)}function si(a,r){return new Promise(function(o,e){let t;return Cs(a).then(function(n){try{return t=n,o(new Blob([r.slice(0,2),t,r.slice(2)],{type:"image/jpeg"}))}catch(i){return e(i)}},e)})}var Cs=a=>new Promise((r,o)=>{let e=new FileReader;e.addEventListener("load",({target:{result:t}})=>{let n=new DataView(t),i=0;if(n.getUint16(i)!==65496)return o("not a valid JPEG");for(i+=2;;){let s=n.getUint16(i);if(s===65498)break;let f=n.getUint16(i+2);if(s===65505&&n.getUint32(i+4)===1165519206){let m=i+10,c;switch(n.getUint16(m)){case 18761:c=!0;break;case 19789:c=!1;break;default:return o("TIFF header contains invalid endian")}if(n.getUint16(m+2,c)!==42)return o("TIFF header contains invalid version");let l=n.getUint32(m+4,c),u=m+l+2+12*n.getUint16(m+l,c);for(let p=m+l+2;p<u;p+=12)if(n.getUint16(p,c)==274){if(n.getUint16(p+2,c)!==3)return o("Orientation data type is invalid");if(n.getUint32(p+4,c)!==1)return o("Orientation data count is invalid");n.setUint16(p+8,1,c);break}return r(t.slice(i,i+2+f))}i+=2+f}return r(new Blob)}),e.readAsArrayBuffer(a)}),vr={},vs={get exports(){return vr},set exports(a){vr=a}};(function(a){var r,o,e={};vs.exports=e,e.parse=function(t,n){for(var i=e.bin.readUshort,s=e.bin.readUint,f=0,m={},c=new Uint8Array(t),l=c.length-4;s(c,l)!=101010256;)l--;f=l,f+=4;var u=i(c,f+=4);i(c,f+=2);var p=s(c,f+=2),A=s(c,f+=4);f+=4,f=A;for(var C=0;C<u;C++){s(c,f),f+=4,f+=4,f+=4,s(c,f+=4),p=s(c,f+=4);var w=s(c,f+=4),x=i(c,f+=4),D=i(c,f+2),L=i(c,f+4);f+=6;var M=s(c,f+=8);f+=4,f+=x+D+L,e._readLocal(c,M,m,p,w,n)}return m},e._readLocal=function(t,n,i,s,f,m){var c=e.bin.readUshort,l=e.bin.readUint;l(t,n),c(t,n+=4),c(t,n+=2);var u=c(t,n+=2);l(t,n+=2),l(t,n+=4),n+=4;var p=c(t,n+=8),A=c(t,n+=2);n+=2;var C=e.bin.readUTF8(t,n,p);if(n+=p,n+=A,m)i[C]={size:f,csize:s};else{var w=new Uint8Array(t.buffer,n);if(u==0)i[C]=new Uint8Array(w.buffer.slice(n,n+s));else{if(u!=8)throw"unknown compression method: "+u;var x=new Uint8Array(f);e.inflateRaw(w,x),i[C]=x}}},e.inflateRaw=function(t,n){return e.F.inflate(t,n)},e.inflate=function(t,n){return t[0],t[1],e.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-6),n)},e.deflate=function(t,n){n==null&&(n={level:6});var i=0,s=new Uint8Array(50+Math.floor(1.1*t.length));s[i]=120,s[i+1]=156,i+=2,i=e.F.deflateRaw(t,s,i,n.level);var f=e.adler(t,0,t.length);return s[i+0]=f>>>24&255,s[i+1]=f>>>16&255,s[i+2]=f>>>8&255,s[i+3]=f>>>0&255,new Uint8Array(s.buffer,0,i+4)},e.deflateRaw=function(t,n){n==null&&(n={level:6});var i=new Uint8Array(50+Math.floor(1.1*t.length)),s=e.F.deflateRaw(t,i,s,n.level);return new Uint8Array(i.buffer,0,s)},e.encode=function(t,n){n==null&&(n=!1);var i=0,s=e.bin.writeUint,f=e.bin.writeUshort,m={};for(var c in t){var l=!e._noNeed(c)&&!n,u=t[c],p=e.crc.crc(u,0,u.length);m[c]={cpr:l,usize:u.length,crc:p,file:l?e.deflateRaw(u):u}}for(var c in m)i+=m[c].file.length+30+46+2*e.bin.sizeUTF8(c);i+=22;var A=new Uint8Array(i),C=0,w=[];for(var c in m){var x=m[c];w.push(C),C=e._writeHeader(A,C,c,x,0)}var D=0,L=C;for(var c in m)x=m[c],w.push(C),C=e._writeHeader(A,C,c,x,1,w[D++]);var M=C-L;return s(A,C,101010256),C+=4,f(A,C+=4,D),f(A,C+=2,D),s(A,C+=2,M),s(A,C+=4,L),C+=4,C+=2,A.buffer},e._noNeed=function(t){var n=t.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(n)!=-1},e._writeHeader=function(t,n,i,s,f,m){var c=e.bin.writeUint,l=e.bin.writeUshort,u=s.file;return c(t,n,f==0?67324752:33639248),n+=4,f==1&&(n+=2),l(t,n,20),l(t,n+=2,0),l(t,n+=2,s.cpr?8:0),c(t,n+=2,0),c(t,n+=4,s.crc),c(t,n+=4,u.length),c(t,n+=4,s.usize),l(t,n+=4,e.bin.sizeUTF8(i)),l(t,n+=2,0),n+=2,f==1&&(n+=2,n+=2,c(t,n+=6,m),n+=4),n+=e.bin.writeUTF8(t,n,i),f==0&&(t.set(u,n),n+=u.length),n},e.crc={table:function(){for(var t=new Uint32Array(256),n=0;n<256;n++){for(var i=n,s=0;s<8;s++)1&i?i=3988292384^i>>>1:i>>>=1;t[n]=i}return t}(),update:function(t,n,i,s){for(var f=0;f<s;f++)t=e.crc.table[255&(t^n[i+f])]^t>>>8;return t},crc:function(t,n,i){return 4294967295^e.crc.update(4294967295,t,n,i)}},e.adler=function(t,n,i){for(var s=1,f=0,m=n,c=n+i;m<c;){for(var l=Math.min(m+5552,c);m<l;)f+=s+=t[m++];s%=65521,f%=65521}return f<<16|s},e.bin={readUshort:function(t,n){return t[n]|t[n+1]<<8},writeUshort:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255},readUint:function(t,n){return 16777216*t[n+3]+(t[n+2]<<16|t[n+1]<<8|t[n])},writeUint:function(t,n,i){t[n]=255&i,t[n+1]=i>>8&255,t[n+2]=i>>16&255,t[n+3]=i>>24&255},readASCII:function(t,n,i){for(var s="",f=0;f<i;f++)s+=String.fromCharCode(t[n+f]);return s},writeASCII:function(t,n,i){for(var s=0;s<i.length;s++)t[n+s]=i.charCodeAt(s)},pad:function(t){return t.length<2?"0"+t:t},readUTF8:function(t,n,i){for(var s,f="",m=0;m<i;m++)f+="%"+e.bin.pad(t[n+m].toString(16));try{s=decodeURIComponent(f)}catch{return e.bin.readASCII(t,n,i)}return s},writeUTF8:function(t,n,i){for(var s=i.length,f=0,m=0;m<s;m++){var c=i.charCodeAt(m);if(!(4294967168&c))t[n+f]=c,f++;else if(!(4294965248&c))t[n+f]=192|c>>6,t[n+f+1]=128|c>>0&63,f+=2;else if(!(4294901760&c))t[n+f]=224|c>>12,t[n+f+1]=128|c>>6&63,t[n+f+2]=128|c>>0&63,f+=3;else{if(4292870144&c)throw"e";t[n+f]=240|c>>18,t[n+f+1]=128|c>>12&63,t[n+f+2]=128|c>>6&63,t[n+f+3]=128|c>>0&63,f+=4}}return f},sizeUTF8:function(t){for(var n=t.length,i=0,s=0;s<n;s++){var f=t.charCodeAt(s);if(!(4294967168&f))i++;else if(!(4294965248&f))i+=2;else if(!(4294901760&f))i+=3;else{if(4292870144&f)throw"e";i+=4}}return i}},e.F={},e.F.deflateRaw=function(t,n,i,s){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][s],m=e.F.U,c=e.F._goodIndex;e.F._hash;var l=e.F._putsE,u=0,p=i<<3,A=0,C=t.length;if(s==0){for(;u<C;)l(n,p,u+(b=Math.min(65535,C-u))==C?1:0),p=e.F._copyExact(t,u,b,n,p+8),u+=b;return p>>>3}var w=m.lits,x=m.strt,D=m.prev,L=0,M=0,U=0,E=0,O=0,g=0;for(C>2&&(x[g=e.F._hash(t,0)]=0),u=0;u<C;u++){if(O=g,u+1<C-2){g=e.F._hash(t,u+1);var d=u+1&32767;D[d]=x[g],x[g]=d}if(A<=u){(L>14e3||M>26697)&&C-u>100&&(A<u&&(w[L]=u-A,L+=2,A=u),p=e.F._writeBlock(u==C-1||A==C?1:0,w,L,E,t,U,u-U,n,p),L=M=E=0,U=u);var v=0;u<C-2&&(v=e.F._bestMatch(t,u,D,O,Math.min(f[2],C-u),f[3]));var b=v>>>16,I=65535&v;if(v!=0){I=65535&v;var S=c(b=v>>>16,m.of0);m.lhst[257+S]++;var T=c(I,m.df0);m.dhst[T]++,E+=m.exb[S]+m.dxb[T],w[L]=b<<23|u-A,w[L+1]=I<<16|S<<8|T,L+=2,A=u+b}else m.lhst[t[u]]++;M++}}for(U==u&&t.length!=0||(A<u&&(w[L]=u-A,L+=2,A=u),p=e.F._writeBlock(1,w,L,E,t,U,u-U,n,p),L=0,M=0,L=M=E=0,U=u);7&p;)p++;return p>>>3},e.F._bestMatch=function(t,n,i,s,f,m){var c=32767&n,l=i[c],u=c-l+32768&32767;if(l==c||s!=e.F._hash(t,n-u))return 0;for(var p=0,A=0,C=Math.min(32767,n);u<=C&&--m!=0&&l!=c;){if(p==0||t[n+p]==t[n+p-u]){var w=e.F._howLong(t,n,u);if(w>p){if(A=u,(p=w)>=f)break;u+2<w&&(w=u+2);for(var x=0,D=0;D<w-2;D++){var L=n-u+D+32768&32767,M=L-i[L]+32768&32767;M>x&&(x=M,l=L)}}}u+=(c=l)-(l=i[c])+32768&32767}return p<<16|A},e.F._howLong=function(t,n,i){if(t[n]!=t[n-i]||t[n+1]!=t[n+1-i]||t[n+2]!=t[n+2-i])return 0;var s=n,f=Math.min(t.length,n+258);for(n+=3;n<f&&t[n]==t[n-i];)n++;return n-s},e.F._hash=function(t,n){return(t[n]<<8|t[n+1])+(t[n+2]<<4)&65535},e.saved=0,e.F._writeBlock=function(t,n,i,s,f,m,c,l,u){var p,A,C,w,x,D,L,M,U,E=e.F.U,O=e.F._putsF,g=e.F._putsE;E.lhst[256]++,A=(p=e.F.getTrees())[0],C=p[1],w=p[2],x=p[3],D=p[4],L=p[5],M=p[6],U=p[7];var d=32+(u+3&7?8-(u+3&7):0)+(c<<3),v=s+e.F.contSize(E.fltree,E.lhst)+e.F.contSize(E.fdtree,E.dhst),b=s+e.F.contSize(E.ltree,E.lhst)+e.F.contSize(E.dtree,E.dhst);b+=14+3*L+e.F.contSize(E.itree,E.ihst)+(2*E.ihst[16]+3*E.ihst[17]+7*E.ihst[18]);for(var I=0;I<286;I++)E.lhst[I]=0;for(I=0;I<30;I++)E.dhst[I]=0;for(I=0;I<19;I++)E.ihst[I]=0;var S=d<v&&d<b?0:v<b?1:2;if(O(l,u,t),O(l,u+1,S),u+=3,S==0){for(;7&u;)u++;u=e.F._copyExact(f,m,c,l,u)}else{var T,_;if(S==1&&(T=E.fltree,_=E.fdtree),S==2){e.F.makeCodes(E.ltree,A),e.F.revCodes(E.ltree,A),e.F.makeCodes(E.dtree,C),e.F.revCodes(E.dtree,C),e.F.makeCodes(E.itree,w),e.F.revCodes(E.itree,w),T=E.ltree,_=E.dtree,g(l,u,x-257),g(l,u+=5,D-1),g(l,u+=5,L-4),u+=4;for(var y=0;y<L;y++)g(l,u+3*y,E.itree[1+(E.ordr[y]<<1)]);u+=3*L,u=e.F._codeTiny(M,E.itree,l,u),u=e.F._codeTiny(U,E.itree,l,u)}for(var h=m,k=0;k<i;k+=2){for(var P=n[k],F=P>>>23,q=h+(8388607&P);h<q;)u=e.F._writeLit(f[h++],T,l,u);if(F!=0){var H=n[k+1],G=H>>16,N=H>>8&255,R=255&H;g(l,u=e.F._writeLit(257+N,T,l,u),F-E.of0[N]),u+=E.exb[N],O(l,u=e.F._writeLit(R,_,l,u),G-E.df0[R]),u+=E.dxb[R],h+=F}}u=e.F._writeLit(256,T,l,u)}return u},e.F._copyExact=function(t,n,i,s,f){var m=f>>>3;return s[m]=i,s[m+1]=i>>>8,s[m+2]=255-s[m],s[m+3]=255-s[m+1],m+=4,s.set(new Uint8Array(t.buffer,n,i),m),f+(i+4<<3)},e.F.getTrees=function(){for(var t=e.F.U,n=e.F._hufTree(t.lhst,t.ltree,15),i=e.F._hufTree(t.dhst,t.dtree,15),s=[],f=e.F._lenCodes(t.ltree,s),m=[],c=e.F._lenCodes(t.dtree,m),l=0;l<s.length;l+=2)t.ihst[s[l]]++;for(l=0;l<m.length;l+=2)t.ihst[m[l]]++;for(var u=e.F._hufTree(t.ihst,t.itree,7),p=19;p>4&&t.itree[1+(t.ordr[p-1]<<1)]==0;)p--;return[n,i,u,f,c,p,s,m]},e.F.getSecond=function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(t[i+1]);return n},e.F.nonZero=function(t){for(var n="",i=0;i<t.length;i+=2)t[i+1]!=0&&(n+=(i>>1)+",");return n},e.F.contSize=function(t,n){for(var i=0,s=0;s<n.length;s++)i+=n[s]*t[1+(s<<1)];return i},e.F._codeTiny=function(t,n,i,s){for(var f=0;f<t.length;f+=2){var m=t[f],c=t[f+1];s=e.F._writeLit(m,n,i,s);var l=m==16?2:m==17?3:7;m>15&&(e.F._putsE(i,s,c,l),s+=l)}return s},e.F._lenCodes=function(t,n){for(var i=t.length;i!=2&&t[i-1]==0;)i-=2;for(var s=0;s<i;s+=2){var f=t[s+1],m=s+3<i?t[s+3]:-1,c=s+5<i?t[s+5]:-1,l=s==0?-1:t[s-1];if(f==0&&m==f&&c==f){for(var u=s+5;u+2<i&&t[u+2]==f;)u+=2;(p=Math.min(u+1-s>>>1,138))<11?n.push(17,p-3):n.push(18,p-11),s+=2*p-2}else if(f==l&&m==f&&c==f){for(u=s+5;u+2<i&&t[u+2]==f;)u+=2;var p=Math.min(u+1-s>>>1,6);n.push(16,p-3),s+=2*p-2}else n.push(f,0)}return i>>>1},e.F._hufTree=function(t,n,i){var s=[],f=t.length,m=n.length,c=0;for(c=0;c<m;c+=2)n[c]=0,n[c+1]=0;for(c=0;c<f;c++)t[c]!=0&&s.push({lit:c,f:t[c]});var l=s.length,u=s.slice(0);if(l==0)return 0;if(l==1){var p=s[0].lit;return u=p==0?1:0,n[1+(p<<1)]=1,n[1+(u<<1)]=1,1}s.sort(function(M,U){return M.f-U.f});var A=s[0],C=s[1],w=0,x=1,D=2;for(s[0]={lit:-1,f:A.f+C.f,l:A,r:C,d:0};x!=l-1;)A=w!=x&&(D==l||s[w].f<s[D].f)?s[w++]:s[D++],C=w!=x&&(D==l||s[w].f<s[D].f)?s[w++]:s[D++],s[x++]={lit:-1,f:A.f+C.f,l:A,r:C};var L=e.F.setDepth(s[x-1],0);for(L>i&&(e.F.restrictDepth(u,i,L),L=i),c=0;c<l;c++)n[1+(u[c].lit<<1)]=u[c].d;return L},e.F.setDepth=function(t,n){return t.lit!=-1?(t.d=n,n):Math.max(e.F.setDepth(t.l,n+1),e.F.setDepth(t.r,n+1))},e.F.restrictDepth=function(t,n,i){var s=0,f=1<<i-n,m=0;for(t.sort(function(l,u){return u.d==l.d?l.f-u.f:u.d-l.d}),s=0;s<t.length&&t[s].d>n;s++){var c=t[s].d;t[s].d=n,m+=f-(1<<i-c)}for(m>>>=i-n;m>0;)(c=t[s].d)<n?(t[s].d++,m-=1<<n-c-1):s++;for(;s>=0;s--)t[s].d==n&&m<0&&(t[s].d--,m++);m!=0},e.F._goodIndex=function(t,n){var i=0;return n[16|i]<=t&&(i|=16),n[8|i]<=t&&(i|=8),n[4|i]<=t&&(i|=4),n[2|i]<=t&&(i|=2),n[1|i]<=t&&(i|=1),i},e.F._writeLit=function(t,n,i,s){return e.F._putsF(i,s,n[t<<1]),s+n[1+(t<<1)]},e.F.inflate=function(t,n){var i=Uint8Array;if(t[0]==3&&t[1]==0)return n||new i(0);var s=e.F,f=s._bitsF,m=s._bitsE,c=s._decodeTiny,l=s.makeCodes,u=s.codes2map,p=s._get17,A=s.U,C=n==null;C&&(n=new i(t.length>>>2<<3));for(var w,x,D=0,L=0,M=0,U=0,E=0,O=0,g=0,d=0,v=0;D==0;)if(D=f(t,v,1),L=f(t,v+1,2),v+=3,L!=0){if(C&&(n=e.F._check(n,d+(1<<17))),L==1&&(w=A.flmap,x=A.fdmap,O=511,g=31),L==2){M=m(t,v,5)+257,U=m(t,v+5,5)+1,E=m(t,v+10,4)+4,v+=14;for(var b=0;b<38;b+=2)A.itree[b]=0,A.itree[b+1]=0;var I=1;for(b=0;b<E;b++){var S=m(t,v+3*b,3);A.itree[1+(A.ordr[b]<<1)]=S,S>I&&(I=S)}v+=3*E,l(A.itree,I),u(A.itree,I,A.imap),w=A.lmap,x=A.dmap,v=c(A.imap,(1<<I)-1,M+U,t,v,A.ttree);var T=s._copyOut(A.ttree,0,M,A.ltree);O=(1<<T)-1;var _=s._copyOut(A.ttree,M,U,A.dtree);g=(1<<_)-1,l(A.ltree,T),u(A.ltree,T,w),l(A.dtree,_),u(A.dtree,_,x)}for(;;){var y=w[p(t,v)&O];v+=15&y;var h=y>>>4;if(!(h>>>8))n[d++]=h;else{if(h==256)break;var k=d+h-254;if(h>264){var P=A.ldef[h-257];k=d+(P>>>3)+m(t,v,7&P),v+=7&P}var F=x[p(t,v)&g];v+=15&F;var q=F>>>4,H=A.ddef[q],G=(H>>>4)+f(t,v,15&H);for(v+=15&H,C&&(n=e.F._check(n,d+(1<<17)));d<k;)n[d]=n[d++-G],n[d]=n[d++-G],n[d]=n[d++-G],n[d]=n[d++-G];d=k}}}else{7&v&&(v+=8-(7&v));var N=4+(v>>>3),R=t[N-4]|t[N-3]<<8;C&&(n=e.F._check(n,d+R)),n.set(new i(t.buffer,t.byteOffset+N,R),d),v=N+R<<3,d+=R}return n.length==d?n:n.slice(0,d)},e.F._check=function(t,n){var i=t.length;if(n<=i)return t;var s=new Uint8Array(Math.max(i<<1,n));return s.set(t,0),s},e.F._decodeTiny=function(t,n,i,s,f,m){for(var c=e.F._bitsE,l=e.F._get17,u=0;u<i;){var p=t[l(s,f)&n];f+=15&p;var A=p>>>4;if(A<=15)m[u]=A,u++;else{var C=0,w=0;A==16?(w=3+c(s,f,2),f+=2,C=m[u-1]):A==17?(w=3+c(s,f,3),f+=3):A==18&&(w=11+c(s,f,7),f+=7);for(var x=u+w;u<x;)m[u]=C,u++}}return f},e.F._copyOut=function(t,n,i,s){for(var f=0,m=0,c=s.length>>>1;m<i;){var l=t[m+n];s[m<<1]=0,s[1+(m<<1)]=l,l>f&&(f=l),m++}for(;m<c;)s[m<<1]=0,s[1+(m<<1)]=0,m++;return f},e.F.makeCodes=function(t,n){for(var i,s,f,m,c=e.F.U,l=t.length,u=c.bl_count,p=0;p<=n;p++)u[p]=0;for(p=1;p<l;p+=2)u[t[p]]++;var A=c.next_code;for(i=0,u[0]=0,s=1;s<=n;s++)i=i+u[s-1]<<1,A[s]=i;for(f=0;f<l;f+=2)(m=t[f+1])!=0&&(t[f]=A[m],A[m]++)},e.F.codes2map=function(t,n,i){for(var s=t.length,f=e.F.U.rev15,m=0;m<s;m+=2)if(t[m+1]!=0)for(var c=m>>1,l=t[m+1],u=c<<4|l,p=n-l,A=t[m]<<p,C=A+(1<<p);A!=C;)i[f[A]>>>15-n]=u,A++},e.F.revCodes=function(t,n){for(var i=e.F.U.rev15,s=15-n,f=0;f<t.length;f+=2){var m=t[f]<<n-t[f+1];t[f]=i[m]>>>s}},e.F._putsE=function(t,n,i){i<<=7&n;var s=n>>>3;t[s]|=i,t[s+1]|=i>>>8},e.F._putsF=function(t,n,i){i<<=7&n;var s=n>>>3;t[s]|=i,t[s+1]|=i>>>8,t[s+2]|=i>>>16},e.F._bitsE=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8)>>>(7&n)&(1<<i)-1},e.F._bitsF=function(t,n,i){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)&(1<<i)-1},e.F._get17=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16)>>>(7&n)},e.F._get25=function(t,n){return(t[n>>>3]|t[1+(n>>>3)]<<8|t[2+(n>>>3)]<<16|t[3+(n>>>3)]<<24)>>>(7&n)},e.F.U=(r=Uint16Array,o=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var t=e.F.U,n=0;n<32768;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,t.rev15[n]=(i>>>16|i<<16)>>>17}function s(f,m,c){for(;m--!=0;)f.push(0,c)}for(n=0;n<32;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];s(t.fltree,144,8),s(t.fltree,112,9),s(t.fltree,24,7),s(t.fltree,8,8),e.F.makeCodes(t.fltree,9),e.F.codes2map(t.fltree,9,t.flmap),e.F.revCodes(t.fltree,9),s(t.fdtree,32,5),e.F.makeCodes(t.fdtree,5),e.F.codes2map(t.fdtree,5,t.fdmap),e.F.revCodes(t.fdtree,5),s(t.itree,19,0),s(t.ltree,286,0),s(t.dtree,30,0),s(t.ttree,320,0)}()})();var bs=xs({__proto__:null,default:vr},[vr]),kt=function(){var a={nextZero(c,l){for(;c[l]!=0;)l++;return l},readUshort:(c,l)=>c[l]<<8|c[l+1],writeUshort(c,l,u){c[l]=u>>8&255,c[l+1]=255&u},readUint:(c,l)=>16777216*c[l]+(c[l+1]<<16|c[l+2]<<8|c[l+3]),writeUint(c,l,u){c[l]=u>>24&255,c[l+1]=u>>16&255,c[l+2]=u>>8&255,c[l+3]=255&u},readASCII(c,l,u){let p="";for(let A=0;A<u;A++)p+=String.fromCharCode(c[l+A]);return p},writeASCII(c,l,u){for(let p=0;p<u.length;p++)c[l+p]=u.charCodeAt(p)},readBytes(c,l,u){let p=[];for(let A=0;A<u;A++)p.push(c[l+A]);return p},pad:c=>c.length<2?`0${c}`:c,readUTF8(c,l,u){let p,A="";for(let C=0;C<u;C++)A+=`%${a.pad(c[l+C].toString(16))}`;try{p=decodeURIComponent(A)}catch{return a.readASCII(c,l,u)}return p}};function r(c,l,u,p){let A=l*u,C=n(p),w=Math.ceil(l*C/8),x=new Uint8Array(4*A),D=new Uint32Array(x.buffer),{ctype:L}=p,{depth:M}=p,U=a.readUshort;if(L==6){let P=A<<2;if(M==8)for(var E=0;E<P;E+=4)x[E]=c[E],x[E+1]=c[E+1],x[E+2]=c[E+2],x[E+3]=c[E+3];if(M==16)for(E=0;E<P;E++)x[E]=c[E<<1]}else if(L==2){let P=p.tabs.tRNS;if(P==null){if(M==8)for(E=0;E<A;E++){var O=3*E;D[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O]}if(M==16)for(E=0;E<A;E++)O=6*E,D[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O]}else{var g=P[0];let F=P[1],q=P[2];if(M==8)for(E=0;E<A;E++){var d=E<<2;O=3*E,D[E]=255<<24|c[O+2]<<16|c[O+1]<<8|c[O],c[O]==g&&c[O+1]==F&&c[O+2]==q&&(x[d+3]=0)}if(M==16)for(E=0;E<A;E++)d=E<<2,O=6*E,D[E]=255<<24|c[O+4]<<16|c[O+2]<<8|c[O],U(c,O)==g&&U(c,O+2)==F&&U(c,O+4)==q&&(x[d+3]=0)}}else if(L==3){let P=p.tabs.PLTE,F=p.tabs.tRNS,q=F?F.length:0;if(M==1)for(var v=0;v<u;v++){var b=v*w,I=v*l;for(E=0;E<l;E++){d=I+E<<2;var S=3*(T=c[b+(E>>3)]>>7-((7&E)<<0)&1);x[d]=P[S],x[d+1]=P[S+1],x[d+2]=P[S+2],x[d+3]=T<q?F[T]:255}}if(M==2)for(v=0;v<u;v++)for(b=v*w,I=v*l,E=0;E<l;E++)d=I+E<<2,S=3*(T=c[b+(E>>2)]>>6-((3&E)<<1)&3),x[d]=P[S],x[d+1]=P[S+1],x[d+2]=P[S+2],x[d+3]=T<q?F[T]:255;if(M==4)for(v=0;v<u;v++)for(b=v*w,I=v*l,E=0;E<l;E++)d=I+E<<2,S=3*(T=c[b+(E>>1)]>>4-((1&E)<<2)&15),x[d]=P[S],x[d+1]=P[S+1],x[d+2]=P[S+2],x[d+3]=T<q?F[T]:255;if(M==8)for(E=0;E<A;E++){var T;d=E<<2,S=3*(T=c[E]),x[d]=P[S],x[d+1]=P[S+1],x[d+2]=P[S+2],x[d+3]=T<q?F[T]:255}}else if(L==4){if(M==8)for(E=0;E<A;E++){d=E<<2;var _=c[y=E<<1];x[d]=_,x[d+1]=_,x[d+2]=_,x[d+3]=c[y+1]}if(M==16)for(E=0;E<A;E++){var y;d=E<<2,_=c[y=E<<2],x[d]=_,x[d+1]=_,x[d+2]=_,x[d+3]=c[y+2]}}else if(L==0)for(g=p.tabs.tRNS?p.tabs.tRNS:-1,v=0;v<u;v++){let P=v*w,F=v*l;if(M==1)for(var h=0;h<l;h++){var k=(_=255*(c[P+(h>>>3)]>>>7-(7&h)&1))==255*g?0:255;D[F+h]=k<<24|_<<16|_<<8|_}else if(M==2)for(h=0;h<l;h++)k=(_=85*(c[P+(h>>>2)]>>>6-((3&h)<<1)&3))==85*g?0:255,D[F+h]=k<<24|_<<16|_<<8|_;else if(M==4)for(h=0;h<l;h++)k=(_=17*(c[P+(h>>>1)]>>>4-((1&h)<<2)&15))==17*g?0:255,D[F+h]=k<<24|_<<16|_<<8|_;else if(M==8)for(h=0;h<l;h++)k=(_=c[P+h])==g?0:255,D[F+h]=k<<24|_<<16|_<<8|_;else if(M==16)for(h=0;h<l;h++)_=c[P+(h<<1)],k=U(c,P+(h<<1))==g?0:255,D[F+h]=k<<24|_<<16|_<<8|_}return x}function o(c,l,u,p){let A=n(c),C=Math.ceil(u*A/8),w=new Uint8Array((C+1+c.interlace)*p);return l=c.tabs.CgBI?t(l,w):e(l,w),c.interlace==0?l=i(l,c,0,u,p):c.interlace==1&&(l=function(D,L){let M=L.width,U=L.height,E=n(L),O=E>>3,g=Math.ceil(M*E/8),d=new Uint8Array(U*g),v=0,b=[0,0,4,0,2,0,1],I=[0,4,0,2,0,1,0],S=[8,8,8,4,4,2,2],T=[8,8,4,4,2,2,1],_=0;for(;_<7;){let h=S[_],k=T[_],P=0,F=0,q=b[_];for(;q<U;)q+=h,F++;let H=I[_];for(;H<M;)H+=k,P++;let G=Math.ceil(P*E/8);i(D,L,v,P,F);let N=0,R=b[_];for(;R<U;){let V=I[_],J=v+N*G<<3;for(;V<M;){var y;if(E==1&&(y=(y=D[J>>3])>>7-(7&J)&1,d[R*g+(V>>3)]|=y<<7-((7&V)<<0)),E==2&&(y=(y=D[J>>3])>>6-(7&J)&3,d[R*g+(V>>2)]|=y<<6-((3&V)<<1)),E==4&&(y=(y=D[J>>3])>>4-(7&J)&15,d[R*g+(V>>1)]|=y<<4-((1&V)<<2)),E>=8){let K=R*g+V*O;for(let $=0;$<O;$++)d[K+$]=D[(J>>3)+$]}J+=E,V+=k}N++,R+=h}P*F!=0&&(v+=F*(1+G)),_+=1}return d}(l,c)),l}function e(c,l){return t(new Uint8Array(c.buffer,2,c.length-6),l)}var t=function(){let c={H:{}};return c.H.N=function(l,u){let p=Uint8Array,A,C,w=0,x=0,D=0,L=0,M=0,U=0,E=0,O=0,g=0;if(l[0]==3&&l[1]==0)return u||new p(0);let d=c.H,v=d.b,b=d.e,I=d.R,S=d.n,T=d.A,_=d.Z,y=d.m,h=u==null;for(h&&(u=new p(l.length>>>2<<5));w==0;)if(w=v(l,g,1),x=v(l,g+1,2),g+=3,x!=0){if(h&&(u=c.H.W(u,O+(1<<17))),x==1&&(A=y.J,C=y.h,U=511,E=31),x==2){D=b(l,g,5)+257,L=b(l,g+5,5)+1,M=b(l,g+10,4)+4,g+=14;let P=1;for(var k=0;k<38;k+=2)y.Q[k]=0,y.Q[k+1]=0;for(k=0;k<M;k++){let H=b(l,g+3*k,3);y.Q[1+(y.X[k]<<1)]=H,H>P&&(P=H)}g+=3*M,S(y.Q,P),T(y.Q,P,y.u),A=y.w,C=y.d,g=I(y.u,(1<<P)-1,D+L,l,g,y.v);let F=d.V(y.v,0,D,y.C);U=(1<<F)-1;let q=d.V(y.v,D,L,y.D);E=(1<<q)-1,S(y.C,F),T(y.C,F,A),S(y.D,q),T(y.D,q,C)}for(;;){let P=A[_(l,g)&U];g+=15&P;let F=P>>>4;if(!(F>>>8))u[O++]=F;else{if(F==256)break;{let q=O+F-254;if(F>264){let V=y.q[F-257];q=O+(V>>>3)+b(l,g,7&V),g+=7&V}let H=C[_(l,g)&E];g+=15&H;let G=H>>>4,N=y.c[G],R=(N>>>4)+v(l,g,15&N);for(g+=15&N;O<q;)u[O]=u[O++-R],u[O]=u[O++-R],u[O]=u[O++-R],u[O]=u[O++-R];O=q}}}}else{7&g&&(g+=8-(7&g));let P=4+(g>>>3),F=l[P-4]|l[P-3]<<8;h&&(u=c.H.W(u,O+F)),u.set(new p(l.buffer,l.byteOffset+P,F),O),g=P+F<<3,O+=F}return u.length==O?u:u.slice(0,O)},c.H.W=function(l,u){let p=l.length;if(u<=p)return l;let A=new Uint8Array(p<<1);return A.set(l,0),A},c.H.R=function(l,u,p,A,C,w){let x=c.H.e,D=c.H.Z,L=0;for(;L<p;){let M=l[D(A,C)&u];C+=15&M;let U=M>>>4;if(U<=15)w[L]=U,L++;else{let E=0,O=0;U==16?(O=3+x(A,C,2),C+=2,E=w[L-1]):U==17?(O=3+x(A,C,3),C+=3):U==18&&(O=11+x(A,C,7),C+=7);let g=L+O;for(;L<g;)w[L]=E,L++}}return C},c.H.V=function(l,u,p,A){let C=0,w=0,x=A.length>>>1;for(;w<p;){let D=l[w+u];A[w<<1]=0,A[1+(w<<1)]=D,D>C&&(C=D),w++}for(;w<x;)A[w<<1]=0,A[1+(w<<1)]=0,w++;return C},c.H.n=function(l,u){let p=c.H.m,A=l.length,C,w,x,D,L=p.j;for(var M=0;M<=u;M++)L[M]=0;for(M=1;M<A;M+=2)L[l[M]]++;let U=p.K;for(C=0,L[0]=0,w=1;w<=u;w++)C=C+L[w-1]<<1,U[w]=C;for(x=0;x<A;x+=2)D=l[x+1],D!=0&&(l[x]=U[D],U[D]++)},c.H.A=function(l,u,p){let A=l.length,C=c.H.m.r;for(let w=0;w<A;w+=2)if(l[w+1]!=0){let x=w>>1,D=l[w+1],L=x<<4|D,M=u-D,U=l[w]<<M,E=U+(1<<M);for(;U!=E;)p[C[U]>>>15-u]=L,U++}},c.H.l=function(l,u){let p=c.H.m.r,A=15-u;for(let C=0;C<l.length;C+=2){let w=l[C]<<u-l[C+1];l[C]=p[w]>>>A}},c.H.M=function(l,u,p){p<<=7&u;let A=u>>>3;l[A]|=p,l[A+1]|=p>>>8},c.H.I=function(l,u,p){p<<=7&u;let A=u>>>3;l[A]|=p,l[A+1]|=p>>>8,l[A+2]|=p>>>16},c.H.e=function(l,u,p){return(l[u>>>3]|l[1+(u>>>3)]<<8)>>>(7&u)&(1<<p)-1},c.H.b=function(l,u,p){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)&(1<<p)-1},c.H.Z=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16)>>>(7&u)},c.H.i=function(l,u){return(l[u>>>3]|l[1+(u>>>3)]<<8|l[2+(u>>>3)]<<16|l[3+(u>>>3)]<<24)>>>(7&u)},c.H.m=function(){let l=Uint16Array,u=Uint32Array;return{K:new l(16),j:new l(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new l(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new u(32),J:new l(512),_:[],h:new l(32),$:[],w:new l(32768),C:[],v:[],d:new l(32768),D:[],u:new l(512),Q:[],r:new l(32768),s:new u(286),Y:new u(30),a:new u(19),t:new u(15e3),k:new l(65536),g:new l(32768)}}(),function(){let l=c.H.m;for(var u=0;u<32768;u++){let A=u;A=(2863311530&A)>>>1|(1431655765&A)<<1,A=(3435973836&A)>>>2|(858993459&A)<<2,A=(4042322160&A)>>>4|(252645135&A)<<4,A=(4278255360&A)>>>8|(16711935&A)<<8,l.r[u]=(A>>>16|A<<16)>>>17}function p(A,C,w){for(;C--!=0;)A.push(0,w)}for(u=0;u<32;u++)l.q[u]=l.S[u]<<3|l.T[u],l.c[u]=l.p[u]<<4|l.z[u];p(l._,144,8),p(l._,112,9),p(l._,24,7),p(l._,8,8),c.H.n(l._,9),c.H.A(l._,9,l.J),c.H.l(l._,9),p(l.$,32,5),c.H.n(l.$,5),c.H.A(l.$,5,l.h),c.H.l(l.$,5),p(l.Q,19,0),p(l.C,286,0),p(l.D,30,0),p(l.v,320,0)}(),c.H.N}();function n(c){return[1,null,3,1,2,null,4][c.ctype]*c.depth}function i(c,l,u,p,A){let C=n(l),w=Math.ceil(p*C/8),x,D;C=Math.ceil(C/8);let L=c[u],M=0;if(L>1&&(c[u]=[0,0,1][L-2]),L==3)for(M=C;M<w;M++)c[M+1]=c[M+1]+(c[M+1-C]>>>1)&255;for(let U=0;U<A;U++)if(x=u+U*w,D=x+U+1,L=c[D-1],M=0,L==0)for(;M<w;M++)c[x+M]=c[D+M];else if(L==1){for(;M<C;M++)c[x+M]=c[D+M];for(;M<w;M++)c[x+M]=c[D+M]+c[x+M-C]}else if(L==2)for(;M<w;M++)c[x+M]=c[D+M]+c[x+M-w];else if(L==3){for(;M<C;M++)c[x+M]=c[D+M]+(c[x+M-w]>>>1);for(;M<w;M++)c[x+M]=c[D+M]+(c[x+M-w]+c[x+M-C]>>>1)}else{for(;M<C;M++)c[x+M]=c[D+M]+s(0,c[x+M-w],0);for(;M<w;M++)c[x+M]=c[D+M]+s(c[x+M-C],c[x+M-w],c[x+M-C-w])}return c}function s(c,l,u){let p=c+l-u,A=p-c,C=p-l,w=p-u;return A*A<=C*C&&A*A<=w*w?c:C*C<=w*w?l:u}function f(c,l,u){u.width=a.readUint(c,l),l+=4,u.height=a.readUint(c,l),l+=4,u.depth=c[l],l++,u.ctype=c[l],l++,u.compress=c[l],l++,u.filter=c[l],l++,u.interlace=c[l],l++}function m(c,l,u,p,A,C,w,x,D){let L=Math.min(l,A),M=Math.min(u,C),U=0,E=0;for(let _=0;_<M;_++)for(let y=0;y<L;y++)if(w>=0&&x>=0?(U=_*l+y<<2,E=(x+_)*A+w+y<<2):(U=(-x+_)*l-w+y<<2,E=_*A+y<<2),D==0)p[E]=c[U],p[E+1]=c[U+1],p[E+2]=c[U+2],p[E+3]=c[U+3];else if(D==1){var O=c[U+3]*.00392156862745098,g=c[U]*O,d=c[U+1]*O,v=c[U+2]*O,b=p[E+3]*(1/255),I=p[E]*b,S=p[E+1]*b,T=p[E+2]*b;let h=1-O,k=O+b*h,P=k==0?0:1/k;p[E+3]=255*k,p[E+0]=(g+I*h)*P,p[E+1]=(d+S*h)*P,p[E+2]=(v+T*h)*P}else if(D==2)O=c[U+3],g=c[U],d=c[U+1],v=c[U+2],b=p[E+3],I=p[E],S=p[E+1],T=p[E+2],O==b&&g==I&&d==S&&v==T?(p[E]=0,p[E+1]=0,p[E+2]=0,p[E+3]=0):(p[E]=g,p[E+1]=d,p[E+2]=v,p[E+3]=O);else if(D==3){if(O=c[U+3],g=c[U],d=c[U+1],v=c[U+2],b=p[E+3],I=p[E],S=p[E+1],T=p[E+2],O==b&&g==I&&d==S&&v==T)continue;if(O<220&&b>20)return!1}return!0}return{decode:function(l){let u=new Uint8Array(l),p=8,A=a,C=A.readUshort,w=A.readUint,x={tabs:{},frames:[]},D=new Uint8Array(u.length),L,M=0,U=0,E=[137,80,78,71,13,10,26,10];for(var O=0;O<8;O++)if(u[O]!=E[O])throw"The input is not a PNG file!";for(;p<u.length;){let _=A.readUint(u,p);p+=4;let y=A.readASCII(u,p,4);if(p+=4,y=="IHDR")f(u,p,x);else if(y=="iCCP"){for(var g=p;u[g]!=0;)g++;A.readASCII(u,p,g-p),u[g+1];let h=u.slice(g+2,p+_),k=null;try{k=e(h)}catch{k=t(h)}x.tabs[y]=k}else if(y=="CgBI")x.tabs[y]=u.slice(p,p+4);else if(y=="IDAT"){for(O=0;O<_;O++)D[M+O]=u[p+O];M+=_}else if(y=="acTL")x.tabs[y]={num_frames:w(u,p),num_plays:w(u,p+4)},L=new Uint8Array(u.length);else if(y=="fcTL"){U!=0&&((T=x.frames[x.frames.length-1]).data=o(x,L.slice(0,U),T.rect.width,T.rect.height),U=0);let h={x:w(u,p+12),y:w(u,p+16),width:w(u,p+4),height:w(u,p+8)},k=C(u,p+22);k=C(u,p+20)/(k==0?100:k);let P={rect:h,delay:Math.round(1e3*k),dispose:u[p+24],blend:u[p+25]};x.frames.push(P)}else if(y=="fdAT"){for(O=0;O<_-4;O++)L[U+O]=u[p+O+4];U+=_-4}else if(y=="pHYs")x.tabs[y]=[A.readUint(u,p),A.readUint(u,p+4),u[p+8]];else if(y=="cHRM")for(x.tabs[y]=[],O=0;O<8;O++)x.tabs[y].push(A.readUint(u,p+4*O));else if(y=="tEXt"||y=="zTXt"){x.tabs[y]==null&&(x.tabs[y]={});var d=A.nextZero(u,p),v=A.readASCII(u,p,d-p),b=p+_-d-1;if(y=="tEXt")S=A.readASCII(u,d+1,b);else{var I=e(u.slice(d+2,d+2+b));S=A.readUTF8(I,0,I.length)}x.tabs[y][v]=S}else if(y=="iTXt"){x.tabs[y]==null&&(x.tabs[y]={}),d=0,g=p,d=A.nextZero(u,g),v=A.readASCII(u,g,d-g);let h=u[g=d+1];var S;u[g+1],g+=2,d=A.nextZero(u,g),A.readASCII(u,g,d-g),g=d+1,d=A.nextZero(u,g),A.readUTF8(u,g,d-g),b=_-((g=d+1)-p),h==0?S=A.readUTF8(u,g,b):(I=e(u.slice(g,g+b)),S=A.readUTF8(I,0,I.length)),x.tabs[y][v]=S}else if(y=="PLTE")x.tabs[y]=A.readBytes(u,p,_);else if(y=="hIST"){let h=x.tabs.PLTE.length/3;for(x.tabs[y]=[],O=0;O<h;O++)x.tabs[y].push(C(u,p+2*O))}else if(y=="tRNS")x.ctype==3?x.tabs[y]=A.readBytes(u,p,_):x.ctype==0?x.tabs[y]=C(u,p):x.ctype==2&&(x.tabs[y]=[C(u,p),C(u,p+2),C(u,p+4)]);else if(y=="gAMA")x.tabs[y]=A.readUint(u,p)/1e5;else if(y=="sRGB")x.tabs[y]=u[p];else if(y=="bKGD")x.ctype==0||x.ctype==4?x.tabs[y]=[C(u,p)]:x.ctype==2||x.ctype==6?x.tabs[y]=[C(u,p),C(u,p+2),C(u,p+4)]:x.ctype==3&&(x.tabs[y]=u[p]);else if(y=="IEND")break;p+=_,A.readUint(u,p),p+=4}var T;return U!=0&&((T=x.frames[x.frames.length-1]).data=o(x,L.slice(0,U),T.rect.width,T.rect.height)),x.data=o(x,D,x.width,x.height),delete x.compress,delete x.interlace,delete x.filter,x},toRGBA8:function(l){let u=l.width,p=l.height;if(l.tabs.acTL==null)return[r(l.data,u,p,l).buffer];let A=[];l.frames[0].data==null&&(l.frames[0].data=l.data);let C=u*p*4,w=new Uint8Array(C),x=new Uint8Array(C),D=new Uint8Array(C);for(let M=0;M<l.frames.length;M++){let U=l.frames[M],E=U.rect.x,O=U.rect.y,g=U.rect.width,d=U.rect.height,v=r(U.data,g,d,l);if(M!=0)for(var L=0;L<C;L++)D[L]=w[L];if(U.blend==0?m(v,g,d,w,u,p,E,O,0):U.blend==1&&m(v,g,d,w,u,p,E,O,1),A.push(w.buffer.slice(0)),U.dispose!=0){if(U.dispose==1)m(x,g,d,w,u,p,E,O,0);else if(U.dispose==2)for(L=0;L<C;L++)w[L]=D[L]}}return A},_paeth:s,_copyTile:m,_bin:a}}();(function(){let{_copyTile:a}=kt,{_bin:r}=kt,o=kt._paeth;var e={table:function(){let g=new Uint32Array(256);for(let d=0;d<256;d++){let v=d;for(let b=0;b<8;b++)1&v?v=3988292384^v>>>1:v>>>=1;g[d]=v}return g}(),update(g,d,v,b){for(let I=0;I<b;I++)g=e.table[255&(g^d[v+I])]^g>>>8;return g},crc:(g,d,v)=>4294967295^e.update(4294967295,g,d,v)};function t(g,d,v,b){d[v]+=g[0]*b>>4,d[v+1]+=g[1]*b>>4,d[v+2]+=g[2]*b>>4,d[v+3]+=g[3]*b>>4}function n(g){return Math.max(0,Math.min(255,g))}function i(g,d){let v=g[0]-d[0],b=g[1]-d[1],I=g[2]-d[2],S=g[3]-d[3];return v*v+b*b+I*I+S*S}function s(g,d,v,b,I,S,T){T==null&&(T=1);let _=b.length,y=[];for(var h=0;h<_;h++){let R=b[h];y.push([R>>>0&255,R>>>8&255,R>>>16&255,R>>>24&255])}for(h=0;h<_;h++){let R=4294967295;for(var k=0,P=0;P<_;P++){var F=i(y[h],y[P]);P!=h&&F<R&&(R=F,k=P)}}let q=new Uint32Array(I.buffer),H=new Int16Array(d*v*4),G=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(h=0;h<G.length;h++)G[h]=255*((G[h]+.5)/16-.5);for(let R=0;R<v;R++)for(let V=0;V<d;V++){var N;h=4*(R*d+V),T!=2?N=[n(g[h]+H[h]),n(g[h+1]+H[h+1]),n(g[h+2]+H[h+2]),n(g[h+3]+H[h+3])]:(F=G[4*(3&R)+(3&V)],N=[n(g[h]+F),n(g[h+1]+F),n(g[h+2]+F),n(g[h+3]+F)]),k=0;let J=16777215;for(P=0;P<_;P++){let X=i(N,y[P]);X<J&&(J=X,k=P)}let K=y[k],$=[N[0]-K[0],N[1]-K[1],N[2]-K[2],N[3]-K[3]];T==1&&(V!=d-1&&t($,H,h+4,7),R!=v-1&&(V!=0&&t($,H,h+4*d-4,3),t($,H,h+4*d,5),V!=d-1&&t($,H,h+4*d+4,1))),S[h>>2]=k,q[h>>2]=b[k]}}function f(g,d,v,b,I){I==null&&(I={});let{crc:S}=e,T=r.writeUint,_=r.writeUshort,y=r.writeASCII,h=8,k=g.frames.length>1,P,F=!1,q=33+(k?20:0);if(I.sRGB!=null&&(q+=13),I.pHYs!=null&&(q+=21),I.iCCP!=null&&(P=pako.deflate(I.iCCP),q+=21+P.length+4),g.ctype==3){for(var H=g.plte.length,G=0;G<H;G++)g.plte[G]>>>24!=255&&(F=!0);q+=8+3*H+4+(F?8+1*H+4:0)}for(var N=0;N<g.frames.length;N++)k&&(q+=38),q+=(K=g.frames[N]).cimg.length+12,N!=0&&(q+=4);q+=12;let R=new Uint8Array(q),V=[137,80,78,71,13,10,26,10];for(G=0;G<8;G++)R[G]=V[G];if(T(R,h,13),h+=4,y(R,h,"IHDR"),h+=4,T(R,h,d),h+=4,T(R,h,v),h+=4,R[h]=g.depth,h++,R[h]=g.ctype,h++,R[h]=0,h++,R[h]=0,h++,R[h]=0,h++,T(R,h,S(R,h-17,17)),h+=4,I.sRGB!=null&&(T(R,h,1),h+=4,y(R,h,"sRGB"),h+=4,R[h]=I.sRGB,h++,T(R,h,S(R,h-5,5)),h+=4),I.iCCP!=null){let $=13+P.length;T(R,h,$),h+=4,y(R,h,"iCCP"),h+=4,y(R,h,"ICC profile"),h+=11,h+=2,R.set(P,h),h+=P.length,T(R,h,S(R,h-($+4),$+4)),h+=4}if(I.pHYs!=null&&(T(R,h,9),h+=4,y(R,h,"pHYs"),h+=4,T(R,h,I.pHYs[0]),h+=4,T(R,h,I.pHYs[1]),h+=4,R[h]=I.pHYs[2],h++,T(R,h,S(R,h-13,13)),h+=4),k&&(T(R,h,8),h+=4,y(R,h,"acTL"),h+=4,T(R,h,g.frames.length),h+=4,T(R,h,I.loop!=null?I.loop:0),h+=4,T(R,h,S(R,h-12,12)),h+=4),g.ctype==3){for(T(R,h,3*(H=g.plte.length)),h+=4,y(R,h,"PLTE"),h+=4,G=0;G<H;G++){let $=3*G,X=g.plte[G],nt=255&X,ct=X>>>8&255,Wt=X>>>16&255;R[h+$+0]=nt,R[h+$+1]=ct,R[h+$+2]=Wt}if(h+=3*H,T(R,h,S(R,h-3*H-4,3*H+4)),h+=4,F){for(T(R,h,H),h+=4,y(R,h,"tRNS"),h+=4,G=0;G<H;G++)R[h+G]=g.plte[G]>>>24&255;h+=H,T(R,h,S(R,h-H-4,H+4)),h+=4}}let J=0;for(N=0;N<g.frames.length;N++){var K=g.frames[N];k&&(T(R,h,26),h+=4,y(R,h,"fcTL"),h+=4,T(R,h,J++),h+=4,T(R,h,K.rect.width),h+=4,T(R,h,K.rect.height),h+=4,T(R,h,K.rect.x),h+=4,T(R,h,K.rect.y),h+=4,_(R,h,b[N]),h+=2,_(R,h,1e3),h+=2,R[h]=K.dispose,h++,R[h]=K.blend,h++,T(R,h,S(R,h-30,30)),h+=4);let $=K.cimg;T(R,h,(H=$.length)+(N==0?0:4)),h+=4;let X=h;y(R,h,N==0?"IDAT":"fdAT"),h+=4,N!=0&&(T(R,h,J++),h+=4),R.set($,h),h+=H,T(R,h,S(R,X,h-X)),h+=4}return T(R,h,0),h+=4,y(R,h,"IEND"),h+=4,T(R,h,S(R,h-4,4)),h+=4,R.buffer}function m(g,d,v){for(let b=0;b<g.frames.length;b++){let I=g.frames[b];I.rect.width;let S=I.rect.height,T=new Uint8Array(S*I.bpl+S);I.cimg=p(I.img,S,I.bpp,I.bpl,T,d,v)}}function c(g,d,v,b,I){let S=I[0],T=I[1],_=I[2],y=I[3],h=I[4],k=I[5],P=6,F=8,q=255;for(var H=0;H<g.length;H++){let mt=new Uint8Array(g[H]);for(var G=mt.length,N=0;N<G;N+=4)q&=mt[N+3]}let R=q!=255,V=function(tt,Y,ut,yt,st,Ct){let at=[];for(var Z=0;Z<tt.length;Z++){let At=new Uint8Array(tt[Z]),Lt=new Uint32Array(At.buffer);var vt;let It=0,Bt=0,Ft=Y,Qt=ut,Pr=yt?1:0;if(Z!=0){let vi=Ct||yt||Z==1||at[Z-2].dispose!=0?1:2,Mr=0,dn=1e9;for(let We=0;We<vi;We++){var Gt=new Uint8Array(tt[Z-1-We]);let bi=new Uint32Array(tt[Z-1-We]),qt=Y,zt=ut,Pe=-1,$e=-1;for(let jt=0;jt<ut;jt++)for(let Kt=0;Kt<Y;Kt++)Lt[ht=jt*Y+Kt]!=bi[ht]&&(Kt<qt&&(qt=Kt),Kt>Pe&&(Pe=Kt),jt<zt&&(zt=jt),jt>$e&&($e=jt));Pe==-1&&(qt=zt=Pe=$e=0),st&&((1&qt)==1&&qt--,(1&zt)==1&&zt--);let gn=(Pe-qt+1)*($e-zt+1);gn<dn&&(dn=gn,Mr=We,It=qt,Bt=zt,Ft=Pe-qt+1,Qt=$e-zt+1)}Gt=new Uint8Array(tt[Z-1-Mr]),Mr==1&&(at[Z-1].dispose=2),vt=new Uint8Array(Ft*Qt*4),a(Gt,Y,ut,vt,Ft,Qt,-It,-Bt,0),Pr=a(At,Y,ut,vt,Ft,Qt,-It,-Bt,3)?1:0,Pr==1?u(At,Y,ut,vt,{x:It,y:Bt,width:Ft,height:Qt}):a(At,Y,ut,vt,Ft,Qt,-It,-Bt,0)}else vt=At.slice(0);at.push({rect:{x:It,y:Bt,width:Ft,height:Qt},img:vt,blend:Pr,dispose:0})}if(yt)for(Z=0;Z<at.length;Z++){if(($t=at[Z]).blend==1)continue;let At=$t.rect,Lt=at[Z-1].rect,It=Math.min(At.x,Lt.x),Bt=Math.min(At.y,Lt.y),Ft={x:It,y:Bt,width:Math.max(At.x+At.width,Lt.x+Lt.width)-It,height:Math.max(At.y+At.height,Lt.y+Lt.height)-Bt};at[Z-1].dispose=1,Z-1!=0&&l(tt,Y,ut,at,Z-1,Ft,st),l(tt,Y,ut,at,Z,Ft,st)}let tr=0;if(tt.length!=1)for(var ht=0;ht<at.length;ht++){var $t;tr+=($t=at[ht]).rect.width*$t.rect.height}return at}(g,d,v,S,T,_),J={},K=[],$=[];if(b!=0){let mt=[];for(N=0;N<V.length;N++)mt.push(V[N].img.buffer);let tt=function(st){let Ct=0;for(var at=0;at<st.length;at++)Ct+=st[at].byteLength;let Z=new Uint8Array(Ct),vt=0;for(at=0;at<st.length;at++){let Gt=new Uint8Array(st[at]),tr=Gt.length;for(let ht=0;ht<tr;ht+=4){let $t=Gt[ht],At=Gt[ht+1],Lt=Gt[ht+2],It=Gt[ht+3];It==0&&($t=At=Lt=0),Z[vt+ht]=$t,Z[vt+ht+1]=At,Z[vt+ht+2]=Lt,Z[vt+ht+3]=It}vt+=tr}return Z.buffer}(mt),Y=C(tt,b);for(N=0;N<Y.plte.length;N++)K.push(Y.plte[N].est.rgba);let ut=0;for(N=0;N<V.length;N++){let yt=(nt=V[N]).img.length;var X=new Uint8Array(Y.inds.buffer,ut>>2,yt>>2);$.push(X);let st=new Uint8Array(Y.abuf,ut,yt);k&&s(nt.img,nt.rect.width,nt.rect.height,K,st,X),nt.img.set(st),ut+=yt}}else for(H=0;H<V.length;H++){var nt=V[H];let mt=new Uint32Array(nt.img.buffer);var ct=nt.rect.width;for(G=mt.length,X=new Uint8Array(G),$.push(X),N=0;N<G;N++){let tt=mt[N];if(N!=0&&tt==mt[N-1])X[N]=X[N-1];else if(N>ct&&tt==mt[N-ct])X[N]=X[N-ct];else{let Y=J[tt];if(Y==null&&(J[tt]=Y=K.length,K.push(tt),K.length>=300))break;X[N]=Y}}}let Wt=K.length;for(Wt<=256&&h==0&&(F=Wt<=2?1:Wt<=4?2:Wt<=16?4:8,F=Math.max(F,y)),H=0;H<V.length;H++){(nt=V[H]).rect.x,nt.rect.y,ct=nt.rect.width;let mt=nt.rect.height,tt=nt.img;new Uint32Array(tt.buffer);let Y=4*ct,ut=4;if(Wt<=256&&h==0){Y=Math.ceil(F*ct/8);var Dt=new Uint8Array(Y*mt);let yt=$[H];for(let st=0;st<mt;st++){N=st*Y;let Ct=st*ct;if(F==8)for(var rt=0;rt<ct;rt++)Dt[N+rt]=yt[Ct+rt];else if(F==4)for(rt=0;rt<ct;rt++)Dt[N+(rt>>1)]|=yt[Ct+rt]<<4-4*(1&rt);else if(F==2)for(rt=0;rt<ct;rt++)Dt[N+(rt>>2)]|=yt[Ct+rt]<<6-2*(3&rt);else if(F==1)for(rt=0;rt<ct;rt++)Dt[N+(rt>>3)]|=yt[Ct+rt]<<7-1*(7&rt)}tt=Dt,P=3,ut=1}else if(R==0&&V.length==1){Dt=new Uint8Array(ct*mt*3);let yt=ct*mt;for(N=0;N<yt;N++){let st=3*N,Ct=4*N;Dt[st]=tt[Ct],Dt[st+1]=tt[Ct+1],Dt[st+2]=tt[Ct+2]}tt=Dt,P=2,ut=3,Y=3*ct}nt.img=tt,nt.bpl=Y,nt.bpp=ut}return{ctype:P,depth:F,plte:K,frames:V}}function l(g,d,v,b,I,S,T){let _=Uint8Array,y=Uint32Array,h=new _(g[I-1]),k=new y(g[I-1]),P=I+1<g.length?new _(g[I+1]):null,F=new _(g[I]),q=new y(F.buffer),H=d,G=v,N=-1,R=-1;for(let J=0;J<S.height;J++)for(let K=0;K<S.width;K++){let $=S.x+K,X=S.y+J,nt=X*d+$,ct=q[nt];ct==0||b[I-1].dispose==0&&k[nt]==ct&&(P==null||P[4*nt+3]!=0)||($<H&&(H=$),$>N&&(N=$),X<G&&(G=X),X>R&&(R=X))}N==-1&&(H=G=N=R=0),T&&((1&H)==1&&H--,(1&G)==1&&G--),S={x:H,y:G,width:N-H+1,height:R-G+1};let V=b[I];V.rect=S,V.blend=1,V.img=new Uint8Array(S.width*S.height*4),b[I-1].dispose==0?(a(h,d,v,V.img,S.width,S.height,-S.x,-S.y,0),u(F,d,v,V.img,S)):a(F,d,v,V.img,S.width,S.height,-S.x,-S.y,0)}function u(g,d,v,b,I){a(g,d,v,b,I.width,I.height,-I.x,-I.y,2)}function p(g,d,v,b,I,S,T){let _=[],y,h=[0,1,2,3,4];S!=-1?h=[S]:(d*b>5e5||v==1)&&(h=[0]),T&&(y={level:0});let k=bs;for(var P=0;P<h.length;P++){for(let H=0;H<d;H++)A(I,g,H,b,v,h[P]);_.push(k.deflate(I,y))}let F,q=1e9;for(P=0;P<_.length;P++)_[P].length<q&&(F=P,q=_[P].length);return _[F]}function A(g,d,v,b,I,S){let T=v*b,_=T+v;if(g[_]=S,_++,S==0)if(b<500)for(var y=0;y<b;y++)g[_+y]=d[T+y];else g.set(new Uint8Array(d.buffer,T,b),_);else if(S==1){for(y=0;y<I;y++)g[_+y]=d[T+y];for(y=I;y<b;y++)g[_+y]=d[T+y]-d[T+y-I]+256&255}else if(v==0){for(y=0;y<I;y++)g[_+y]=d[T+y];if(S==2)for(y=I;y<b;y++)g[_+y]=d[T+y];if(S==3)for(y=I;y<b;y++)g[_+y]=d[T+y]-(d[T+y-I]>>1)+256&255;if(S==4)for(y=I;y<b;y++)g[_+y]=d[T+y]-o(d[T+y-I],0,0)+256&255}else{if(S==2)for(y=0;y<b;y++)g[_+y]=d[T+y]+256-d[T+y-b]&255;if(S==3){for(y=0;y<I;y++)g[_+y]=d[T+y]+256-(d[T+y-b]>>1)&255;for(y=I;y<b;y++)g[_+y]=d[T+y]+256-(d[T+y-b]+d[T+y-I]>>1)&255}if(S==4){for(y=0;y<I;y++)g[_+y]=d[T+y]+256-o(0,d[T+y-b],0)&255;for(y=I;y<b;y++)g[_+y]=d[T+y]+256-o(d[T+y-I],d[T+y-b],d[T+y-I-b])&255}}}function C(g,d){let v=new Uint8Array(g),b=v.slice(0),I=new Uint32Array(b.buffer),S=w(b,d),T=S[0],_=S[1],y=v.length,h=new Uint8Array(y>>2),k;if(v.length<2e7)for(var P=0;P<y;P+=4)k=x(T,F=v[P]*(1/255),q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255)),h[P>>2]=k.ind,I[P>>2]=k.est.rgba;else for(P=0;P<y;P+=4){var F=v[P]*.00392156862745098,q=v[P+1]*(1/255),H=v[P+2]*(1/255),G=v[P+3]*(1/255);for(k=T;k.left;)k=D(k.est,F,q,H,G)<=0?k.left:k.right;h[P>>2]=k.ind,I[P>>2]=k.est.rgba}return{abuf:b.buffer,inds:h,plte:_}}function w(g,d,v){v==null&&(v=1e-4);let b=new Uint32Array(g.buffer),I={i0:0,i1:g.length,bst:null,est:null,tdst:0,left:null,right:null};I.bst=U(g,I.i0,I.i1),I.est=E(I.bst);let S=[I];for(;S.length<d;){let _=0,y=0;for(var T=0;T<S.length;T++)S[T].est.L>_&&(_=S[T].est.L,y=T);if(_<v)break;let h=S[y],k=L(g,b,h.i0,h.i1,h.est.e,h.est.eMq255);if(h.i0>=k||h.i1<=k){h.est.L=0;continue}let P={i0:h.i0,i1:k,bst:null,est:null,tdst:0,left:null,right:null};P.bst=U(g,P.i0,P.i1),P.est=E(P.bst);let F={i0:k,i1:h.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:h.bst.N-P.bst.N},T=0;T<16;T++)F.bst.R[T]=h.bst.R[T]-P.bst.R[T];for(T=0;T<4;T++)F.bst.m[T]=h.bst.m[T]-P.bst.m[T];F.est=E(F.bst),h.left=P,h.right=F,S[y]=P,S.push(F)}for(S.sort((_,y)=>y.bst.N-_.bst.N),T=0;T<S.length;T++)S[T].ind=T;return[I,S]}function x(g,d,v,b,I){if(g.left==null)return g.tdst=function(P,F,q,H,G){let N=F-P[0],R=q-P[1],V=H-P[2],J=G-P[3];return N*N+R*R+V*V+J*J}(g.est.q,d,v,b,I),g;let S=D(g.est,d,v,b,I),T=g.left,_=g.right;S>0&&(T=g.right,_=g.left);let y=x(T,d,v,b,I);if(y.tdst<=S*S)return y;let h=x(_,d,v,b,I);return h.tdst<y.tdst?h:y}function D(g,d,v,b,I){let{e:S}=g;return S[0]*d+S[1]*v+S[2]*b+S[3]*I-g.eMq}function L(g,d,v,b,I,S){for(b-=4;v<b;){for(;M(g,v,I)<=S;)v+=4;for(;M(g,b,I)>S;)b-=4;if(v>=b)break;let T=d[v>>2];d[v>>2]=d[b>>2],d[b>>2]=T,v+=4,b-=4}for(;M(g,v,I)>S;)v-=4;return v+4}function M(g,d,v){return g[d]*v[0]+g[d+1]*v[1]+g[d+2]*v[2]+g[d+3]*v[3]}function U(g,d,v){let b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],I=[0,0,0,0],S=v-d>>2;for(let T=d;T<v;T+=4){let _=g[T]*.00392156862745098,y=g[T+1]*(1/255),h=g[T+2]*(1/255),k=g[T+3]*(1/255);I[0]+=_,I[1]+=y,I[2]+=h,I[3]+=k,b[0]+=_*_,b[1]+=_*y,b[2]+=_*h,b[3]+=_*k,b[5]+=y*y,b[6]+=y*h,b[7]+=y*k,b[10]+=h*h,b[11]+=h*k,b[15]+=k*k}return b[4]=b[1],b[8]=b[2],b[9]=b[6],b[12]=b[3],b[13]=b[7],b[14]=b[11],{R:b,m:I,N:S}}function E(g){let{R:d}=g,{m:v}=g,{N:b}=g,I=v[0],S=v[1],T=v[2],_=v[3],y=b==0?0:1/b,h=[d[0]-I*I*y,d[1]-I*S*y,d[2]-I*T*y,d[3]-I*_*y,d[4]-S*I*y,d[5]-S*S*y,d[6]-S*T*y,d[7]-S*_*y,d[8]-T*I*y,d[9]-T*S*y,d[10]-T*T*y,d[11]-T*_*y,d[12]-_*I*y,d[13]-_*S*y,d[14]-_*T*y,d[15]-_*_*y],k=h,P=O,F=[Math.random(),Math.random(),Math.random(),Math.random()],q=0,H=0;if(b!=0)for(let N=0;N<16&&(F=P.multVec(k,F),H=Math.sqrt(P.dot(F,F)),F=P.sml(1/H,F),!(N!=0&&Math.abs(H-q)<1e-9));N++)q=H;let G=[I*y,S*y,T*y,_*y];return{Cov:h,q:G,e:F,L:q,eMq255:P.dot(P.sml(255,G),F),eMq:P.dot(F,G),rgba:(Math.round(255*G[3])<<24|Math.round(255*G[2])<<16|Math.round(255*G[1])<<8|Math.round(255*G[0])<<0)>>>0}}var O={multVec:(g,d)=>[g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3],g[4]*d[0]+g[5]*d[1]+g[6]*d[2]+g[7]*d[3],g[8]*d[0]+g[9]*d[1]+g[10]*d[2]+g[11]*d[3],g[12]*d[0]+g[13]*d[1]+g[14]*d[2]+g[15]*d[3]],dot:(g,d)=>g[0]*d[0]+g[1]*d[1]+g[2]*d[2]+g[3]*d[3],sml:(g,d)=>[g*d[0],g*d[1],g*d[2],g*d[3]]};kt.encode=function(d,v,b,I,S,T,_){I==null&&(I=0),_==null&&(_=!1);let y=c(d,v,b,I,[!1,!1,!1,0,_,!1]);return m(y,-1),f(y,v,b,S,T)},kt.encodeLL=function(d,v,b,I,S,T,_,y){let h={ctype:0+(I==1?0:2)+(S==0?0:4),depth:T,frames:[]},k=(I+S)*T,P=k*v;for(let F=0;F<d.length;F++)h.frames.push({rect:{x:0,y:0,width:v,height:b},img:new Uint8Array(d[F]),blend:0,dispose:1,bpp:Math.ceil(k/8),bpl:Math.ceil(P/8)});return m(h,0,!0),f(h,v,b,_,y)},kt.encode.compress=c,kt.encode.dither=s,kt.quantize=C,kt.quantize.getKDtree=w,kt.quantize.getNearest=x})();var ai={toArrayBuffer(a,r){let o=a.width,e=a.height,t=o<<2,n=a.getContext("2d").getImageData(0,0,o,e),i=new Uint32Array(n.data.buffer),s=(32*o+31)/32<<2,f=s*e,m=122+f,c=new ArrayBuffer(m),l=new DataView(c),u=1<<20,p,A,C,w,x=u,D=0,L=0,M=0;function U(g){l.setUint16(L,g,!0),L+=2}function E(g){l.setUint32(L,g,!0),L+=4}function O(g){L+=g}U(19778),E(m),O(4),E(122),E(108),E(o),E(-e>>>0),U(1),U(32),E(3),E(f),E(2835),E(2835),O(8),E(16711680),E(65280),E(255),E(4278190080),E(1466527264),function g(){for(;D<e&&x>0;){for(w=122+D*s,p=0;p<t;)x--,A=i[M++],C=A>>>24,l.setUint32(w+p,A<<8|C),p+=4;D++}M<i.length?(x=u,setTimeout(g,ai._dly)):r(c)}()},toBlob(a,r){this.toArrayBuffer(a,o=>{r(new Blob([o],{type:"image/bmp"}))})},_dly:9},xt={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Is={[xt.CHROME]:16384,[xt.FIREFOX]:11180,[xt.DESKTOP_SAFARI]:16384,[xt.IE]:8192,[xt.IOS]:4096,[xt.ETC]:8192},ln=typeof window<"u",ci=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,br=ln&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),Ss=(ln||ci)&&(br&&br.getOriginalSymbol(window,"File")||typeof File<"u"&&File),li=(ln||ci)&&(br&&br.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function un(a,r,o=Date.now()){return new Promise(e=>{let t=a.split(","),n=t[0].match(/:(.*?);/)[1],i=globalThis.atob(t[1]),s=i.length,f=new Uint8Array(s);for(;s--;)f[s]=i.charCodeAt(s);let m=new Blob([f],{type:n});m.name=r,m.lastModified=o,e(m)})}function ui(a){return new Promise((r,o)=>{let e=new li;e.onload=()=>r(e.result),e.onerror=t=>o(t),e.readAsDataURL(a)})}function fi(a){return new Promise((r,o)=>{let e=new Image;e.onload=()=>r(e),e.onerror=t=>o(t),e.src=a})}function Te(){if(Te.cachedResult!==void 0)return Te.cachedResult;let a=xt.ETC,{userAgent:r}=navigator;return/Chrom(e|ium)/i.test(r)?a=xt.CHROME:/iP(ad|od|hone)/i.test(r)&&/WebKit/i.test(r)?a=xt.IOS:/Safari/i.test(r)?a=xt.DESKTOP_SAFARI:/Firefox/i.test(r)?a=xt.FIREFOX:(/MSIE/i.test(r)||document.documentMode)&&(a=xt.IE),Te.cachedResult=a,Te.cachedResult}function pi(a,r){let o=Te(),e=Is[o],t=a,n=r,i=t*n,s=t>n?n/t:t/n;for(;i>e*e;){let f=(e+t)/2,m=(e+n)/2;f<m?(n=m,t=m*s):(n=f*s,t=f),i=t*n}return{width:t,height:n}}function _r(a,r){let o,e;try{if(o=new OffscreenCanvas(a,r),e=o.getContext("2d"),e===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{o=document.createElement("canvas"),e=o.getContext("2d")}return o.width=a,o.height=r,[o,e]}function mi(a,r){let{width:o,height:e}=pi(a.width,a.height),[t,n]=_r(o,e);return r&&/jpe?g/.test(r)&&(n.fillStyle="white",n.fillRect(0,0,t.width,t.height)),n.drawImage(a,0,0,t.width,t.height),t}function Cr(){return Cr.cachedResult!==void 0||(Cr.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Cr.cachedResult}function Ir(a,r={}){return new Promise(function(o,e){let t,n;var i=function(){try{return n=mi(t,r.fileType||a.type),o([t,n])}catch(f){return e(f)}},s=function(f){try{var m=function(c){try{throw c}catch(l){return e(l)}};try{let c;return ui(a).then(function(l){try{return c=l,fi(c).then(function(u){try{return t=u,function(){try{return i()}catch(p){return e(p)}}()}catch(p){return m(p)}},m)}catch(u){return m(u)}},m)}catch(c){m(c)}}catch(c){return e(c)}};try{if(Cr()||[xt.DESKTOP_SAFARI,xt.MOBILE_SAFARI].includes(Te()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(a).then(function(f){try{return t=f,i()}catch{return s()}},s)}catch{s()}})}function Sr(a,r,o,e,t=1){return new Promise(function(n,i){let s;if(r==="image/png"){let m,c,l;return m=a.getContext("2d"),{data:c}=m.getImageData(0,0,a.width,a.height),l=kt.encode([c.buffer],a.width,a.height,4096*t),s=new Blob([l],{type:r}),s.name=o,s.lastModified=e,f.call(this)}{let m=function(){return f.call(this)};if(r==="image/bmp")return new Promise(c=>ai.toBlob(a,c)).then(function(c){try{return s=c,s.name=o,s.lastModified=e,m.call(this)}catch(l){return i(l)}}.bind(this),i);{let c=function(){return m.call(this)};if(typeof OffscreenCanvas=="function"&&a instanceof OffscreenCanvas)return a.convertToBlob({type:r,quality:t}).then(function(l){try{return s=l,s.name=o,s.lastModified=e,c.call(this)}catch(u){return i(u)}}.bind(this),i);{let l;return l=a.toDataURL(r,t),un(l,o,e).then(function(u){try{return s=u,c.call(this)}catch(p){return i(p)}}.bind(this),i)}}}function f(){return n(s)}})}function Ht(a){a.width=0,a.height=0}function ze(){return new Promise(function(a,r){let o,e,t,n,i;return ze.cachedResult!==void 0?a(ze.cachedResult):(o="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==",un("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(s){try{return e=s,Ir(e).then(function(f){try{return t=f[1],Sr(t,e.type,e.name,e.lastModified).then(function(m){try{return n=m,Ht(t),Ir(n).then(function(c){try{return i=c[0],ze.cachedResult=i.width===1&&i.height===2,a(ze.cachedResult)}catch(l){return r(l)}},r)}catch(c){return r(c)}},r)}catch(m){return r(m)}},r)}catch(f){return r(f)}},r))})}function hi(a){return new Promise((r,o)=>{let e=new li;e.onload=t=>{let n=new DataView(t.target.result);if(n.getUint16(0,!1)!=65496)return r(-2);let i=n.byteLength,s=2;for(;s<i;){if(n.getUint16(s+2,!1)<=8)return r(-1);let f=n.getUint16(s,!1);if(s+=2,f==65505){if(n.getUint32(s+=2,!1)!=1165519206)return r(-1);let m=n.getUint16(s+=6,!1)==18761;s+=n.getUint32(s+4,m);let c=n.getUint16(s,m);s+=2;for(let l=0;l<c;l++)if(n.getUint16(s+12*l,m)==274)return r(n.getUint16(s+12*l+8,m))}else{if((65280&f)!=65280)break;s+=n.getUint16(s,!1)}}return r(-1)},e.onerror=t=>o(t),e.readAsArrayBuffer(a)})}function di(a,r){let{width:o}=a,{height:e}=a,{maxWidthOrHeight:t}=r,n,i=a;return isFinite(t)&&(o>t||e>t)&&([i,n]=_r(o,e),o>e?(i.width=t,i.height=e/o*t):(i.width=o/e*t,i.height=t),n.drawImage(a,0,0,i.width,i.height),Ht(a)),i}function gi(a,r){let{width:o}=a,{height:e}=a,[t,n]=_r(o,e);switch(r>4&&r<9?(t.width=e,t.height=o):(t.width=o,t.height=e),r){case 2:n.transform(-1,0,0,1,o,0);break;case 3:n.transform(-1,0,0,-1,o,e);break;case 4:n.transform(1,0,0,-1,0,e);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,e,0);break;case 7:n.transform(0,-1,-1,0,e,o);break;case 8:n.transform(0,-1,1,0,0,o)}return n.drawImage(a,0,0,o,e),Ht(a),t}function ii(a,r,o=0){return new Promise(function(e,t){let n,i,s,f,m,c,l,u,p,A,C,w,x,D,L,M,U,E,O,g;function d(b=5){if(r.signal&&r.signal.aborted)throw r.signal.reason;n+=b,r.onProgress(Math.min(n,100))}function v(b){if(r.signal&&r.signal.aborted)throw r.signal.reason;n=Math.min(Math.max(b,n),100),r.onProgress(n)}return n=o,i=r.maxIteration||10,s=1024*r.maxSizeMB*1024,d(),Ir(a,r).then(function(b){try{return[,f]=b,d(),m=di(f,r),d(),new Promise(function(I,S){var T;if(!(T=r.exifOrientation))return hi(a).then(function(y){try{return T=y,_.call(this)}catch(h){return S(h)}}.bind(this),S);function _(){return I(T)}return _.call(this)}).then(function(I){try{return c=I,d(),ze().then(function(S){try{return l=S?m:gi(m,c),d(),u=r.initialQuality||1,p=r.fileType||a.type,Sr(l,p,a.name,a.lastModified,u).then(function(T){try{{let y=function(){if(i--&&(L>s||L>x)){let k,P;return k=g?.95*O.width:O.width,P=g?.95*O.height:O.height,[U,E]=_r(k,P),E.drawImage(O,0,0,k,P),u*=p==="image/png"?.85:.95,Sr(U,p,a.name,a.lastModified,u).then(function(F){try{return M=F,Ht(O),O=U,L=M.size,v(Math.min(99,Math.floor((D-L)/(D-s)*100))),y}catch(q){return t(q)}},t)}return[1]},h=function(){return Ht(O),Ht(U),Ht(m),Ht(l),Ht(f),v(100),e(M)};if(A=T,d(),C=A.size>s,w=A.size>a.size,!C&&!w)return v(100),e(A);var _;return x=a.size,D=A.size,L=D,O=l,g=!r.alwaysKeepResolution&&C,(_=function(k){for(;k;){if(k.then)return void k.then(_,t);try{if(k.pop){if(k.length)return k.pop()?h.call(this):k;k=y}else k=k.call(this)}catch(P){return t(P)}}}.bind(this))(y)}}catch(y){return t(y)}}.bind(this),t)}catch(T){return t(T)}}.bind(this),t)}catch(S){return t(S)}}.bind(this),t)}catch(I){return t(I)}}.bind(this),t)})}var _s=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`,cn;function ws(a,r){return new Promise((o,e)=>{cn||(cn=function(i){let s=[];return typeof i=="function"?s.push(`(${i})()`):s.push(i),URL.createObjectURL(new Blob(s))}(_s));let t=new Worker(cn);t.addEventListener("message",function(i){if(r.signal&&r.signal.aborted)t.terminate();else if(i.data.progress===void 0){if(i.data.error)return e(new Error(i.data.error)),void t.terminate();o(i.data.file),t.terminate()}else r.onProgress(i.data.progress)}),t.addEventListener("error",e),r.signal&&r.signal.addEventListener("abort",()=>{e(r.signal.reason),t.terminate()}),t.postMessage({file:a,imageCompressionLibUrl:r.libURL,options:{...r,onProgress:void 0,signal:void 0}})})}function pt(a,r){return new Promise(function(o,e){let t,n,i,s,f,m;if(t={...r},i=0,{onProgress:s}=t,t.maxSizeMB=t.maxSizeMB||Number.POSITIVE_INFINITY,f=typeof t.useWebWorker!="boolean"||t.useWebWorker,delete t.useWebWorker,t.onProgress=p=>{i=p,typeof s=="function"&&s(i)},!(a instanceof Blob||a instanceof Ss))return e(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(a.type))return e(new Error("The file given is not an image"));if(m=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!f||typeof Worker!="function"||m)return ii(a,t).then(function(p){try{return n=p,u.call(this)}catch(A){return e(A)}}.bind(this),e);var c=function(){try{return u.call(this)}catch(p){return e(p)}}.bind(this),l=function(p){try{return ii(a,t).then(function(A){try{return n=A,c()}catch(C){return e(C)}},e)}catch(A){return e(A)}};try{return t.libURL=t.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",ws(a,t).then(function(p){try{return n=p,c()}catch{return l()}},l)}catch{l()}function u(){try{n.name=a.name,n.lastModified=a.lastModified}catch{}try{t.preserveExif&&a.type==="image/jpeg"&&(!t.fileType||t.fileType&&t.fileType===a.type)&&(n=si(a,n))}catch{}return o(n)}})}pt.getDataUrlFromFile=ui,pt.getFilefromDataUrl=un,pt.loadImage=fi,pt.drawImageInCanvas=mi,pt.drawFileInCanvas=Ir,pt.canvasToFile=Sr,pt.getExifOrientation=hi,pt.handleMaxWidthOrHeight=di,pt.followExifOrientation=gi,pt.cleanupCanvasMemory=Ht,pt.isAutoOrientationInBrowser=ze,pt.approximateBelowMaximumCanvasSizeOfBrowser=pi,pt.copyExifWithoutOrientation=si,pt.getBrowserName=Te,pt.version="2.0.2";var yi=async(a=window.location.href,r=!0)=>{let o=await je("tabs","query",[{url:a}]);o?.length===0&&(o=await je("tabs","query",[{active:!0}]));let e=o?.[0]?.windowId,t=o?.[0]?.id;if(e&&t){await je("tabs","update",[t,{active:!0}]);let n=await je("tabs","captureVisibleTab",[e,{format:"png",quality:80}]);if(await new Promise(i=>setTimeout(i,1e3)),r&&n){let i=new Date().getTime(),s=ao(n,"screenshot.png");if(s){i=new Date().getTime();let f=await pt(s,{useWebWorker:!0,maxWidthOrHeight:1920});return ur(f)||n}}return n}return null};var Ee=class extends B{static{this.type="CREATE_WEBSITE_CONTEXT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters.CreateWebsiteContextConfig||{},t={};e&&Object.keys(e).forEach(i=>{let s=e[i];typeof e[i]=="string"?kr(t,i,o.getShortCutsEngine()?.parseTemplate(s)||e[i]):typeof e[i]=="object"&&Object.keys(e[i]).forEach(f=>{let m=e[i][f];kr(t,`${i}.${f}`,o.getShortCutsEngine()?.parseTemplate(m)||e[i][f])})}),t.sidebarType=this.getCurrentSidebarType(o);let n=await ni(t);n?.id&&!n.meta?.screenshot&&yi().then(i=>{i&&oi({id:n.id},{meta:{screenshot:i}})}),this.output=t.id}catch(e){this.error=e.toString()}}};z([j()],Ee.prototype,"execute",1);var fn=bt(Rn());var xe=class extends B{static{this.type="DATE_FORMAT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=typeof this.parameters.DateFormatStyle=="string"?this.parameters.DateFormatStyle:"YYYY-MM-DD",t=r.LAST_ACTION_OUTPUT||(0,fn.default)().format();this.output=(0,fn.default)(t).format(e)}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],xe.prototype,"execute",1);var pn=bt(Rn());var Ce=class extends B{static{this.type="DATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{(this.parameters.DateActionMode||"Current Date")==="Specified Date"?this.output=(0,pn.default)(this.parameters.DateActionDate).format():this.output=(0,pn.default)().format()}catch(e){this.error=e.toString()}}};z([W({onlyError:!0})],Ce.prototype,"execute",1);var Je=400*1e3,Ps=async(a,r)=>new Promise(o=>{fetch(`${Or}/gpt/check_doc_exists`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({doc_id:r})}).then(e=>e.json()).then(e=>{if(Tn){o(e?.data?.exists||!1);return}o(!1)}).catch(e=>{o(!1)})}),mn=async(a,r)=>{let o=await zn();return new Promise(async e=>{let t=Nr(a);if(await Ps(o,t)){e(t);return}let n=new File([a],r||"file.txt",{type:"text/plain"}),i=new FormData;i.append("file",n,n.name.replace(/\.pdf$/,".txt")),i.append("doc_id",Nr(a)),fetch(`${Or}/gpt/analyze_file`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:i}).then(s=>s.json()).then(s=>{let f=s?.data?.doc_id||"";f||qr("[API] [/gpt/analyze_file] error",JSON.stringify({error:"response docId is empty"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e(f)}).catch(s=>{qr("[API] [/gpt/analyze_file] error",JSON.stringify({error:s?.message||s?.toString()||"unknown error"},null,2),{uuid:"6f02f533-def6-4696-b14e-1b00c2d9a4df"}),e("")})})};var ve=class extends B{static{this.type="GET_PDF_CONTENTS_OF_CRX"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{if(typeof window<"u"&&window.pdfjsLib&&window?.PDFViewerApplication?.url){let e=window.pdfjsLib,t=0,i=await(async()=>{try{let s=await e.getDocument(window?.PDFViewerApplication?.url).promise,f=s.numPages,m=async p=>{try{return(await(await s.getPage(p)).getTextContent()).items.map(w=>w.str).join("")}catch{return""}},c="",l="",u=0;for(let p=0;p<f;p++){let A="",C=!1;p%2===0?(C=!0,A=await m(f-p)):A=await m(p);let w=(await nr(A)).length;if(w+t>Je)break;u+=1,t+=w,C?l=A+l:c=c+A}return c+l}catch{return""}})();this.output=i}}catch(e){this.error=e.toString()}}};z([j(),W({onlyError:!0}),Et()],ve.prototype,"execute",1);var Ms=()=>{let a=Zt();return a==="mail.google.com"?"[Gmail] ":a==="outlook.office.com"||a==="outlook.live.com"||a==="outlook.office365.com"?"[Outlook] ":a==="twitter.com"?"[Twitter] ":a==="linkedin.com"?"[LinkedIn] ":a==="facebook.com"?"[Facebook] ":""},Ai=Ms;var be=class extends B{constructor(o,e,t,n){super(o,e,t,n)}static{this.type="ASK_CHATGPT"}async execute(o,e){try{let t=this.parameters.AskChatGPTActionType||"ask_chatgpt";t==="ASK_CHAT_GPT_WITH_PREFIX"&&this.parameters.AskChatGPTActionMeta?.contextMenu&&(this.parameters.AskChatGPTActionMeta.contextMenu.text=Ai()+this.parameters.AskChatGPTActionMeta.contextMenu.text),this.question=o.LAST_ACTION_OUTPUT;let{success:n,answer:i,message:s,error:f}=await e.getChartGPT()?.sendQuestion({messageId:"",question:this.parameters?.compliedTemplate||o.LAST_ACTION_OUTPUT,parentMessageId:""},{includeHistory:!1,regenerate:!1,hiddenInChat:t==="ASK_CHAT_GPT_HIDDEN",meta:{...this.parameters.AskChatGPTActionMeta}})||{success:!1,answer:"",error:""};n?(this.output=i,this.message=s):(this.output="",this.error=this.error=Hr(f||i||"ask chatgpt error"))}catch(t){this.error=Hr(t.toString())}}reset(){super.reset(),this.question="",this.message=void 0}};z([j(),De(!1)],be.prototype,"execute",1);var Ie=class extends B{static{this.type="INSERT_USER_INPUT"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{let e=this.parameters?.compliedTemplate||r?.LAST_ACTION_OUTPUT||"",t=this.parameters.AskChatGPTActionMeta,n=Oe(),i=await Ln(()=>{let s=null;return n?s=_n()?.querySelector(`#${Xt}`):s=Yt()?.querySelector(`#${Ot}`),s?Promise.resolve(s):Promise.reject("not found")},30,100);i&&(n?(dt("floatingMenuInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),te(i,0)):(dt("chatBoxInputMediator").updateInputValue("``NO_HISTORY_&#``\n"+e,t),te(i,44.5))),i||n?this.output=e:this.error=""}catch{}}};z([j(),De()],Ie.prototype,"execute",1);var Se=class extends B{static{this.type="ANALYZE_CHAT_FILE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){try{this.pushMessageToChat({type:"system",text:"Generating summary...",messageId:ot(),extra:{status:"info"}},o);let e=this.parameters.AnalyzeChatFileName||r.AnalyzeChatFileName||"Content.txt",t=this.parameters.AnalyzeChatFileImmediateUpdateConversation||r.AnalyzeChatFileImmediateUpdateConversation||!1,n=r.LAST_ACTION_OUTPUT,i=(await nr(n)).length,s=i>12e3;i>Je&&(n=await Ke(n,Je));let f=await Ke(n,12e3);if(s)if(t){let m=await mn(n,e);await this.updateConversation(o,{meta:{docId:m}})}else mn(n,e).then(async m=>{await this.updateConversation(o,{meta:{docId:m}})});await this.updateConversation(o,{meta:{systemPrompt:`The following text delimited by triple backticks is the context text:
            \`\`\`
            ${f}
            \`\`\``}}),this.output=f}catch(e){this.error=e.toString()}}};z([j()],Se.prototype,"execute",1);var _e=class extends B{static{this.type="RENDER_CHATGPT_PROMPT"}constructor(r,o,e,t){super(r,"RENDER_CHATGPT_PROMPT",e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],_e.prototype,"execute",1);var we=class extends B{static{this.type="RENDER_TEMPLATE"}constructor(r,o,e,t){super(r,o,e,t)}async execute(r,o){this.output=this.parameters?.compliedTemplate||""}};z([j()],we.prototype,"execute",1);var Ei={[_e.type]:_e,[we.type]:we,[be.type]:be,[Se.type]:Se,[Ie.type]:Ie,[re.type]:re,[Fe.type]:Fe,[Ne.type]:Ne,[ne.type]:ne,[oe.type]:oe,[He.type]:He,[ee.type]:ee,[ie.type]:ie,[se.type]:se,[Be.type]:Be,[ae.type]:ae,[ve.type]:ve,[Ge.type]:Ge,[qe.type]:qe,[ce.type]:ce,[le.type]:le,[ue.type]:ue,[fe.type]:fe,[pe.type]:pe,[Ce.type]:Ce,[xe.type]:xe,[de.type]:de,[Ae.type]:Ae,[Ee.type]:Ee,[ge.type]:ge,[ye.type]:ye},Ls=a=>new Promise(r=>setTimeout(r,a)),hn=class{constructor(){this.status="idle";this.variables=new Map;this.stepIndex=-1;this.actions=[];this.listeners=[]}setActions(r){this.reset(),this.actions=[],r.map(o=>{let e=Ei[o.type];if(!e)throw new Error(`Action type ${o.type} not found`);let t=new e(o.id||ot(),o.type,o.parameters||{},typeof o.autoExecute=="boolean"?o.autoExecute:!0);this.actions.push(t)})}pushActions(r,o){let e=[];r.map(t=>{let n=Ei[t.type];if(!n)throw new Error(`Action type ${t.type} not found`);let i=new n(t.id||ot(),t.type,t.parameters||{},typeof t.autoExecute=="boolean"?t.autoExecute:!0);e.push(i)}),o==="after"?this.actions.splice(this.stepIndex+1,0,...e):this.actions.push(...e)}async executeAction(r,o){try{if(r.reset(),r.status="running",this.emit("action",r),await r.execute(this.getVariables(),o),r.error){r.status="error",this.emit("action",r);return}r.status="complete",this.emit("action",r)}catch{r.status="error",this.emit("action",r)}}async run(r){try{let{engine:o,parameters:e}=r;if(this.status==="idle"||this.status==="stop")for(this.status="running",this.emit("status",this);this.status==="running"&&this.status!=="stop";){if(this.stepIndex+=1,this.stepIndex>=this.actions.length){this.status="complete",this.emit("status",this),this.reset();break}e&&this.stepIndex===0&&this.setVariables(e);let t=this.getCurrentAction();if(t){if(this.emit("beforeRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),await this.executeAction(t,o),this.emit("afterRunAction",{ShortcutsEngine:this,action:t,progress:this.progress}),t.error){this.status="stop",this.emit("status",this),this.stepIndex=this.stepIndex-1;break}let n=t.output||"";if(this.setVariable("LAST_ACTION_OUTPUT",n,!0),this.getNextAction()?.autoExecute&&!t.error)continue}await Ls(100)}}catch{this.status="stop",this.emit("status",this)}}stop(){this.status="stop"}reset(){this.stepIndex=-1,this.variables=new Map,this.status="idle"}setVariable(r,o,e){this.variables.has(r)?e&&this.variables.set(r,o):this.variables.set(r,o)}setVariables(r){r.forEach(o=>{this.setVariable(o.key,o.value,o.overwrite)})}getVariable(r){return this.variables.get(r)}getVariables(){return Object.fromEntries(this.variables)}getCurrentAction(){return this.actions[this.stepIndex]}getNextAction(){return this.actions[this.stepIndex+1]||null}getPrevAction(){return this.actions[this.stepIndex-1]||null}get progress(){return Number((Math.max(this.stepIndex,0)/this.actions.length).toFixed(2))}addListener(r){this.listeners.push(r)}removeListener(r){let o=this.listeners.indexOf(r);o>-1&&this.listeners.splice(o,1)}removeAllListeners(){this.listeners=[]}emit(r,o){this.listeners.forEach(e=>{e(r,o)})}parseTemplate(r){return Ye(r,this.getVariables()).data}},xi=hn;var Ci=yn({key:"ShortCutsState",default:{status:"idle"}});var wr=new xi,Os=new Me({runtime:"shortcut"}),Gi=a=>{let{isLogin:r}=Jn(),o=$r(),[e,t]=An(Ci),{loading:n}=ft(Le),i=(0,Ve.useRef)(wr),s=io(a||""),f=u=>i.current?(i.current?.setActions(u),!0):!1,m=(0,Ve.useCallback)(async(u=!1)=>{if(i.current){(!r||u&&!Pn())&&wn();try{await bn()&&(i.current?.stepIndex===-1||i.current.status==="stop")&&(i.current?.actions.find(C=>C.type==="ASK_CHATGPT")&&t({status:"running"}),await i.current.run({parameters:o().shortCutsParameters,engine:{getShortCutsEngine:()=>i.current,getChartGPT:()=>s,getBackgroundConversation:()=>Os}}))}catch{}finally{t({status:wr.status||"idle"})}}},[s,i,o,r]),c=(0,Ve.useCallback)(()=>{i.current&&(i.current.stop(),t({status:wr.status||"idle"}))},[i]),l=(0,Ve.useCallback)(()=>{i.current&&(i.current.reset(),t({status:wr.status||"idle"}))},[]);return{...s,shortCutsEngineRef:i,runShortCuts:m,setShortCuts:f,loading:e.status==="running"||n,status:e.status,stopShortCuts:c,resetShortCuts:l}};export{Ra as a,go as b,Bi as c,it as d,Zl as e,fo as f,ea as g,Gi as h,Ma as i};
