(self.webpackChunk=self.webpackChunk||[]).push([[6209],{55826:(e,t,n)=>{n.d(t,{A:()=>P});var r=n(57050),i=n(84966),a=n(80358),o=n(74660),s=n(70996),u=n(4390),c=n(9922),l=n(16118),f=n(77176),d=n(85985),h=n(8125),p=n(5114),m=n(92843),v=n(71249),g=n(81531),y=n(46680),b=n(78929),A=n(12054),w=n(21038),I=n(24055),S=n(4477);function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||R(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||R(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(e,t){if(e){if("string"==typeof e)return _(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}var P=function(){function e(t,n,_){var E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new S.J,M=this;C(this,e),this._getByRawAlertId=_,this.popoverManager=E,this._subs=new c.w.Keeper,this._log=g.C8.Logging.getLogger("SDUIManager",y.i.TRACE,y.T.Manager.getColor()),this.findFirstCardWithContent=function(e){return M._sduiManager.findFirstCardWithContent(e)},this.onSessionStarted=function(){return M._sduiManager.onSessionStarted()},this.onFirstCheckingFinished=function(){return M._sduiManager.onFirstCheckingFinished()},this.notifyAlertsChanged=function(){return M._sduiManager.notifyAlertsChanged()},this.loadItems=function(e){return M._sduiManager.loadItems(e)},this._toRemovedAlertIdsByClient=function(e){var t=M,n=function(e,n,i){var a=t;return(0,h.Kg)(o.bZ.isRemovedByTextChange,o.bZ.isDuplicated)(n.alert)?(0,r.zG)(i,p.fromNullable,p.chain((function(e){return e.alert.rawId})),p.alt((function(){return n.alert.rawId})),p.fold((function(){return e}),(function(t){var r,i=o.bZ.isRemovedByTextChange(n.alert)?A.i5.TextChange:A.i5.RemoveDuplicate;return a._log.debug("[Optimistic update] alert ".concat(o.bZ.State.Type.REMOVED," by ").concat(i," ").concat(s.h.show.show(n))),e.set(i,L(null!==(r=e.get(i))&&void 0!==r?r:[]).concat([w.j.AlertId.from(t)]))}))):e};return e.pipe(l.G(),f.U((0,r.og)(u.p.diff)),f.U((function(e){return m.v.reduce(new Map,(function(e,t){return n(e,t)}),(function(e,t,r){return n(e,r,t)}),r.yR)(e)})),d.h((function(e){return(0,r.zG)(Array.from(e.values()),v.xH,(0,h.ff)(v.xb))})))};var R=n.pipe(d.h(I.e.isSduiEvent),f.U(A.al.fromSource(A.i5.CAPI))),P=(0,r.ls)(i.wQ.Id.create,this._getByRawAlertId,p.map((function(e){return w.j.AlertId.from(e.id)})));this._sduiManager=new b.G(R,P,E),this.alertIdResolver=P,this.state=this._sduiManager.state,this._subs.push(t.subscribe((function(e){return M._sduiManager.notifyAlertsChanged()})),this._toRemovedAlertIdsByClient(t).subscribe((function(e){return e.forEach((function(e,t){return M.pushRemovedAlerts([e,t])}))})),n.pipe(d.h(a.h.is("session_started")),d.h((function(e){return e.isNewSession}))).subscribe((function(e){return M._sduiManager.onSessionStarted()})),n.pipe(d.h(a.h.is("finish")),d.h((function(e){return 0===e.revision}))).subscribe((function(e){return M._sduiManager.onFirstCheckingFinished()})))}var t,n,_;return t=e,(n=[{key:"onAlertsRefEmpty",get:function(){return this._sduiManager.onAlertsRefEmpty}},{key:"pushRemovedRoot",value:function(e){this._sduiManager.pushRemovedRoot(e)}},{key:"pushRemovedAlerts",value:function(e){var t=M(e,2),n=t[0],r=t[1];this._sduiManager.pushRemovedAlerts([n,r])}},{key:"pushRemovedDenaliAlerts",value:function(e){var t=M(e,2),n=t[0],r=t[1];this._sduiManager.pushRemovedAlerts([n.map(w.j.AlertId.from),r])}},{key:"pushSwitchView",value:function(e){this._sduiManager.pushSwitchView(e)}},{key:"resolveStrongAlertRefAlerts",value:function(e){return this._sduiManager.resolveStrongAlertRefAlerts(e)}},{key:"flush",value:function(){this._sduiManager.flush()}},{key:"dispose",value:function(){this._subs.dispose(),this._sduiManager.dispose()}}])&&E(t.prototype,n),_&&E(t,_),e}()},64998:(e,t,n)=>{n.d(t,{i:()=>r});var r,i,a,o=n(57050),s=n(8125),u=n(95195),c=n(5114),l=n(83078),f=n(81531),d=n(35416),h=n(98182),p=n(26393),m=n(79880);function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){g(e,t,n[t])}))}return e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}i=r||(r={}),a=(0,s.HP)(f.C8.Logging.getLogger),(i.DisablePrevNextButtons||(i.DisablePrevNextButtons={})).create=function(e){var t=a("SingleCardAssistant.Transformers.disablePrevNextButtons");return function(n){var r=n.state,i=n.metadata;if(!d.nL.hasItems(r))return t.trace("state has no feed items, returning original state"),u.left({state:r,metadata:i});var a=r;return(0,o.zG)(a.currentLens.cardIndex,c.chain((function(e){return(0,o.zG)(d.In.getActiveItem(r.currentLens),c.map((function(t){return(0,o.bc)(t,e)})))})),c.map((function(t){var n=b(t,2),i=n[0],o=n[1];return d.nL.Prism.getLensWithItems().modify((function(t){if(!h.e.isSDUIItem(i)||!c.isSome(i.cardDSL))return t;var n=e.clone(i),a=l.MH(n.cardDSL),s=!1,u=p.ab.map(a,(function(e){if("button"===e.type&&e.name.value===m.MU.ButtonPrev){var t=0===o?m.BN.Disabled:m.BN.Enabled;return s=s||t!==e.state,y({},e,{state:t})}if("button"===e.type&&e.name.value===m.MU.ButtonNext){var n=o===r.currentLens.items.size-1?m.BN.Disabled:m.BN.Enabled;return s=s||n!==e.state,y({},e,{state:n})}return e}));return c.isSome(u)&&s?(n=Object.assign(n,{cardDSL:u}),y({},t,{items:t.items.add(n)})):t}),a)})),c.getOrElse((function(){return r})),(function(e){return u.left({state:e,metadata:i})}))}}},84174:(e,t,n)=>{n.d(t,{q:()=>W});var r=n(57050),i=n(5114),a=n(95195),o=n(83078),s=n(22232),u=n(71249),c=n(8125),l=n(64015),f=n(81531),d=n(46680),h=n(33678),p=n(74660),m=n(66896),v=n(66268),g=n(14454),y=n(35416),b=n(6100),A=n(9922),w=n(32952),I=n(28043),S=n(77176),_=n(98403),C=n(85985),E=n(19751),M=n(40151),L=n(16892),R=n(21038),P=n(17594),k=n(98182),O=n(52976),j=n(72812),T=n(38983);function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||F(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function B(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||F(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}var V,W=function(){function e(t,n,a,o,s,u,c,p){var m,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:new h.A,g=this;D(this,e),this._checksFeedCapabilities=n,this._lensState=a,this._alertReader=u,this._capiClient=c,this._platformEnvironment=v,this._log=f.C8.Logging.getLogger("SDUICardsViewModelImpl",d.i.DEBUG),this._subs=new A.w.Keeper,this.actionEvents=new w.xQ,this._focusedItem=this._lensState.view((function(e){return y.nL.hasItems(e)?(0,r.zG)(e.currentLens.cardIndex,i.chain((function(t){return e.currentLens.items.getAt(t)}))):i.none})),this._mapToDenaliAlerts=function(e){var t=g;return(0,r.zG)(e,l.fw(i.option)((function(e){return t._alertReader.getById(t._mapToDenaliAlertId(e))})),i.filter(l.Od))},this._sduiAlertIdResolver=(0,j.X)(o.alertIdResolver,this._log);var b=T.h.create(i.none);this._sduiViewModel=new j.x(t,o,s,c,b,v),this.sduiActionEvents=this._sduiViewModel.sduiActionEvents,(m=this._subs).push.apply(m,B(this._integrateCardsViewModel(p)).concat([(0,r.zG)(this._focusedItem,I.x((function(e,t){return i.getEq(L.s.eqById).equals(e,t)})),S.U(i.chain(i.fromPredicate(k.e.isSDUIItem))),S.U(i.map((function(e){return R.j.Item.Id.from(e.id)})))).subscribe(_.wW(b)),this._sduiViewModel]))}var t,n,c;return t=e,n=[{key:"_integrateCardsViewModel",value:function(e){return[this.actionEvents.subscribe(e.actionEvents),e.actionEvents.pipe(C.h(g.t.isSduiCardAction)).subscribe(this.sduiActionEvents)]}},{key:"_sduiActionsHandler",value:function(){var e=this;return this.sduiActionEvents.pipe(E.skipBy(g.t.eq),S.U((function(t){var n=t.cardId,u=t.actions,c=t.scope;return function(t){var f=e;return e._log.info("sdui card action:",{cardId:n,actions:u}),(0,r.zG)(u,l.u4(t,(function(e,t){switch(t.type){case"notify":case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"upgradeToPremium":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"showHighlights":case"hideHighlights":case"selectAlternative":case"openLink":case"copyToClipboard":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":case"switchView":case"newRevision":case"stopApplyingAlerts":case"closePopover":case"interactPopover":case"openGrammarlyGo":case"enablePlagiarismCheck":case"disablePlagiarismCheck":case"openPerformanceScore":return e;case"removeRoot":return(0,r.zG)(e.currentLens.items.get(n),i.map((function(e){return e.value})),i.map(f._checksFeedCapabilities.remove(r.W8,r.W8)),i.map((function(t){return y.nL.Prism.getLens().compose(b.v.Prism.items).set(e.currentLens.items.modifyWith([[t.id,t]],(function(){return t})),e)})),i.getOrElse((0,r.a9)(e)));case"applyAlerts":var u=f;return(0,r.zG)(e.currentLens.items.get(n),i.map((function(e){return e.value})),a.fromOption((function(){return new Error("unknown cardId: ".concat(n))})),a.bimap((function(e){return u._log.error("error in processing applyAlerts action",e)}),(function(e){var n=u;(0,r.zG)(u._sduiAlertIdResolver(c.alertRefs),o.bw((function(a){var o=n;requestAnimationFrame((function(){var n=o;(0,r.zG)(a,o._mapToDenaliAlerts,i.map(l.UI((function(r){return n.actionEvents.next({type:v.lY.Type.alertApply,id:e.id,eligibleForSurvey:r.acceptSurvey,eligibleForGbPrompt:r.gbPrompt,alertId:r.id,alternativeIndex:t.alternativeIndex,cardType:v.lY.getCardType({activeAlert:P.$.fromModel(r)})})}))))}))})))})),(function(){return e.patch({alertSource:p.l$.sidebar})}));case"closeCard":return e.patch({currentLens:y.nL.hasItems(e)?f._checksFeedCapabilities.unselectItem()(e.currentLens):e.currentLens,switchOrder:"lensOrder",alertSource:p.l$.sidebar});case"removeAlerts":var d=f;return(0,r.zG)(f._sduiAlertIdResolver(c.alertRefs),o.bw((function(e){var t=d;requestAnimationFrame((function(){var a=t;(0,r.zG)(e,t._mapToDenaliAlerts,i.map(l.UI((function(e){return a.actionEvents.next({type:v.lY.Type.alertIgnore,id:n,alertId:e.id,eligibleForSurvey:e.dismissSurvey})}))))}))}))),e.patch({alertSource:p.l$.sidebar});case"highlightAlert":return(0,r.zG)(f._sduiAlertIdResolver(c.alertRefs),i.chain(f._mapToDenaliAlerts),i.map((function(n){if(!y.nL.hasItems(e))return e;var o=function(e,n){return function(o){return(0,r.zG)(o.items.update(e,(function(e){return(0,r.zG)(e,i.fromPredicate(O.P.isAlertRefSDUIItem),i.chain(O.P.Capabilities.setActiveAlertId(n)),i.chain(O.P.Capabilities.setActiveHighlightIndex(t.highlightIndex)),i.getOrElse((0,r.a9)(e)))})),a.fold((function(){return o}),(function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){z(e,t,n[t])}))}return e}({},o,{items:e})})))}},s=n[0];return(0,r.zG)(y.In.getActiveItem(e.currentLens),i.map((function(t){return y.nL.Prism.getLensWithItems().modify(o(t.id,s.id),e)})),i.map((function(e){return e.patch({alertSource:p.l$.sidebar})})),i.getOrElse((0,r.a9)(e)))})),i.getOrElse((0,r.a9)(e)));default:(0,s.L0)(t)}})))}})))}},{key:"getApplicatorEffects",value:function(){return(0,r.zG)([[this._sduiActionsHandler(),"sduiActions"]],u.UI((function(e){var t=U(e,2),n=t[0],r=t[1];return{id:"cardsViewModel.effects.".concat(r),when:m.R.isWithAlertsId,what:y.nL.Effect.Applicator.create(n)}})))}},{key:"onAssistantClose",value:function(){this._sduiViewModel.onAssistantClose()}},{key:"dispose",value:function(){this._subs.dispose()}},{key:"_mapToDenaliAlertId",value:function(e){return"".concat(e)}}],n&&G(t.prototype,n),c&&G(t,c),e}();!function(e){e.itemsLens=y.nL.Prism.getLens().compose(b.v.Prism.items),e.createLegacy=function(e,t,n,s,u,c,l){var f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:new h.A,d={enablePlagiarismSearch:function(){return Promise.resolve(a.right(void 0))},disablePlagiarismSearch:function(){return Promise.resolve(a.right(void 0))}};return(0,r.zG)(o.gz(e,s,u),i.fold((function(){return new V.Mock}),(function(e){var r=U(e,3),i=r[0],a=r[1],o=r[2];return new W(i,t,n,a,o,c,d,l,f)})))};e.Mock=function e(){D(this,e),this.actionEvents=new w.xQ,this.sduiActionEvents=new w.xQ,this.sideEffect={id:"cardsViewModelMock",when:m.R.isWithAlertsId,what:y.nL.Effect.Applicator.create(M.E)},this.getApplicatorEffects=function(){return[{id:"cardsViewModelMock",when:m.R.isWithAlertsId,what:y.nL.Effect.Applicator.create(M.E)}]},this.onAssistantClose=c.Q1,this.dispose=c.Q1}}(V||(V={}))}}]);