import{a as Ir}from"./SGC75SOE.js";import{a as Er,c as So,d as Si,e as wr,g as Tr,h as Se,i as bo,j as Pr,k as Br}from"./YFBDBYJ4.js";import{a as Sr}from"./WISI63OG.js";import{a as kr}from"./EWL5FLGU.js";import{a as Vo}from"./TPLPQCTH.js";import{a as Co,b as Cr}from"./OPWMIJWU.js";import{a as Ci}from"./JMRIPDH5.js";import{a as br}from"./UAB7UEHC.js";import{a as yn}from"./XYFFQRMZ.js";import{b as Ar,c as bi}from"./XSP2GWTE.js";import{g as Go}from"./4NAB6M5G.js";import{b as Et,c as _r}from"./DYUK4WZS.js";import{b as vr}from"./CE4P5R6G.js";import{a as Mr}from"./Z3P4JMFA.js";import{$ as Yt,$a as Zn,Ab as xo,Bb as ho,Cb as Lt,Db as zo,E as xt,Ea as Ye,Eb as yo,Fa as xe,Fb as fr,Ga as Zt,Gb as gr,Ha as yt,Hb as Mt,Ia as it,Ib as xr,Ja as $n,Jb as hr,Ka as eo,La as Pe,Lb as yr,Ma as to,Na as oo,Oa as no,Pa as ro,Qa as Uo,Ra as Kn,Sa as qn,Ta as jn,Ua as Yn,Va as Xn,W as Hn,Wa as io,X as Pt,Xa as Jn,Y as Wn,Ya as so,Za as ao,_ as jt,_a as Qn,aa as Jt,ab as er,bb as tr,c as An,cb as or,d as kn,da as Un,db as Ct,e as ke,ea as zn,eb as lo,f as Rn,fa as Bt,fb as St,gb as nr,hb as rr,ib as uo,j as Fn,ja as Gn,jb as ir,ka as ht,lb as sr,mb as co,nb as ar,ob as lr,pb as po,qb as ur,rb as bt,s as On,sb as fo,ub as go,v as rt,vb as dr,x as ge,y as Nn,z as We}from"./R7ESC43Z.js";import{c as qt,d as kt}from"./F7SGTV27.js";import{a as Je}from"./5QWZ7UE4.js";import{l as ue}from"./FOUKVBQX.js";import{i as Re,j as gt}from"./XYZAUIQ2.js";import{c as Kt}from"./QONG524O.js";import{b as Ee,o as Pn,r as Dn}from"./ES4G5FSE.js";import{c as $t,f as Ln}from"./6UCR6JSM.js";import{a as D,c as Bn}from"./IPNS2UUO.js";import{d as K}from"./FRAG5SMK.js";import{a as z,b as vn,u as G}from"./DRCUZC3I.js";import{g as hn}from"./PF3XPTWR.js";import{d as dt,e as Ro,h as ot,j as Do,n as xn}from"./MWTIYFYH.js";import{ga as mo,ia as Xe,ja as It,ka as cr,la as pr,ma as mr,s as Xt}from"./IQBPRLVE.js";import{s as Tn}from"./HEBGDMW5.js";import{a as Wo}from"./6LS5XNTR.js";import{a as ft}from"./W2F53U5Z.js";import{d as wn,e as ne,g as He,i as _n,k as Me}from"./TYBXNNUH.js";import{a as Vn,b as Qt}from"./DUIWQHLB.js";import{$ as En,B as In,N as Ho,O as Le,T as Mn,U as At,V as Gt,_ as Vt,a as Ut,d as Sn,e as je,h as zt,n as Ne,r as bn}from"./AAMCXCLO.js";import{c as H}from"./CAPNT4IP.js";import{d as Ae,e as Cn}from"./YN4XY6JW.js";import{M as Oo,P as No,U as qe,V as gn,a as N,b as Lo,f as j,g as Q,h as le,l as nt,m as Fo,n as Ht,r as Ke,s as mn,t as dn,u as vt,v as Wt,w as fn}from"./IPAGS25B.js";import{a as pn}from"./3JX3VARJ.js";import{c as cn,f as k}from"./PQ35KENF.js";var jr=cn(Mo=>{"use strict";var Ri=vn();Object.defineProperty(Mo,"__esModule",{value:!0});Mo.default=void 0;var Di=Ri(Bn()),Fi=xn(),Oi=(0,Di.default)((0,Fi.jsx)("path",{d:"M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"KeyboardArrowRight");Mo.default=Oi});var Yr=cn(Eo=>{"use strict";var Ni=vn();Object.defineProperty(Eo,"__esModule",{value:!0});Eo.default=void 0;var Hi=Ni(Bn()),Wi=xn(),Ui=(0,Hi.default)((0,Wi.jsx)("path",{d:"M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"}),"KeyboardReturn");Eo.default=Ui});var v=k(N());var $o=k(Ci()),re=k(N());br($o.default);Ir($o.default);var Qe=new ft("ContextMenu/Rangy"),Ii=new zt({runtime:"client"}),Mi=()=>{let{show:o,initRangyCore:t,rangy:e,showRangy:n,hideRangy:r,saveTempSelection:i,currentSelection:a}=Pe(),s=j(qe).userSettings,{chatBoxShortCutKey:u}=Je(),[c,p]=Q(xe),{currentSidebarConversationMessages:m}=ge(),[,h]=Q(eo),g=le(Zt);fr();let[y,b]=Q(yt),f=(0,re.useRef)(null),x=(0,re.useRef)(null),{showFloatingContextMenuWithVirtualElement:E}=Mt();Le(()=>{Promise.all([import("./3VSRMID4.js"),import("./5FYG5HQB.js"),import("./PZGV7OON.js")]).then(([{default:w},{default:S},{default:O}])=>{let P=()=>{t(w)};S(w),O(w),w.init(),w.addInitListener(P)})});let d=(0,re.useRef)(o);(0,re.useEffect)(()=>{d.current=o},[o]);let A=(0,re.useCallback)(w=>{{if(d.current&&w instanceof KeyboardEvent&&w.key==="Escape"){Qe.info("Escape close floating button"),r(),xo(),ho();return}let S=w.target,O=w instanceof MouseEvent,P=yo(),Z=(e.getSelection().toString()||document?.getSelection()?.toString()||"").trim().replace(/\u200B/g,"");if(S){if(S&&(S.id===Ht||S.id===Wt||S.id===dn))return;if(f.current&&(S=f.current),P){let Te=Lt(P);Te.isEditableElement&&(S=Te.editableElement)}if(!S)return;let{editableElement:X}=Lt(S);if(X&&(S=X),!X&&!Z){r(),x.current=null;return}x.current=zo(S,{target:S,eventType:O?"mouseup":"keyup"}),Qe.info(`native selection [${O?"mouse":"keyboard"}]: 	`,x.current,S)}let U=!1,R=!1;x.current&&(x.current?.isEditableElement?(U=!0,(x.current?.editableElementSelectionText||e.getSelection()?.toString()||document.getSelection()?.toString())&&(R=!0)):x.current?.selectionText&&(U=!0,R=!0),U&&(i({selectionText:x.current?.editableElementSelectionText||x.current.selectionText,selectionHTML:x.current?.editableElementSelectionText||x.current.selectionHTML,selectionRect:x.current.selectionRect,activeElement:x.current.target,selectionInputAble:x.current?.isEditableElement,selectionElement:x.current}),Qe.info("save selection temp data",x.current?.isEditableElement,`
`,x.current?.editableElementSelectionText,`
`,x.current?.selectionText)),R?(Qe.info("show floating button"),n()):(Qe.info("hide floating button"),r()))}},[e,i,n,r]),Y=(0,re.useRef)(A);(0,re.useEffect)(()=>{Y.current=A},[A]);let F=(0,re.useRef)(()=>{});(0,re.useEffect)(()=>{let w=Ne(Y.current,200),S=Ne(Y.current,200),O=P=>{F.current(),F.current=gr(X=>{if(!X.selectionText&&(r(),!X.isEditableElement)){x.current=null;return}x.current=X,X.selectionText&&(X.eventType==="mouseup"?w({target:null}):S({target:null}))});let Z=P.target,{isEditableElement:U,editableElement:R}=Lt(Z);if(U&&R){if(f.current?.isSameNode(R))return;f.current&&(f.current.removeEventListener("mouseup",w),f.current.removeEventListener("keyup",S)),Qe.info("save targetElement ref",R),f.current=R,R.addEventListener("mouseup",w),R.addEventListener("keyup",S)}else Qe.info("clear targetElement ref"),f.current=null};return document.addEventListener("mousedown",O),()=>{document.removeEventListener("mousedown",O),f.current&&(f.current.removeEventListener("mouseup",w),f.current.removeEventListener("keyup",S))}},[e,u,s?.shortcutHintEnable]),(0,re.useEffect)(()=>{let w=Ne(Y.current,200),S=Ne(Y.current,200),O=()=>{};return e?.initialized&&(document.addEventListener("mouseup",w),document.addEventListener("keyup",S),O=Mr(P=>{if(!P.selectionText&&(r(),!P.isEditableElement)){x.current=null;return}x.current=P,P.selectionText&&(P.eventType==="mouseup"?w({target:null}):S({target:null})),P.isEmbedPage&&P.selectionText&&P?.tagName==="BUTTON"&&Er(),P.selectionText||p(Z=>({...Z,open:!1}))})),()=>{document.removeEventListener("mouseup",w),document.removeEventListener("keyup",S),O()}},[e]),En(async(w,S,O)=>{switch(w){case"Client_listenOpenChatMessageBox":{let P=window.getSelection()?.rangeCount;if(P&&P>0){let R=window.getSelection()?.getRangeAt(0)?.cloneRange();g({range:R||null,selectionText:window?.getSelection()?.toString()||""})}let{command:Z}=S,U=Z==="show-floating-menu";if(!x.current){let R=yo(),{editableElement:X,isEditableElement:Te}=Lt(R);Te&&X&&(x.current=zo(X,{target:X,eventType:"keyup"}))}return Qe.info("Client_listenOpenChatMessageBox",x.current?.isEditableElement,x.current?.selectionText),E(x.current,{},U),x.current&&(x.current=null),{success:!0,data:{},message:""}}break}});let oe=(0,re.useRef)("");(0,re.useEffect)(()=>{oe.current=y.lastOutput},[y.lastOutput]);let fe=(0,re.useRef)(a?.selectionElement);(0,re.useEffect)(()=>{fe.current=a?.selectionElement},[a]),(0,re.useEffect)(()=>{let w=fe.current||x.current,S=["REPLACE_SELECTION","INSERT_BELOW","INSERT","INSERT_ABOVE","DISCARD","COPY"],O=po(y.selectContextMenuId||"");if(O)switch(S.includes(O)&&(g({range:null,selectionText:""}),p({open:!1,rootRect:null}),b({selectContextMenuId:"",lastOutput:""}),r(),x.current=null),O){case"INSERT_BELOW":case"INSERT":case"INSERT_ABOVE":case"REPLACE_SELECTION":w&&Ii.postMessage({event:"Client_updateIframeInput",data:{value:oe.current,type:O,startMarkerId:w.startMarkerId,endMarkerId:w.endMarkerId,caretOffset:w.caretOffset}});break;case"TRY_AGAIN":{let P="";if(m.length>0){let Z=!1;for(let U=m.length-1;U>=0;U--){let R=m[U];if(R.type==="user"&&(Z=!0),Z&&R.type==="ai"){P=R.messageId;break}}}h({lastAIMessageId:P})}break;case"COPY":try{let P=document.createElement("textarea");P.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,P.value=oe.current,document.body.appendChild(P),P.select(),document.execCommand("copy",!1,""),P.remove()}catch{}break;default:break}},[y.selectContextMenuId]),(0,re.useEffect)(()=>{c.open||g(w=>{if(w.range){window.getSelection()?.removeAllRanges(),window.getSelection()?.addRange(w.range);let S=yo();if(S&&(S.tagName==="INPUT"||S.tagName==="TEXTAREA")){let O=S,P=O.value.indexOf(w.selectionText||""),Z=P+(w.selectionText||"").length;O.focus(),O.setSelectionRange(P,Z)}setTimeout(()=>{let O=new KeyboardEvent("keyup",{key:" ",code:"Space",location:0,bubbles:!0,cancelable:!0,shiftKey:!1});(S||document.body).focus(),(S||document.body).dispatchEvent(O)},0)}return{...w,range:null}})},[c.open])},Lr=Mi;var yi=k(Lo());var st=k(N());var Ei=()=>{let{updateSidebarConversationType:o,currentSidebarConversationType:t}=ge(),[e,n]=(0,st.useState)({origin:"",taskId:"",actions:[]}),{setShortCuts:r,runShortCuts:i,loading:a}=Se(""),l=(0,st.useRef)(!1);(0,st.useEffect)(()=>{e.taskId&&t==="Chat"&&!l.current&&(l.current=!0,r(e.actions),i().then(()=>{window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:e.taskId,data:{success:!0,error:""}},e.origin)}).catch(s=>()=>{window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:e.taskId,data:{success:!1,error:"Network error."}},e.origin)}).finally(()=>{n({taskId:"",actions:[],origin:""}),l.current=!1}))},[t,e,r,i]),(0,st.useEffect)(()=>{let s=async u=>{if(u.data?.id==="USECHATGPT_WEB_INJECT"){let{taskId:c,type:p,data:m}=u.data;switch(p){case"ping":window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"pong",taskId:c,data:{success:!0}},u.origin);break;case"runShortCutActions":{let{actions:h}=m;l.current?window.postMessage({id:"USECHATGPT_WEB_INJECT_RESPONSE",type:"runShortCutActionsResponse",taskId:c,data:{success:!1,error:"shortcuts is running"}},u.origin):(o("Chat"),n({origin:u.origin,taskId:c,actions:h}));break}}}};return window.addEventListener("message",s),()=>{window.removeEventListener("message",s)}},[a,r,i])},Rr=Ei;var De=k(N());var at=k(N());var wi=()=>{let{updateSidebarSettings:o,currentSidebarConversationId:t,currentSidebarConversationType:e}=ge(),n=le(ke),r=Jt(),{currentUserPlan:i}=We(),{setShortCuts:a,runShortCuts:l}=Se(""),[s,u]=(0,at.useState)([]),{createConversation:c}=ht(),p=(0,at.useRef)(!1),m=(0,at.useRef)(""),h=async()=>{if(p.current)return;await At("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS",!0);let g=Pt();if(n(y=>({...y,loading:!0})),g){let y=await Bt(g);if(y?.id)if(await o({summary:{conversationId:g}}),y.messages?.find(b=>b.type==="ai")){n(b=>({...b,loading:!1}));return}else await rt("clear",g,0,[]);try{if(await c(),n(x=>({...x,loading:!1})),i.name!=="pro"&&i.name!=="elite"){let x=Number((await Gt()).ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES)||0;if(x>0)await At("ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES",x-1);else{await rt("clear",g,0,[]),await rt("add",g,0,[Xt(r.PAGE_SUMMARY)]),jt("show","PAGE_SUMMARY");return}}let{actions:b,messageId:f}=Hn(Wn());m.current=f,u(b)}catch{}}};return(0,at.useEffect)(()=>{s.length>0&&!p.current&&e==="Summary"&&t&&(p.current=!0,a(s)?l().then().catch().finally(()=>{p.current=!1,u([]);let g=Pt();g&&m.current&&rt("update",g,0,[{messageId:m.current,originalMessage:{metadata:{sources:{status:"complete"},isComplete:!0}}}]).then().catch()}):(u([]),p.current=!1))},[l,u,e,t,s]),{createPageSummary:h}},Dr=wi;var lt=k(N()),_i=()=>{let[o,t]=(0,lt.useState)(""),e=(0,lt.useRef)(""),n=(0,lt.useRef)(document.title),r=(0,lt.useRef)(0),i=(0,lt.useRef)(null),a=()=>{l(),i.current=setInterval(()=>{let s=window.location.href;if(!e.current){n.current=document.title,e.current=s;return}if(s===e.current){n.current=document.title;return}s!==e.current&&(r.current=0),n.current!==document.title?(r.current=0,n.current=document.title,e.current=s,t(s)):(r.current+=1,r.current>10&&(r.current=0,n.current=document.title,e.current=s,t(s)))},1e3)},l=()=>{i.current&&clearInterval(i.current)};return{pageUrl:o,startListen:a,stopListen:l}},Fr=_i;var Ti=()=>{let{createPageSummary:o}=Dr(),{pageUrl:t,startListen:e}=Fr(),{sidebarSettings:n,currentSidebarConversationType:r,currentSidebarConversationId:i,updateSidebarSettings:a,updateSidebarConversationType:l}=ge(),s=le(kn),{switchBackgroundChatSystemAIProvider:u}=ht(),{continueInSearchWithAI:c}=bo(),p=(0,De.useRef)("Chat"),m=(0,De.useRef)(n),h=zn(n?.summary?.conversationId);(0,De.useEffect)(()=>{m.current=n},[n]),(0,De.useEffect)(()=>{if(r){switch(r){case"Chat":break;case"Summary":o().then().catch().finally(()=>{e()});break;case"Search":break}p.current=r}},[r]),(0,De.useEffect)(()=>{r==="Summary"&&h&&!i&&o().then().catch().finally()},[i,r]),Ho(()=>{p.current==="Summary"&&a({summary:{conversationId:Pt()}})}),(0,De.useEffect)(()=>{p.current==="Summary"&&l("Chat")},[t]);let g=(0,De.useRef)(i);(0,De.useEffect)(()=>{let y=!1;return i&&Bt(i).then(async b=>{b?.meta.AIProvider&&(y||await u(b.meta.AIProvider,b.meta.AIModel))}),g.current=i,()=>{y=!0}},[i]),(0,De.useEffect)(()=>{let y=b=>{let f=b?.detail?.aiMessage;f&&c(f).then().catch()};return window.addEventListener("MaxAIContinueSearchWithAI",y),()=>{window.removeEventListener("MaxAIContinueSearchWithAI",y)}}),Ho(()=>{if(g.current){let y=new Date().getTime();Bt(g.current).then(b=>{b&&s(f=>({...f,[b.id]:b}))})}})},Or=Ti;var sn=k(pn());var Nr=()=>{Vt(async(o,t,e)=>{switch(o){case"ShortCuts_ClientExecuteOperationPageElement":{let{taskId:n,OperationElementConfig:r}=t;return n?(await Ar(n,r),{success:!0,data:!0,message:"ok"}):{success:!1,message:"No taskId",data:null}}break;default:break}})};var Hr=k(N());var vi={inviteLink:o=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText||"").trim()||`Sign up on MaxAI.me using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${o}`},ut=vi;var Ai=()=>{let{userInfo:o}=We(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Se();return{autoTwitterReferral:(0,Hr.useCallback)(async()=>{if(!n){let a=ut.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:`https://twitter.com/intent/tweet?text=${a}`}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetButton"]'],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['a[data-testid="AppTabBar_Profile_Link"]'],actionType:"click",afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="tweetText"]'],actionType:"getText",executeElementCount:10}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://twitter.com/MaxAI_HQ"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-testid="1667007582270296064-follow"]'],actionType:"click",beforeDelay:2e3,afterDelay:3e3}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")l=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let m=p.parameters.WFFormValues?.Value===!0;Et(`[Referral] One-click button [Linkedin] ${m?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:m,shareLink:`[ ${l} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),m&&xt("/user/complete_referral",{referral_types:["TWITTER_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[n,e,t,o?.referral_code]),autoTwitterReferralLoading:n}},Wr=Ai;var Ur=k(N());var ki=()=>{let{userInfo:o}=We(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Se();return{autoFacebookReferral:(0,Ur.useCallback)(async()=>{if(!n){let a=ut.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["textarea[title]"],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:ut.inviteLink(o?.referral_code||"")},beforeDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['button[name="__CONFIRM__"]'],actionType:"click",afterDelay:3e3}}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.facebook.com/profile.php"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[data-ad-preview="message"]','div[data-ad-comet-preview="message"]'],executeElementCount:10,actionType:"getText",beforeDelay:2e3}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:a.slice(0,10),WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l=(s,u)=>{let c=u?.action;if(s==="afterRunAction"&&c?.type==="SET_VARIABLE"&&c.parameters?.VariableName==="AutoTwitterReferralResult"){let p=c.parameters.WFFormValues?.Value===!0;Et(`[Referral] One-click button [Facebook] ${p?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:p},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),p&&xt("/user/complete_referral",{referral_types:["FACEBOOK_SHARE"]}).then()}};return r.current?.addListener(l),await e(),r.current?.removeListener(l),!0}return!1},[n,e,t,o?.referral_code]),autoFacebookReferralLoading:n}},zr=ki;var Gr=k(N());var Pi=()=>{let{userInfo:o}=We(),{setShortCuts:t,runShortCuts:e,loading:n,shortCutsEngineRef:r}=Se();return{autoLinkedinReferral:(0,Gr.useCallback)(async()=>{if(!n){let a=ut.inviteLink(o?.referral_code||"");t([{type:"OPEN_URLS",parameters:{URLActionURL:"https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"}},{type:"SET_VARIABLE",parameters:{VariableName:"OperationElementTabID"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.artdeco-button"],actionType:"click",beforeDelay:2e3,afterDelay:2e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:['div[contenteditable="true"]'],actionType:"insertText",actionExtraData:{clearBeforeInsertText:!0,text:a},afterDelay:1e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["button.share-actions__primary-action"],actionType:"click",afterDelay:3e3}}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__view-btn"],actionType:"getLink"}}},{type:"SET_VARIABLE",parameters:{VariableName:"SHARE_POST_LINK"}},{type:"OPERATION_ELEMENT",parameters:{OperationElementConfig:{elementSelectors:["a.inshare-success-state__continue-btn"],actionType:"getText"}}},{type:"SCRIPTS_CONDITIONAL",parameters:{WFCondition:"Contains",WFMatchTextCaseSensitive:!1,WFFormValues:{Value:"linkedin",WFSerializationType:"WFDictionaryFieldValue"},WFConditionalIfTrueActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!0,WFSerializationType:"WFDictionaryFieldValue"}}}],WFConditionalIfFalseActions:[{type:"SET_VARIABLE",parameters:{VariableName:"AutoTwitterReferralResult",WFFormValues:{Value:!1,WFSerializationType:"WFDictionaryFieldValue"}}}]}},{type:"CLOSE_URLS",parameters:{}},{type:"OPEN_URLS",parameters:{URLActionURL:"current_page"}}]);let l="",s=(u,c)=>{let p=c?.action;if(u==="afterRunAction"&&p?.type==="SET_VARIABLE"){if(p.parameters?.VariableName==="SHARE_POST_LINK")l=p.output;else if(p.parameters?.VariableName==="AutoTwitterReferralResult"){let m=p.parameters.WFFormValues?.Value===!0;Et(`[Referral] One-click button [Linkedin] ${m?"Success":"Fail"}`,JSON.stringify({email:o?.email||"unknown",success:m,shareLink:`[ ${l} ]`},null,4),{uuid:"608156c7-e65d-4a69-a055-6c10a6ba7217"}).then().catch(),m&&xt("/user/complete_referral",{referral_types:["LINKEDIN_SHARE"]})}}};return r.current?.addListener(s),await e(),r.current?.removeListener(s),!0}return!1},[n,e,t,o?.referral_code]),autoLinkedinReferralLoading:n}},Vr=Pi;var Io=k(N());var Bi=()=>{let{autoTwitterReferral:o}=Wr(),{autoFacebookReferral:t}=zr(),{autoLinkedinReferral:e}=Vr(),n=(0,Io.useRef)({});(0,Io.useEffect)(()=>{n.current={twitter:o,linkedin:e,facebook:t}},[o,e,t]),Le(()=>{Oo&&location.href.includes(Oo)&&setInterval(()=>{let r=document.querySelector("#appMaxAIReferralShareOneClickContainer"),i=document.querySelector("#appMaxAIReferralShareOneClickButton");if(r&&i){if(!r.classList.contains("loaded"))r.classList.add("loaded");else return;i.addEventListener("click",async()=>{let a=Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));for(let c=0;c<a.length;c++){let m=a[c].getAttribute("data-name"),h=n.current?.[m];h&&await h()}await(c=>new Promise(p=>setTimeout(p,c)))(3e3);let s=new URL(window.location.href),u=new URLSearchParams(s.search);u.set("show_completed","true"),s.search=u.toString(),window.location.href=s.toString()})}},1e3)})},$r=Bi;var Kr=k(bi());var Li=()=>{let o=new Map,t=new zt,e=async(n,r,i)=>{await t.postMessage({event:"Client_ListenProxyWebsocketResponse",data:{data:r,taskId:n,listenerType:i}})};Vt(async(n,r)=>{switch(n){case"Client_ListenProxyWebsocket":{let{taskId:i,data:a,type:l}=r;switch(l){case"Open":{let s=a.mode,u=new Kr.default(a.url,s==="bing"?{packMessage:Go.packMessage,unpackMessage:Go.unpackMessage}:{});return u.onUnpackedMessage.addListener(c=>{e(i,c,"onUnpackedMessage")}),u.onMessage.addListener(async c=>{e(i,c,"onMessage")}),u.onClose.addListener(()=>{e(i,{},"onClose")}),await u.open(),o.set(i,u),{success:!0,data:"success",message:"ok"}}break;case"Close":{let s=o.get(i);return s?(s.removeAllListeners(),await s.close(),o.delete(i),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;case"SendPacked":{let s=o.get(i);return s?(s.sendPacked(a),{success:!0,data:"success",message:"ok"}):{success:!1,message:"websocket not found",data:!1}}break;default:return{success:!0,data:"success",message:"ok"}}}break}})},qr=Li;var et=k(N());var $e=k(N()),oi=k(Lo());Ro();Do();var M=k(N());var ce=k(N());var I=k(N());var be=k(N());var Ko=k(jr()),Jr=k(Yr());var pe=I.forwardRef(({label:o,icon:t,CustomRenderNode:e,onClick:n,isGroup:r,...i},a)=>{let l=i;return I.createElement(D,{...i,sx:{boxSizing:"border-box",borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:s=>s.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:a,component:"div",role:"menuitem",onClick:s=>{n?.(s),l?.onClick?.(s)}},I.createElement(D,null,e||I.createElement(z,{direction:"row",spacing:1,px:1,alignItems:"center"},I.createElement(ue,{size:16,icon:t||"Empty",sx:{color:"primary.main",flexShrink:0}}),I.createElement(G,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},o),r&&I.createElement(Ko.default,{sx:{ml:"auto",mr:0,flexShrink:0,color:s=>s.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}))))}),qo=I.forwardRef(({label:o,disabled:t,menuItem:e,...n},r)=>{let i=n,{t:a}=H(["prompt"]),l=j($n),[s,u]=Q(it),c=(0,be.useMemo)(()=>{let h=e.id.replace(It,""),g=`prompt:${h}`;return a(g)!==h?a(g):e.text},[e.text,a]),p=(0,be.useMemo)(()=>l.includes(e.id)||e.id===s.lastHoverContextMenuId,[l,s.lastHoverContextMenuId]),m=(0,be.useMemo)(()=>s.lastHoverContextMenuId===e.id&&p,[p,s.lastHoverContextMenuId]);return I.createElement(D,{...n,"data-id":e.id,className:`floating-context-menu-item ${p?"floating-context-menu-item--active":""}`,tabIndex:p?0:-1,sx:{display:"flex",alignItems:"center",flexDirection:"row",gap:1,boxSizing:"border-box",px:1,borderRadius:"3px",height:"28px",fontSize:"14px",width:"100%",cursor:"pointer","&.floating-context-menu-item--active":{bgcolor:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}},"& .floating-context-menu-item__footer-icon":{display:"none",flexShrink:0},"& .floating-context-menu-item__footer-icon--active":{display:"flex"},"&:hover":{bgcolor:h=>h.palette.mode==="dark"?"rgba(255, 255, 255, 0.08)":"rgba(55, 53, 47, 0.08)","& .floating-context-menu-item__footer-icon":{display:"flex"}}},ref:r,component:"div",role:"menuitem",onKeyDown:h=>{i?.onKeyDown?.(h),h.code==="Enter"&&(u(g=>({...g,selectedContextMenuId:e.id})),h.stopPropagation())},onClick:h=>{u(g=>({...g,selectedContextMenuId:e.id})),i?.onClick?.(h)}},e?.data?.icon&&I.createElement(ue,{size:16,icon:e.data.icon,sx:{color:"primary.main",flexShrink:0}}),I.createElement(G,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},c),I.createElement("span",{className:"floating-context-menu-item__footer-icon "+(e.data.type==="group"?"floating-context-menu-item__footer-icon--active":"")},e.data.type==="group"?I.createElement(Ko.default,{sx:{color:h=>h.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}}):m&&I.createElement(Jr.default,{sx:{color:h=>h.palette.mode==="dark"?"#ffffff85":"rgba(55, 53, 47, 0.45)",fontSize:16}})))}),Xr=I.forwardRef(({referenceElement:o,referenceElementOpen:t,zIndex:e,children:n,label:r,root:i,hoverOpen:a=!0,customOpen:l=!1,needAutoUpdate:s=!1,menuSx:u,defaultPlacement:c,defaultFallbackPlacements:p,onClickContextMenu:m,onClickReferenceElement:h,menuWidth:g=400,...y},b)=>{let f=Kn(),x=qn(),E=Uo(),d=!E&&e===2147483601,[A,Y]=Q(it),F=E!=null,[oe,fe]=I.useState(l?t:!1);(0,be.useEffect)(()=>{setTimeout(()=>{fe(t)},1)},[t]);let[w,S]=I.useState(d?1:null),O=j(xe),[P,Z]=I.useState(!1),U=(0,be.useRef)(null),R=(0,be.useRef)(null),X=I.useRef([]),Te=I.useRef(I.Children.map(n,_=>I.isValidElement(_)?_.props.label:null)),ko=c||(d?"bottom-start":"right-start"),Po=p||(d?["bottom-start","top-start","right"]:["right","right-start","right-end","left","left-start","left-end"]),Ue=()=>{S(null),R.current=null,U.current=null},{x:_t,y:Bo,strategy:ct,refs:pt,context:Oe}=Ct({nodeId:x,open:oe,onOpenChange:_=>{_||Ue(),!l&&fe(_)},placement:ko,middleware:[oo({mainAxis:d?4:0,alignmentAxis:d?0:-4}),to({fallbackPlacements:Po}),no()],whileElementsMounted:s?ro:void 0}),tt=Xn(Oe,{enabled:a&&P,delay:{open:75},handleClose:or({restMs:25,blockPointerEvents:!1})}),Tt=so(Oe,{event:"mousedown",toggle:!F||!P,ignoreMouse:F}),Dt=er(Oe,{role:"menu"}),Ft=ao(Oe),ze=(0,be.useRef)(null),C=Qn(Oe,{listRef:X,activeIndex:w,nested:F,onNavigate(_){let J=()=>{let $=ne()?.querySelector(`#${Ke}`);$&&$?.focus()},L=E?"[\u5B50\u7EA7]":"[\u6839\u7EA7]",ae=ze.current?.key;if(ae){let $=!1,he=null;R.current&&($=!0,he=wo(R.current));let ee=[];X.current?.forEach((Ce,Nt)=>{let ve=Ce?.getAttribute("data-id");ve&&ee.push({floatingUIId:Ce?.id?.replace(/:/g,"\\:")||"",contextMenuId:ve,contextMenuIndex:Nt})}),Y(Ce=>{let Nt=Ce.hoverContextMenuIdMap[x]||Ce.lastHoverContextMenuId||"";$&&he?.contextMenuId&&(Nt=he.contextMenuId);let ve=ee.findIndex(mt=>mt.contextMenuId===Nt);if(ae==="ArrowLeft")return S(null),J(),{...Ce,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...Ce.hoverContextMenuIdMap,[x]:""}};if(ae==="ArrowRight")if(ee.length>0){let mt=ee[0];return S(mt.contextMenuIndex),J(),{...Ce,lastHoverContextMenuId:mt.contextMenuId}}else return S(null),J(),{...Ce,lastHoverContextMenuId:null,hoverContextMenuIdMap:{...Ce.hoverContextMenuIdMap,[x]:""}};let an=!1,ln=ze.current?.target,un=ln?.getAttribute("data-lastid");if(un&&(ve=ee.findIndex(mt=>mt.floatingUIId===un),ln.removeAttribute("data-lastid"),an=!0),ve===-1&&(E||(ve=0)),ve===-1)return J(),Ce;let Ve=null;return ae==="ArrowDown"?an||$?Ve=ee[ve]:ee[ve+1]?Ve=ee[ve+1]:Ve=ee[0]:ae==="ArrowUp"&&(ee[ve-1]?Ve=ee[ve-1]:Ve=ee[ee.length-1]),Ve?(S(Ve.contextMenuIndex),J(),{...Ce,hoverContextMenuIdMap:{...Ce.hoverContextMenuIdMap,[x||""]:Ve.contextMenuId},lastHoverContextMenuId:Ve.contextMenuId}):(J(),Ce)}),ze.current=null}},loop:!0,virtual:!0}),B=tr(Oe,{enabled:oe,listRef:Te,onMatch:oe?S:void 0,activeIndex:w}),{getReferenceProps:V,getFloatingProps:Ie,getItemProps:se}=lo([tt,Tt,Dt,Ft,C,B]);I.useEffect(()=>{if(!f)return;function _(){l||fe(!1)}function J(L){L.nodeId!==x&&L.parentId===E&&fe(!1)}return f.events.on("click",_),f.events.on("menuopen",J),()=>{f.events.off("click",_),f.events.off("menuopen",J)}},[f,x,E,l]),I.useEffect(()=>{oe&&f&&f.events.emit("menuopen",{parentId:E,nodeId:x})},[f,oe,x,E]),I.useEffect(()=>{function _({pointerType:L}){L!=="touch"&&Z(!0)}function J(){Z(!1)}return window.addEventListener("pointermove",_,{once:!0,capture:!0}),window.addEventListener("keydown",J,!0),()=>{window.removeEventListener("pointermove",_,{capture:!0}),window.removeEventListener("keydown",J,!0)}},[P]),(0,be.useEffect)(()=>{let _=!1;return d&&A.lastHoverContextMenuId&&n&&setTimeout(()=>{_||S(J=>{let L=n.findIndex(ae=>ae?.key===A.lastHoverContextMenuId);return L!==-1&&J===null?L:J})},0),()=>{_=!0}},[A.lastHoverContextMenuId,n]);let Ge=Zn([pt.setReference,b]),Ot=(0,be.useCallback)(()=>{let _=A.lastHoverContextMenuId;if(_){let J=ne()?.querySelector(`[data-id="${_}"]`);J&&J.dispatchEvent(new KeyboardEvent("keydown",{key:"Enter",bubbles:!0,cancelable:!0,code:"Enter",keyCode:13}))}},[A]);return(0,be.useEffect)(()=>{O.open||(Ue(),Y(_=>({..._,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})))},[O.open]),I.createElement(jn,{id:x},o?I.isValidElement(o)&&I.cloneElement(o,{...V({...y,className:`${F?"MenuItem":"RootMenu"}`,onClick(_){_.stopPropagation(),h?.(_)},onKeyDownCapture(_){if(_.key==="Enter"&&!E){Ot();return}if(_.key==="ArrowDown"||_.key==="ArrowUp"||_.key==="ArrowLeft"||_.key==="ArrowRight"){if(R.current=null,_.key==="ArrowLeft"){if(!E&&U.current){let L=wo(U.current);L?.parentDropdownSelectedItem&&(L.dropdownSelectedItem.focus(),L.dropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:_.key,bubbles:!0,cancelable:!0})),L.parentDropdownSelectedItem&&L.id&&(L.parentDropdownSelectedItem.setAttribute("data-lastid",L.id),L.parentDropdownSelectedItem.focus(),L.parentDropdownSelectedItem.classList.contains("RootMenu")?U.current=null:U.current=L.parentDropdownSelectedItem,L.parentDropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))))}return}else if(_.key==="ArrowRight"&&!E&&w!==null){let L=X.current[w];if(U.current){let ae=U.current?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),$=ne()?.querySelector(`#${ae}`);if($){let he=$.getAttribute("aria-activedescendant")?.replace(/:/g,"\\:"),ee=$.querySelector(`#${he}`);ee.id&&ee.getAttribute("aria-haspopup")&&(L=ee)}}L&&L.getAttribute("aria-haspopup")==="menu"&&(L.focus(),L.dispatchEvent(new KeyboardEvent("keydown",{key:_.key,bubbles:!0,cancelable:!0})),U.current=L);return}else if(U.current){U.current.focus(),U.current.dispatchEvent(new KeyboardEvent("keydown",{key:_.key,bubbles:!0,cancelable:!0}));return}ne()?.querySelector(`#${Ke}`)?.focus(),ze.current=_}},...F&&{role:"menuitem"},ref:Ge})}):I.createElement(K,{ref:Ge,...V({...y,className:`${F?"MenuItem":"RootMenu"}`,onClick(_){_.stopPropagation()},...F&&{role:"menuitem"}}),startIcon:I.createElement(Ee,{sx:{fontSize:16,color:"inherit"}}),variant:"outlined"},r||"Use ChatGPT"),I.createElement(io,{root:i},oe&&I.Children.count(n)&&I.createElement(Jn,{context:Oe,modal:!1,initialFocus:-1,visuallyHiddenDismiss:!0},I.createElement(D,{sx:{zIndex:(e||0)+1,display:"flex",flexDirection:"column",p:.5,outline:"none!important",width:g,maxHeight:327,boxSizing:"border-box",overflowY:"auto",border:"1px solid",borderColor:"customColor.borderColor",bgcolor:"background.paper",borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px","& *":{outline:"none!important"},"&:has(.max-ai--popper-wrapper)":{overflowY:"unset"},...u},component:"div",ref:pt.setFloating,className:"Menu",style:{position:ct,top:Bo??0,left:_t??0},...Ie()},I.Children.map(n,(_,J)=>I.isValidElement(_)&&I.cloneElement(_,se({tabIndex:w===J?0:-1,ref(L){X.current[J]=L},onMouseDown(L){m&&(f?.events.emit("click"),_.props?.menuItem?.data?.type==="shortcuts"&&m?.(_.props.menuItem))},onClick(L){m||(_.props.onClick?.(L),f?.events.emit("click"))},onKeyDownCapture(L){ze.current=L},onMouseEnter(L){L.stopPropagation(),L.preventDefault();let ae=L.currentTarget;if(ae.getAttribute("data-id")){U.current=ae;let $=wo(ae);if(($?.id||$?.contextMenuId)&&$.expandedSiblingMenuItem){if($.expandedSiblingMenuItem?.getAttribute("data-id")===$.contextMenuId)return;let he=wo($.expandedSiblingMenuItem);if(he?.dropdownSelectedItem){let ee=new KeyboardEvent("keydown",{key:"ArrowLeft",bubbles:!0,cancelable:!0});R.current=he.dropdownSelectedItem,he.dropdownSelectedItem.focus(),he.dropdownSelectedItem.dispatchEvent(ee),$.expandedSiblingMenuItem.setAttribute("data-lastid",$.contextMenuId),$.expandedSiblingMenuItem.classList.contains("RootMenu")?U.current=null:U.current=he.parentDropdownSelectedItem,$.expandedSiblingMenuItem.focus(),$.expandedSiblingMenuItem.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0}))}}if($?.id){let he=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,$.keydownEmitElement?.dispatchEvent(he);let ee=new KeyboardEvent("keydown",{key:"ArrowRight",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(ee)}else if($?.contextMenuId){let he=new KeyboardEvent("keydown",{key:"ArrowDown",bubbles:!0,cancelable:!0});R.current=ae,ae.dispatchEvent(he)}}}})))))))}),Fe=I.forwardRef((o,t)=>Uo()===null?I.createElement(Yn,null,I.createElement(Xr,{...o,ref:t})):I.createElement(Xr,{...o,ref:t})),wo=o=>{let t=ne();if(!o||!t)return null;let e=o.getAttribute("id")?.replace(/:/g,"\\:")||"",n=o.getAttribute("data-id")||"",r=o.getAttribute("aria-haspopup")==="menu",i=t.querySelector(`div[aria-haspopup="menu"][aria-activedescendant="${e}"]`),a=i?.getAttribute("aria-controls")?.replace(/:/g,"\\:"),l=a?t.querySelector(`#${a}`):null,s=o.getAttribute("aria-controls")?.replace(/:/g,"\\:"),u=s?t.querySelector(`#${s}`):null,c=null;u&&!c&&(c=u.querySelector('.floating-context-menu-item--active:not([aria-haspopup="menu"])'),c||(c=u.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')));let p=o.parentElement?.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])'),m=o.parentElement?.querySelector('.floating-context-menu-item[aria-expanded="true"]');return{id:e,contextMenuId:n,isMenu:r,parentDropdownSelectedItem:i,parentDropdown:l,dropdownMenu:u,dropdownSelectedItem:c,keydownEmitElement:p,expandedSiblingMenuItem:m}};var jo=(0,ce.forwardRef)((o,t)=>{let{menuItem:e,root:n,referenceElement:r,referenceElementOpen:i,rootMenu:a,customOpen:l,onClickContextMenu:s,menuWidth:u,...c}=o,{t:p}=H(["prompt"]),m=(0,ce.useMemo)(()=>p(`prompt:${e.id}`)!==e.id?p(`prompt:${e.id}`):e.text,[e.text,p]),h=(0,ce.useCallback)(g=>p(`prompt:${g.id}`)!==g.id?p(`prompt:${g.id}`):g.text,[p]);return e.data.type==="group"?ce.default.createElement(Fe,{zIndex:o.zIndex,ref:t,root:n,label:m,menuWidth:u,onClickContextMenu:s,referenceElement:ce.default.createElement(qo,{...c,label:m,menuItem:e})},e.children.map((g,y)=>ce.default.createElement(jo,{...c,root:n,key:g.id,menuItem:g,label:h(g)}))):ce.default.createElement(qo,{...c,menuItem:e,ref:t,label:m})}),zi=o=>{let{root:t,referenceElement:e,referenceElementOpen:n,menuList:r,customOpen:i,needAutoUpdate:a,defaultPlacement:l,defaultFallbackPlacements:s,onClickContextMenu:u,menuWidth:c,onClickReferenceElement:p,hoverOpen:m,...h}=o,{t:g}=H(["prompt"]),y=(0,ce.useMemo)(()=>{let b=[];return r.forEach((f,x)=>{let E=g(`prompt:${f.id}`)!==f.id?g(`prompt:${f.id}`):f.text;f.data.type==="group"?(x>0&&b.push(ce.default.createElement(D,{key:f.id+"_group_spector","aria-disabled":!0,onClick:d=>{d.stopPropagation(),d.preventDefault()},component:"div",sx:{pointerEvents:"none",borderTop:"1px solid",borderColor:"customColor.borderColor",my:1}})),b.push(ce.default.createElement(D,{key:f.id+"_group_name",component:"div","aria-disabled":!0,sx:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%",boxSizing:"border-box",direction:"row",px:1,pointerEvents:"none"},onClick:d=>{d.stopPropagation(),d.preventDefault()}},ce.default.createElement(G,{textAlign:"left",fontSize:12,color:"text.secondary"},E))),f.children.forEach((d,A)=>{b.push(ce.default.createElement(jo,{menuWidth:c,onClickContextMenu:u,zIndex:2147483602,...h,key:d.id,label:"",menuItem:d,root:t}))})):b.push(ce.default.createElement(jo,{menuWidth:c,onClickContextMenu:u,key:f.id,label:"",menuItem:f,root:t}))}),b},[r,g]);return ce.default.createElement(Fe,{zIndex:2147483601,label:"",root:t,customOpen:i,needAutoUpdate:a,referenceElement:e,referenceElementOpen:n,defaultPlacement:l,defaultFallbackPlacements:s,onClickContextMenu:u,onClickReferenceElement:p,hoverOpen:m,menuWidth:c},y)},_o=zi;var me=k(N());var Yo=o=>{let{sx:t}=o,{t:e}=H(["common","client"]),[n,r]=(0,me.useState)(!0),[i,a]=(0,me.useState)(null);return(0,me.useEffect)(()=>{if(i)return;let l=ne();l&&a(l),r(!1)},[]),me.default.createElement(kt,{loading:n},i&&me.default.createElement(Fe,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:i,menuSx:{width:240},referenceElement:me.default.createElement(D,{sx:{alignSelf:"end"}},me.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,color:"inherit",minWidth:"unset",...t}},me.default.createElement(ue,{icon:"More",sx:{color:"text.primary",fontSize:16}})))},me.default.createElement(pe,{onClick:()=>{Me({key:"options",query:"#/my-own-prompts"})},label:e("client:floating_menu__button__manage_my_own_prompt"),icon:"DefaultIcon"}),me.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:i,referenceElement:me.default.createElement(pe,{isGroup:!0,icon:"Delete",label:e("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},me.default.createElement(pe,{label:e("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),me.default.createElement(pe,{label:e("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),me.default.createElement(pe,{onClick:()=>{Me({key:"options"})},label:e("common:settings"),icon:"Settings"})))};var Xo=k(N());var To=k(N());var Jo=o=>{let{t}=H(["common","client"]),{sx:e,placement:n,ButtonProps:r,iconSize:i=16,icon:a="Close"}=o,[,l]=Q(xe),s=le(Ye);return To.default.createElement(Re,{title:t("client:floating_menu__button__hide_menu__until_next_visit"),floatingMenuTooltip:!0,placement:n},To.default.createElement(K,{size:"small",variant:"text",sx:{width:32,height:32,minWidth:"unset",color:"text.primary",...e},onClick:async()=>{l({open:!1,rootRect:null}),s(u=>({...u,closeBeforeRefresh:!0}))},...r},To.default.createElement(ue,{icon:a,sx:{color:"inherit",fontSize:i}})))};var te=k(N());var vo=k(N());var Rt=o=>{let{t}=H(["common","client"]),{hideRangy:e}=Pe(),[,n]=Q(xe),{chatBoxShortCutKey:r}=Je();return vo.default.createElement(Re,{description:r,title:t("client:floating_menu__button__switch_to_sidebar"),placement:"bottom",...o.TooltipProps},vo.default.createElement(K,{sx:{ml:"0px!important",height:"24px",flexShrink:0,alignSelf:"end",minWidth:"unset",padding:"6px 5px"},className:"max-ai__actions__button--toggle-sidebar",variant:"text",onClick:()=>{ur(),e(),n({open:!1,rootRect:null}),_n()||He()}},vo.default.createElement(Pn,{sx:{fontSize:"16px",color:"text.primary"}})))};var Qo=()=>{let o=j(ke),t=(0,te.useRef)(!1),e=(0,te.useMemo)(()=>!!(o.loading&&o.writingMessage?.text),[o.loading,o.writingMessage]),{stopGenerateMessage:n,reGenerate:r}=yr(),i=(0,te.useCallback)(async l=>{l==="s"&&(t.current=!1,await n()),l==="r"&&(t.current=!0,await n())},[n]),a=(0,te.useRef)(r);return(0,te.useEffect)(()=>{a.current=r},[r]),(0,te.useEffect)(()=>{if(!e)return;let l=async s=>{let u=s.key;co()&&["r","s","o","c"].includes(u)&&(s.preventDefault(),s.stopPropagation(),await i(u))};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}},[e,i]),e?te.default.createElement(z,{direction:"row",spacing:1,sx:{ml:"auto!important","& .usechatgpt-floating-menu__button__shortcut":{fontSize:"12px",opacity:.7,ml:"4px"}}},te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("r")}},te.default.createElement(G,{component:"span",fontSize:"14px",color:"primary.main"},"Try again",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"R"))),te.default.createElement(K,{sx:{height:"24px"},variant:"text",onClick:async()=>{await i("s")}},te.default.createElement(G,{component:"span",fontSize:"14px",color:"primary.main"},"Stop",te.default.createElement("span",{className:"usechatgpt-floating-menu__button__shortcut"},"S"))),te.default.createElement(Rt,null)):te.default.createElement(te.default.Fragment,null)};var T=k(N());var Ze=k(N());var Gi=o=>{let t=ne()||document.body,{children:e,content:n,boxSx:r,onClick:i,PopperProps:a,hoverOpen:l,stopEvent:s=!0}=o,[u,c]=Ze.default.useState(null),p=(0,Ze.useRef)(Ut()),m=f=>{s&&(f.stopPropagation(),f.preventDefault()),c(u?null:f.currentTarget),i?.(f)},h=f=>{l&&c(f.currentTarget)},g=f=>{l&&c(null)},y=!!u,b=y?p.current:void 0;return Ze.default.createElement(Ze.default.Fragment,null,Ze.default.createElement(D,{component:"div",onMouseEnter:h,onMouseLeave:g,onClick:m,onMouseDown:f=>{s&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{s&&(f.stopPropagation(),f.preventDefault())},sx:{...r}},e),Ze.default.createElement(Dn,{disablePortal:!0,id:b,open:y,anchorEl:u,container:t,style:{zIndex:2147483630},className:"max-ai--popper-wrapper",...a},n))},Zo=Gi;var we=k(N());var Vi=({liteMode:o})=>{let{t}=H(["common","client"]);return we.default.createElement(we.default.Fragment,null,o?we.default.createElement(D,{sx:{borderRadius:"4px",bgcolor:e=>e.palette.mode==="dark"?"rgb(7, 19, 24)":"rgb(229, 246, 253)",color:e=>e.palette.mode==="dark"?"rgb(184, 231, 251)":"rgb(1, 67, 97)",p:2,overflow:"hidden"}},we.default.createElement(z,{spacing:1,alignItems:"center"},we.default.createElement(G,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry-small.png",alt:"settings-entry",width:200,height:80}))):we.default.createElement(Co,{icon:we.default.createElement(we.default.Fragment,null),sx:{mt:1,mb:2}},we.default.createElement(z,{spacing:1},we.default.createElement(G,{fontSize:14,color:"text.primary"},t("client:floating_menu__button__hide_menu__this_site__tooltip__description")),we.default.createElement("img",{src:"https://www.maxai.me/assets/chrome-extension/settings-entry.png",alt:"settings-entry",width:466,height:121}))))},en=Vi;var tn=o=>{let{sx:t,placement:e}=o,{t:n}=H(["common","client"]),[r,i]=(0,T.useState)(!0),a=le(Ye),{updateButtonSettingsWithDomain:l,toggleButtonSettings:s}=Vn(),{hideRangy:u}=Pe(),[,c]=Q(xe),[p,m]=(0,T.useState)(null),[h,g]=(0,T.useState)(!1);return(0,T.useEffect)(()=>{if(p)return;let y=ne();y&&m(y),i(!1)},[]),T.default.createElement(kt,{loading:r},p&&T.default.createElement(Fe,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["top-start"],hoverOpen:!0,zIndex:2147483610,label:"",root:p,menuSx:{width:240},referenceElement:T.default.createElement(D,{sx:{zIndex:2,alignSelf:"end",position:"relative",display:"flex",bgcolor:h?"background.paper":"transparent",borderRadius:h?0:"0 14px 14px 0",transition:h?"background-color 0s ease-out":"background-color 0.1s ease-in-out",width:"34px","&::before":{content:'""',position:"absolute",left:0,height:"28px",bgcolor:"background.paper",width:"21px"}}},T.default.createElement(K,{onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)},size:"small",variant:"text",sx:{padding:"5px 8px",color:"inherit",minWidth:"unset",...t}},T.default.createElement(ue,{icon:"More",sx:{color:y=>y.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)",fontSize:"18px"}})),T.default.createElement(Jo,{ButtonProps:{onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)}},icon:h?"Close":"More",iconSize:18,sx:{zIndex:1,left:h?"100%":0,transition:"left 0.1s ease-in-out",width:"34px",height:"28px",padding:"5px 8px",borderRadius:"0 14px 14px 0",right:"-100%",position:"absolute",bgcolor:"background.paper",color:y=>y.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)","&:hover":{bgcolor:y=>y.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}},placement:e}))},T.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:T.default.createElement(pe,{isGroup:!0,icon:"Delete",label:n("client:floating_menu__button__clear_suggested")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},T.default.createElement(pe,{label:n("client:floating_menu__button__clear_suggested__this_site"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearCache()}}),T.default.createElement(pe,{label:n("client:floating_menu__button__clear_suggested__all_sites"),onClick:async()=>{await Xe.getMediator("textSelectPopupButton").clearAllHostCache()}})),T.default.createElement(Fe,{defaultPlacement:"right-start",defaultFallbackPlacements:["right","left","bottom","top"],root:p,referenceElement:T.default.createElement(pe,{isGroup:!0,icon:"VisibilityOff",label:n("client:floating_menu__button__hide_menu")}),menuSx:{width:320},hoverOpen:!0,zIndex:2147483611,label:""},T.default.createElement(pe,{onClick:()=>{c({open:!1,rootRect:null}),a(y=>({...y,closeBeforeRefresh:!0}))},label:n("client:floating_menu__button__hide_menu__until_next_visit")}),T.default.createElement(pe,{CustomRenderNode:T.default.createElement(Zo,{PopperProps:{placement:"top"},onClick:y=>{y.stopPropagation(),y.preventDefault()},content:T.default.createElement(Vo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},T.default.createElement(z,{spacing:1},T.default.createElement(G,{textAlign:"center",fontWeight:"600",fontSize:"16px",color:"text.primary"},n("client:floating_menu__button__hide_menu__this_site__tooltip__title")),T.default.createElement(en,{liteMode:!0}),T.default.createElement(D,null),T.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await l("textSelectPopupButton"),c({open:!1,rootRect:null})}},n("client:floating_menu__button__hide_menu__this_site__tooltip__confirm")),T.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},n("common:cancel"))))},T.default.createElement(z,{direction:"row",spacing:1,px:1,alignItems:"center"},T.default.createElement(ue,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),T.default.createElement(G,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n("client:floating_menu__button__hide_menu__this_site"))))}),T.default.createElement(pe,{CustomRenderNode:T.default.createElement(Zo,{PopperProps:{placement:"top"},onClick:y=>{y.stopPropagation(),y.preventDefault()},content:T.default.createElement(Vo,{sx:{p:3,width:288,boxSizing:"border-box",cursor:"auto"}},T.default.createElement(z,{spacing:1},T.default.createElement(G,{fontSize:"16px",color:"text.primary",textAlign:"center",fontWeight:"600"},n("client:floating_menu__button__hide_menu__all_sites__tooltip__title")),T.default.createElement(en,{liteMode:!0}),T.default.createElement(D,null),T.default.createElement(K,{variant:"outlined",color:"primary",onClick:async()=>{await s("textSelectPopupButton",!1),c({open:!1,rootRect:null})}},n("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm")),T.default.createElement(K,{variant:"contained",color:"primary",onClick:()=>{c({open:!1,rootRect:null}),u()}},n("common:cancel"))))},T.default.createElement(z,{direction:"row",spacing:1,px:1,alignItems:"center"},T.default.createElement(ue,{size:16,icon:"Empty",sx:{color:"primary.main",flexShrink:0}}),T.default.createElement(G,{fontSize:14,textAlign:"left",color:"text.primary",width:0,noWrap:!0,flex:1,lineHeight:"28px"},n("client:floating_menu__button__hide_menu__all_sites"))))}),T.default.createElement(pe,{label:n("client:floating_menu__button__menu_settings"),icon:"Settings",onClick:()=>{Me({key:"options",query:"#/mini-menu"})}})),T.default.createElement(pe,{onClick:()=>{Me({key:"options"})},label:n("common:settings"),icon:"Settings"})))};var q=k(N());var $i=o=>{let t=yn(),{onChange:e}=o,{currentSidebarConversationMessages:n,currentSidebarConversationType:r}=ge(),i=j(xe),[,a]=Q(yt),[,l]=Q(eo),s=So(),u=(0,q.useRef)("");(0,q.useEffect)(()=>{r==="Chat"&&(u.current=On(n,g=>g.type==="ai")?.messageId||"")},[n,r]),(0,q.useEffect)(()=>{i.open&&l({lastAIMessageId:u.current})},[i.open]),(0,q.useEffect)(()=>{a(g=>({...g,lastOutput:s})),e?.(s)},[s,i.open]);let c=(0,q.useRef)(null),p=q.default.useRef(null),m=(0,q.useCallback)(In(()=>{let g=c.current;g&&(g.style.minHeight=`${p.current?.offsetHeight||0}px`)},100),[]),h=(0,q.useCallback)(Ne(()=>{let g=c.current;g&&(g.style.minHeight=`${(p.current?.offsetHeight||0)+1}px`)},100),[]);return(0,q.useEffect)(()=>{setTimeout(()=>{p.current?.scrollTo({top:p.current.scrollHeight}),m(),h()},0)},[s]),(0,q.useEffect)(()=>{let g=y=>{if((y.metaKey||y.ctrlKey)&&(y.stopPropagation(),y.key==="C"||y.key==="c"||y.key==="x"||y.key==="X")){let b=window.getSelection();if(b&&b.rangeCount>0){let x=b.getRangeAt(0).toString()||b.toString();x&&(y.preventDefault(),navigator.clipboard.writeText(x))}}};p.current?.addEventListener("keydown",g,!0)},[]),q.default.createElement(z,{ref:c,className:"chat-message--text max-ai__writing-message-box",whiteSpace:"pre-wrap",width:"100%",sx:{wordBreak:"break-word",borderBottomLeftRadius:0,color:g=>g.palette.mode==="dark"?"#FFFFFFDE":"rgba(0,0,0,0.87)","& .markdown-body":{userSelect:"text",maxHeight:"min(40vh, 320px)",overflowY:"auto","*":{fontFamily:'"Roboto","Helvetica","Arial",sans-serif!important'},"& p:last-child":{mb:"1em"}}},component:"div"},Sn(s)?q.default.createElement(Ki,null):null,q.default.createElement("div",{tabIndex:-1,ref:p,style:{textAlign:"left"},className:`markdown-body ${t.isDarkMode?"markdown-body-dark":""}`},q.default.createElement(kr,null,s.replace(/^\s+/,""))))},Ki=()=>{let{t:o}=H(["common","client"]),{currentSelection:t}=Pe(),e=(0,q.useMemo)(()=>{if(t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText){let n=t?.selectionElement?.editableElementSelectionText||t?.selectionElement?.selectionText.trim().replace(/\u200B/g,"");return((i,a)=>{if(i.length<=a)return{start:i,end:""};let l=i.substring(i.length-a);return{start:i.substring(0,i.length-a),end:l}})(n,15)}return{start:"",end:""}},[t]);return!e.start&&!e.end?null:q.default.createElement(G,{sx:{width:"100%",display:"flex",flexDirection:"row"},fontSize:"12px",fontWeight:400,color:"text.secondary"},q.default.createElement("span",{style:{flexShrink:0}},o("client:floating_menu__draft_card__context__title"),":"," "),q.default.createElement("span",{style:{display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"100%"}},e.start),q.default.createElement("span",{style:{flexShrink:0,whiteSpace:"nowrap"}},e.end))},Qr=$i;var ei=k(Si());var _e=k(N());var qi=({TooltipProps:o,...t})=>{let{currentSidebarConversationType:e}=ge(),{currentAIProviderDetail:n,currentAIProviderModelDetail:r}=Un(),{t:i}=H(["common","client"]),[a,l]=(0,_e.useState)(void 0);return(0,_e.useEffect)(()=>{if(e==="Chat"&&n&&r){let s=i(n.label)!==n.label?i(n.label):n.label,u=i(r.title)!==r.title?i(r.title):r.title;l({title:`${s} (${u})`,provider:n.value,model:r.value})}},[n,r,i,e]),_e.default.createElement(_e.default.Fragment,null,a?_e.default.createElement(Re,{...o,title:a.title},_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},a.provider?_e.default.createElement(Rn,{aiProviderType:a.provider,...t}):_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}}))):_e.default.createElement(D,{sx:{display:"flex",alignItems:"center",justifyContent:"center",alignSelf:"end"}},_e.default.createElement(Ee,{sx:{fontSize:t.size,...t.sx}})))},Zr=qi;var ji=[],Yi=!0,ti=o=>{let{root:t}=o,{t:e}=H(["common","client"]),{palette:n}=hn(),{currentSelectionRef:r}=Pe(),i=j(ke),a=le(qe),{currentSidebarConversationType:l,updateSidebarConversationType:s}=ge(),[u,c]=Q(xe),p=So(),{isLogin:m}=Yt(),h=j(An),[g,y]=Q(yt),b=(0,M.useCallback)(()=>{let C=r.current?.activeElement||r.current?.selectionElement?.target;return C&&wn()?.contains(C)},[]),f=(0,M.useMemo)(()=>g.lastOutput,[g.lastOutput]),[x,E]=Q(it),[d,A]=(0,M.useState)([]),Y=(0,M.useMemo)(()=>{if(u.rootRect){let C=Math.max(u.rootRect?.width||0,No-32);return C>1280?1280:C}return No-32},[u.rootRect]),F=(0,M.useMemo)(()=>{let C="bottom-start",B="bottom-start";if(u.rootRect&&Y){let V=rr(u.rootRect,Y,400);V.y>u.rootRect.top?(C="bottom-start",B="bottom-start"):V.y<u.rootRect.top&&(C="top-start",B="top-start"),V.x>u.rootRect.left+300?C="right-start":V.x<u.rootRect.left-300&&(C="left-start")}return{inputPlacement:C,contextMenuPlacement:B}},[u.rootRect,Y]),{x:oe,y:fe,strategy:w,refs:S,context:O}=Ct({open:u.open,onOpenChange:C=>{c(B=>({...B,open:C}))},placement:F.inputPlacement,middleware:sr,whileElementsMounted:ro}),P=so(O),Z=ao(O,{}),{getFloatingProps:U}=lo([Z,P]),[R,X]=(0,M.useState)(""),Te=(0,M.useRef)(null),{setShortCuts:ko,runShortCuts:Po,loading:Ue,reGenerate:_t,shortCutsEngineRef:Bo}=Se(""),{contextMenuList:ct,originContextMenuList:pt}=fo("textSelectPopupButton",R),Oe=xr(),tt=(0,M.useMemo)(()=>Ue?ji:f?Oe:ct,[Ue,ct,f,Oe]);(0,M.useEffect)(()=>{},[tt]);let Tt=(0,M.useMemo)(()=>R.length>0,[R]);(0,M.useEffect)(()=>{if(u.rootRect){let C=uo(u.rootRect);if(!Yi){document.querySelector("#rangeBorderBox")?.remove();let B=document.createElement("div");B.id="rangeBorderBox",B.style.position="absolute",B.style.left=C.left+"px",B.style.top=C.top+window.scrollY+"px",B.style.width=C.width+"px",B.style.height=C.height+"px",B.style.border="1px solid green",B.style.zIndex="9999",B.style.pointerEvents="none",document.body.appendChild(B)}S.setPositionReference({getBoundingClientRect(){return C}})}},[u.rootRect]),(0,M.useEffect)(()=>{if(u.open&&tt.length>0){let C=null;tt.find(B=>{if(B.data.type==="group"){if(B.children.length>0)return C=B.children.find(V=>V.data.type==="shortcuts")||null,C!==null}else if(B.data.type==="shortcuts")return C=B,!0;return!1}),C&&E(B=>({...B,lastHoverContextMenuId:C?.id||""}))}},[tt,u.open]),(0,M.useEffect)(()=>{if(u.open){St("floatingMenuInputMediator").updateInputValue("");let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1),mo().then(B=>{a(B)})}else{let B=ne()?.querySelector(`#${Ke}`)?.value;B&&St("chatBoxInputMediator").updateInputValue(B)}},[u.open]),(0,M.useEffect)(()=>{if(!i.loading&&co()){let C=ne()?.querySelector(`#${Ke}`);C&&setTimeout(()=>{C?.focus()},1)}},[i.loading]);let Dt=async C=>{if(C.trim()){let B=p,V="",Ie=r.current?.selectionElement;Ie&&(Ie.isEditableElement?Ie.editableElementSelectionText?B?V=B:V="{{SELECTED_TEXT}}":B?V=B:V="":V="{{SELECTED_TEXT}}");let se=`${C}`;V&&(se+=`:
"""
${V}
"""`),b()||s("Chat"),A([{type:"RENDER_TEMPLATE",parameters:{template:se}},{type:"ASK_CHATGPT",parameters:{}}])}},Ft=(0,M.useRef)(_t);(0,M.useEffect)(()=>{Ft.current=_t},[_t]),(0,M.useEffect)(()=>{if(x.selectedContextMenuId&&pt.length>0&&u.open&&!Ue){let C=x.selectedContextMenuId,B=!1,V=!1,Ie=!1,se=null;if(cr(C)&&(C=C.replace(It,""),B=!0),(!m||h.status!=="success")&&(V=!0),Ie=ar(C),Ie){let Ge=lr(C);Ge&&(se=Ge)}else se=pt.find(Ge=>Ge.id===C)||null;if(se&&se.id){if(se.data.type==="group")return;Ie||Xe.getMediator("textSelectPopupButton").favoriteContextMenu(se).then().catch(),B&&(se=pr(se)),Te.current=se;let Ge=se.id,Ot=se.data.actions||[];if(E(()=>({selectedContextMenuId:null,hoverContextMenuIdMap:{},lastHoverContextMenuId:null})),b()||s("Chat"),Ot.length>0)A(Ot);else if(Ie){if(V){He(),c({open:!1,rootRect:null});return}y(_=>({..._,selectContextMenuId:se?.id||null})),po(Ge)==="TRY_AGAIN"&&Ft.current(),setTimeout(()=>{y(_=>({..._,selectContextMenuId:null}))},100)}}}},[x.selectedContextMenuId,pt,u.open,Ue,h.status,m]),(0,M.useEffect)(()=>{},[x.selectedContextMenuId]);let ze=(0,M.useRef)(!1);return(0,M.useEffect)(()=>{let C=je(d);if(d.length>0&&(l==="Chat"||b())){if(ze.current)return;ze.current=!0,Te.current&&(Te.current=null),ko(C),A([]),Te.current||St("floatingMenuInputMediator").updateInputValue("");let V=r.current?.selectionElement?.isEditableElement,Ie=!1;(!m||h.status!=="success")&&(Ie=!0),(!V||Ie)&&(c({open:!1,rootRect:null}),He()),X(""),Po().then(()=>{(Bo.current?.getNextAction()?.error||"")&&(c({open:!1,rootRect:null}),He())}).catch().finally(()=>{ze.current=!1})}},[d,m,l]),(0,M.useEffect)(()=>{let C=(B,V)=>{V&&V?.contextMenu&&(Te.current=V.contextMenu),X(B)};return St("floatingMenuInputMediator").subscribe(C),()=>{St("floatingMenuInputMediator").unsubscribe(C)}},[X]),M.default.createElement(io,{root:t},M.default.createElement("div",{ref:S.setFloating,...U(),style:{position:w,zIndex:u.open?2147483601:-1,opacity:u.open?1:0,top:fe??0,left:oe??0,width:Y,maxWidth:"90vw"},onKeyUp:C=>{C.stopPropagation()},id:mn,"aria-hidden":u.open?"false":"true"},M.default.createElement(_o,{customOpen:!0,defaultPlacement:F.contextMenuPlacement,needAutoUpdate:!0,hoverOpen:!1,menuList:tt,referenceElementOpen:u.open,referenceElement:M.default.createElement("div",{style:{boxSizing:"border-box",border:"1px solid",borderColor:n.customColor.borderColor,background:n.customColor.paperBackground,borderRadius:"6px",boxShadow:"rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",overflow:"hidden",isolation:"isolate",display:"flex",flexDirection:"column",width:"100%",padding:"7px 12px"},onKeyPress:C=>{C.stopPropagation()}},M.default.createElement(Qr,null),M.default.createElement(z,{width:"100%",direction:"row",alignItems:"center",gap:1},M.default.createElement(Zr,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},size:16,sx:{flexShrink:0,p:"4px",alignSelf:"start"}}),M.default.createElement(z,{direction:"row",width:0,flex:1,alignItems:"center",spacing:1,justifyContent:"left"},Ue?M.default.createElement(M.default.Fragment,null,M.default.createElement(G,{fontSize:"16px",color:"primary.main"},e("client:floating_menu__input__running_placeholder")),M.default.createElement(qt,{size:"16px"})):M.default.createElement(Tr,{expandNode:u.open&&M.default.createElement(Pr,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0},sx:{alignSelf:"end"},direction:"column",size:"tiny"}),placeholder:u.open?e("client:floating_menu__input__placeholder"):"",InputId:Ke,sx:{border:"none","& > div":{"& > div":{p:0},"& > textarea":{p:0},"& > .max-ai-user-input__expand":{"&:has(> div)":{pr:1}}},borderRadius:0,minHeight:"24px"},onEnter:C=>{!f&&ct.length>0||Dt(C)}}),!Ue&&M.default.createElement(M.default.Fragment,null,M.default.createElement(Re,{floatingMenuTooltip:!0,title:e("client:floating_menu__button__send_to_ai"),description:"\u23CE",placement:F.contextMenuPlacement},M.default.createElement(Ln,{sx:{height:"24px",width:"24px",borderRadius:"4px",flexShrink:0,alignSelf:"end",alignItems:"center",p:0,m:0,cursor:Tt?"pointer":"default",bgcolor:Tt?"primary.main":"rgb(219,219,217)","&:hover":{bgcolor:Tt?"primary.main":"rgb(219,219,217)"}},onClick:()=>{!f&&ct.length>0||Dt(R)}},M.default.createElement(ei.default,{sx:{color:"#fff",fontSize:16}}))),M.default.createElement(Yo,{sx:{width:24,height:24,alignSelf:"end"}}),M.default.createElement(Rt,{TooltipProps:{placement:F.contextMenuPlacement,floatingMenuTooltip:!0}})),M.default.createElement(Qo,null)))),root:t})))};var ni=k(pn()),Xi="USE_CHAT_GPT_AI".toLowerCase().replace(/_/g,"-"),Ji=({containerId:o="modal-root",children:t})=>{let[e,n]=(0,$e.useState)(null),r=(0,$e.useRef)(null);return(0,$e.useEffect)(()=>{let i=document.getElementById(o);if(i){let a=document.createElement("div");a.id=fn;let l=document.createElement("style"),s=document.createElement("link");if(s.rel="stylesheet",s.href=ni.default.runtime.getURL("content_style.css"),i.shadowRoot)i.shadowRoot.appendChild(a),i.shadowRoot.appendChild(l),i.shadowRoot.appendChild(s);else{let u=i.attachShadow({mode:"open"});u.appendChild(a),u.appendChild(l),u.appendChild(s)}r.current=dt({key:`${Xi}-context-menu`,prepend:!0,container:l}),n(a)}},[o]),!e||!r.current?null:(0,oi.createPortal)($e.default.createElement(ot,{value:r.current},$e.default.createElement(ti,{root:e}),t),e)},ri=Ji;var de=k(N());var wt=k(N());var Qi=o=>{let{buttonSettingKey:t,placement:e,onClick:n}=o,{t:r}=H(["common","client","prompt"]),{favoriteContextMenuList:i}=mr(t);return wt.default.createElement(z,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}}}},i?.map(a=>{let l=!a.data.icon,s=a.text,u=a.id.replace(It,""),c=`prompt:${u}`;r(c)!==u&&(s=r(c));let p=String(s[0]||"").toUpperCase();return wt.default.createElement(gt,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom"},title:s,key:a.id,sx:{minWidth:"unset",p:l?"6px!important":"8px!important"},onMouseUp:m=>{m.stopPropagation(),m.preventDefault()},onMouseDown:m=>{m.stopPropagation(),m.preventDefault()},onClick:m=>{m.stopPropagation(),m.preventDefault(),n&&n(a)}},l?wt.default.createElement(z,{className:"max-ai__click-menu-button--box__text-icon",alignItems:"center",justifyContent:"center",sx:{width:"22px",height:"22px",boxSizing:"border-box",borderRadius:"4px",bgcolor:m=>m.palette.mode==="dark"?"#4f4f4f":"#F5F6F7",color:m=>m.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}},wt.default.createElement(G,{component:"span",fontSize:"13px",color:"inherit"},p)):wt.default.createElement(ue,{icon:a.data.icon,sx:{fontSize:"18px",color:m=>m.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}}))}))},ii=Qi;var Ao=k(N());var si=o=>{let{sx:t,placement:e,TooltipProps:n}=o,{t:r}=H(["common","client"]),{createSearchWithAI:i}=bo();return Ao.default.createElement(z,{direction:"row",alignItems:"center",className:"max-ai__click-menu-button--box",sx:{"&.max-ai__click-menu-button--box":{"& button":{padding:"5px 5px!important","&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 3px!important"}}},...t}},Ao.default.createElement(gt,{TooltipProps:{floatingMenuTooltip:!0,placement:e||"bottom",...n},title:r("client:sidebar__tabs__search__tooltip"),sx:{minWidth:"unset",p:"8px!important"},onMouseUp:a=>{a.stopPropagation(),a.preventDefault()},onMouseDown:a=>{a.stopPropagation(),a.preventDefault()},onClick:async a=>{a.stopPropagation(),a.preventDefault();let l=window.getSelection()?.toString();l&&await i(l,!1)}},Ao.default.createElement(ue,{icon:"Search",sx:{fontSize:"18px",color:a=>a.palette.mode==="dark"?"rgba(255,255,255,.87)":"rgba(0,0,0,.6)"}})))};var Zi=o=>{let{t}=H(["common","client"]),{tempSelection:e,show:n,hideRangy:r}=Pe(),{chatBoxShortCutKey:i}=Je(),a=Qt("textSelectPopupButton"),l=le(it),s=j(ke),u=le(Zt),{closeBeforeRefresh:c}=j(Ye),{showFloatingContextMenu:p}=Mt(),[m]=Q(xe),h=(0,de.useMemo)(()=>n&&a?.buttonVisible&&!c&&!m.open,[c,n,a,m]),{x:g,y,strategy:b,refs:f,placement:x}=Ct({placement:"bottom-start",middleware:[to({fallbackPlacements:["top-start","right","left"]}),no({crossAxis:!0,padding:16}),oo(d=>{if(d.placement.indexOf("bottom")>-1){let A={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight+window.scrollY};return nr({top:d.y,left:d.x,bottom:d.y+d.rects.floating.height+50,right:d.rects.floating.width+d.x},A)?d.rects.reference.y-d.y-d.rects.floating.height-8:8}else return 8})]});(0,de.useEffect)(()=>{if(!e||!h)return;let d=uo(e.selectionRect);if(h&&d){if(d=ir(d),!nt){document.querySelector("#rangeBorderBox")?.remove();let A=document.createElement("div");A.id="rangeBorderBox",A.style.position="absolute",A.style.left=d.left+"px",A.style.top=d.top+window.scrollY+"px",A.style.width=d.width+"px",A.style.height=d.height+"px",A.style.border="2px solid red",A.style.zIndex="9999",A.style.pointerEvents="none",document.body.appendChild(A)}f.setPositionReference({getBoundingClientRect(){return{...d,x:d.left,y:d.top}}})}},[e,h]);let E=(0,de.useCallback)(()=>{if(f.floating.current){if(getComputedStyle(f.floating.current).opacity==="0")return;r(),xo(),ho()}},[]);return(0,de.useEffect)(()=>{let d=A=>{A.key==="Escape"&&E()};return document.addEventListener("keydown",d,!0),()=>{document.removeEventListener("keydown",d,!0)}},[]),(0,de.useEffect)(()=>{s.loading&&(setTimeout(()=>{E()},1e3),E())},[s.loading]),de.default.createElement($t,{elevation:3,component:"div",ref:f.setFloating,className:`max-ai__click-context-menu ${h?"open":"close"}`,sx:{bgcolor:"transparent",borderRadius:"14px",zIndex:h?2147483600:-1,position:b,opacity:h?1:0,top:y??0,left:g??0,width:"max-content"}},de.default.createElement(z,{direction:"row",alignItems:"center",sx:{"& .max-ai__click-menu-button--box":{div:{display:"flex"},height:"28px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center","&:hover":{"&:has(button)&::after":{display:"none"}},"& button":{bgcolor:"background.paper",minWidth:"unset",padding:"5px 8px!important",boxSizing:"border-box",borderRadius:"0","&:hover":{bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"},"&:has(.max-ai__click-menu-button--box__text-icon)":{padding:"3px 6px!important"}},"&:first-child":{"& button":{borderTopLeftRadius:"14px",borderBottomLeftRadius:"14px",borderTopRightRadius:0,borderBottomRightRadius:0}},"&:not(:last-child)":{"&::after":{content:'""',position:"absolute",right:0,top:"25%",transform:"scale(0.5) translateY(-50%)",width:"1px",height:"32px",bgcolor:d=>d.palette.mode==="dark"?"rgb(61,61,61)":"rgb(224,224,224)"}}}}},de.default.createElement(D,{component:"div",className:"max-ai__click-menu-button--box"},de.default.createElement(gt,{TooltipProps:{floatingMenuTooltip:!0,placement:x,description:i,sx:{maxWidth:360}},title:t("client:floating_menu__button__cta__tooltip"),className:"usechatgpt-ai__context-menu--handle-button",id:"max_ai__floating_context_menu__cta_button",size:"small",variant:"text",onMouseUp:d=>{d.stopPropagation(),d.preventDefault()},onMouseDown:d=>{d.stopPropagation(),d.preventDefault()},onClick:d=>{d.stopPropagation(),d.preventDefault();let A=window.getSelection()?.rangeCount;if(A&&A>0){let Y=window.getSelection()?.getRangeAt(0)?.cloneRange();u({range:Y||null,selectionText:window?.getSelection()?.toString()||""})}e&&p()}},de.default.createElement(Ee,{sx:{fontSize:"18px"}}))),de.default.createElement(si,{placement:x}),de.default.createElement(ii,{placement:x,buttonSettingKey:"textSelectPopupButton",onClick:d=>{e&&p(),setTimeout(()=>{l(A=>({...A,selectedContextMenuId:d.id}))},100)}}),de.default.createElement(tn,{placement:x})))},ai=Zi;var ye=k(N());var es=()=>{let{closeBeforeRefresh:o}=j(Ye),{haveSelection:t,showFloatingContextMenu:e,floatingDropdownMenuOpen:n}=Mt(),r=Qt("textSelectPopupButton"),[i,a]=(0,ye.useState)(16),[l,s]=(0,ye.useState)(3),{chatBoxShortCutKey:u}=Je();return(0,ye.useEffect)(()=>{if(!(r?.buttonVisible&&!o)&&t){let c=document.querySelector(`#${Ht}`);c&&c.classList.contains("open")?a((c.getBoundingClientRect().width||0)+16):a(16),s(1)}},[t,r,o]),(0,ye.useEffect)(()=>{if(l===1)s(2);else if(l===2){let c=setTimeout(()=>{s(3)},2e3);return()=>{clearTimeout(c)}}return()=>{}},[l]),(0,ye.useEffect)(()=>{s(3)},[n]),null;return ye.default.createElement(ye.default.Fragment,null,u?ye.default.createElement(D,{className:"usechatgpt-ai__context-menu--handle-button",sx:{position:"fixed",bottom:16,right:i,zIndex:l!==3?2147483661:-1,backgroundColor:"rgba(98,98,105,1)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",overflow:"hidden",maxWidth:l!==3?"100%":0,display:"grid"},component:"div",onClick:e},ye.default.createElement(G,{fontSize:"24px",fontWeight:"bold",color:"#fff",noWrap:!0,sx:{px:"10px",py:"4px"}},u)):ye.default.createElement(D,{sx:{position:"fixed",bottom:16,right:i,zIndex:l!==3?2147483661:-1,backgroundColor:"#fff",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease-in-out",maxWidth:l!==3?"100%":0,display:"grid"},component:"div",onClick:e},ye.default.createElement($t,{elevation:3,sx:{padding:"8px 10px"}},ye.default.createElement(Ee,{sx:{fontSize:24}}))))},li=es;var Be=k(N()),mi=k(Lo());var W=k(N());var ie=k(N());Ro();Do();var ts=o=>{let{buttonKey:t,children:e,rootId:n,root:r,permissionWrapperCardSceneType:i}=o,[a,l]=(0,ie.useState)(null),{currentSidebarConversationType:s,updateSidebarConversationType:u}=ge(),{currentUserPlan:c}=We(),p=Jt(),{createConversation:m}=ht(),{contextMenuList:h}=fo(t,"",!1),{loading:g}=j(ke),{setShortCuts:y,runShortCuts:b}=Se(),f=(0,ie.useRef)(null),x=(0,ie.useMemo)(()=>!(i&&c.name==="free"),[i,c]),E=(0,ie.useCallback)(async F=>{if(!g&&F.data.actions){let oe=await Gt(),fe=`ON_BOARDING_RECORD_INPUT_ASSISTANT_BUTTON_${Ae()}_TIMES`,w=Number(oe[fe]||0);if(!x&&i)if(w>0)await At(fe,w-1);else{He(),jt("show",i);let O=await m();await rt("add",O,0,[Xt(p[i])]);return}let S=je(F.data.actions);S.splice(0,0,{type:"SET_VARIABLE_MAP",parameters:{VariableMap:{OperationElementElementSelector:`[maxai-input-assistant-button-id="${n}"]`}}}),await y(S),await b(!0)}},[y,b,g,x,i]),d=(0,ie.useRef)(E);(0,ie.useEffect)(()=>{d.current=E},[E]);let A=(0,ie.useRef)(!1),Y=(0,ie.useRef)(s);return(0,ie.useEffect)(()=>{Y.current=s},[s]),(0,ie.useEffect)(()=>{!A.current&&a&&d.current&&Y.current==="Chat"&&(A.current=!0,l(null),d.current(a).then().catch().finally(()=>{A.current=!1}))},[a]),(0,ie.useEffect)(()=>{if(r&&n&&!f.current){let F=document.createElement("style");F.setAttribute("data-emotion-id",n),r.appendChild(F),f.current=dt({key:"max-ai-input-assistant-context-menu",prepend:!0,container:F})}},[r,n]),!r||!f.current?null:ie.default.createElement(ot,{value:f.current},ie.default.createElement(_o,{defaultPlacement:"bottom-start",defaultFallbackPlacements:["bottom-end","bottom","top-start","top-end","top","right","left"],root:r,menuList:h,needAutoUpdate:!0,hoverOpen:!1,menuWidth:240,referenceElement:e,onClickContextMenu:async F=>{u("Chat"),l(F)},onClickReferenceElement:()=>{}}))},on=ts;Ro();Do();var os=o=>{let{rootId:t,InputAssistantBoxSx:e,DropdownButtonStyle:n,CTAButtonStyle:r,buttonGroup:i,shadowRoot:a,placement:l}=o,s=(0,W.useRef)(null),{t:u}=H(["client"]),[c,p]=(0,W.useState)(null),{loading:m}=j(ke),[h,g]=(0,W.useState)(!1),[y,b]=(0,W.useState)(!1),f=(0,W.useMemo)(()=>{let E=je(r),d=je(n),A={},Y={};if(i.forEach(F=>{F.CTAButtonStyle&&(E=Object.assign(E,{...F.CTAButtonStyle})),F.DropdownButtonStyle&&(d=Object.assign(d,{...F.DropdownButtonStyle}))}),A){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:fe="#fff",hoverColor:w="#fff",borderColor:S="rgb(77, 26, 137)",hoverBorderColor:O="rgb(77, 26, 137)",borderRadius:P="4px 0 0 4px",borderWidth:Z="0 1px 0 0",iconSize:U=20,padding:R="8px 12px"}=E||{};A={minWidth:"unset",backgroundColor:F,color:fe,borderColor:S,borderRadius:P,fontSize:`${U}px`,borderWidth:Z,borderStyle:"solid",position:"relative",padding:R,"&:hover":{color:w,backgroundColor:oe,borderColor:O}}}if(Y){let{backgroundColor:F="#7601D3",hoverBackgroundColor:oe="rgb(94,34,169)",color:fe="#fff",hoverColor:w="#fff",borderColor:S="transparent",hoverBorderColor:O="transparent",borderRadius:P="0 4px 4px 0",borderWidth:Z="0",iconSize:U=20,padding:R="8px 4px"}=d||{};Y={minWidth:"unset",backgroundColor:h?oe:F,color:h?w:fe,borderColor:h?O:S,borderRadius:P,fontSize:`${U}px`,borderWidth:Z,borderStyle:"solid",padding:R,"&:hover":{color:w,backgroundColor:oe,borderColor:O}}}return{ctaButtonSx:A,dropdownButtonSx:Y}},[r,n,h,i]),x=(0,W.useMemo)(()=>{let E=je(e)||{};i.forEach(A=>{A.InputAssistantBoxSx&&Object.assign(E,A.InputAssistantBoxSx)});let d={boxShadow:"0px 2px 3px 1px rgba(118, 1, 211, 0.16), 1px 0px 2px 0px rgba(118, 1, 211, 0.08), -1px 0px 2px 0px rgba(118, 1, 211, 0.08)",...E?.["&:hover"]};return d&&delete E["&:hover"],{...E,...y?d:{}}},[e,y,i]);return(0,W.useEffect)(()=>{if(a){let E=document.createElement("style");a.appendChild(E),s.current=dt({key:"max-ai-input-assistant-context-menu",prepend:!0,container:E})}},[a]),(0,W.useEffect)(()=>{p(document.querySelector(`#${vt}`)?.shadowRoot?.querySelector("div"))},[]),W.default.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",borderRadius:"4px",...x},onMouseEnter:()=>b(!0),onMouseLeave:()=>b(!1)},i[0]&&W.default.createElement(on,{rootId:t,buttonKey:i[0].buttonKey,permissionWrapperCardSceneType:i[0].permissionWrapperCardSceneType,root:c},W.default.createElement(D,null,W.default.createElement(Re,{placement:l,zIndex:2e6,PopperProps:{container:c},title:u(i[0].tooltip)},W.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"},onMouseEnter:()=>{g(!0)},onMouseLeave:()=>{g(!1)}},s.current&&W.default.createElement(ot,{value:s.current},W.default.createElement(D,{position:"absolute",top:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),W.default.createElement(K,{id:`maxAIInputAssistantCtaButton${t}`,"data-testid":"maxai-input-assistant-cta-button",disabled:m,sx:f.ctaButtonSx},m?W.default.createElement(qt,{size:r?.iconSize||20,sx:{fontSize:"inherit",color:"#fff"}}):W.default.createElement(Ee,{sx:{fontSize:"inherit",color:"inherit"}})),W.default.createElement(D,{position:"absolute",bottom:`-${r?.transparentHeight||0}px`,width:"100%",height:`${r?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))),i[1]&&W.default.createElement(on,{rootId:t,buttonKey:i[1].buttonKey,permissionWrapperCardSceneType:i[1].permissionWrapperCardSceneType,root:c},W.default.createElement(D,null,W.default.createElement(Re,{placement:l,zIndex:2e6,PopperProps:{container:c},title:u(i[1].tooltip)},W.default.createElement("div",{style:{display:"flex",flexDirection:"column",position:"relative",cursor:"pointer"}},s.current&&W.default.createElement(ot,{value:s.current},W.default.createElement(D,{position:"absolute",top:`-${n?.transparentHeight||0}px`,width:"100%",height:`${n?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001}),W.default.createElement(K,{id:`maxAIInputAssistantDropdownButton${t}`,"data-testid":"maxai-input-assistant-dropdown-button",disabled:m,sx:f.dropdownButtonSx},W.default.createElement(ue,{icon:"ArrowDropDown",sx:{fontSize:"inherit",color:"inherit"}})),W.default.createElement(D,{position:"absolute",bottom:`-${n?.transparentHeight||0}px`,width:"100%",height:`${n?.transparentHeight||0}px`,bgcolor:nt?"transparent":"red",zIndex:2000001})))))))},ui=os;var ns=o=>{let t=Ae();return t==="mail.google.com"?rs(o):t==="outlook.office.com"||t==="outlook.live.com"||t==="outlook.office365.com"?is(o):t==="twitter.com"?ss(o):t==="linkedin.com"?as(o):t==="facebook.com"?ls(o):t==="youtube.com"?[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]:t==="studio.youtube.com"?[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]:t==="instagram.com"?us(o):t==="reddit.com"?cs(o):[o.buttonGroupConfig.composeReplyButton,o.buttonGroupConfig.refineDraftButton]},rs=o=>{let{keyElement:t,buttonGroupConfig:e}=o,n=document.querySelectorAll("div[data-message-id]");for(let r=0;r<n.length;r++)if(n[r].nextElementSibling?.contains(t))return[e.composeReplyButton,e.refineDraftButton];return[e.composeNewButton,e.refineDraftButton]},is=o=>{let{keyElement:t,buttonGroupConfig:e}=o,n=document.querySelector('div[data-app-section="ConversationContainer"]'),r=document.querySelector("#ReadingPaneContainerId"),i=r.querySelectorAll('div[role="textbox"]:has(#removeButton)').length,a=r.querySelector("#RplyFwdMsg")||r.querySelector("#divRplyFwdMsg"),l=Array.from(document.querySelectorAll('div[role="dialog"]')).find(u=>u.contains(t)),s=r.querySelector('input[maxlength="255"]')?.value||"";return!n?.contains(t)&&i===0&&!a&&!l&&!s?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},ss=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return wr(t)?.querySelector('article[data-testid="tweet"]')?[e.composeReplyButton,e.refineDraftButton]:Array.from(document.querySelectorAll('article[data-testid="tweet"]')).find(i=>i.nextElementSibling?.contains(t))?[e.composeReplyButton,e.refineDraftButton]:[e.composeNewButton,e.refineDraftButton]},as=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return t.classList.contains("share-box_actions")?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},ls=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return go('form[method="POST"]',t,20)?[e.composeNewButton,e.refineDraftButton]:go('form[role="presentation"]',t)?.getBoundingClientRect().width<240?[]:[e.composeReplyButton,e.refineDraftButton]},us=o=>{let{keyElement:t,buttonGroupConfig:e}=o,n=go('div[contenteditable="true"]',t,20),r=dr('div[aria-label][role="dialog"]',n);return n&&r?[e.composeNewButton,e.refineDraftButton]:[e.composeReplyButton,e.refineDraftButton]},cs=o=>{let{keyElement:t,buttonGroupConfig:e}=o;return t.querySelector('button[type="submit"]')?[e.composeReplyButton,e.refineDraftButton]:[e.composeNewButton,e.refineDraftButton]},nn=ns;var ci=new ft("ContextMenu/InputAssistantButtonManager"),rn=class{constructor(){this.interval=1e3;this.stop=!1,this.host=Ae(),this.config=Mn[this.host],this.observerMap=new Map}createInputAssistantButtonListener(t){this.timer=setInterval(()=>{if(!this.stop&&this.config){let{rootSelectors:e,rootSelectorStyle:n,rootParentDeep:r=0}=this.config,i=[];e.map(s=>i.push(...document.querySelectorAll(s)));let a=!1;i.forEach(s=>{let u=s,c=s,p=r;for(;p>0;)p--,c=c.parentElement;n&&bt(u,n);let m=this.attachInputAssistantButton(c);m&&(a=!0,ci.info("newObserverData: ",m))}),(this.cleanObserverMap()||a)&&t(this.getAllObserverData(),this.config)}},this.interval)}attachInputAssistantButton(t){if(!this.config||t.querySelector("[maxai-input-assistant-button-id]"))return null;let{rootStyle:e,rootParentStyle:n,rootParentStyleDeep:r=1,rootNextElementSiblingStyle:i,rootPreviousElementSiblingStyle:a}=this.config;if(t&&e){if(a&&t.previousElementSibling){let E=t.previousElementSibling;bt(E,a)}if(t.style.cssText=e,i&&t.nextElementSibling){let E=t.nextElementSibling;bt(E,i)}}if(n){let E=0,d=t;for(;E<r;)E++,d=d?.parentElement;d&&bt(d,n)}let l=Ut(),{rootWrapperTagName:s,appendPosition:u,rootWrapperStyle:c}=this.config,p="customElements"in window,m=document.createElement(s);c&&bt(m,c);let h=document.createElement(p?"maxai-input-assistant-button":"div");if(h.setAttribute("maxai-input-assistant-button-id",l),m.appendChild(h),bn(u)){let E=t.childNodes[u];E?t.insertBefore(m,E):t.appendChild(m)}else t.appendChild(m);h.attachShadow({mode:"open"});let g=h.shadowRoot,y=document.createElement("div");g?.appendChild(y),ci.info("appendElement: ",m);let b=new MutationObserver(()=>{});if(b.observe(t,{childList:!0,subtree:!0}),nn({keyElement:t,buttonGroupConfig:this.config}).length===0)return b.disconnect(),m.remove(),null;let x={id:l,destroy:()=>{b.disconnect(),m.remove()},renderRootElement:y,observer:b,shadowRootElement:g,buttonGroup:nn({keyElement:t,buttonGroupConfig:this.config})};return this.observerMap.set(t,x),x}cleanObserverMap(){let t=!1;return this.observerMap.forEach((e,n)=>{let i=Array.from(e.shadowRootElement.querySelectorAll("style[data-emotion]")).find(a=>a.sheet?.cssRules.length===0&&a.innerHTML==="");document.body.contains(n)&&!i||(t=!0,e.destroy(),this.observerMap.delete(n))}),t}clearObserverMap(){this.observerMap.forEach((t,e)=>{t.destroy(),this.observerMap.delete(e)})}getAllObserverData(){let t=[];return this.observerMap.forEach(e=>t.push(e)),t}pause(){this.stop=!0,this.clearObserverMap()}continue(){this.stop=!1}},pi=rn;var ps=()=>{let o=j(qe),[t,e]=(0,Be.useState)(null),[n,r]=(0,Be.useState)([]),i=Be.default.useRef(null);Le(()=>{i.current=new pi,i.current.createInputAssistantButtonListener((l,s)=>{r(l),e(s)})});let a=(0,Be.useMemo)(()=>{let l=Ae();return l==="mail.google.com"?o.userSettings?.inputAssistantButton?.gmail===!0:l==="outlook.live.com"||l==="outlook.office.com"||l==="outlook.office365.com"?o.userSettings?.inputAssistantButton?.outlook===!0:l==="twitter.com"?o.userSettings?.inputAssistantButton?.twitter===!0:l==="linkedin.com"?o.userSettings?.inputAssistantButton?.linkedIn===!0:l==="facebook.com"?o.userSettings?.inputAssistantButton?.facebook===!0:l==="youtube.com"||l==="studio.youtube.com"?o.userSettings?.inputAssistantButton?.youtube===!0:l==="instagram.com"?o.userSettings?.inputAssistantButton?.instagram===!0:l==="reddit.com"?o.userSettings?.inputAssistantButton?.reddit===!0:!1},[o.userSettings?.inputAssistantButton]);return(0,Be.useEffect)(()=>{i.current&&(a?i.current?.continue():i.current?.pause())},[a]),Be.default.createElement(Be.default.Fragment,null,n.map(l=>(0,mi.createPortal)(Be.default.createElement(ui,{shadowRoot:l.shadowRootElement,rootId:l.id,buttonGroup:l.buttonGroup,root:l.renderRootElement,InputAssistantBoxSx:t?.InputAssistantBoxSx,CTAButtonStyle:t?.CTAButtonStyle,DropdownButtonStyle:t?.DropdownButtonStyle}),l.renderRootElement,l.id)))},di=ps;var ms=()=>et.default.createElement(et.default.Fragment,null,et.default.createElement(ri,{containerId:Wt},et.default.createElement(ai,null),et.default.createElement(li,null),et.default.createElement(gi,null)),et.default.createElement(di,null)),fi=ms;var ds=Ne(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="relative"&&(document.documentElement.style.position="unset",document.querySelector(`#${Fo}`)?.classList.replace("open","close"));let t=document.querySelector(`#${vt}`);t&&(t.style.display="none")}},100),fs=Ne(()=>{if(Ae()==="youtube.com"){document.documentElement.style.position==="unset"&&(document.documentElement.style.position="relative",document.querySelector(`#${Fo}`)?.classList.replace("close","open"));let t=document.querySelector(`#${vt}`);t&&(t.style.display="")}},100),gs=()=>{let o=Ae();Le(()=>{if(o==="youtube.com"){let t=new MutationObserver(n=>{n.forEach(r=>{r.target&&(r.target.hasAttribute("scrolling")?ds():fs())})}),e=document.querySelector("ytd-app");e&&t.observe(e,{attributes:!0,childList:!1,subtree:!1})}})},xi=gs;var hi=new ft("AppInit"),xs=()=>window.location.host!=="www.usechatgpt.ai"&&window.location.host!=="www.maxai.me"?v.default.createElement(v.default.Fragment,null):v.default.createElement(K,{onClick:()=>{Me({key:"shortcuts"})},id:"usechatgpt-www-to-shortcuts",sx:{position:"absolute",width:1,height:1,zIndex:-1,opacity:0}}),hs=()=>{let o=le(qe),t=le(gn);return Sr(),(0,v.useEffect)(()=>{let e=async()=>{let n=await mo();n&&(o({...n}),hi.info("get db settings",n));let r=await Tn();r&&(t({...r}),hi.info("get local settings",r))};return e(),window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),v.default.createElement(v.default.Fragment,null)},ys=()=>{let{t:o}=H(["common","client"]),[t,e]=v.default.useState(null),n=v.default.useRef(!1);Le(()=>{window.location.href.includes(sn.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")&&e(100)}),Cr(()=>{let r=document.body.querySelector("#usechatgptPDFViewerErrorAlert");if(r){if(n.current)return;n.current=!0,e(null);let i=r.getAttribute("data-url");(0,yi.render)(v.default.createElement(z,{spacing:2,p:2,width:"100%",sx:{boxSizing:"border-box"}},v.default.createElement(z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1.4,color:"#fff"},v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:48,width:48,src:"/assets/USE_CHAT_GPT_AI/icons/maxai_48_normal.png"}),v.default.createElement(G,{variant:"body1",fontSize:18,fontWeight:700},o("client:pdf__info_card__title"))),v.default.createElement(z,{alignItems:"center",spacing:0},v.default.createElement(G,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},o("client:pdf__info_card__access_permission__description1"),v.default.createElement(Kt,{color:"rgba(255,255,255,1)",href:"#",onClick:async a=>{a.preventDefault(),await Me({key:"manage_extension"}),window.close()}},"chrome://extensions"),` ${o("client:pdf__info_card__access_permission__description2")} `),v.default.createElement(G,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{width:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",mb:2}},i),v.default.createElement(D,{mb:2},v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Wo("/images/pdf/guide-1.gif")})),v.default.createElement(K,{disableElevation:!0,size:"small",variant:"contained",onClick:async a=>{a.preventDefault(),await Me({key:"manage_extension"}),window.close()},sx:{height:"56px",backgroundColor:"#7601D3",color:"#fff",fontSize:"18px",textTransform:"none",px:3,"&:hover":{backgroundColor:"#7601D3",color:"#fff"}}},o("client:pdf__info_card__access_permission__button"))),v.default.createElement(Fn,{sx:{color:"#fff"}},o("common:or")),v.default.createElement(z,{spacing:2},v.default.createElement(G,{flex:1,color:"rgba(255,255,255,0.85)",fontSize:"14px",sx:{overflowWrap:"break-word"}},o("client:pdf__info_card__disabled__description1"),v.default.createElement(Kt,{color:"rgba(255,255,255,1)",href:"#",onClick:async a=>{a.preventDefault(),a.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"}),window.close()}},o("client:pdf__info_card__disabled__description2")),o("client:pdf__info_card__disabled__description3")),v.default.createElement("img",{style:{flexShrink:0,alignSelf:"center"},height:156,width:468,src:Wo("/images/pdf/guide-2.gif")}))),r);return}},t)},gi=()=>{let{t:o}=H(["client","common"]);return(0,v.useMemo)(()=>window.location.href.includes(sn.default.runtime.id)&&window.location.href.includes("/pages/pdf/web/viewer.html")?document.body.querySelector("#usechatgpt-disabled-pdf")||window.localStorage.getItem("hide_usechatgptai_pdf_alert")==="true"?null:v.default.createElement(D,{position:"fixed",right:8,top:40,zIndex:1e4,id:"usechatgpt-disabled-pdf"},v.default.createElement(Co,{icon:v.default.createElement(v.default.Fragment,null),action:v.default.createElement(v.default.Fragment,null),sx:{p:"8px!important",bgcolor:"#fff",border:"1px solid #7601D3","& > div":{"&:first-of-type":{display:"none"},"&:nth-of-type(2)":{padding:"0!important"},"&:last-of-type":{margin:"0!important",padding:"0!important",position:"absolute",top:0,right:0}},"& *":{color:"#7601D3"}}},v.default.createElement(z,{spacing:1,maxWidth:320},v.default.createElement(z,{direction:"row",alignItems:"center",spacing:1},v.default.createElement(Ee,{sx:{fontSize:14}}),v.default.createElement(G,{variant:"body1",fontSize:14,fontWeight:700},o("client:pdf__floating_card__title"))),v.default.createElement(G,{fontSize:14},o("client:pdf__floating_card__description1"),v.default.createElement(Kt,{href:"#",onClick:async e=>{e.preventDefault(),e.stopPropagation(),await Me({key:"options",query:"?id=pdf-viewer#/appearance"})}},o("client:pdf__floating_card__description2")),o("client:pdf__floating_card__description3")),v.default.createElement(K,{size:"small",disableElevation:!0,sx:{bgcolor:"#7601D3",color:"#fff","&:hover":{bgcolor:"#7601D3"},textTransform:"none"},onClick:async()=>{window.localStorage.setItem("hide_usechatgptai_pdf_alert",JSON.stringify(!0)),ne()?.querySelector("#usechatgpt-disabled-pdf")?.remove()}},o("client:pdf__floating_card__button"))))):null,[o])},Cs=()=>(xi(),hr(),Yt(),Nn(),vr(),Rr(),Gn(),ys(),Or(),Le(()=>{Cn()&&He(),Br(),Nr(),_r().then().catch(),qr()}),$r(),Lr(),v.default.createElement(v.default.Fragment,null,v.default.createElement(fi,null),v.default.createElement(hs,null),v.default.createElement(xs,null))),xf=Cs;export{hs as a,xf as b};
