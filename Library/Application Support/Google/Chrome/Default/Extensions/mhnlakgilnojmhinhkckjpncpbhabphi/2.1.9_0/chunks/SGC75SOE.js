var T=M=>{M.createModule("SaveRestore",["WrappedSelection"],function(l,u){let m=l.dom,d=m.removeNode,k=l.Selection.isDirectionBackward,B="\uFEFF";function c(e,o){return(o||document).getElementById(e)}function f(e,o){let t="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),n,r=m.getDocument(e.startContainer),a=e.cloneRange();return a.collapse(o),n=r.createElement("span"),n.id=t,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(B)),a.insertNode(n),n}function R(e,o,t,n){let r=c(t,e);r?(o[n?"setStartBefore":"setEndBefore"](r),d(r)):u.warn("Marker element has been removed. Cannot restore selection.")}function S(e,o){return o.compareBoundaryPoints(e.START_TO_START,e)}function y(e,o){let t,n,r=l.DomRange.getRangeDocument(e),a=e.toString(),s=k(o);return e.collapsed?(n=f(e,!1),{document:r,markerId:n.id,collapsed:!0}):(n=f(e,!1),t=f(e,!0),{document:r,startMarkerId:t.id,endMarkerId:n.id,collapsed:!1,backward:s,toString:function(){return"original text: '"+a+"', new text: '"+e.toString()+"'"}})}function h(e,o){let t=e.document;typeof o>"u"&&(o=!0);let n=l.createRange(t);if(e.collapsed){let r=c(e.markerId,t);if(r){r.style.display="inline";let a=r.previousSibling;a&&a.nodeType==3?(d(r),n.collapseToPoint(a,a.length)):(n.collapseBefore(r),d(r))}else u.warn("Marker element has been removed. Cannot restore selection.")}else R(t,n,e.startMarkerId,!0),R(t,n,e.endMarkerId,!1);return o&&n.normalizeBoundaries(),n}function I(e,o){let t=[],n,r,a=k(o);e=e.slice(0),e.sort(S);let s=0,g=e.length;for(g;s<g;++s)t[s]=y(e[s],a);for(s=g-1;s>=0;--s)n=e[s],r=l.DomRange.getRangeDocument(n),n.collapsed?n.collapseAfter(c(t[s].markerId,r)):(n.setEndBefore(c(t[s].endMarkerId,r)),n.setStartAfter(c(t[s].startMarkerId,r)));return t}function v(e){if(!l.isSelectionValid(e))return u.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;let o=l.getSelection(e),t=o.getAllRanges(),n=t.length==1&&o.isBackward(),r=I(t,n);return n?o.setSingleRange(t[0],n):o.setRanges(t),{win:e,rangeInfos:r,restored:!1}}function p(e){let o=[],t=e.length;for(let n=t-1;n>=0;n--)o[n]=h(e[n],!0);return o}function w(e,o){if(!e.restored){let t=e.rangeInfos,n=l.getSelection(e.win),r=p(t);t.length==1&&o&&l.features.selectionHasExtend&&t[0].backward?(n.removeAllRanges(),n.addRange(r[0],!0)):n.setRanges(r),e.restored=!0}}function i(e,o){let t=c(o,e);t&&d(t)}function E(e){let o=e.rangeInfos;for(let t=0,n=o.length,r;t<n;++t)r=o[t],r.collapsed?i(e.doc,r.markerId):(i(e.doc,r.startMarkerId),i(e.doc,r.endMarkerId))}l.util.extend(l,{saveRange:y,restoreRange:h,saveRanges:I,restoreRanges:p,saveSelection:v,restoreSelection:w,removeMarkerElement:i,removeMarkers:E})})},b=T;export{b as a};
