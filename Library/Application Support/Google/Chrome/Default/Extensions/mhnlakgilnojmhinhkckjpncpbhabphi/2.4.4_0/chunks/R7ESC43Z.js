import{d as Yr}from"./F7SGTV27.js";import{a as tl}from"./5QWZ7UE4.js";import{c as Pi,l as Xr}from"./FOUKVBQX.js";import{T as Ht,g as Ft}from"./NXGYST7J.js";import{c as Si,e as Ii,f as za}from"./LP276KYG.js";import{a as Hn,d as Ua}from"./RO4X7EGV.js";import{a as Wa}from"./2N2SG5RC.js";import{a as Xa}from"./NNU75GHZ.js";import{e as Bt}from"./QJSKL7UD.js";import{a as Kp,d as Ha,h as hn,i as jr,j as Ga}from"./XYZAUIQ2.js";import{c as qe}from"./QONG524O.js";import{b as qr,c as Ma,d as Ra,e as ka,i as La,j as Oa,k as Na,l as Da,m as Ba,p as Fa}from"./ES4G5FSE.js";import{c as $r,h as Ei}from"./6UCR6JSM.js";import{a as ye,b as Yp,c as Ci}from"./IPNS2UUO.js";import{d as Dt}from"./FRAG5SMK.js";import{a as gn}from"./HYW7LR6S.js";import{D as Aa,a as W,b as xi,i as wa,o as jp,q as Nt,r as Qe,u as $,v as Pa,y as _a}from"./DRCUZC3I.js";import{a as cn}from"./RSO45DR6.js";import{d as ea,e as ta,g as Nr,t as na}from"./PF3XPTWR.js";import{B as Zs,F as We,G as Dr,H as fi,I as pe,c as Yt,f as B,g as Kt,k as Ue,n as Me,p as Bn,q as Qt}from"./MWTIYFYH.js";import{a as ia,b as Vr,c as Kr,f as Va,fa as Ka,g as $a,ga as Za,m as Xp,ma as el,n as Qp,o as Jp,p as qa,q as ja,r as wi,s as Ya}from"./IQBPRLVE.js";import{b as oa,f as Ur,g as ma,h as bi,i as ga,j as Ti,k as ha,l as Wr,n as Ta,o as xa,q as Ca,r as Sa,s as Ae,t as Ea,w as Ia,y as bt,z as Fn}from"./HEBGDMW5.js";import{a as Xe}from"./W2F53U5Z.js";import{d as mn,e as Gr,g as Jt,h as ya,i as va,k as zr,m as ba}from"./TYBXNNUH.js";import{b as Qa,f as Ja}from"./DUIWQHLB.js";import{a as Ut}from"./KG5SJQNS.js";import{$ as Hr,A as ua,D as fn,N as kt,O as Lt,R as pa,U as da,V as fa,_ as Fr,a as te,e as ue,f as sa,h as ie,i as aa,j as mi,n as dn,o as gi,p as hi,r as yi,s as vi,t as la,w as Br,z as ca}from"./AAMCXCLO.js";import{a as Ot,c as ve}from"./CAPNT4IP.js";import{d as de,e as ra}from"./YN4XY6JW.js";import{J as Js,K as He,L as un,M as Xt,T as Or,U as pn,V as vt,a as z,b as js,d as Ce,e as Ys,f as Oe,g as ae,h as dt,q as Lr,r as Ks,s as Xs,t as di,x as Qs}from"./IPAGS25B.js";import{a as kr}from"./3JX3VARJ.js";import{c as Rr,d as qp,e as pi,f as C}from"./PQ35KENF.js";var Ni=Rr(oo=>{"use strict";var xd=xi();Object.defineProperty(oo,"__esModule",{value:!0});oo.default=void 0;var Cd=xd(Ci()),Sd=Me(),Ed=(0,Cd.default)((0,Sd.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");oo.default=Ed});var Rl=Rr(io=>{"use strict";var kd=xi();Object.defineProperty(io,"__esModule",{value:!0});io.default=void 0;var Ld=kd(Ci()),Od=Me(),Nd=(0,Ld.default)((0,Od.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),"Search");io.default=Nd});var is=Rr(So=>{"use strict";var rm=xi();Object.defineProperty(So,"__esModule",{value:!0});So.default=void 0;var om=rm(Ci()),im=Me(),sm=(0,om.default)((0,im.jsx)("path",{d:"m7 10 5 5 5-5z"}),"ArrowDropDown");So.default=sm});var wp=Rr((Ds,Bs)=>{(function(e,t){typeof Ds=="object"&&typeof Bs<"u"?Bs.exports=t():typeof define=="function"&&define.amd?define(t):(e=typeof globalThis<"u"?globalThis:e||self).dayjs_plugin_relativeTime=t()})(Ds,function(){"use strict";return function(e,t,n){e=e||{};var r=t.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function i(l,a,c,u){return r.fromToBase(l,a,c,u)}n.en.relativeTime=o,r.fromToBase=function(l,a,c,u,p){for(var f,d,g,m=c.$locale().relativeTime||o,v=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],h=v.length,b=0;b<h;b+=1){var T=v[b];T.d&&(f=u?n(l).diff(c,T.d,!0):c.diff(l,T.d,!0));var I=(e.rounding||Math.round)(Math.abs(f));if(g=f>0,I<=T.r||!T.r){I<=1&&b>0&&(T=v[b-1]);var x=m[T.l];p&&(I=p(""+I)),d=typeof x=="string"?x.replace("%d",I):x(I,a,T.l,g);break}}if(a)return d;var P=g?m.future:m.past;return typeof P=="function"?P(d):P.replace("%s",d)},r.to=function(l,a){return i(l,a,this,!0)},r.from=function(l,a){return i(l,a,this)};var s=function(l){return l.$u?n.utc():n()};r.toNow=function(l){return this.to(s(this),l)},r.fromNow=function(l){return this.from(s(this),l)}}})});var Zt=new Xe("ArkoseIframeGenerator"),_i=class e{constructor(){this.iframeInstance=null}static{this.iframeId="maxai-arkose-token-generate-iframe"}async injectIframe(t){if(await this.ping(t))return!0;for(let r=0;r<1;r++){if(await Vr(this.injectIframeOnce(),1e4,!1))return Zt.info("inject iframe success"),!0;Zt.info("inject iframe fail","retry times",r+1),this.removeIframe()}return Zt.info("inject iframe fail"),!1}async generateToken(t){if(!await this.injectIframe(t))return"";let n=await Vr(this.postMessageGenerateToken(t),10*1e3,"");return n||this.removeIframe(),Zt.info(`generateToken ${n?"success":"fail"}`,n),n}getRootContainer(){return mn()}async ping(t){return Zt.info("ping"),this.iframeInstance?await Vr(new Promise(r=>{let o=i=>{if(i.data&&i.data.id===cn){let{data:s,type:l}=i.data;l==="pong"&&(Zt.info("ping result",s?.success===!0),r(s?.success===!0),window.removeEventListener("message",o))}};window.addEventListener("message",o),this.iframeInstance?.contentWindow?.postMessage({id:cn,type:"ping",data:{model:t}},"*")}),2e3,!1)?!0:(this.removeIframe(),!1):(Zt.info("ping result",!1),!1)}injectIframeOnce(){return new Promise(t=>{let n=o=>{if(o.data&&o.data.id===cn){let{data:i,type:s}=o.data;s==="inject_iframe_response"&&(t(i?.success===!0),window.removeEventListener("message",n))}};window.addEventListener("message",n);let r=document.createElement("iframe");r.id=e.iframeId,r.src="https://chat.openai.com/robots.txt",r.style.cssText=`
      position: absolute !important;
      opacity: 0 !important;
      width: 1px !important;
      height: 1px !important;
      top: 0 !important;
      left: 0 !important;
      border: none !important;
      display: block !important;
      z-index: -1 !important;
      pointer-events: none;`,this.iframeInstance=r,this.getRootContainer()?.append(r)})}removeIframe(){let t=this.getRootContainer()?.querySelector(`#${e.iframeId}`);t&&(this.iframeInstance=null,t.remove())}async postMessageGenerateToken(t){return new Promise(n=>{let r=o=>{if(o.data&&o.data.id===cn){let{data:i,type:s}=o.data;s==="get_token_response"&&(n(i?.token||""),window.removeEventListener("message",r))}};window.addEventListener("message",r),this.iframeInstance?.contentWindow?.postMessage({id:cn,type:"get_token",data:{model:t}},"*")})}},nl=new _i;var il="https://chat.openai.com",Qr="MaxAI.me",Tt=(e,t,n,r)=>fetch(`${il}${n}`,{method:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:r===void 0?void 0:JSON.stringify(r)}),Zp=async e=>{let{uuid:t}=e;try{let n=await Un();return{success:!0,data:(await(await Tt(n,"GET",`/backend-api/files/${t}/download`)).json())?.download_url}}catch{return{success:!1,data:""}}},ed=async e=>{let{conversationId:t,message_id:n,sandbox_path:r}=e,o=`https://chat.openai.com/c/${t}`;try{let i=await Un(),l=await(await Tt(i,"GET",`/backend-api/conversation/${t}/interpreter/download?message_id=${n}&sandbox_path=${r}`)).json();return l?.status==="error"?{success:!1,data:o,error:"File Expired"}:{success:!0,data:l?.download_url||o}}catch{return{success:!1,data:o,error:"Network Error"}}},td=async e=>{try{let{token:t,offset:n=0,limit:r=100,order:o="updated"}=e;return(await(await Tt(t,"GET",`/backend-api/conversations?offset=${n}&limit=${r}&order=${o}`)).json())?.items||[]}catch{return[]}},rl=async({token:e,conversationId:t,messageId:n,input:r})=>{try{await Tt(e,"POST","/backend-api/moderations",{conversation_id:t,message_id:n,input:r,model:"text-moderation-playground"})}catch{}},Ai=async(e,t,n)=>{await Tt(e,"PATCH",`/backend-api/conversation/${t}`,n)},Un=async(e=!1)=>{let t=await fetch("https://chat.openai.com/api/auth/session");if(t.status===403&&!e)throw new Error("CLOUDFLARE");let n=await t.json().catch(()=>({}));if(!n.accessToken&&!e)throw new Error("UNAUTHORIZED");return n?.accessToken||""},nd=async e=>{if(["text-davinci-002-render-sha","gpt-4","gpt-4-code-interpreter","gpt-4-browsing","gpt-4-plugins","gpt-4-mobile"].includes(e)){let n=await nl.generateToken(e.startsWith("gpt-4")?"gpt_4":"gpt_3_5");if(!n)throw Error("Something went wrong, please try again. If this issue persists, contact us via email.");return n}else return""},Mi=class{constructor(t){this.isCleaningCache=!1;this.token=t.token,this.model=t.model,this.lastChatGPTAnswerMessageId=te(),this.id=te(),this.conversationId=t.conversationId||void 0,this.conversationInfo={title:"",messages:[]}}async updateTitle(t){!this.conversationId||this.conversationInfo.title===t||(await Ai(this.token,this.conversationId,{title:t}),this.conversationInfo.title=t)}async fetchHistoryAndConfig(){if(this.conversationId)try{let n=await(await Tt(this.token,"GET",`/backend-api/conversation/${this.conversationId}`)).json();this.conversationInfo={title:n.title,messages:ia(n.current_node,n.mapping),raw:n},n.title!==Qr&&await this.updateTitle(Qr),this.lastChatGPTAnswerMessageId=n.current_node}catch{this.lastChatGPTAnswerMessageId=te(),this.conversationId=void 0,this.conversationInfo={title:"",messages:[]}}}async generateAnswer(t,n=!1){let r=t.messageId||te(),o=t.parentMessageId||this.lastChatGPTAnswerMessageId||te(),i=!1,s="",l="",a=await bt("OPENAI"),c;try{c=await nd(this.model)}catch(f){t.onEvent({type:"error",data:{message:f.message||"Network error.",detail:""}}),t.onEvent({type:"done"});return}let u={action:n?"variant":"next",messages:[{id:r,author:{role:"user"},content:{content_type:"text",parts:[t.prompt]}}],model:this.model,parent_message_id:o,timezone_offset_min:new Date().getTimezoneOffset(),history_and_training_disabled:!1};if(this.conversationId&&(u.conversation_id=this.conversationId),c&&(u.arkose_token=c),t.meta)if(t.meta?.attachments&&this.model==="gpt-4")try{u.messages[0].content.content_type="multimodal_text",u.messages[0].content.parts=t.meta.attachments.map(f=>({width:0,height:0,asset_pointer:`file-service://${f.id}`,size_bytes:f.size})).concat(u.messages[0].content.parts)}catch{}else u.messages[0].metadata=t.meta;a?.plugins&&!this.conversationId&&this.model==="gpt-4-plugins"&&(u.plugin_ids=a.plugins);let p=[];await oa(`${il}/backend-api/conversation`,{provider:He.OPENAI,method:"POST",signal:t.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`},body:JSON.stringify(Object.assign(u)),onMessage:async f=>{if(f==="[DONE]"){s&&this.conversationId&&l&&(this.updateTitle(Qr),rl({token:this.token,conversationId:this.conversationId,messageId:l,input:s}));let m=s;p.length>0&&(await Promise.all(p.map(async b=>await Zp({uuid:b})))).forEach(b=>{b.success&&b.data&&(m=`![image](${b.data})
${m}`)});let v=m.match(/\[.*?\]\(.*?\)/g);this.conversationId&&v&&v.length>0?((await Promise.all(v.map(async b=>{let T=b.split("](");if(T.length!==2)return;let I=T[0].slice(1),x=T[1].slice(0,-1);if(!x.startsWith("sandbox:"))return;let P=await ed({conversationId:this.conversationId,message_id:l,sandbox_path:x.replace("sandbox:","")});if(P.success)return{original:b,new:`[${I}](${P.data})`}}))).forEach(b=>{b&&(m=m.replace(b.original,b.new))}),t.onEvent({type:"answer",data:{text:m,messageId:l,conversationId:this.conversationId,parentMessageId:r}}),setTimeout(()=>{t.onEvent({type:"done"})},100)):t.onEvent({type:"done"});return}let d;try{d=JSON.parse(f)}catch{return}let g=d.message?.content?.parts?.[0]||d.message?.content?.text||"";if(g.includes("<<ImageDisplayed>>")){let v=(d.message?.metadata?.aggregate_result?.messages?.[0]?.image_url).split("//")[1];if(p.find(h=>h===v))return;p.push(v)}g?(s=g,l=d.message.id,this.conversationId=d.conversation_id,this.lastChatGPTAnswerMessageId=d.message.id,this.conversationId&&!i&&(i=!0,rl({token:this.token,conversationId:this.conversationId,messageId:r,input:t.prompt})),t.onEvent({type:"answer",data:{text:g,messageId:d.message.id,conversationId:d.conversation_id,parentMessageId:r}})):d.error&&t.onEvent({type:"error",data:{message:d.error,detail:""}})}}).then().catch(f=>{try{if(f?.message==="BodyStreamBuffer was aborted"||f?.message==="The user aborted a request."){t.onEvent({type:"error",data:{message:"manual aborted request.",detail:""}});return}let d=JSON.parse(f.message||f);t.onEvent({type:"error",data:{message:d.message,detail:d.detail}})}catch{t.onEvent({type:"error",data:{message:"Network error.",detail:""}})}})}async close(){this.conversationId&&(await Ai(this.token,this.conversationId,{is_visible:!1}),this.conversationInfo={title:"",messages:[]})}async removeCacheConversation(){if(!this.isCleaningCache&&this.token){let n=(await td({token:this.token})).filter(o=>o.title===Qr&&o.id!==this.conversationId);if(n.length===0)return;this.isCleaningCache=!0;let r=o=>new Promise(i=>setTimeout(i,o));for(let o=0;o<n.length;o++)try{await Ai(this.token,n[o].id,{is_visible:!1}),await r(3e3)}catch{}this.isCleaningCache=!1}}},ol=class{constructor(){this.conversations=[],this.abortFunctions={},this.plugins=[],this.token=void 0,this.models=[]}async fetchModels(t){if(this.models.length>0)return this.models;let n=await Tt(t,"GET","/backend-api/settings/beta_features").then(async o=>{let i=await o.json();return{browsing:i?.browsing||!1,chat_preferences:i?.chat_preferences||!1,code_interpreter:i?.code_interpreter||!1,plugins:i?.plugins||!1}}).catch(()=>({browsing:!1,chat_preferences:!1,code_interpreter:!1,plugins:!1})),r=await Tt(t,"GET","/backend-api/models").then(o=>o.json());return r?.models&&r.models.length>0&&(this.models=r.models.filter(o=>o.slug==="gpt-4-code-interpreter"?n.code_interpreter:o.slug==="gpt-4-browsing"?n.browsing:o.slug==="gpt-4-plugins"?n.plugins:!0)),this.models}async fetchPlugins(t){if(this.plugins.length>0)return this.plugins;let n=await Tt(t,"GET","/backend-api/aip/p?offset=0&limit=100&is_installed=true").then(r=>r.json());return n?.items&&n.items.length>0&&(this.plugins=n.items),n.items}async getModelName(t,n){try{let r=await this.fetchModels(t);if(r?.length>0){if(n){let o=r.find(i=>i.slug===n);if(o)return o.slug}return r[0].slug}return"text-davinci-002-render-sha"}catch{return"text-davinci-002-render-sha"}}async getAllModels(){if(this.models.length>0)return this.models;try{let t=this.token||await Un();return t&&(this.token=t),await this.fetchModels(t)}catch{return[]}}async getAllPlugins(){if(this.plugins.length>0)return this.plugins;try{let t=this.token||await Un();return t&&(this.token=t),await this.fetchPlugins(t)}catch{return[]}}async createConversation(t,n){if(this.conversations.length>0)return this.conversations[0];try{let r=this.token||await Un(),o=await this.getModelName(r,n),i=new Mi({token:r,model:o,conversationId:t});return this.conversations.push(i),i.removeCacheConversation(),await i.fetchHistoryAndConfig(),i}catch(r){r.message==="CLOUDFLARE"&&location.reload();return}}getConversation(t){return this.conversations.find(n=>n.id===t||n.conversationId===t)}getConversations(){return this.conversations}async closeConversation(t){try{let n=this.getConversation(t);return n&&(await n.close(),this.conversations=this.conversations.filter(r=>r.conversationId!==t)),!0}catch{return!1}}addAbortWithMessageId(t,n){this.abortFunctions[t]=n}removeAbortWithMessageId(t){delete this.abortFunctions[t]}abortWithMessageId(t){try{this.abortFunctions[t]&&(this.abortFunctions[t](),delete this.abortFunctions[t])}catch{}}removeCacheConversation(){return this.conversations?.[0]?.removeCacheConversation()}};Kt();var cl=C(z());var ul=C(Ot()),pl=C(Nt()),dl=C(Bn());var sl=C(Yt()),al=C(Qt());function ll(e){return(0,al.default)("MuiDivider",e)}var rd=(0,sl.unstable_generateUtilityClasses)("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Jr=rd;var Ri=C(Me()),od=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],id=e=>{let{absolute:t,children:n,classes:r,flexItem:o,light:i,orientation:s,textAlign:l,variant:a}=e;return(0,pl.unstable_composeClasses)({root:["root",t&&"absolute",a,i&&"light",s==="vertical"&&"vertical",o&&"flexItem",n&&"withChildren",n&&s==="vertical"&&"withChildrenVertical",l==="right"&&s!=="vertical"&&"textAlignRight",l==="left"&&s!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",s==="vertical"&&"wrapperVertical"]},ll,r)},sd=pe("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.absolute&&t.absolute,t[n.variant],n.light&&t.light,n.orientation==="vertical"&&t.vertical,n.flexItem&&t.flexItem,n.children&&t.withChildren,n.children&&n.orientation==="vertical"&&t.withChildrenVertical,n.textAlign==="right"&&n.orientation!=="vertical"&&t.textAlignRight,n.textAlign==="left"&&n.orientation!=="vertical"&&t.textAlignLeft]}})(({theme:e,ownerState:t})=>B({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:e.vars?`rgba(${e.vars.palette.dividerChannel} / 0.08)`:(0,dl.alpha)(e.palette.divider,.08)},t.variant==="inset"&&{marginLeft:72},t.variant==="middle"&&t.orientation==="horizontal"&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},t.variant==="middle"&&t.orientation==="vertical"&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},t.orientation==="vertical"&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"}),({theme:e,ownerState:t})=>B({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{position:"relative",width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`,top:"50%",content:'""',transform:"translateY(50%)"}}),({theme:e,ownerState:t})=>B({},t.children&&t.orientation==="vertical"&&{flexDirection:"column","&::before, &::after":{height:"100%",top:"0%",left:"50%",borderTop:0,borderLeft:`thin solid ${(e.vars||e).palette.divider}`,transform:"translateX(0%)"}}),({ownerState:e})=>B({},e.textAlign==="right"&&e.orientation!=="vertical"&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},e.textAlign==="left"&&e.orientation!=="vertical"&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})),ad=pe("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.wrapper,n.orientation==="vertical"&&t.wrapperVertical]}})(({theme:e,ownerState:t})=>B({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},t.orientation==="vertical"&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`})),ld=cl.forwardRef(function(t,n){let r=We({props:t,name:"MuiDivider"}),{absolute:o=!1,children:i,className:s,component:l=i?"div":"hr",flexItem:a=!1,light:c=!1,orientation:u="horizontal",role:p=l!=="hr"?"separator":void 0,textAlign:f="center",variant:d="fullWidth"}=r,g=Ue(r,od),m=B({},r,{absolute:o,component:l,flexItem:a,light:c,orientation:u,role:p,textAlign:f,variant:d}),v=id(m);return(0,Ri.jsx)(sd,B({as:l,className:(0,ul.default)(v.root,s),role:p,ref:n,ownerState:m},g,{children:i?(0,Ri.jsx)(ad,{className:v.wrapper,ownerState:m,children:i}):null}))}),ki=ld;Kt();var eo=C(z());var hl=C(Ot()),yl=C(Nt());var fl=C(Yt()),ml=C(Qt());function gl(e){return(0,ml.default)("MuiListItemIcon",e)}var cd=(0,fl.unstable_generateUtilityClasses)("MuiListItemIcon",["root","alignItemsFlexStart"]),Zr=cd;var vl=C(Me()),ud=["className"],pd=e=>{let{alignItems:t,classes:n}=e;return(0,yl.unstable_composeClasses)({root:["root",t==="flex-start"&&"alignItemsFlexStart"]},gl,n)},dd=pe("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.alignItems==="flex-start"&&t.alignItemsFlexStart]}})(({theme:e,ownerState:t})=>B({minWidth:56,color:(e.vars||e).palette.action.active,flexShrink:0,display:"inline-flex"},t.alignItems==="flex-start"&&{marginTop:8})),fd=eo.forwardRef(function(t,n){let r=We({props:t,name:"MuiListItemIcon"}),{className:o}=r,i=Ue(r,ud),s=eo.useContext(Hn),l=B({},r,{alignItems:s.alignItems}),a=pd(l);return(0,vl.jsx)(dd,B({className:(0,hl.default)(a.root,o),ownerState:l,ref:n},i))}),md=fd;var Wn=C(z());var Wt=Ce({key:"ChatGPTClientState",default:{loaded:!1,status:"needAuth",aborts:[]}}),yn=Ce({key:"ClientConversationMapState",default:{}});var Gt=Ce({key:"ChatGPTConversationState",default:{writingMessage:null,lastMessageId:"",model:"",loading:!1}}),Li=new URLSearchParams(window.location.search),bl=Li.get("conversationType");if(bl&&ra()){Li.delete("conversationType");let e=window.location.pathname+"?"+Li.toString();history.replaceState(null,"",e)}var Tl=Ce({key:"SidebarPageState",default:{sidebarConversationType:bl||"Chat"}});var gd=()=>{let[e,t]=ae(vt),n=Oe(yn),[r,o]=ae(Tl),i=r.sidebarConversationType,s=e.sidebarSettings?.common?.currentAIProvider,l=(0,Wn.useMemo)(()=>{switch(i){case"Chat":return e.sidebarSettings?.chat?.conversationId;case"Search":return e.sidebarSettings?.search?.conversationId;case"Summary":return e.sidebarSettings?.summary?.conversationId;default:return""}},[i,e.sidebarSettings?.chat?.conversationId,e.sidebarSettings?.search?.conversationId,e.sidebarSettings?.summary?.conversationId]),a=(0,Wn.useMemo)(()=>({Chat:n[e.sidebarSettings?.chat?.conversationId||""]?.messages||[],Search:n[e.sidebarSettings?.search?.conversationId||""]?.messages||[],Summary:n[e.sidebarSettings?.summary?.conversationId||""]?.messages||[]}),[l,e.sidebarSettings?.chat?.conversationId,e.sidebarSettings?.search?.conversationId,e.sidebarSettings?.summary?.conversationId,n]),c=(0,Wn.useMemo)(()=>n[l||""],[l,n]),u=(0,Wn.useMemo)(()=>a[i]||[],[i,a]),p=async d=>{await Ea({sidebarSettings:d});let g=await Ae();t(m=>({...m,sidebarSettings:g.sidebarSettings}))},f=d=>{o(g=>({...g,sidebarConversationType:d}))};return{sidebarSettings:e.sidebarSettings,currentSidebarConversationType:i,currentSidebarAIProvider:s,currentSidebarConversation:c,currentSidebarConversationId:l,currentSidebarConversationMessages:u,sidebarConversationTypeMessageMap:a,updateSidebarSettings:p,updateSidebarConversationType:f}},Ge=gd;var to=Ce({key:"AuthState",default:{isLogin:!1}}),no=Ce({key:"AuthUserInfoState",default:{user:null,loading:!1}});var Hs=C(z());var xl=(e,t)=>{if(!e)return[];if(typeof e[0]=="string"||typeof e[0]=="number")return e.map(o=>({label:String(o),value:String(o)}));let{labelKey:n="label",valueKey:r="value"}=t||{};return e.map(o=>({label:o[n],value:o[r],origin:o}))},Cl=(e,t)=>{for(let n=e.length-1;n>=0;n--){let r=e[n];if(t(r))return r}},hd=(e,t,n=[])=>{Object.entries(e).forEach(([r,o])=>{let i=[...n,r];typeof o=="object"&&o!==null?hd(o,t,i):t(i,o)})},Vh=(...e)=>{let t=e.reduce((r,o)=>Math.max(r,o.length),0),n=[];for(let r=0;r<t;r++)for(let o of e)o[r]&&n.push(o[r]);return n};var Eo=C(z());var j=C(z());var st=C(z());var Sl=C(Kp());var yd=()=>{let{t:e}=ve(["common","client"]);return st.default.createElement(W,{minWidth:400,spacing:2,p:1},st.default.createElement(W,{boxSizing:"border-box",direction:"row",width:"100%",alignItems:"center",justifyContent:"space-between"},st.default.createElement(qe,{sx:{flexShrink:0,textDecoration:"none!important"},href:Xt,target:"_blank"},st.default.createElement(W,{direction:"row",alignItems:"center",gap:1},st.default.createElement(qr,{sx:{fontSize:28,color:"inherit"}}),st.default.createElement($,{color:"text.primary",component:"h1",fontSize:20,fontWeight:800},e("client:sidebar__refresh_page__title"))))),st.default.createElement(Ha,{severity:"info"},st.default.createElement($,{fontSize:14,color:"text.primary",textAlign:"left"},e("client:sidebar__refresh_page__description"))),st.default.createElement(Dt,{fullWidth:!0,color:"primary",variant:"contained",startIcon:st.default.createElement(Sl.default,{sx:{fontSize:16,color:"inherit"}}),onClick:async()=>{window.location.reload()}},e("client:sidebar__refresh_page__button")))},El=yd;var Ee=C(z());var Oi=C(z()),vd=[{beta:!1,label:"client:provider__bing_web_app__title",description:"",value:He.BING,authDescription:"client:provider__bing_web_app__auth_description",shortDescription:e=>e("client:provider__bing_web_app__short_description"),authButtonText:"client:provider__bing_web_app__auth_button_text",authOpenInNew:!1},{beta:!1,label:"client:provider__bard_web_app__title",description:"",value:He.BARD,authDescription:"client:provider__bard_web_app__auth_description",shortDescription:e=>e("client:provider__bard_web_app__short_description"),authButtonText:"client:provider__bard_web_app__auth_button_text",authOpenInNew:!1},{beta:!1,label:"client:provider__claude_web_app__title",value:He.CLAUDE,description:"",authDescription:"client:provider__claude_web_app__auth_description",shortDescription:e=>e("client:provider__claude_web_app__short_description"),authButtonText:"client:provider__claude_web_app__auth_button_text",authOpenInNew:!0},{beta:!1,label:"client:provider__chatgpt_web_app__title",description:"",value:He.OPENAI,authDescription:"client:provider__chatgpt_web_app__auth_description",shortDescription:e=>e("client:provider__chatgpt_web_app__short_description"),authButtonText:"client:provider__chatgpt_web_app__auth_button_text",authOpenInNew:!0},{beta:!1,label:"client:provider__openai_api__title",description:"",value:He.OPENAI_API,authDescription:"client:provider__openai_api__auth_description",shortDescription:e=>Oi.default.createElement("span",null,e("client:provider__openai_api__short_description1")," ",Oi.default.createElement(qe,{target:"_blank",href:"https://platform.openai.com/playground?mode=chat",rel:"noreferrer noopener nofollow",sx:{color:"inherit",display:"inline-flex",textDecorationColor:t=>t.palette.mode==="dark"?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.4)","&:hover":{textDecorationColor:t=>t.palette.mode==="dark"?"rgba(255,255,255,0.6)":"rgba(0,0,0,0.6)"}}},e("client:provider__openai_api__short_description2")),e("client:provider__openai_api__short_description3")),authButtonText:"client:provider__openai_api__auth_button_text",authOpenInNew:!0},{beta:!1,label:"client:provider__claude__title",value:He.MAXAI_CLAUDE,description:"",authDescription:"client:provider__claude__auth_description",shortDescription:e=>e("client:provider__claude__short_description"),authButtonText:"client:provider__claude__auth_button_text",authOpenInNew:!1},{beta:!1,description:"",label:"client:provider__chatgpt__title",authDescription:"client:provider__chatgpt__auth_description",value:He.USE_CHAT_GPT_PLUS,shortDescription:e=>e("client:provider__chatgpt__short_description"),authButtonText:"client:provider__chatgpt__auth_button_text",authOpenInNew:!1}],Gn=vd;var at=C(z());var bd=e=>{let{aiProviderType:t,size:n=20,sx:r}=e;return at.default.createElement(at.default.Fragment,null,t==="USE_CHAT_GPT_PLUS"&&at.default.createElement(Ma,{sx:{...r,fontSize:n}}),t==="OPENAI_API"&&at.default.createElement(ka,{sx:{...r,fontSize:n,color:o=>o.palette.mode==="dark"?"#fff":"rgba(0,0,0,1)"}}),t==="OPENAI"&&at.default.createElement(Ra,{sx:{...r,fontSize:n}}),t==="BARD"&&at.default.createElement(Oa,{sx:{...r,fontSize:n}}),t==="BING"&&at.default.createElement(La,{sx:{...r,fontSize:n}}),t==="CLAUDE"&&at.default.createElement(Da,{sx:{...r,fontSize:n,color:o=>o.palette.mode==="dark"?"#fff":"rgba(0,0,0,1)"}}),t==="MAXAI_CLAUDE"&&at.default.createElement(Na,{sx:{...r,fontSize:n}}),t==="POE"&&at.default.createElement(Fa,{sx:{...r,fontSize:n}}))},xt=bd;var fe=C(z());var Je=C(z());var Td=e=>{let{aiProviderOption:t,children:n,sx:r,boxSx:o,authMode:i}=e,{t:s}=ve(["common","client"]),l={USE_CHAT_GPT_PLUS:"chatgpt",OPENAI:"chatgpt_web_app",OPENAI_API:"openai_api",BARD:"bard_web_app",BING:"bing_web_app",POE:"poe",CLAUDE:"claude_web_app",MAXAI_CLAUDE:"claude"};return Je.default.createElement(W,{alignItems:"center",justifyContent:"space-between",sx:{height:"100%",...r}},Je.default.createElement(W,{p:1,spacing:1,width:"100%",sx:{textAlign:"left"}},Je.default.createElement(W,{direction:"row",spacing:1},Je.default.createElement(xt,{aiProviderType:t.value,size:24}),Je.default.createElement($,{fontSize:"16px",fontWeight:600,color:"text.primary"},s(t.label))),i&&Je.default.createElement($,{fontSize:"14px",color:"text.secondary",fontWeight:400},s(t.authDescription)),Je.default.createElement($,{fontSize:"14px",color:"text.secondary",fontWeight:400},t.shortDescription(s)),Je.default.createElement(ye,{display:"flex"},Je.default.createElement(qe,{href:`${Xt}/get-started?provider=${l[t.value]}#ai-provider`,target:"_blank",underline:"always",sx:{display:"inline-flex",textDecorationColor:a=>a.palette.mode==="dark"?"rgba(255,255,255,0.4)":"rgba(0,0,0,0.4)","&:hover":{textDecorationColor:a=>a.palette.mode==="dark"?"rgba(255,255,255,0.6)":"rgba(0,0,0,0.6)"}}},Je.default.createElement($,{fontSize:"14px",color:"text.secondary",fontWeight:400,component:"span"},s("common:learn_more"))))),Je.default.createElement(W,{sx:{width:"100%",p:1,...o}},n))},ro=Td;var Di=C(Ni());var Il=new ie,Id=e=>{let{aiProviderOption:t}=e,{t:n}=ve(["common","client"]),r=Oe(Wt),[o,i]=(0,fe.useState)(!1);return(0,fe.useEffect)(()=>{let s=null;return(r.status==="loading"||r.status==="complete")&&(s=setTimeout(()=>{i(!0)},10*1e3)),()=>{s&&(i(!1),clearTimeout(s))}},[r.status]),fe.default.createElement(ro,{authMode:!0,aiProviderOption:t,boxSx:{p:0}},(r.status==="loading"||r.status==="complete")&&fe.default.createElement(W,null,t.value===He.OPENAI&&fe.default.createElement(jr,{placement:"bottom",arrow:!0,open:!0,PopperProps:{sx:{maxWidth:"237px",zIndex:"2147483632!important"}},title:o&&fe.default.createElement(ye,{sx:{cursor:"pointer",textAlign:"center","&:hover":{textDecoration:"underline"}},onClick:()=>{Il.postMessage({event:"Client_authChatGPTProvider",data:{provider:He.OPENAI}})}},fe.default.createElement($,{component:"span",textAlign:"center",fontSize:"14px",fontWeight:400},n("client:provider__chatgpt_web_app__waiting_tooltip1")),fe.default.createElement($,{component:"span",textAlign:"center",fontSize:"14px",fontWeight:400,sx:{textDecoration:"underline"}},n("client:provider__chatgpt_web_app__waiting_tooltip2")),fe.default.createElement(Di.default,{sx:{fontSize:14,position:"relative",top:3}}),fe.default.createElement($,{component:"span",textAlign:"center",fontSize:"14px",fontWeight:400},n("client:provider__chatgpt_web_app__waiting_tooltip3")))},fe.default.createElement(W,{justifyContent:"center",alignItems:"center",height:"100%",sx:{height:"40px"}},fe.default.createElement($,{fontSize:"18px",fontWeight:700},n("client:provider__chatgpt_web_app__connecting"))))),r.status==="needAuth"&&fe.default.createElement(W,{spacing:2},fe.default.createElement(Ga,{TooltipProps:{arrow:!0,placement:"bottom",PopperProps:{sx:{maxWidth:"237px",zIndex:"2147483632!important"}}},sx:{fontSize:"14px",fontWeight:400,width:"100%",px:"0",py:"6px",height:"40px"},title:t.value===He.OPENAI&&fe.default.createElement(ye,{sx:{display:"inline"}},fe.default.createElement($,{component:"span",fontSize:14,textAlign:"left"},n("client:provider__chatgpt_web_app__stable_mode_tooltip1")),fe.default.createElement(qe,{fontSize:14,color:"#fff",sx:{textDecorationColor:"#fff"},href:"#",onClick:async()=>{await zr({key:"options",query:"#/chatgpt-stable-mode"})}},n("client:provider__chatgpt_web_app__stable_mode_tooltip2")),fe.default.createElement($,{component:"span",fontSize:14,textAlign:"left"},n("client:provider__chatgpt_web_app__stable_mode_tooltip3"))),onClick:async()=>{await Il.postMessage({event:"Client_authChatGPTProvider",data:{provider:t.value}})},variant:"contained",disableElevation:!0,fullWidth:!0},n(t.authButtonText),t.authOpenInNew&&fe.default.createElement(Di.default,{sx:{fontSize:"16px",ml:"4px"}}))))},wl=Id;var rn=C(z());var le=C(z());Kt();var zt=C(z());var Bi=C(Ot()),Ml=C(Nt()),zn=C(Bn());var Pl=C(Yt()),_l=C(Qt());function Al(e){return(0,_l.default)("MuiMenuItem",e)}var wd=(0,Pl.unstable_generateUtilityClasses)("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),en=wd;var Fi=C(Me()),Pd=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],_d=(e,t)=>{let{ownerState:n}=e;return[t.root,n.dense&&t.dense,n.divider&&t.divider,!n.disableGutters&&t.gutters]},Ad=e=>{let{disabled:t,dense:n,divider:r,disableGutters:o,selected:i,classes:s}=e,a=(0,Ml.unstable_composeClasses)({root:["root",n&&"dense",t&&"disabled",!o&&"gutters",r&&"divider",i&&"selected"]},Al,s);return B({},s,a)},Md=pe(Aa,{shouldForwardProp:e=>Dr(e)||e==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:_d})(({theme:e,ownerState:t})=>B({},e.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!t.disableGutters&&{paddingLeft:16,paddingRight:16},t.divider&&{borderBottom:`1px solid ${(e.vars||e).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${en.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,zn.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity),[`&.${en.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:(0,zn.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)}},[`&.${en.selected}:hover`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:(0,zn.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:(0,zn.alpha)(e.palette.primary.main,e.palette.action.selectedOpacity)}},[`&.${en.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${en.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`& + .${Jr.root}`]:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},[`& + .${Jr.inset}`]:{marginLeft:52},[`& .${Ii.root}`]:{marginTop:0,marginBottom:0},[`& .${Ii.inset}`]:{paddingLeft:36},[`& .${Zr.root}`]:{minWidth:36}},!t.dense&&{[e.breakpoints.up("sm")]:{minHeight:"auto"}},t.dense&&B({minHeight:32,paddingTop:4,paddingBottom:4},e.typography.body2,{[`& .${Zr.root} svg`]:{fontSize:"1.25rem"}}))),Rd=zt.forwardRef(function(t,n){let r=We({props:t,name:"MuiMenuItem"}),{autoFocus:o=!1,component:i="li",dense:s=!1,divider:l=!1,disableGutters:a=!1,focusVisibleClassName:c,role:u="menuitem",tabIndex:p,className:f}=r,d=Ue(r,Pd),g=zt.useContext(Hn),m=zt.useMemo(()=>({dense:s||g.dense||!1,disableGutters:a}),[g.dense,s,a]),v=zt.useRef(null);Wa(()=>{o&&v.current&&v.current.focus()},[o]);let h=B({},r,{dense:m.dense,divider:l,disableGutters:a}),b=Ad(r),T=Pa(v,n),I;return r.disabled||(I=p!==void 0?p:-1),(0,Fi.jsx)(Hn.Provider,{value:m,children:(0,Fi.jsx)(Md,B({ref:T,role:u,tabIndex:I,component:i,focusVisibleClassName:(0,Bi.default)(b.focusVisible,c),className:(0,Bi.default)(b.root,f)},d,{ownerState:h,classes:b}))})}),Ct=Rd;var ge=C(z());var kl=C(Rl());var Vn=C(z());var Dd=({emptyText:e,sx:t})=>{let{t:n}=ve(["common"]);return Vn.default.createElement(W,{alignItems:"center",sx:{...t}},Vn.default.createElement(W,{width:"56px",height:"56px",justifyContent:"center",alignItems:"center",borderRadius:4,sx:{bgcolor:r=>r.palette.mode==="dark"?"rgba(255, 255, 255, .04)":"rgba(0, 0, 0, .04)"}},Vn.default.createElement(kl.default,{width:24,height:24})),Vn.default.createElement($,{variant:"body1"},e||n("common:no_options")))},Ll=Dd;var oe=C(z());var $n={};qp($n,{default:()=>so.default});var so=C(wa());pi($n,C(wa()));var St=C(z());var lv=e=>{let t=e;return t?.includes("524")&&(t="Network error: 524"),t?.includes("502")&&(t="Network error: 502"),t},qn=async(e,t)=>{try{let r=await new ie().postMessage({event:"Client_proxyFetchAPI",data:{url:e,options:t}});return{success:r.success,data:r.data,error:r.message}}catch(n){return{success:!1,data:null,error:n?.message||n}}},cv=async(e,t,n={})=>{try{let r=new ie,o=await Kr(),i=await Ut();n.body=JSON.stringify(t),n.headers||(n.headers={"Content-Type":"application/json",Authorization:`Bearer ${i}`,fp:`${o}`}),n.method||(n.method="POST"),un&&!e.startsWith(un)&&(e=un+e);let s=await r.postMessage({event:"Client_proxyFetchAPI",data:{url:e,options:n}});return{success:s.success,data:s.data,error:s.message}}catch(r){return{success:!1,data:null,error:r?.message||r}}};var Bd=e=>{let{youtubeLink:t,borderRadius:n=16,cover:r,sx:o}=e,[i,s]=(0,St.useState)(!1),[l,a]=(0,St.useState)(!1),c=(0,St.useMemo)(()=>r?i&&l:!0,[r,i,l]);return Lt(()=>{qn("https://www.youtube.com/t/terms",{parse:"text"}).then(u=>{u.success&&s(!0)}).catch(u=>{})}),St.default.createElement(ye,{className:"video-container",sx:{"&.video-container":{position:"relative",paddingBottom:"56.25%",height:0},"&.video-container iframe":{borderRadius:n+"px",position:"absolute",top:0,left:0,width:"100%",height:"100%"},"&.video-container img":{borderRadius:n+"px",position:"absolute",top:0,left:0,width:"100%",objectFit:"contain",height:"100%"},...o}},!c&&r&&St.default.createElement("img",{src:r,alt:"Youtube video cover"}),St.default.createElement("iframe",{title:"YouTube video player",width:"560",height:"315",src:t,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,onLoad:()=>{a(!0)},style:{visibility:c?"visible":"hidden",width:c?"100%":"0!important",height:c?"100%":"0!important"}}))},Ol=Bd;var Ze=C(z());Kt();var Gl=C(z()),zl=C(Ot());var vn=C(Bn()),Vl=C(Nt());var Nl=C(Yt()),Dl=C(Qt());function Bl(e){return(0,Dl.default)("MuiSkeleton",e)}var Fd=(0,Nl.unstable_generateUtilityClasses)("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]),Hd=Fd;var $l=C(Me()),Ud=["animation","className","component","height","style","variant","width"],ao=e=>e,Fl,Hl,Ul,Wl,Wd=e=>{let{classes:t,variant:n,animation:r,hasChildren:o,width:i,height:s}=e;return(0,Vl.unstable_composeClasses)({root:["root",n,r,o&&"withChildren",o&&!i&&"fitContent",o&&!s&&"heightAuto"]},Bl,t)},Gd=(0,vn.keyframes)(Fl||(Fl=ao`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),zd=(0,vn.keyframes)(Hl||(Hl=ao`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Vd=pe("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[n.variant],n.animation!==!1&&t[n.animation],n.hasChildren&&t.withChildren,n.hasChildren&&!n.width&&t.fitContent,n.hasChildren&&!n.height&&t.heightAuto]}})(({theme:e,ownerState:t})=>{let n=ea(e.shape.borderRadius)||"px",r=ta(e.shape.borderRadius);return B({display:"block",backgroundColor:e.vars?e.vars.palette.Skeleton.bg:(0,na.alpha)(e.palette.text.primary,e.palette.mode==="light"?.11:.13),height:"1.2em"},t.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${r}${n}/${Math.round(r/.6*10)/10}${n}`,"&:empty:before":{content:'"\\00a0"'}},t.variant==="circular"&&{borderRadius:"50%"},t.variant==="rounded"&&{borderRadius:(e.vars||e).shape.borderRadius},t.hasChildren&&{"& > *":{visibility:"hidden"}},t.hasChildren&&!t.width&&{maxWidth:"fit-content"},t.hasChildren&&!t.height&&{height:"auto"})},({ownerState:e})=>e.animation==="pulse"&&(0,vn.css)(Ul||(Ul=ao`
      animation: ${0} 1.5s ease-in-out 0.5s infinite;
    `),Gd),({ownerState:e,theme:t})=>e.animation==="wave"&&(0,vn.css)(Wl||(Wl=ao`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 1.6s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),zd,(t.vars||t).palette.action.hover)),$d=Gl.forwardRef(function(t,n){let r=We({props:t,name:"MuiSkeleton"}),{animation:o="pulse",className:i,component:s="span",height:l,style:a,variant:c="text",width:u}=r,p=Ue(r,Ud),f=B({},r,{animation:o,component:s,variant:c,hasChildren:!!p.children}),d=Wd(f);return(0,$l.jsx)(Vd,B({as:s,ref:n,className:(0,zl.default)(d.root,i),ownerState:f},p,{style:B({width:u,height:l},a)}))}),Hi=$d;function ft(e){for(let t of e){let n=document.querySelector(t);if(n)return n}}var Av=e=>{let{containerId:t,presetContainerElement:n,shadowRootId:r,presetShadowRootElement:o,webComponent:i=!0}=e,s="customElements"in window,l=document.createElement(s&&i?`webchatgpt-custom-element-${te()}`:"div");r&&(l.id=r),o&&o(l);let a=l.attachShadow({mode:"open"}),c=document.createElement("style");t&&(c.id=`${t}-emotion-style`);let u=document.createElement("div");return t&&(u.id=t),n&&n(l),a.appendChild(c),a.appendChild(u),{container:u,shadowRoot:l,emotionRoot:c}};function ql(e,t){t.parentNode.insertBefore(e,t.nextSibling)}var Ui={google:{ref:"google",verifier:()=>location.hostname.startsWith("www.google")&&location.pathname.startsWith("/search"),inputQueryFinder:()=>ft(["input[name='q']","textarea[type='search']"])?.value||"",sidebarContainerFinder:()=>{let e=document.querySelector("#rcnt");if(e){let t=e.querySelector("div#rhs[role=complementary]");if(t)return t;let n=e.querySelector("div#rhs");if(n)return n;let r=qd(),o=e.querySelector("#center_col");return o?ql(r,o):e.appendChild(r),r}},isDarkMode:()=>!!document.querySelector("meta[content=dark]")||!!document.querySelector("*[data-darkmode=true]")},bing:{ref:"bing",verifier:()=>location.hostname.includes(".bing.")&&location.pathname.startsWith("/search"),sidebarContainerFinder:()=>document.querySelector("aside > ol#b_context"),inputQueryFinder:()=>{let e=ft(["#sp_requery a","input[name=q]","input.b_searchbox","textarea.b_searchbox"]);return e?.value||e?.textContent||""},customStyle:{margin:"0 -20px 20px"},isDarkMode:()=>!1},baidu:{ref:"baidu",verifier:()=>location.hostname.startsWith("www.baidu"),sidebarContainerFinder:()=>document.querySelector("div#content_right"),inputQueryFinder:()=>{let e=window.bds;return e?.comm?.query?e.comm.query:ft(["input[name=wd]"])?.value||""},watchRouteChange(e){let t=document.getElementById("wrapper_wrapper");new MutationObserver(function(r){for(let o of r)if(o.type==="childList"){for(let i of o.addedNodes)if("id"in i&&i.id==="container"){e();return}}}).observe(t,{childList:!0})},isDarkMode:()=>!1},duckduckgo:{ref:"duckduckgo",verifier:()=>location.hostname==="duckduckgo.com"&&location.pathname==="/",sidebarContainerFinder:()=>document.querySelector("section.js-react-sidebar[data-area=sidebar]"),inputQueryFinder:()=>{let e=ft(["div[data-testid=spelling-message] p a","input#search_form_input"]);return e?.value||e?.textContent||""},isDarkMode:()=>!!document.querySelector("html.dark-header")},yahoo:{ref:"yahoo",verifier:()=>location.hostname.includes("search.yahoo")&&location.pathname.startsWith("/search"),sidebarContainerFinder:()=>document.querySelector("div#results div#right"),inputQueryFinder:()=>ft(["input[name=p]"])?.value||"",isDarkMode:()=>!1},naver:{ref:"naver",verifier:()=>location.hostname.includes("search.naver")&&location.pathname.startsWith("/search"),sidebarContainerFinder:()=>document.querySelector("div#sub_pack"),inputQueryFinder:()=>{let e=ft(["div.dsc_area strong.source","input[name=query]"]);return e?.value||e?.textContent||""},customStyle:{margin:"0 30px 20px 16px"},isDarkMode:()=>!1},yandex:{ref:"yandex",verifier:()=>location.host.includes("yandex")&&location.pathname.startsWith("/search"),sidebarContainerFinder:()=>document.querySelector("div.main__content div#search-result-aside"),inputQueryFinder:()=>ft(["input.HeaderDesktopForm-Input[name=text]"])?.value||"",isDarkMode:()=>!!document.querySelector("meta[name=color-scheme][content=dark]")},sogou:{ref:"sogou",verifier:()=>location.host.includes("sogou")&&(location.pathname.startsWith("/web")||location.pathname.startsWith("/sogou")),sidebarContainerFinder:()=>document.querySelector("div#wrapper div#right"),inputQueryFinder:()=>ft(["input#upquery[name=query]"])?.value||"",isDarkMode:()=>!1},brave:{ref:"brave",verifier:()=>location.host.includes("search.brave")&&location.pathname.startsWith("/search"),sidebarContainerFinder:()=>document.querySelector("aside.sidebar"),inputQueryFinder:()=>{let e=ft(["div.altered-query-text a","input[id=searchbox]"]);return e?.value||e?.textContent||""},isDarkMode:()=>!!document.querySelector("img.theme--dark")}};function kv(){let e=null,t=Object.keys(Ui);for(let n=0;n<t.length;n++){let r=t[n],o=Ui[r].verifier;if(o()){e=r;break}}return{siteName:e,config:e?Ui[e]:null}}function qd(){let e=document.createElement("div");return e.setAttribute("role","complementary"),e.setAttribute("id","rhs"),e.setAttribute("data-by","webchatgpt"),new URLSearchParams(location.search).get("tbm")==="nws"&&(e.style.marginLeft="30px"),e}function jl(){return document.querySelector(`#${Va}`)?.shadowRoot?.querySelector(`#${$a}`)}function Bv(e){return e.endsWith("?")||e.endsWith("\uFF1F")||e.endsWith("\u061F")||e.endsWith("\u2E2E")}function Fv(e,t){switch(e){case"bing":case"yandex":{t.style.display="inline-flex",t.style.flexDirection="column";break}case"google":case"baidu":case"duckduckgo":case"yahoo":case"naver":case"sogou":case"brave":{t.style.display="flex",t.style.flexDirection="column";break}default:break}}var Hv=async(e,t,{onMessage:n,onError:r})=>new Promise(o=>{let i=e.messageId,s=Fr(async(a,c)=>{if(a==="Client_askChatGPTQuestionResponse"&&c.taskId===i)return c.error?r?.(c.error):c?.data?.text&&n?.(c.data),c.done?(o(!0),s(),{success:!0,message:"ok",data:{}}):{success:!0,message:"ok",data:{}}});new ie({runtime:"client"}).postMessage({event:"SWAI_askAIQuestion",data:{taskId:i,question:e,options:t}})});var jd=({src:e,alt:t,height:n})=>{let[r,o]=(0,Ze.useState)(null),[i,s]=(0,Ze.useState)(!0),l=(0,Ze.useRef)(te());return(0,Ze.useEffect)(()=>{let a=()=>{let f=new Image;f.src=e,f.onload=()=>{o(e),s(!1)}},c=new IntersectionObserver(f=>{f.forEach(d=>{d.isIntersecting&&(a(),c.unobserve(d.target))})}),u=`#lazy-image-${l.current}`,p=mn()?.querySelector(u)||Gr()?.querySelector(u)||jl()?.querySelector(u)||document.querySelector(u);return p&&c.observe(p),()=>{p&&c.unobserve(p)}},[e]),Ze.default.createElement(Ze.default.Fragment,null,i?Ze.default.createElement(Hi,{id:`lazy-image-${l.current}`,variant:"rectangular",height:n}):Ze.default.createElement("img",{src:r,alt:t,height:n}))},Yl=jd;var Kl=C(Qp()),Xl=C(Xp()),Ql=(e,t="MaxAI")=>Kl.default.encrypt(JSON.stringify(e),t).toString(),Jl=e=>(0,Xl.default)(e).toString();var ji=C(kr());var lo=C(kr());var Zl=()=>{let e=typeof window<"u"?window.location.href:"";return e?["onedrive.live.com/edit.aspx","icloud.com/mail","navigator-lxa.mail.com/mail"].find(t=>e.includes(t)):!1},Jv=()=>{let e=document.documentElement,t=typeof window<"u"?window.location.href:"";t&&Fr(async(n,r,o)=>{switch(n){case"Iframe_ListenGetPageContent":{let{taskId:i}=r,s="";return t.includes("word-edit.officeapps.live.com/we/wordeditorframe.aspx")&&(s=e.querySelector("#PageContentContainer")?.innerText||""),t.includes("icloud-sandbox.com/applications/mail2-message")&&(s=e.querySelector(".mail-message-defaults")?.innerText||""),t.includes("mail.com/mail/client/mailbody")&&(s=e?.ownerDocument?.body?.innerText||""),s=s.trim(),s?(await new ie().postMessage({event:"Iframe_sendPageContent",data:{taskId:i,pageContent:s}}),{success:!0,data:"",message:""}):{success:!1,data:"",message:"no page content"}}}})},ec=()=>new Promise(async e=>{let t=new ie,n=te();(await t.postMessage({event:"Client_getIframePageContent",data:{taskId:n}})).success||e("");let o=!1,i=s=>{if(s.id===Qs&&s.event==="Client_ListenGetIframePageContentResponse"&&s.data.taskId===n){if(o)return;o=!0,e(s.data.pageContent),lo.default.runtime.onMessage.removeListener(i)}};lo.default.runtime.onMessage.addListener(i),setTimeout(()=>{o||(o=!0,e(""),lo.default.runtime.onMessage.removeListener(i))},1e4)});var Yd=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,co=class{static async fetchTranscript(t){try{let n=this.retrieveVideoId(t);if(!n)return[];let r=await qn("https://www.youtube.com/watch?v="+n,{parse:"text"});if(!r.success)return[];let i=r.data.split('"captions":');if(i.length<2)return[];let s=JSON.parse(i[1].split(',"videoDetails')[0].replace(/\n/,"")).playerCaptionsTracklistRenderer.captionTracks,l=Array.from(s).map(p=>p.name.simpleText),a="English",u=Array.from(l).sort((p,f)=>p===a?-1:f===a||p.includes(a)?1:f.includes(a)?-1:0).map(p=>{let f=s.find(d=>d.name.simpleText===p).baseUrl;return{language:p,link:f}});for(let p=0;p<u.length;p++){let f=u[p],d=await qn(f.link,{parse:"text"});if(d.success){let g=d.data,m=this.parseXml(g);if(m.length)return m}}return[]}catch{return[]}}static async transcriptFormat(t,n=4096){let r=`${t.map(o=>`${o.start} ${o.text}
`).join("")}`;return await Ur(r,n)}static retrieveVideoId(t){if(t.length===11)return t;let n=t.match(Yd);return n&&n.length?n[1]:""}static parseXml(t){let o=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("text"),i=[];for(let s=0;s<o.length;s++){let l=o[s],a=l.getAttribute("start"),c=l.getAttribute("dur")||"",u=l.textContent;a&&u&&i.push({start:a,duration:c,text:u})}return i}};var pc=C(Jp());function Kd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function Vi(e,t){return Array(t+1).join(e)}function Xd(e){return e.replace(/^\n*/,"")}function Qd(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}var Jd=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function $i(e){return qi(e,Jd)}var rc=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function oc(e){return qi(e,rc)}function Zd(e){return sc(e,rc)}var ic=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function ef(e){return qi(e,ic)}function tf(e){return sc(e,ic)}function qi(e,t){return t.indexOf(e.nodeName)>=0}function sc(e,t){return e.getElementsByTagName&&t.some(function(n){return e.getElementsByTagName(n).length})}var Re={};Re.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}};Re.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+`
`}};Re.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var r=Number(t.nodeName.charAt(1));if(n.headingStyle==="setext"&&r<3){var o=Vi(r===1?"=":"-",e.length);return`

`+e+`
`+o+`

`}else return`

`+Vi("#",r)+" "+e+`

`}};Re.blockquote={filter:"blockquote",replacement:function(e){return e=e.replace(/^\n+|\n+$/g,""),e=e.replace(/^/gm,"> "),`

`+e+`

`}};Re.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return n.nodeName==="LI"&&n.lastElementChild===t?`
`+e:`

`+e+`

`}};Re.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var r=n.bulletListMarker+"   ",o=t.parentNode;if(o.nodeName==="OL"){var i=o.getAttribute("start"),s=Array.prototype.indexOf.call(o.children,t);r=(i?Number(i)+s:s+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?`
`:"")}};Re.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};Re.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){for(var r=t.firstChild.getAttribute("class")||"",o=(r.match(/language-(\S+)/)||[null,""])[1],i=t.firstChild.textContent,s=n.fence.charAt(0),l=3,a=new RegExp("^"+s+"{3,}","gm"),c;c=a.exec(i);)c[0].length>=l&&(l=c[0].length+1);var u=Vi(s,l);return`

`+u+o+`
`+i.replace(/\n$/,"")+`
`+u+`

`}};Re.horizontalRule={filter:"hr",replacement:function(e,t,n){return`

`+n.hr+`

`}};Re.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href"),r=uo(t.getAttribute("title"));return r&&(r=' "'+r+'"'),"["+e+"]("+n+r+")"}};Re.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,n){var r=t.getAttribute("href"),o=uo(t.getAttribute("title"));o&&(o=' "'+o+'"');var i,s;switch(n.linkReferenceStyle){case"collapsed":i="["+e+"][]",s="["+e+"]: "+r+o;break;case"shortcut":i="["+e+"]",s="["+e+"]: "+r+o;break;default:var l=this.references.length+1;i="["+e+"]["+l+"]",s="["+l+"]: "+r+o}return this.references.push(s),i},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};Re.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}};Re.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}};Re.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];r.indexOf(n)!==-1;)n=n+"`";return n+t+e+t+n}};Re.image={filter:"img",replacement:function(e,t){var n=uo(t.getAttribute("alt")),r=t.getAttribute("src")||"",o=uo(t.getAttribute("title")),i=o?' "'+o+'"':"";return r?"!["+n+"]("+r+i+")":""}};function uo(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function ac(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}ac.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=Wi(this.array,e,this.options))||(t=Wi(this._keep,e,this.options))||(t=Wi(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function Wi(e,t,n){for(var r=0;r<e.length;r++){var o=e[r];if(nf(o,t,n))return o}}function nf(e,t,n){var r=e.filter;if(typeof r=="string"){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(e,t,n))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function rf(e){var t=e.element,n=e.isBlock,r=e.isVoid,o=e.isPre||function(p){return p.nodeName==="PRE"};if(!(!t.firstChild||o(t))){for(var i=null,s=!1,l=null,a=tc(l,t,o);a!==t;){if(a.nodeType===3||a.nodeType===4){var c=a.data.replace(/[ \r\n\t]+/g," ");if((!i||/ $/.test(i.data))&&!s&&c[0]===" "&&(c=c.substr(1)),!c){a=Gi(a);continue}a.data=c,i=a}else if(a.nodeType===1)n(a)||a.nodeName==="BR"?(i&&(i.data=i.data.replace(/ $/,"")),i=null,s=!1):r(a)||o(a)?(i=null,s=!0):i&&(s=!1);else{a=Gi(a);continue}var u=tc(l,a,o);l=a,a=u}i&&(i.data=i.data.replace(/ $/,""),i.data||Gi(i))}}function Gi(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function tc(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var lc=typeof window<"u"?window:{};function of(){var e=lc.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch{}return t}function sf(){var e=function(){};return af()?e.prototype.parseFromString=function(t){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(t),n.close(),n}:e.prototype.parseFromString=function(t){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(t),n.close(),n},e}function af(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch{window.ActiveXObject&&(e=!0)}return e}var lf=of()?lc.DOMParser:sf();function cf(e,t){var n;if(typeof e=="string"){var r=uf().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");n=r.getElementById("turndown-root")}else n=e.cloneNode(!0);return rf({element:n,isBlock:$i,isVoid:oc,isPre:t.preformattedCode?pf:null}),n}var zi;function uf(){return zi=zi||new lf,zi}function pf(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function df(e,t){return e.isBlock=$i(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=ff(e),e.flankingWhitespace=mf(e,t),e}function ff(e){return!oc(e)&&!ef(e)&&/^\s*$/i.test(e.textContent)&&!Zd(e)&&!tf(e)}function mf(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=gf(e.textContent);return n.leadingAscii&&nc("left",e,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&nc("right",e,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}}function gf(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function nc(e,t,n){var r,o,i;return e==="left"?(r=t.previousSibling,o=/ $/):(r=t.nextSibling,o=/^ /),r&&(r.nodeType===3?i=o.test(r.nodeValue):n.preformattedCode&&r.nodeName==="CODE"?i=!1:r.nodeType===1&&!$i(r)&&(i=o.test(r.textContent))),i}var hf=Array.prototype.reduce,yf=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function po(e){if(!(this instanceof po))return new po(e);var t={rules:Re,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(n,r){return r.isBlock?`

`:""},keepReplacement:function(n,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(n,r){return r.isBlock?`

`+n+`

`:n}};this.options=Kd({},t,e),this.rules=new ac(this.options)}po.prototype={turndown:function(e){if(!Tf(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=cc.call(this,new cf(e,this.options));return vf.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return yf.reduce(function(t,n){return t.replace(n[0],n[1])},e)}};function cc(e){var t=this;return hf.call(e.childNodes,function(n,r){r=new df(r,t.options);var o="";return r.nodeType===3?o=r.isCode?r.nodeValue:t.escape(r.nodeValue):r.nodeType===1&&(o=bf.call(t,r)),uc(n,o)},"")}function vf(e){var t=this;return this.rules.forEach(function(n){typeof n.append=="function"&&(e=uc(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function bf(e){var t=this.rules.forNode(e),n=cc.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function uc(e,t){var n=Qd(e),r=Xd(t),o=Math.max(e.length-n.length,t.length-r.length),i=`

`.substring(0,o);return n+i+r}function Tf(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}var fo=po;var xf=async e=>{try{let t=document.cloneNode(!0);t&&e&&(t.body.innerHTML=e.innerHTML);let r=new pc.Readability(t).parse();if(!r||!r?.content)return document.body.innerText||"";let i=new fo().turndown(r?.content||"");return`# ${r?.title}

${i}
`}catch{return""}},jn=xf;var bn=e=>{if(!e)return"";let t=e.cloneNode(!0);Array.from(t.querySelectorAll("br")).forEach(o=>{o.replaceWith(`

`)});let n=[];return de()==="mail.google.com"&&(n.push(...Array.from(t.querySelectorAll(".adL"))),n.push(...Array.from(t.querySelectorAll(".adm")).map(o=>o.parentElement)),n.push(...Array.from(t.querySelectorAll(".gmail_quote"))),n.push(...Array.from(t.querySelectorAll(".iX")))),t.querySelectorAll("div[id]").forEach(o=>{if(o.id.includes("mail-quote")){n.push(o);return}if(o.id.includes("RplyFwdMsg")){n.push(o.nextElementSibling),n.push(o);return}}),t.querySelectorAll("div[class]").forEach(o=>{if(o.className.includes("gmail_quote")){n.push(o);return}}),t.querySelectorAll("blockquote").forEach(o=>{n.push(o)}),n.forEach(o=>{try{o.remove()}catch{}}),t.innerText};var Cf=[{website:"mail.google.com",traffic:4.57},{website:"mail.yahoo.com",traffic:1.79},{website:"outlook.live.com",traffic:1.63},{website:"outlook.office.com",traffic:1.63},{website:"outlook.office365.com",traffic:1.63},{website:"navigator-lxa.mail.com",traffic:1.51},{website:"mail.proton.me",traffic:.54},{website:"icloud.com",traffic:.51},{website:"mail.zoho.com",traffic:.45},{website:"mail.qq.com",traffic:.37},{website:"wx.mail.qq.com",traffic:.36}],Sf=Cf.map(e=>e.website),dc=()=>{let e=de();return Sf.includes(e)?e==="icloud.com"?window.location.href.includes("icloud.com/mail"):e==="outlook.live.com"?window.location.href.includes("outlook.live.com/mail"):e==="outlook.office.com"?window.location.href.includes("outlook.office.com/mail"):e==="outlook.office365.com"?window.location.href.includes("outlook.office365.com"):!0:!1},pb=async e=>{let t=document.querySelector(e),n=de(),r="",o=document.documentElement;if(n==="mail.google.com"&&(document.querySelectorAll('table[role="presentation"]').forEach(i=>{i.contains(t)&&(o=i)}),r='div[role="textbox"]'),n==="outlook.office.com"||n==="outlook.live.com"||n==="outlook.office365.com"){let s=t.parentElement,l=null,a=0;for(;!l&&a<20;)s=s?.parentElement,l=s?.querySelector('div[role="textbox"][textprediction]')||s?.querySelector('div[id] > div[role="textbox"]')||null,a++;return l?bn(l):""}try{if(r){let i=o.querySelector(r);return bn(i)}return""}catch{return""}},Yn=class{constructor(){this.emails=[]}addSender(t){this.sender=t}addReceiver(t){this.receiver=t}addEmail(t,n){this.sender&&this.receiver&&(t===this.sender?.email?this.emails.push({from:this.sender,to:this.receiver,...n}):this.emails.push({from:this.receiver,to:this.sender,...n}))}sortEmails(){this.emails.sort((t,n)=>new Date(t.date).getTime()-new Date(n.date).getTime())}formatText(){return this.emails.map((t,n)=>`## Email #${n+1}
**From:** ${t.from.name}<${t.from.email}>
**To:** ${t.to.name}<${t.to.email}>
**Date:** ${t.date}
**Subject:** ${t.subject}

${t.content}

---
`).join(`
`).replace(/\n{2,}/g,`

`)}},Ef=e=>{if(document.createEvent){let t=document.createEvent("MouseEvents");t.initEvent("click",!0,!1),e.dispatchEvent(t)}else typeof e.onclick=="function"&&e.onclick()},db=async e=>{let t=c=>new Promise(u=>setTimeout(u,c)),n=de(),r=/[\w.-]+@[\w.-]+\.[A-Za-z]{2,}/g,o=!1,i="",s="body",l=e&&document.querySelector(e)||null;if(n==="mail.google.com"){let c=document.querySelector('div[role="list"]');if(c){let u=new Yn,p=c.querySelector('span[role="button"][aria-expanded][tabindex="-1"]');p&&(p.click(),await t(3e3));let f=[];Array.from(c.querySelectorAll('div[role="listitem"]')).find(g=>g.contains(l)?(f.push(g),!0):(f.push(g),!1));for(let g=0;g<f.length;g++)if(f[g].querySelectorAll("table span[email]").length>=2){let m=Array.from(f[g].querySelectorAll("table span[email]")),v="";document.querySelectorAll('a[aria-label][role="button"]').forEach(T=>{T?.getAttribute("aria-label")?.includes("@gmail.com")&&(v=T?.getAttribute("aria-label")?.match(r)?.[0]||"")});let h=m.find(T=>T.getAttribute("email")===v),b=m.find(T=>T.getAttribute("email")!==v);u.addSender({email:h?.getAttribute("email")||"",name:h?.getAttribute("name")||""}),u.addReceiver({email:b?.getAttribute("email")||"",name:b?.getAttribute("name")||""});break}let d=document.querySelector("h2[data-thread-perm-id]")?.textContent||document.title;return f.forEach(g=>{let m=g.querySelector("div[data-message-id]")||g.querySelector("div[data-legacy-message-id]"),v=g.querySelector('span[tabindex="-1"][alt]')?.textContent||"",h=g.querySelector("h3 span[email]")?.getAttribute("email")||g.querySelector("span[email]")?.getAttribute("email");if(h)if(m){let b=bn(g.querySelector("div[id][jslog] > div[id]"));u.addEmail(h,{content:b,date:v,subject:d})}else{let b=g.querySelector('div[role="gridcell"] span')?.textContent||"";u.addEmail(h,{content:b,date:v,subject:d})}}),u.formatText()}else s='div[role="list"]'}if(n==="outlook.office.com"||n==="outlook.live.com"||n==="outlook.office365.com")try{let c=document.querySelector('#ReadingPaneContainerId div[role="heading"][aria-level="2"]')?.textContent||document.title;document.querySelector('div[role="button"][aria-label="See more messages"]')?.click();let p=document.querySelector('div[data-app-section="ConversationContainer"]');if(p&&p.contains(l)){let h=new Yn,b=[],T=Array.from(p.querySelectorAll("& > div > div")),I=T.find(N=>N.contains(l))?.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";T.forEach(N=>{let k=N.querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"";new Date(k).getTime()<=new Date(I).getTime()&&b.push(N),N.querySelectorAll("& > div > div").forEach(y=>Ef(y))});let x=document.querySelector("#meInitialsButton");for(;!document.querySelector("#mectrl_currentAccount_primary");)x.click(),await t(2e3);let P=document.querySelector("#mectrl_currentAccount_primary")?.textContent||"",D=document.querySelector("#mectrl_currentAccount_secondary")?.textContent||"";for(let N=0;N<b.length;N++){let k=Array.from(b[N].querySelectorAll("span[data-lpc-hover-target-id]")),E=b[N].querySelector('div[data-testid="RecipientWell"]');if(!E||k.length===0)continue;let y=b[N].querySelector('div[data-testid="SentReceivedSavedTime"]')?.textContent||"",_=bn(b[N].querySelector("#UniqueMessageBody")||b[N].querySelector('div[role="document"]'));k.find(A=>{let w=A.textContent||"",R=w.match(r)?.[0];if(!R&&w===h.sender?.name?R=h.sender.email:!R&&w===h.receiver?.name&&(R=h.receiver.email),R){let H=!1;E?.contains(A)&&(H=!0);let V=w.replace(` <${R}>`,"");if(V&&R){if((!h.receiver||!h.sender)&&(H?(h.addReceiver({name:V,email:R}),h.addSender({name:P,email:D})):(h.addSender({name:V,email:R}),h.addReceiver({name:P,email:D}))),H){let M=h.sender?.email===R?h.receiver.email:h.sender.email;h.addEmail(M,{date:y,subject:c,content:_})}else h.addEmail(R,{date:y,subject:c,content:_});return!0}}return!1})}if(h.sortEmails(),h.emails.length>0)return h.formatText();s='div[data-app-section="ConversationContainer"]'}let f=h=>{let b=h,T=0;for(;!b.querySelector("#divRplyFwdMsg")&&!b.querySelector("#divRplyFwdMsg")&&T<10;)T++,b=b.parentElement;let I=b.cloneNode(!0),x=new Yn,P=I.querySelector("#divRplyFwdMsg")||I.querySelector("#RplyFwdMsg"),D=P?.nextElementSibling;if(P&&D){let N=Array.from(P.querySelector("font")?.childNodes||[]).filter(k=>!k.tagName);if(N.length===4){let k=N[0].textContent?.match(r)?.[0],E=N[0].textContent?.replace(` <${k}>`,""),y=N[2].textContent?.match(r)?.[0],_=N[2].textContent?.replace(` <${y}>`,""),A=N[1].textContent||"",w=N[3].textContent||"";if(k&&E&&y&&_&&A&&w){x.addSender({email:k,name:E}),x.addReceiver({email:y,name:_}),P.remove();let R=bn(D);return x.addEmail(k,{date:A,subject:w,content:R}),x.formatText()}}}return""},d=document.querySelector('div[role="dialog"] div[role="textbox"][textprediction]')||document.querySelector('div[role="dialog"] div[id] > div[role="textbox"]'),g=Array.from(document.querySelectorAll('div[role="dialog"]')).find(h=>h.contains(d));if(g&&g.contains(l)){let h=f(d);if(h)return h;s="#ReadingPaneContainerId"}let m=document.querySelector('#ReadingPaneContainerId div[id] > div[role="textbox"]');if(document.querySelector("#ReadingPaneContainerId")?.contains(l)){let h=f(m);if(h)return h;s="#ReadingPaneContainerId"}}catch{s='div[data-app-section="ConversationContainer"]'}n==="mail.yahoo.com"&&(s='div[data-test-id="message-group-view-scroller"]'),n==="wx.mail.qq.com"&&(s="div.container"),n==="mail.proton.me"&&(document.querySelectorAll("div.scroll-inner .message-header").forEach(c=>{o=!0,c.click()}),i="iframe[sandbox]",s="div#proton-root"),n==="mail.zoho.com"&&(document.querySelectorAll("div.zmPVContent .zmTMailList .zmMHdrSumContent").forEach(c=>{o=!0,c.click()}),s="div.zmPVContent"),o&&await t(3e3);let a=[document.documentElement];i&&(a=Array.from(document.querySelectorAll(i)));try{return(await Promise.all(a.map(async u=>{let p=u?.contentDocument||u?.ownerDocument||document;if(!p?.querySelector)return"";let f=p.querySelector(s);return f?f.innerText:await jn()}))).join("")}catch{return await jn()}};var If={PAGE_SUMMARY:{id:"f734efe5-c63e-490e-a0f1-ae5a248e0f16",parent:"root",droppable:!1,text:"Summarize page",data:{editable:!1,type:"shortcuts",actions:[{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:te(),text:"",originalMessage:{metadata:{sourceWebpage:{url:"{{CURRENT_WEBPAGE_URL}}",title:"{{CURRENT_WEBPAGE_TITLE}}"},shareType:"summary",title:{title:"Summarize page"},copilot:{title:{title:"Page insights",titleIcon:"LaptopMac"},steps:[{title:"Analyzing page",status:"loading",icon:"SmartToy"}]}},include_history:!1}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"GET_READABILITY_CONTENTS_OF_WEBPAGE",parameters:{}},{type:"SET_VARIABLE",parameters:{VariableName:"READABILITY_CONTENTS"}},{type:"ANALYZE_CHAT_FILE",parameters:{AnalyzeChatFileImmediateUpdateConversation:!1,AnalyzeChatFileName:"PageSummaryContent.txt"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Analyzing page",status:"complete",icon:"SmartToy",value:"{{CURRENT_WEBPAGE_TITLE}}"}]}},content:{title:{title:"Summary"},text:"",contentType:"text"},include_history:!1}}}},{type:"ASK_CHATGPT",parameters:{template:`Ignore all previous instructions. You are a highly proficient researcher that can read and write properly and fluently, and can extract all important information from any text. Your task is to summarize and extract all key takeaways of the context text delimited by triple backticks in all relevant aspects.

The context text is sourced from the main content of the webpage at {{CURRENT_WEBPAGE_URL}}.

Output a summary and a list of key takeaways respectively.
The summary should be a one-liner in at most 100 words.
The key takeaways should be in up to seven bulletpoints, the fewer the better.

---

Use the following format:
#### TL;DR
<summary of the text>

#### Key Takeaways
<list of key takeaways>

---

Respond in {{AI_RESPONSE_LANGUAGE}}.`,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}},{type:"SET_VARIABLE",parameters:{VariableName:"SUMMARY_CONTENTS"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{deepDive:{title:{title:"Deep dive",titleIcon:"TipsAndUpdates"},value:"Ask AI anything about the page..."}}}}}},{type:"CREATE_WEBSITE_CONTEXT",parameters:{CreateWebsiteContextConfig:{summary:"{{SUMMARY_CONTENTS}}",meta:{readability:"{{READABILITY_CONTENTS}}"}}}}],visibility:{isWhitelistMode:!1,whitelist:[],blacklist:[]}}},DEFAULT_EMAIL_SUMMARY:{id:"8ed1bf33-efc9-4714-8b21-09ceede3e2a8",parent:"root",droppable:!1,text:"Summarize email",data:{editable:!1,type:"shortcuts",actions:[{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:te(),text:"",originalMessage:{metadata:{sourceWebpage:{url:"{{CURRENT_WEBPAGE_URL}}",title:"{{CURRENT_WEBPAGE_TITLE}}"},shareType:"summary",title:{title:"Summarize email"},copilot:{title:{title:"Page insights",titleIcon:"LaptopMac"},steps:[{title:"Analyzing email",status:"loading",icon:"SmartToy"}]}},include_history:!1}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"GET_EMAIL_CONTENTS_OF_WEBPAGE",parameters:{}},{type:"SET_VARIABLE",parameters:{VariableName:"READABILITY_CONTENTS"}},{type:"ANALYZE_CHAT_FILE",parameters:{AnalyzeChatFileImmediateUpdateConversation:!1,AnalyzeChatFileName:"EmailSummaryContent.txt"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Analyzing email",status:"complete",icon:"SmartToy",value:"{{CURRENT_WEBPAGE_TITLE}}"}]}},content:{title:{title:"Summary"},text:"",contentType:"text"},include_history:!1}}}},{type:"ASK_CHATGPT",parameters:{template:`Ignore all previous instructions. You are a highly proficient researcher that can read and write properly and fluently, and can extract all important information from any text. Your task is to summarize and extract all key takeaways and action items of the context text delimited by triple backticks in all relevant aspects. 

The context text comprises email messages from an email thread you received or sent on {{CURRENT_WEBSITE_DOMAIN}}.

Output a summary, a list of key takeaways, and a list of action items respectively.
The summary should be a one-liner in at most 100 words. 
The key takeaways should be in up to seven bulletpoints, the fewer the better.
When extracting the action items, identify only the action items that need the reader to take action, and exclude action items requiring action from anyone other than the reader. Output the action items in bulletpoints, and pick a good matching emoji for every bullet point.

---

Use the following format:
#### TL;DR
<summary of the text>

#### Key Takeaways
<list of key takeaways>

#### Action Items
<list of action items>

---

Respond in {{AI_RESPONSE_LANGUAGE}}.`,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}},{type:"SET_VARIABLE",parameters:{VariableName:"SUMMARY_CONTENTS"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{deepDive:{title:{title:"Deep dive",titleIcon:"TipsAndUpdates"},value:"Ask AI anything about the email..."}}}}}},{type:"CREATE_WEBSITE_CONTEXT",parameters:{CreateWebsiteContextConfig:{summary:"{{SUMMARY_CONTENTS}}",meta:{readability:"{{READABILITY_CONTENTS}}"}}}}],visibility:{isWhitelistMode:!1,whitelist:[],blacklist:[]}}},PDF_CRX_SUMMARY:{id:"0c8c8bd7-1072-4fb7-9fad-cf6447b33896",parent:"root",droppable:!1,text:"Summarize PDF",data:{editable:!1,type:"shortcuts",actions:[{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:te(),text:"",originalMessage:{metadata:{sourceWebpage:{url:"{{CURRENT_WEBPAGE_URL}}",title:"{{CURRENT_WEBPAGE_TITLE}}"},shareType:"summary",title:{title:"Summarize PDF"},copilot:{title:{title:"Page insights",titleIcon:"LaptopMac"},steps:[{title:"Analyzing PDF",status:"loading",icon:"SmartToy"}]}},include_history:!1}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"GET_PDF_CONTENTS_OF_CRX",parameters:{}},{type:"SET_VARIABLE",parameters:{VariableName:"READABILITY_CONTENTS"}},{type:"ANALYZE_CHAT_FILE",parameters:{AnalyzeChatFileImmediateUpdateConversation:!1,AnalyzeChatFileName:"PDFSummaryContent.txt"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Analyzing PDF",status:"complete",icon:"SmartToy",value:"{{CURRENT_WEBPAGE_TITLE}}"}]}},content:{title:{title:"Summary"},text:"",contentType:"text"},include_history:!1}}}},{type:"ASK_CHATGPT",parameters:{template:`Ignore all previous instructions. You are a highly proficient researcher that can read and write properly and fluently, and can extract all important information from any text. Your task is to summarize and extract all key takeaways of the context text delimited by triple backticks in all relevant aspects. 

The context text originates from the main content of a PDF viewed on the browser at {{CURRENT_WEBPAGE_URL}}.

Output a summary and a list of key takeaways respectively.
The summary should be a one-liner in at most 100 words.
The key takeaways should be in up to seven bulletpoints, the fewer the better.

---

Use the following format:
#### TL;DR
<summary of the text>

#### Key Takeaways
<list of key takeaways>

---

Respond in {{AI_RESPONSE_LANGUAGE}}.`,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}},{type:"SET_VARIABLE",parameters:{VariableName:"SUMMARY_CONTENTS"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{deepDive:{title:{title:"Deep dive",titleIcon:"TipsAndUpdates"},value:"Ask AI anything about the PDF..."}}}}}},{type:"CREATE_WEBSITE_CONTEXT",parameters:{CreateWebsiteContextConfig:{summary:"{{SUMMARY_CONTENTS}}",meta:{readability:"{{READABILITY_CONTENTS}}"}}}}],visibility:{isWhitelistMode:!1,whitelist:[],blacklist:[]}}},YOUTUBE_VIDEO_SUMMARY:{id:"215bf574-3a68-4ac8-8fff-ccdd19150cb9",parent:"root",droppable:!1,text:"Summarize video",data:{editable:!1,type:"shortcuts",actions:[{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"add",ActionChatMessageConfig:{type:"ai",messageId:te(),text:"",originalMessage:{metadata:{sourceWebpage:{url:"{{CURRENT_WEBPAGE_URL}}",title:"{{CURRENT_WEBPAGE_TITLE}}"},shareType:"summary",title:{title:"Summarize video"},copilot:{title:{title:"Page insights",titleIcon:"LaptopMac"},steps:[{title:"Analyzing video",status:"loading",icon:"SmartToy"}]}},include_history:!1}}}},{type:"SET_VARIABLE",parameters:{VariableName:"AI_RESPONSE_MESSAGE_ID"}},{type:"GET_YOUTUBE_TRANSCRIPT_OF_URL",parameters:{}},{type:"SET_VARIABLE",parameters:{VariableName:"YOUTUBE_TRANSCRIPT"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{copilot:{steps:[{title:"Analyzing video",status:"complete",icon:"SmartToy",value:"{{CURRENT_WEBPAGE_TITLE}}"}]}},content:{title:{title:"Summary"},text:"",contentType:"text"},include_history:!1}}}},{type:"RENDER_TEMPLATE",parameters:{template:"{{YOUTUBE_TRANSCRIPT}}"}},{type:"ANALYZE_CHAT_FILE",parameters:{AnalyzeChatFileName:"YouTubeSummaryContent.txt",AnalyzeChatFileImmediateUpdateConversation:!1}},{type:"SET_VARIABLE",parameters:{VariableName:"READABILITY_CONTENTS"}},{type:"ASK_CHATGPT",parameters:{template:`Ignore all previous instructions. You are a highly proficient researcher that can read and write properly and fluently, and can extract all important information from any text. Your task is to summarize and extract all key takeaways of the context text delimited by triple backticks in all relevant aspects. 

The context text is the transcript of a video from {{CURRENT_WEBPAGE_URL}}.

Output a summary and a list of key takeaways respectively.
The summary should be a one-liner in at most 100 words.
The key takeaways should be in up to seven bulletpoints, the fewer the better.

---

Use the following format:
#### TL;DR
<summary of the text>

#### Key Takeaways
<list of key takeaways>

---

Respond in {{AI_RESPONSE_LANGUAGE}}.`,AskChatGPTInsertMessageId:"{{AI_RESPONSE_MESSAGE_ID}}",AskChatGPTActionType:"ASK_CHAT_GPT_HIDDEN"}},{type:"SET_VARIABLE",parameters:{VariableName:"SUMMARY_CONTENTS"}},{type:"CHAT_MESSAGE",parameters:{ActionChatMessageOperationType:"update",ActionChatMessageConfig:{type:"ai",messageId:"{{AI_RESPONSE_MESSAGE_ID}}",text:"",originalMessage:{metadata:{deepDive:{title:{title:"Deep dive",titleIcon:"TipsAndUpdates"},value:"Ask AI anything about the video..."}},include_history:!1}}}},{type:"CREATE_WEBSITE_CONTEXT",parameters:{CreateWebsiteContextConfig:{summary:"{{SUMMARY_CONTENTS}}",meta:{readability:"{{READABILITY_CONTENTS}}"}}}}],visibility:{isWhitelistMode:!1,whitelist:[],blacklist:[]}}}},Cb=e=>{let t=ue(If[e]),n="";return{actions:(t.data.actions||[]).map((o,i)=>(i===0&&(n=o.parameters.ActionChatMessageConfig?.messageId||""),o.type==="ASK_CHATGPT"&&(o.parameters.AskChatGPTActionMeta={contextMenu:ue(t)}),o)),messageId:n}},wf=()=>window.location.href,fc=()=>Jl(wf()),mo=()=>{if(de()==="youtube.com"&&co.retrieveVideoId(window.location.href))return"YOUTUBE_VIDEO_SUMMARY";let e=new URL(location.href),t=`${ji.default.runtime.id}/pages/pdf/web/viewer.html`;return e.href.includes(t)?"PDF_CRX_SUMMARY":dc()?"DEFAULT_EMAIL_SUMMARY":"PAGE_SUMMARY"},Sb=async()=>{let e="";return Zl()?e=await ec():Pf()&&(e=await _f()),e=e.trim(),e},Pf=()=>{let e=de();return["docs.google.com","cnbc.com"].find(t=>t===e)},_f=async()=>{let e=de();if(e==="docs.google.com")return new Promise(t=>{let n=te(),r=document.createElement("script");r.type="module",r.src=ji.default.runtime.getURL("pages/googleDoc/index.js"),r.setAttribute("data-event-id",n),r.id="MAXAI_GOOGLE_DOC_CONTENT_SCRIPT",document.body.appendChild(r);let o=!1;window.addEventListener(`${n}res`,i=>{o||(o=!0,t(i.detail))},{once:!0}),setTimeout(()=>{o||(o=!0,t(""))},1e4)});if(e==="cnbc.com"){let t=document.querySelector("#MainContentContainer");return t?jn(t):""}return""};var Tn=dn(async(e,t)=>{try{let n=t;if(t==="PAGE_SUMMARY")switch(mo()){case"PDF_CRX_SUMMARY":n+="(PDF)";break;case"PAGE_SUMMARY":n+="(DEFAULT)";break;case"YOUTUBE_VIDEO_SUMMARY":n+="(YOUTUBE)";break;case"DEFAULT_EMAIL_SUMMARY":n+="(EMAIL)";break;default:break}await new ie().postMessage({event:"Client_emitPricingHooks",data:{action:e,name:n}})}catch{}},1e3);var Kn=C(z());var Yi=()=>{let[e]=ae(Or),[t,n]=(0,Kn.useState)(!1),[r,o]=(0,Kn.useState)(!1),[i,s]=ae(to);return Lt(()=>{o(!0),Ut().then(l=>{l&&s(a=>({...a,isLogin:!0})),n(!0),o(!1)}).catch(()=>{n(!0),o(!1)})}),kt(()=>{Ut().then(l=>{s(l?a=>({...a,isLogin:!0}):a=>({...a,isLogin:!1}))})}),(0,Kn.useEffect)(()=>{e.open&&Ut().then(l=>{s(l?a=>({...a,isLogin:!0}):a=>({...a,isLogin:!1}))})},[e.open]),{isLogin:i.isLogin,loaded:t,loading:r}};var Ki=C(z());var Xi=e=>{let{t}=ve(["common","client"]);return(0,Ki.useMemo)(()=>{let n=wi(e);return{title:n.title(t),description:n.description(t),ctaButtonText:n.ctaButtonText(t),ctaButtonLink:n.ctaButtonLink,ctaButtonOnClick:n.ctaButtonOnClick,imageUrl:n.imageUrl,videoUrl:n.videoUrl,sceneType:e}},[e,t])},mc=()=>{let{t:e}=ve(["common","client"]);return(0,Ki.useMemo)(()=>{let t={};return qa.forEach(n=>{let r=wi(n),o={title:r.title(e),description:r.description(e),ctaButtonText:r.ctaButtonText(e),ctaButtonLink:r.ctaButtonLink,ctaButtonOnClick:r.ctaButtonOnClick,imageUrl:r.imageUrl,videoUrl:r.videoUrl,sceneType:n};t[n]=o}),t},[e])};var Af=e=>{let{sceneType:t,allowedRoles:n,onPermission:r,BoxProps:o,TooltipProps:i,children:s}=e,l=Xi(t),[a,c]=(0,oe.useState)(void 0),u=(0,oe.useMemo)(()=>a||l,[l,a]),{currentUserPlan:p}=Xn(),{isLogin:f}=Yi(),[d,g]=(0,oe.useState)(!1),m=(0,oe.useRef)(te());return(0,oe.useEffect)(()=>{let h=b=>{b.detail.id!==m.current&&g(b.detail.open)};return window.addEventListener("maxAIPermissionWrapperCustomEvent",h),()=>{window.removeEventListener("maxAIPermissionWrapperCustomEvent",h)}},[]),(0,oe.useMemo)(()=>!!(n.find(h=>h===p.name)||n.find(h=>h==="new_user")&&p?.isNewUser),[p,n])?oe.default.createElement(oe.default.Fragment,null,s):oe.default.createElement(jr,{arrow:!0,open:d,PopperProps:{sx:{"& > div":{maxWidth:316,p:1}},...i?.PopperProps},title:oe.default.createElement(so.default,{mouseEvent:"onMouseDown",onClickAway:()=>{g(!1)}},oe.default.createElement(W,{spacing:1,component:"div",width:300},u.videoUrl&&oe.default.createElement(Ol,{borderRadius:4,cover:u.imageUrl,youtubeLink:u.videoUrl}),!u.videoUrl&&u.imageUrl&&oe.default.createElement(ye,{sx:{width:"100%",height:"auto",borderRadius:"4px",overflow:"hidden","& img":{width:"100%",height:"auto"}}},oe.default.createElement(Yl,{height:140,src:u.imageUrl,alt:`${u.title} img`})),oe.default.createElement($,{fontSize:"14px",fontWeight:600,textAlign:"left",color:"rgba(255,255,255,.87)"},u.title),oe.default.createElement($,{fontSize:"12px",fontWeight:400,textAlign:"left",color:"rgba(255,255,255,.87)"},u.description),f?oe.default.createElement(oe.default.Fragment,null,u.ctaButtonText&&oe.default.createElement(qe,{target:"_blank",href:u.ctaButtonLink,onClick:h=>{h.preventDefault(),window.open(u.ctaButtonLink,"_blank"),u.ctaButtonOnClick?.(h),g(!1),Tn("click",l.sceneType)}},oe.default.createElement(Dt,{fullWidth:!0,variant:"contained"},u.ctaButtonText))):oe.default.createElement(Dt,{fullWidth:!0,variant:"contained",onClick:()=>{g(!1),Jt()}},"Please sign in to continue"))),...i},oe.default.createElement(ye,{...o},oe.default.createElement(ye,null,oe.default.Children.map(s,h=>{if(oe.default.isValidElement(h)){let b={...h.props,...h.props.onClick&&{onClick:async(T,...I)=>{let x=!1;if(T?.stopPropagation?.(),T?.preventDefault?.(),r){let{success:D,cardSettings:N}=await r(p,l,[T,...I]);c({...l,...N}),x=D}let P=new CustomEvent("maxAIPermissionWrapperCustomEvent",{detail:{id:m.current,open:!1}});window.dispatchEvent(P),g(!x),x?h.props?.onClick?.(T,...I):Tn("show",l.sceneType)}},...h.props.onChange&&{onChange:async(T,...I)=>{let x=!1;if(T?.stopPropagation?.(),T?.preventDefault?.(),r){let{success:D,cardSettings:N}=await r(p,l,[T,...I]);c({...l,...N}),x=D}let P=new CustomEvent("maxAIPermissionWrapperCustomEvent",{detail:{id:m.current,open:!1}});window.dispatchEvent(P),g(!x),x?h.props?.onChange?.(T,...I):Tn("show",l.sceneType)}}};return oe.default.cloneElement(h,b)}return h}))))},go=Af;var Qi=(e,t)=>{let n=0,r=e.find((o,i)=>o.value===t?(n=i,!0):!1);return[t,r,n]},Ji=({defaultValue:e,emptyText:t,options:n,renderLabel:r,labelProp:o,MenuProps:i,sx:s,placeholder:l,onChange:a,loading:c=!1,renderFooter:u,renderHeader:p,label:f,labelSx:d,onPermission:g,displayLoading:m=!0,...v})=>{let[h,b]=(0,ge.useState)(e||""),[T,I]=ge.default.useState(!1),x=()=>{I(!1)},P=()=>{I(!0)},D=(0,ge.useMemo)(()=>!ba(n)&&!c,[n,c]),N=(E,y,_)=>y?r?r(E,y||{},_):ge.default.createElement(za,{sx:{fontSize:"14px",color:"text.primary"}},ge.default.createElement($,{sx:{fontSize:"14px",color:"text.primary"},component:"span"},y.label)):null;(0,ge.useEffect)(()=>{!h&&e&&b(e)},[e]),(0,ge.useEffect)(()=>{n.length&&!c&&h&&(n.find(y=>y.value===h)||b(""))},[n,h,c]);let k=(0,ge.useMemo)(()=>n.map((E,y)=>E?.origin?.permission?ge.default.createElement(go,{key:y,sceneType:E.origin.permission.sceneType,allowedRoles:E.origin.permission.roles,onPermission:g},ge.default.createElement(Ct,{sx:{...o},selected:E.value===v.value,disabled:E.origin.disabled,value:E.value,onClick:_=>{E.origin.disabled&&(_.stopPropagation(),_.preventDefault()),b(E.value),a&&a(...Qi(n,E.value)),x()}},N(E.value,E,y))):ge.default.createElement(Ct,{sx:{...o},key:y,disabled:E?.origin?.disabled,value:E.value,onClick:_=>{E?.origin?.disabled&&(_.stopPropagation(),_.preventDefault())}},N(E.value,E,y))),[n,v.value,N]);return ge.default.createElement(Bt,null,f&&ge.default.createElement(Ft,{id:"demo-simple-select-label",sx:{fontSize:"14px",color:"text.primary",...d}},f),ge.default.createElement(Ht,{open:T,onClose:x,onOpen:P,label:f,sx:{width:220,lineHeight:"40px",padding:"8px 12px",height:40,fontSize:"14px","& > .use-chat-gpt-ai--MuiSelect-select":{padding:0,"& > div":{margin:0}},...s},value:h,onChange:(E,y)=>{y.props.disabled||(b(E.target.value),a&&a(...Qi(n,E.target.value)))},renderValue:E=>!E&&l||n.length===0?ge.default.createElement("em",null,l):N(...Qi(n,E)),MenuProps:i,displayEmpty:!0,...v},c&&m&&ge.default.createElement(Yr,{size:16,loading:c}),!D&&p,!D&&k,!D&&u,D&&ge.default.createElement(Ll,{emptyText:t})))};var ze=C(z());var Zi=C(z());var Mf=()=>{let[e,t]=ae(vt),n=e.sidebarSettings?.common?.currentAIProvider,r=(0,Zi.useMemo)(()=>{if(e.thirdProviderSettings&&n&&e.thirdProviderSettings[n])return e.thirdProviderSettings?.[n]},[n,e.thirdProviderSettings]);return{fetchThirdProviderSettings:async s=>{try{return await bt(s)}catch{return}},saveThirdProviderSettings:async(s,l)=>{await Fn(s,l)&&t(await Ae())},currentThirdProviderSettings:r}},gc=e=>{let[t,n]=ae(vt);return[(0,Zi.useMemo)(()=>t.thirdProviderSettings?.[e],[t.thirdProviderSettings,e]),async i=>{await Fn(e,i)&&n(await Ae())}]},ho=Mf;var Rf=()=>{let[e]=ae(vt),t=e.sidebarSettings?.common?.currentAIProvider,[n,r]=(0,ze.useState)(!1),{currentThirdProviderSettings:o,saveThirdProviderSettings:i}=ho(),[s,l]=(0,ze.useState)([]);(0,ze.useEffect)(()=>{t==="OPENAI"&&Ka().then(g=>{l(g)})},[t]);let a=(0,ze.useMemo)(()=>({OPENAI:(e.thirdProviderSettings?.OPENAI?.modelOptions||[]).map(g=>{let m;return g.slug==="gpt-4-code-interpreter"?m={accept:"",acceptTooltip:h=>h("client:provider__chatgpt_web_app__upload__accept_tooltip"),maxFileSize:-1,maxCount:1}:g.slug==="gpt-4"&&(m={accept:"image/webp,.webp,image/png,.png,image/gif,.gif,image/jpeg,.jpg,.jpeg",acceptTooltip:h=>h("client:provider__chatgpt_web_app__upload__accept_tooltip"),maxFileSize:-1,maxCount:1}),{title:g.title,value:g.slug,titleTag:g.tags?.find(h=>h.toLowerCase().includes("beta"))||g.tags?.find(h=>h.toLowerCase().includes("mobile"))||"",maxTokens:g.max_tokens,tags:g.tags||[],descriptions:[{label:h=>h("client:provider__model__tooltip_card__label__max_token"),value:h=>`${ma(g.max_tokens,0)} ${h("client:provider__model__tooltip_card__label__max_token__suffix")}`},{label:h=>h("client:provider__model__tooltip_card__label__description"),value:h=>{let b=g.description,T=`provider__chatgpt_web_app__${g.slug}__description`.replace(/-/g,"_"),I=`client:${T}`;return h(I)!==T?h(I):b}}],disabled:s.length>0?!s.includes(g.slug):!1,uploadFileConfig:m}}).reverse(),USE_CHAT_GPT_PLUS:Br(ue(Wr)),BARD:ha,BING:ga,OPENAI_API:Br(ue(xa)),CLAUDE:Ti,POE:Ca,MAXAI_CLAUDE:Br(ue(Sa))}),[s,e.thirdProviderSettings?.OPENAI?.modelOptions]),c=(0,ze.useMemo)(()=>{let g=[];return t&&(g=a[t]),g},[t,a]),u=(0,ze.useMemo)(()=>o?.model||"",[t,o]),p=(0,ze.useMemo)(()=>Gn.find(g=>g.value===t),[t]),f=(0,ze.useMemo)(()=>c.find(g=>g.value===u),[u,c]),d=(0,ze.useCallback)(async g=>{try{t&&c.find(m=>m.value===g)&&(r(!0),await i(t,{model:g}))}catch{}finally{r(!1)}},[t,c]);return(0,ze.useEffect)(()=>{t==="CLAUDE"&&o?.model==="a2"&&d(Ti[0].value)},[u,t]),{aiProvider:e.sidebarSettings?.common?.currentAIProvider,aiProviderModel:u,currentAIProviderDetail:p,currentAIProviderModelDetail:f,aiProviderModels:c,updateAIProviderModel:d,loading:n,AI_PROVIDER_MODEL_MAP:a}},yo=Rf;var vo=C(z()),hc=e=>{let t=(0,vo.useRef)();return(0,vo.useEffect)(()=>{t.current=e},[e]),t.current};var yc=C(z());var tn=async e=>{try{let n=await new ie().postMessage({event:"Client_getLiteConversation",data:{conversationId:e}});return n.success?n.data:void 0}catch{return}},nx=async e=>{try{return(await new ie({}).postMessage({event:"Client_removeChatGPTConversation",data:{conversationId:e,isForceRemove:!0}})).success}catch{return!1}};var rx=async()=>{try{let t=await new ie().postMessage({event:"Client_getAllPaginationConversation"});return t.success?t.data:[]}catch{return[]}},ox=async()=>{try{return(await new ie().postMessage({event:"Client_removeAllConversation"})).success}catch{return!1}},kf=()=>{let[,e]=ae(yn),{currentSidebarConversationId:t}=Ge();Hr(async(n,r,o)=>{switch(n){case"Client_listenUpdateConversationMessages":{let{conversation:i,conversationId:s}=r;return i?.id?e(l=>({...l,[i.id]:i})):s&&!i&&e(l=>{let a=ue(l);return delete a[s],a}),{success:!0}}break}}),(0,yc.useEffect)(()=>{t&&tn(t).then(async n=>{n&&e(r=>({...r,[n.id]:n}))})},[t])},ix=kf;var vc=async e=>{let t=await Ae(),n=t.sidebarSettings?.common?.currentAIProvider,r={AIProvider:n,AIModel:t.thirdProviderSettings?.[n]?.model||""};return e==="OPENAI_API"&&(r.systemPrompt=Ta),r};var Qn=new ie({runtime:"client"}),Vt=()=>{let[,e]=ae(Gt),t=dt(yn),{currentSidebarConversationType:n,currentSidebarConversationId:r,updateSidebarSettings:o}=Ge(),{AI_PROVIDER_MODEL_MAP:i,updateAIProviderModel:s}=yo();return{cleanConversation:async(f=!1)=>{if(n==="Chat"&&r){let d=await tn(r),g=d?.meta?.AIProvider,m=d?.meta?.AIModel;g&&m&&(f?await o({cache:{chatConversationCache:{[g+m]:r}}}):await o({cache:{chatConversationCache:{[g+m]:""}}}))}await Qn.postMessage({event:"Client_removeChatGPTConversation",data:{conversationId:r}}),n==="Chat"?await o({chat:{conversationId:""}}):n==="Summary"?await o({summary:{conversationId:""}}):n==="Search"&&await o({search:{conversationId:""}}),t(d=>{let g=ue(d);return delete g[r||""],g}),e({model:"",writingMessage:null,loading:!1})},createConversation:async f=>{let d="",g=f||n;if(g==="Chat"){let m=(await Ae()).sidebarSettings?.chat?.conversationId;if(m&&await tn(m))return m;let v=await Ae(),h=v.sidebarSettings?.common?.currentAIProvider,b=v.thirdProviderSettings?.[h]?.model||"",T=(i?.[h]||[]).find(P=>P?.value===b)?.maxTokens||4096,I=v.sidebarSettings?.cache?.chatConversationCache?.[h+b];if(I&&(d=I,d&&await tn(d)))return await o({chat:{conversationId:d}}),d;let x=await Qn.postMessage({event:"Client_createChatGPTConversation",data:{initConversationData:{type:"Chat",title:"Ask AI anything",meta:{maxTokens:T,...await vc(h)}}}});x.success&&(d=x.data.conversationId,await o({chat:{conversationId:d}}))}else if(g==="Summary"){if(d=fc(),d&&await tn(d))return d;let m={PAGE_SUMMARY:"Page summary & chat",DEFAULT_EMAIL_SUMMARY:"Email summary & chat",PDF_CRX_SUMMARY:"PDF summary & chat",YOUTUBE_VIDEO_SUMMARY:"Video summary & chat"},v=mo();await Qn.postMessage({event:"Client_createChatGPTConversation",data:{initConversationData:{id:d,type:"Summary",title:m[v],meta:vi({AIProvider:"USE_CHAT_GPT_PLUS",AIModel:"gpt-3.5-turbo",maxTokens:16384,pageSummaryType:v})}}}),await o({summary:{conversationId:d}})}else if(g==="Search"){let m=(await Ae()).sidebarSettings?.search?.conversationId;if(m&&await tn(m))return m;let v=await Qn.postMessage({event:"Client_createChatGPTConversation",data:{initConversationData:{type:"Search",title:"AI-powered search",meta:vi({AIProvider:"USE_CHAT_GPT_PLUS",AIModel:"gpt-3.5-turbo",maxTokens:16384})}}});v.success&&(d=v.data.conversationId,await o({search:{conversationId:d}}))}return d},changeConversation:async f=>f&&r!==f?(await new ie().postMessage({event:"Client_changeConversation",data:{conversationId:f}})).success:!0,updateConversation:async(f,d)=>{await bc(d||r||"",f)},switchBackgroundChatSystemAIProvider:async(f,d)=>{let g=await Qn.postMessage({event:"Client_switchAIProvider",data:{provider:f}});return g.success&&d&&await s(d),g.success}}};var Lf=()=>{let{t:e}=ve(["common","client"]),{aiProviderModel:t,aiProviderModels:n,loading:r,updateAIProviderModel:o,aiProvider:i}=yo(),s=hc(i),{cleanConversation:l,createConversation:a}=Vt(),{currentSidebarConversationType:c}=Ge(),u=(0,le.useMemo)(()=>xl(n,{labelKey:"title",valueKey:"value"}),[n]),p=(0,le.useCallback)(async d=>{await o(d),c==="Chat"&&(await l(!0),await new Promise(g=>setTimeout(g,0)),await a())},[c,a,l,o]),f=(0,le.useRef)(p);return(0,le.useEffect)(()=>{f.current=p},[p]),(0,le.useEffect)(()=>{if(t&&n.length>0){let d=n.every(m=>m.value!==t),g=n.find(m=>m.value===t)?.disabled;if(d||g){for(let m=n.length-1;m>=0;m--)if(!n[m].disabled){p(n[m].value).then().catch();break}}}},[n,t]),(0,le.useEffect)(()=>{Ae().then(d=>{if(s&&i&&s!==i){let g=d.thirdProviderSettings?.[i]?.model;g&&f.current(g)}})},[i]),le.default.createElement(Ji,{displayLoading:!1,MenuProps:{elevation:0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},MenuListProps:{sx:{border:"1px solid",borderColor:"customColor.borderColor"}}},onPermission:async()=>(i==="USE_CHAT_GPT_PLUS"&&await p(Wr[0].value),{success:!1}),sx:{width:"100%"},size:"small",loading:r,label:e("common:model"),labelSx:{fontSize:16},options:u,value:t,onChange:async d=>{await p(d)},labelProp:{p:0,pointerEvents:"auto!important"},renderValue:d=>{let g=u.find(m=>m.value===d);return le.default.createElement(W,{sx:{padding:"6px 0"},direction:"row",alignItems:"center",spacing:1},le.default.createElement($,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},e(g?.label||"client:provider__model__selector__placeholder")))},renderLabel:(d,g)=>{let m=g.origin;return le.default.createElement(hn,{placement:"left",PopperProps:{sx:{zIndex:2147483620}},componentsProps:{tooltip:{sx:{border:"1px solid rgb(224,224,224)",bgcolor:"background.paper",p:1}}},title:le.default.createElement(W,{spacing:1,width:"160px"},le.default.createElement(W,{textAlign:"left",width:"100%",spacing:2},m.disabled&&le.default.createElement($,{fontSize:"14px",color:"text.primary",textAlign:"left",fontWeight:700},e("client:provider__model__selector__disabled__description")),le.default.createElement($,{fontSize:"14px",color:"text.primary",textAlign:"left",fontWeight:"bold"},m?.title)),m.tags.length>0&&le.default.createElement(W,{direction:"row",flexWrap:"wrap",gap:"4px"},m.tags.map(v=>le.default.createElement(Pi,{sx:{fontSize:"12px",height:"18px",textTransform:"capitalize",flexShrink:0,"& > span":{px:"6px"}},key:v,label:v,color:"primary",size:"small",variant:"outlined"}))),m.descriptions.map((v,h)=>le.default.createElement(W,{spacing:.5,key:h},le.default.createElement($,{fontSize:"12px",color:"text.secondary",textAlign:"left"},v.label(e),":"),le.default.createElement($,{fontSize:"12px",color:"text.primary",textAlign:"left"},v.value(e)))))},le.default.createElement(W,{sx:{padding:"6px 16px"},width:"100%",direction:"row",alignItems:"center",spacing:1,onClick:v=>{m.disabled&&(v.stopPropagation(),v.preventDefault())}},le.default.createElement($,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},e(m.title||"client:provider__model__selector__placeholder")),m.titleTag&&le.default.createElement(Pi,{sx:{ml:1,textTransform:"capitalize",fontSize:"14px",flexShrink:0},label:m.titleTag,color:"primary",size:"small",variant:"outlined"})))}})},Tc=Lf;var lt=C(z());Kt();var Jn=C(z());var Co=C(Ot());var Ne=C(Nt()),Ac=C(jp()),nn=C(Bn());var xc=C(Nt()),Of=e=>!e||!(0,xc.isHostComponent)(e),Cc=Of;var xo=C(z());var To=C(Ot());var Sc=C(Yt()),Ec=C(Qt());function Ic(e){return(0,Ec.default)("MuiSlider",e)}var Nf=(0,Sc.unstable_generateUtilityClasses)("MuiSlider",["root","active","colorPrimary","colorSecondary","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),Ve=Nf;var bo=C(Me()),wc=C(Me()),Df=e=>{let{open:t}=e;return{offset:(0,To.default)(t&&Ve.valueLabelOpen),circle:Ve.valueLabelCircle,label:Ve.valueLabelLabel}};function es(e){let{children:t,className:n,value:r}=e,o=Df(e);return t?xo.cloneElement(t,{className:(0,To.default)(t.props.className)},(0,wc.jsxs)(xo.Fragment,{children:[t.props.children,(0,bo.jsx)("span",{className:(0,To.default)(o.offset,n),"aria-hidden":!0,children:(0,bo.jsx)("span",{className:o.circle,children:(0,bo.jsx)("span",{className:o.label,children:r})})})]})):null}var Et=C(Me()),ts=C(Me()),Bf=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"],Pc=(e,t,n)=>(e-t)*100/(n-t);function _c(e){return e}var Ff=pe("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`color${Qe(n.color)}`],n.size!=="medium"&&t[`size${Qe(n.size)}`],n.marked&&t.marked,n.orientation==="vertical"&&t.vertical,n.track==="inverted"&&t.trackInverted,n.track===!1&&t.trackFalse]}})(({theme:e,ownerState:t})=>B({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:(e.vars||e).palette[t.color].main,WebkitTapHighlightColor:"transparent"},t.orientation==="horizontal"&&B({height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}},t.size==="small"&&{height:2},t.marked&&{marginBottom:20}),t.orientation==="vertical"&&B({height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}},t.size==="small"&&{width:2},t.marked&&{marginRight:44}),{"@media print":{colorAdjust:"exact"},[`&.${Ve.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${Ve.dragging}`]:{[`& .${Ve.thumb}, & .${Ve.track}`]:{transition:"none"}}}));var Hf=pe("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})(({ownerState:e})=>B({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38},e.orientation==="horizontal"&&{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"},e.orientation==="vertical"&&{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"},e.track==="inverted"&&{opacity:1}));var Uf=pe("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e,ownerState:t})=>{let n=e.palette.mode==="light"?(0,nn.lighten)(e.palette[t.color].main,.62):(0,nn.darken)(e.palette[t.color].main,.5);return B({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest})},t.size==="small"&&{border:"none"},t.orientation==="horizontal"&&{height:"inherit",top:"50%",transform:"translateY(-50%)"},t.orientation==="vertical"&&{width:"inherit",left:"50%",transform:"translateX(-50%)"},t.track===!1&&{display:"none"},t.track==="inverted"&&{backgroundColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:n,borderColor:e.vars?e.vars.palette.Slider[`${t.color}Track`]:n})});var Wf=pe("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.thumb,t[`thumbColor${Qe(n.color)}`],n.size!=="medium"&&t[`thumbSize${Qe(n.size)}`]]}})(({theme:e,ownerState:t})=>B({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest})},t.size==="small"&&{width:12,height:12},t.orientation==="horizontal"&&{top:"50%",transform:"translate(-50%, -50%)"},t.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 50%)"},{"&:before":B({position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},t.size==="small"&&{boxShadow:"none"}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&:hover, &.${Ve.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,nn.alpha)(e.palette[t.color].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${Ve.active}`]:{boxShadow:`0px 0px 0px 14px ${e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.16)`:(0,nn.alpha)(e.palette[t.color].main,.16)}`},[`&.${Ve.disabled}`]:{"&:hover":{boxShadow:"none"}}}));var Gf=pe(es,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(({theme:e,ownerState:t})=>B({[`&.${Ve.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"},zIndex:1,whiteSpace:"nowrap"},e.typography.body2,{fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),transform:"translateY(-100%) scale(0)",position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem"},t.orientation==="horizontal"&&{top:"-10px",transformOrigin:"bottom center","&:before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"}},t.orientation==="vertical"&&{right:"30px",top:"24px",transformOrigin:"right center","&:before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",right:"-20%",top:"25%"}},t.size==="small"&&{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}));var zf=pe("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>fi(e)&&e!=="markActive",overridesResolver:(e,t)=>{let{markActive:n}=e;return[t.mark,n&&t.markActive]}})(({theme:e,ownerState:t,markActive:n})=>B({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},t.orientation==="horizontal"&&{top:"50%",transform:"translate(-1px, -50%)"},t.orientation==="vertical"&&{left:"50%",transform:"translate(-50%, 1px)"},n&&{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}));var Vf=pe("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>fi(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(({theme:e,ownerState:t,markLabelActive:n})=>B({},e.typography.body2,{color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap"},t.orientation==="horizontal"&&{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}},t.orientation==="vertical"&&{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}},n&&{color:(e.vars||e).palette.text.primary}));var $f=e=>{let{disabled:t,dragging:n,marked:r,orientation:o,track:i,classes:s,color:l,size:a}=e,c={root:["root",t&&"disabled",n&&"dragging",r&&"marked",o==="vertical"&&"vertical",i==="inverted"&&"trackInverted",i===!1&&"trackFalse",l&&`color${Qe(l)}`,a&&`size${Qe(a)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",a&&`thumbSize${Qe(a)}`,l&&`thumbColor${Qe(l)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return(0,Ne.unstable_composeClasses)(c,Ic,s)},qf=({children:e})=>e,jf=Jn.forwardRef(function(t,n){var r,o,i,s,l,a,c,u,p,f,d,g,m,v,h,b,T,I,x,P,D,N,k,E;let y=We({props:t,name:"MuiSlider"}),A=Nr().direction==="rtl",{"aria-label":w,"aria-valuetext":R,"aria-labelledby":H,component:V="span",components:M={},componentsProps:F={},color:L="primary",classes:U,className:Q,disableSwap:K=!1,disabled:J=!1,getAriaLabel:se,getAriaValueText:O,marks:ne=!1,max:Y=100,min:Z=0,orientation:Le="horizontal",size:G="medium",step:we=1,scale:Te=_c,slotProps:ee,slots:q,track:Pe="normal",valueLabelDisplay:_e="off",valueLabelFormat:rt=_c}=y,Dn=Ue(y,Bf),ce=B({},y,{isRtl:A,max:Y,min:Z,classes:U,disabled:J,disableSwap:K,orientation:Le,marks:ne,color:L,size:G,step:we,scale:Te,track:Pe,valueLabelDisplay:_e,valueLabelFormat:rt}),{axisProps:re,getRootProps:me,getHiddenInputProps:At,getThumbProps:Fe,open:Mt,active:Rt,axis:Ar,focusedThumbIndex:Jo,range:Ws,dragging:Op,marks:Zo,values:ot,trackOffset:Np,trackLeap:Dp}=(0,Ac.useSlider)(B({},ce,{ref:n}));ce.marked=Zo.length>0&&Zo.some(he=>he.label),ce.dragging=Op,ce.focusedThumbIndex=Jo;let it=$f(ce),ei=(r=(o=q?.root)!=null?o:M.Root)!=null?r:Ff,Gs=(i=(s=q?.rail)!=null?s:M.Rail)!=null?i:Hf,zs=(l=(a=q?.track)!=null?a:M.Track)!=null?l:Uf,Vs=(c=(u=q?.thumb)!=null?u:M.Thumb)!=null?c:Wf,$s=(p=(f=q?.valueLabel)!=null?f:M.ValueLabel)!=null?p:Gf,ti=(d=(g=q?.mark)!=null?g:M.Mark)!=null?d:zf,ni=(m=(v=q?.markLabel)!=null?v:M.MarkLabel)!=null?m:Vf,qs=(h=(b=q?.input)!=null?b:M.Input)!=null?h:"input",ri=(T=ee?.root)!=null?T:F.root,Bp=(I=ee?.rail)!=null?I:F.rail,oi=(x=ee?.track)!=null?x:F.track,ii=(P=ee?.thumb)!=null?P:F.thumb,si=(D=ee?.valueLabel)!=null?D:F.valueLabel,Fp=(N=ee?.mark)!=null?N:F.mark,Hp=(k=ee?.markLabel)!=null?k:F.markLabel,Up=(E=ee?.input)!=null?E:F.input,Wp=(0,Ne.useSlotProps)({elementType:ei,getSlotProps:me,externalSlotProps:ri,externalForwardedProps:Dn,additionalProps:B({},Cc(ei)&&{as:V}),ownerState:B({},ce,ri?.ownerState),className:[it.root,Q]}),Gp=(0,Ne.useSlotProps)({elementType:Gs,externalSlotProps:Bp,ownerState:ce,className:it.rail}),zp=(0,Ne.useSlotProps)({elementType:zs,externalSlotProps:oi,additionalProps:{style:B({},re[Ar].offset(Np),re[Ar].leap(Dp))},ownerState:B({},ce,oi?.ownerState),className:it.track}),ai=(0,Ne.useSlotProps)({elementType:Vs,getSlotProps:Fe,externalSlotProps:ii,ownerState:B({},ce,ii?.ownerState)}),Vp=(0,Ne.useSlotProps)({elementType:$s,externalSlotProps:si,ownerState:B({},ce,si?.ownerState),className:it.valueLabel}),li=(0,Ne.useSlotProps)({elementType:ti,externalSlotProps:Fp,ownerState:ce,className:it.mark}),ci=(0,Ne.useSlotProps)({elementType:ni,externalSlotProps:Hp,ownerState:ce}),$p=(0,Ne.useSlotProps)({elementType:qs,getSlotProps:At,externalSlotProps:Up,ownerState:ce});return(0,ts.jsxs)(ei,B({},Wp,{children:[(0,Et.jsx)(Gs,B({},Gp)),(0,Et.jsx)(zs,B({},zp)),Zo.filter(he=>he.value>=Z&&he.value<=Y).map((he,xe)=>{let ui=Pc(he.value,Z,Y),Mr=re[Ar].offset(ui),yt;return Pe===!1?yt=ot.indexOf(he.value)!==-1:yt=Pe==="normal"&&(Ws?he.value>=ot[0]&&he.value<=ot[ot.length-1]:he.value<=ot[0])||Pe==="inverted"&&(Ws?he.value<=ot[0]||he.value>=ot[ot.length-1]:he.value>=ot[0]),(0,ts.jsxs)(Jn.Fragment,{children:[(0,Et.jsx)(ti,B({"data-index":xe},li,!(0,Ne.isHostComponent)(ti)&&{markActive:yt},{style:B({},Mr,li.style),className:(0,Co.default)(li.className,yt&&it.markActive)})),he.label!=null?(0,Et.jsx)(ni,B({"aria-hidden":!0,"data-index":xe},ci,!(0,Ne.isHostComponent)(ni)&&{markLabelActive:yt},{style:B({},Mr,ci.style),className:(0,Co.default)(it.markLabel,ci.className,yt&&it.markLabelActive),children:he.label})):null]},xe)}),ot.map((he,xe)=>{let ui=Pc(he,Z,Y),Mr=re[Ar].offset(ui),yt=_e==="off"?qf:$s;return(0,Et.jsx)(Jn.Fragment,{children:(0,Et.jsx)(yt,B({},!(0,Ne.isHostComponent)(yt)&&{valueLabelFormat:rt,valueLabelDisplay:_e,value:typeof rt=="function"?rt(Te(he),xe):rt,index:xe,open:Mt===xe||Rt===xe||_e==="on",disabled:J},Vp,{children:(0,Et.jsx)(Vs,B({"data-index":xe,"data-focusvisible":Jo===xe},ai,{className:(0,Co.default)(it.thumb,ai.className,Rt===xe&&it.active,Jo===xe&&it.focusVisible),style:B({},Mr,{pointerEvents:K&&Rt!==xe?"none":void 0},ai.style),children:(0,Et.jsx)(qs,B({"data-index":xe,"aria-label":se?se(xe):w,"aria-valuenow":Te(he),"aria-labelledby":H,"aria-valuetext":O?O(Te(he),xe):R,value:ot[xe]},$p))}))}))},xe)})]}))}),ns=jf;var Yf=e=>{let{provider:t,authSceneType:n}=e,{t:r}=ve(["common","client"]),{saveThirdProviderSettings:o,currentThirdProviderSettings:i}=ho(),[s,l]=lt.default.useState(1),a=lt.default.useRef(!1);(0,lt.useEffect)(()=>{a.current||(a.current=!0,l(i.temperature))},[i.temperature]);let c=dn(async u=>{(await bt(t))?.temperature!==u&&await o(t,{temperature:u})},200);return(0,lt.useEffect)(()=>{c(s)},[s]),lt.default.createElement(Bt,{fullWidth:!0},lt.default.createElement(Ft,{id:"max-ai__ai-provider-temperature-select-label"},`${r("client:provider__temperature__label")}: ${i.temperature}`),lt.default.createElement(Ht,{sx:{"& > div":{p:"8px !important"},"& > svg":{display:"none"}},open:!1,id:"max-ai__ai-provider-temperature-select-label",value:s,label:`${r("client:provider__temperature__label")}: ${s}`,renderValue:u=>lt.default.createElement(go,{sceneType:n||"MAXAI_CHATGPT_TEMPERATURE",allowedRoles:n?["elite","pro","pro_gift","new_user"]:["free","elite","pro","pro_gift","new_user"],BoxProps:{sx:{"& > div":{display:"flex",flexDirection:"column",width:"100%"}}},onPermission:async p=>p.name==="free"?(l(1),{success:!1}):{success:!0}},lt.default.createElement(ns,{size:"small",marks:[{value:0,label:r("client:provider__temperature__precise__title")},{value:1,label:r("client:provider__temperature__balanced__title")},{value:2,label:r("client:provider__temperature__creative__title")}],min:0,max:2,step:.1,value:s,onChange:async(p,f)=>{l(f)},sx:{width:"100%",mx:"auto",mb:0,"& .use-chat-gpt-ai--MuiSlider-markLabel":{color:"text.primary",fontSize:"12px",fontWeight:"400"},"& > span[aria-hidden]":{top:"20px"},'& > span[aria-hidden][data-index="0"]':{left:"21px!important"},'& > span[aria-hidden][data-index="2"]':{left:"calc(100% - 22px) !important"}}}))}))},rs=Yf;var X=C(z());Kt();var er=C(z());var Hc=C(Ot());var Uc=C(Nt()),Wc=C(Bn());var yC=C(z());var Mc=C(Me()),Rc=gn((0,Mc.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");var TC=C(z());var kc=C(Me()),Lc=gn((0,kc.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox");var SC=C(z());var Oc=C(Me()),Nc=gn((0,Oc.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");var Dc=C(Yt()),Bc=C(Qt());function Fc(e){return(0,Bc.default)("MuiCheckbox",e)}var Kf=(0,Dc.unstable_generateUtilityClasses)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary"]),Zn=Kf;var tr=C(Me()),Xf=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],Qf=e=>{let{classes:t,indeterminate:n,color:r}=e,o={root:["root",n&&"indeterminate",`color${Qe(r)}`]},i=(0,Uc.unstable_composeClasses)(o,Fc,t);return B({},t,i)},Jf=pe(Xa,{shouldForwardProp:e=>Dr(e)||e==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,n.indeterminate&&t.indeterminate,n.color!=="default"&&t[`color${Qe(n.color)}`]]}})(({theme:e,ownerState:t})=>B({color:(e.vars||e).palette.text.secondary},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${t.color==="default"?e.vars.palette.action.activeChannel:e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,Wc.alpha)(t.color==="default"?e.palette.action.active:e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${Zn.checked}, &.${Zn.indeterminate}`]:{color:(e.vars||e).palette[t.color].main},[`&.${Zn.disabled}`]:{color:(e.vars||e).palette.action.disabled}})),Zf=(0,tr.jsx)(Lc,{}),em=(0,tr.jsx)(Rc,{}),tm=(0,tr.jsx)(Nc,{}),nm=er.forwardRef(function(t,n){var r,o;let i=We({props:t,name:"MuiCheckbox"}),{checkedIcon:s=Zf,color:l="primary",icon:a=em,indeterminate:c=!1,indeterminateIcon:u=tm,inputProps:p,size:f="medium",className:d}=i,g=Ue(i,Xf),m=c?u:a,v=c?u:s,h=B({},i,{color:l,indeterminate:c,size:f}),b=Qf(h);return(0,tr.jsx)(Jf,B({type:"checkbox",inputProps:B({"data-indeterminate":c},p),icon:er.cloneElement(m,{fontSize:(r=m.props.fontSize)!=null?r:f}),checkedIcon:er.cloneElement(v,{fontSize:(o=v.props.fontSize)!=null?o:f}),ownerState:h,ref:n,className:(0,Hc.default)(b.root,d)},g,{classes:b}))}),os=nm;var Gc=C(is()),zc=C(Ni());var am=()=>X.default.createElement(Gc.default,{sx:{color:"text.secondary",fontSize:"16px",position:"absolute",right:"8px",top:"calc(50% - 8px)"}}),Vc=()=>{let{currentSidebarConversationMessages:e}=Ge(),[t,n]=(0,X.useState)(!1),[r,o]=gc("OPENAI"),i=(0,X.useMemo)(()=>r?.plugins||[],[r]),s=(0,X.useMemo)(()=>r?.pluginOptions&&r?.model==="gpt-4-plugins"?fn(r.pluginOptions,"id").filter(a=>a.user_settings.is_installed):[],[r]);(0,X.useEffect)(()=>{if(r?.model==="gpt-4-plugins"){let a=i.filter(c=>s.find(u=>u.id===c));a.length!==i.length&&o({plugins:a})}},[s,i,r?.model]);let l=()=>{n(!0),setTimeout(()=>{n(!1)},1e3)};return X.default.createElement(X.default.Fragment,null,s.length>0?X.default.createElement(Bt,{size:"small",sx:{height:40,maxWidth:400},fullWidth:!0},X.default.createElement(Ft,{sx:{fontSize:"16px"},id:"ChatGPTPluginsSelectorLabel"},X.default.createElement("span",{style:{fontSize:"16px"}},i.length>0?"Plugins":"No plugins enabled")),X.default.createElement(Ht,{sx:{height:40,p:0},value:r?.plugins||[],multiple:!0,disabled:e.length>0,MenuProps:{anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},elevation:0,MenuListProps:{sx:{padding:0,width:320,maxHeight:"300px",overflowY:"auto","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{width:"6px",borderRadius:"3px",backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{borderRadius:"3px",backgroundColor:"rgba(0,0,0,0.2)"},position:"relative",border:"1px solid",borderColor:"customColor.borderColor"}}},onChange:async a=>{if(a.target.value.length>3){l();return}let c=a.target.value;await o({plugins:c})},renderValue:a=>X.default.createElement(W,{direction:"row",alignItems:"center",width:320,spacing:.5},a.length>0?a.map(c=>{let u=s.find(d=>d.id===c),p=u?.manifest?.name_for_human||u?.manifest?.name_for_model||u?.namespace,f=u?.manifest?.logo_url;return u&&f?X.default.createElement("img",{key:u.id,width:16,height:16,alt:p,src:f}):null}):X.default.createElement($,{textAlign:"left",noWrap:!0,fontSize:"14px",color:"text.primary"},"No plugins enabled")),IconComponent:am,labelId:"ChatGPTPluginsSelectorLabel",label:"Model"},X.default.createElement(ye,{component:"div",className:t?"error":"",sx:{display:"flex",alignItems:"center",p:1,bgcolor:"background.paper",position:"sticky",top:0,zIndex:1,justifyContent:"center",fontSize:"14px",color:"text.primary","&.error":{backgroundColor:"error.light",color:"error.dark"}}},i.length,"/3 Enabled"),s.map(a=>{let c=a.manifest?.name_for_human||a.manifest?.name_for_model||a.namespace,u=a.manifest?.description_for_human||a.manifest?.description_for_model||"";return X.default.createElement(Ct,{key:a.id,value:a.id,sx:{p:0}},X.default.createElement(hn,{placement:"left",componentsProps:{tooltip:{sx:{border:"1px solid rgb(245,245,245)",bgcolor:"background.paper",p:1}}},title:X.default.createElement(W,{width:"320px"},a.manifest?.logo_url&&X.default.createElement("img",{width:70,height:70,alt:c+" logo",src:a.manifest.logo_url,style:{flexShrink:0}}),X.default.createElement(W,{width:"100%",direction:"row",alignItems:"center",spacing:1,my:2},X.default.createElement($,{fontSize:"14px",color:"text.primary",textAlign:"left"},c)),X.default.createElement($,{fontSize:"12px",color:"text.secondary",textAlign:"left"},u))},X.default.createElement(W,{width:320,sx:{padding:"0 16px"},direction:"row",alignItems:"center",spacing:1},a.manifest?.logo_url&&X.default.createElement("img",{width:24,height:24,alt:c+" logo",src:a.manifest.logo_url,style:{flexShrink:0}}),X.default.createElement($,{flex:1,width:0,textAlign:"left",noWrap:!0,fontSize:"14px",color:"text.primary"},c),X.default.createElement(os,{sx:{flexShrink:0},checked:r?.plugins?.includes(a.id)}))))}),X.default.createElement(Ct,{value:"",onClick:a=>{a.preventDefault(),a.stopPropagation()},sx:{p:"0!important"}},X.default.createElement(W,{width:320,sx:{padding:"12px 30px 12px 16px"},direction:"row",alignItems:"center",spacing:1,onClick:async a=>{a.preventDefault(),a.stopPropagation(),await zr({key:"chatgpt"})}},X.default.createElement($,{flex:1,width:0,textAlign:"left",noWrap:!0,fontSize:"14px",color:"text.primary"},"Plugin store"),X.default.createElement(zc.default,{sx:{color:"text.primary",fontSize:"16px"}}))))):null)};var Se=C(z());var $c=C(is());var lm=()=>Se.default.createElement($c.default,{sx:{color:"text.secondary",fontSize:"16px",position:"absolute",right:"8px",top:"calc(50% - 8px)"}}),cm=()=>{let{t:e}=ve(["common","client"]),{cleanConversation:t}=Vt(),{loading:n}=Oe(Gt),[r,o]=(0,Se.useState)("balanced");return Lt(()=>{bt("BING").then(i=>{i?.conversationStyle&&o(i.conversationStyle)})}),kt(()=>{bt("BING").then(i=>{i?.conversationStyle&&o(i.conversationStyle)})}),Se.default.createElement(Bt,{size:"small",sx:{height:40}},Se.default.createElement(Ft,{sx:{fontSize:"16px"},id:"BingConversationStyleSelectorLabel"},Se.default.createElement("span",{style:{fontSize:"16px"}},e("client:provider__bing_web_app__conversation_style__title"))),Se.default.createElement(Ht,{disabled:n,MenuProps:{elevation:0,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},MenuListProps:{sx:{border:"1px solid",borderColor:"customColor.borderColor"}}},sx:{fontSize:"14px","& > fieldset":{"& > legend":{span:{width:110}}}},IconComponent:lm,labelId:"BingConversationStyleSelectorLabel",label:e("client:provider__bing_web_app__conversation_style__title"),value:r,onChange:async i=>{try{await Fn("BING",{conversationStyle:i.target.value}),await t(),o(i.target.value)}catch{}},renderValue:i=>{let s=bi.find(l=>l.value===i);return Se.default.createElement(W,{direction:"row",width:160,alignItems:"center",spacing:1},Se.default.createElement($,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},s?.label?e(s.label):"Select conversation style"))}},bi.map(i=>Se.default.createElement(Ct,{value:i.value,key:i?.value,sx:{p:0}},Se.default.createElement(hn,{placement:"left",componentsProps:{tooltip:{sx:{border:"1px solid rgb(245,245,245)",bgcolor:"background.paper",p:1}}},title:Se.default.createElement(W,{spacing:1,width:"160px"},Se.default.createElement(W,{direction:"row",width:"100%",alignItems:"center",spacing:1},Se.default.createElement($,{fontSize:"14px",color:"text.primary",textAlign:"left"},e(i.label))),Se.default.createElement($,{fontSize:"12px",color:"text.primary",textAlign:"left"},e(i.description)))},Se.default.createElement(W,{width:160,sx:{padding:"6px 16px"},direction:"row",alignItems:"center",spacing:1},Se.default.createElement($,{component:"span",fontSize:14,color:"text.primary",textAlign:"left",noWrap:!0},i?.label?e(i.label):"Select conversation style")))))))},qc=cm;var um=e=>{let{aiProviderOption:t}=e;return rn.default.createElement(ro,{aiProviderOption:t,boxSx:{gap:"8px","& > .use-chat-gpt-ai--MuiFormControl-root + .use-chat-gpt-ai--MuiFormControl-root":{mt:"8px"}}},t.value==="OPENAI_API"&&rn.default.createElement(rs,{provider:"OPENAI_API"}),t.value==="USE_CHAT_GPT_PLUS"&&rn.default.createElement(rs,{provider:"USE_CHAT_GPT_PLUS",authSceneType:"MAXAI_CHATGPT_TEMPERATURE"}),t.value==="OPENAI"&&rn.default.createElement(Vc,null),t.value==="BING"&&rn.default.createElement(qc,null),rn.default.createElement(Tc,null))},jc=um;var pm=e=>{let{sx:t,iconSize:n=20,closeAble:r,onClose:o}=e,{t:i}=ve(["common","client"]),{loading:s}=Oe(Gt),l=Oe(Wt),{currentSidebarAIProvider:a,updateSidebarSettings:c,currentSidebarConversationType:u}=Ge(),{cleanConversation:p,createConversation:f,switchBackgroundChatSystemAIProvider:d}=Vt(),g=(0,Ee.useMemo)(()=>s,[s]),m=(0,Ee.useMemo)(()=>Gn.find(v=>v.value===a),[a]);return Ee.default.createElement(ye,{id:r?"MaxAIProviderSelectorCard":"",component:"div",sx:{borderRadius:"4px",border:"1px solid #EBEBEB",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.16)",width:434,display:"flex",alignItems:"stretch",justifyContent:"center",flexDirection:"row",...t}},Ee.default.createElement(W,{sx:{p:1,width:248,flexShrink:0,borderRight:"1px solid #EBEBEB",alignItems:"stretch",boxSizing:"border-box"}},Ee.default.createElement(Yr,{loadingText:i(s?"client:floating_menu__input__running_placeholder":"common:loading"),loading:g,size:24,sx:{width:248}},m&&l.status!=="success"&&Ee.default.createElement(wl,{aiProviderOption:m}),m&&l.status==="success"&&Ee.default.createElement(jc,{aiProviderOption:m}))),Ee.default.createElement(W,{sx:{width:0,flex:1}},Ee.default.createElement(Ua,{component:"nav",sx:{py:0,pt:1}},Gn.map(v=>Ee.default.createElement(Si,{id:`max-ai__ai-provider-selector__${v.value}`,className:`max-ai__ai-provider-selector__item ${v.value===a?"selected":""}`,onClick:async()=>{a!==v.value&&(await c({common:{currentAIProvider:v.value}}),await d(v.value),u==="Chat"&&(await p(!0),await f("Chat")))},selected:v.value===a,disabled:g,key:v.value},Ee.default.createElement(W,{spacing:1,alignItems:"center",direction:"row"},Ee.default.createElement(xt,{aiProviderType:v.value,size:n}),Ee.default.createElement($,{component:"span",fontSize:"14px",fontWeight:400,color:"text.primary",textAlign:"left"},i(v.label))))),Ee.default.createElement(Si,{disabled:!r,onClick:o},Ee.default.createElement(W,{sx:{minHeight:"28px"},width:"100%",spacing:1,alignItems:"center",direction:"row",justifyContent:"end"},r&&Ee.default.createElement(Xr,{icon:"Close",sx:{fontSize:"24px"}}))))))},Yc=pm;var dm=()=>{let[e]=ae(to),t=dt(pn),[n,r]=ae(Wt),{status:o}=n,[i,s]=(0,Eo.useState)(o);return(0,Eo.useEffect)(()=>{i!==o&&o==="success"&&Ja().then(t),s(o)},[o]),kt(()=>{sa().then(l=>{l||r(a=>({...a,status:"needReload"}))})}),o==="needReload"?j.default.createElement(ye,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:2147483631,display:"flex",justifyContent:"center",alignItems:"center","& + *":{filter:"blur(5px)"}}},j.default.createElement(W,{spacing:2,width:"calc(100% - 16px)"},j.default.createElement($r,{sx:{maxWidth:"414px",mx:"auto!important",width:"100%",bgcolor:"background.paper"}},j.default.createElement(El,null)))):e.isLogin?o==="success"?null:j.default.createElement(ye,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:2147483631,display:"flex",justifyContent:"center","& + *":{filter:"blur(5px)"}}},j.default.createElement($r,{sx:{position:"absolute",right:8,bottom:125,bgcolor:"background.paper",display:"flex",flexDirection:"column"}},j.default.createElement(Yc,null))):j.default.createElement(ye,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",zIndex:2147483631,display:"flex",justifyContent:"center",alignItems:"center","& + *":{filter:"blur(5px)"}}},j.default.createElement(W,{width:"calc(100% - 16px)"},j.default.createElement(W,{spacing:1.5,p:3,pb:2,sx:{maxWidth:"414px",mx:"auto!important",borderRadius:"4px 4px 0 0",width:"100%",bgcolor:l=>l.palette.mode==="dark"?"#4f4f4f":"#F5F6F7"}},j.default.createElement(W,{direction:"row",alignItems:"center",justifyContent:"center",width:"100%",spacing:1},j.default.createElement(qr,{sx:{fontSize:"24px"}}),j.default.createElement($,{fontSize:"24px",fontWeight:700,color:"text.secondary",textAlign:"center"},"Use AI Anywhere Online")),j.default.createElement(W,{direction:"row",sx:{alignItems:"center",justifyContent:"center",gap:3}},j.default.createElement(W,{direction:"row",alignItems:"center",spacing:1},j.default.createElement(xt,{aiProviderType:"USE_CHAT_GPT_PLUS",size:20}),j.default.createElement($,{component:"span",fontSize:"16px",color:"text.secondary"},"ChatGPT")),j.default.createElement(W,{direction:"row",alignItems:"center",spacing:1},j.default.createElement(xt,{aiProviderType:"MAXAI_CLAUDE",size:20}),j.default.createElement($,{component:"span",fontSize:"16px",color:"text.secondary"},"Claude")),j.default.createElement(W,{direction:"row",alignItems:"center",spacing:1},j.default.createElement(xt,{aiProviderType:"BARD",size:20}),j.default.createElement($,{component:"span",fontSize:"16px",color:"text.secondary"},"Bard")),j.default.createElement(W,{direction:"row",alignItems:"center",spacing:1},j.default.createElement(xt,{aiProviderType:"BING",size:20}),j.default.createElement($,{component:"span",fontSize:"16px",color:"text.secondary"},"Bing")))),j.default.createElement($r,{sx:{maxWidth:"414px",mx:"auto!important",width:"100%",p:2,bgcolor:"background.paper",borderRadius:"0 0 4px 4px"}},j.default.createElement(W,{alignItems:"flex-start",height:"100%",spacing:2},j.default.createElement(W,{direction:"row",alignItems:"center",justifyContent:"center",width:"100%",spacing:1},j.default.createElement($,{fontSize:"24px",fontWeight:700,color:"text.primary",textAlign:"center"},"Please sign in to continue")),j.default.createElement(qe,{href:Xt+"/login?auto=true",target:"_blank",sx:{width:"100%"}},j.default.createElement(Dt,{fullWidth:!0,disableElevation:!0,variant:"contained",sx:{height:48,color:"#fff",border:"none",bgcolor:"#4285F4",fontSize:14,"&:hover":{bgcolor:"#366dc9"}}},j.default.createElement(W,{direction:"row",spacing:2,alignItems:"center"},j.default.createElement(W,{sx:{width:"32px",height:"32px",borderRadius:"50%",bgcolor:"#fff"},justifyContent:"center",alignItems:"center"},j.default.createElement(Ba,{sx:{fontSize:"24px"}})),j.default.createElement("span",null,"Continue with Google")))),j.default.createElement(ki,{sx:{width:"100%"}},"OR"),j.default.createElement(qe,{href:Xt+"/login-email",target:"_blank",sx:{width:"100%"}},j.default.createElement(Dt,{fullWidth:!0,disableElevation:!0,variant:"outlined",sx:{height:48,textIndent:"16px",fontSize:14}},j.default.createElement(W,{direction:"row",spacing:2,alignItems:"center",sx:{color:"primary.main"}},j.default.createElement(Xr,{icon:"Email",sx:{fontSize:"24px"}}),j.default.createElement("span",null,"Continue with Email"))))))))};var nu=C(z());Kt();var It=C(z()),Jc=C(Ot());var Zc=C(Nt());var eu=C(Yp());var Kc=C(Yt()),Xc=C(Qt());function Qc(e){return(0,Xc.default)("MuiCollapse",e)}var fm=(0,Kc.unstable_generateUtilityClasses)("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]),mm=fm;var nr=C(Me()),gm=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],hm=e=>{let{orientation:t,classes:n}=e,r={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return(0,Zc.unstable_composeClasses)(r,Qc,n)},ym=pe("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>B({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&B({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),vm=pe("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>B({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),bm=pe("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>B({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),tu=It.forwardRef(function(t,n){let r=We({props:t,name:"MuiCollapse"}),{addEndListener:o,children:i,className:s,collapsedSize:l="0px",component:a,easing:c,in:u,onEnter:p,onEntered:f,onEntering:d,onExit:g,onExited:m,onExiting:v,orientation:h="vertical",style:b,timeout:T=Zs.standard,TransitionComponent:I=_a}=r,x=Ue(r,gm),P=B({},r,{orientation:h,collapsedSize:l}),D=hm(P),N=Nr(),k=It.useRef(),E=It.useRef(null),y=It.useRef(),_=typeof l=="number"?`${l}px`:l,A=h==="horizontal",w=A?"width":"height";It.useEffect(()=>()=>{clearTimeout(k.current)},[]);let R=It.useRef(null),H=(0,eu.useForkRef)(n,R),V=O=>ne=>{if(O){let Y=R.current;ne===void 0?O(Y):O(Y,ne)}},M=()=>E.current?E.current[A?"clientWidth":"clientHeight"]:0,F=V((O,ne)=>{E.current&&A&&(E.current.style.position="absolute"),O.style[w]=_,p&&p(O,ne)}),L=V((O,ne)=>{let Y=M();E.current&&A&&(E.current.style.position="");let{duration:Z,easing:Le}=Ei({style:b,timeout:T,easing:c},{mode:"enter"});if(T==="auto"){let G=N.transitions.getAutoHeightDuration(Y);O.style.transitionDuration=`${G}ms`,y.current=G}else O.style.transitionDuration=typeof Z=="string"?Z:`${Z}ms`;O.style[w]=`${Y}px`,O.style.transitionTimingFunction=Le,d&&d(O,ne)}),U=V((O,ne)=>{O.style[w]="auto",f&&f(O,ne)}),Q=V(O=>{O.style[w]=`${M()}px`,g&&g(O)}),K=V(m),J=V(O=>{let ne=M(),{duration:Y,easing:Z}=Ei({style:b,timeout:T,easing:c},{mode:"exit"});if(T==="auto"){let Le=N.transitions.getAutoHeightDuration(ne);O.style.transitionDuration=`${Le}ms`,y.current=Le}else O.style.transitionDuration=typeof Y=="string"?Y:`${Y}ms`;O.style[w]=_,O.style.transitionTimingFunction=Z,v&&v(O)});return(0,nr.jsx)(I,B({in:u,onEnter:F,onEntered:U,onEntering:L,onExit:Q,onExited:K,onExiting:J,addEndListener:O=>{T==="auto"&&(k.current=setTimeout(O,y.current||0)),o&&o(R.current,O)},nodeRef:R,timeout:T==="auto"?null:T},x,{children:(O,ne)=>(0,nr.jsx)(ym,B({as:a,className:(0,Jc.default)(D.root,s,{entered:D.entered,exited:!u&&_==="0px"&&D.hidden}[O]),style:B({[A?"minWidth":"minHeight"]:_},b),ownerState:B({},P,{state:O}),ref:H},ne,{children:(0,nr.jsx)(vm,{ownerState:B({},P,{state:O}),className:D.wrapper,ref:E,children:(0,nr.jsx)(bm,{ownerState:B({},P,{state:O}),className:D.wrapperInner,children:i})})}))}))});tu.muiSupportAuto=!0;var Tm=tu;var Sr=C(z());var DE=Ce({key:"ContextMenuSettingsState",default:{closeBeforeRefresh:!1}}),ru=Ce({key:"RangyCoreState",default:{loaded:!1,rangy:null}}),Io=Ce({key:"RangyState",default:{show:!1,tempSelection:null,currentSelection:null}}),ou=Ce({key:"FloatingDropdownMenuState",default:{open:!1,rootRect:null}}),BE=Ce({key:"FloatingDropdownMenuLastFocusRangeState",default:{range:null,selectionText:null}}),FE=Ce({key:"FloatingDropdownMenuSystemItemsState",default:{selectContextMenuId:null,lastOutput:""}}),xm=Ce({key:"FloatingDropdownMenuSelectedItemState",default:{hoverContextMenuIdMap:{},selectedContextMenuId:null,lastHoverContextMenuId:null}}),HE=Ys({key:"FloatingDropdownMenuItemsSelector",get:({get:e})=>{let t=e(xm).hoverContextMenuIdMap;return Object.values(t).filter(n=>n)}}),UE=Ce({key:"FloatingContextMenuDraftState",default:{lastAIMessageId:""}});var xn=C(z());var ss=()=>{let[e,t]=ae(ru),[n,r]=ae(Io),o=(p=!1)=>{r(f=>(document.querySelector("#rangeBorderBox")?.remove(),{show:!1,tempSelection:null,currentSelection:p?null:f.currentSelection}))},i=p=>{t({loaded:!0,rangy:p})},s=()=>{r(p=>({...p,show:!0}))},l=p=>{r(f=>({...f,tempSelection:p}))},a=async p=>{p.selectionText=await Ur(p.selectionText||"",12e3),r(f=>({...f,currentSelection:p}))},c=(0,xn.useRef)(n.tempSelection);(0,xn.useEffect)(()=>{c.current=n.tempSelection},[n.tempSelection]);let u=(0,xn.useRef)(n.currentSelection);return(0,xn.useEffect)(()=>{u.current=n.currentSelection},[n.currentSelection]),{showRangy:s,hideRangy:o,rangy:e.rangy,initRangyCore:i,saveCurrentSelection:a,saveTempSelection:l,show:n.show,tempSelection:n.tempSelection,currentSelection:n.currentSelection,tempSelectionRef:c,currentSelectionRef:u}};var as=C(z());var xr=C(z());var S=C(z()),kn=C(z());var $t=Math.min,De=Math.max,or=Math.round,ir=Math.floor,wt=e=>({x:e,y:e}),Sm={left:"right",right:"left",bottom:"top",top:"bottom"},Em={start:"end",end:"start"};function ls(e,t,n){return De(e,$t(t,n))}function Cn(e,t){return typeof e=="function"?e(t):e}function Pt(e){return e.split("-")[0]}function Sn(e){return e.split("-")[1]}function cs(e){return e==="x"?"y":"x"}function us(e){return e==="y"?"height":"width"}function En(e){return["top","bottom"].includes(Pt(e))?"y":"x"}function ps(e){return cs(En(e))}function iu(e,t,n){n===void 0&&(n=!1);let r=Sn(e),o=ps(e),i=us(o),s=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[i]>t.floating[i]&&(s=rr(s)),[s,rr(s)]}function su(e){let t=rr(e);return[wo(e),t,wo(t)]}function wo(e){return e.replace(/start|end/g,t=>Em[t])}function Im(e,t,n){let r=["left","right"],o=["right","left"],i=["top","bottom"],s=["bottom","top"];switch(e){case"top":case"bottom":return n?t?o:r:t?r:o;case"left":case"right":return t?i:s;default:return[]}}function au(e,t,n,r){let o=Sn(e),i=Im(Pt(e),n==="start",r);return o&&(i=i.map(s=>s+"-"+o),t&&(i=i.concat(i.map(wo)))),i}function rr(e){return e.replace(/left|right|bottom|top/g,t=>Sm[t])}function wm(e){return{top:0,right:0,bottom:0,left:0,...e}}function lu(e){return typeof e!="number"?wm(e):{top:e,right:e,bottom:e,left:e}}function on(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function cu(e,t,n){let{reference:r,floating:o}=e,i=En(t),s=ps(t),l=us(s),a=Pt(t),c=i==="y",u=r.x+r.width/2-o.width/2,p=r.y+r.height/2-o.height/2,f=r[l]/2-o[l]/2,d;switch(a){case"top":d={x:u,y:r.y-o.height};break;case"bottom":d={x:u,y:r.y+r.height};break;case"right":d={x:r.x+r.width,y:p};break;case"left":d={x:r.x-o.width,y:p};break;default:d={x:r.x,y:r.y}}switch(Sn(t)){case"start":d[s]-=f*(n&&c?-1:1);break;case"end":d[s]+=f*(n&&c?-1:1);break}return d}var uu=async(e,t,n)=>{let{placement:r="bottom",strategy:o="absolute",middleware:i=[],platform:s}=n,l=i.filter(Boolean),a=await(s.isRTL==null?void 0:s.isRTL(t)),c=await s.getElementRects({reference:e,floating:t,strategy:o}),{x:u,y:p}=cu(c,r,a),f=r,d={},g=0;for(let m=0;m<l.length;m++){let{name:v,fn:h}=l[m],{x:b,y:T,data:I,reset:x}=await h({x:u,y:p,initialPlacement:r,placement:f,strategy:o,middlewareData:d,rects:c,platform:s,elements:{reference:e,floating:t}});if(u=b??u,p=T??p,d={...d,[v]:{...d[v],...I}},x&&g<=50){g++,typeof x=="object"&&(x.placement&&(f=x.placement),x.rects&&(c=x.rects===!0?await s.getElementRects({reference:e,floating:t,strategy:o}):x.rects),{x:u,y:p}=cu(c,f,a)),m=-1;continue}}return{x:u,y:p,placement:f,strategy:o,middlewareData:d}};async function sn(e,t){var n;t===void 0&&(t={});let{x:r,y:o,platform:i,rects:s,elements:l,strategy:a}=e,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:p="floating",altBoundary:f=!1,padding:d=0}=Cn(t,e),g=lu(d),v=l[f?p==="floating"?"reference":"floating":p],h=on(await i.getClippingRect({element:(n=await(i.isElement==null?void 0:i.isElement(v)))==null||n?v:v.contextElement||await(i.getDocumentElement==null?void 0:i.getDocumentElement(l.floating)),boundary:c,rootBoundary:u,strategy:a})),b=p==="floating"?{...s.floating,x:r,y:o}:s.reference,T=await(i.getOffsetParent==null?void 0:i.getOffsetParent(l.floating)),I=await(i.isElement==null?void 0:i.isElement(T))?await(i.getScale==null?void 0:i.getScale(T))||{x:1,y:1}:{x:1,y:1},x=on(i.convertOffsetParentRelativeRectToViewportRelativeRect?await i.convertOffsetParentRelativeRectToViewportRelativeRect({rect:b,offsetParent:T,strategy:a}):b);return{top:(h.top-x.top+g.top)/I.y,bottom:(x.bottom-h.bottom+g.bottom)/I.y,left:(h.left-x.left+g.left)/I.x,right:(x.right-h.right+g.right)/I.x}}var sr=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n,r;let{placement:o,middlewareData:i,rects:s,initialPlacement:l,platform:a,elements:c}=t,{mainAxis:u=!0,crossAxis:p=!0,fallbackPlacements:f,fallbackStrategy:d="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...v}=Cn(e,t);if((n=i.arrow)!=null&&n.alignmentOffset)return{};let h=Pt(o),b=Pt(l)===l,T=await(a.isRTL==null?void 0:a.isRTL(c.floating)),I=f||(b||!m?[rr(l)]:su(l));!f&&g!=="none"&&I.push(...au(l,m,g,T));let x=[l,...I],P=await sn(t,v),D=[],N=((r=i.flip)==null?void 0:r.overflows)||[];if(u&&D.push(P[h]),p){let _=iu(o,s,T);D.push(P[_[0]],P[_[1]])}if(N=[...N,{placement:o,overflows:D}],!D.every(_=>_<=0)){var k,E;let _=(((k=i.flip)==null?void 0:k.index)||0)+1,A=x[_];if(A)return{data:{index:_,overflows:N},reset:{placement:A}};let w=(E=N.filter(R=>R.overflows[0]<=0).sort((R,H)=>R.overflows[1]-H.overflows[1])[0])==null?void 0:E.placement;if(!w)switch(d){case"bestFit":{var y;let R=(y=N.map(H=>[H.placement,H.overflows.filter(V=>V>0).reduce((V,M)=>V+M,0)]).sort((H,V)=>H[1]-V[1])[0])==null?void 0:y[0];R&&(w=R);break}case"initialPlacement":w=l;break}if(o!==w)return{reset:{placement:w}}}return{}}}};async function Pm(e,t){let{placement:n,platform:r,elements:o}=e,i=await(r.isRTL==null?void 0:r.isRTL(o.floating)),s=Pt(n),l=Sn(n),a=En(n)==="y",c=["left","top"].includes(s)?-1:1,u=i&&a?-1:1,p=Cn(t,e),{mainAxis:f,crossAxis:d,alignmentAxis:g}=typeof p=="number"?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return l&&typeof g=="number"&&(d=l==="end"?g*-1:g),a?{x:d*u,y:f*c}:{x:f*c,y:d*u}}var In=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){let{x:n,y:r}=t,o=await Pm(t,e);return{x:n+o.x,y:r+o.y,data:o}}}},ar=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){let{x:n,y:r,placement:o}=t,{mainAxis:i=!0,crossAxis:s=!1,limiter:l={fn:v=>{let{x:h,y:b}=v;return{x:h,y:b}}},...a}=Cn(e,t),c={x:n,y:r},u=await sn(t,a),p=En(Pt(o)),f=cs(p),d=c[f],g=c[p];if(i){let v=f==="y"?"top":"left",h=f==="y"?"bottom":"right",b=d+u[v],T=d-u[h];d=ls(b,d,T)}if(s){let v=p==="y"?"top":"left",h=p==="y"?"bottom":"right",b=g+u[v],T=g-u[h];g=ls(b,g,T)}let m=l.fn({...t,[f]:d,[p]:g});return{...m,data:{x:m.x-n,y:m.y-r}}}}};var lr=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){let{placement:n,rects:r,platform:o,elements:i}=t,{apply:s=()=>{},...l}=Cn(e,t),a=await sn(t,l),c=Pt(n),u=Sn(n),p=En(n)==="y",{width:f,height:d}=r.floating,g,m;c==="top"||c==="bottom"?(g=c,m=u===(await(o.isRTL==null?void 0:o.isRTL(i.floating))?"start":"end")?"left":"right"):(m=c,g=u==="end"?"top":"bottom");let v=d-a[g],h=f-a[m],b=!t.middlewareData.shift,T=v,I=h;if(p){let P=f-a.left-a.right;I=u||b?$t(h,P):P}else{let P=d-a.top-a.bottom;T=u||b?$t(v,P):P}if(b&&!u){let P=De(a.left,0),D=De(a.right,0),N=De(a.top,0),k=De(a.bottom,0);p?I=f-2*(P!==0||D!==0?P+D:De(a.left,a.right)):T=d-2*(N!==0||k!==0?N+k:De(a.top,a.bottom))}await s({...t,availableWidth:I,availableHeight:T});let x=await o.getDimensions(i.floating);return f!==x.width||d!==x.height?{reset:{rects:!0}}:{}}}};function _t(e){return du(e)?(e.nodeName||"").toLowerCase():"#document"}function $e(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function mt(e){var t;return(t=(du(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function du(e){return e instanceof Node||e instanceof $e(e).Node}function gt(e){return e instanceof Element||e instanceof $e(e).Element}function ct(e){return e instanceof HTMLElement||e instanceof $e(e).HTMLElement}function pu(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof $e(e).ShadowRoot}function wn(e){let{overflow:t,overflowX:n,overflowY:r,display:o}=Ye(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(o)}function fu(e){return["table","td","th"].includes(_t(e))}function Po(e){let t=_o(),n=Ye(e);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function mu(e){let t=an(e);for(;ct(t)&&!cr(t);){if(Po(t))return t;t=an(t)}return null}function _o(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function cr(e){return["html","body","#document"].includes(_t(e))}function Ye(e){return $e(e).getComputedStyle(e)}function ur(e){return gt(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function an(e){if(_t(e)==="html")return e;let t=e.assignedSlot||e.parentNode||pu(e)&&e.host||mt(e);return pu(t)?t.host:t}function gu(e){let t=an(e);return cr(t)?e.ownerDocument?e.ownerDocument.body:e.body:ct(t)&&wn(t)?t:gu(t)}function je(e,t,n){var r;t===void 0&&(t=[]),n===void 0&&(n=!0);let o=gu(e),i=o===((r=e.ownerDocument)==null?void 0:r.body),s=$e(o);return i?t.concat(s,s.visualViewport||[],wn(o)?o:[],s.frameElement&&n?je(s.frameElement):[]):t.concat(o,je(o))}function Cu(e){let t=Ye(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,o=ct(e),i=o?e.offsetWidth:n,s=o?e.offsetHeight:r,l=or(n)!==i||or(r)!==s;return l&&(n=i,r=s),{width:n,height:r,$:l}}function ds(e){return gt(e)?e:e.contextElement}function Pn(e){let t=ds(e);if(!ct(t))return wt(1);let n=t.getBoundingClientRect(),{width:r,height:o,$:i}=Cu(t),s=(i?or(n.width):n.width)/r,l=(i?or(n.height):n.height)/o;return(!s||!Number.isFinite(s))&&(s=1),(!l||!Number.isFinite(l))&&(l=1),{x:s,y:l}}var Am=wt(0);function Su(e){let t=$e(e);return!_o()||!t.visualViewport?Am:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Mm(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==$e(e)?!1:t}function ln(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);let o=e.getBoundingClientRect(),i=ds(e),s=wt(1);t&&(r?gt(r)&&(s=Pn(r)):s=Pn(e));let l=Mm(i,n,r)?Su(i):wt(0),a=(o.left+l.x)/s.x,c=(o.top+l.y)/s.y,u=o.width/s.x,p=o.height/s.y;if(i){let f=$e(i),d=r&&gt(r)?$e(r):r,g=f.frameElement;for(;g&&r&&d!==f;){let m=Pn(g),v=g.getBoundingClientRect(),h=Ye(g),b=v.left+(g.clientLeft+parseFloat(h.paddingLeft))*m.x,T=v.top+(g.clientTop+parseFloat(h.paddingTop))*m.y;a*=m.x,c*=m.y,u*=m.x,p*=m.y,a+=b,c+=T,g=$e(g).frameElement}}return on({width:u,height:p,x:a,y:c})}function Rm(e){let{rect:t,offsetParent:n,strategy:r}=e,o=ct(n),i=mt(n);if(n===i)return t;let s={scrollLeft:0,scrollTop:0},l=wt(1),a=wt(0);if((o||!o&&r!=="fixed")&&((_t(n)!=="body"||wn(i))&&(s=ur(n)),ct(n))){let c=ln(n);l=Pn(n),a.x=c.x+n.clientLeft,a.y=c.y+n.clientTop}return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-s.scrollLeft*l.x+a.x,y:t.y*l.y-s.scrollTop*l.y+a.y}}function km(e){return Array.from(e.getClientRects())}function Eu(e){return ln(mt(e)).left+ur(e).scrollLeft}function Lm(e){let t=mt(e),n=ur(e),r=e.ownerDocument.body,o=De(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),i=De(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),s=-n.scrollLeft+Eu(e),l=-n.scrollTop;return Ye(r).direction==="rtl"&&(s+=De(t.clientWidth,r.clientWidth)-o),{width:o,height:i,x:s,y:l}}function Om(e,t){let n=$e(e),r=mt(e),o=n.visualViewport,i=r.clientWidth,s=r.clientHeight,l=0,a=0;if(o){i=o.width,s=o.height;let c=_o();(!c||c&&t==="fixed")&&(l=o.offsetLeft,a=o.offsetTop)}return{width:i,height:s,x:l,y:a}}function Nm(e,t){let n=ln(e,!0,t==="fixed"),r=n.top+e.clientTop,o=n.left+e.clientLeft,i=ct(e)?Pn(e):wt(1),s=e.clientWidth*i.x,l=e.clientHeight*i.y,a=o*i.x,c=r*i.y;return{width:s,height:l,x:a,y:c}}function hu(e,t,n){let r;if(t==="viewport")r=Om(e,n);else if(t==="document")r=Lm(mt(e));else if(gt(t))r=Nm(t,n);else{let o=Su(e);r={...t,x:t.x-o.x,y:t.y-o.y}}return on(r)}function Iu(e,t){let n=an(e);return n===t||!gt(n)||cr(n)?!1:Ye(n).position==="fixed"||Iu(n,t)}function Dm(e,t){let n=t.get(e);if(n)return n;let r=je(e,[],!1).filter(l=>gt(l)&&_t(l)!=="body"),o=null,i=Ye(e).position==="fixed",s=i?an(e):e;for(;gt(s)&&!cr(s);){let l=Ye(s),a=Po(s);!a&&l.position==="fixed"&&(o=null),(i?!a&&!o:!a&&l.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||wn(s)&&!a&&Iu(e,s))?r=r.filter(u=>u!==s):o=l,s=an(s)}return t.set(e,r),r}function Bm(e){let{element:t,boundary:n,rootBoundary:r,strategy:o}=e,s=[...n==="clippingAncestors"?Dm(t,this._c):[].concat(n),r],l=s[0],a=s.reduce((c,u)=>{let p=hu(t,u,o);return c.top=De(p.top,c.top),c.right=$t(p.right,c.right),c.bottom=$t(p.bottom,c.bottom),c.left=De(p.left,c.left),c},hu(t,l,o));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function Fm(e){return Cu(e)}function Hm(e,t,n){let r=ct(t),o=mt(t),i=n==="fixed",s=ln(e,!0,i,t),l={scrollLeft:0,scrollTop:0},a=wt(0);if(r||!r&&!i)if((_t(t)!=="body"||wn(o))&&(l=ur(t)),r){let c=ln(t,!0,i,t);a.x=c.x+t.clientLeft,a.y=c.y+t.clientTop}else o&&(a.x=Eu(o));return{x:s.left+l.scrollLeft-a.x,y:s.top+l.scrollTop-a.y,width:s.width,height:s.height}}function yu(e,t){return!ct(e)||Ye(e).position==="fixed"?null:t?t(e):e.offsetParent}function wu(e,t){let n=$e(e);if(!ct(e))return n;let r=yu(e,t);for(;r&&fu(r)&&Ye(r).position==="static";)r=yu(r,t);return r&&(_t(r)==="html"||_t(r)==="body"&&Ye(r).position==="static"&&!Po(r))?n:r||mu(e)||n}var Um=async function(e){let{reference:t,floating:n,strategy:r}=e,o=this.getOffsetParent||wu,i=this.getDimensions;return{reference:Hm(t,await o(n),r),floating:{x:0,y:0,...await i(n)}}};function Wm(e){return Ye(e).direction==="rtl"}var Ao={convertOffsetParentRelativeRectToViewportRelativeRect:Rm,getDocumentElement:mt,getClippingRect:Bm,getOffsetParent:wu,getElementRects:Um,getClientRects:km,getDimensions:Fm,getScale:Pn,isElement:gt,isRTL:Wm};function Gm(e,t){let n=null,r,o=mt(e);function i(){clearTimeout(r),n&&n.disconnect(),n=null}function s(l,a){l===void 0&&(l=!1),a===void 0&&(a=1),i();let{left:c,top:u,width:p,height:f}=e.getBoundingClientRect();if(l||t(),!p||!f)return;let d=ir(u),g=ir(o.clientWidth-(c+p)),m=ir(o.clientHeight-(u+f)),v=ir(c),b={rootMargin:-d+"px "+-g+"px "+-m+"px "+-v+"px",threshold:De(0,$t(1,a))||1},T=!0;function I(x){let P=x[0].intersectionRatio;if(P!==a){if(!T)return s();P?s(!1,P):r=setTimeout(()=>{s(!1,1e-7)},100)}T=!1}try{n=new IntersectionObserver(I,{...b,root:o.ownerDocument})}catch{n=new IntersectionObserver(I,b)}n.observe(e)}return s(!0),i}function Pu(e,t,n,r){r===void 0&&(r={});let{ancestorScroll:o=!0,ancestorResize:i=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:a=!1}=r,c=ds(e),u=o||i?[...c?je(c):[],...je(t)]:[];u.forEach(h=>{o&&h.addEventListener("scroll",n,{passive:!0}),i&&h.addEventListener("resize",n)});let p=c&&l?Gm(c,n):null,f=-1,d=null;s&&(d=new ResizeObserver(h=>{let[b]=h;b&&b.target===c&&d&&(d.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{d&&d.observe(t)})),n()}),c&&!a&&d.observe(c),d.observe(t));let g,m=a?ln(e):null;a&&v();function v(){let h=ln(e);m&&(h.x!==m.x||h.y!==m.y||h.width!==m.width||h.height!==m.height)&&n(),m=h,g=requestAnimationFrame(v)}return n(),()=>{u.forEach(h=>{o&&h.removeEventListener("scroll",n),i&&h.removeEventListener("resize",n)}),p&&p(),d&&d.disconnect(),d=null,a&&cancelAnimationFrame(g)}}var Mo=(e,t,n)=>{let r=new Map,o={platform:Ao,...n},i={...o.platform,_c:r};return uu(e,t,{...o,platform:i})};var be=C(z()),Lo=C(z()),Au=C(js());var Ro=typeof document<"u"?Lo.useLayoutEffect:Lo.useEffect;function ko(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!ko(e[r],t[r]))return!1;return!0}if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;r--!==0;){let i=o[r];if(!(i==="_owner"&&e.$$typeof)&&!ko(e[i],t[i]))return!1}return!0}return e!==e&&t!==t}function _u(e){let t=be.useRef(e);return Ro(()=>{t.current=e}),t}function Mu(e){e===void 0&&(e={});let{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,whileElementsMounted:i,open:s}=e,[l,a]=be.useState({x:null,y:null,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[c,u]=be.useState(r);ko(c,r)||u(r);let p=be.useRef(null),f=be.useRef(null),d=be.useRef(l),g=_u(i),m=_u(o),[v,h]=be.useState(null),[b,T]=be.useState(null),I=be.useCallback(E=>{p.current!==E&&(p.current=E,h(E))},[]),x=be.useCallback(E=>{f.current!==E&&(f.current=E,T(E))},[]),P=be.useCallback(()=>{if(!p.current||!f.current)return;let E={placement:t,strategy:n,middleware:c};m.current&&(E.platform=m.current),Mo(p.current,f.current,E).then(y=>{let _={...y,isPositioned:!0};D.current&&!ko(d.current,_)&&(d.current=_,Au.flushSync(()=>{a(_)}))})},[c,t,n,m]);Ro(()=>{s===!1&&d.current.isPositioned&&(d.current.isPositioned=!1,a(E=>({...E,isPositioned:!1})))},[s]);let D=be.useRef(!1);Ro(()=>(D.current=!0,()=>{D.current=!1}),[]),Ro(()=>{if(v&&b){if(g.current)return g.current(v,b,P);P()}},[v,b,P,g]);let N=be.useMemo(()=>({reference:p,floating:f,setReference:I,setFloating:x}),[I,x]),k=be.useMemo(()=>({reference:v,floating:b}),[v,b]);return be.useMemo(()=>({...l,update:P,refs:N,elements:k,reference:I,floating:x}),[l,P,N,k,I,x])}var zm=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},_n=new WeakMap,Oo=new WeakMap,No={},fs=0,Ru=function(e){return e&&(e.host||Ru(e.parentNode))},Vm=function(e,t){return t.map(function(n){if(e.contains(n))return n;var r=Ru(n);return r&&e.contains(r)?r:null}).filter(function(n){return!!n})},$m=function(e,t,n,r){var o=Vm(t,Array.isArray(e)?e:[e]);No[n]||(No[n]=new WeakMap);var i=No[n],s=[],l=new Set,a=new Set(o),c=function(p){!p||l.has(p)||(l.add(p),c(p.parentNode))};o.forEach(c);var u=function(p){!p||a.has(p)||Array.prototype.forEach.call(p.children,function(f){if(l.has(f))u(f);else{var d=f.getAttribute(r),g=d!==null&&d!=="false",m=(_n.get(f)||0)+1,v=(i.get(f)||0)+1;_n.set(f,m),i.set(f,v),s.push(f),m===1&&g&&Oo.set(f,!0),v===1&&f.setAttribute(n,"true"),g||f.setAttribute(r,"true")}})};return u(t),l.clear(),fs++,function(){s.forEach(function(p){var f=_n.get(p)-1,d=i.get(p)-1;_n.set(p,f),i.set(p,d),f||(Oo.has(p)||p.removeAttribute(r),Oo.delete(p)),d||p.removeAttribute(n)}),fs--,fs||(_n=new WeakMap,_n=new WeakMap,Oo=new WeakMap,No={})}},ku=function(e,t,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),o=t||zm(e);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),$m(r,o,n,"aria-hidden")):function(){return null}};var qm=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],ms=qm.join(","),Nu=typeof Element>"u",pr=Nu?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Do=!Nu&&Element.prototype.getRootNode?function(e){var t;return e==null||(t=e.getRootNode)===null||t===void 0?void 0:t.call(e)}:function(e){return e?.ownerDocument},Bo=function e(t,n){var r;n===void 0&&(n=!0);var o=t==null||(r=t.getAttribute)===null||r===void 0?void 0:r.call(t,"inert"),i=o===""||o==="true",s=i||n&&t&&e(t.parentNode);return s},jm=function(t){var n,r=t==null||(n=t.getAttribute)===null||n===void 0?void 0:n.call(t,"contenteditable");return r===""||r==="true"},Ym=function(t,n,r){if(Bo(t))return[];var o=Array.prototype.slice.apply(t.querySelectorAll(ms));return n&&pr.call(t,ms)&&o.unshift(t),o=o.filter(r),o},Km=function e(t,n,r){for(var o=[],i=Array.from(t);i.length;){var s=i.shift();if(!Bo(s,!1))if(s.tagName==="SLOT"){var l=s.assignedElements(),a=l.length?l:s.children,c=e(a,!0,r);r.flatten?o.push.apply(o,c):o.push({scopeParent:s,candidates:c})}else{var u=pr.call(s,ms);u&&r.filter(s)&&(n||!t.includes(s))&&o.push(s);var p=s.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(s),f=!Bo(p,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(s));if(p&&f){var d=e(p===!0?s.children:p.children,!0,r);r.flatten?o.push.apply(o,d):o.push({scopeParent:s,candidates:d})}else i.unshift.apply(i,s.children)}}return o},Du=function(t){return!isNaN(parseInt(t.getAttribute("tabindex"),10))},Bu=function(t){if(!t)throw new Error("No node provided");return t.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(t.tagName)||jm(t))&&!Du(t)?0:t.tabIndex},Xm=function(t,n){var r=Bu(t);return r<0&&n&&!Du(t)?0:r},Qm=function(t,n){return t.tabIndex===n.tabIndex?t.documentOrder-n.documentOrder:t.tabIndex-n.tabIndex},Fu=function(t){return t.tagName==="INPUT"},Jm=function(t){return Fu(t)&&t.type==="hidden"},Zm=function(t){var n=t.tagName==="DETAILS"&&Array.prototype.slice.apply(t.children).some(function(r){return r.tagName==="SUMMARY"});return n},eg=function(t,n){for(var r=0;r<t.length;r++)if(t[r].checked&&t[r].form===n)return t[r]},tg=function(t){if(!t.name)return!0;var n=t.form||Do(t),r=function(l){return n.querySelectorAll('input[type="radio"][name="'+l+'"]')},o;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")o=r(window.CSS.escape(t.name));else try{o=r(t.name)}catch{return!1}var i=eg(o,t.form);return!i||i===t},ng=function(t){return Fu(t)&&t.type==="radio"},rg=function(t){return ng(t)&&!tg(t)},og=function(t){var n,r=t&&Do(t),o=(n=r)===null||n===void 0?void 0:n.host,i=!1;if(r&&r!==t){var s,l,a;for(i=!!((s=o)!==null&&s!==void 0&&(l=s.ownerDocument)!==null&&l!==void 0&&l.contains(o)||t!=null&&(a=t.ownerDocument)!==null&&a!==void 0&&a.contains(t));!i&&o;){var c,u,p;r=Do(o),o=(c=r)===null||c===void 0?void 0:c.host,i=!!((u=o)!==null&&u!==void 0&&(p=u.ownerDocument)!==null&&p!==void 0&&p.contains(o))}}return i},Lu=function(t){var n=t.getBoundingClientRect(),r=n.width,o=n.height;return r===0&&o===0},ig=function(t,n){var r=n.displayCheck,o=n.getShadowRoot;if(getComputedStyle(t).visibility==="hidden")return!0;var i=pr.call(t,"details>summary:first-of-type"),s=i?t.parentElement:t;if(pr.call(s,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof o=="function"){for(var l=t;t;){var a=t.parentElement,c=Do(t);if(a&&!a.shadowRoot&&o(a)===!0)return Lu(t);t.assignedSlot?t=t.assignedSlot:!a&&c!==t.ownerDocument?t=c.host:t=a}t=l}if(og(t))return!t.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return Lu(t);return!1},sg=function(t){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(t.tagName))for(var n=t.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var o=n.children.item(r);if(o.tagName==="LEGEND")return pr.call(n,"fieldset[disabled] *")?!0:!o.contains(t)}return!0}n=n.parentElement}return!1},ag=function(t,n){return!(n.disabled||Bo(n)||Jm(n)||ig(n,t)||Zm(n)||sg(n))},Ou=function(t,n){return!(rg(n)||Bu(n)<0||!ag(t,n))},lg=function(t){var n=parseInt(t.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},cg=function e(t){var n=[],r=[];return t.forEach(function(o,i){var s=!!o.scopeParent,l=s?o.scopeParent:o,a=Xm(l,s),c=s?e(o.candidates):l;a===0?s?n.push.apply(n,c):n.push(l):r.push({documentOrder:i,tabIndex:a,item:o,isScope:s,content:c})}),r.sort(Qm).reduce(function(o,i){return i.isScope?o.push.apply(o,i.content):o.push(i.content),o},[]).concat(n)},dr=function(t,n){n=n||{};var r;return n.getShadowRoot?r=Km([t],n.includeContainer,{filter:Ou.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:lg}):r=Ym(t,n.includeContainer,Ou.bind(null,n)),cg(r)};var hr=C(js());function Ho(){return Ho=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ho.apply(this,arguments)}var Ie=typeof document<"u"?kn.useLayoutEffect:kn.useEffect,gs=!1,ug=0,Hu=()=>"floating-ui-"+ug++;function pg(){let[e,t]=S.useState(()=>gs?Hu():void 0);return Ie(()=>{e==null&&t(Hu())},[]),S.useEffect(()=>{gs||(gs=!0)},[]),e}var dg=S["useId".toString()],Uo=dg||pg;function Yu(){let e=new Map;return{emit(t,n){var r;(r=e.get(t))==null||r.forEach(o=>o(n))},on(t,n){e.set(t,[...e.get(t)||[],n])},off(t,n){e.set(t,(e.get(t)||[]).filter(r=>r!==n))}}}var Ku=S.createContext(null),Xu=S.createContext(null),yr=()=>{var e;return((e=S.useContext(Ku))==null?void 0:e.id)||null},Ln=()=>S.useContext(Xu),bI=e=>{let t=Uo(),n=Ln(),r=yr(),o=e||r;return Ie(()=>{let i={id:t,parentId:o};return n?.addNode(i),()=>{n?.removeNode(i)}},[n,t,o]),t},TI=e=>{let{children:t,id:n}=e,r=yr();return S.createElement(Ku.Provider,{value:S.useMemo(()=>({id:n,parentId:r}),[n,r])},t)},xI=e=>{let{children:t}=e,n=S.useRef([]),r=S.useCallback(s=>{n.current=[...n.current,s]},[]),o=S.useCallback(s=>{n.current=n.current.filter(l=>l!==s)},[]),i=S.useState(()=>Yu())[0];return S.createElement(Xu.Provider,{value:S.useMemo(()=>({nodesRef:n,addNode:r,removeNode:o,events:i}),[n,r,o,i])},t)};function nt(e){return e?.ownerDocument||document}function Qu(){let e=navigator.userAgentData;return e!=null&&e.platform?e.platform:navigator.platform}function fg(){let e=navigator.userAgentData;return e&&Array.isArray(e.brands)?e.brands.map(t=>{let{brand:n,version:r}=t;return n+"/"+r}).join(" "):navigator.userAgent}function Ss(e){return nt(e).defaultView||window}function ut(e){return e?e instanceof Ss(e).Element:!1}function An(e){return e?e instanceof Ss(e).HTMLElement:!1}function mg(e){if(typeof ShadowRoot>"u")return!1;let t=Ss(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function Ju(e){if(e.mozInputSource===0&&e.isTrusted)return!0;let t=/Android/i;return(t.test(Qu())||t.test(fg()))&&e.pointerType?e.type==="click"&&e.buttons===1:e.detail===0&&!e.pointerType}function Zu(e){return e.width===0&&e.height===0||e.width===1&&e.height===1&&e.pressure===0&&e.detail===0&&e.pointerType!=="mouse"||e.width<1&&e.height<1&&e.pressure===0&&e.detail===0}function xs(){return/apple/i.test(navigator.vendor)}function ep(){return Qu().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function Wo(e,t){let n=["mouse","pen"];return t||n.push("",void 0),n.includes(e)}function jt(e){let t=(0,kn.useRef)(e);return Ie(()=>{t.current=e}),t}var Uu="data-floating-ui-safe-polygon";function hs(e,t,n){return n&&!Wo(n)?0:typeof e=="number"?e:e?.[t]}var CI=function(e,t){let{enabled:n=!0,delay:r=0,handleClose:o=null,mouseOnly:i=!1,restMs:s=0,move:l=!0}=t===void 0?{}:t,{open:a,onOpenChange:c,dataRef:u,events:p,elements:{domReference:f,floating:d},refs:g}=e,m=Ln(),v=yr(),h=jt(o),b=jt(r),T=S.useRef(),I=S.useRef(),x=S.useRef(),P=S.useRef(),D=S.useRef(!0),N=S.useRef(!1),k=S.useRef(()=>{}),E=S.useCallback(()=>{var w;let R=(w=u.current.openEvent)==null?void 0:w.type;return R?.includes("mouse")&&R!=="mousedown"},[u]);S.useEffect(()=>{if(!n)return;function w(){clearTimeout(I.current),clearTimeout(P.current),D.current=!0}return p.on("dismiss",w),()=>{p.off("dismiss",w)}},[n,p]),S.useEffect(()=>{if(!n||!h.current||!a)return;function w(){E()&&c(!1)}let R=nt(d).documentElement;return R.addEventListener("mouseleave",w),()=>{R.removeEventListener("mouseleave",w)}},[d,a,c,n,h,u,E]);let y=S.useCallback(function(w){w===void 0&&(w=!0);let R=hs(b.current,"close",T.current);R&&!x.current?(clearTimeout(I.current),I.current=setTimeout(()=>c(!1),R)):w&&(clearTimeout(I.current),c(!1))},[b,c]),_=S.useCallback(()=>{k.current(),x.current=void 0},[]),A=S.useCallback(()=>{if(N.current){let w=nt(g.floating.current).body;w.style.pointerEvents="",w.removeAttribute(Uu),N.current=!1}},[g]);return S.useEffect(()=>{if(!n)return;function w(){return u.current.openEvent?["click","mousedown"].includes(u.current.openEvent.type):!1}function R(M){if(clearTimeout(I.current),D.current=!1,i&&!Wo(T.current)||s>0&&hs(b.current,"open")===0)return;u.current.openEvent=M;let F=hs(b.current,"open",T.current);F?I.current=setTimeout(()=>{c(!0)},F):c(!0)}function H(M){if(w())return;k.current();let F=nt(d);if(clearTimeout(P.current),h.current){a||clearTimeout(I.current),x.current=h.current({...e,tree:m,x:M.clientX,y:M.clientY,onClose(){A(),_(),y()}});let L=x.current;F.addEventListener("mousemove",L),k.current=()=>{F.removeEventListener("mousemove",L)};return}y()}function V(M){w()||h.current==null||h.current({...e,tree:m,x:M.clientX,y:M.clientY,onClose(){A(),_(),y()}})(M)}if(ut(f)){let M=f;return a&&M.addEventListener("mouseleave",V),d?.addEventListener("mouseleave",V),l&&M.addEventListener("mousemove",R,{once:!0}),M.addEventListener("mouseenter",R),M.addEventListener("mouseleave",H),()=>{a&&M.removeEventListener("mouseleave",V),d?.removeEventListener("mouseleave",V),l&&M.removeEventListener("mousemove",R),M.removeEventListener("mouseenter",R),M.removeEventListener("mouseleave",H)}}},[f,d,n,e,i,s,l,y,_,A,c,a,m,b,h,u]),Ie(()=>{var w;if(n&&a&&(w=h.current)!=null&&w.__options.blockPointerEvents&&E()){let V=nt(d).body;if(V.setAttribute(Uu,""),V.style.pointerEvents="none",N.current=!0,ut(f)&&d){var R,H;let M=f,F=m==null||(R=m.nodesRef.current.find(L=>L.id===v))==null||(H=R.context)==null?void 0:H.elements.floating;return F&&(F.style.pointerEvents=""),M.style.pointerEvents="auto",d.style.pointerEvents="auto",()=>{M.style.pointerEvents="",d.style.pointerEvents=""}}}},[n,a,v,d,f,m,h,u,E]),Ie(()=>{a||(T.current=void 0,_(),A())},[a,_,A]),S.useEffect(()=>()=>{_(),clearTimeout(I.current),clearTimeout(P.current),A()},[n,_,A]),S.useMemo(()=>{if(!n)return{};function w(R){T.current=R.pointerType}return{reference:{onPointerDown:w,onPointerEnter:w,onMouseMove(){a||s===0||(clearTimeout(P.current),P.current=setTimeout(()=>{D.current||c(!0)},s))}},floating:{onMouseEnter(){clearTimeout(I.current)},onMouseLeave(){p.emit("dismiss",{type:"mouseLeave",data:{returnFocus:!1}}),y(!1)}}}},[p,n,s,a,c,y])};function Mn(e){let t=e.activeElement;for(;((n=t)==null||(r=n.shadowRoot)==null?void 0:r.activeElement)!=null;){var n,r;t=t.shadowRoot.activeElement}return t}function tt(e,t){if(!e||!t)return!1;let n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&mg(n)){let r=t;do{if(r&&e===r)return!0;r=r.parentNode||r.host}while(r)}return!1}var Wu=0;function qt(e,t){t===void 0&&(t={});let{preventScroll:n=!1,cancelPrevious:r=!0,sync:o=!1}=t;r&&cancelAnimationFrame(Wu);let i=()=>e?.focus({preventScroll:n});o?i():Wu=requestAnimationFrame(i)}function gg(e,t){var n;let r=[],o=(n=e.find(i=>i.id===t))==null?void 0:n.parentId;for(;o;){let i=e.find(s=>s.id===o);o=i?.parentId,i&&(r=r.concat(i))}return r}function mr(e,t){let n=e.filter(o=>{var i;return o.parentId===t&&((i=o.context)==null?void 0:i.open)})||[],r=n;for(;r.length;)r=e.filter(o=>{var i;return(i=r)==null?void 0:i.some(s=>{var l;return o.parentId===s.id&&((l=o.context)==null?void 0:l.open)})})||[],n=n.concat(r);return n}function Vo(e){return"composedPath"in e?e.composedPath()[0]:e.target}var hg="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function tp(e){return An(e)&&e.matches(hg)}function et(e){e.preventDefault(),e.stopPropagation()}var Go=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function np(e,t){let n=dr(e,Go());t==="prev"&&n.reverse();let r=n.indexOf(Mn(nt(e)));return n.slice(r+1)[0]}function rp(){return np(document.body,"next")}function op(){return np(document.body,"prev")}function gr(e,t){let n=t||e.currentTarget,r=e.relatedTarget;return!r||!tt(n,r)}function yg(e){dr(e,Go()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function vg(e){e.querySelectorAll("[data-tabindex]").forEach(n=>{let r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}var bg=S["useInsertionEffect".toString()],Tg=bg||(e=>e());function vr(e){let t=S.useRef(()=>{});return Tg(()=>{t.current=e}),S.useCallback(function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return t.current==null?void 0:t.current(...r)},[])}var Es={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0},Cs,Is;function Gu(e){e.key==="Tab"&&(Cs=e.target,clearTimeout(Is))}function xg(e){let t=Cs===e.relatedTarget;return Cs=e.relatedTarget,clearTimeout(Is),t}var zo=S.forwardRef(function(t,n){let r=vr(t.onFocus),[o,i]=S.useState();return Ie(()=>(xs()&&i("button"),document.addEventListener("keydown",Gu),()=>{document.removeEventListener("keydown",Gu)}),[]),S.createElement("span",Ho({},t,{ref:n,tabIndex:0,role:o,"aria-hidden":o?void 0:!0,"data-floating-ui-focus-guard":"",style:Es,onFocus:s=>{xs()&&ep()&&!xg(s)?(s.persist(),Is=window.setTimeout(()=>{r(s)},50)):r(s)}}))}),ip=S.createContext(null),Cg=function(e){let{id:t,enabled:n=!0}=e===void 0?{}:e,[r,o]=S.useState(null),i=Uo(),s=sp();return Ie(()=>{if(!n)return;let l=t?document.getElementById(t):null;if(l)l.setAttribute("data-floating-ui-portal",""),o(l);else{let a=document.createElement("div");t!==""&&(a.id=t||i),a.setAttribute("data-floating-ui-portal",""),o(a);let c=s?.portalNode||document.body;return c.appendChild(a),()=>{c.removeChild(a)}}},[t,s,i,n]),r},SI=e=>{let{children:t,id:n,root:r=null,preserveTabOrder:o=!0}=e,i=Cg({id:n,enabled:!r}),[s,l]=S.useState(null),a=S.useRef(null),c=S.useRef(null),u=S.useRef(null),p=S.useRef(null),f=!!s&&!s.modal&&!!(r||i)&&o;return S.useEffect(()=>{if(!i||!o||s!=null&&s.modal)return;function d(g){i&&gr(g)&&(g.type==="focusin"?vg:yg)(i)}return i.addEventListener("focusin",d,!0),i.addEventListener("focusout",d,!0),()=>{i.removeEventListener("focusin",d,!0),i.removeEventListener("focusout",d,!0)}},[i,o,s?.modal]),S.createElement(ip.Provider,{value:S.useMemo(()=>({preserveTabOrder:o,beforeOutsideRef:a,afterOutsideRef:c,beforeInsideRef:u,afterInsideRef:p,portalNode:i,setFocusManagerState:l}),[o,i])},f&&i&&S.createElement(zo,{"data-type":"outside",ref:a,onFocus:d=>{if(gr(d,i)){var g;(g=u.current)==null||g.focus()}else{let m=op()||s?.refs.domReference.current;m?.focus()}}}),f&&i&&S.createElement("span",{"aria-owns":i.id,style:Es}),r?(0,hr.createPortal)(t,r):i?(0,hr.createPortal)(t,i):null,f&&i&&S.createElement(zo,{"data-type":"outside",ref:c,onFocus:d=>{if(gr(d,i)){var g;(g=p.current)==null||g.focus()}else{let m=rp()||s?.refs.domReference.current;m?.focus(),s?.closeOnFocusOut&&s?.onOpenChange(!1)}}}))},sp=()=>S.useContext(ip),Sg=S.forwardRef(function(t,n){return S.createElement("button",Ho({},t,{type:"button",ref:n,tabIndex:-1,style:Es}))});function EI(e){let{context:t,children:n,order:r=["content"],guards:o=!0,initialFocus:i=0,returnFocus:s=!0,modal:l=!0,visuallyHiddenDismiss:a=!1,closeOnFocusOut:c=!0}=e,{refs:u,nodeId:p,onOpenChange:f,events:d,dataRef:g,elements:{domReference:m,floating:v}}=t,h=jt(r),b=Ln(),T=sp(),[I,x]=S.useState(null),P=typeof i=="number"&&i<0,D=S.useRef(null),N=S.useRef(null),k=S.useRef(!1),E=S.useRef(null),y=S.useRef(!1),_=T!=null,A=m&&m.getAttribute("role")==="combobox"&&tp(m),w=S.useCallback(function(M){return M===void 0&&(M=v),M?dr(M,Go()):[]},[v]),R=S.useCallback(M=>{let F=w(M);return h.current.map(L=>m&&L==="reference"?m:v&&L==="floating"?v:F).filter(Boolean).flat()},[m,v,h,w]);S.useEffect(()=>{if(!l)return;function M(L){if(L.key==="Tab"){w().length===0&&!A&&et(L);let U=R(),Q=Vo(L);h.current[0]==="reference"&&Q===m&&(et(L),L.shiftKey?qt(U[U.length-1]):qt(U[1])),h.current[1]==="floating"&&Q===v&&L.shiftKey&&(et(L),qt(U[0]))}}let F=nt(v);return F.addEventListener("keydown",M),()=>{F.removeEventListener("keydown",M)}},[m,v,l,h,u,A,w,R]),S.useEffect(()=>{if(!c)return;function M(){y.current=!0,setTimeout(()=>{y.current=!1})}function F(L){let U=L.relatedTarget,Q=!(tt(m,U)||tt(v,U)||tt(U,v)||tt(T?.portalNode,U)||U!=null&&U.hasAttribute("data-floating-ui-focus-guard")||b&&(mr(b.nodesRef.current,p).find(K=>{var J,se;return tt((J=K.context)==null?void 0:J.elements.floating,U)||tt((se=K.context)==null?void 0:se.elements.domReference,U)})||gg(b.nodesRef.current,p).find(K=>{var J,se;return((J=K.context)==null?void 0:J.elements.floating)===U||((se=K.context)==null?void 0:se.elements.domReference)===U})));U&&Q&&!y.current&&U!==E.current&&(k.current=!0,setTimeout(()=>f(!1)))}if(v&&An(m))return m.addEventListener("focusout",F),m.addEventListener("pointerdown",M),!l&&v.addEventListener("focusout",F),()=>{m.removeEventListener("focusout",F),m.removeEventListener("pointerdown",M),!l&&v.removeEventListener("focusout",F)}},[m,v,l,p,b,T,f,c]),S.useEffect(()=>{var M;let F=Array.from((T==null||(M=T.portalNode)==null?void 0:M.querySelectorAll("[data-floating-ui-portal]"))||[]);function L(){return[D.current,N.current].filter(Boolean)}if(v&&l){let U=[v,...F,...L()],Q=ku(h.current.includes("reference")||A?U.concat(m||[]):U);return()=>{Q()}}},[m,v,l,h,T,A]),S.useEffect(()=>{if(l&&!o&&v){let M=[],F=Go(),L=dr(nt(v).body,F),U=R(),Q=L.filter(K=>!U.includes(K));return Q.forEach((K,J)=>{M[J]=K.getAttribute("tabindex"),K.setAttribute("tabindex","-1")}),()=>{Q.forEach((K,J)=>{let se=M[J];se==null?K.removeAttribute("tabindex"):K.setAttribute("tabindex",se)})}}},[v,l,o,R]),Ie(()=>{if(!v)return;let M=nt(v),F=s,L=!1,U=Mn(M),Q=g.current;E.current=U;let K=R(v),J=(typeof i=="number"?K[i]:i.current)||v;!P&&qt(J,{preventScroll:J===v});function se(O){if(O.type==="escapeKey"&&u.domReference.current&&(E.current=u.domReference.current),["referencePress","escapeKey"].includes(O.type))return;let ne=O.data.returnFocus;typeof ne=="object"?(F=!0,L=ne.preventScroll):F=ne}return d.on("dismiss",se),()=>{if(d.off("dismiss",se),tt(v,Mn(M))&&u.domReference.current&&(E.current=u.domReference.current),F&&An(E.current)&&!k.current)if(!u.domReference.current||y.current)qt(E.current,{cancelPrevious:!1,preventScroll:L});else{var O;Q.__syncReturnFocus=!0,(O=E.current)==null||O.focus({preventScroll:L}),setTimeout(()=>{delete Q.__syncReturnFocus})}}},[v,R,i,s,g,u,d,P]),Ie(()=>{if(T)return T.setFocusManagerState({...t,modal:l,closeOnFocusOut:c}),()=>{T.setFocusManagerState(null)}},[T,l,c,t]),Ie(()=>{if(P||!v)return;function M(){x(w().length)}if(M(),typeof MutationObserver=="function"){let F=new MutationObserver(M);return F.observe(v,{childList:!0,subtree:!0}),()=>{F.disconnect()}}},[v,w,P,u]);let H=o&&(_||l)&&!A;function V(M){return a&&l?S.createElement(Sg,{ref:M==="start"?D:N,onClick:()=>f(!1)},typeof a=="string"?a:"Dismiss"):null}return S.createElement(S.Fragment,null,H&&S.createElement(zo,{"data-type":"inside",ref:T?.beforeInsideRef,onFocus:M=>{if(l){let L=R();qt(r[0]==="reference"?L[0]:L[L.length-1])}else if(T!=null&&T.preserveTabOrder&&T.portalNode)if(k.current=!1,gr(M,T.portalNode)){let L=rp()||m;L?.focus()}else{var F;(F=T.beforeOutsideRef.current)==null||F.focus()}}}),A?null:V("start"),S.cloneElement(n,I===0||r.includes("floating")?{tabIndex:0}:{}),V("end"),H&&S.createElement(zo,{"data-type":"inside",ref:T?.afterInsideRef,onFocus:M=>{if(l)qt(R()[0]);else if(T!=null&&T.preserveTabOrder&&T.portalNode)if(k.current=!0,gr(M,T.portalNode)){let L=op()||m;L?.focus()}else{var F;(F=T.afterOutsideRef.current)==null||F.focus()}}}))}function zu(e){return An(e.target)&&e.target.tagName==="BUTTON"}function Vu(e){return tp(e)}var II=function(e,t){let{open:n,onOpenChange:r,dataRef:o,elements:{domReference:i}}=e,{enabled:s=!0,event:l="click",toggle:a=!0,ignoreMouse:c=!1,keyboardHandlers:u=!0}=t===void 0?{}:t,p=S.useRef();return S.useMemo(()=>s?{reference:{onPointerDown(f){p.current=f.pointerType},onMouseDown(f){f.button===0&&(Wo(p.current,!0)&&c||l!=="click"&&(n?a&&(!o.current.openEvent||o.current.openEvent.type==="mousedown")&&r(!1):(f.preventDefault(),r(!0)),o.current.openEvent=f.nativeEvent))},onClick(f){if(!o.current.__syncReturnFocus){if(l==="mousedown"&&p.current){p.current=void 0;return}Wo(p.current,!0)&&c||(n?a&&(!o.current.openEvent||o.current.openEvent.type==="click")&&r(!1):r(!0),o.current.openEvent=f.nativeEvent)}},onKeyDown(f){p.current=void 0,u&&(zu(f)||(f.key===" "&&!Vu(i)&&f.preventDefault(),f.key==="Enter"&&(n?a&&r(!1):r(!0))))},onKeyUp(f){u&&(zu(f)||Vu(i)||f.key===" "&&(n?a&&r(!1):r(!0)))}}}:{},[s,o,l,c,u,i,a,n,r])};function ys(e,t){if(t==null)return!1;if("composedPath"in e)return e.composedPath().includes(t);let n=e;return n.target!=null&&t.contains(n.target)}var Eg={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},Ig={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},wg=function(e){var t,n;return e===void 0&&(e=!0),{escapeKeyBubbles:typeof e=="boolean"?e:(t=e.escapeKey)!=null?t:!0,outsidePressBubbles:typeof e=="boolean"?e:(n=e.outsidePress)!=null?n:!0}},wI=function(e,t){let{open:n,onOpenChange:r,events:o,nodeId:i,elements:{reference:s,domReference:l,floating:a},dataRef:c}=e,{enabled:u=!0,escapeKey:p=!0,outsidePress:f=!0,outsidePressEvent:d="pointerdown",referencePress:g=!1,referencePressEvent:m="pointerdown",ancestorScroll:v=!1,bubbles:h=!0}=t===void 0?{}:t,b=Ln(),T=yr()!=null,I=vr(typeof f=="function"?f:()=>!1),x=typeof f=="function"?I:f,P=S.useRef(!1),{escapeKeyBubbles:D,outsidePressBubbles:N}=wg(h);return S.useEffect(()=>{if(!n||!u)return;c.current.__escapeKeyBubbles=D,c.current.__outsidePressBubbles=N;function k(w){if(w.key==="Escape"){let R=b?mr(b.nodesRef.current,i):[];if(R.length>0){let H=!0;if(R.forEach(V=>{var M;if((M=V.context)!=null&&M.open&&!V.context.dataRef.current.__escapeKeyBubbles){H=!1;return}}),!H)return}o.emit("dismiss",{type:"escapeKey",data:{returnFocus:{preventScroll:!1}}}),r(!1)}}function E(w){let R=P.current;if(P.current=!1,R||typeof x=="function"&&!x(w))return;let H=Vo(w);if(An(H)&&a){let F=a.ownerDocument.defaultView||window,L=H.scrollWidth>H.clientWidth,U=H.scrollHeight>H.clientHeight,Q=U&&w.offsetX>H.clientWidth;if(U&&F.getComputedStyle(H).direction==="rtl"&&(Q=w.offsetX<=H.offsetWidth-H.clientWidth),Q||L&&w.offsetY>H.clientHeight)return}let V=b&&mr(b.nodesRef.current,i).some(F=>{var L;return ys(w,(L=F.context)==null?void 0:L.elements.floating)});if(ys(w,a)||ys(w,l)||V)return;let M=b?mr(b.nodesRef.current,i):[];if(M.length>0){let F=!0;if(M.forEach(L=>{var U;if((U=L.context)!=null&&U.open&&!L.context.dataRef.current.__outsidePressBubbles){F=!1;return}}),!F)return}o.emit("dismiss",{type:"outsidePress",data:{returnFocus:T?{preventScroll:!0}:Ju(w)||Zu(w)}}),r(!1)}function y(){r(!1)}let _=nt(a);p&&_.addEventListener("keydown",k),x&&_.addEventListener(d,E);let A=[];return v&&(ut(l)&&(A=je(l)),ut(a)&&(A=A.concat(je(a))),!ut(s)&&s&&s.contextElement&&(A=A.concat(je(s.contextElement)))),A=A.filter(w=>{var R;return w!==((R=_.defaultView)==null?void 0:R.visualViewport)}),A.forEach(w=>{w.addEventListener("scroll",y,{passive:!0})}),()=>{p&&_.removeEventListener("keydown",k),x&&_.removeEventListener(d,E),A.forEach(w=>{w.removeEventListener("scroll",y)})}},[c,a,l,s,p,x,d,o,b,i,n,r,v,u,D,N,T]),S.useEffect(()=>{P.current=!1},[x,d]),S.useMemo(()=>u?{reference:{[Eg[m]]:()=>{g&&(o.emit("dismiss",{type:"referencePress",data:{returnFocus:!1}}),r(!1))}},floating:{[Ig[d]]:()=>{P.current=!0}}}:{},[u,o,g,d,m,r])};var $u=!1,ws="ArrowUp",$o="ArrowDown",Rn="ArrowLeft",br="ArrowRight";function Fo(e,t,n){return Math.floor(e/t)!==n}function fr(e,t){return t<0||t>=e.current.length}function ke(e,t){let{startingIndex:n=-1,decrement:r=!1,disabledIndices:o,amount:i=1}=t===void 0?{}:t,s=e.current,l=n;do{var a,c;l=l+(r?-i:i)}while(l>=0&&l<=s.length-1&&(o?o.includes(l):s[l]==null||(a=s[l])!=null&&a.hasAttribute("disabled")||((c=s[l])==null?void 0:c.getAttribute("aria-disabled"))==="true"));return l}function qo(e,t,n){switch(e){case"vertical":return t;case"horizontal":return n;default:return t||n}}function qu(e,t){return qo(t,e===ws||e===$o,e===Rn||e===br)}function vs(e,t,n){return qo(t,e===$o,n?e===Rn:e===br)||e==="Enter"||e==" "||e===""}function Pg(e,t,n){return qo(t,n?e===Rn:e===br,e===$o)}function _g(e,t,n){return qo(t,n?e===br:e===Rn,e===ws)}function bs(e,t){return ke(e,{disabledIndices:t})}function ju(e,t){return ke(e,{decrement:!0,startingIndex:e.current.length,disabledIndices:t})}var PI=function(e,t){let{open:n,onOpenChange:r,refs:o,elements:{domReference:i}}=e,{listRef:s,activeIndex:l,onNavigate:a=()=>{},enabled:c=!0,selectedIndex:u=null,allowEscape:p=!1,loop:f=!1,nested:d=!1,rtl:g=!1,virtual:m=!1,focusItemOnOpen:v="auto",focusItemOnHover:h=!0,openOnArrowKeyDown:b=!0,disabledIndices:T=void 0,orientation:I="vertical",cols:x=1,scrollItemIntoView:P=!0}=t===void 0?{listRef:{current:[]},activeIndex:null,onNavigate:()=>{}}:t,D=yr(),N=Ln(),k=vr(a),E=S.useRef(v),y=S.useRef(u??-1),_=S.useRef(null),A=S.useRef(!0),w=S.useRef(k),R=S.useRef(n),H=S.useRef(!1),V=S.useRef(!1),M=jt(T),F=jt(n),L=jt(P),[U,Q]=S.useState(),K=S.useCallback(function(O,ne,Y){Y===void 0&&(Y=!1);let Z=O.current[ne.current];m?Q(Z?.id):qt(Z,{preventScroll:!0,sync:ep()&&xs()?$u||H.current:!1}),requestAnimationFrame(()=>{let Le=L.current;Le&&Z&&(Y||!A.current)&&(Z.scrollIntoView==null||Z.scrollIntoView(typeof Le=="boolean"?{block:"nearest",inline:"nearest"}:Le))})},[m,L]);Ie(()=>{document.createElement("div").focus({get preventScroll(){return $u=!0,!1}})},[]),Ie(()=>{c&&(n?E.current&&u!=null&&(V.current=!0,k(u)):R.current&&(y.current=-1,w.current(null)))},[c,n,u,k]),Ie(()=>{if(c&&n)if(l==null){if(H.current=!1,u!=null)return;R.current&&(y.current=-1,K(s,y)),!R.current&&E.current&&(_.current!=null||E.current===!0&&_.current==null)&&(y.current=_.current==null||vs(_.current,I,g)||d?bs(s,M.current):ju(s,M.current),k(y.current))}else fr(s,l)||(y.current=l,K(s,y,V.current),V.current=!1)},[c,n,l,u,d,s,I,g,k,K,M]),Ie(()=>{if(c&&R.current&&!n){var O,ne;let Y=N==null||(O=N.nodesRef.current.find(Z=>Z.id===D))==null||(ne=O.context)==null?void 0:ne.elements.floating;Y&&!tt(Y,Mn(nt(Y)))&&Y.focus({preventScroll:!0})}},[c,n,N,D]),Ie(()=>{_.current=null,w.current=k,R.current=n});let J=l!=null,se=S.useMemo(()=>{function O(Y){if(!n)return;let Z=s.current.indexOf(Y);Z!==-1&&k(Z)}return{onFocus(Y){let{currentTarget:Z}=Y;O(Z)},onClick:Y=>{let{currentTarget:Z}=Y;return Z.focus({preventScroll:!0})},...h&&{onMouseMove(Y){let{currentTarget:Z}=Y;O(Z)},onPointerLeave(){if(A.current&&(y.current=-1,K(s,y),(0,hr.flushSync)(()=>k(null)),!m)){var Y;(Y=o.floating.current)==null||Y.focus({preventScroll:!0})}}}}},[n,o,K,h,s,k,m]);return S.useMemo(()=>{if(!c)return{};let O=M.current;function ne(G){if(A.current=!1,H.current=!0,!F.current&&G.currentTarget===o.floating.current)return;if(d&&_g(G.key,I,g)){et(G),r(!1),An(i)&&i.focus();return}let we=y.current,Te=bs(s,O),ee=ju(s,O);if(G.key==="Home"&&(y.current=Te,k(y.current)),G.key==="End"&&(y.current=ee,k(y.current)),x>1){let q=y.current;if(G.key===ws){if(et(G),q===-1)y.current=ee;else if(y.current=ke(s,{startingIndex:q,amount:x,decrement:!0,disabledIndices:O}),f&&(q-x<Te||y.current<0)){let Pe=q%x,_e=ee%x,rt=ee-(_e-Pe);_e===Pe?y.current=ee:y.current=_e>Pe?rt:rt-x}fr(s,y.current)&&(y.current=q),k(y.current)}if(G.key===$o&&(et(G),q===-1?y.current=Te:(y.current=ke(s,{startingIndex:q,amount:x,disabledIndices:O}),f&&q+x>ee&&(y.current=ke(s,{startingIndex:q%x-x,amount:x,disabledIndices:O}))),fr(s,y.current)&&(y.current=q),k(y.current)),I==="both"){let Pe=Math.floor(q/x);G.key===br&&(et(G),q%x!==x-1?(y.current=ke(s,{startingIndex:q,disabledIndices:O}),f&&Fo(y.current,x,Pe)&&(y.current=ke(s,{startingIndex:q-q%x-1,disabledIndices:O}))):f&&(y.current=ke(s,{startingIndex:q-q%x-1,disabledIndices:O})),Fo(y.current,x,Pe)&&(y.current=q)),G.key===Rn&&(et(G),q%x!==0?(y.current=ke(s,{startingIndex:q,disabledIndices:O,decrement:!0}),f&&Fo(y.current,x,Pe)&&(y.current=ke(s,{startingIndex:q+(x-q%x),decrement:!0,disabledIndices:O}))):f&&(y.current=ke(s,{startingIndex:q+(x-q%x),decrement:!0,disabledIndices:O})),Fo(y.current,x,Pe)&&(y.current=q));let _e=Math.floor(ee/x)===Pe;fr(s,y.current)&&(f&&_e?y.current=G.key===Rn?ee:ke(s,{startingIndex:q-q%x-1,disabledIndices:O}):y.current=q),k(y.current);return}}if(qu(G.key,I)){if(et(G),n&&!m&&Mn(G.currentTarget.ownerDocument)===G.currentTarget){y.current=vs(G.key,I,g)?Te:ee,k(y.current);return}vs(G.key,I,g)?f?y.current=we>=ee?p&&we!==s.current.length?-1:Te:ke(s,{startingIndex:we,disabledIndices:O}):y.current=Math.min(ee,ke(s,{startingIndex:we,disabledIndices:O})):f?y.current=we<=Te?p&&we!==-1?s.current.length:ee:ke(s,{startingIndex:we,decrement:!0,disabledIndices:O}):y.current=Math.max(Te,ke(s,{startingIndex:we,decrement:!0,disabledIndices:O})),fr(s,y.current)?k(null):k(y.current)}}function Y(G){v==="auto"&&Ju(G.nativeEvent)&&(E.current=!0)}function Z(G){E.current=v,v==="auto"&&Zu(G.nativeEvent)&&(E.current=!0)}let Le=m&&n&&J&&{"aria-activedescendant":U};return{reference:{...Le,onKeyDown(G){A.current=!1;let we=G.key.indexOf("Arrow")===0;if(m&&n)return ne(G);if(!n&&!b&&we)return;if((we||G.key==="Enter"||G.key===" "||G.key==="")&&(_.current=G.key),d){Pg(G.key,I,g)&&(et(G),n?(y.current=bs(s,O),k(y.current)):r(!0));return}qu(G.key,I)&&(u!=null&&(y.current=u),et(G),!n&&b?r(!0):ne(G),n&&k(y.current))},onFocus(){n&&k(null)},onPointerDown:Z,onMouseDown:Y,onClick:Y},floating:{"aria-orientation":I==="both"?void 0:I,...Le,onKeyDown:ne,onPointerMove(){A.current=!0}},item:se}},[i,o,U,M,F,s,c,I,g,m,n,J,d,u,b,p,x,f,v,k,r,se])};function _I(e){return S.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})},e)}var AI=function(e,t){let{open:n}=e,{enabled:r=!0,role:o="dialog"}=t===void 0?{}:t,i=Uo(),s=Uo();return S.useMemo(()=>{let l={id:i,role:o};return r?o==="tooltip"?{reference:{"aria-describedby":n?i:void 0},floating:l}:{reference:{"aria-expanded":n?"true":"false","aria-haspopup":o==="alertdialog"?"dialog":o,"aria-controls":n?i:void 0,...o==="listbox"&&{role:"combobox"},...o==="menu"&&{id:s}},floating:{...l,...o==="menu"&&{"aria-labelledby":s}}}:{}},[r,o,n,i,s])};var MI=function(e,t){var n;let{open:r,dataRef:o,refs:i}=e,{listRef:s,activeIndex:l,onMatch:a=()=>{},enabled:c=!0,findMatch:u=null,resetMs:p=1e3,ignoreKeys:f=[],selectedIndex:d=null}=t===void 0?{listRef:{current:[]},activeIndex:null}:t,g=S.useRef(),m=S.useRef(""),v=S.useRef((n=d??l)!=null?n:-1),h=S.useRef(null),b=vr(a),T=jt(u),I=jt(f);return Ie(()=>{r&&(clearTimeout(g.current),h.current=null,m.current="")},[r]),Ie(()=>{if(r&&m.current===""){var x;v.current=(x=d??l)!=null?x:-1}},[r,d,l]),S.useMemo(()=>{if(!c)return{};function x(P){var D;let N=Vo(P.nativeEvent);if(ut(N)&&(Mn(nt(N))!==P.currentTarget?(D=i.floating.current)!=null&&D.contains(N)&&N.closest('[role="dialog"],[role="menu"],[role="listbox"],[role="tree"],[role="grid"]')!==P.currentTarget:!P.currentTarget.contains(N)))return;m.current.length>0&&m.current[0]!==" "&&(o.current.typing=!0,P.key===" "&&et(P));let k=s.current;if(k==null||I.current.includes(P.key)||P.key.length!==1||P.ctrlKey||P.metaKey||P.altKey)return;k.every(R=>{var H,V;return R?((H=R[0])==null?void 0:H.toLocaleLowerCase())!==((V=R[1])==null?void 0:V.toLocaleLowerCase()):!0})&&m.current===P.key&&(m.current="",v.current=h.current),m.current+=P.key,clearTimeout(g.current),g.current=setTimeout(()=>{m.current="",v.current=h.current,o.current.typing=!1},p);let y=v.current,_=[...k.slice((y||0)+1),...k.slice(0,(y||0)+1)],A=T.current?T.current(_,m.current):_.find(R=>R?.toLocaleLowerCase().indexOf(m.current.toLocaleLowerCase())===0),w=A?k.indexOf(A):-1;w!==-1&&(b(w),h.current=w)}return{reference:{onKeyDown:x},floating:{onKeyDown:x}}},[c,o,s,p,I,T,b,i])};function Ag(e,t){let[n,r]=e,o=!1,i=t.length;for(let s=0,l=i-1;s<i;l=s++){let[a,c]=t[s]||[0,0],[u,p]=t[l]||[0,0];c>=r!=p>=r&&n<=(u-a)*(r-c)/(p-c)+a&&(o=!o)}return o}function Mg(e,t){return e[0]>=t.x&&e[0]<=t.x+t.width&&e[1]>=t.y&&e[1]<=t.y+t.height}function RI(e){let{restMs:t=0,buffer:n=.5,blockPointerEvents:r=!1}=e===void 0?{}:e,o,i=!1,s=!1,l=a=>{let{x:c,y:u,placement:p,elements:f,onClose:d,nodeId:g,tree:m}=a;return function(h){function b(){clearTimeout(o),d()}if(clearTimeout(o),!f.domReference||!f.floating||p==null||c==null||u==null)return;let{clientX:T,clientY:I}=h,x=[T,I],P=Vo(h),D=h.type==="mouseleave",N=tt(f.floating,P),k=tt(f.domReference,P),E=f.domReference.getBoundingClientRect(),y=f.floating.getBoundingClientRect(),_=p.split("-")[0],A=c>y.right-y.width/2,w=u>y.bottom-y.height/2,R=Mg(x,E);if(N&&(s=!0,!D))return;if(k&&(s=!1),k&&!D){s=!0;return}if(D&&ut(h.relatedTarget)&&tt(f.floating,h.relatedTarget)||m&&mr(m.nodesRef.current,g).some(F=>{let{context:L}=F;return L?.open}))return;if(_==="top"&&u>=E.bottom-1||_==="bottom"&&u<=E.top+1||_==="left"&&c>=E.right-1||_==="right"&&c<=E.left+1)return b();let H=[];switch(_){case"top":H=[[y.left,E.top+1],[y.left,y.bottom-1],[y.right,y.bottom-1],[y.right,E.top+1]],i=T>=y.left&&T<=y.right&&I>=y.top&&I<=E.top+1;break;case"bottom":H=[[y.left,y.top+1],[y.left,E.bottom-1],[y.right,E.bottom-1],[y.right,y.top+1]],i=T>=y.left&&T<=y.right&&I>=E.bottom-1&&I<=y.bottom;break;case"left":H=[[y.right-1,y.bottom],[y.right-1,y.top],[E.left+1,y.top],[E.left+1,y.bottom]],i=T>=y.left&&T<=E.left+1&&I>=y.top&&I<=y.bottom;break;case"right":H=[[E.right-1,y.bottom],[E.right-1,y.top],[y.left+1,y.top],[y.left+1,y.bottom]],i=T>=E.right-1&&T<=y.right&&I>=y.top&&I<=y.bottom;break}function V(F){let[L,U]=F,Q=y.width>E.width,K=y.height>E.height;switch(_){case"top":{let J=[Q?L+n/2:A?L+n*4:L-n*4,U+n+1],se=[Q?L-n/2:A?L+n*4:L-n*4,U+n+1],O=[[y.left,A||Q?y.bottom-n:y.top],[y.right,A?Q?y.bottom-n:y.top:y.bottom-n]];return[J,se,...O]}case"bottom":{let J=[Q?L+n/2:A?L+n*4:L-n*4,U-n],se=[Q?L-n/2:A?L+n*4:L-n*4,U-n],O=[[y.left,A||Q?y.top+n:y.bottom],[y.right,A?Q?y.top+n:y.bottom:y.top+n]];return[J,se,...O]}case"left":{let J=[L+n+1,K?U+n/2:w?U+n*4:U-n*4],se=[L+n+1,K?U-n/2:w?U+n*4:U-n*4];return[...[[w||K?y.right-n:y.left,y.top],[w?K?y.right-n:y.left:y.right-n,y.bottom]],J,se]}case"right":{let J=[L-n,K?U+n/2:w?U+n*4:U-n*4],se=[L-n,K?U-n/2:w?U+n*4:U-n*4],O=[[w||K?y.left+n:y.right,y.top],[w?K?y.left+n:y.right:y.left+n,y.bottom]];return[J,se,...O]}}}let M=i?H:V([c,u]);if(!i){if(s&&!R)return b();Ag([T,I],M)?t&&!s&&(o=setTimeout(b,t)):b()}}};return l.__options={blockPointerEvents:r},l}function kI(e){e===void 0&&(e={});let{open:t=!1,onOpenChange:n,nodeId:r}=e,o=Mu(e),i=Ln(),s=S.useRef(null),l=S.useRef({}),a=S.useState(()=>Yu())[0],[c,u]=S.useState(null),p=S.useCallback(h=>{let b=ut(h)?{getBoundingClientRect:()=>h.getBoundingClientRect(),contextElement:h}:h;o.refs.setReference(b)},[o.refs]),f=S.useCallback(h=>{(ut(h)||h===null)&&(s.current=h,u(h)),(ut(o.refs.reference.current)||o.refs.reference.current===null||h!==null&&!ut(h))&&o.refs.setReference(h)},[o.refs]),d=S.useMemo(()=>({...o.refs,setReference:f,setPositionReference:p,domReference:s}),[o.refs,f,p]),g=S.useMemo(()=>({...o.elements,domReference:c}),[o.elements,c]),m=vr(n),v=S.useMemo(()=>({...o,refs:d,elements:g,dataRef:l,nodeId:r,events:a,open:t,onOpenChange:m}),[o,r,a,t,m,d,g]);return Ie(()=>{let h=i?.nodesRef.current.find(b=>b.id===r);h&&(h.context=v)}),S.useMemo(()=>({...o,context:v,refs:d,reference:f,positionReference:p}),[o,d,v,f,p])}function Ts(e,t,n){let r=new Map;return{...n==="floating"&&{tabIndex:-1},...e,...t.map(o=>o?o[n]:null).concat(e).reduce((o,i)=>(i&&Object.entries(i).forEach(s=>{let[l,a]=s;if(l.indexOf("on")===0){if(r.has(l)||r.set(l,[]),typeof a=="function"){var c;(c=r.get(l))==null||c.push(a),o[l]=function(){for(var u,p=arguments.length,f=new Array(p),d=0;d<p;d++)f[d]=arguments[d];(u=r.get(l))==null||u.forEach(g=>g(...f))}}}else o[l]=a}),o),{})}}var LI=function(e){e===void 0&&(e=[]);let t=e,n=S.useCallback(i=>Ts(i,e,"reference"),t),r=S.useCallback(i=>Ts(i,e,"floating"),t),o=S.useCallback(i=>Ts(i,e,"item"),e.map(i=>i?.item));return S.useMemo(()=>({getReferenceProps:n,getFloatingProps:r,getItemProps:o}),[n,r,o])};var Be={REPLACE_SELECTION:"397f0c89-596c-4433-be95-02faeccee083",INSERT_BELOW:"d0b0b2a0-0b7e-4b1e-9b0e-5b7b6b2b4b2b",INSERT:"5fd6256c-f03c-4520-8df4-64b248247216",CONTINUE_WRITING:"207d0f63-7905-479f-9962-1e3ebd0b65ee",INSERT_ABOVE:"1f755cfe-cc56-4a73-9cc4-d2baf2c39624",TRY_AGAIN:"6b9f9cb4-b1b1-4897-9156-903dbc52b2a1",DISCARD:"82dc6fe3-da3d-437c-aa0e-268e4f602787",MAKE_LONGER:"2bd23d4b-6f6b-491c-a42f-f6c24a3b075d",MAKE_SHORTER:"44ea14bf-e81d-4e24-9627-b2ce9b1546dd",COPY:"8fcccd1e-eb6e-419e-8c79-d8bc7c10e72c"},On=[{id:Be.REPLACE_SELECTION,text:"Replace selection",parent:"root",droppable:!1,data:{type:"shortcuts",editable:!1,icon:"Done"},children:[]},{id:Be.INSERT,text:"Insert",parent:"root",droppable:!1,data:{type:"shortcuts",editable:!1,icon:"NoteRight"},children:[]},{id:Be.INSERT_BELOW,text:"Insert below",parent:"root",droppable:!1,data:{type:"shortcuts",editable:!1,icon:"NoteDown"},children:[]},{id:Be.CONTINUE_WRITING,text:"Continue writing",parent:"root",droppable:!1,data:{type:"shortcuts",editable:!1,icon:"DefaultIcon",actions:[{type:"FETCH_ACTIONS",parameters:{template:"c0f7a642-9e34-4b1f-a2ee-1c4c5e93fa23"}}]},children:[]},{id:Be.COPY,text:"Copy",parent:"root",droppable:!1,data:{type:"shortcuts",editable:!1,icon:"Copy"},children:[]},{id:Be.TRY_AGAIN,text:"Try again",parent:"root",droppable:!1,data:{icon:"Replay",type:"shortcuts",editable:!1},children:[]},{id:Be.DISCARD,text:"Discard",parent:"root",droppable:!1,data:{icon:"Delete",type:"shortcuts",editable:!1},children:[]}];var ap=new Xe("ChatBoxInputMediator"),Ps=class{constructor(){this.inputValue="";this.subscribers=[]}subscribe(t){this.subscribers.push(t)}unsubscribe(t){this.subscribers=this.subscribers.filter(n=>n!==t)}updateInputValue(t,n){ap.info("updateInputValue",t),this.inputValue=t,this.notifySubscribers(n)}getInputValue(){return this.inputValue}notifySubscribers(t){this.subscribers.forEach(n=>{n(this.inputValue,t)})}},_s=class{constructor(){this.inputValue="";this.subscribers=[]}subscribe(t){this.subscribers.push(t)}unsubscribe(t){this.subscribers=this.subscribers.filter(n=>n!==t)}updateInputValue(t,n){ap.info("updateInputValue",t),this.inputValue=t,this.notifySubscribers(n)}getInputValue(){return this.inputValue}notifySubscribers(t){this.subscribers.forEach(n=>{n(this.inputValue,t)})}},As=class e{static{this.mediators={chatBoxInputMediator:new Ps,floatingMenuInputMediator:new _s}}static getMediator(t){return e.mediators[t]}},Tr=e=>As.getMediator(e);var lp=e=>{let t=[],n=hi(e,"parent"),r=o=>{o.children=n[o.id]||[],o.children.length>0&&gi(o.children,r)};return gi(n.root,o=>{r(o),t.push(o)}),t},cp=(e,t)=>!(e.left>=t.left&&e.right<=t.right&&e.top>=t.top&&e.bottom<=t.bottom),Rg=(e,t)=>e.left<=t.right&&e.right>=t.left&&e.top<=t.bottom&&e.bottom>=t.top,kg=(e,t,n)=>!Rg(e,t)&&cp(t,n),YI=(e,t=220,n=400,r={offset:8,directions:["bottom","top","right","left"]})=>{let{offset:o=16,directions:i}=r,s={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight},l=i||["bottom","top","right","left"],a=[];l.map(u=>{switch(u){case"bottom":a.push({left:e.left,right:e.left+t,top:e.bottom+o,bottom:e.bottom+o+n,direction:u});break;case"top":a.push({left:e.left,right:e.left+t,top:e.top-o-n,bottom:e.top-o,direction:u});break;case"left":a.push({left:e.left-o-t,right:e.left-o,top:e.top,bottom:e.top+n,direction:u}),a.push({left:e.left-o-t,right:e.left-o,top:s.bottom-n-o,bottom:s.bottom-o,direction:u});break;case"right":a.push({left:e.right+o,right:e.right+o+t,top:e.top,bottom:e.top+n,direction:u}),a.push({left:e.right+o,right:e.right+o+t,top:s.bottom-n-o,bottom:s.bottom-o,direction:u});break;default:break}});let c=a.find((u,p)=>!kg(e,u,s));return c?{x:c.left-62,y:c.top}:{x:o,y:o}},Ke=e=>({left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width||e.right-e.left,height:e.height||e.bottom-e.top,x:e.x||e.left,y:e.y||e.top}),Ms=(e,t=.8)=>{let{width:n,height:r}=e,o={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight,x:0,y:0};return n*r>o.width*o.height*t?{x:o.width/2,y:o.height/2,left:o.width/2,right:o.width/2,top:o.height/2,bottom:o.height/2,width:0,height:0}:e},up=(e,t,n)=>{let o=t.toLowerCase().trim().split(/\s+/).filter(Boolean),i=ue(e.filter(a=>{let{data:{searchText:c}}=a,u=n?.[a.id]||c;if(!u)return!1;let p=u.split(/\s/),f=!0;for(let d of o){let g=p.findIndex(m=>m.includes(d));if(g===-1){f=!1;break}p.splice(g,1)}return f})),s=[],l=hi(fn(i,"id"),"parent");return Object.keys(l).forEach(a=>{let c=l[a].filter(u=>u.data.type!=="group");if(c.length>0)if(a==="root"){s.push(...c);return}else{let u=e.find(p=>p.id===a);u&&s.push({...u,children:c})}}),s};var KI=[sr({fallbackPlacements:["top-start","right","left"]}),lr(),ar({crossAxis:!0,padding:16}),In(e=>{if(e.placement.indexOf("bottom")>-1){let t={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight+window.scrollY};return cp({top:e.y,left:e.x,bottom:e.y+e.rects.floating.height+50,right:e.rects.floating.width+e.x},t)?e.rects.reference.y-e.y-e.rects.floating.height-8:8}else return 8})];var Rs=()=>{let e=Gr()?.querySelector(`#${Xs}`);return e&&e.getAttribute("aria-hidden")==="false"},XI=e=>Object.values(Be).find(t=>t===e)!==void 0,QI=e=>Object.values(On).find(t=>t.id===e),JI=e=>{let t;return Object.keys(Be).forEach(n=>{Be[n]===e&&(t=n)}),t},pp=()=>{let e=Tr("floatingMenuInputMediator").getInputValue();if(!e)return;let t=3*1e3,n=setInterval(()=>{let o=mn()?.querySelector(`#${Lr}`);o&&(clearInterval(n),Tr("chatBoxInputMediator").updateInputValue(e),setTimeout(()=>{o?.focus()},100))},50);setTimeout(()=>{clearInterval(n)},t)},ZI=(e,t)=>{let n=e.style,o=n.cssText.split(";"),i=t.split(";"),s={};o.forEach(a=>{let[c,u]=a.split(":");c&&u&&(s[c.trim()]=u.trim())}),i.forEach(a=>{let[c,u]=a.split(":");c&&u&&(s[c.trim()]=u.trim())});let l=Object.keys(s).map(a=>`${a}:${s[a]}`).join(";");n.cssText=l};var Lg=(e,t,n=!0)=>{let r=Qa(e),{favoriteContextMenuGroup:o}=el(e),{contextMenuSearchTextWithCurrentLanguage:i}=pa(),s=(0,xr.useRef)([]),l=(0,xr.useMemo)(()=>{let c=fn(ue(r?.contextMenu||[]),"id");s.current=c;let u=lp(c);return u=ca(u,p=>p.data.editable?r?.contextMenuPosition==="end"?0:2:1),o&&n&&u.unshift(o),u},[r,o]);return{contextMenuList:(0,xr.useMemo)(()=>t?.trim()?up(s.current,t,i):l,[l,e,t,n]),originContextMenuList:r?.contextMenu||[]}};var Yo=C(z());var hp=C(z());var cw=(e,t)=>new Promise(n=>setTimeout(()=>{if(t){let o=window.innerHeight/10;t.scrollIntoView(!1),window.scrollBy(0,o)}n(!0)},e)),uw=(e,t,n=20)=>{let r=t,o=0;for(;o<n&&!r.querySelector(e);)r=r?.parentElement,o++;return r.querySelector(e)||null},dp=(e,t,n=20)=>{try{let r=t,o=0;for(;o<n&&!r?.matches(e);)r=r?.parentElement,o++;return r?.matches(e)?r:null}catch{return null}};var Og=()=>{let e=de();return!!(e&&e==="mail.google.com")},Cr=class e{static{this.rangeMap=new Map}static setRange(t,n){n&&e.rangeMap.set(t,n)}static getRange(t){return e.rangeMap.get(t)}static removeAllRange(){e.rangeMap.clear()}},fp=(e,t)=>{Cr.setRange(e,t)},mp=e=>Cr.getRange(e)||null,Ng=()=>{Cr.removeAllRange()},yp=async()=>(await navigator.permissions.query({name:"clipboard-write"})).state==="granted",vp=e=>{let t=0,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow,o;if(typeof r.getSelection<"u"&&(o=r.getSelection(),o.rangeCount>0)){let i=r.getSelection().getRangeAt(0),s=i.cloneRange();s.selectNodeContents(e),s.setEnd(i.endContainer,i.endOffset),t=s.toString().length}return t},Dg=e=>{let t=0,n=0,r,o,i,s,l,a=e.ownerDocument||e.document;return typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"?(t=e.selectionStart,n=e.selectionEnd):(o=a.selection.createRange(),o&&o.parentElement()==e&&(s=e.value.length,r=e.value.replace(/\r\n/g,`
`),i=e.createTextRange(),i.moveToBookmark(o.getBookmark()),l=e.createTextRange(),l.collapse(!1),i.compareEndPoints("StartToEnd",l)>-1?t=n=s:(t=-i.moveStart("character",-s),t+=r.slice(0,t).split(`
`).length-1,i.compareEndPoints("EndToEnd",l)>-1?n=s:(n=-i.moveEnd("character",-s),n+=r.slice(0,n).split(`
`).length-1)))),{start:t,end:n}},bp=e=>{let t=e||document;if(t){if(t.getSelection)return String(t.getSelection())?.replace(/\u200B/g,"");if(t.selection)return t.selection.createRange().text?.replace(/\u200B/g,"");if(window.getSelection)return String(window.getSelection())?.replace(/\u200B/g,"")}return""},Ls=e=>{try{if(e){let t=e.ownerDocument||e.document,n=t.defaultView||t.parentWindow,r,o=`usechatgpt-start-marker-${te()}`,i=`usechatgpt-end-marker-${te()}`,s="";if(typeof t.getSelection<"u"&&(r=t.getSelection()||n.getSelection(),r.rangeCount>0)){Cp();let l=n.getSelection().getRangeAt(0).cloneRange();if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"){let a=e,{start:c,end:u}=Dg(a);e.setAttribute("data-usechatgpt-start-offset",c.toString()),e.setAttribute("data-usechatgpt-end-offset",u.toString()),e.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),e.setAttribute("data-usechatgpt-marker-start-id",o),e.setAttribute("data-usechatgpt-marker-end-id",i);let p=a.value.substring(c,u).trim().replace(/\u200B/g,""),f=(p||a.value.substring(0,c).trim()||a.value.trim()||"").replace(/\u200B/g,"");return{startMarkerId:o,endMarkerId:i,selectionText:f,editableElementSelectionText:p}}else{let a=(r.toString()||l.toString()).trim().replace(/\u200B/g,""),c=l.cloneRange();c.selectNodeContents(e),c.setEnd(l.endContainer,l.endOffset);let u=c.toString().trim().replace(/\u200B/g,""),p=(a||u||e.innerText.trim()||"").replace(/\u200B/g,"");document.activeElement?.tagName!=="IFRAME"&&l.startContainer?.tagName==="BODY"&&l.startContainer?.isSameNode(l.endContainer)&&(p="");let f=de();if(!Og())return fp(o,l.cloneRange()),fp(i,l.cloneRange()),{startMarkerId:o,endMarkerId:i,selectionText:p,editableElementSelectionText:a};let d=l.cloneRange();d.collapse(!0);let g=t.createElement("span");g.id=o,g.style.lineHeight="0",g.style.display="none",g.textContent=s,g.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),g.setAttribute("contenteditable","false"),g.setAttribute("data-usechatgpt-marker-start-id",o),d.insertNode(g),d=l.cloneRange(),d.collapse(!1);let m=t.createElement("span");return m.id=i,m.style.lineHeight="0",m.style.display="none",m.textContent=s,m.setAttribute("data-usechatgpt-marker","usechatgpt-marker"),m.setAttribute("contenteditable","false"),m.setAttribute("data-usechatgpt-marker-end-id",i),d.insertNode(m),{startMarkerId:o,endMarkerId:i,selectionText:p,editableElementSelectionText:a}}}}}catch{}return{startMarkerId:"",endMarkerId:"",selectionText:"",editableElementSelectionText:""}},Tp=e=>{let t=de(),n="",r="";try{if(e){let o=e.ownerDocument||e.document,i=o.defaultView||o.parentWindow,s;if(typeof i.getSelection<"u"&&(s=i.getSelection(),s.rangeCount>0)){let l=null;switch(t){case"notion.so":{l=o.querySelector(".notion-page-content")||o.querySelector('[data-content-editable-root="true"]');let a=i.getSelection().focusNode;if(l&&a){let c=document.createRange();c.selectNode(l);let u=c.cloneRange();u.setEndBefore(a);let p=u.toString().trim().replace(/\u200B/g,"");if(p)return{editableElementSelectionText:a.innerText.toString().trim().replace(/\u200B/g,""),selectionText:p}}}break;case"larksuite.com":{l=o.querySelector(".page-block-children")||o.querySelector(".page-block")||o.querySelector(".root-block");let a=i.getSelection().focusNode;if(a&&l){let c=dp(".ace-line",a?.parentElement,5);if(c){let u=document.createRange();u.selectNode(l);let p=u.cloneRange();p.setEndBefore(c);let f=p.toString().trim().replace(/\u200B/g,"");if(f)return{editableElementSelectionText:c.innerText.toString().trim().replace(/\u200B/g,""),selectionText:f}}}}break;case"writer.zoho.com":if(l=document.querySelector("#editorpane"),l){let a=l.querySelectorAll(".overlay"),c=[];if(a.length>0){a.forEach(p=>{let f=p.parentElement?.querySelector(".zw-line-content");f&&(c.find(d=>d===f)||c.push(f))});let u=c.map(p=>p.innerText).join("").trim().replace(/\u200B/g,"");u&&(n=u)}else{let u=l.querySelector(".cursor");if(u){let p=document.createRange();p.selectNode(l);let f=p.cloneRange();f.setEndBefore(u),i.getSelection()?.removeAllRanges(),i.getSelection()?.addRange(f);let d=i.getSelection()?.toString().trim().replace(/\u200B/g,"");if(d)return r=d,{editableElementSelectionText:n,selectionText:r}}}}break;default:{let a=3,c=e.parentElement;for(;a>0&&c;){let u=Nn(c);if(u.isEditableElement&&u.editableElement)if(u.editableElement?.innerText){l=u.editableElement;break}else u.editableElement?.parentElement&&(c=u.editableElement.parentElement,a--);else break}}break}return l?(document.createRange().selectNode(l),r=i.getSelection()?.toString().trim().replace(/\u200B/g,"")||l.innerText,{selectionText:r,editableElementSelectionText:n}):{selectionText:r,editableElementSelectionText:n}}}}catch{}return{selectionText:r,editableElementSelectionText:n}},Bg=(e,t,n)=>{let r=e.ownerDocument||document;if(e.focus(),e.setSelectionRange(t,n),e.tagName==="TEXTAREA"){let o=e,i=getComputedStyle(o),s=o.value.match(/\w/)?.[0]||"M",l=i.fontSize,a=i.fontFamily,c=r.createElement("span");c.style.fontSize=l,c.style.fontFamily=a,c.style.position="absolute",c.style.top="-9999px",c.style.left="-9999px",c.innerText=s,r.body.appendChild(c);let u=c.offsetWidth;c.remove();let p=Math.floor(o.getBoundingClientRect().width/u)||30,f=o.value.substring(0,n),d=ua(f.split(/\n/).map(m=>{let v=Math.ceil(m.length/p);return Math.max(v,1)})),g=o.clientHeight/o.rows;o.scrollTop=g*d}else if(e.tagName==="INPUT"){let o=e;o.scrollLeft=o.scrollWidth}},xp=async(e,t,n,r)=>{let o=null,i=document.querySelector(`[data-usechatgpt-marker-start-id="${e}"`),s=document.querySelector(`[data-usechatgpt-marker-end-id="${t}"`),l=null;if(!(!i&&!s&&(l=mp(e)||mp(t),!l))){if(i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA")){let a=i;o=a;let c=a?.ownerDocument||document,u=Number(a.getAttribute("data-usechatgpt-start-offset")),p=Number(a.getAttribute("data-usechatgpt-end-offset"));if(yi(u)&&yi(p)){a.tagName==="TEXTAREA"?n=n.replace(/\n+/,`
`):(n=n.replace(/\n+/," "),n=n.replace(/\s+/," "));let f="",d="",g="";r==="REPLACE_SELECTION"?(d=a.value.substring(0,u),g=a.value.substring(p,a.value.length)):r==="INSERT_BELOW"?(d=a.value.substring(0,p),g=a.value.substring(p,a.value.length),!d.endsWith(`
`)&&a.tagName==="TEXTAREA"?n=`
`+n:!d.endsWith(" ")&&a.tagName==="INPUT"&&(n=" "+n)):r==="INSERT_ABOVE"?(d=a.value.substring(0,u),g=a.value.substring(u,a.value.length),!g.startsWith(`
`)&&a.tagName==="TEXTAREA"?n=n+`
`:!g.startsWith(" ")&&a.tagName==="INPUT"&&(n=n+" ")):r==="INSERT"&&(d=a.value.substring(0,p),g=a.value.substring(p,a.value.length)),f=d+n+g;try{await yp()?(await navigator.clipboard.writeText(f),a.focus(),a.select(),c.execCommand("paste",!1,"")):(a.focus(),a.select(),c.execCommand("insertText",!1,f))}catch{a.focus(),a.select(),c.execCommand("insertText",!1,f)}Bg(a,d.length,d.length+n.length)}}else if(l){r==="INSERT_BELOW"?n=(`
`+n).replace(/^\n+/,`
`):r==="INSERT_ABOVE"&&(n=(n+`
`).replace(/\n+$/,`
`));try{let a=l.cloneRange();r==="REPLACE_SELECTION"||(r==="INSERT"||r==="INSERT_BELOW"?(a.setStart(l.endContainer,l.endOffset),a.setEnd(l.endContainer,l.endOffset)):r==="INSERT_ABOVE"&&(a.setStart(l.startContainer,l.startOffset),a.setEnd(l.startContainer,l.startOffset))),await gp(a,n)}catch{}}else if(i&&s){let{editableElement:a}=Nn(i);if(!a)return;o=a;let c=a.ownerDocument||document,u=c.createRange();if(u.selectNode(a),u.setStartAfter(i),u.setEndBefore(s),r==="INSERT_BELOW"?(n=(`
`+n).replace(/^\n+/,`
`),u.setStart(u.endContainer,u.endOffset)):r==="INSERT_ABOVE"?(n=(n+`
`).replace(/\n+$/,`
`),u.setEnd(u.startContainer,u.startOffset)):r==="REPLACE_SELECTION"||r==="INSERT"&&(n=n.replace(/^\n+/,""),u.setStart(u.endContainer,u.endOffset)),i.parentElement&&s.parentElement&&i.parentElement.isSameNode(s.parentElement)){let m=u.startOffset,v=u.endOffset,h=i.parentElement;i.remove(),s.remove();let b=!0;for(let T=0;T<h.childNodes.length;T++)if(h.childNodes[T].nodeType!==Node.TEXT_NODE){b=!1;break}if(b){let T=u.toString(),I=c.createTextNode(h.innerText);if(h.innerHTML="",h.appendChild(I),T.length>0){let x=Math.max(h.innerText.indexOf(T),0),P=x+T.length;u.setStart(h.childNodes[0],x),u.setEnd(h.childNodes[0],P)}else if(m===v){let x=h.childNodes[0];if(!x)return;v===0?(u.setStart(x,0),u.setEnd(x,0)):(u.setStart(x,x.nodeValue?.length||0),u.setEnd(x,x.nodeValue?.length||0))}}}let p=()=>{c.getSelection()?.removeAllRanges(),r==="INSERT_BELOW"||r==="INSERT"?(u.setStart(u.endContainer,u.endOffset),u.setEnd(u.endContainer,u.endOffset)):r==="INSERT_ABOVE"&&(u.setStart(u.startContainer,u.startOffset),u.setEnd(u.startContainer,u.startOffset)),c.getSelection()?.addRange(u)},f=()=>{a&&a.focus()},d=(m,v)=>{let h=u.cloneRange();r==="REPLACE_SELECTION"&&h.deleteContents(),c.getSelection()?.removeAllRanges(),c.getSelection()?.addRange(h);let{separator:b=`

`,tagName:T="div",className:I="",cssText:x="",onSeparator:P}=v||{};m.split(b).reverse().forEach((D,N,k)=>{let E=c.createElement(T);if(I&&(E.className=I),x&&(E.style.cssText=x),E.innerText=D,h.insertNode(E),P&&k[N+1]){let y=P(D);h.insertNode(y)}}),c.getSelection()?.removeAllRanges(),c.getSelection()?.addRange(h)};switch(de()){case"mail.google.com":f(),p(),d(n,{cssText:"white-space: pre-wrap;",onSeparator:()=>{let m=c.createElement("div"),v=c.createElement("br");return m.appendChild(v),m}});break;default:f(),p(),await gp(u,n)}if(o){let m=new KeyboardEvent("keyup",{bubbles:!0,cancelable:!0});i.dispatchEvent(m)}}Cp(),Ng()}},Cp=()=>{typeof document>"u"||document.querySelectorAll("[data-usechatgpt-marker]").forEach(e=>{if(e.tagName==="SPAN"||e?.id.includes("usechatgpt-marker")){e.remove();return}e.removeAttribute("data-usechatgpt-marker"),e.removeAttribute("data-usechatgpt-start-offset"),e.removeAttribute("data-usechatgpt-end-offset"),e.removeAttribute("data-usechatgpt-marker-start-id"),e.removeAttribute("data-usechatgpt-marker-end-id")})},Sw=()=>{typeof document>"u"||document.getSelection()?.removeAllRanges()},Nn=(e,t=10)=>{if(!e)return{isEditableElement:!1,editableElement:null};let n=e,r=null,o=t;for(;n&&o>0;){if(jo(n)){r=n;break}n=n.parentElement,o--}return r?{isEditableElement:!0,editableElement:r}:{isEditableElement:!1,editableElement:null}},Ew=(e,t)=>{let n=e,r=bp(),o="",{isEditableElement:i,editableElement:s}=Nn(n),l="",a="",c=0;i&&s&&(c=vp(s));let u=Ke(n.getBoundingClientRect()),p=null;try{let d=window.getSelection()?.getRangeAt(0)?.getBoundingClientRect();d&&(p=Ke(d),i&&d.width+d.height===0&&(p=Ke(e.getBoundingClientRect())))}catch{}if(!p){let d={left:0,right:window.innerWidth,top:0,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight,x:0,y:0};p={x:d.width/2,y:d.height/2,left:d.width/2,right:d.width/2,top:d.height/2,bottom:d.height/2,width:0,height:0}}return{isEmbedPage:!1,virtual:!1,tagName:n.tagName,eventType:"mouseup",target:n,isEditableElement:i,selectionText:r,selectionHTML:r,selectionRect:p,caretOffset:c,startMarkerId:l,endMarkerId:a,editableElementSelectionText:o,editableElementSelectionHTML:o,targetRect:u,...t}},Iw=(e=!0)=>{let t,n;if(document.selection)return t=document.selection.createRange(),t.collapse(e),t.parentElement();{let r=window.getSelection();if(r?.getRangeAt?r?.rangeCount>0&&(t=r.getRangeAt(0)):(t=document.createRange(),t.setStart(r?.anchorNode,r?.anchorOffset),t.setEnd(r?.focusNode,r?.focusOffset),t.collapsed!==r?.isCollapsed&&(t.setStart(r?.focusNode,r?.focusOffset),t.setEnd(r?.anchorNode,r?.anchorOffset))),t){n=t[e?"startContainer":"endContainer"];let o=n.nodeType===3?n.parentNode:n;if(o.tagName==="BODY"||o.tagName==="HTML"||o.tagName==="IFRAME")return;if(jo(o))return o;if(o.querySelector){let l=o.querySelector('[contenteditable="true"]');if(l&&jo(l))return l;let a=o.querySelector("input,textarea");if(a&&jo(a))return a}let{editableElement:i,isEditableElement:s}=Nn(o);return s?i:void 0}}};var jo=e=>{if(!e?.tagName)return!1;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.getAttribute?.("contenteditable")==="true"){let t=e.getAttribute("type"),n=e.getAttribute("readonly"),r=e.getAttribute("aria-readonly"),o=e.getAttribute("disabled"),i=e.getAttribute("aria-disabled");return!(t&&["password","file","checkbox","radio","submit","reset","button","image","hidden"].includes(t)||n==="true"||o==="true"||r==="true"||i==="true"||n===""||o===""||e.id===Lr||e.id===Ks)}return!1},gp=async(e,t)=>{let n=e.cloneRange(),r=e.cloneRange(),o=(e.startContainer||e.endContainer)?.ownerDocument||document;if(!(!o||o.getElementById(di)))try{let i=o.getSelection(),s=t,l=o.createElement("div");if(l.id=di,l.setAttribute("contenteditable","true"),l.style.cssText="width: 1px;height: 1px;position: fixed;top: 0px;left:0px;overflow: hidden; z-index: -1;",o.body.appendChild(l),l.addEventListener("paste",p=>{p.stopPropagation()},!0),l.addEventListener("copy",p=>{p.stopPropagation(),s=o?.getSelection()?.toString()||s},!0),await yp()){await navigator.clipboard.writeText(t),l.focus();let p=o.createRange();p.selectNodeContents(l),i?.removeAllRanges(),i?.addRange(p),o.execCommand("paste",!1,"")}else{l.focus();let p=o.createRange();p.selectNodeContents(l),i?.removeAllRanges(),i?.addRange(p),o.execCommand("insertText",!1,t)}try{l.focus();let p=o.createRange();p.selectNodeContents(l),i?.removeAllRanges(),i?.addRange(p),o.execCommand("copy",!1,"")}catch{let f=l.innerText.trim();try{let d=new fo;d.addRule("pre",{filter:"pre",replacement:function(m,v){return"```\n"+v.textContent+"\n```"}});let g=d.turndown(l);await navigator.clipboard.writeText(g||f)}catch{await navigator.clipboard.writeText(f)}}finally{l.remove()}let a=o.getSelection(),{editableElement:c}=Nn(n.startContainer||n.endContainer),u=de();if(a&&n){["discord.com"].includes(de())&&await navigator.clipboard.writeText(s),a.removeAllRanges(),a.addRange(n);let p=f=>new Promise(d=>setTimeout(d,f));i?.removeAllRanges(),i?.addRange(r),await p(0),["evernote.com","web.whatsapp.com","outlook.live.com","outlook.office.com"].includes(u)||window.location.href.startsWith("https://www.youtube.com/shorts")?(i?.toString().trim()&&o.execCommand("Delete",!1,""),o.execCommand("insertText",!1,s)):o.execCommand("paste",!1,""),r.collapse(!1),i?.collapseToEnd()}}catch{}},Fg=e=>{try{let t=e.target,r=(t.ownerDocument||t.document).getSelection();if(r&&r.rangeCount>0){let o=r.getRangeAt(0),i=o.startContainer||o.endContainer;if(i&&i.nodeType===3)i=i.parentNode;else if(i.childNodes.length>0&&o.startOffset===o.endOffset&&o.startOffset>=0){let c=o.startContainer,u=o.startOffset,p=c.childNodes[u];p.isSameNode(document.getElementById("max-ai-rich-text-editor-placeholder"))?p.nextSibling&&(i=p.nextSibling):p&&(i=p)}let s=i?.tagName?.toLowerCase(),l=de();l="";let a="1";switch(l){case"notion.so":break;case"larksuite.com":if(s==="span"&&i.getAttribute("data-string")==="true"){if(i?.parentElement?.parentElement?.getAttribute("data-placeholder"))break;a=i.innerText}break;case"mail.google.com":break;case"outlook.live.com":case"outlook.office.com":case"outlook.office365.com":{let c=de(),u=!1,p=i;if(location.href.startsWith(`https://${c}/mail/`)){s==="br"&&(u=!0,i?.parentElement?.parentElement&&(p=i.parentElement.parentElement)),(s==="span"||s==="div")&&i.childNodes.length===1&&i.childNodes[0].nodeName.toLowerCase()==="br"&&(u=!0,p=i.parentElement);let f=p.getAttribute("role"),d=p.getAttribute("contenteditable");f==="textbox"&&d==="true"&&(u?a="":a=i.innerText)}}break;case"writer.zoho.com":{let c=document.querySelector("#editorpane")?.querySelector(".cursor");if(!c)break;i=c.parentElement,c?.previousElementSibling&&(i=c.previousElementSibling,a=i.innerText)}break;default:break}return{richTextEditorLineText:a.trim().replace(/\u200B/g,""),richTextEditorLineTextElement:i}}return{richTextEditorLineText:"1",richTextEditorLineTextElement:null}}catch{return{richTextEditorLineText:"1",richTextEditorLineTextElement:null}}},Hg=(e,t)=>{if(!t){ks();return}let n=window.getComputedStyle(e),r=n.getPropertyValue("font-size"),o=n.getPropertyValue("color"),i=n.getPropertyValue("font-family"),s=n.getPropertyValue("font-weight"),l=n.getPropertyValue("font-style");ks();let a=document.createElement("span");a.id="max-ai-rich-text-editor-placeholder",a.style.fontSize=r,a.style.color=o,a.style.fontFamily=i,a.style.fontWeight=s,a.style.fontStyle=l,a.style.zIndex="999999999",a.style.pointerEvents="none",a.style.opacity="0.5",a.style.position="relative",a.style.display="inline",a.style.whiteSpace="nowrap",a.setAttribute("data-placeholder",t);let c=de();if(c==="larksuite.com")a.style.lineHeight="18px";else if(c==="writer.zoho.com"){let u=e?.parentElement?.parentElement?.getAttribute("data-textformat");try{let p=JSON.parse(u||"{}").size||12;a.style.fontSize=`${Number(p)}pt`}catch{a.style.fontSize="12pt"}e.insertBefore(a,e.firstChild);return}e.tagName.toLowerCase()==="br"?e.parentElement?.insertBefore(a,e):e.appendChild(a)},ks=()=>{document.getElementById("max-ai-rich-text-editor-placeholder")?.remove()},ww=()=>{let{chatBoxShortCutKey:e,floatingMenuShortCutKey:t}=tl(),n=Oe(pn);(0,hp.useEffect)(()=>{let r=a=>{let{richTextEditorLineText:c,richTextEditorLineTextElement:u}=Fg(a);if(!c&&u){let p=t&&n.userSettings?.shortcutHintEnable?`Press '${t}' for AI`:"";Hg(u,p)}else ks()},o=a=>{r(a)},i=a=>{},s=a=>{r(a)},l=a=>{r(a)};return document.addEventListener("focus",l,!0),document.addEventListener("keyup",o,!0),document.addEventListener("keydown",i,!0),document.addEventListener("mouseup",s,!0),()=>{document.removeEventListener("focus",l,!0),document.removeEventListener("keyup",o,!0),document.removeEventListener("keydown",i,!0),document.removeEventListener("mouseup",s,!0)}},[e,t,n.userSettings?.shortcutHintEnable])};var Pw=e=>{let t=document.querySelectorAll("iframe"),n=[],r=[];return t.forEach(o=>{if(o.getAttribute("sandbox")){if(o.getAttribute("sandbox")?.includes("allow-scripts"))return;o.contentDocument&&o.contentWindow&&n.push(o)}}),n.forEach(o=>{let i=o?.contentDocument,s=o?.contentWindow;if(!i||!s)return;let l=[],a=null,c=p=>{try{let f=a||p.target,d=bp(i),g="",{isEditableElement:m,editableElement:v}=Nn(f),h="",b="",T=0;if(m&&v){T=vp(v);let y=Ls(v);h=y.startMarkerId,b=y.endMarkerId,d=y.selectionText,g=y.editableElementSelectionText}a=null;let I=Ke(i.body.getBoundingClientRect()),x=Ke(f.getBoundingClientRect()),P=s.getSelection()?.getRangeAt(0)?.getBoundingClientRect(),D=null;if(f.tagName==="INPUT"||f.tagName==="TEXTAREA"){let y=Math.max(x.left,0),_=Math.max(x.top,0),A=(i.documentElement.clientWidth||i.body.clientWidth||i.body.offsetWidth)-y,w=i.documentElement.clientHeight||i.body.clientHeight||i.body.offsetHeight,R=Math.max(x.left,0),H=Math.max(x.left,0),V=Math.min(_,w),M=Math.min(_,w),F=Math.min(x.left>0?x.width:x.width+x.left,A),L=Math.min(x.top>0?x.height:x.height+x.top,w);D={left:R,x:H,top:V,y:M,width:F,height:L,right:Math.max(Math.min(x.width,A),A),bottom:Math.min(x.bottom,w)},D.height=Math.min(w-D.top,D.height)}else if(P){let y=Math.max(P.left,0),_=Math.max(P.top,0),A=(i.documentElement.clientWidth||i.body.clientWidth||i.body.offsetWidth)-y,w=i.documentElement.clientHeight||i.body.clientHeight||i.body.offsetHeight,R=Math.max(P.left,0),H=Math.max(P.left,0),V=Math.min(_,w),M=Math.min(_,w);D={left:R,x:H,top:V,y:M,width:Math.min(P.width,A),height:Math.min(P.height,w),right:Math.max(Math.min(P.right,A),A),bottom:Math.min(P.bottom,w)},D.height=Math.min(w-D.top,D.height)}let N=[l[0]-window.screenLeft,l[1]-window.screenTop],k=Ke(o.getBoundingClientRect()),E={virtual:!0,iframeId:"",tagName:f.tagName,id:f.id,className:f.className,windowRect:Ke(I),targetRect:Ke(x),selectionRect:P?Ke(P):void 0,iframeSelectionRect:D?Ke(D):void 0,iframePosition:N,selectionText:d||"",selectionHTML:d||"",editableElementSelectionText:g,editableElementSelectionHTML:g,eventType:p.type==="mouseup"?"mouseup":"keyup",isEmbedPage:!1,isEditableElement:m,caretOffset:T,startMarkerId:h,endMarkerId:b};E.selectionRect.top+=k.top,E.selectionRect.left+=k.left,E.selectionRect.right+=k.left,E.selectionRect.bottom+=k.top,e(E)}catch{}},u=p=>{let f=p.target;(f.tagName==="INPUT"||f.tagName==="TEXTAREA")&&(a=f),l=[p.screenX,p.screenY]};i.addEventListener("mousedown",u),i.addEventListener("mouseup",c),i.addEventListener("keyup",c),r.push(()=>{i.removeEventListener("mousedown",u),i.removeEventListener("mouseup",c),i.removeEventListener("keyup",c)})}),()=>{r.forEach(o=>{o()})}};var Sp=new Xe("ContextMenu/useFloatingContextMenu"),Os=()=>{let e=dt(Or),{saveCurrentSelection:t,show:n,hideRangy:r,tempSelection:o}=ss(),[i,s]=ae(ou),l=(0,Yo.useMemo)(()=>i.open,[i.open]),a=(0,Yo.useCallback)((f,d,g)=>{let m=f;if(!Rs()&&m&&(m?.selectionText||m?.isEditableElement)){if(Sp.info("open",m),m.isEditableElement&&m.target){let h=Ls(m.target),b=ue(m);if(b.editableElementSelectionText=h.editableElementSelectionText,b.editableElementSelectionHTML=h.editableElementSelectionText,b.selectionText=h.selectionText,!b.editableElementSelectionText&&!b.selectionText){let T=Tp(m.target);h.selectionText=T.selectionText,h.editableElementSelectionText=T.editableElementSelectionText,Sp.info(`Get special host selection text: 
`,T.editableElementSelectionText||T.selectionText)}h&&(b.startMarkerId=h.startMarkerId,b.endMarkerId=h.endMarkerId,b.selectionText=h.selectionText,b.editableElementSelectionText=h.editableElementSelectionText,m=b)}if(d&&(m={...m,...d}),!m?.isEditableElement&&m.selectionText||m?.editableElementSelectionText||g){t({selectionText:m.editableElementSelectionText||m.selectionText||"",selectionHTML:m.editableElementSelectionText||m.selectionText||"",selectionRect:m.selectionRect,activeElement:m.target,selectionInputAble:m.isEditableElement,selectionElement:m}),r(),s({open:!0,rootRect:Ms(m.selectionRect)});return}}let v=Rs();if(v&&pp(),r(),s({open:!1,rootRect:null}),v){Jt(),e(h=>({...h,open:!0}));return}va()?(ya(),e(h=>({...h,open:!1}))):(Jt(),e(h=>({...h,open:!0})))},[]),c=(f,d)=>{let g=Ke(f.getBoundingClientRect()),m={selectionText:d,selectionHTML:d,selectionRect:Ms(g),isEditableElement:!1,target:f,editableElementSelectionText:"",editableElementSelectionHTML:""};a(m)};return{isFloatingMenuVisible:l,showFloatingContextMenu:()=>{n&&!i.open&&o&&a(o.selectionElement,{},!0)},hideFloatingContextMenu:()=>{s({open:!1,rootRect:null})},haveSelection:n,floatingDropdownMenuOpen:i.open,showFloatingContextMenuWithElement:c,showFloatingContextMenuWithVirtualElement:a}};var Ep=C(z());var Ug=()=>{let{currentSelection:e}=Oe(Io);return(0,Ep.useMemo)(()=>e?.selectionElement?.editableElementSelectionText?On.filter(t=>![Be.INSERT].includes(t.id)):On.filter(t=>![Be.REPLACE_SELECTION,Be.INSERT_BELOW].includes(t.id)),[e])};var Ip=new Xe("InitChatGPT"),Wg=()=>{let e=dt(Wt),t=dt(pn),n=dt(vt),{showFloatingContextMenu:r}=Os(),o=(0,Sr.useRef)(r);(0,Sr.useEffect)(()=>{o.current=r},[r]),Hr(async(i,s,l)=>{switch(Ip.info("message",i,s),i){case"Client_ChatGPTStatusUpdate":return Ip.info("useInitChatGPTClient listener",s.status),e(a=>s.status!=="success"?(a.aborts.forEach(c=>c()),{loaded:!1,status:s.status,aborts:[]}):{loaded:!0,status:s.status,aborts:a.aborts}),{success:!0,message:"",data:{}};case"Client_listenOpenChatMessageBox":break;case"Client_updateAppSettings":return t(await Za()),n(await Ae()),{success:!0,data:{},message:""};case"Client_listenUpdateIframeInput":return s.startMarkerId&&s.endMarkerId&&await xp(s.startMarkerId,s.endMarkerId,s.value,s.type),{success:!0,data:{},message:""};default:break}}),(0,Sr.useEffect)(()=>{let i=async()=>{let a=await s.postMessage({event:"Client_checkChatGPTStatus"});a.success&&a.data.status&&e(c=>a.data.status!=="success"?(c.aborts.forEach(u=>u()),{loaded:!1,status:a.data.status,aborts:[]}):{loaded:!0,status:a.data.status,aborts:c.aborts})},s=new ie({runtime:"client"}),l=async()=>{await i()};return s.postMessage({event:"Client_checkChatGPTStatus"}),i(),window.addEventListener("focus",l),()=>{window.removeEventListener("focus",l),s?.destroy()}},[])};var pt=C(z());var Ko=C(mi()),wr=C(kr());var Ir="chatgpt-request-time-record",Er="chatgpt-request-count-record",Gg=2,zg=1e3*60*5,Xo=async e=>(await wr.default.storage.local.get(e))[e],Qo=e=>{wr.default.storage.local.remove(e)},Vg=async(e=Date.now(),t=!1)=>{await Xo(Ir)&&!t||await wr.default.storage.local.set({[Ir]:e})},Pr=async(e,t)=>{try{let n=await Xo(Er)||{},o=(await Ae()).sidebarSettings?.common?.currentAIProvider,i=(0,Ko.default)().format("YYYY-MM-DD");if(Object.keys(n).forEach(a=>{Object.prototype.hasOwnProperty.call(n[a],"prompt_cnt")||delete n[a]}),(!n[i]||!Object.prototype.hasOwnProperty.call(n[i],"prompt_cnt"))&&(n[i]={error_cnt:0,success_cnt:0,total_cnt:0,prompt_cnt:{}}),e==="error")n[i].error_cnt+=1;else if(e==="success")n[i].success_cnt+=1;else if(e==="total")n[i].total_cnt+=1;else if(e==="prompt"&&t){let{name:a,host:c,id:u}=t;n[i].prompt_cnt[u]||(n[i].prompt_cnt[u]={name:a,ai_provider_cnt:{}}),o&&(n[i].prompt_cnt[u].ai_provider_cnt[o]||(n[i].prompt_cnt[u].ai_provider_cnt[o]={}),n[i].prompt_cnt[u].ai_provider_cnt[o][c]||(n[i].prompt_cnt[u].ai_provider_cnt[o][c]={total_cnt:0}),n[i].prompt_cnt[u].ai_provider_cnt[o][c].total_cnt+=1)}Vg(Date.now()),await wr.default.storage.local.set({[Er]:n});let s=la(n),{ON_BOARDING_RECORD_FIRST_MESSAGE:l}=await fa();l?Object.keys(s).length>=Gg?Ns():$g():(Ns(),await da("ON_BOARDING_RECORD_FIRST_MESSAGE",!0))}catch{Qo(Ir),Qo(Er)}},$g=dn(()=>{Ns()},zg),Ns=async()=>{try{if(document.hidden)return;let e=await Kr(),t=await Xo(Ir),n=await Xo(Er);if(!n)return;let r=0,o=0;if(Object.keys(n).forEach(s=>{n[s].total_cnt>0&&(r+=1,o+=n[s].total_cnt)}),r===0||o===0)return;let i=await Ut();if(t&&n&&i){let s=Ql(n);fetch(`${un}/user/log`,{method:"POST",body:JSON.stringify({start_timestamp:(0,Ko.default)(t).unix(),end_timestamp:(0,Ko.default)().unix(),info_object:s}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,fp:`${e}`}}).then(async l=>{try{let a=await l.json();Qo(Ir),Qo(Er)}catch{}})}}catch{}};var Ap=C(mi()),Mp=C(wp());var Rp=C(kr());Ap.default.extend(Mp.default);var Pp=new ie({runtime:"client"}),_p=new Xe("UseMessageWithChatGPT"),qg=e=>{let{currentSidebarConversationMessages:t,currentSidebarConversationType:n,currentSidebarConversationId:r,sidebarSettings:o}=Ge(),i=(0,pt.useRef)(r),s=(0,pt.useRef)(o),{createConversation:l,cleanConversation:a,updateConversation:c}=Vt(),u=mc(),{currentUserPlan:p}=Xn(),f=(0,pt.useRef)(e||""),[d,g]=ae(Gt),m=(0,pt.useRef)(d);(0,pt.useEffect)(()=>{m.current=d},[d]);let v=()=>({conversationRef:m,currentConversationIdRef:i,currentSidebarSettingsRef:s}),h=async()=>{k(""),await a()},b=async(_,A,w)=>{let{onStart:R,onProcess:H,onEnd:V}=w||{},M=de(),F=A?.meta?.contextMenu,L=null,U=async re=>L?(await ht("add",re,0,[Ya(u[L.sceneType])]),Tn("show",L.sceneType),Jt(),{success:!1,answer:"",error:""}):null;if(p.name==="free"&&F?.id&&!p.isNewUser){let re=new URL(location.href),me=`${Rp.default.runtime.id}/pages/pdf/web/viewer.html`;re.href.includes(me)&&n==="Chat"&&(L=u.PDF_AI_VIEWER)}let Q={Chat:"chat",Summary:"summary_chat",Search:"search_chat"}[n],{data:K}=await Pp.postMessage({event:"Client_logCallApiRequest",data:{name:F?.text||Q,id:F?.id||Q,host:M}});K&&(L=u.TOTAL_CHAT_DAILY_LIMIT);let{question:J,messageId:se,parentMessageId:O}=_,{regenerate:ne=!1,includeHistory:Y=!1,maxHistoryMessageCnt:Z=0,retry:Le=!1}=A||{};if(!J||d.loading)return{success:!1,answer:"",error:""};g(re=>({...re,loading:!0}));let G=await l();_p.info("createConversation",G);let we=Z;if(!Z&&Y){let re=0;for(let me=t.length-1;me>=0;me--){let At=t[me];if(At.type==="user"&&At.extra?.includeHistory===!1){re++;break}re++}we=re}let Te=se||te(),ee=O||"",q=await aa(),Pe={type:"user",messageId:Te,parentMessageId:ee,text:J,extra:{includeHistory:Y,regenerate:ne,maxHistoryMessageCnt:we,meta:{...A?.meta,attachments:q}}};g(re=>({...re,lastMessageId:Te,loading:!0})),A?.userMessageVisible!==!1&&await ht("add",G,0,[Pe]),R&&await R(Pe.text);let _e=[],rt=!1,Dn=!1,ce="";try{let re=await U(G);if(re)return re;await Pr("total"),await Pr("prompt",{name:F?.text||"chat",id:F?.id||"chat",host:M});let me=null,At="";return await Ia({conversationId:G,question:Y?J:Js+J,messageId:Te,parentMessageId:ee},{retry:Le,includeHistory:Y,regenerate:ne,meta:A?.meta,maxHistoryMessageCnt:we},{onMessage:async Fe=>{let Mt={messageId:Fe.messageId||te(),parentMessageId:Fe.parentMessageId||te(),text:Fe.text||"",type:"ai",originalMessage:Fe.originalMessage};H&&await H(ue(Mt)),me=ue(Mt),Fe.conversationId&&(At=Fe.conversationId),A?.aiMessageVisible!==!1&&g(Rt=>({...Rt,loading:!0,writingMessage:Mt}))},onError:async Fe=>{Dn=!0,me?.messageId&&(me?.originalMessage?.metadata&&(me.originalMessage.metadata.isComplete=!0),_e.push(me));let Mt=typeof Fe=="string"&&Fe?.trim()==="403";if(Fe==="Conversation not found"||Mt){await a();return}if(ce=Fe?.message||Fe||"Error detected. Please try again.",typeof ce!="string"&&(ce="Network error. Please try again."),ce==="manual aborted request.")rt=!0;else{if(Pr("error"),Mt&&(ce="Log into ChatGPT web app and pass Cloudflare check. We recommend enabling our new [ChatGPT Stable Mode](key=options&query=#chatgpt-stable-mode) to avoid frequent interruptions and network errors."),ce.startsWith("Too many requests in 1 hour")&&(ce=`Too many requests in 1 hour. Try again later, or use our new AI provider for free by selecting "MaxAI.me" from the AI Provider options at the top of the sidebar.
                ![switch-provider](https://www.maxai.me/assets/chrome-extension/switch-provider.png)`),ja(ce)){L=u[ce];let Rt=await U(G);if(Rt)return Rt}_e.push({type:"system",messageId:te(),parentMessageId:Te,text:ce,extra:{status:"error"}})}}}),!Dn&&me&&me?.messageId&&me?.text?(me?.originalMessage?.metadata&&(me.originalMessage.metadata.isComplete=!0),await Pr("success"),At&&await c({meta:{AIConversationId:At}},G),_e.push(me),Promise.resolve({success:!0,answer:me?.text||"",error:""})):Promise.resolve({success:rt,answer:me?.text||"",error:ce})}catch(re){return _p.error("send question error",re),Promise.resolve({success:!1,answer:"",error:re.message||re})}finally{V&&await V(Dn,_e?.[0]),k(""),g(re=>({...re,writingMessage:null,loading:!1})),A?.aiMessageVisible!==!1?await ht("add",G,0,_e):await ht("add",G,0,_e.filter(re=>re.type==="third"||re.type==="system").map(re=>({...re,parentMessageId:A?.aiMessageVisible===!1?"":re.parentMessageId})))}},T=async _=>{let A=t.find(w=>w.messageId===_);A&&(g(w=>({...w,loading:!0})),await b({question:A.text,messageId:te(),parentMessageId:A.messageId},{retry:!0,regenerate:!1,includeHistory:!0}))},I=(0,pt.useCallback)(async()=>{let _=null;for(let A=t.length-1;A>=0;A--){let w=t[A];if(w.type==="user"){_=w;break}}return _?b({question:_.text,messageId:_.messageId,parentMessageId:_.parentMessageId},{regenerate:!0,includeHistory:Object.prototype.hasOwnProperty.call(_.extra,"includeHistory")?_.extra.includeHistory:!0,meta:_.extra.meta}):null},[t,b]),x=async()=>{(d.writingMessage?.parentMessageId||d.lastMessageId)&&await Pp.postMessage({event:"Client_abortAskChatGPTQuestion",data:{messageId:d.lastMessageId}})},P=async(_,A)=>{(A||r)&&await ht("add",A||r||"",0,[_])},D=async(_,A)=>{A&&_.messageId&&await ht("update",A,0,[_])},N=async(_,A)=>{(A||r)&&await ht("delete",A||r||"",_,[])},k=_=>{Tr("chatBoxInputMediator").updateInputValue(_)},E=()=>{g(_=>({..._,loading:!0}))},y=()=>{g(_=>({..._,loading:!1}))};return(0,pt.useEffect)(()=>{e&&(f.current=e)},[e]),(0,pt.useEffect)(()=>{s.current=ue(o),i.current=r},[o,r]),{sendQuestion:b,currentSidebarConversationMessages:t,resetConversation:h,conversation:d,retryMessage:T,reGenerate:I,stopGenerateMessage:x,pushMessage:P,updateMessage:D,deleteMessage:N,updateConversation:c,getSidebarRef:v,showLoading:E,hideLoading:y}};var ht=async(e,t,n,r)=>{try{return(await new ie().postMessage({event:"Client_modifyMessages",data:{conversationId:t,action:e,deleteCount:n,newMessages:r}})).success}catch{return!1}},bc=async(e,t)=>{try{return(await new ie().postMessage({event:"Client_updateConversation",data:{conversationId:e,updateConversationData:t}})).success}catch{return!1}};var _r=C(z());var Fs=new ie,kp=new Xe("Features/Auth/UseChatGPTPlusChat"),jg=(e=!0)=>{let[t,n]=ae(no),{currentSidebarConversationMessages:r,currentSidebarConversationId:o}=Ge(),i=(0,_r.useRef)(!1),s=(0,_r.useRef)(""),l=async()=>{try{n(u=>({...u,loading:!0}));let c=await Fs.postMessage({event:"Client_getUseChatGPTUserInfo",data:{}});return c.success&&c.data?.email?(n({user:c.data,loading:!1}),!0):!1}catch(c){return kp.error(c),!1}finally{n(c=>({...c,loading:!1}))}},a=async()=>{try{n(p=>({...p,loading:!0}));let c=ue(t.user);if(!c){let p=await Fs.postMessage({event:"Client_getUseChatGPTUserInfo",data:{}});p.success&&p.data?.email&&(c=p.data)}if(!c)return!1;let u=await Fs.postMessage({event:"Client_getUseChatGPTUserSubscriptionInfo",data:{}});if(u.success&&u.data?.name){let p=u.data;p&&n(f=>{let d=ue(f.user);return d||(d=ue(c)),d?(d.role?.name&&d.role.name!==p.name&&p.name!=="free"&&(i.current=!0,p.name==="elite"?s.current="You have successfully upgraded to MaxAI Elite. Enjoy unlimited usage!":p.name==="pro"&&(s.current="You have successfully upgraded to MaxAI Pro. Enjoy enhanced productivity!")),{user:{...d,role:p},loading:!1}):{user:null,loading:!1}})}return!1}catch(c){return kp.error(c),!1}finally{n(c=>({...c,loading:!1}))}};return(0,_r.useEffect)(()=>{!i.current||!s.current||o&&!Cl(r,c=>c.text==="You have successfully upgraded to MaxAI Elite. Enjoy unlimited usage!"||c.text==="You have successfully upgraded to MaxAI Pro. Enjoy enhanced productivity!")&&ht("add",o,0,[{messageId:te(),type:"system",parentMessageId:void 0,text:s.current,extra:{status:"success"}}])},[o,r]),Lt(()=>{e&&l()}),kt(()=>{e&&l()}),{userInfo:t,syncUserInfo:l,syncUserSubscriptionInfo:a}},Lp=jg;var Us=C(mi()),Xn=()=>{let{user:e,loading:t}=Oe(no),{syncUserInfo:n,syncUserSubscriptionInfo:r}=Lp(!1),o=(0,Hs.useMemo)(()=>{if(e?.chatgpt_expires_at){let s=new Date(e.chatgpt_expires_at),l=new Date,a=s.getTime()-l.getTime(),c=Math.ceil(a/(1e3*3600*24)),u=Math.floor(c/7),p=Math.ceil(c%7),f="";return p>0&&(f="& "+p+" day"+(p>1?"s":"")),u<1?c<=0?a<0?"0":"1 day":c<2?`${c} day`:`${c} days`:u<2?`${u} week ${f}`:`${u} weeks ${f}`}return 0},[e]);return{currentUserPlan:(0,Hs.useMemo)(()=>{let s=e?.role?.name||"free",l=e?.subscription_plan_name;e?.roles?.length&&(e.roles.find(p=>p.name==="pro")&&(s="pro"),e.roles.find(p=>p.name==="elite")&&(s="elite"));let a=!1;if(e?.chatgpt_expires_at&&s==="free"&&new Date(e.chatgpt_expires_at).getTime()>new Date().getTime()&&(s="pro_gift"),s==="free"&&e?.created_at){let c=(0,Us.default)(e?.created_at);(0,Us.default)().utc().diff(c,"day")<=-1e5&&(s="new_user",a=!0)}return{planName:l,name:s,isNewUser:a}},[e]),quotaLeftText:o,userInfo:e,loading:t,syncUserInfo:n,syncUserSubscriptionInfo:r}};export{nl as a,ol as b,Wt as c,yn as d,Gt as e,xt as f,Ni as g,ll as h,Jr as i,ki as j,gl as k,Zr as l,md as m,Al as n,en as o,Ct as p,Rl as q,xl as r,Cl as s,hd as t,Vh as u,ht as v,bc as w,Ge as x,Lp as y,Xn as z,$n as A,so as B,lv as C,qn as D,cv as E,Ol as F,Bl as G,Hd as H,Hi as I,Av as J,kv as K,qd as L,Bv as M,Fv as N,Hv as O,Yl as P,Jl as Q,Jv as R,co as S,jn as T,pb as U,db as V,Cb as W,fc as X,mo as Y,Sb as Z,Tn as _,Yi as $,mc as aa,go as ba,Ji as ca,yo as da,hc as ea,tn as fa,nx as ga,rx as ha,ox as ia,ix as ja,Vt as ka,Cc as la,Ic as ma,Ve as na,Ff as oa,Hf as pa,Uf as qa,Wf as ra,Gf as sa,zf as ta,Vf as ua,ns as va,Fc as wa,Zn as xa,os as ya,Yc as za,dm as Aa,Qc as Ba,mm as Ca,Tm as Da,DE as Ea,ou as Fa,BE as Ga,FE as Ha,xm as Ia,HE as Ja,UE as Ka,ss as La,sr as Ma,In as Na,ar as Oa,Pu as Pa,yr as Qa,Ln as Ra,bI as Sa,TI as Ta,xI as Ua,CI as Va,SI as Wa,EI as Xa,II as Ya,wI as Za,PI as _a,_I as $a,AI as ab,MI as bb,RI as cb,kI as db,LI as eb,Tr as fb,cp as gb,YI as hb,Ke as ib,Ms as jb,up as kb,KI as lb,Rs as mb,XI as nb,QI as ob,JI as pb,pp as qb,ZI as rb,Lg as sb,cw as tb,uw as ub,dp as vb,vp as wb,bp as xb,Ls as yb,xp as zb,Cp as Ab,Sw as Bb,Nn as Cb,Ew as Db,Iw as Eb,ww as Fb,Pw as Gb,Os as Hb,Ug as Ib,Wg as Jb,wp as Kb,qg as Lb};
/*! Bundled license information:

tabbable/dist/index.esm.js:
  (*!
  * tabbable 6.2.0
  * @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
  *)
*/
